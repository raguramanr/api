<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ospflib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ospflib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ospflib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ospflib.tcl-annot.html">annotations</a> | <a href="ospflib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::downloadModule_2">proc <a href="ospflib.tcl-annot.html#::::downloadModule">::::downloadModule</a></a></strong> {TFTPServerIP filename} {
  
   global whichDutNow
   <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;download image $TFTPServerIP $filename vr [<a name="::GetVrString(1)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $whichDutNow]&#34;
   <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;run update&#34;
   <a name="::CheckReboot(1)"><a href="./SendSwCmd.tcl.html#::CheckReboot_1202">::CheckReboot</a></a>
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getOspfModulePath</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       Used to get the path for Ospf Module</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: return 0 if failed, return spawn_id if ok</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::getOspfModulePath_22">proc <a href="ospflib.tcl-annot.html#::::getOspfModulePath">::::getOspfModulePath</a></a></strong> { } {
   return [<a name="::getImagePath(1)"><a href="./LocateImage.tcl.html#::getImagePath_1">::getImagePath</a></a> -Image ospf]
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: downloadOspfModule</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       Used to download OSPF module</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: return 0 if failed, return spawn_id if ok</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::downloadOspfModule_38">proc <a href="ospflib.tcl-annot.html#::::downloadOspfModule">::::downloadOspfModule</a></a></strong> { } {
   global tftpServerList tftpServerLogin tftpServerPasswd tftpServerTftpboot
   global moduleArg
   global DUTs_info

   if {$moduleArg!=&#34;&#34;} {
      set modulePath $moduleArg
   } else {
      set modulePath [<a name="::getOspfModulePath(1)"><a href="./ospflib.tcl.html#::getOspfModulePath_22">::getOspfModulePath</a></a>]
   }

<span class="comment-line">#   if {$modulePath!=&#34;release-manager&#34;} {</span>
 <span class="comment-line">#     return $modulePath</span>
 <span class="comment-line">#  }</span>
   set moduleName [file tail $modulePath ]

   foreach tftpServer $tftpServerList {
      <span class="comment-line">#if module is found in the TFTP server use it</span>
      <span class="comment-line">#this gives the user a way to manually copy the SSH module to TFTP</span>
      if [<a name="::tftpFileExists(1)"><a href="./LocateImage.tcl.html#::tftpFileExists_438">::tftpFileExists</a></a> $tftpServer $moduleName] {
         <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> \
            &#34;Module $moduleName found on TFTP server. Download it&#34;
         <a name="::downloadModule(1)"><a href="./ospflib.tcl.html#::downloadModule_2">::downloadModule</a></a> $tftpServer $moduleName
         return
      }
   }

   <span class="comment-line">#module is not found on tftp server</span>
   <span class="comment-line">#Put the module to the TFTP server, download it</span>
   <span class="comment-line">#and then remove it.</span>
<span class="comment-line">#   result_debug \</span>
<span class="comment-line">#      &#34;Module $moduleName not found on TFTP server. Copy module to TFTP server from $modulePath&#34;</span>
<span class="comment-line">#   if ![file exists $modulePath] {</span>
<span class="comment-line">#      report_start_test &#34;SSH module not found in $modulePath. Please copy $moduleName to TFTP server and rerun the test.&#34;</span>
<span class="comment-line">#      result_error &#34;SSH module not found in $modulePath. Please copy $moduleName to TFTP server and rerun the test.&#34;</span>
<span class="comment-line">#      report_end_test</span>
<span class="comment-line">#      return</span>
<span class="comment-line">#   }</span>

   foreach tftpServer $tftpServerList {
      set fileName [<a name="::uniqueName(1)"><a href="./LocateImage.tcl.html#::uniqueName_431">::uniqueName</a></a> $moduleName]
      <span class="comment-line">#put the OSPF module to the TFTP server and download it</span>
      <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> \
         &#34;puting OSPF module $modulePath to TFTP Server as $fileName&#34; 
      exec \
         echo &#34;put $modulePath $fileName\nquit\n&#34; | /usr/bin/tftp $tftpServer
         
      <a name="::downloadModule(2)"><a href="./ospflib.tcl.html#::downloadModule_2">::downloadModule</a></a> $tftpServer $fileName

      <span class="comment-line">#remove the SSH module from TFTP server</span>
      global spawn_id
      set sid $spawn_id
      <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;remove SSH module from TFTP Server&#34;
      <a name="::login_linux(1)"><a href="./linux.tcl.html#::login_linux_16">::login_linux</a></a> $tftpServer $tftpServerLogin $tftpServerPasswd
      <a name="::linuxSendACmd(1)"><a href="./linux.tcl.html#::linuxSendACmd_268">::linuxSendACmd</a></a> &#34;/bin/rm $tftpServerTftpboot/$fileName&#34; 
      set spawn_id $sid
      global whichDutNow

      set output [<a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show version image $DUTs_info(DUT$whichDutNow,imageSel)&#34;]
      if [regexp {([^ ]+ospf[^ ]+)} $output] {
         <span class="comment-line">#ospf module downloaded successfully. no need to try next tftp server</span>
         break
      }
   }
   <span class="comment-line">#sleep 2</span>

}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
