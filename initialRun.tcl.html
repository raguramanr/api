<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>initialRun.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#initialRun.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>initialRun.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="initialRun.tcl-annot.html">annotations</a> | <a href="initialRun.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/expect --</span>



set rootDir &#34;/auto/automation&#34;

set reportDir &#34;$rootDir/TestReport&#34;

<span class="comment-line">#Regression type list</span>
set regList [list &#34;Functionaltest&#34; &#34;PerformanceTest&#34; &#34;Benchmarktest&#34; \
                   &#34;Scalabilitytest&#34; &#34;CLItest&#34; &#34;Stresstest&#34; ]

<span class="comment-line">#Tab spaces for html file </span>
set tabSpace &#34;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;\
             &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#34;

<span class="comment-line">#To print the usage of the script</span>
<strong><a name="::::printUsage_18">proc <a href="initialRun.tcl-annot.html#::::printUsage">::::printUsage</a></a></strong> { } {
     puts &#34;\r&#34;
     puts &#34;Usage: initialRun.tcl  &lt;buildNumber&gt;&#34;
     puts &#34;buildNumber: format xxxbzz Ex. 711b36&#34;
}

<span class="comment-line">#***************************************************************</span>
<span class="comment-line"># This procedure is used to fetch the number of pass and failed</span>
<span class="comment-line"># test cases for a particular module i.e. L2,L3 etc. It will </span>
<span class="comment-line"># access the 'report.txt' file to get the total number of test</span>
<span class="comment-line"># cases executed for a particular module.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input : module name</span>
<span class="comment-line"># Output : number of test cases executed (pass + fail)</span>
<span class="comment-line">#***************************************************************** </span>

<strong><a name="::::getNumberOfTestCases_34">proc <a href="initialRun.tcl-annot.html#::::getNumberOfTestCases">::::getNumberOfTestCases</a></a></strong> {module dir } {
   puts &#34;Getting the number of test cases for : $module&#34;
   set fname &#34;$dir/report.txt&#34; ; <span class="comment-line"># file name</span>
   set dname [file tail $dir] ; <span class="comment-line">#directory name</span>
   set ch &#34; = &#34; ; <span class="comment-line"># search char</span>
   set pLine &#34;&#34;
   set fLine &#34;&#34;

   if { [catch { set pLine [exec grep &#34;cases passed&#34; $fname] } ] } {
       puts &#34;ERROR: Unable to fetch the pass test cases for: $module&#34;
       return 0
   }
   if { [catch { set fLine [exec grep &#34;cases failed&#34; $fname] } ] } {
       puts &#34;ERROR: Unable to fetch the failed test cases for: $module&#34;
       return 0
   }

   set pLength [string length $pLine]
   set fLength [string length $fLine]

   set pIndex [string first $ch $pLine] 
   set fIndex [string first $ch $fLine] 

   incr pIndex 2
   incr fIndex 2

   set pNumber [string range $pLine $pIndex $pLength]
   set fNumber [string range $fLine $fIndex $fLength]

   set pNumber [string trim $pNumber]
   set fNumber [string trim $fNumber]
   
   if { ![string is integer $pNumber] } {
       puts &#34;$module $dname: Can't fetch the number of passed test cases.&#34;
       set pNumber 0
   }
   if { ![string is integer $fNumber] } {
       puts &#34;$module $dname: Can't fetch the number of failed test cases.&#34;
       set fNumber 0
   }
   set total [ expr $pNumber + $fNumber ]
   puts &#34;number of test cases = $total&#34;
   return $total
}

<span class="comment-line">#**********************************************************</span>
<span class="comment-line"># This procedure is used to print the header information </span>
<span class="comment-line"># into the report file for a specific regression type.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input : regression type</span>
<span class="comment-line">#         file descriptor </span>
<span class="comment-line"># Output : None</span>
<span class="comment-line">#************************************************************</span>

<strong><a name="::::printHeader_88">proc <a href="initialRun.tcl-annot.html#::::printHeader">::::printHeader</a></a></strong> { ftest fd } {
    global tabSpace
    set testType &#34;&#34;

    switch $ftest {
 	&#34;Functionaltest&#34;   {
              set testType &#34;FUNCTIONAL TEST&#34; 
         } 
 	&#34;PerformanceTest&#34;  {
              set testType &#34;PERFORMANCE TEST&#34; 
         } 
	&#34;Benchmarktest&#34;   { 
              set testType &#34;BENCHMARK TEST&#34; 
         } 
 	&#34;Scalabilitytest&#34; {
              set testType &#34;SCALABILITY TEST&#34; 
         } 
 	&#34;CLItest&#34;  {
              set testType &#34;CLI TEST&#34; 
         } 
	&#34;Stresstest&#34;  { 
              set testType &#34;STRESS TEST&#34; 
         } 
     }
    puts $fd &#34;&lt;div style=\&#34;margin-left: 40px;\&#34;&gt;&lt;span style=\&#34;font-weight: bold;\
             font-size:12.0pt;mso-bidi-font-size:14.0pt; font-family:Courier\&#34;&gt;&#34;
    puts $fd &#34;$testType &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&#34;
    puts $fd &#34;&lt;div style=\&#34;margin-left:\&#34;&gt;&lt;span style=\&#34;font-weight: bold;\
             font-size:11.0pt;mso-bidi-font-size:13.0pt; font-family:Courier\&#34;&gt;&#34;
    puts $fd &#34;MODULE&lt;span style=\&#34;mso-spacerun: yes\&#34;&gt;$tabSpace&lt;/span&gt;TEST CASES &lt;/span&gt;&lt;br&gt;&#34;

}

<span class="comment-line">#**********************************************************</span>
<span class="comment-line"># This procedure is used to print the number of test cases </span>
<span class="comment-line"># for a particular module in the corresponding report file.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input : module type</span>
<span class="comment-line">#         number of test cases</span>
<span class="comment-line">#         file descriptor </span>
<span class="comment-line">#***********************************************************</span>

<strong><a name="::::printModule_130">proc <a href="initialRun.tcl-annot.html#::::printModule">::::printModule</a></a></strong> { module num fd} {
    set len [string length $module]
    set sp &#34;&amp;nbsp;&#34;
    for { set i 0 } { $i &lt; [expr 25 - $len] } { incr i } {
       append sp &#34;&amp;nbsp;&#34;
    }
    puts $fd &#34;&lt;span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;&#34;
    puts $fd &#34;font-family:Courier'&gt;[string toupper $module]&lt;span style=\&#34;mso-spacerun: \
             yes\&#34;&gt;$sp &lt;/span&gt; $num &lt;br&gt;&#34;
}

<span class="comment-line">#**********************************************************</span>
<span class="comment-line"># This procedure is used to print the total number of test </span>
<span class="comment-line"># cases for a particular regression type in the corresponding </span>
<span class="comment-line"># report file.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input : module type</span>
<span class="comment-line">#         number of test cases</span>
<span class="comment-line">#         file descriptor </span>
<span class="comment-line">#***********************************************************</span>

<strong><a name="::::printTotal_151">proc <a href="initialRun.tcl-annot.html#::::printTotal">::::printTotal</a></a></strong> { ftest total fd} {
    set testType &#34;&#34;
    puts $fd &#34;&lt;br&gt;&#34;
    switch $ftest {
 	&#34;Functionaltest&#34;   {
              set testType &#34;FUNCTIONAL TEST&#34; 
         } 
 	&#34;PerformanceTest&#34;  {
              set testType &#34;PERFORMANCE TEST&#34; 
         } 
	&#34;Benchmarktest&#34;   { 
              set testType &#34;BENCHMARK TEST&#34; 
         } 
 	&#34;Scalabilitytest&#34; {
              set testType &#34;SCALABILITY TEST&#34; 
         } 
 	&#34;CLItest&#34;  {
              set testType &#34;CLI TEST&#34; 
         } 
	&#34;Stresstest&#34;  { 
              set testType &#34;STRESS TEST&#34; 
         } 
     }
    puts $fd &#34;TOTAL NUMBER OF $testType CASES = $total&#34;
    puts $fd &#34;&lt;br&gt; &lt;br&gt;&#34;
}
<span class="comment-line">#**************************************************************</span>
<span class="comment-line"># This procedure is used to get all the sub-directories under</span>
<span class="comment-line"># the directory passed as the parameter to this procedure. It</span>
<span class="comment-line"># returns the list of directories in sorted order.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input : current directory.</span>
<span class="comment-line"># Output : Sorted list of subdirectories</span>
<span class="comment-line">#***************************************************************</span>

<strong><a name="::::getSubDirs_186">proc <a href="initialRun.tcl-annot.html#::::getSubDirs">::::getSubDirs</a></a></strong> { dir } {
  set dirList &#34;&#34;
  cd $dir
  set tempList [glob -nocomplain *]
  foreach item $tempList {
      if [ file isdirectory &#34;$item/Report&#34; ] {
           lappend dirList $item
      }
  }
  set dirList [lsort $dirList]
  return $dirList
}

<span class="comment-line">#****************************************************************</span>
<span class="comment-line"># Main code segment</span>
<span class="comment-line">#***************************************************************</span>
source ../main/mainLib.tcl

<a name="::::gen_index(1)"><a href="./summarize.tcl.html#::::gen_index_76">::::gen_index</a></a> &#34;./../Lib&#34;

set LIB_PATH ../Lib
lappend auto_path $LIB_PATH


if { $argc&lt;1 } {
      <a name="::printUsage(1)"><a href="./initialRun.tcl.html#::printUsage_18">::printUsage</a></a>
      exit
}

if { [lsearch $argv &#34;-help&#34;] &gt; -1} {
      <a name="::printUsage(2)"><a href="./initialRun.tcl.html#::printUsage_18">::printUsage</a></a>
      exit
}

if { [lsearch $argv &#34;?&#34;] &gt; -1} {
      <a name="::printUsage(3)"><a href="./initialRun.tcl.html#::printUsage_18">::printUsage</a></a>
      exit
}


if { ![ file isdirectory $reportDir ] } {
     exec mkdir $reportDir
} else {
     cd $reportDir
     exec rm -rf *
}

set build [lindex $argv 0] 
set buildName [getBuildNumber $build]
if { $buildName == 0 } {
    puts &#34;ERROR: Wrong build name. Build name Ex.711b16 is required!!&#34;
    exit
}

cd $rootDir
set totalCount 0
foreach regType $regList {
    if { ![ file isdirectory $regType ] } {
       continue
    }
    puts &#34;Processing....RegType: $regType&#34;
    
    set fd [open &#34;$reportDir/$regType.txt&#34; w]

    <a name="::printHeader(1)"><a href="./initialRun.tcl.html#::printHeader_88">::printHeader</a></a> $regType $fd

    set rCount 0; <span class="comment-line"># Count for the regression type</span>

    if { $regType == &#34;CLItest&#34; } {
        cd &#34;$regType/uploadanddownload&#34;
    } else {
       cd $regType
    }

    set curDir [pwd] 
    set moduleDirs [ <a name="::getSubDirs(1)"><a href="./initialRun.tcl.html#::getSubDirs_186">::getSubDirs</a></a> $curDir ]
    
    foreach mdir $moduleDirs { 
           puts &#34;Processing....$mdir&#34;
           set repDir &#34;$mdir/Report&#34;
           cd  $repDir 
           set dirList &#34;&#34;
           foreach bdir [glob -nocomplain *] {
               if { [regexp &#34;.* *$buildName *0&#34; $bdir] == 1} {
                      lappend dirList $bdir
                 }
           }

           <span class="comment-line">#Take out the dirs with ABORT case from the list</span>
	   <span class="comment-line"># in case of ABORT there will be only one file.</span>
           set targetDirList &#34;&#34;
           foreach tdir $dirList {
              cd $tdir
              set flist [glob -nocomplain *]
              if { [llength $flist] &gt; 1 } { <span class="comment-line">#This is not ABORT case</span>
                   lappend targetDirList $tdir
              }
              cd ..
           }
           set numofDirs [llength $targetDirList]
           if { $numofDirs == 0 } {
                   puts &#34;No dir for report.txt found&#34;
                   cd ../.. 
                   puts &#34;pwd = [pwd]&#34;
                   continue
            }
           set targetDirList [lsort $targetDirList] ; <span class="comment-line">#sorted list</span>
           set buildDir [lindex $targetDirList 0]
           cd $buildDir
           puts &#34;buildDir for report.txt : $buildDir&#34;
           set pwd [ pwd ]
           if [file exists &#34;$pwd/report.txt&#34;] {
                 set mCount [<a name="::getNumberOfTestCases(1)"><a href="./initialRun.tcl.html#::getNumberOfTestCases_34">::getNumberOfTestCases</a></a> $mdir $pwd]  
                 <a name="::printModule(1)"><a href="./initialRun.tcl.html#::printModule_130">::printModule</a></a> $mdir $mCount $fd
                 incr rCount $mCount 
            }
            unset dirList 
            cd ../../..
    }
    puts &#34;\nTOTAL NUMBER OF TEST CASES FOR [string toupper $regType]=$rCount&#34;
    <a name="::printTotal(1)"><a href="./initialRun.tcl.html#::printTotal_151">::printTotal</a></a> $regType $rCount $fd
    incr totalCount $rCount
    if { $regType == &#34;CLItest&#34; } {
         cd ../..
     } else {
        cd ..
     }
    close $fd
}
puts &#34;\ninitalRun is DONE. Please run finalRun.tcl to get the final report.\n&#34;

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
