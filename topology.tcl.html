<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>topology.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#topology.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>topology.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="topology.tcl-annot.html">annotations</a> | <a href="topology.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SkipOnTopologyError   </span>
<span class="comment-line"># Description:  Any series of seperate test scripts based on one </span>
<span class="comment-line">#   common init file must reference  a global topology verification </span>
<span class="comment-line">#   flag to see whether the test should run or not.  In this case </span>
<span class="comment-line">#   topology2 is set to zero if the verification tests above fail.</span>
<span class="comment-line">#   SkipOnTopologyError $DUTs_info(topology2) $testNo $time1 is called </span>
<span class="comment-line">#   at the top of every case that uses this topology and exits in </span>
<span class="comment-line">#   the case of a 0 value. THIS IS DONE so the failed cases are </span>
<span class="comment-line">#   uploaded to the database for rerun.</span>
<span class="comment-line">#      </span>
<span class="comment-line"># Input args: status &lt;= 0 | 1 system topology verification status</span>
<span class="comment-line">#             testNo &lt;= test case numbers</span>
<span class="comment-line">#             time1  &lt;= time of test case start</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	SkipOnTopologyError $DUTs_info(topology2) $testNo $time1      </span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SkipOnTopologyError_22">proc <a href="topology.tcl-annot.html#::::SkipOnTopologyError">::::SkipOnTopologyError</a></a></strong><a name="::::SkipOnTopologyError"></a> {topology testNo time1} {
    global DUTs_info
    if { ![info exists DUTs_info($topology)] || !$DUTs_info($topology) } {
        <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Skipped $testNo : Topology Verification Failed or Setup not run&#34;
        result_skip &#34;Skipped $testNo : Topology Verification Failed or Setup not run&#34;
        <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        set time2 [clock seconds]
        result_p &#34;Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
        <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
        <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        return -code return  
    }
}

<strong><a name="::::CreateTopologyDiagram_36">proc <a href="topology.tcl-annot.html#::::CreateTopologyDiagram">::::CreateTopologyDiagram</a></a></strong><a name="::::CreateTopologyDiagram"></a> { } {
    global CURRENT_EX_RESULT_FILENAME

    <span class="comment-line"># First find out if result file is complete...</span>
    catch {exec grep &#34;Time for .* = .* sec&#34; $CURRENT_EX_RESULT_FILENAME} endLineFound
    if { ![regexp &#34;Time for .* = .* sec&#34; $endLineFound] } {
	return
    }

    set logfileStr [<a name="::::GetLogfileStr(1)"><a href="./topology.tcl.html#::::GetLogfileStr_62">::::GetLogfileStr</a></a> $CURRENT_EX_RESULT_FILENAME]
    <span class="comment-line">#puts &#34;\nlogfileStr=$logfileStr&#34;</span>

    set INFOLines [<a name="::::GetInfoLines(1)"><a href="./topology.tcl.html#::::GetInfoLines_120">::::GetInfoLines</a></a> $logfileStr]

    set DUTsUsed [<a name="::::GetDUTsUsed(1)"><a href="./topology.tcl.html#::::GetDUTsUsed_103">::::GetDUTsUsed</a></a> $INFOLines]

    if { [llength $DUTsUsed] == 0 } {
	puts &#34;No DUT's used in the test [lindex [split $CURRENT_EX_RESULT_FILENAME &#34;/&#34;] end]. Topology diagram not created.&#34;
	return
    }

    puts &#34;\nDUTsUsed='$DUTsUsed'&#34;
    puts &#34;\nINFOLines='$INFOLines'&#34;

}

<strong><a name="::::GetLogfileStr_62">proc <a href="topology.tcl-annot.html#::::GetLogfileStr">::::GetLogfileStr</a></a></strong><a name="::::GetLogfileStr"></a> { logfilename } {

    set logfileStr &#34;&#34;
    set fd [open $logfilename &#34;r&#34;]
    set logfileStr &#34;&#34;
    while { ![eof $fd] } {
	gets $fd line
	if { [string length [string trim $line]] &gt; 0 } {
	    lappend logfileStr [string trim $line]
	}
    }
    close $fd

    return [<a name="::::GetUsableLogfileStr(1)"><a href="./topology.tcl.html#::::GetUsableLogfileStr_78">::::GetUsableLogfileStr</a></a> $logfileStr]
}

<strong><a name="::::GetUsableLogfileStr_78">proc <a href="topology.tcl-annot.html#::::GetUsableLogfileStr">::::GetUsableLogfileStr</a></a></strong><a name="::::GetUsableLogfileStr"></a> { logfileStr } {

    set stopFlag &#34;COMPLETED_TOPOLOGY_DIAGRAM_CHECK&#34;

    if { ![regexp $stopFlag $logfileStr] } {
	set stopFlag &#34;!!!!!.*!!!!!|\\(\\(\\(\\(\\(.*\\)\\)\\)\\)\\)&#34;
    }

    set newStr &#34;&#34;

    foreach line $logfileStr {
	if { [regexp $stopFlag $line] } {
	    break
	}
	lappend newStr $line
    }

    return $newStr

}

<strong><a name="::::StopTopologyDiagram_99">proc <a href="topology.tcl-annot.html#::::StopTopologyDiagram">::::StopTopologyDiagram</a></a></strong><a name="::::StopTopologyDiagram"></a> { } {
    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;COMPLETED_TOPOLOGY_DIAGRAM_CHECK&#34;
}

<strong><a name="::::GetDUTsUsed_103">proc <a href="topology.tcl-annot.html#::::GetDUTsUsed">::::GetDUTsUsed</a></a></strong><a name="::::GetDUTsUsed"></a> { infoLines } {

    set DUTsUsed &#34;&#34;
    foreach item $infoLines {
	set first [lindex $item 0]
	set second [lindex $item 3]
	if { ![regexp $first $DUTsUsed] } {
	    lappend DUTsUsed $first
	}
	if { ![regexp $second $DUTsUsed] } {
	    lappend DUTsUsed $second
	}
    }

    return [lsort $DUTsUsed]
}

<strong><a name="::::GetInfoLines_120">proc <a href="topology.tcl-annot.html#::::GetInfoLines">::::GetInfoLines</a></a></strong><a name="::::GetInfoLines"></a> { str } {

    set infoLines &#34;&#34;
    foreach line $str {
	if { [regexp &#34;INFO: DUT.* goes to&#34; $line] } {
	    set startdut [lindex $line 1]
	    set startport [lindex $line 2]
	    set enddut [lindex $line 5]
	    if { $enddut == &#34;portId&#34; } {
		set enddut &#34;IXIA&#34;
	    }
	    if { $enddut == &#34;DUT0&#34; } {
		set enddut &#34;HUB&#34;
	    }
	    set endport [lindex $line 6]
	    set tempLine [string trim &#34;$startdut $startport === $enddut $endport&#34;]
	    if { [lsearch $infoLines $tempLine] == -1 } {
		lappend infoLines $tempLine
	    }
	}
    }
    return [lsort [<a name="::::GetUniqueInfoItems(1)"><a href="./topology.tcl.html#::::GetUniqueInfoItems_144">::::GetUniqueInfoItems</a></a> &#34;$infoLines&#34;]]
}

<strong><a name="::::GetUniqueInfoItems_144">proc <a href="topology.tcl-annot.html#::::GetUniqueInfoItems">::::GetUniqueInfoItems</a></a></strong><a name="::::GetUniqueInfoItems"></a> { infoLines } {

    set reverseInfoLines &#34;&#34;
    foreach item $infoLines {
	lappend reverseInfoLines &#34;[lrange $item 3 end] === [lrange $item 0 1]&#34;
    }

    set newList $infoLines
    foreach OrigItem $infoLines {
	foreach ReverseItem $reverseInfoLines {
	    if { $OrigItem == $ReverseItem } {
		set newList [<a name="::ldelete(1)"><a href="./misc.tcl.html#::ldelete_3310">::ldelete</a></a> &#34;$infoLines&#34; &#34;$ReverseItem&#34;]
	    }
	}
    }
    return &#34;$newList&#34;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: generateTopologyFile</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#        Generate the topology drawing using information in portMappingList</span>
<span class="comment-line">#        and cfg file</span>
<span class="comment-line"># Input args: output file name</span>
<span class="comment-line">#             cfg file name</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#        generateTopologyFile &#34;[get_result_dir]/topology.txt&#34;</span>
<span class="comment-line"># Category: Topology</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::generateTopologyFile_176">proc <a href="topology.tcl-annot.html#::::generateTopologyFile">::::generateTopologyFile</a></a></strong><a name="::::generateTopologyFile"></a> { file cfg } {
global portMappingList
global switchPort2DefaultRouter
global dutDosPort
global topology
global SERVER1
global SERVER2
global bootpserver
global ixiaCh1
global testVendorName
global TrafficGen

<span class="comment-line"># create variables to hold tester name and IP, that is the same char length for each name</span>
<span class="comment-line"># - create variable name same length as largest tester name length (-1 for '$'),</span>
<span class="comment-line">#   so we can insert in diagram below, and keep formatting</span>
set tName_ &#34;NONE   &#34;
switch -exact -- $TrafficGen {
    agilent {
        set tName_ &#34;AGILENT&#34;
        set tLegend &#34;For AGILENT port:   Port_id Card/Port&#34;
    }
    stc {
        set tName_ &#34;TestCenter   &#34;
        set tLegend &#34;For TestCenter port:      Port_id Slot:Port&#34;
    }
    ixia {
        set tName_ &#34;IXIA   &#34;
        set tLegend &#34;For IXIA port:      Port_id Slot:Port&#34;
    }
    ept {
    }
    none {
        set tName_ &#34;None&#34;
        set tLegend &#34;For    port:   Port_id Card/Port&#34;
    }
    default {
        set tName_ &#34;None&#34;
        set tLegend &#34;For    port:   Port_id Card/Port&#34;
    }
}
<span class="comment-line">#the ports in the initial drawing are specified with the following syntax:</span>
<span class="comment-line"># &lt;from_DUT:to_DUT:trunk#&gt; e.g. the port in DUT1 for the first trunk </span>
<span class="comment-line"># connecting to DUT2  is &lt;1:2:1&gt; </span>
<span class="comment-line"># X is for Tester (AGILENT|IXIA)  and 0 is for a hub.</span>
<span class="comment-line"># These ports are then replaced with port numbers actually learned.</span>
set iprTopology &#34;
                        Testbed Topology for $cfg

                           +-------------------+
                           |            &lt;X:5:2&gt;|----------------------------+
                           |            &lt;X:5:1&gt;|---------------------------+|
                network---| &lt;tIpAddr________&gt;  |                        ||
 +------------------------|&lt;X:3:2&gt;$tName_ &lt;X:4:2&gt;|----------------------+ ||
 |+------------------------|&lt;X:3:1&gt;     &lt;X:4:1&gt;|------------------------+| ||
 ||                        |                   |                        || ||
 ||       +----------------|&lt;X:1:1&gt;     &lt;X:2:2&gt;|--------------+         || ||
 ||       |            +---|&lt;X:1:2&gt;     &lt;X:2:1&gt;|-+            |         || ||
 ||       |            |   |    &lt;X:0:1&gt;        | |            |         || ||
 ||       |            |   +-------------------+ |            |         || ||
 ||       |            |              |          |            |         || ||
 ||      +------------------+         |         +------------------+    || ||
 ||      |&lt;1:X:1&gt;&lt;1:X:2&gt;    |         |         |&lt;2:X:1&gt;&lt;2:X:2&gt;    |    || ||
 ||      |           &lt;1:NET&gt;|-network | network-|&lt;2:NET&gt;           |    || ||
 ||      | &lt;DUT1_IP________&gt;|         |         |&lt;DUT2_IP________&gt; |    || ||
 ||      |                  |         |         |                  |    || ||
 ||      |           &lt;1:2:1&gt;|---------|---------|&lt;2:1:1&gt;           |    || ||
 ||   +--|&lt;1:5:1&gt;    &lt;1:2:2&gt;|---------|---------|&lt;2:1:2&gt;    &lt;2:5:1&gt;|--+ || ||
 ||   |+-|&lt;1:5:2&gt;    &lt;1:2:3&gt;|---------|---------|&lt;2:1:3&gt;    &lt;2:5:2&gt;|-+| || ||
 ||   || | &lt;DUT1_CONNECT___&gt;|-console | console-|&lt;DUT2_CONNECT___&gt; | || || ||
 ||   || |     DUT1  &lt;1:4:1&gt;|--+      |      +--|&lt;2:3:1&gt;DUT2       | || || ||
 ||   || |           &lt;1:4:2&gt;|-+|      |      |+-|&lt;2:3:2&gt;           | || || ||
 ||   || |                  | ||      |      || |                  | || || ||
 ||   || |           &lt;1:0:1&gt;|------+  |  +------|&lt;2:0:1&gt;           | || || ||
 ||   || |&lt;1:3:1&gt;&lt;1:3:2&gt;    | ||   |  |  |   || |    &lt;2:4:1&gt;&lt;2:4:2&gt;| || || ||
 ||   || +------------------+ ||   |  |  |   || +------------------+ || || ||
 ||   ||  |            |      ||   +-----+   ||            |      |  || || ||
 ||   ||  |            |      ||   | hub |   ||            |      |  || || ||
 ||   ||  |            |      ||   +-----+   ||            |      |  || || ||
 ||   || +------------------+ ||   |  |  |   || +------------------+ || || ||
 ||   || |&lt;3:1:1&gt;&lt;3:1:2&gt;    | ||   |  |  |   || |    &lt;4:2:1&gt;&lt;4:2:2&gt;| || || ||
 ||   || |           &lt;3:0:1&gt;|------+  |  +------|&lt;4:0:1&gt;           | || || ||
 ||   || |                  | ||      |      || |                  | || || ||
 ||   || |                  | |+------|---------|&lt;4:1:1&gt;           | || || ||
 ||   || |                  | +-------|---------|&lt;4:1:2&gt;           | || || ||
 ||   || |                  |         |      || |                  | || || ||
 ||   || |           &lt;3:2:1&gt;|---------|------+| |                  | || || ||
 ||   || |     DUT3  &lt;3:2:2&gt;|---------|-------+ |      DUT4        | || || ||
 ||   || | &lt;DUT3_CONNECT___&gt;|-console | console-|&lt;DUT4_CONNECT___&gt; | || || ||
 ||   || |           &lt;3:NET&gt;|-network | network-|&lt;4:NET&gt;           | || || ||
 ||   || | &lt;DUT3_IP________&gt;|         |         |&lt;DUT4_IP________&gt; | || || ||
 ||   || |                  |         |         |                  | || || ||
 |+---||-|&lt;3:X:1&gt;    &lt;3:4:1&gt;|---------|---------|&lt;4:3:1&gt;    &lt;4:X:1&gt;|-||-+| ||
 +----||-|&lt;3:X:2&gt;    &lt;3:4:2&gt;|---------|---------|&lt;4:3:2&gt;    &lt;4:X:2&gt;|-||--+ ||
      || |&lt;3:5:1&gt;&lt;3:5:2&gt;    |         |         |&lt;4:5:1&gt; &lt;4:5:2&gt;   | ||    ||
      || +------------------+         |         +------------------+ ||    ||
      ||  |            |              |          |             |     ||    ||
      ||  |            |  +--------------------+ |             |     ||    ||
      ||  |            |  |     &lt;5:0:1&gt;        | |             |     ||    ||
      ||  |            +--|&lt;5:3:2&gt;      &lt;5:4:1&gt;|-+             |     ||    ||
      ||  +---------------|&lt;5:3:1&gt;      &lt;5:4:2&gt;|---------------+     ||    ||
      ||                  |        DUT5        |                     ||    ||
      ||        console---|&lt;DUT5_CONNECT___&gt;   |                     ||    ||
      |+------------------|&lt;5:1:2&gt;      &lt;5:2:2&gt;|---------------------+|    ||
      +-------------------|&lt;5:1:1&gt;      &lt;5:2:1&gt;|----------------------+    ||
                          |                    |                           ||
                          |             &lt;5:X:1&gt;|---------------------------+|
               network----|&lt;5:NET&gt;      &lt;5:X:2&gt;|----------------------------+
                          |&lt;DUT5_IP________&gt;   |
                          +--------------------+
Legend: 
${tLegend}
For DUT port: Slot:Port 
   &#34;
set standardTopology &#34;
                     Testbed Topology for $cfg

              +-----------------+
              | RADIUS/TACACS(p)|
  network ----|&lt;SERVER1________&gt;|
              +-----------------+
              +-----------------+
              | RADIUS/TACACS(s)|
  network ----|&lt;SERVER2________&gt;|
              +-----------------+
              +-----------------+
              | DHCP            |
  network ----|&lt;bootpserver____&gt;|
              +-----------------+


        +-----------------+                +-----------------+ 
network-|&lt;1:NET&gt;          |                |                 |
        |&lt;DUT1_IP________&gt;|                |                 |
  DOS---|&lt;1:DOS&gt;   &lt;1:X:1&gt;|----------------|&lt;X:1:1&gt;          |
        |          &lt;1:X:2&gt;|----------------|&lt;X:1:2&gt;          |
        |          &lt;1:X:3&gt;|----------------|&lt;X:1:3&gt;          |
        |          &lt;1:X:4&gt;|----------------|&lt;X:1:4&gt;          |
        |          &lt;1:X:5&gt;|----------------|&lt;X:1:5&gt;          |
        |          &lt;1:X:6&gt;|----------------|&lt;X:1:6&gt;          |
        |          &lt;1:X:7&gt;|----------------|&lt;X:1:7&gt;          |
        |          &lt;1:X:8&gt;|----------------|&lt;X:1:8&gt;          |
        |          &lt;1:X:9&gt;|----------------|&lt;X:1:9&gt;          |
        |         &lt;1:X:10&gt;|----------------|&lt;X:1:10&gt;         |
        |         &lt;1:X:11&gt;|----------------|&lt;X:1:11&gt;         |
        |         &lt;1:X:12&gt;|----------------|&lt;X:1:12&gt;         |
        |     DUT1        |                |                 |
console-|&lt;DUT1_CONNECT___&gt;|                |                 |
        |         &lt;1:X:13&gt;|----------------|&lt;X:1:13&gt;         |
        |         &lt;1:X:14&gt;|----------------|&lt;X:1:14&gt;         |
        |         &lt;1:X:15&gt;|----------------|&lt;X:1:15&gt;         |
        |         &lt;1:X:16&gt;|----------------|&lt;X:1:16&gt;         |
        |         &lt;1:X:17&gt;|----------------|&lt;X:1:17&gt;         |
        |         &lt;1:X:18&gt;|----------------|&lt;X:1:18&gt;         |
        |         &lt;1:X:19&gt;|----------------|&lt;X:1:19&gt;         |
        |         &lt;1:X:20&gt;|----------------|&lt;X:1:20&gt;         |
        |         &lt;1:X:21&gt;|----------------|&lt;X:1:21&gt;         |
        |         &lt;1:X:22&gt;|----------------|&lt;X:1:22&gt;         |
        |         &lt;1:X:23&gt;|----------------|&lt;X:1:23&gt;         |
        |         &lt;1:X:24&gt;|----------------|&lt;X:1:24&gt;         |
        |                 |                |                 |
        |&lt;1:2:1&gt;&lt;1:2:2&gt;   |                |     $tName_     |
        +-----------------+                |                 |
         |            |         network----|&lt;tIpAddr________&gt;|
         |            |                    |                 |
         |            |                    |                 |
        +-----------------+                |                 | 
        |&lt;2:1:1&gt;&lt;2:1:2&gt;   |                |                 |
        |                 |                |                 |
        |          &lt;2:X:1&gt;|----------------|&lt;X:2:1&gt;          |
        |    DUT2  &lt;2:X:2&gt;|----------------|&lt;X:2:2&gt;          |
console-|&lt;DUT2_CONNECT___&gt;|                |                 |
        |          &lt;2:X:3&gt;|----------------|&lt;X:2:3&gt;          |
network-|&lt;2:NET&gt;   &lt;2:X:4&gt;|----------------|&lt;X:2:4&gt;          |
        |&lt;DUT2_IP________&gt;|                |                 |
        +-----------------+                +-----------------+ 
       
Legend: 
${tLegend}
For DUT port: Slot:Port 
&#34;
   <span class="comment-line">#count number of DUTs</span>
   set dutCount 0
   for {set i 1} {$i &lt;= 6} {incr i } {
       global DUT${i}_CONNECT
       if ![info exist DUT${i}_CONNECT ] {
          break
       }
       incr dutCount
   }
   switch $dutCount {
      1 { return }
      2 {
         set topologyType standard
         set topology $standardTopology
      }
      4 -
      5 {
         set topologyType ipr
         set topology $iprTopology
      }
      default { 
         <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Generating Topology Drawing.&#34;
         <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$dutCount DUTs detected. Expecting 1,2,4 or 5.&#34;
         <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         return
      }
   }
   for { set dut 1} {$dut &lt;= $dutCount } {incr dut} {
      <span class="comment-line">#print the network port and address</span>
      <a name="::::printPort(1)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> $dut:NET [<a name="::GetDUTPort(1)"><a href="./ePTPortMapping.tcl.html#::GetDUTPort_78">::GetDUTPort</a></a> $switchPort2DefaultRouter $dut ] topology
      global DUT${dut}_IP
      <a name="::::printPort(2)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> DUT${dut}_IP________ [set DUT${dut}_IP] topology
      <span class="comment-line">#console address</span>
      <a name="::::printPort(3)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> DUT${dut}_CONNECT___ [set DUT${dut}_CONNECT] topology
      
   }

   <span class="comment-line"># tester IP address</span>
    switch -exact -- $TrafficGen {
        agilent {
            <a name="::::printPort(4)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> tIpAddr________ [::AgtExtreme::GetN2xServerName] topology
        }
        stc {
        }
        ixia {
            <a name="::::printPort(5)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> tIpAddr________ $ixiaCh1 topology
        }
        ept {
        }
        default {
        }
    }

   <span class="comment-line">#for each trunk fill in ports on both sides of the trunk</span>
   for { set firstSw 1} {$firstSw &lt;= [expr $dutCount - 1] } {incr firstSw} {
      for {set secondSw [expr $firstSw + 1] } {$secondSw &lt;= $dutCount} \
         {incr secondSw} {
         set trunk 1
         foreach trunkport [<a name="::::GetTrunkPortList(1)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a> $firstSw $secondSw] {
            <a name="::::printPort(6)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> $firstSw:$secondSw:$trunk $trunkport topology 
            incr trunk
         }
         set trunk 1
         foreach trunkport [<a name="::::GetTrunkPortList(2)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a>  $secondSw $firstSw] {
            <a name="::::printPort(7)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> $secondSw:$firstSw:$trunk $trunkport topology 
            incr trunk
         }
      }
   }
   <span class="comment-line">#standard testbed specific ports</span>
   if { $topologyType == &#34;standard&#34; } {
      <span class="comment-line">#print the DOS ports </span>
      if {[info exist dutDosPort(1)]} {
         <a name="::::printPort(8)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> 1:DOS $dutDosPort(1) topology
      }
      <span class="comment-line">#print the Radius and Tacacs</span>
      if {[info exist SERVER1 ]} {
         <a name="::::printPort(9)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> SERVER1________ $SERVER1 topology
      }
      if {[info exist SERVER2 ]} {
         <a name="::::printPort(10)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> SERVER2________ $SERVER2 topology
      }
      <span class="comment-line">#print the DHCP server</span>
      if {[info exist bootpserver ]} {
         <a name="::::printPort(11)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> bootpserver____ $bootpserver topology
      }
   }
   <span class="comment-line">#ipr testbed specific ports</span>
   if { $topologyType == &#34;ipr&#34; } {
      <span class="comment-line"># For IPR topology only:</span>
      <span class="comment-line"># note that in the portMappingList the tester port connecting to the</span>
      <span class="comment-line"># hub will have multiple mappings to list all DUT on that hub. See </span>
      <span class="comment-line"># the following example portMappingList where port 9 is connected </span>
      <span class="comment-line"># to the hub.</span>
      <span class="comment-line">#{&#34;1 8:85 1&#34; &#34;2 8:86 1&#34;  &#34;3 1:1 2&#34; &#34;4 1:2 2&#34;   &#34;5 1 3&#34; &#34;6 2 3&#34;  &#34;7 1 4&#34;</span>
      <span class="comment-line"># &#34;8 2 4&#34;  &#34;9 8:3 1&#34; &#34;9 1:3 2&#34; &#34;9 3 3&#34; &#34;9 3 4&#34; &#34;9 3 5&#34;  &#34;10 1 5&#34; &#34;11 2 5&#34;}</span>
      <span class="comment-line">#</span>
      <span class="comment-line">#Another way to specify a hub is to have 0 as the DUT in the mapping. See</span>
      <span class="comment-line">#port 9 in the following example.</span>
      <span class="comment-line">#set portMappingList { &#34;1 10 1&#34; &#34;2 11 1&#34; &#34;3 1 2&#34; &#34;4 3 2&#34; \</span>
      <span class="comment-line">#                   &#34;5 2:1 3&#34; &#34;6 2:2 3&#34; &#34;7 6:1 4&#34; &#34;8 4:75 4&#34; \</span>
      <span class="comment-line">#                   &#34;9 0 0&#34; &#34;10 1:2 5&#34; &#34;11 1:4 5&#34;}</span>


      <span class="comment-line">#find the tester port that is connected to the hub. It's the one listed</span>
      <span class="comment-line">#multiple times in portMappingList or have 0 as the DUT.</span>
      foreach map $portMappingList {
         set testerPort [lindex $map 0]
         set dut [lindex $map 2]
         if {[info exist seen($testerPort)] || $dut == 0 } {
            set testerHubPort $testerPort
            break
         } 
         set seen($testerPort) 1
      }

      <span class="comment-line"># print tester-hub connections</span>
      switch -exact -- $TrafficGen {
          agilent {
              set n2xPortName [::AgtExtreme::GetN2xPortNameByPortId -portid $testerHubPort]
              <a name="::::printPort(12)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> X:0:1 &#34;$testerHubPort $n2xPortName&#34; topology
          }
          stc {
          }
          ixia {
              <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $testerHubPort chasis card port
              <a name="::::printPort(13)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> X:0:1 &#34;$testerHubPort $card:$port&#34; topology
          }
          ept {
          }
          default {
          }
      }


      <span class="comment-line">#print the ports for the hub to DUT trunk</span>
      for { set dut 1} {$dut &lt;= $dutCount } {incr dut} {
         <a name="::::printPort(14)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> $dut:0:1 [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $dut 0 1] topology
      }
   }
   for {set dut 1} {$dut &lt;= $dutCount } {incr dut} {
      set testerConnection($dut) 1
   }

    <span class="comment-line"># print DUT &lt;-&gt; Tester connections</span>
   foreach map $portMappingList {
        set testerPort [lindex $map 0]
        <span class="comment-line"># note that testerHubPort exist only in ipr topology</span>
        if { $topologyType == &#34;ipr&#34; &amp;&amp; $testerPort == $testerHubPort } {
            <span class="comment-line"># skip hub ports. we only print Tester to DUT connections here</span>
         continue
      }
      set dutPort [lindex $map 1]
        set dut     [lindex $map 2]
        switch -exact -- $TrafficGen {
            agilent {
                set n2xPortName [::AgtExtreme::GetN2xPortNameByPortId -portid $testerPort]
                <a name="::::printPort(15)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> X:$dut:$testerConnection($dut) &#34;$testerPort $n2xPortName&#34; topology
                <a name="::::printPort(16)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> $dut:X:$testerConnection($dut) $dutPort topology
            }
            stc {
            }
            ixia {
                <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $testerPort chasis card port
                <a name="::::printPort(17)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> X:$dut:$testerConnection($dut) &#34;$testerPort $card:$port&#34; topology
                <a name="::::printPort(18)"><a href="./topology.tcl.html#::::printPort_563">::::printPort</a></a> $dut:X:$testerConnection($dut) $dutPort topology
            }
            ept {
            }
            default {
            }
        }
        <span class="comment-line"># keep track of how many Tester connections we seen so far for the dut</span>
        incr testerConnection($dut)
    }

   <span class="comment-line">#print N/A for ports in drawing but not found in cfg</span>
   <a name="::::printNAPort(1)"><a href="./topology.tcl.html#::::printNAPort_599">::::printNAPort</a></a> topology
   <span class="comment-line">#for standard topology remove the connection lines for N/A ports</span>
   if { $topologyType == &#34;standard&#34; } {
       regsub -all &#34;N/A\\|----------------\\|N/A&#34; $topology \
          &#34;   |                |   &#34; topology
   }
   <span class="comment-line">#puts $topology</span>

   <span class="comment-line">#write the topology to the file</span>
   set fd [open $file &#34;w&#34;]
   puts $fd $topology
   close $fd
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: PrintPort</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#        In the topology drawing, look for a string inside the &lt; &gt; brackets</span>
<span class="comment-line">#        and replace it with another string. Perform necessary formatting</span>
<span class="comment-line"># Input args: portTuple - the string to look for</span>
<span class="comment-line">#                </span>
<span class="comment-line">#             port - replace the portTuple with this string</span>
<span class="comment-line">#             topology - the topology drawing </span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         printPort $dut:0:1 [GetATrunkPort $dut 0 1] topology</span>
<span class="comment-line">#        </span>
<span class="comment-line"># Category: Topology</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::printPort_563">proc <a href="topology.tcl-annot.html#::::printPort">::::printPort</a></a></strong><a name="::::printPort"></a> { portTuple port topology } {
   upvar $topology top
   <span class="comment-line">#find the fieldWidth of the portTuple</span>
   if [regexp &lt;$portTuple&gt; $top match ] {
      set fieldWidth [ string length $match ]
   } else {
      <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;   Generating Topology Drawing.&#34;
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Unable to draw port $portTuple in drawing.&#34;
      <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Please recheck portMappingList&#34;
      <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return
   }
      
   <span class="comment-line">#left adjusted if the portTuple is on left side of the DUT drawing</span>
   if ![regsub &#34;\\|&lt;$portTuple&gt;&#34; $top &#34;|[format &#34;%-${fieldWidth}s&#34; $port]&#34; \
      top] {
      <span class="comment-line">#else right adjusted</span>
      regsub &lt;$portTuple&gt; $top [format &#34;%${fieldWidth}s&#34; $port] top
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: printNAPort</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#        In the topology drawing, look for any string inside the &lt; &gt; brackets</span>
<span class="comment-line">#        and replace it with &#34;N/A&#34;. Perform necessary formatting. This procedure</span>
<span class="comment-line">#        is used to specify ports in the drawing not found in the actual</span>
<span class="comment-line">#        topology.</span>
<span class="comment-line"># Input args: topology - the topology drawing </span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          printNAPort topology</span>
<span class="comment-line"># Category: Topology</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::printNAPort_599">proc <a href="topology.tcl-annot.html#::::printNAPort">::::printNAPort</a></a></strong><a name="::::printNAPort"></a> { topology } {
   upvar $topology top
   <span class="comment-line">#use while loop to regsub one at a time since field width can be </span>
   <span class="comment-line">#different for each portTuple</span>
   while {[regexp {&lt;[^&gt;]*&gt;} $top ]} {
      <span class="comment-line">#left adjusted if the first match is on left side of the DUT drawing</span>
      if [regexp &#34;\\|&lt;\[^&gt;]*&gt;&#34; $top match ] {
         set fieldWidth [ string length $match ]
         regsub &#34;\\|&lt;\[^&gt;]*&gt;&#34; $top &#34;[format &#34;%-${fieldWidth}s&#34; &#34;|N/A&#34; ]&#34; top
      } else {
         <span class="comment-line">#else right adjusted</span>
         regexp {&lt;[^&gt;]*&gt;} $top match
         set fieldWidth [ string length $match ]
         regsub {&lt;[^&gt;]*&gt;} $top [format &#34;%${fieldWidth}s&#34; N/A] top
      }
   } 
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
