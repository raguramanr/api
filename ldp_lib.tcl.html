<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ldp_lib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ldp_lib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ldp_lib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ldp_lib.tcl-annot.html">annotations</a> | <a href="ldp_lib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyMpls</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies enable/disable MPLS and LDP </span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             status - enable or disable, default is enable </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     VerifyMpls  </span>
<span class="comment-line">#     VerifyMpls -status disable </span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyMpls_14">proc <a href="ldp_lib.tcl-annot.html#::::VerifyMpls">::::VerifyMpls</a></a></strong> { args } {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyMpls $args {
      testNo &#34;&#34;
      status &#34;enable&#34;
   } 

   global whichDutNow

   if {$status == &#34;disable&#34;} {
      lappend parameterList &#34;{MPLS Admin Status.*Disabled} exist&#34;
      lappend parameterList &#34;{MPLS Oper Status.*Disabled} exist&#34;
      lappend parameterList &#34;{LDP Admin Status.*Disabled} exist&#34;
      lappend parameterList &#34;{LDP Oper Status.*Disabled} exist&#34;
      <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls&#34; $parameterList -testNo $testNo -comment &#34;- check mpls and ldp status&#34; 
      unset parameterList
   } else {
      lappend parameterList &#34;{MPLS Admin Status.*Enabled} exist&#34;
      lappend parameterList &#34;{MPLS Oper Status.*Enabled} exist&#34;
      lappend parameterList &#34;{LDP Admin Status.*Enabled} exist&#34;
      lappend parameterList &#34;{LDP Oper Status.*Enabled} exist&#34;
      <a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls&#34; $parameterList -testNo $testNo -comment &#34;- check mpls and ldp status on DUT$whichDutNow&#34; 
      unset parameterList
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyMplsLdp</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show mpls ldp&#34; </span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             status - enable or disable, default is enable </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     VerifyMplsLdp  </span>
<span class="comment-line">#     VerifyMplsLdp -status disable </span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyMplsLdp_52">proc <a href="ldp_lib.tcl-annot.html#::::VerifyMplsLdp">::::VerifyMplsLdp</a></a></strong> { args } {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyMplsLdp $args {
      testNo &#34;&#34;
      status &#34;enable&#34;
   } 

   global whichDutNow

   if {$status == &#34;disable&#34;} {
      lappend parameterList &#34;{LDP Admin Status.*Disabled} exist&#34;
      lappend parameterList &#34;{LDP Oper Status.*Disabled} exist&#34;
      <a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls ldp&#34; $parameterList -comment &#34;- show mpls&#34; -testNo $testNo
      unset parameterList
   } else {
      lappend parameterList &#34;{LDP Admin Status.*Enabled} exist&#34;
      lappend parameterList &#34;{LDP Oper Status.*Enabled} exist&#34;
      <a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls ldp&#34; $parameterList -testNo $testNo -comment &#34;- check mpls ldp on DUT$whichDutNow&#34;
      unset parameterList
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyMplsLdpIntOp</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show mpls ldp interface&#34; </span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             vlanList - List of vlans </span>
<span class="comment-line">#             flags - M,L and U </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     VerifyMplsLdpIntOp -vlanList &#34;trunk12_1&#34;  </span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyMplsLdpIntOp_86">proc <a href="ldp_lib.tcl-annot.html#::::VerifyMplsLdpIntOp">::::VerifyMplsLdpIntOp</a></a></strong> { args } {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyMplsLdpIntOp $args {
      testNo &#34;&#34;
      vlanList &#34;none&#34;
      flags &#34;MLU&#34;
      failTime &#34;20&#34;
   } 

   global whichDutNow

   if {$vlanList == &#34;none&#34;} {
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;vlan list not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $vlanList]} {incr i} {
          set vlanName [lindex $vlanList $i] 
          <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;vlanName $i : $vlanName&#34;
          lappend parameterList &#34;{$vlanName.*$flags} exist&#34;
          <a name="::CheckKeyValue(5)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls ldp interface vlan $vlanName&#34; $parameterList -testNo $testNo -comment &#34;- check mpls ldp interface on DUT$whichDutNow&#34; -time [list &#34;s:&#34; &#34;0&#34; &#34;i:&#34; &#34;10&#34; &#34;d:&#34; &#34;$failTime&#34; &#34;f:&#34; &#34;$failTime&#34; &#34;r&#34;]
          unset parameterList
      }
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyMplsLdpPeer</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show mpls ldp peer&#34; </span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             peerList - List of peerList </span>
<span class="comment-line">#             status - exist or notExist, default is exist </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     VerifyMplsLdpPeer -peerList &#34;[list  {100.100.1.1 100.100.2.1}]&#34;  </span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyMplsLdpPeer_122">proc <a href="ldp_lib.tcl-annot.html#::::VerifyMplsLdpPeer">::::VerifyMplsLdpPeer</a></a></strong> { args } {
   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyMplsLdpPeer $args {
      testNo &#34;&#34;
      peerList &#34;none&#34;
      status &#34;exist&#34;
   } 

   global whichDutNow

   if {$peerList == &#34;none&#34;} {
      <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;peer list not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $peerList]} {incr i} {
          set peer [lindex $peerList $i] 
          <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;peer $i : $peer&#34;
          set localAdd [lindex $peer 0] 
          set remoteAdd &#34;[lindex $peer 1]:0&#34; 
          lappend parameterList &#34;{$localAdd * $remoteAdd * Operational} $status&#34;
      }
      <a name="::CheckKeyValue(6)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls ldp peer&#34; $parameterList -testNo $testNo -comment &#34;- check mpls ldp peer on DUT$whichDutNow&#34;
      unset parameterList
   }
}



<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyMplsLdpLsp</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show mpls ldp lsp&#34; </span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             lspList - List of lsps </span>
<span class="comment-line">#             status - exist or notExist, default is exist </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    VerifyMplsLdpLsp -lspList &#34;[list {11.0.12.0/30 yes no none trunk12_1}]&#34; </span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyMplsLdpLsp_160">proc <a href="ldp_lib.tcl-annot.html#::::VerifyMplsLdpLsp">::::VerifyMplsLdpLsp</a></a></strong> { args } {
   <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyMplsLdpLsp $args {
      testNo &#34;&#34;
      lspList &#34;none&#34;
      status &#34;exist&#34;
   } 

   global whichDutNow

   if {$lspList == &#34;none&#34;} {
      <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;lspList not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $lspList]} {incr i} {
          set lspEntry [lindex $lspList $i] 
          <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;lspEntry $i : $lspEntry&#34;
          set prefix [lindex $lspEntry 0]
          set advLabel [lindex $lspEntry 1] 
          set peerLabel [lindex $lspEntry 2] 
          set nexthop [lindex $lspEntry 3] 
          set interface [lindex $lspEntry 4] 

          if {$advLabel == &#34;yes&#34;} {
             set advLabel &#34;0x.....&#34;
          } else {
             set advLabel &#34;--&#34;
          }
          if {$peerLabel == &#34;yes&#34;} {
             set peerLabel &#34;0x.....&#34;
          } else {
             set peerLabel &#34;--&#34;
          }
          if {$nexthop == &#34;none&#34;} {
             set nexthop &#34;--&#34;
          } 
          lappend parameterList &#34;{$prefix * $advLabel * $peerLabel * $nexthop * $interface} $status&#34;
      }
      <a name="::CheckKeyValue(7)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls ldp lsp&#34; $parameterList -testNo $testNo -comment &#34;- check mpls ldp lsp on DUT$whichDutNow&#34;
      unset parameterList
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyMplsRetainedLsp</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show mpls ldp label retained lsp&#34; </span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             lspList - List of lsps </span>
<span class="comment-line">#             status - exist or notExist, default is exist </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#   VerifyMplsRetainedLsp -lspList &#34;[list {11.0.12.0/30 yes 11.0.12.2 trunk12_1}]&#34; </span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyMplsRetainedLsp_214">proc <a href="ldp_lib.tcl-annot.html#::::VerifyMplsRetainedLsp">::::VerifyMplsRetainedLsp</a></a></strong> { args } {
   <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyMplsRetainedLsp $args {
      testNo &#34;&#34;
      lspList &#34;none&#34;
      status &#34;exist&#34;
   } 

   global whichDutNow

   if {$lspList == &#34;none&#34;} {
      <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;lspList not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $lspList]} {incr i} {
          set lspEntry [lindex $lspList $i] 
          <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;lspEntry $i : $lspEntry&#34;
          set prefix [lindex $lspEntry 0]
          set peerLabel [lindex $lspEntry 1] 
          set nexthop [lindex $lspEntry 2] 
          set interface [lindex $lspEntry 3] 

          if {$peerLabel == &#34;yes&#34;} {
             set peerLabel &#34;0x.....&#34;
          } else {
             set peerLabel &#34;--&#34;
          }
          if {$nexthop == &#34;none&#34;} {
             set nexthop &#34;--&#34;
          } 
          lappend parameterList &#34;{$prefix.* $peerLabel * $nexthop * $interface} $status&#34;
      }
      <a name="::CheckKeyValue(8)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls ldp label retained lsp&#34; $parameterList -testNo $testNo -comment &#34;- check mpls ldp label retained lsp on DUT$whichDutNow&#34;
      unset parameterList
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyIpr</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show iproute&#34; </span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             prefixList - List of prefixes </span>
<span class="comment-line">#             status - exist or notExist, default is exist </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#  VerifyIpr -prefixList &#34;[list {#d 11.0.12.0/30 11.0.12.1}]&#34; </span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyIpr_262">proc <a href="ldp_lib.tcl-annot.html#::::VerifyIpr">::::VerifyIpr</a></a></strong> { args } {
   <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyIpr $args {
      testNo &#34;&#34;
      prefixList &#34;none&#34;
      status &#34;exist&#34;
   } 

   global whichDutNow

   if {$prefixList == &#34;none&#34;} {
      <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;prefix list not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $prefixList]} {incr i} {
          set prefix [lindex $prefixList $i] 
          <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;prefix $i : $prefix&#34;
          set origin [lindex $prefix 0]
          set destination [lindex $prefix 1] 
          set gateway [lindex $prefix 2] 
          lappend parameterList &#34;{$origin * $destination * $gateway} $status&#34;
      }
      <a name="::CheckKeyValue(9)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show iproute&#34; $parameterList -testNo $testNo -comment &#34;- check iproute on DUT$whichDutNow&#34;
      unset parameterList
   }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyIpv4Fib</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;debug hal show platform ipv4Fib&#34;</span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             prefixList - List of prefixes</span>
<span class="comment-line">#             status - exist or notExist, default is exist</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#  VerifyIpv4Fib -prefixList &#34;[list {11.0.12.0 255.255.255.255}]&#34;</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyIpv4Fib_298">proc <a href="ldp_lib.tcl-annot.html#::::VerifyIpv4Fib">::::VerifyIpv4Fib</a></a></strong> { args } {
   <a name="::parse_args(8)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyIpv4Fib $args {
      testNo &#34;&#34;
      prefixList &#34;none&#34;
      status &#34;exist&#34;
   }

   global whichDutNow

   if {$prefixList == &#34;none&#34;} {
      <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;prefix list not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $prefixList]} {incr i} {
          set prefix [lindex $prefixList $i]
          <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;prefix $i : $prefix&#34;
          set destination [lindex $prefix 0]
          set gateway [lindex $prefix 1]
          lappend parameterList &#34;{$destination * $gateway} $status&#34;
      }
      <a name="::CheckKeyValue(10)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;debug hal show platform ipv4Fib&#34; $parameterList -testNo $testNo -comment &#34;- check ipv4fib on DUT$whichDutNow&#34;
      unset parameterList
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyIprFlag</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show iproute&#34; with flag</span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             prefixList - List of prefixes</span>
<span class="comment-line">#             status - exist or notExist, default is exist</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#  VerifyIprFlag -prefixList &#34;[list {#d 11.0.12.0/30 11.0.12.1 L}]&#34;</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyIprFlag_334">proc <a href="ldp_lib.tcl-annot.html#::::VerifyIprFlag">::::VerifyIprFlag</a></a></strong> { args } {
   <a name="::parse_args(9)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyIprFlag $args {
      testNo &#34;&#34;
      prefixList &#34;none&#34;
      status &#34;exist&#34;
   }

   global whichDutNow

   if {$prefixList == &#34;none&#34;} {
      <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;prefix list not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $prefixList]} {incr i} {
          set prefix [lindex $prefixList $i]
          <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;prefix $i : $prefix&#34;
          set origin [lindex $prefix 0]
          set destination [lindex $prefix 1]
          set gateway [lindex $prefix 2]
          set flag [lindex $prefix 3]
          lappend parameterList &#34;{$origin * $destination * $gateway.*$flag} $status&#34;
      }
      <a name="::CheckKeyValue(11)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show iproute&#34; $parameterList -testNo $testNo -comment &#34;- check iproute on DUT$whichDutNow&#34;
      unset parameterList
   }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyIprMpls</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show iproute mpls&#34; </span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             prefixList - List of prefixes </span>
<span class="comment-line">#             status - exist or notExist, default is exist </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#  VerifyIprMpls -prefixList &#34;[list {#mp 11.0.12.0/30 11.0.12.0/30}]&#34; </span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyIprMpls_371">proc <a href="ldp_lib.tcl-annot.html#::::VerifyIprMpls">::::VerifyIprMpls</a></a></strong> { args } {
   <a name="::parse_args(10)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyIprMpls $args {
      testNo &#34;&#34;
      prefixList &#34;none&#34;
      status &#34;exist&#34;
   } 

   global whichDutNow

   if {$prefixList == &#34;none&#34;} {
      <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;prefix list not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $prefixList]} {incr i} {
          set prefix [lindex $prefixList $i] 
          <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;prefix $i : $prefix&#34;
          set origin [lindex $prefix 0]
          set destination [lindex $prefix 1] 
          set endPoint [lindex $prefix 2] 
          lappend parameterList &#34;{$origin * $destination * $endPoint} $status&#34;
      }
      <a name="::CheckKeyValue(12)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show iproute mpls&#34; $parameterList -testNo $testNo -comment &#34;- check iproute mpls on DUT$whichDutNow&#34;
      unset parameterList
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyMplsLdpLabel</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show mpls ldp lable&#34; </span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             prefixList - List of prefixes </span>
<span class="comment-line">#             status - exist or notExist, default is exist </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#   VerifyMplsLdpLabel -prefixList &#34;[list {LE 11.0.12.0/30 trunk12_1}]&#34; </span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyMplsLdpLabel_408">proc <a href="ldp_lib.tcl-annot.html#::::VerifyMplsLdpLabel">::::VerifyMplsLdpLabel</a></a></strong> { args } {

   <a name="::parse_args(11)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyMplsLdpLabel $args {
      testNo &#34;&#34;
      prefixList &#34;none&#34;
      status &#34;exist&#34;
   } 

   global whichDutNow
 set vers [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1 2]
   if {$prefixList == &#34;none&#34;} {
      <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;prefixList not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $prefixList]} {incr i} {
          set prefix [lindex $prefixList $i] 
          <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;prefix $i : $prefix&#34;
          set lspFlag [lindex $prefix 0]
          set destination [lindex $prefix 1] 
          set nexthop [lindex $prefix 2] 
          if {($lspFlag == &#34;LE&#34;) || ($lspFlag == &#34;LT&#34;) || ($lspFlag == &#34;MLT&#34;) } {
             set advLabel &#34;0x.....&#34;
             if {$lspFlag == &#34;LE&#34;} {
                set peerLabel &#34;--&#34;
             } else {
                set peerLabel &#34;0x.....&#34;
             }
             set rcvLabel &#34;--&#34;
        if {$lspFlag == &#34;MLT&#34;} {

                if {$vers &lt; 12.5} {

                        set lspFlag &#34;MLT&#34;
                } else {
                        set lspFlag &#34;M-LT&#34;
                }
        }
	
             lappend parameterList &#34;{$advLabel.*$destination.*$lspFlag.*$peerLabel.*$nexthop} $status&#34;
          }
          if {$lspFlag == &#34;LI&#34;} {
             set advLabel &#34;--&#34;
             set peerLabel &#34;--&#34;
             set rcvLabel &#34;0x.....&#34;
             lappend parameterList &#34;{$rcvLabel.*$destination.*$lspFlag.*$nexthop} $status&#34;
          }
      } 
      <a name="::CheckKeyValue(13)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls ldp label&#34; $parameterList -testNo $testNo -comment &#34;- check mpls ldp label on DUT$whichDutNow&#34;
      unset parameterList
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetLdpHoldTime</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Get the hold time from the packet </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              LDP packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              return LDP hold time</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              [GetLdpHoldTime $frame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetLdpHoldTime_475">proc <a href="ldp_lib.tcl-annot.html#::::GetLdpHoldTime">::::GetLdpHoldTime</a></a></strong> { rawFrame } {
    set type [string range $rawFrame 36 40]
    <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
    if {$type == &#34;81 00&#34;} {
        set leftRawFrame [string range $rawFrame 0 35]
        set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
        set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
    }

    puts &#34;HelloTime: [<a name="::hextodec(1)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $rawFrame 195 196]]&#34;
    return [<a name="::hextodec(2)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $rawFrame 195 196]] 
}

<span class="comment-line">##################################################################</span>


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetMplsEchoReplyCode</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Parses the MPLS Echo Reply message </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              LDP packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              return Echo Reply Return Code </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              [GetMplsEchoReplyCode $frame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetMplsEchoReplyCode_507">proc <a href="ldp_lib.tcl-annot.html#::::GetMplsEchoReplyCode">::::GetMplsEchoReplyCode</a></a></strong> { rawFrame } {
    set type [string range $rawFrame 36 40]
    <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
    if {$type == &#34;81 00&#34;} {
        set leftRawFrame [string range $rawFrame 0 35]
        set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
        set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
    }

   <span class="comment-line">#Assuming MPLS contains the IP packet. 8847 is for carrying unicast layer 3 packets.</span>
   set type [string range $rawFrame 36 40]
   if {$type == &#34;88 47&#34;} {
     set leftRawFrame [string range $rawFrame 0 35]
     set rightRawFrame [string range $rawFrame 54 [string length $rawFrame]]
     set rawFrame [format &#34;%s%s %s %s&#34; $leftRawFrame 08 00 $rightRawFrame]
     <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rawframe -2 : $rawFrame&#34;
   }

   set returnCode [string range $rawFrame 144 145]
   <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Mpls echo reply return code : $returnCode&#34;
   return $returnCode 
}
<span class="comment-line">##################################################################</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyOspfLsdb</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show ospf lsdb&#34;</span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             LSAList - List of LSAs</span>
<span class="comment-line">#             status - exist or notExist, default is exist</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     VerifyOspfLsdb -LsdbList &#34;[list  {11.0.12.2 100.100.2.1}]&#34;</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyOspfLsdb_543">proc <a href="ldp_lib.tcl-annot.html#::::VerifyOspfLsdb">::::VerifyOspfLsdb</a></a></strong> { args } {
   <a name="::parse_args(12)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyOspfLsdb $args {
      testNo &#34;&#34;
      LSAList &#34;none&#34;
      status &#34;exist&#34;
   }

   global whichDutNow

   if {$LSAList == &#34;none&#34;} {
      <a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;LSA list not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $LSAList]} {incr i} {
          set LSA [lindex $LSAList $i]
          <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;LSA $i : $LSA&#34;
          set LinkStateID [lindex $LSA 0]
          set AdvRtr [lindex $LSA 1]
          lappend parameterList &#34;{$LinkStateID * $AdvRtr * 0x*} $status&#34;
      }
      <a name="::CheckKeyValue(14)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show ospf lsdb&#34; $parameterList -testNo $testNo -comment &#34;- check ospf lsdb DUT$whichDutNow&#34;
      unset parameterList
   }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyOspfNeighbor</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show ospf neighbor&#34;</span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             LSAList - List of neighbors</span>
<span class="comment-line">#             status - exist or notExist, default is exist</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     VerifyOspfNeighbor -NeighborList &#34;[list  {100.100.2.1 FULL}]&#34;</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::VerifyOspfNeighbor_578">proc <a href="ldp_lib.tcl-annot.html#::::VerifyOspfNeighbor">::::VerifyOspfNeighbor</a></a></strong> { args } {
   <a name="::parse_args(13)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyOspfNeighbor $args {
      testNo &#34;&#34;
      NeighborList &#34;none&#34;
      status &#34;exist&#34;
   }

   global whichDutNow

   if {$NeighborList == &#34;none&#34;} {
      <a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Neighbor list not given&#34;
   } else {
      for {set i 0} {$i &lt; [llength $NeighborList]} {incr i} {
          set Neighbor [lindex $NeighborList $i]
          <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Neighbor $i : $Neighbor&#34;
          set NeighborID [lindex $Neighbor 0]
          set State [lindex $Neighbor 1]
          lappend parameterList &#34;{$NeighborID.*$State} $status&#34;
      }
      <a name="::CheckKeyValue(15)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show ospf neighbor&#34; $parameterList -testNo $testNo -comment &#34;- check ospf neighbor DUT$whichDutNow&#34;
      unset parameterList
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: setupLDPInterface</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc verifies &#34;show ldp peer&#34;</span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             LSAList - List of neighbors</span>
<span class="comment-line">#             status - exist or notExist, default is exist</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::setupLDPInterface_614">proc <a href="ldp_lib.tcl-annot.html#::::setupLDPInterface">::::setupLDPInterface</a></a></strong> {args} {
    <a name="::parse_args(14)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupLDPInterface $args {
        dutIp &#34;&#34;
        interfaceIp &#34;&#34;
        interfaceMask &#34;24&#34;
        routerId &#34;&#34;
        discoveryMode &#34;ldpInterfaceBasic&#34;
        advMode &#34;ldpInterfaceDownstreamUnsolicited&#34;
        numNetworks &#34;0&#34;
        networkIp   &#34;0.0.0.0&#34;
        networkMask &#34;24&#34;
        networkIncrement &#34;ldpAdvertiseFecRangeIncrement&#34;
        networkLabelstart &#34;16&#34;
        <a name="::protocol(1)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ospf&#34;
        txPortId  &#34;1&#34;
}

    <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
   set chas(1) $cha
   set card(1) $car
   set port(1) $por
   <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupLDPInterface: Chas: $cha Card: $car Port: $por&#34;

 ldpServer select $cha $car $por
 ldpServer clearAllRouters

 ldpInterface setDefault
 ldpInterface config -enable true
 ldpInterface config -advertisingMode $advMode
 ldpInterface config -requestingMode ldpInterfaceIndependent
 ldpInterface config -labelSpaceId 0
 ldpInterface config -discoveryMode $discoveryMode
if { $protocol == &#34;isis&#34; } {
<span class="comment-line"># ldpInterface config -protocolInterfaceDescription &#34;protocol interface-$car.$por&#34;</span>
  ldpInterface config -protocolInterfaceDescription &#34;$interfaceIp/$interfaceMask&#34;
} elseif { $protocol == &#34;bgp&#34; } {
 ldpInterface config -protocolInterfaceDescription &#34;$interfaceIp/$interfaceMask&#34;
} else {
 ldpInterface config -protocolInterfaceDescription &#34;$interfaceIp/$interfaceMask&#34;
}
 ldpInterface config -enableAtmSession false
 ldpInterface config -atmVcDirection atmVcBidirectional

 if {[ldpRouter addInterface interface1]} {
      error &#34;setupLDPInterface: ldpRouter addInterface interface1 failed.&#34;
 }

 ldpAdvertiseFecRange setDefault
 ldpAdvertiseFecRange config -enable true
 ldpAdvertiseFecRange config -numRoutes $numNetworks
 ldpAdvertiseFecRange config -maskWidth $networkMask
 ldpAdvertiseFecRange config -networkIpAddress $networkIp
 ldpAdvertiseFecRange config -labelIncrementMode $networkIncrement
 ldpAdvertiseFecRange config -labelValueStart $networkLabelstart
 ldpAdvertiseFecRange config -enablePacking false

 if {[ldpRouter addAdvertiseFecRange advertiseFecRange1]} {
      error &#34;setupLDPInterface: ldpRouter addAdvertiseFecRange advertiseFecRange1 failed.&#34;
 }

 ldpRouter setDefault
 ldpRouter config -routerId $routerId
 ldpRouter config -enable true
 ldpRouter config -enableRemoteConnect true
 ldpRouter config -enableL2VpnVcFecs true
 ldpRouter config -enableVcGroupMatching false
 ldpRouter config -enableExplicitIncludeIpFec false
 ldpRouter config -enableGracefulRestart false
 ldpRouter config -reconnectTime 120000
 ldpRouter config -recoveryTime 120000
 ldpRouter config -enablePduRateControl false
 ldpRouter config -interPduGap 50

 if {[ldpServer addRouter router1]} {
      error &#34;setupLDPInterface: ldpServer addRouter router1 failed.&#34;
 }


 ldpServer setDefault
 ldpServer config -enableDiscardSelfAdvertiseFecs false
 ldpServer config -helloInterval 5
 ldpServer config -helloHoldTime 15
 ldpServer config -keepAliveInterval 10
 ldpServer config -keepAliveHoldTime 30
 ldpServer config -targetedHelloInterval 15
 ldpServer config -targetedHoldTime 45
 ldpServer config -enableHelloJitter true
 ldpServer set


 protocolServer setDefault
 protocolServer config -enableArpResponse true
 protocolServer config -enablePingResponse true
 protocolServer config -enableIgmpQueryResponse false
      if { $protocol == &#34;ospf&#34; } {
        protocolServer config -enableOspfService true
      } else {
        protocolServer config -enableOspfService false
     }

      if { $protocol == &#34;bgp&#34; } {
        protocolServer config -enableBgp4Service true
      } else {
        protocolServer config -enableBgp4Service false
      }

      if { $protocol == &#34;isis&#34; } {
        protocolServer config -enableIsisService true
      } else {
        protocolServer config -enableIsisService false
     }

 protocolServer config -enableRsvpService false
 protocolServer config -enableRipService false
 protocolServer config -enableLdpService true
 protocolServer config -enableRipngService false
 protocolServer config -enableMldService false
 protocolServer config -enableOspfV3Service false
 protocolServer config -enablePimsmService false
 protocolServer config -enableStpService false
 protocolServer config -enableBgp4CreateInterface false
 protocolServer config -enableIsisCreateInterface false
 protocolServer config -enableOspfCreateInterface false
 protocolServer config -enableRipCreateInterface false
 protocolServer config -enableRsvpCreateInterface false
 protocolServer config -enableIgmpCreateInterface false

if {[protocolServer set $cha $car $por]} {
   error &#34;setupLDPInterface: protocolServer set $cha $car $por failed.&#34;
}

    set portList [list [list $cha $car $por]]
    <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Writing Configuration to Hardware...&#34;
    if {[<a name="::ixWriteConfigToHardware(1)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList]} {
        <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error writing config to hardware&#34;
    }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: startLdp</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc is used to start test equipment LDP protocol adjacency</span>
<span class="comment-line">#              on the list of ports supplied via txPortIdList</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  txPortIdList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      startLdp 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::startLdp_772">proc <a href="ldp_lib.tcl-annot.html#::::startLdp">::::startLdp</a></a></strong> {args} {
    <a name="::parse_args(15)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> startLdp $args {
        txPortIdList &#34;&#34;
        <a name="::protocol(2)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;&#34;
  }
    set pList &#34;&#34;
    foreach txPortId $txPortIdList {
        <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startLdp: Chas: $cha Card: $car Port: $por&#34;
        lappend pList &#34;$cha $car $por&#34;
    }

    if {[ixStartLdp pList]} {
        error &#34;startLdp: ixStartLdp failed.&#34;
    }
         if { $protocol == &#34;isis&#34; } {
                 if {[ixStartIsis pList]} {
                error &#34;startLdp: ixStartIsis failed.&#34;
                    }
         } elseif { $protocol == &#34;ospf&#34; } {
                 if {[ixStartOspf pList]} {
                 error &#34;startLdp: ixStartOspf failed.&#34;
                   }
        } else {
                 if {[ixStartBGP4 pList]} {
                 error &#34;startLdp: ixStartBGP4 failed.&#34;
                 }
       }
 }
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: stopLdp</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc is used to stop test equipment LDP protocol adjacency</span>
<span class="comment-line">#              on the list of ports supplied via txPortIdList</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  txPortIdList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      stopLdp 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::stopLdp_820">proc <a href="ldp_lib.tcl-annot.html#::::stopLdp">::::stopLdp</a></a></strong> {txPortIdList} {
    set pList &#34;&#34;
    foreach txPortId $txPortIdList {
        <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopLdp: Chas: $cha Card: $car Port: $por&#34;
        lappend pList &#34;$cha $car $por&#34;
    }

    if {[ixStopLdp pList]} {
        error &#34;stopOspf: ixStopLdp failed.&#34;
    }
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
