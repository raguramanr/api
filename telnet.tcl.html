<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>telnet.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#telnet.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>telnet.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="telnet.tcl-annot.html">annotations</a> | <a href="telnet.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: result_debug_expect</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       print expect_out(buffer) in the log</span>
<span class="comment-line"># Input args: None </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       result_debug_expect</span>
<span class="comment-line"># Category: Failsafe</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::result_debug_expect_12">proc <a href="telnet.tcl-annot.html#::::result_debug_expect">::::result_debug_expect</a></a></strong><a name="::::result_debug_expect"></a> { } {
   <span class="comment-line">#eval expect_out at the caller's level</span>
   uplevel {
      if [info exist expect_out(buffer)] {
         <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> $expect_out(buffer)
      }
   }
} 

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: createAccount</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to create a user acount on the switch</span>
<span class="comment-line"># Input args:  user</span>
<span class="comment-line">#              password</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       createAccount user local123 local123</span>
<span class="comment-line"># Category: Failsafe</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::createAccount_32">proc <a href="telnet.tcl-annot.html#::::createAccount">::::createAccount</a></a></strong><a name="::::createAccount"></a> { type user password } {
   global whichDutNow
   set ver [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}]
   if { [<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 11.1] &gt;=0 } {
      exp_send &#34;\r&#34;
      exp_send &#34;create account $type $user\r&#34;
      expect &#34;password:&#34;
      <a name="::::result_debug_expect(1)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
      exp_send &#34;$password\r&#34;
      expect &#34;Reenter password:&#34;
      exp_send &#34;$password\r&#34;
      <a name="::::result_debug_expect(2)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
   } else {
      <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create account $type $user $password&#34;
   }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetVirtualRouter</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       return the vr to be used based on switchPort2DefaultRouter</span>
<span class="comment-line"># Input args:  mode - keyWord - include the vr keyword</span>
<span class="comment-line">#                     noKeyWord - don't include the vr keyword</span>
<span class="comment-line"># Output args: return the vr to be used</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       SendACmd  &#34;enable bootprelay [GetVirtualRouter]&#34;</span>
<span class="comment-line"># Category: Failsafe</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetVirtualRouter_59">proc <a href="telnet.tcl-annot.html#::::GetVirtualRouter">::::GetVirtualRouter</a></a></strong><a name="::::GetVirtualRouter"></a> { {mode keyWord}} {
   global switchPort2DefaultRouter
   global whichDutNow
   global DUT${whichDutNow}_IP_FP
   global USE_FP_PORT
   if {$mode == &#34;noKeyWord&#34; } {
      set vr &#34;&#34;
   } else {
      set vr &#34;vr &#34;
   }
   if {[info exists USE_FP_PORT] &amp;&amp; $USE_FP_PORT} {
      return &#34;${vr}VR-Default&#34;
   } elseif {[regexp -nocase $switchPort2DefaultRouter &#34;mgmt&#34;]} {
      return &#34;${vr}VR-mgmt&#34;
   } else {
      return &#34;${vr}VR-Default&#34;
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: spawnTelnet</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to spawn a telnet session</span>
<span class="comment-line"># Input args:  ip  - ip to telnet to</span>
<span class="comment-line">#              user</span>
<span class="comment-line">#              password</span>
<span class="comment-line"># Output args: return 0 if failed, return spawn_id if ok</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       spawnTelnet $DUT1_IP admin &#34;&#34;</span>
<span class="comment-line"># Category: Telnet</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::spawnTelnet_90">proc <a href="telnet.tcl-annot.html#::::spawnTelnet">::::spawnTelnet</a></a></strong><a name="::::spawnTelnet"></a> { <a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> {user admin } {password &#34;&#34; } } {
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;telneting to $ip as $user&#34;
   set timeout 10
   if [catch &#34;spawn telnet $ip&#34; reason] {
      return 0
   }
   expect {
      &#34;Connection refused&#34; {
         <a name="::::result_debug_expect(3)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 0
      }
      &#34;Connection closed&#34; {
         <a name="::::result_debug_expect(4)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 0
      }
      &#34;Unable to connect&#34; {
         <a name="::::result_debug_expect(5)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 0
      }
      &#34;login:&#34; {
         <a name="::::result_debug_expect(6)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         send &#34;$user\r&#34;
      }
      timeout {
         <a name="::::result_debug_expect(7)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 0
      }
   }
   expect {
      &#34;assword:&#34; {
         <a name="::::result_debug_expect(8)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         send &#34;$password\r&#34;
      }
      timeout {
         <a name="::::result_debug_expect(9)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 0
      }
   }
   expect {
      -re &#34;\[0-9] \[#&gt;]&#34; {
         <a name="::::result_debug_expect(10)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return $spawn_id
      }
      timeout {
         <a name="::::result_debug_expect(11)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 0
      }
   }
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
