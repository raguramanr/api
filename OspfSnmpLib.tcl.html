<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>OspfSnmpLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#OspfSnmpLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>OspfSnmpLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="OspfSnmpLib.tcl-annot.html">annotations</a> | <a href="OspfSnmpLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckOspfInterfaceParameters</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#  This procedure checks the ospf parameters on particular interface.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session         - Session identifier which identifies the connection</span>
<span class="comment-line">#                      with the DUT</span>
<span class="comment-line">#    ipaddr          - Interface IP address </span>
<span class="comment-line">#    areaid          - Interface AreaId </span>
<span class="comment-line">#    type            - Interface Type </span>
<span class="comment-line">#    ospfstate       - Interface OSPF State </span>
<span class="comment-line">#    rtrpriority     - Interface Router Priority </span>
<span class="comment-line">#    transitdelay    - Interface TransitDelay</span>
<span class="comment-line">#    hellointerval   - Interface HelloInterval </span>
<span class="comment-line">#    rtrdeadinterval - Interface Router DeadInterval</span>
<span class="comment-line">#    authtype        - Interface Authentication Type </span>
<span class="comment-line">#    state           - Interface State</span>
<span class="comment-line">#    dr              - Interface DesignatedRouter </span>
<span class="comment-line">#    bdr             - Interface Backup DesignatedRouter </span>
<span class="comment-line">#    authtype        - Interface Authentication Type </span>
<span class="comment-line">#    authkey         - Interface Authentication Key value </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd              - File descriptor of open log file   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckOspfInterfaceParameters -session $sessionid -state &#34;disable&#34;</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpCheckOspfInterfaceParameters_41">proc <a href="OspfSnmpLib.tcl-annot.html#::::snmpCheckOspfInterfaceParameters">::::snmpCheckOspfInterfaceParameters</a></a></strong> { args } {
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckOspfInterfaceParameters $args {
       session &#34;&#34;
       ipaddr &#34;&#34;
       areaid    &#34;&#34;
       type      &#34;&#34;
       ospfstate &#34;&#34;
       rtrpriority &#34;&#34;
       transitdelay &#34;&#34;
       hellointerval &#34;&#34;
       rtrdeadinterval &#34;&#34;
       retransinterval &#34;&#34;
       authtype &#34;&#34;
       ifstate &#34;&#34;
       dr &#34;&#34;
       bdr &#34;&#34;
       authtype &#34;&#34;
       authkey &#34;&#34;
       fd &#34;NULL&#34;
       comment &#34;snmpCheckOspfInterfaceParameters&#34;
    }
 
    set func &#34;snmpCheckOspfInterfaceParameters:&#34; 
    set retVal 0

    if { $session == &#34;&#34; || $ipaddr == &#34;&#34; } {
       error &#34;$func SNMP session id, interface address must be specified&#34;
       return $retVal 
    }   

    <a name="::snmpDebug(1)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;session is $session, interface address is $ipaddr &#34;

    <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;
    if { [llength $areaid] != 0 } {
       set result [snmpGet -session $session -oid ospfIfAreaId.$ipaddr.0]
       set areaId [<a name="::snmpUtilGetVal(1)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> ipaddr $result]
       if {[string compare $areaid $areaId] == 0} {
          <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: Area Id $areaid exist. PASS&#34;
          set retVal 1
        } else {
          <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: Area Id $areaid not found. FAIL&#34;
        }
    }
    if { [llength $ospfstate] != 0 } {
       set result [snmpGet -session $session -oid ospfIfAdminStat.$ipaddr.0]
       if {[string compare &#34;enable&#34; $ospfstate] == 0} {
          lappend parameterList {{.*enabled(1)*} exist}
          <a name="::snmpCheckKeyValue(1)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;OSPF is enabled on the interface $ipaddr&#34; -fd $fd
          set retVal 1
       }
       
       if {[string compare &#34;disable&#34; $ospfstate] == 0} {
          lappend parameterList {{.*disabled(2)*} exist}
          <a name="::snmpCheckKeyValue(2)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;OSPF is disabled on the interface $ipaddr&#34; -fd $fd
          set retVal 1
       }
    }
    if { [llength $transitdelay] != 0 } {
       set result [snmpGet -session $session -oid ospfIfTransitDelay.$ipaddr.0]
       set delay [<a name="::snmpUtilGetVal(2)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $result]
       if {[string compare $delay $transitdelay] == 0} {
          <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: Transit delay $transitdelay exist. PASS&#34;
          set retVal 1
        } else {
          <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: Transit delay $transitdelay not found. FAIL&#34;
        }
    }
    if { [llength $hellointerval] != 0 } {
       set result [snmpGet -session $session -oid ospfIfHelloInterval.$ipaddr.0]
       set interval [<a name="::snmpUtilGetVal(3)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $result]
       if {[string compare $interval $hellointerval] == 0} {
          <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: helloInterval $hellointerval exist. PASS&#34;
          set retVal 1
        } else {
          <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: helloInterval $hellointerval not found. FAIL&#34;
        }
    }
    if { [llength $rtrdeadinterval] != 0 } {
       set result [snmpGet -session $session -oid ospfIfRtrDeadInterval.$ipaddr.0]
       set deadinterval [<a name="::snmpUtilGetVal(4)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $result]
       if {[string compare $deadinterval $rtrdeadinterval] == 0} {
          <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: rtrdeadinterval $rtrdeadinterval exist. PASS&#34;
          set retVal 1
        } else {
          <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: rtrdeadinterval $rtrdeadinterval not found. FAIL&#34;
        }
    }
    if { [llength $rtrdeadinterval] != 0 } {
       set result [snmpGet -session $session -oid ospfIfRtrDeadInterval.$ipaddr.0]
       set deadinterval [<a name="::snmpUtilGetVal(5)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $result]
       if {[string compare $deadinterval $rtrdeadinterval] == 0} {
          <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: rtrdeadinterval $rtrdeadinterval exist. PASS&#34;
          set retVal 1
        } else {
          <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: rtrdeadinterval $rtrdeadinterval not found.FAIL&#34;
        }
    }
    if { [llength $retransinterval] != 0 } {
       set result [snmpGet -session $session -oid ospfIfRetransInterval.$ipaddr.0]
       set retransInterval [<a name="::snmpUtilGetVal(6)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $result]
       if {[string compare $retransInterval $retransinterval] == 0} {
          <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: retransmit Interval $retransinterval exist. PASS&#34;
          set retVal 1
        } else {
          <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: retransmit Interval $retransinterval not found.FAIL&#34;
        }
    }
    if { [llength $authtype] != 0 } {
       set result [snmpGet -session $session -oid ospfIfAuthType.$ipaddr.0]
       set AuthType [<a name="::snmpUtilGetVal(7)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $result]
       if {[string compare $authtype &#34;NONE&#34;] ==0 } {
          set type 0
       } elseif {[string compare $authtype &#34;SIMPLE&#34;] ==0 } {
          set type 1
       } elseif {[string compare $authtype &#34;MD5&#34;] == 0 } {
          set type 2
       }
       if {[string compare $type $AuthType] == 0} {
          <a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: Authentication Type $authtype exist. PASS&#34;
          set retVal 1
        } else {
          <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: Authentication Type $authtype not found. FAIL&#34;
        }
    }
    if { [llength $authkey] != 0 } {
       set result [snmpGet -session $session -oid ospfIfAuthKey.$ipaddr.0]
       set AuthKeyValue [<a name="::snmpUtilGetVal(8)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> hex $result]
       if {[string compare $AuthKeyValue $authkey] == 0 } {
          <a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: Authentication Key Value $authkey exist. PASS&#34;
          set retVal 1
        } else {
          <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: Authentication Key Value $authkey not found. FAIL&#34;
       }
    }
    if { [llength $rtrpriority] != 0 } {
       set result [snmpGet -session $session -oid ospfIfRtrPriority.$ipaddr.0]
       set routerPriority [<a name="::snmpUtilGetVal(9)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $result]
       if {[string compare $routerPriority $rtrpriority] == 0} {
          <a name="::result_ok(9)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: Router Priority $rtrpriority exist. PASS&#34;
          set retVal 1
        } else {
          <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: Router Priority $rtrpriority not found. FAIL&#34;
        }
    }
    if { [llength $ifstate] != 0 } {
       set result [snmpGet -session $session -oid ospfIfState.$ipaddr.0]
       <a name="::snmpDebug(2)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;ifstate  is $result, interface address is $ipaddr &#34;

       if {[string compare $ifstate &#34;down&#34;] == 0 } {
          lappend parameterList {{.*down(1)*} exist}
          <a name="::snmpCheckKeyValue(3)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;OSPF interface state is $ifstate on the interface $ipaddr&#34; -fd $fd
          set retVal 1
       }
       if {[string compare $ifstate &#34;loopback&#34;] == 0 } {
          lappend parameterList {{.*loopback(2)*} exist}
          <a name="::snmpCheckKeyValue(4)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;OSPF interface state is $ifstate on the interface $ipaddr&#34; -fd $fd
          set retVal 1
       }
       if {[string compare $ifstate &#34;waiting&#34;] == 0 } {
          lappend parameterList {{.*waiting(3)*} exist}
          <a name="::snmpCheckKeyValue(5)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;OSPF interface state is $ifstate on the interface $ipaddr&#34; -fd $fd
          set retVal 1
       }
       if {[string compare $ifstate &#34;pointtoPoint&#34;] == 0 } {
          lappend parameterList {{.*pointtoPoint(4)*} exist}
          <a name="::snmpCheckKeyValue(6)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;OSPF interface state is $ifstate on the interface $ipaddr&#34; -fd $fd
          set retVal 1
       }
       if {[string compare $ifstate &#34;designatedRouter&#34;] == 0 } {
          lappend parameterList {{.*designatedRouter(5)*} exist}
          <a name="::snmpCheckKeyValue(7)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;OSPF interface state is $ifstate on the interface $ipaddr&#34; -fd $fd
          set retVal 1
       }
       if {[string compare $ifstate &#34;backupDesignatedRouter&#34;] == 0 } {
          lappend parameterList {{.*backupDesignatedRouter(6)*} exist}
          <a name="::snmpCheckKeyValue(8)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;OSPF interface state is $ifstate on the interface $ipaddr&#34; -fd $fd
          set retVal 1
       }
       if {[string compare $ifstate &#34;otherDesignatedRouter&#34;] == 0 } {
          lappend parameterList {{.*otherDesignatedRouter(7)*} exist}
          <a name="::snmpCheckKeyValue(9)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;OSPF interface state is $ifstate on the interface $ipaddr&#34; -fd $fd
          set retVal 1
       }
    }

    <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    <a name="::snmpDebug(3)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
    return $retVal
}
<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckOspfInterfaceMetricValues</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#  This procedure checks the ospf cost parameters on particular interface.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session     - Session identifier which identifies the connection</span>
<span class="comment-line">#                  with the DUT</span>
<span class="comment-line">#    ipaddr      - Interface IP address </span>
<span class="comment-line">#    cost        - Interface Cost </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd          - File descriptor of open log file   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckOspfInterfaceParameters -session $sessionid -cost &#34;10&#34;</span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpCheckOspfInterfaceMetricValues_264">proc <a href="OspfSnmpLib.tcl-annot.html#::::snmpCheckOspfInterfaceMetricValues">::::snmpCheckOspfInterfaceMetricValues</a></a></strong> { args } {
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckOspfInterfaceMetricValues $args {
       session &#34;&#34;
       ipaddr &#34;&#34;
       cost &#34;&#34;
       fd &#34;NULL&#34;
       comment &#34;snmpCheckOspfInterfaceMetricValues&#34;
    }
 
    set func &#34;snmpCheckOspfInterfaceMetricValues:&#34; 
    set retVal 0

    if { $session == &#34;&#34; || $ipaddr == &#34;&#34; || $cost == &#34;&#34; } {
       error &#34;$func SNMP session id, interface address, cost must be specified&#34;
       return $retVal
    }   

    <a name="::snmpDebug(4)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;session is $session, interface address is $ipaddr, cost is $cost &#34;

    <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;
    set result [snmpGet -session $session -oid ospfIfMetricValue.$ipaddr.0.0]
    set metric [<a name="::snmpUtilGetVal(10)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $result]
    if {[string compare $cost $metric] == 0} {
       <a name="::result_ok(10)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface Parameter: Cost $cost exist $result . PASS&#34;
       set retVal 1
     } else {
       <a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface Parameter: Cost $cost not found. $result  FAIL&#34;
     }

     <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
     <a name="::snmpDebug(5)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
     return $retVal
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpSetupCommonVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description: ospf topology specific proc that is used to setup a common ospf vlan setup</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session     - Session identifier which identifies the connection</span>
<span class="comment-line">#                  with the DUT</span>
<span class="comment-line">#    vlan1ip     - vlan1 IP address </span>
<span class="comment-line">#    vlan2ip     - vlan2 IP address </span>
<span class="comment-line">#    vlanarea    - vlan Area Id </span>
<span class="comment-line">#    dutid       - Dut ID </span>
<span class="comment-line">#    status      - Enable ospf </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     list of vlan ids.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpSetupCommonVlan -session $sessionid -vlan1ip $DUT1vlan1IP -vlan2ip $DUT1vlan2IP \</span>
<span class="comment-line">#                        -vlanarea $vlanArea -dutid 1</span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpSetupCommonVlan_326">proc <a href="OspfSnmpLib.tcl-annot.html#::::snmpSetupCommonVlan">::::snmpSetupCommonVlan</a></a></strong> { args } {
    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpSetupCommonVlan $args {
       session &#34;&#34;
       vlan1ip &#34;&#34;
       vlan2ip &#34;&#34;
       vlanarea &#34;&#34;
       dutid &#34;&#34;
       status &#34;enable&#34;
       fd &#34;NULL&#34;
       comment &#34;snmpSetupCommonVlan&#34;
    }
 
    set func &#34;snmpSetupCommonVlan:&#34; 

    if { $session == &#34;&#34; || $vlan1ip == &#34;&#34; || $vlan2ip == &#34;&#34; || $vlanarea == &#34;&#34; || $dutid == &#34;&#34; } {
       error &#34;$func SNMP session id, vlan1ip, vlan2ip, vlanarea and dutid must be specified&#34;
       return 0
    }   

    <a name="::snmpDebug(6)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;session is $session, vlan1ip is $vlan1ip, vlan2ip is $vlan2ip, \
                     area is $vlanarea, dut id is $dutid&#34;

    <a name="::snmpChangeIpForwarding(1)"><a href="./snmpL3Lib.tcl.html#::snmpChangeIpForwarding_480">::snmpChangeIpForwarding</a></a> -session $session -status &#34;enable&#34; -fd $fd
    set vlan1_id [<a name="::snmpCreateVlan(1)"><a href="./snmplib.tcl.html#::snmpCreateVlan_939">::snmpCreateVlan</a></a> -session $session -name &#34;vlan1&#34; -fd $fd]
    <a name="::snmpAssignIPAddrToVlan(1)"><a href="./snmplib.tcl.html#::snmpAssignIPAddrToVlan_1836">::snmpAssignIPAddrToVlan</a></a> -session $session -vlanid $vlan1_id -addr $vlan1ip \
               -mask &#34;255.255.255.0&#34; -fd $fd
    <a name="::snmpChangeIpForwarding(2)"><a href="./snmpL3Lib.tcl.html#::snmpChangeIpForwarding_480">::snmpChangeIpForwarding</a></a> -session $session -status &#34;enable&#34; -vlanid $vlan1_id -fd $fd
    <a name="::snmpAddPortToVlan(1)"><a href="./snmplib.tcl.html#::snmpAddPortToVlan_1063">::snmpAddPortToVlan</a></a> -session $session -vlanid $vlan1_id -port [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $dutid 0] -fd $fd

    lappend vlanlist &#34;$vlan1_id&#34;

    <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;create ospf area $vlanarea&#34;
    set vlan2_id [<a name="::snmpCreateVlan(2)"><a href="./snmplib.tcl.html#::snmpCreateVlan_939">::snmpCreateVlan</a></a> -session $session -name &#34;vlan2&#34; -fd $fd]
    <a name="::snmpAssignIPAddrToVlan(2)"><a href="./snmplib.tcl.html#::snmpAssignIPAddrToVlan_1836">::snmpAssignIPAddrToVlan</a></a> -session $session -vlanid $vlan2_id -addr $vlan2ip \
               -mask &#34;255.255.255.0&#34; -fd $fd
    <a name="::snmpChangeIpForwarding(3)"><a href="./snmpL3Lib.tcl.html#::snmpChangeIpForwarding_480">::snmpChangeIpForwarding</a></a> -session $session -status &#34;enable&#34; -vlanid $vlan2_id -fd $fd
    <a name="::snmpAddPortToVlan(2)"><a href="./snmplib.tcl.html#::snmpAddPortToVlan_1063">::snmpAddPortToVlan</a></a> -session $session -vlanid $vlan2_id \
                      -port [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> [expr $dutid * 2] $dutid] -fd $fd

    lappend vlanlist &#34;$vlan2_id&#34;

    switch [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> &#34;DUT$dutid&#34; ] {
       4 {
          <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf ospf add vlan vlan1&#34;
          <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf ospf vlan vlan1 area $vlanarea&#34;
          <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf ospf add vlan vlan2&#34;
          <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf ospf vlan vlan2 area $vlanarea&#34; }
       6 -
       default {
          <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf ospf add vlan vlan1 area $vlanarea&#34;
          <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf ospf add vlan vlan2 area $vlanarea&#34; }
    }
    if { $status == &#34;enable&#34; } { 
       <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34; 
    } elseif { $status == &#34;disable&#34; } {
       <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
    }
            
    <a name="::snmpDebug(7)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
    return $vlanlist
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCleanupCommonVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description: ospf topology specific proc that is used to cleanup the configuration performed</span>
<span class="comment-line">#               by snmpSetupCommonVlan</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session     - Session identifier which identifies the connection</span>
<span class="comment-line">#                  with the DUT</span>
<span class="comment-line">#    vlanid      - list of vlanid's returned from snmpSetupCommonVlan </span>
<span class="comment-line">#    vlanarea    - vlan Area Id </span>
<span class="comment-line">#    dutid       - Dut ID </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpSetupCommonVlan -session $sessionid -vlanid $vlanList -vlanarea $vlanArea -dutid 1</span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpCleanupCommonVlan_413">proc <a href="OspfSnmpLib.tcl-annot.html#::::snmpCleanupCommonVlan">::::snmpCleanupCommonVlan</a></a></strong> { args } {
    <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCleanupCommonVlan $args {
       session &#34;&#34;
       vlanid &#34;&#34;
       vlanarea &#34;&#34;
       dutid &#34;&#34;
       fd &#34;NULL&#34;
       comment &#34;snmpCleanupCommonVlan&#34;
    }

    set func &#34;snmpCleanupCommonVlan:&#34;

    if { $session == &#34;&#34; || $vlanid == &#34;&#34; || $vlanarea == &#34;&#34; || $dutid == &#34;&#34;} {
       error &#34;$func SNMP session id, vlanid, vlanarea, dutid must be specified&#34;
    }

   <a name="::snmpDelPortFromVlan(1)"><a href="./snmplib.tcl.html#::snmpDelPortFromVlan_1149">::snmpDelPortFromVlan</a></a> -session $session -vlanid [lindex $vlanid 0]\
                    -port [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $dutid 0] -fd $fd
   <a name="::snmpDelPortFromVlan(2)"><a href="./snmplib.tcl.html#::snmpDelPortFromVlan_1149">::snmpDelPortFromVlan</a></a> -session $session -vlanid [lindex $vlanid 1]\
                    -port [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> [expr $dutid * 2] $dutid] -fd $fd

   <a name="::snmpDelIPAddrFromVlan(1)"><a href="./snmplib.tcl.html#::snmpDelIPAddrFromVlan_1898">::snmpDelIPAddrFromVlan</a></a> -session $session -vlanid [lindex $vlanid 0] -fd $fd
   <a name="::snmpDelIPAddrFromVlan(2)"><a href="./snmplib.tcl.html#::snmpDelIPAddrFromVlan_1898">::snmpDelIPAddrFromVlan</a></a> -session $session -vlanid [lindex $vlanid 1] -fd $fd

   <a name="::snmpDeleteVlan(1)"><a href="./snmplib.tcl.html#::snmpDeleteVlan_1005">::snmpDeleteVlan</a></a> -session $session -vlanid [lindex $vlanid 0] -fd $fd
   <a name="::snmpDeleteVlan(2)"><a href="./snmplib.tcl.html#::snmpDeleteVlan_1005">::snmpDeleteVlan</a></a> -session $session -vlanid [lindex $vlanid 1] -fd $fd

   <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;disable ospf&#34;
   <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;delete ospf area $vlanarea&#34;
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckOspfNeighborParameters</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description: This procedure checks the ospf parameters on particular interface.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session     - Session identifier which identifies the connection</span>
<span class="comment-line">#                  with the DUT</span>
<span class="comment-line">#    status      - If the value is &#34;exist&#34;, the neighbor parameter must be</span>
<span class="comment-line">#                  exist. If &#34;notexist&#34;, the neighbor parameters should notexist.</span>
<span class="comment-line">#                  Default is &#34;exist&#34;</span>
<span class="comment-line">#    ipaddr      - neighbor ip address </span>
<span class="comment-line">#    nbrstate    - neighbor interface state </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd          - File descriptor of open log file   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckOspfNeighborParameters -session $sessionid -ipaddr $vlan1IP -nbrstate &#34;full&#34; </span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpCheckOspfNeighborParameters_471">proc <a href="OspfSnmpLib.tcl-annot.html#::::snmpCheckOspfNeighborParameters">::::snmpCheckOspfNeighborParameters</a></a></strong> { args } {
    <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckOspfNeighborParameters $args {
       session &#34;&#34;
       ipaddr &#34;&#34;
       nbrstate &#34;&#34;
       status &#34;exist&#34;
       fd &#34;NULL&#34;
       comment &#34;snmpCheckOspfNeighborParameters&#34;
    }
 
    set func &#34;snmpCheckOspfNeighborParameters:&#34; 
    set retVal 0

    if { $session == &#34;&#34; || $ipaddr == &#34;&#34; } {
       error &#34;$func SNMP session id, interface address must be specified&#34;
       return $retVal 
    }   

    if { $status != &#34;&#34; } {
       set status [string tolower $status]
       if { !([string compare &#34;exist&#34; $status] == 0  ||
            [string compare &#34;notexist&#34; $status] == 0) } {
          error &#34;$func $result is invalid argument should be exist or notexist&#34;
          return $retVal
       }
    }

    <a name="::snmpDebug(8)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;session is $session, neighbor interface address is $ipaddr &#34;

    <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;

    if { [llength $nbrstate] != 0 } {
       set result [snmpGet -session $session -oid ospfNbrState.$ipaddr.0]
       <a name="::snmpDebug(9)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;nbrstate is $result, neighbor interface address is $ipaddr &#34;

       if {[regexp -nocase &#34;.*No Such Instance.*&#34; $result]} {
          if { $status == &#34;exist&#34; } {
             <a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;OSPF Neighbor interface state $ipaddr doesn't exist in the \
                        ospfNbrTable result. FAIL&#34;
          } else {
             <a name="::result_ok(11)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;OSPF Neighbor interface state $ipaddr exist in the \
                        ospfNbrTable result $status. PASS&#34;
             set retval 1
          }
       } else {
          if { $status == &#34;notexist&#34; } {
             <a name="::result_error(12)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;OSPF Neighbor interface state $ipaddr doesn't exist in the \
                        ospfNbrTable. FAIL&#34;
          } 

          if {[string compare $nbrstate &#34;down&#34;] == 0 } {
             lappend parameterList {{.*down(1)*} exist}
             <a name="::snmpCheckKeyValue(10)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                       -comment &#34;OSPF Neigbhor interface state is $nbrstate on the \
                                 interface $ipaddr&#34; -fd $fd
             set retVal 1
          }
          if {[string compare $nbrstate &#34;attempt&#34;] == 0 } {
             lappend parameterList {{.*attempt(2)*} exist}
             <a name="::snmpCheckKeyValue(11)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                       -comment &#34;OSPF Neigbhor interface state is $nbrstate on the \
                                 interface $ipaddr&#34; -fd $fd
             set retVal 1
          }
          if {[string compare $nbrstate &#34;init&#34;] == 0 } {
             lappend parameterList {{.*init(3)*} exist}
             <a name="::snmpCheckKeyValue(12)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                       -comment &#34;OSPF Neigbhor interface state is $nbrstate on the \
                                 interface $ipaddr&#34; -fd $fd
             set retVal 1
          }
          if {[string compare $nbrstate &#34;twoWay&#34;] == 0 } {
             lappend parameterList {{.*twoWay(4)*} exist}
             <a name="::snmpCheckKeyValue(13)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                       -comment &#34;OSPF Neigbhor interface state is $nbrstate on the \
                                 interface $ipaddr&#34; -fd $fd
             set retVal 1
          }
          if {[string compare $nbrstate &#34;exchangeStart&#34;] == 0 } {
             lappend parameterList {{.*exchangeStart(5)*} exist}
             <a name="::snmpCheckKeyValue(14)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                       -comment &#34;OSPF Neigbhor interface state is $nbrstate on the \
                                 interface $ipaddr&#34; -fd $fd
             set retVal 1
          }
          if {[string compare $nbrstate &#34;exchange&#34;] == 0 } {
             lappend parameterList {{.*exchange(6)*} exist}
             <a name="::snmpCheckKeyValue(15)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                       -comment &#34;OSPF Neigbhor interface state is $nbrstate on the \
                                 interface $ipaddr&#34; -fd $fd
             set retVal 1
          }
          if {[string compare $nbrstate &#34;loading&#34;] == 0 } {
             lappend parameterList {{.*loading(7)*} exist}
             <a name="::snmpCheckKeyValue(16)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                       -comment &#34;OSPF Neigbhor interface state is $nbrstate on the \
                                 interface $ipaddr&#34; -fd $fd
             set retVal 1
          }
          if {[string compare $nbrstate &#34;full&#34;] == 0 } {
             lappend parameterList {{.*full(7)*} exist}
             <a name="::snmpCheckKeyValue(17)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                       -comment &#34;OSPF Neigbhor interface state is $nbrstate on the \
                                 interface $ipaddr&#34; -fd $fd
             set retVal 1
          }
       }

    }
    <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    <a name="::snmpDebug(10)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
    return $retVal
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckOspfRouterId</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description: This procedure checks the ospf router id.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session     - Session identifier which identifies the connection</span>
<span class="comment-line">#                  with the DUT</span>
<span class="comment-line">#    ipaddr      - ip address </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    status      - If the value is &#34;exist&#34;, the router id must be</span>
<span class="comment-line">#                  exist. If &#34;notexist&#34;, the router id should not exist.</span>
<span class="comment-line">#                  Default is &#34;exist&#34;</span>
<span class="comment-line">#    fd          - File descriptor of open log file   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckOspfRouterId -session $sessionid -ipaddr $routerId </span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpCheckOspfRouterId_611">proc <a href="OspfSnmpLib.tcl-annot.html#::::snmpCheckOspfRouterId">::::snmpCheckOspfRouterId</a></a></strong> { args } {
    <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckOspfRouterId $args {
       session &#34;&#34;
       ipaddr &#34;&#34;
       status &#34;exist&#34;
       fd &#34;NULL&#34;
       comment &#34;snmpCheckOspfRouterId&#34;
    }
 
    set func &#34;snmpCheckOspfRouterId:&#34; 
    set retVal 0

    if { $session == &#34;&#34; || $ipaddr == &#34;&#34; } {
       error &#34;$func SNMP session id, router id must be specified&#34;
       return $retVal 
    }   

    if { $status != &#34;&#34; } {
       set status [string tolower $status]
       if { !([string compare &#34;exist&#34; $status] == 0  ||
            [string compare &#34;notexist&#34; $status] == 0) } {
          error &#34;$func $result is invalid argument should be exist or notexist&#34;
          return $retVal
       }
   }

    <a name="::snmpDebug(11)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;session is $session, router id is $ipaddr &#34;

    <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;

    set result [snmpGet -session $session -oid ospfRouterId.0]
    <a name="::snmpDebug(12)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;snmpGet-$result&#34; $fd
    set routerId [<a name="::snmpUtilGetVal(11)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> ipaddr $result]
    if { $routerId != $ipaddr } {
        if { $status == &#34;exist&#34; } {
           <a name="::result_error(13)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Router Id $ipaddr does not exist. FAIL&#34;
        } else {
           <a name="::result_ok(12)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Router Id $ipaddr does not exist result $status. PASS&#34;
           set retVal 1
        }
    } else {
        if { $status == &#34;notexist&#34; } {
           <a name="::result_error(14)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Router Id $ipaddr exist result $status. FAIL&#34;
        } else {
           <a name="::result_ok(13)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a>  &#34;Router Id $ipaddr exist result $status. PASS&#34;
           set retVal 1
        }
    }

    <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    <a name="::snmpDebug(13)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
    return $retVal
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckOspfAreaId</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description: This procedure checks the ospf area id.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session     - Session identifier which identifies the connection</span>
<span class="comment-line">#                  with the DUT</span>
<span class="comment-line">#    ipaddr      -  area id ip address </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    status      - If the value is &#34;exist&#34;, the area id must be</span>
<span class="comment-line">#                  exist. If &#34;notexist&#34;, the area id should not exist.</span>
<span class="comment-line">#                  Default is &#34;exist&#34;</span>
<span class="comment-line">#    fd          - File descriptor of open log file   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckOspfAreaId -session $sessionid -ipaddr $areaId </span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpCheckOspfAreaId_691">proc <a href="OspfSnmpLib.tcl-annot.html#::::snmpCheckOspfAreaId">::::snmpCheckOspfAreaId</a></a></strong> { args } {
    <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckOspfAreaId $args {
       session &#34;&#34;
       ipaddr &#34;&#34;
       status &#34;exist&#34;
       fd &#34;NULL&#34;
       comment &#34;snmpCheckOspfAreaId&#34;
    }
 
    set func &#34;snmpCheckOspfAreaId:&#34; 
    set retVal 0

    if { $session == &#34;&#34; || $ipaddr == &#34;&#34; } {
       error &#34;$func SNMP session id, area id must be specified&#34;
       return $retVal 
    }   
    if { $status != &#34;&#34; } {
       set status [string tolower $status]
       if { !([string compare &#34;exist&#34; $status] == 0  ||
            [string compare &#34;notexist&#34; $status] == 0) } {
          error &#34;$func $result is invalid argument should be exist or notexist&#34;
          return $retVal
       }
   }

    <a name="::snmpDebug(14)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;session is $session, area id is $ipaddr &#34;

    <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;

    set result [snmpGet -session $session -oid ospfAreaStatus.$ipaddr]
    <a name="::snmpDebug(15)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;snmpGet-$result&#34; $fd

   if {[regexp -nocase &#34;.*No Such Instance.*&#34; $result]} {
      if { $status == &#34;exist&#34; } {
         <a name="::result_error(15)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Area Id $ipaddr doesn't exist in the ospfAreaTable. FAIL&#34;
      } else {
         <a name="::result_ok(14)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Area Id $ipaddr doesn't exist in the ospfAreaTable result $status. PASS&#34;
         set retVal 1
      }
    } else {
      if { $status == &#34;notexist&#34; } {
         <a name="::result_error(16)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Area Id $ipaddr  exist in the ospfAreaTable result $status. FAIL&#34;
      }
      if {[regexp -nocase &#34;.*active(1).*&#34; $result]} {
         <a name="::result_ok(15)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Area Id $ipaddr  exist in the ospfAreaTable result $status. PASS&#34;
         set retVal 1
      }
    }

    <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    <a name="::snmpDebug(16)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
    return $retVal
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: Setup3.1.2</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description: This procedure creates a vlan, assign ip address,</span>
<span class="comment-line">#               add port to vlan, disables IP forwarding in the DUT</span>
<span class="comment-line">#               configures ospf on the vlan and enable OSPF.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session     - Session identifier which identifies the connection</span>
<span class="comment-line">#                  with the DUT</span>
<span class="comment-line">#    vlanIP      -  vlan ip address </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd          - File descriptor of open log file   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables: vlan id list</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::Setup3.1.2_766">proc <a href="OspfSnmpLib.tcl-annot.html#::::Setup3.1.2">::::Setup3.1.2</a></a></strong> {sessionId vlanIP fd_res} {

<span class="comment-line"># ----- Create vlan named vlanneighbor</span>
   set vlan_id [<a name="::snmpCreateVlan(3)"><a href="./snmplib.tcl.html#::snmpCreateVlan_939">::snmpCreateVlan</a></a> -session $sessionId -name &#34;vlanneighbor&#34; -fd $fd_res]

<span class="comment-line"># ----- Assign IP address and ports to VLAN</span>
   <a name="::snmpAssignIPAddrToVlan(3)"><a href="./snmplib.tcl.html#::snmpAssignIPAddrToVlan_1836">::snmpAssignIPAddrToVlan</a></a> -session $sessionId -vlanid $vlan_id -addr $vlanIP \
           -mask &#34;255.255.255.0&#34;  -fd $fd_res
   <a name="::snmpAddPortToVlan(3)"><a href="./snmplib.tcl.html#::snmpAddPortToVlan_1063">::snmpAddPortToVlan</a></a> -session $sessionId -vlanid $vlan_id -port [<a name="::MapDUTPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1-2] -fd $fd_res

<span class="comment-line"># ----- Disable IP forwarding in the DUT1</span>
   <a name="::snmpChangeIpForwarding(4)"><a href="./snmpL3Lib.tcl.html#::snmpChangeIpForwarding_480">::snmpChangeIpForwarding</a></a> -session $sessionId -status &#34;enable&#34; -fd $fd_res

   <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create ospf area $vlanIP&#34;

   switch [<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> &#34;DUT1&#34;]  {
      4 {
         <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;configure ospf add vlan vlanneighbor&#34;
         <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;configure ospf vlan vlanneighbor area $vlanIP&#34; }
      6 -
      default {
         <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;configure ospf add vlan vlanneighbor area $vlanIP&#34; }
   }

   <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable ospf&#34;
   return $vlan_id
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: Cleanup3.1.2</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description: This procedure deletes a vlan, disables ospf on the vlan </span>
<span class="comment-line">#               and disable OSPF.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session     - Session identifier which identifies the connection</span>
<span class="comment-line">#                  with the DUT</span>
<span class="comment-line">#    vlanId      -  vlan id </span>
<span class="comment-line">#    vlanIP      -  vlan ip address </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd          - File descriptor of open log file   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::Cleanup3.1.2_815">proc <a href="OspfSnmpLib.tcl-annot.html#::::Cleanup3.1.2">::::Cleanup3.1.2</a></a></strong> {vlan_id sessionId vlanIP fd_res} {

<span class="comment-line"># ----- Delete ports from corresponding VLANs</span>
   <a name="::snmpDelPortFromVlan(3)"><a href="./snmplib.tcl.html#::snmpDelPortFromVlan_1149">::snmpDelPortFromVlan</a></a> -session $sessionId -vlanid $vlan_id \
                    -port [<a name="::MapDUTPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1-2] -fd $fd_res

<span class="comment-line"># ----- Delete IP address from VLAN</span>
   <a name="::snmpDelIPAddrFromVlan(3)"><a href="./snmplib.tcl.html#::snmpDelIPAddrFromVlan_1898">::snmpDelIPAddrFromVlan</a></a> -session $sessionId -vlanid $vlan_id -fd $fd_res

<span class="comment-line"># ----- Delete all the VLANs</span>
   <a name="::snmpDeleteVlan(3)"><a href="./snmplib.tcl.html#::snmpDeleteVlan_1005">::snmpDeleteVlan</a></a> -session $sessionId -vlanid $vlan_id -fd $fd_res

   <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>     &#34;delete ospf area $vlanIP&#34;
   <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>     &#34;disable ospf&#34;

   snmpCloseSession -session $sessionId
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
