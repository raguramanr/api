<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>vpls_redundancy_scalable.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#vpls_redundancy_scalable.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>vpls_redundancy_scalable.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="vpls_redundancy_scalable.tcl-annot.html">annotations</a> | <a href="vpls_redundancy_scalable.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::createEsrpVpnDut1_2">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::createEsrpVpnDut1">::::createEsrpVpnDut1</a></a></strong><a name="::::createEsrpVpnDut1"></a> {noEsrp noVpn testNo} {
if [file exists &#34;Tmp/tmp_createEsrpVpnDut1_$testNo.xsf&#34;] {
    file delete &#34;Tmp/tmp_createEsrpVpnDut1_$testNo.xsf&#34;
}
set fd_res [open &#34;Tmp/tmp_createEsrpVpnDut1_$testNo.xsf&#34; a+]

puts $fd_res &#34;disable esrp&#34;
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
      puts $fd_res &#34;create vlan protect_$j&#34;
      puts $fd_res &#34;configure vlan protect_$j tag [expr 300 + $j]&#34;
      puts $fd_res &#34;configure vlan protect_$j add ports [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 9] \
                   [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2] tag&#34;
      puts $fd_res &#34;create esrp esrpn$j type vpls-redundancy&#34;
      puts $fd_res &#34;configure esrp esrpn$j domain-id [expr 5000 + $j]&#34;
      puts $fd_res &#34;configure esrp esrpn$j add master protect_$j&#34;
      puts $fd_res &#34;configure esrp esrpn$j priority 100&#34;
      puts $fd_res &#34;configure eaps f2_ring add protected vlan protect_$j&#34;
<span class="comment-line">#      puts $fd_res &#34;enable esrp esrpn$j&#34;</span>
   }
}
set start 1
set end  [expr $noVpn/$noEsrp]
for {set i 1} {$i &lt; $noVpn} {incr i} {
   puts $fd_res &#34;create vlan east$i&#34;
   puts $fd_res &#34;configure east$i tag [expr 500 +$i]&#34;
   puts $fd_res &#34;configure east$i add ports [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2] \
             [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 9] tag&#34;
   puts $fd_res &#34;configure eaps f2_ring add protected east$i&#34;
   puts $fd_res &#34;create vpls extreme$i fec-id-type pseudo-wire [expr 500 + $i]&#34;
   puts $fd_res &#34;disable igmp snooping vlan east$i&#34;
   puts $fd_res &#34;configure vpls extreme$i add service vlan east$i&#34;
   puts $fd_res &#34;configure vpls extreme$i add peer 100.0.0.3&#34;
   puts $fd_res &#34;configure vpls extreme$i add peer 100.0.0.4&#34;
}
puts $fd_res &#34;disable vpls all&#34;
set startloop 1
set incrRate  [expr $noVpn/$noEsrp]
set endloop $incrRate
if {$noEsrp &gt; 1} {
for {set j 2} {$j &lt;= $noEsrp} {incr j} {
   for {set k $startloop} {$k&lt;=$endloop} {incr k} {
      puts $fd_res &#34;configure vpls extreme$k redundancy esrp esrpn$j&#34;
   }
incr startloop $incrRate
incr endloop  $incrRate
}
}
for {set k $startloop} {$k&lt;$endloop} {incr k} {
      puts $fd_res &#34;configure vpls extreme$k redundancy esrp esrp2&#34;
}
puts $fd_res &#34;enable vpls all&#34;

close $fd_res
}


<strong><a name="::::createEsrpVpnDut2_59">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::createEsrpVpnDut2">::::createEsrpVpnDut2</a></a></strong><a name="::::createEsrpVpnDut2"></a> {noEsrp noVpn testNo} {
if [file exists &#34;Tmp/tmp_createEsrpVpnDut2_$testNo.xsf&#34;] {
    file delete &#34;Tmp/tmp_createEsrpVpnDut2_$testNo.xsf&#34;
}

set fd_res [open &#34;Tmp/tmp_createEsrpVpnDut2_$testNo.xsf&#34; a+]
puts $fd_res &#34;disable esrp&#34;
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
      puts $fd_res &#34;create vlan protect_$j&#34;
      puts $fd_res &#34;configure vlan protect_$j tag [expr 300 + $j]&#34;
      puts $fd_res &#34;configure vlan protect_$j add ports [<a name="::::GetATrunkPort(5)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1] \
                   [<a name="::::GetATrunkPort(6)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 10] tag&#34;
      puts $fd_res &#34;create esrp esrpn$j type vpls-redundancy&#34;
      puts $fd_res &#34;configure esrp esrpn$j domain-id [expr 5000 + $j]&#34;
      puts $fd_res &#34;configure esrp esrpn$j add master protect_$j&#34;
      puts $fd_res &#34;configure esrp esrpn$j priority 50&#34;
      puts $fd_res &#34;configure eaps f2_ring add protected vlan protect_$j&#34;
<span class="comment-line">#      puts $fd_res &#34;enable esrp esrpn$j&#34;</span>
   }
}

set start 1
set end  [expr $noVpn/$noEsrp]

for {set i 1} {$i &lt; $noVpn} {incr i} {
   puts $fd_res &#34;create vlan east$i&#34;
   puts $fd_res &#34;configure east$i tag [expr 500 +$i]&#34;
   puts $fd_res &#34;configure east$i add ports [<a name="::::GetATrunkPort(7)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1] \
             [<a name="::::GetATrunkPort(8)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 10] tag&#34;
   puts $fd_res &#34;configure eaps f2_ring add protected east$i&#34;
   puts $fd_res &#34;create vpls extreme$i fec-id-type pseudo-wire [expr 500 + $i]&#34;
   puts $fd_res &#34;disable igmp snooping vlan east$i&#34;
   puts $fd_res &#34;configure vpls extreme$i add service vlan east$i&#34;
   puts $fd_res &#34;configure vpls extreme$i add peer 100.0.0.3&#34;
   puts $fd_res &#34;configure vpls extreme$i add peer 100.0.0.4&#34;
}
puts $fd_res &#34;disable vpls all&#34;
set startloop 1
set incrRate  [expr $noVpn/$noEsrp]
set endloop $incrRate
if {$noEsrp &gt; 1} {
for {set j 2} {$j &lt;= $noEsrp} {incr j} {
   for {set k $startloop} {$k&lt;=$endloop} {incr k} {
      puts $fd_res &#34;configure vpls extreme$k redundancy esrp esrpn$j&#34;
   }
incr startloop $incrRate
incr endloop  $incrRate
}
}
for {set k $startloop} {$k&lt;$endloop} {incr k} {
      puts $fd_res &#34;configure vpls extreme$k redundancy esrp esrp2&#34;
}
puts $fd_res &#34;enable vpls all&#34;
close $fd_res

}

<strong><a name="::::createEsrpVpnDut3_117">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::createEsrpVpnDut3">::::createEsrpVpnDut3</a></a></strong><a name="::::createEsrpVpnDut3"></a> {noEsrp noVpn testNo} {
if [file exists &#34;Tmp/tmp_createEsrpVpnDut3_$testNo.xsf&#34;] {
    file delete &#34;Tmp/tmp_createEsrpVpnDut3_$testNo.xsf&#34;
}

set fd_res [open &#34;Tmp/tmp_createEsrpVpnDut3_$testNo.xsf&#34; a+]
puts $fd_res &#34;disable esrp&#34;
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
      puts $fd_res &#34;create vlan protect_$j&#34;
      puts $fd_res &#34;configure vlan protect_$j tag [expr 300 + $j]&#34;
      puts $fd_res &#34;configure vlan protect_$j add ports [<a name="::::GetATrunkPort(9)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 7] \
                   [<a name="::::GetATrunkPort(10)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 4] tag&#34;
      puts $fd_res &#34;create esrp esrpn$j type vpls-redundancy&#34;
      puts $fd_res &#34;configure esrp esrpn$j domain-id [expr 6000 + $j]&#34;
      puts $fd_res &#34;configure esrp esrpn$j add master protect_$j&#34;
      puts $fd_res &#34;configure esrp esrpn$j priority 100&#34;
      puts $fd_res &#34;configure eaps f1_ring add protected vlan protect_$j&#34;
<span class="comment-line">#      puts $fd_res &#34;enable esrp esrpn$j&#34;</span>
   }
}
set start 1
set end  [expr $noVpn/$noEsrp]

for {set i 1} {$i &lt; $noVpn} {incr i} {
   puts $fd_res &#34;create vlan east$i&#34;
   puts $fd_res &#34;configure east$i tag [expr 500 +$i]&#34;
   puts $fd_res &#34;configure east$i add ports [<a name="::::GetATrunkPort(11)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 7] \
             [<a name="::::GetATrunkPort(12)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 4] tag&#34;
   puts $fd_res &#34;configure eaps f1_ring add protected east$i&#34;
   puts $fd_res &#34;create vpls extreme$i fec-id-type pseudo-wire [expr 500 + $i]&#34;
   puts $fd_res &#34;disable igmp snooping vlan east$i&#34;
   puts $fd_res &#34;configure vpls extreme$i add service vlan east$i&#34;
   puts $fd_res &#34;configure vpls extreme$i add peer 100.0.0.1&#34;
   puts $fd_res &#34;configure vpls extreme$i add peer 100.0.0.2&#34;
}
puts $fd_res &#34;disable vpls all&#34;
set startloop 1
set incrRate  [expr $noVpn/$noEsrp]
set endloop $incrRate
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
   for {set k $startloop} {$k&lt;=$endloop} {incr k} {

      puts $fd_res &#34;configure vpls extreme$k redundancy esrp esrpn$j&#34;
   }
incr startloop $incrRate
incr endloop  $incrRate
}
}
for {set k $startloop} {$k&lt;$endloop} {incr k} {
      puts $fd_res &#34;configure vpls extreme$k redundancy esrp esrp1&#34;
}
puts $fd_res &#34;enable vpls all&#34;
close $fd_res

}


<strong><a name="::::createEsrpVpnDut4_176">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::createEsrpVpnDut4">::::createEsrpVpnDut4</a></a></strong><a name="::::createEsrpVpnDut4"></a> {noEsrp noVpn testNo} {
if [file exists &#34;Tmp/tmp_createEsrpVpnDut4_$testNo.xsf&#34;] {
    file delete &#34;Tmp/tmp_createEsrpVpnDut4_$testNo.xsf&#34;
}

set fd_res [open &#34;Tmp/tmp_createEsrpVpnDut4_$testNo.xsf&#34; a+]

puts $fd_res &#34;disable esrp&#34;
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
      puts $fd_res &#34;create vlan protect_$j&#34;
      puts $fd_res &#34;configure vlan protect_$j tag [expr 300 + $j]&#34;
      puts $fd_res &#34;configure vlan protect_$j add ports [<a name="::::GetATrunkPort(13)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 4 8] \
                   [<a name="::::GetATrunkPort(14)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 4 3] tag&#34;
      puts $fd_res &#34;create esrp esrpn$j type vpls-redundancy&#34;
      puts $fd_res &#34;configure esrp esrpn$j domain-id [expr 6000 + $j]&#34;
      puts $fd_res &#34;configure esrp esrpn$j add master protect_$j&#34;
      puts $fd_res &#34;configure esrp esrpn$j priority 50&#34;
      puts $fd_res &#34;configure eaps f1_ring add protected vlan protect_$j&#34;
<span class="comment-line">#      puts $fd_res &#34;enable esrp esrpn$j&#34;</span>
   }
}
set start 1
set end  [expr $noVpn/$noEsrp]

for {set i 1} {$i &lt; $noVpn} {incr i} {
   puts $fd_res &#34;create vlan east$i&#34;
   puts $fd_res &#34;configure east$i tag [expr 500 +$i]&#34;
   puts $fd_res &#34;configure east$i add ports [<a name="::::GetATrunkPort(15)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 4 8] \
             [<a name="::::GetATrunkPort(16)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 4 3] tag&#34;
   puts $fd_res &#34;configure eaps f1_ring add protected east$i&#34;
   puts $fd_res &#34;create vpls extreme$i fec-id-type pseudo-wire [expr 500 + $i]&#34;
   puts $fd_res &#34;disable igmp snooping vlan east$i&#34;
   puts $fd_res &#34;configure vpls extreme$i add service vlan east$i&#34;
   puts $fd_res &#34;configure vpls extreme$i add peer 100.0.0.1&#34;
   puts $fd_res &#34;configure vpls extreme$i add peer 100.0.0.2&#34;
}
puts $fd_res &#34;disable vpls all&#34;
set startloop 1
set incrRate  [expr $noVpn/$noEsrp]
set endloop $incrRate
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
   for {set k $startloop} {$k&lt;=$endloop} {incr k} {
      puts $fd_res &#34;configure vpls extreme$k redundancy esrp esrpn$j&#34;
   }
incr startloop $incrRate
incr endloop  $incrRate
}
}
for {set k $startloop} {$k&lt;$endloop} {incr k} {
      puts $fd_res &#34;configure vpls extreme$k redundancy esrp esrp1&#34;
}
puts $fd_res &#34;enable vpls all&#34;
close $fd_res
}

<strong><a name="::::createEsrpVpnEndDUT7_233">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::createEsrpVpnEndDUT7">::::createEsrpVpnEndDUT7</a></a></strong><a name="::::createEsrpVpnEndDUT7"></a> {noEsrp noVpn testNo}  {
if [file exists &#34;Tmp/tmp_createEsrpVpnDut7_$testNo.xsf&#34;] {
    file delete &#34;Tmp/tmp_createEsrpVpnDut7_$testNo.xsf&#34;
}

set fd_res [open &#34;Tmp/tmp_createEsrpVpnDut7_$testNo.xsf&#34; a+]
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
      puts $fd_res &#34;create vlan protect_$j&#34;
      puts $fd_res &#34;configure vlan protect_$j tag [expr 300 +$j]&#34;
      puts $fd_res &#34;configure vlan protect_$j add ports [<a name="::::GetATrunkPort(17)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 7 3], \
                [<a name="::::GetATrunkPort(18)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 7 8] tag&#34;
      puts $fd_res &#34;create esrp esrp_$j&#34;
      puts $fd_res &#34;configure esrp esrp_$j domain-id [expr 6000 + $j]&#34;
      puts $fd_res &#34;configure esrp esrp_$j add master protect_$j&#34;
      puts $fd_res &#34;configure eaps f1_ring add protected vlan protect_$j&#34;
   }
}

      for {set i 1} {$i &lt; $noVpn} {incr i} {
         puts $fd_res &#34;create vlan service_$i&#34;
         puts $fd_res &#34;configure service_$i tag [expr 500 +$i]&#34;
         puts $fd_res &#34;configure service_$i add ports [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 14 7], \
         [<a name="::::GetATrunkPort(19)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 7 3],[<a name="::::GetATrunkPort(20)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 7 8] tagged&#34;
         puts $fd_res &#34;configure eaps f1_ring add protected vlan service_$i&#34;
    }
close $fd_res
}

<strong><a name="::::createEsrpVpnEndDUT8_262">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::createEsrpVpnEndDUT8">::::createEsrpVpnEndDUT8</a></a></strong><a name="::::createEsrpVpnEndDUT8"></a> {noEsrp noVpn testNo}  {
if [file exists &#34;Tmp/tmp_createEsrpVpnDut8_$testNo.xsf&#34;] {
    file delete &#34;Tmp/tmp_createEsrpVpnDut8_$testNo.xsf&#34;
}

set fd_res [open &#34;Tmp/tmp_createEsrpVpnDut8_$testNo.xsf&#34; a+]
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
      puts $fd_res &#34;create vlan protect_$j&#34;
      puts $fd_res &#34;configure vlan protect_$j tag [expr 300 +$j]&#34;
      puts $fd_res &#34;configure vlan protect_$j add ports [<a name="::::GetATrunkPort(21)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 8 4], \
                [<a name="::::GetATrunkPort(22)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 8 7] tag&#34;
      puts $fd_res &#34;create esrp esrp_$j&#34;
      puts $fd_res &#34;configure esrp esrp_$j domain-id [expr 6000 + $j]&#34;
      puts $fd_res &#34;configure esrp esrp_$j add master protect_$j&#34;
      puts $fd_res &#34;configure eaps f1_ring add protected vlan protect_$j&#34;
   }
}
for {set i 1} {$i &lt; $noVpn} {incr i} {
   puts $fd_res &#34;create vlan service_$i&#34;
   puts $fd_res &#34;configure service_$i tag [expr 500 +$i]&#34;
   puts $fd_res &#34;configure service_$i add ports [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 16 8], \
             [<a name="::::GetATrunkPort(23)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 8 4],[<a name="::::GetATrunkPort(24)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 8 7] tagged&#34;
   puts $fd_res &#34;configure eaps f1_ring add protected vlan service_$i&#34;
}
close $fd_res
}

<strong><a name="::::createEsrpVpnEndDUT9_290">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::createEsrpVpnEndDUT9">::::createEsrpVpnEndDUT9</a></a></strong><a name="::::createEsrpVpnEndDUT9"></a> {noEsrp noVpn testNo}  {
if [file exists &#34;Tmp/tmp_createEsrpVpnDut9_$testNo.xsf&#34;] {
    file delete &#34;Tmp/tmp_createEsrpVpnDut9_$testNo.xsf&#34;
}

set fd_res [open &#34;Tmp/tmp_createEsrpVpnDut9_$testNo.xsf&#34; a+]
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
      puts $fd_res &#34;create vlan protect_$j&#34;
      puts $fd_res &#34;configure vlan protect_$j tag [expr 300 +$j]&#34;
      puts $fd_res &#34;configure vlan protect_$j add ports [<a name="::::GetATrunkPort(25)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 9 1], \
                [<a name="::::GetATrunkPort(26)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 9 10] tag&#34;
      puts $fd_res &#34;create esrp esrp_$j&#34;
      puts $fd_res &#34;configure esrp esrp_$j domain-id [expr 5000 + $j]&#34;
      puts $fd_res &#34;configure esrp esrp_$j add master protect_$j&#34;
      puts $fd_res &#34;configure eaps f2_ring add protected vlan protect_$j&#34;
   }
}

      for {set i 1} {$i &lt; $noVpn} {incr i} {
         puts $fd_res &#34;create vlan service_$i&#34;
         puts $fd_res &#34;configure service_$i tag [expr 500 +$i]&#34;
         puts $fd_res &#34;configure service_$i add ports [<a name="::MapDUTPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 18 9], \
                   [<a name="::::GetATrunkPort(27)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 9 1],[<a name="::::GetATrunkPort(28)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 9 10] tagged&#34;
         puts $fd_res &#34;configure eaps f2_ring add protected vlan service_$i&#34;
    }
close $fd_res
}

<strong><a name="::::createEsrpVpnEndDUT10_319">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::createEsrpVpnEndDUT10">::::createEsrpVpnEndDUT10</a></a></strong><a name="::::createEsrpVpnEndDUT10"></a> {noEsrp noVpn testNo}  {
if [file exists &#34;Tmp/tmp_createEsrpVpnDut10_$testNo.xsf&#34;] {
    file delete &#34;Tmp/tmp_createEsrpVpnDut10_$testNo.xsf&#34;
}
set fd_res [open &#34;Tmp/tmp_createEsrpVpnDut10_$testNo.xsf&#34; a+]
if {$noEsrp &gt; 1} {
   for {set j 2} {$j &lt;= $noEsrp} {incr j} {
      puts $fd_res &#34;create vlan protect_$j&#34;
      puts $fd_res &#34;configure vlan protect_$j tag [expr 300 +$j]&#34;
      puts $fd_res &#34;configure vlan protect_$j add ports [<a name="::::GetATrunkPort(29)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 10 2], \
                [<a name="::::GetATrunkPort(30)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 10 9] tag&#34;
      puts $fd_res &#34;create esrp esrp_$j&#34;
      puts $fd_res &#34;configure esrp esrp_$j domain-id [expr 5000 + $j]&#34;
      puts $fd_res &#34;configure esrp esrp_$j add master protect_$j&#34;
      puts $fd_res &#34;configure eaps f2_ring add protected vlan protect_$j&#34;
   }
}

      for {set i 1} {$i &lt; $noVpn} {incr i} {
         puts $fd_res &#34;create vlan service_$i&#34;
         puts $fd_res &#34;configure service_$i tag [expr 500 +$i]&#34;
         puts $fd_res &#34;configure service_$i add ports [<a name="::MapDUTPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 20 10], \
                   [<a name="::::GetATrunkPort(31)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 10 2],[<a name="::::GetATrunkPort(32)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 10 9] tagged&#34;
         puts $fd_res &#34;configure eaps f2_ring add protected vlan service_$i&#34;
    }
close $fd_res
}


<strong><a name="::::InitEsrpVpnDut_348">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::InitEsrpVpnDut">::::InitEsrpVpnDut</a></a></strong><a name="::::InitEsrpVpnDut"></a> {dut} {
global DUT[set dut]_CONNECT
<a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dut]_CONNECT]
<a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;use config init_config&#34;
<a name="::CheckReboot(1)"><a href="./SendSwCmd.tcl.html#::CheckReboot_1202">::CheckReboot</a></a> $dut -save no -maxWait 60
<a name="::copyRes(1)"><a href="./multiTask.tcl.html#::copyRes_362">::copyRes</a></a>
}



<strong><a name="::::runtest_3.5.6.6_358">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::runtest_3.5.6.6">::::runtest_3.5.6.6</a></a></strong><a name="::::runtest_3.5.6.6"></a> {args} {
     <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> runtest_3.5.6.6 $args {
     mode &#34;RSVP&#34;
     noEsrp &#34;1&#34;
     noVpn &#34;1&#34;
}

  <span class="comment-line"># ----- Environment variables setup</span>
  global DUT1_CONNECT
  global DUT2_CONNECT
  global DUT3_CONNECT
  global DUT4_CONNECT
  global DUT7_CONNECT
  global DUT8_CONNECT
  global DUT9_CONNECT
  global DUT10_CONNECT
  global DUTs_info

  set mercedes_mac $DUTs_info(DUT7,sysMAC)
  set ferrari_mac $DUTs_info(DUT8,sysMAC)
  set honda_mac $DUTs_info(DUT9,sysMAC)
  set toyota_mac $DUTs_info(DUT10,sysMAC)
  set delhi_mac $DUTs_info(DUT1,sysMAC)
  set chennai_mac $DUTs_info(DUT2,sysMAC)
  set frankfurt_mac $DUTs_info(DUT3,sysMAC)
  set milan_mac $DUTs_info(DUT4,sysMAC)
  set core_macs &#34;$delhi_mac $chennai_mac $frankfurt_mac $milan_mac&#34;
  set edge_macs &#34;$mercedes_mac $ferrari_mac $honda_mac $toyota_mac&#34;
 <span class="comment-line">#####################################################################################</span>
  set Subtest &#34;Active Pseudowire failure - Transport LSP - $mode&#34;
 <span class="comment-line">####################################################################################</span>

 result_h2 &#34;$Subtest&#34;
 <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$Subtest&#34;

  <span class="comment-line">#---- Checking for expected esrp state in MPLS core DUT's</span>


      <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT4_CONNECT
      <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf esrp esrp1 priority 50&#34;
 if {$noEsrp &gt;1} {
    for {set i 2} {$i &lt;= $noEsrp} {incr i} {
       <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure esrp esrpn$i priority 50&#34;
    }
 }
      <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT
      <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf esrp esrp2 priority 50&#34;
 if {$noEsrp &gt;1} {
    for {set i 2} {$i &lt;= $noEsrp} {incr i} {
       <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure esrp esrpn$i priority 50&#34;
    }
 }

  <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;wait for i60 sec for the convergence&#34;
  <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 60

  <a name="::ClearPortsStats(1)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> &#34;14 16 18 20&#34;

  <span class="comment-line">#---- send bidirectional traffic across 4 ports</span>

  <a name="::biSendFrame(1)"><a href="./ePTSendPacket.tcl.html#::biSendFrame_1296">::biSendFrame</a></a>  -txPortId 14 -rxPortId 20 -frameRate 1000 -tag &#34;500&#34; -tagMode &#34;vIncrement&#34; \
               -sourceMac $mercedes_mac -destMac $toyota_mac -streamType &#34;contPacket&#34; -tagRepeat $noVpn

  <a name="::biSendFrame(2)"><a href="./ePTSendPacket.tcl.html#::biSendFrame_1296">::biSendFrame</a></a>  -txPortId 16 -rxPortId 18 -frameRate 1000 -tag &#34;500&#34; -tagMode &#34;vIncrement&#34; \
               -sourceMac $ferrari_mac -destMac $honda_mac -streamType &#34;contPacket&#34; -tagRepeat $noVpn

  <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5

  <span class="comment-line">#####################################################################################</span>
  set Subtest &#34;$mode Checking esrp state on frankfurt and milan after
               disabling active pseudowire on Frankfurt - Transport LSP $mode \
               verify the Fail over time &#34;
  <span class="comment-line">####################################################################################</span>

  result_h3 &#34;$Subtest&#34;
  <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$Subtest&#34;

  <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;disabling active pseudowire on Frankfurt&#34;

  <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT3_CONNECT

  <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable vpls all&#34;

  <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 15

 <span class="comment-line">#---- Checking for expected esrp state in MPLS core DUT's</span>

 <a name="::::CheckEsrpStatusScal(1)"><a href="./vpls_redundancy_scalable.tcl.html#::::CheckEsrpStatusScal_553">::::CheckEsrpStatusScal</a></a> 1 $noEsrp Master
 <a name="::::CheckEsrpStatusScal(2)"><a href="./vpls_redundancy_scalable.tcl.html#::::CheckEsrpStatusScal_553">::::CheckEsrpStatusScal</a></a> 2 $noEsrp Slave
 <a name="::::CheckEsrpStatusScal(3)"><a href="./vpls_redundancy_scalable.tcl.html#::::CheckEsrpStatusScal_553">::::CheckEsrpStatusScal</a></a> 3 $noEsrp Slave
 <a name="::::CheckEsrpStatusScal(4)"><a href="./vpls_redundancy_scalable.tcl.html#::::CheckEsrpStatusScal_553">::::CheckEsrpStatusScal</a></a> 4 $noEsrp Master

  set percentageList &#34;&#34;;
  lappend percentageList &#34;20 100&#34;;
  <a name="::CheckRates(1)"><a href="./ePTRx.tcl.html#::CheckRates_1509">::CheckRates</a></a> 14 $percentageList &#34;&#34; 10;
  unset percentageList;

  set percentageList &#34;&#34;;
  lappend percentageList &#34;14 100&#34;;
  <a name="::CheckRates(2)"><a href="./ePTRx.tcl.html#::CheckRates_1509">::CheckRates</a></a> 20 $percentageList &#34;&#34; 10;
  unset percentageList;

  set percentageList &#34;&#34;;
  lappend percentageList &#34;18 100&#34;;
  <a name="::CheckRates(3)"><a href="./ePTRx.tcl.html#::CheckRates_1509">::CheckRates</a></a> 16 $percentageList &#34;&#34; 10;
  unset percentageList;

  set percentageList &#34;&#34;;
  lappend percentageList &#34;16 100&#34;;
  <a name="::CheckRates(4)"><a href="./ePTRx.tcl.html#::CheckRates_1509">::CheckRates</a></a> 18 $percentageList &#34;&#34; 10;
  unset percentageList;

  <a name="::StopPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> &#34;14 16 18 20&#34;


  for {set i 14} {$i &lt;=20} {incr i 2} {
     set numFrameSentD$i [<a name="::GetNumFramesSent(1)"><a href="./ePTRx.tcl.html#::GetNumFramesSent_1324">::GetNumFramesSent</a></a> $i]
     set numFrameRcvdD$i [<a name="::GetNumFramesReceived(1)"><a href="./ePTRx.tcl.html#::GetNumFramesReceived_1346">::GetNumFramesReceived</a></a> $i]
  }

  set pktLossD7-10 [expr  ([format &#34;%f&#34; [expr $numFrameSentD14 - $numFrameRcvdD20]])/1000]
  set pktLossD10-7 [expr  ([format &#34;%f&#34; [expr $numFrameSentD20 - $numFrameRcvdD14]])/1000]
  set pktLossD8-9 [expr  ([format &#34;%f&#34; [expr $numFrameSentD16 - $numFrameRcvdD18]])/1000]
  set pktLossD9-8 [expr  ([format &#34;%f&#34; [expr $numFrameSentD18 - $numFrameRcvdD16]])/1000]

  set pktLossLst &#34;pktLossD7-10 pktLossD10-7 pktLossD8-9 pktLossD9-8&#34;

  foreach pktLoss $pktLossLst {
  <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;fail over  time for $pktLoss are in accepted limits&#34;
     <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;fail over time calculated $pktLoss is [set $pktLoss]&#34;
     if {[set $pktLoss] &gt; 10.0 } {
        <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;fail over time for $pktLoss beyond the expected limits&#34;
     } else {
        <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;fail over loss time for $pktLoss within the accepted limits&#34;
     }
  <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
  }

  <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

  <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

}

<strong><a name="::::downloadconfig_502">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::downloadconfig">::::downloadconfig</a></a></strong><a name="::::downloadconfig"></a> {dut testNo} {
global tftpServerList
global DUT${dut}_CONNECT
global DUT${dut}_IP
<a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dut]_CONNECT]
<a name="::ConfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::ConfigGatewayNetwork_2110">::ConfigGatewayNetwork</a></a>
set cfgfile &#34;tmp_createEsrpVpnDut${dut}_$testNo&#34;
<a name="::CheckDownloadConfig(1)"><a href="./SendSwCmd.tcl.html#::CheckDownloadConfig_1046">::CheckDownloadConfig</a></a> $tftpServerList $cfgfile 0 -wait 600 -nameFormat &#34;static&#34;
}


<strong><a name="::::CheckVplsStatusScal_513">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::CheckVplsStatusScal">::::CheckVplsStatusScal</a></a></strong><a name="::::CheckVplsStatusScal"></a> {args} {

     <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckVplsStatus $args {
      dutConnect &#34;&#34;
      ipList &#34;&#34;
      state &#34;&#34;
      flag &#34;C---V-&#34;
      dutName &#34;&#34;
      vplsNo &#34;1&#34;
}
      global DUT[set dutConnect]_CONNECT
      <a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dutConnect]_CONNECT]

      set parameterList &#34;&#34;
      for {set i 1} {$i&lt; $vplsNo} {incr i 50} {
         lappend parameterList &#34;{extreme$i.*east$i} {[lindex $ipList 0].*\
                                [lindex $state 0].*$flag} inLine exist 1&#34;
         lappend parameterList &#34;{extreme$i.*east$i} {[lindex $ipList 1].*\
                                [lindex $state 1].*$flag} inLine exist&#34;

      }
      if {(($dutConnect==1)||($dutConnect==2))} {
         lappend parameterList &#34;{extreme.*500.*east} {[lindex $ipList 0].*\
                                [lindex $state 0].*$flag} inLine exist 1&#34;
         lappend parameterList &#34;{extreme.*500.*east} {[lindex $ipList 1].*\
                                [lindex $state 1].*$flag} inLine exist&#34;
      } else {
         lappend parameterList &#34;{extreme.*500.*west} {[lindex $ipList 0].*\
                                [lindex $state 0].*$flag} inLine exist 1&#34;
         lappend parameterList &#34;{extreme.*500.*west} {[lindex $ipList 1].*\
                                [lindex $state 1].*$flag} inLine exist&#34;
      }

      set return_type [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;sh vpls&#34; $parameterList \
                  -comment &#34;verify VPLS is UP on $dutName&#34;]
      return $return_type
      unset parameterList

}

<strong><a name="::::CheckEsrpStatusScal_553">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::CheckEsrpStatusScal">::::CheckEsrpStatusScal</a></a></strong><a name="::::CheckEsrpStatusScal"></a> {dut noEsrp esrpState} {
global DUT[set dut]_CONNECT
<a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dut]_CONNECT]
set parameter &#34;&#34;
   if {$noEsrp &gt; 1} {
      for {set i 2} {$i &lt;= $noEsrp} {incr i} {
         lappend parameter &#34;{esrpn$i.*E.*protect_$i.*$esrpState} exist&#34;
      }
   }
   if {(($dut==1)||($dut==2))} {
      lappend parameter &#34;{esrp2.*E.*f2_protect.*$esrpState} exist&#34;
   } else {
      lappend parameter &#34;{esrp1.*E.*f1_protect.*$esrpState} exist&#34;
   }

  <a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show esrp&#34; $parameter \
           -comment &#34;verify the esrp status for DUT$dut&#34; \
           -time {s: 1 i: 10 d: 40 f: 40 r}
  unset parameter
}

<strong><a name="::::CheckFdbVplsExistScal_574">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::CheckFdbVplsExistScal">::::CheckFdbVplsExistScal</a></a></strong><a name="::::CheckFdbVplsExistScal"></a> {args} {
      <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckFdbVplsExistScal $args {
       dut &#34;&#34;
       macList &#34;&#34;
       <a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> &#34;&#34;
       vplsNo &#34;&#34;
       dutName &#34;&#34;
}
        global DUT[set dut]_CONNECT
        <a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dut]_CONNECT]

        set parameterList &#34;&#34;
        if {(($dut==1)|| ($dut==2))} {
        for {set i 0} {$i &lt; [llength $macList]} {incr i} {
             set mac [lindex $macList $i]
             lappend parameterList &#34;{$mac.*east.*extreme:$ip} exist&#34;
        }
        } else {
           for {set i 0} {$i &lt; [llength $macList]} {incr i} {
             set mac [lindex $macList $i]
             lappend parameterList &#34;{$mac.*west.*extreme:$ip} exist&#34;
        }
        }
        for {set vp 1} {$vp &lt; $vplsNo} {incr vp 50} {
           for {set i 0} {$i &lt; [llength $macList]} {incr i} {
             set mac [lindex $macList $i]
             lappend parameterList &#34;{$mac.*east$vp.*extreme$vp:$ip} exist&#34;
           }
        }
        <a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show fdb vpls&#34; $parameterList \
            -comment &#34;Checking fdb vpls on $dutName&#34;
        unset parameterList
}

<strong><a name="::::CheckActVplsScal_608">proc <a href="vpls_redundancy_scalable.tcl-annot.html#::::CheckActVplsScal">::::CheckActVplsScal</a></a></strong><a name="::::CheckActVplsScal"></a> {dut noActL2VPN} {
global DUT${dut}_CONNECT
<a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dut]_CONNECT]
set parameter &#34;&#34;
lappend parameter &#34;{Total number of configured VPLS:} \
                   {$noActL2VPN} inLine exist&#34;
lappend parameter &#34;{Total number of active VPLS:} \
                   {$noActL2VPN} inLine exist&#34;
lappend parameter &#34;{Total number of configured PWs:} \
                   {[expr 2 * $noActL2VPN]} inLine exist&#34;
lappend parameter &#34;{Total number of active PWs:} \
                   {[expr 2 * $noActL2VPN]} inLine exist&#34;
<a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show vpls summary&#34; $parameter \
           -time {s: 1 i: 10 d: 80 f: 80 r} \
           -comment &#34;Checking Eaps Status&#34;
        unset parameter
}



</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
