<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>dhcp.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#dhcp.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>dhcp.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="dhcp.tcl-annot.html">annotations</a> | <a href="dhcp.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Function : GetDhcpReplyFrame </span>
<span class="comment-line">#</span>
<span class="comment-line"># Comment  : Make sure it is a DHCP frame.</span>
<span class="comment-line">#          </span>
<span class="comment-line"># Option   : </span>
<span class="comment-line">#            buffer - frame </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDhcpReplyFrame_10">proc <a href="dhcp.tcl-annot.html#::::GetDhcpReplyFrame">::::GetDhcpReplyFrame</a></a></strong> {buffer {tag none}} {

foreach dataFrame $buffer {     
    <span class="comment-line"># --- check for Ethernet frame </span>
      if {$tag != &#34;none&#34; } {
           set tempList1 [lrange $dataFrame 0 11]
           set tempList2 [lrange $dataFrame 16 [llength $dataFrame]]
           set tagRecv1 [lrange $dataFrame 14 14][lrange $dataFrame 15 15]
           set tagRecv [expr 0x$tagRecv1]     
           set dataFrame [concat $tempList1 $tempList2]
           if {$tag != $tagRecv} {
                continue
           }
      }

    set tmp [string range $dataFrame 36 40];
    if { $tmp == &#34;08 00&#34;} {
        <span class="comment-line"># --- check for udp   </span>
        set tmp [string range $dataFrame 68 70];       
        if { $tmp == &#34;11&#34;} {
            <span class="comment-line"># --- check the ports</span>
            set tmp [string range $dataFrame 102 112];
            if { $tmp == &#34;00 43 00 44&#34;} {
                <span class="comment-line"># --- check for bootreply</span>
                set tmp [string range $dataFrame 125 127];
                if { $tmp == &#34;02&#34; } {                    
                    return $dataFrame;
                }    
            }
        }        
    }
}
return &#34;no&#34;;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Function : GetDhcpClientAddr </span>
<span class="comment-line">#</span>
<span class="comment-line"># Comment  : Get client IP address from DHCP frame</span>
<span class="comment-line">#          </span>
<span class="comment-line"># Option   : </span>
<span class="comment-line">#            buffer - frame </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDhcpClientAddr_53">proc <a href="dhcp.tcl-annot.html#::::GetDhcpClientAddr">::::GetDhcpClientAddr</a></a></strong> {buffer {index 58}} {

    set Firstbyte [expr 0x[lindex $buffer $index]];   
    set Secondbyte [expr 0x[lindex $buffer [expr $index+1]]]; 
    set Thirdbyte [expr 0x[lindex $buffer [expr $index+2]]]; 
    set Fourthbyte [expr 0x[lindex $buffer [expr $index+3]]];       
    set DhcpClientIP &#34;$Firstbyte.$Secondbyte.$Thirdbyte.$Fourthbyte&#34;;
    <span class="comment-line">#puts &#34;DhcpClientIP = $DhcpClientIP&#34;;</span>
    
    return $DhcpClientIP;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Function : GetDHCPIP </span>
<span class="comment-line">#</span>
<span class="comment-line"># Comment  : Send a DHCP discover package. Wait for Offer frame. Then</span>
<span class="comment-line">#            send a request and wait for ack frame. </span>
<span class="comment-line">#            negTest: Negative test where we EXPECT FAILURE to occur.</span>
<span class="comment-line"># Option   : </span>
<span class="comment-line">#            sourceMac </span>
<span class="comment-line">#            port number </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDHCPIP_75">proc <a href="dhcp.tcl-annot.html#::::GetDHCPIP">::::GetDHCPIP</a></a></strong> {sourceMac portid pserver {negTest 0} {tag none}} {
set portid $portid;

set optionList [list dhcpMessageType dhcpDiscover];
<span class="comment-line">####EXOS needs clent id in DISCOVER. fixed in PD3-9531770</span>
<span class="comment-line">#lappend optionList dhcpClientId &#34;01 $sourceMac&#34;</span>
<a name="::StartPortsCapture(1)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portid;

<span class="comment-line"># GV 05-06-2011: Sleep needed here for some Ixia's before sending traffic</span>
<a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10;

<span class="comment-line"># --- send DHCP discover</span>
set frame [<a name="::SendDhcpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendDhcpFrame_1045">::SendDhcpFrame</a></a> -txPortId $portid -destMac &#34;FF FF FF FF FF FF&#34; \
          -sourceMac $sourceMac -sourceIp &#34;0.0.0.0&#34; \
          -destIp &#34;255.255.255.255&#34; -opCode &#34;dhcpBootRequest&#34; \
          -optionCodeList $optionList -clientHwAddr $sourceMac -tag $tag];     	
<a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DHCP Discover frame : $frame&#34;;

<a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
<span class="comment-line">#unset optionList;</span>
<a name="::StopPortsCapture(1)"><a href="./ePTRx.tcl.html#::StopPortsCapture_862">::StopPortsCapture</a></a> $portid;
set rawPortDataList [<a name="::GetCapturedFrames(1)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portid];
<span class="comment-line">#puts &#34;rawPortDataList --&gt; $rawPortDataList&#34;</span>
set Dhcpframe [<a name="::GetDhcpReplyFrame(1)"><a href="./dhcp.tcl.html#::GetDhcpReplyFrame_10">::GetDhcpReplyFrame</a></a> $rawPortDataList $tag];
puts &#34;tag value in GetDHCPIP after frame send is $tag&#34;

set Dhcpaddress &#34;0.0.0.0&#34;;
if {$Dhcpframe != &#34;no&#34;} {
    set messagetype [lindex $Dhcpframe 284];  
    <span class="comment-line">#the offset of DHCP message type is different between EW DHCP server and</span>
    <span class="comment-line">#EXOS DHCP server</span>
    <span class="comment-line">#EXOS DHCP server insert a 6 byte Address time field before the DHCP</span>
    <span class="comment-line">#Message Type field.</span>
    set exosMessagetype [lindex $Dhcpframe 290];
    if { $messagetype == &#34;02&#34; || $exosMessagetype == &#34;02&#34;} {
        <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;DHCP : Got Offer message type from DHCP server&#34;;

	if {$negTest == 0} {
	    <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;DHCP : Got Offer message type from DHCP server&#34;;           
	} else {
	    <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;DHCP : Got Offer message type from DHCP server&#34;;           
	}
	<a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>; 
                
        set Dhcpaddress [<a name="::GetDhcpClientAddr(1)"><a href="./dhcp.tcl.html#::GetDhcpClientAddr_53">::GetDhcpClientAddr</a></a> $Dhcpframe];
        puts &#34;Sending request again after getting offer&#34;
        <a name="::SendDHCPRequest(1)"><a href="./dhcp.tcl.html#::SendDHCPRequest_219">::SendDHCPRequest</a></a> $sourceMac $portid $pserver $Dhcpaddress  1 $tag;
   
    } else {
        <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Did not receive message offer type from DHCP server&#34;;
	if {$negTest == 0} {
	    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Warning : Did not receive message offer type from DHCP server trying again&#34;;      
            <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;If this failure is on a 10G xenpak port, try resetting the IXIA Xenpak HW and re-run test&#34;;     
            <span class="comment-line">#try to resend the request again</span>
            <a name="::StartPortsCapture(2)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portid;

            <span class="comment-line"># GV 05-06-2011: Sleep needed here for some Ixia's before sending traffic</span>
            <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3;

            <span class="comment-line"># --- send DHCP discover</span>
            set frame [<a name="::SendDhcpFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendDhcpFrame_1045">::SendDhcpFrame</a></a> -txPortId $portid -destMac &#34;FF FF FF FF FF FF&#34; \
                   -sourceMac $sourceMac -sourceIp &#34;0.0.0.0&#34; \
                   -destIp &#34;255.255.255.255&#34; -opCode &#34;dhcpBootRequest&#34; \
                   -optionCodeList $optionList -clientHwAddr $sourceMac -tag $tag];
            <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DHCP Discover frame : $frame&#34;;
            <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
            <a name="::StopPortsCapture(2)"><a href="./ePTRx.tcl.html#::StopPortsCapture_862">::StopPortsCapture</a></a> $portid;
            set rawPortDataList [<a name="::GetCapturedFrames(2)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portid];
            set Dhcpframe [<a name="::GetDhcpReplyFrame(2)"><a href="./dhcp.tcl.html#::GetDhcpReplyFrame_10">::GetDhcpReplyFrame</a></a> $rawPortDataList $tag];
            set Dhcpaddress &#34;0.0.0.0&#34;;
            if {$Dhcpframe != &#34;no&#34;} {     
                set messagetype [lindex $Dhcpframe 284];  
                set exosMessagetype [lindex $Dhcpframe 290];
               if { $messagetype == &#34;02&#34; || $exosMessagetype == &#34;02&#34;} {
                  <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;DHCP : Got Offer message type from DHCP server&#34;;
                  set Dhcpaddress [<a name="::GetDhcpClientAddr(2)"><a href="./dhcp.tcl.html#::GetDhcpClientAddr_53">::GetDhcpClientAddr</a></a> $Dhcpframe];
                  <a name="::SendDHCPRequest(2)"><a href="./dhcp.tcl.html#::SendDHCPRequest_219">::SendDHCPRequest</a></a> $sourceMac $portid $pserver $Dhcpaddress 1 $tag;
                  <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
               }
         } else {
	    <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Did not receive message offer type from DHCP server&#34;;           
         }
	} else {
	    <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Did not receive message offer type from DHCP server as expected&#34;;           
	}
	    <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;   
    }    
} else {
    <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Did not receive Boot Reply from DHCP server&#34;;
    <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;If this failure is on a 10G xenpak port, try resetting the IXIA Xenpak HW and re-run test&#34;;
puts &#34;--------- negTest --- $negTest&#34;
    if {$negTest == 0} {
	    <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Warning : Did not receive message offer type from DHCP server trying again&#34;;   
            <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;If this failure is on a 10G xenpak port, try resetting the IXIA Xenpak HW and re-run test&#34;;        
            <span class="comment-line">#try to resend the request again</span>
            <a name="::StartPortsCapture(3)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portid;

            <span class="comment-line"># GV 05-06-2011: Sleep needed here for some Ixia's before sending traffic</span>
            <a name="::exSleep(5)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3;

            <span class="comment-line"># --- send DHCP discover</span>
            set frame [<a name="::SendDhcpFrame(3)"><a href="./ePTSendPacket.tcl.html#::SendDhcpFrame_1045">::SendDhcpFrame</a></a> -txPortId $portid -destMac &#34;FF FF FF FF FF FF&#34; \
                   -sourceMac $sourceMac -sourceIp &#34;0.0.0.0&#34; \
                   -destIp &#34;255.255.255.255&#34; -opCode &#34;dhcpBootRequest&#34; \
                   -optionCodeList $optionList -clientHwAddr $sourceMac -tag $tag];
            <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DHCP Discover frame : $frame&#34;;
            <a name="::exSleep(6)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
            <a name="::StopPortsCapture(3)"><a href="./ePTRx.tcl.html#::StopPortsCapture_862">::StopPortsCapture</a></a> $portid;
            set rawPortDataList [<a name="::GetCapturedFrames(3)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portid];
            set Dhcpframe [<a name="::GetDhcpReplyFrame(3)"><a href="./dhcp.tcl.html#::GetDhcpReplyFrame_10">::GetDhcpReplyFrame</a></a> $rawPortDataList $tag];
            set Dhcpaddress &#34;0.0.0.0&#34;;
            if {$Dhcpframe != &#34;no&#34;} {     
                set messagetype [lindex $Dhcpframe 284];  
                set exosMessagetype [lindex $Dhcpframe 290];
               if { $messagetype == &#34;02&#34; || $exosMessagetype == &#34;02&#34;} {
                  <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;DHCP : Got Offer message type from DHCP server&#34;;
                  set Dhcpaddress [<a name="::GetDhcpClientAddr(3)"><a href="./dhcp.tcl.html#::GetDhcpClientAddr_53">::GetDhcpClientAddr</a></a> $Dhcpframe];
                  <a name="::SendDHCPRequest(3)"><a href="./dhcp.tcl.html#::SendDHCPRequest_219">::SendDHCPRequest</a></a> $sourceMac $portid $pserver $Dhcpaddress 1 $tag;
                  <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
               }
           } else {
	       <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Did not receive Boot Reply from DHCP server&#34;;  
               <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;If this failure is on a 10G xenpak port, try resetting the IXIA Xenpak HW and re-run test&#34;;         
           }
    } else {
	<a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Did not receive Boot Reply from DHCP server as expected&#34;;           
    }
    <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;  
}

return $Dhcpaddress;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Function : SendDHCPRequest </span>
<span class="comment-line">#</span>
<span class="comment-line"># Comment  : Send a DHCP request package and wait for ack frame.  </span>
<span class="comment-line">#          </span>
<span class="comment-line"># Option   : </span>
<span class="comment-line">#            sourceMac - source Mac </span>
<span class="comment-line">#            portid - port number </span>
<span class="comment-line">#            serverid - dhcp server identifier</span>
<span class="comment-line">#            requestedipa - requested ipaddress</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendDHCPRequest_219">proc <a href="dhcp.tcl-annot.html#::::SendDHCPRequest">::::SendDHCPRequest</a></a></strong> {sourceMac portid serverid requestedipa {logError 1} {tag none}} {

     puts &#34;tag value in dhcprequest is $tag&#34;
    
    <span class="comment-line"># --- setup option</span>
    set optionList [list dhcpMessageType dhcpRequest];  
    lappend optionList dhcpClientId &#34;01 $sourceMac&#34;;
    lappend optionList dhcpRequestedIPAddr $requestedipa;
    lappend optionList dhcpSvrIdentifier $serverid;
    lappend optionList dhcpHostName &#34;TQUACH&#34;;
    lappend optionList dhcpParamRequestList &#34;01 0F 03 06 2C 2E 2F 1F 21 F9 2B&#34;;  
    <a name="::StartPortsCapture(4)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portid;

    <span class="comment-line"># GV 05-06-2011: Sleep needed here for some Ixia's before sending traffic</span>
    <a name="::exSleep(7)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3;

    <span class="comment-line"># --- send DHCP request</span>
    set frame [<a name="::SendDhcpFrame(4)"><a href="./ePTSendPacket.tcl.html#::SendDhcpFrame_1045">::SendDhcpFrame</a></a> -txPortId $portid -destMac &#34;FF FF FF FF FF FF&#34; \
              -sourceMac $sourceMac -sourceIp &#34;0.0.0.0&#34; \
              -destIp &#34;255.255.255.255&#34; -opCode &#34;dhcpBootRequest&#34; \
              -optionCodeList $optionList -clientHwAddr $sourceMac -tag $tag];
    <span class="comment-line">#result_debug &#34;DHCP request frame : $frame&#34;;</span>
    unset optionList;   
    sleep 20;
    <a name="::StopPortsCapture(4)"><a href="./ePTRx.tcl.html#::StopPortsCapture_862">::StopPortsCapture</a></a> $portid;
    <span class="comment-line"># --- get the reply</span>
    set rawPortDataList [<a name="::GetCapturedFrames(4)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portid];
    set Dhcpframe [<a name="::GetDhcpReplyFrame(4)"><a href="./dhcp.tcl.html#::GetDhcpReplyFrame_10">::GetDhcpReplyFrame</a></a> $rawPortDataList $tag];
    if {$Dhcpframe != &#34;no&#34;} {
        set messagetype [lindex $Dhcpframe 284];
        <span class="comment-line">######### in EXOS a 6 byte address time inserted before message Type</span>
        set exosMessagetype [lindex $Dhcpframe 290];
        if { $messagetype == &#34;05&#34; || $exosMessagetype == &#34;05&#34;} {
            <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;DHCP : Got ACK for IP address $requestedipa from DHCP server&#34;;
            <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;DHCP : Got ACK for IP address $requestedipa from DHCP server&#34;;           
            <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;               
        } else {
	    set msg &#34;Did not receive ACK from DHCP server&#34;;
	    if { $logError } {
		<a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> $msg
		<a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> $msg
		<a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;  
	    } else {
		<a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;$msg&#34;
	    }
        }              
    } else {
	set msg &#34;Did not receive Boot Reply from DHCP server&#34;;
        <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;If this failure is on a 10G xenpak port, try resetting the IXIA Xenpak HW and re-run test&#34;;
	if { $logError } {
	    <a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> $msg
	    <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> $msg
	    <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>; 
	} else {
	    <a name="::result_warning(2)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;$msg&#34;
	}
    }
      
    return $Dhcpframe;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Function : GetDHCPOption </span>
<span class="comment-line">#</span>
<span class="comment-line"># Comment  : Search for dhcp optiion.  </span>
<span class="comment-line">#          </span>
<span class="comment-line"># Option   : </span>
<span class="comment-line">#            dhcpframe</span>
<span class="comment-line">#            option</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDHCPOption_289">proc <a href="dhcp.tcl-annot.html#::::GetDHCPOption">::::GetDHCPOption</a></a></strong> {dhcpframe option} {

    <span class="comment-line">#puts &#34;dhcp frame: $dhcpframe&#34;;   </span>
    <span class="comment-line">#set st 285;</span>
    <span class="comment-line">####EXOS</span>
    set st 291;
    set maxindx [llength $dhcpframe];  
    while {$st &lt; $maxindx} {
        set opcode [expr 0x[lindex $dhcpframe $st]];
        <span class="comment-line">#puts &#34;dhcp frame: [lindex $dhcpframe $st] - $opcode&#34;;</span>
        if {$opcode != $option} {
            incr st;
            set length [expr 0x[lindex $dhcpframe $st]];
            <span class="comment-line">#puts &#34;length: $length&#34;</span>
            incr st $length;
        } else {
            incr st;
            set length [expr 0x[lindex $dhcpframe $st]];                        
            <span class="comment-line">#puts &#34;length: $length&#34;</span>
            set idx $st;
            while {$length &gt; 0} {
                incr idx; 
                set x [expr 0x[lindex $dhcpframe $idx]];
                append val $x;
                incr length -1;
                if {$length &gt; 0} {                     
                    append val &#34;.&#34;;
                }
            }               
            return $val;
            break;
        }
        incr st;
    }  
    return -1;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Function : CheckPortList </span>
<span class="comment-line">#</span>
<span class="comment-line"># Comment  : It will match the string first. Then get the ports and</span>
<span class="comment-line">#            compare them with passing in ports.   </span>
<span class="comment-line">#          </span>
<span class="comment-line"># Option   : </span>
<span class="comment-line">#            command </span>
<span class="comment-line">#            parameter</span>
<span class="comment-line">#            list ports </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckPortList_337">proc <a href="dhcp.tcl-annot.html#::::CheckPortList">::::CheckPortList</a></a></strong> {command parameter lports} {

    set tmp &#34;Tmp&#34;;
    set pwd [pwd];
    if {[regexp -nocase &#34;clitest&#34; $pwd]} {
       global tmpPath;
       set tmp $tmpPath;
    }
    set pid _[pid];
   
    set fd_in [open &#34;$tmp/tmp_GetKeyValue$pid&#34; &#34;w&#34;];
    <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$command&#34; NULL $fd_in;
    close $fd_in;
    
    set fg 0; 
    set fd_in [open &#34;$tmp/tmp_GetKeyValue$pid&#34; &#34;r&#34;];
    while {[gets $fd_in line] != -1} {
        if {[regexp -nocase -indices -- $parameter $line matchedRange] == 1} {
           <span class="comment-line"># -- found the key           </span>
           set keyEnd [expr [lindex $matchedRange 1] + 1];
           set value [string range $line $keyEnd end];
           regsub -all &#34;,&#34; $value &#34; &#34; ports;
           set tmp [lsort -dic $ports];
           set tmp2 [lsort -dic $lports];
           <a name="::report_start_test(9)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking &lt;$command&gt; parameters&#34;;
           if {[string trim $tmp] == [string trim $tmp2]} {                          
               <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check key &lt;$tmp&gt; with &lt;$tmp2&gt; pass&#34;;
           } else {
               <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check key &lt;$tmp&gt; with &lt;$tmp2&gt; fail&#34;;
           }   
           <a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
           set fg 1;
        }
    }
    close $fd_in;
    file delete &#34;$tmp/tmp_GetKeyValue$pid&#34;;
    if {$fg == 0} {
        <a name="::report_start_test(10)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking &lt;$command&gt; parameters&#34;;
        <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check key &lt;$lports&gt; fail&#34;;
        <a name="::report_end_test(10)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
    }
}                
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
