<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>fdb.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#fdb.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>fdb.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="fdb.tcl-annot.html">annotations</a> | <a href="fdb.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Fdb_noData_check_and_analyze  </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	Check fdb table and do analysis</span>
<span class="comment-line">#	Make sure all the expected entries are in fdb</span>
<span class="comment-line">#	This procedure should be the first one to call for fdb checking</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {ipAddr} {fd_res} {testNo} {fd_in}</span>
<span class="comment-line">#	ipAddr is the $DUTx_CONNECT</span>
<span class="comment-line">#	fd_in is the file containing the expected data o check</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns &#34;ok&#34; if success &#34;error&#34; if failure</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set result [Fdb_noData_check_and_analyze $DUT1_CONNECT $fd_res $testNo $fd_in]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::Fdb_data_check_and_analyze_20">proc <a href="fdb.tcl-annot.html#::::Fdb_data_check_and_analyze">::::Fdb_data_check_and_analyze</a></a></strong> {ipAddr fd_res testNo realDataFile} {
   <span class="comment-line"># global variables init</span>
   global spawn_id

   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $ipAddr
   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Fdb_data_check_and_analyze, spawn_id=$spawn_id&#34;

   set totalFdbEntry 100
   set totalExpDataEntry 200		   
   set overflow 0

   for {set f 1} {$f &lt;= 7} {incr f 1} {
      set fdb(1,$f) 5
   }
   for {set r 1} {$r &lt;= 3} {incr r 1} {
      set expData(1,$r) 5
   }

   <span class="comment-line"># check fdb and analyze data</span>
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show fdb&#34; $fd_res $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::Fdb_2_2_Array(1)"><a href="./fdb.tcl.html#::Fdb_2_2_Array_192">::Fdb_2_2_Array</a></a> $fd_in
   close $fd_in

   set fd_exp [open &#34;[<a name="::GetExpDir(1)"><a href="./ePTPortMapping.tcl.html#::GetExpDir_286">::GetExpDir</a></a>]/$realDataFile&#34; &#34;r&#34;]
   <a name="::Exp_entry_mac_vlan_port_info(1)"><a href="./fdb.tcl.html#::Exp_entry_mac_vlan_port_info_305">::Exp_entry_mac_vlan_port_info</a></a> $fd_exp
   close $fd_exp

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::Fdb_overflow(1)"><a href="./fdb.tcl.html#::Fdb_overflow_373">::Fdb_overflow</a></a> $fd_in	$fd_res
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;

   set result [<a name="::Fdb_check_expData(1)"><a href="./fdb.tcl.html#::Fdb_check_expData_404">::Fdb_check_expData</a></a> $fd_res]
   <a name="::logout(1)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>
	 return $result
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Fdb_noData_check_and_analyze  </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	Check fdb table and do analysis</span>
<span class="comment-line">#	Make sure all the unexpected entries are NOT in fdb</span>
<span class="comment-line">#	This procedure should be the first one to call for fdb checking</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {ipAddr} {fd_res} {testNo} {fd_in}</span>
<span class="comment-line">#	ipAddr is the $DUTx_CONNECT</span>
<span class="comment-line">#	fd_in is the file containing the unexpected data o check</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns &#34;ok&#34; if success &#34;error&#34; if failure</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set result [Fdb_noData_check_and_analyze $DUT1_CONNECT $fd_res $testNo $fd_in]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::Fdb_noData_check_and_analyze_80">proc <a href="fdb.tcl-annot.html#::::Fdb_noData_check_and_analyze">::::Fdb_noData_check_and_analyze</a></a></strong> {ipAddr fd_res testNo realDataFile} {
   <span class="comment-line"># global variables init</span>
   global spawn_id

   <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $ipAddr
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Fdb_data_check_and_analyze, spawn_id=$spawn_id&#34;

   set totalFdbEntry 100
   set totalExpNoDataEntry 10
   set overflow 0

   for {set f 1} {$f &lt;= 7} {incr f 1} {
      set fdb(1,$f) 5
   }
   for {set r 1} {$r &lt;= 3} {incr r 1} {
      set expNoData(1,$r) 5
   }

   <span class="comment-line"># check fdb and analyze data</span>
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show fdb&#34; $fd_res $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::Fdb_2_2_Array(2)"><a href="./fdb.tcl.html#::Fdb_2_2_Array_192">::Fdb_2_2_Array</a></a> $fd_in
   close $fd_in

   set fd_expNo [open &#34;[<a name="::GetExpDir(2)"><a href="./ePTPortMapping.tcl.html#::GetExpDir_286">::GetExpDir</a></a>]/$realDataFile&#34; &#34;r&#34;]
   <a name="::Exp_noEntry_mac_vlan_port_info(1)"><a href="./fdb.tcl.html#::Exp_noEntry_mac_vlan_port_info_340">::Exp_noEntry_mac_vlan_port_info</a></a> $fd_expNo
   close $fd_expNo

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::Fdb_overflow(2)"><a href="./fdb.tcl.html#::Fdb_overflow_373">::Fdb_overflow</a></a> $fd_in	$fd_res
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;

   set result [<a name="::Fdb_check_expNoData(1)"><a href="./fdb.tcl.html#::Fdb_check_expNoData_458">::Fdb_check_expNoData</a></a> $fd_res]
   <a name="::logout(2)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>
	 return $result
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Fdb_check_aging_out  </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	Check fdb table to make sure all the dynamic entries</span>
<span class="comment-line">#	are all aging out</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {ipAddr} {fd_res} {testNo}</span>
<span class="comment-line">#	ipAddr is the $DUTx_CONNECT</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns &#34;ok&#34; if success &#34;error&#34; if failure</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set result [Fdb_check_aging_out $DUT1_CONNECT $fd_res $testNo]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::Fdb_check_aging_out_138">proc <a href="fdb.tcl-annot.html#::::Fdb_check_aging_out">::::Fdb_check_aging_out</a></a></strong> {ipAddr fd_res testNo} {
   <span class="comment-line"># global variables init</span>
   global spawn_id

   <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $ipAddr
   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Fdb_check_aging_out, spawn_id=$spawn_id&#34;

   set totalFdbEntry 100
   set totalExpDataEntry 200
   set overflow 0

   for {set f 1} {$f &lt;= 7} {incr f 1} {
      set fdb(1,$f) 5
   }
   for {set r 1} {$r &lt;= 3} {incr r 1} {
      set expData(1,$r) 5
   }

   <span class="comment-line"># check fdb and analyze data</span>
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show fdb&#34; $fd_res $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::Fdb_2_2_Array(3)"><a href="./fdb.tcl.html#::Fdb_2_2_Array_192">::Fdb_2_2_Array</a></a> $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::Fdb_overflow(3)"><a href="./fdb.tcl.html#::Fdb_overflow_373">::Fdb_overflow</a></a> $fd_in	$fd_res
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;

   set __res [<a name="::Fdb_check_all_aging_out(1)"><a href="./fdb.tcl.html#::Fdb_check_all_aging_out_511">::Fdb_check_all_aging_out</a></a> $fd_res]
   <a name="::logout(3)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>

	 return $__res
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Fdb_2_2_Array</span>
<span class="comment-line">#	Break a &#34;show fdb&#34; data into a 2x2 array fdb(N,M) and </span>
<span class="comment-line">#	find the overflow info.</span>
<span class="comment-line">#	fdb array, overflow and totalFdbEntry variables are all global</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {fd_in}</span>
<span class="comment-line">#	fd_in is the file containing the &#34;show fdb&#34; data</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#	fdb array, overflow and totalFdbEntry variables</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#        Fdb_2_2_Array $fd_in</span>
<span class="comment-line"># Category: </span>
<span class="comment-line">######################################################################</span>

<strong><a name="::::Fdb_2_2_Array_192">proc <a href="fdb.tcl-annot.html#::::Fdb_2_2_Array">::::Fdb_2_2_Array</a></a></strong> {fd} {
   <span class="comment-line"># Get the current FDB data</span>
   global fdb
   global overflow
   global totalFdbEntry
   global spawn_id

   set fdbCount 0
                             ;<span class="comment-line"># no. of fdb entries</span>
   while {[gets $fd rawLine] != -1} {         ;<span class="comment-line"># get a line</span>
      set cookedLine [<a name="::cookString(1)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $rawLine]
<span class="comment-line">#      result_debug &#34;----- rawLine=$rawLine&#34;</span>
<span class="comment-line">#	   result_debug &#34;----- cookedLine=$cookedLine&#34;</span>
      set aList [split $cookedLine] 
				             ;<span class="comment-line"># n spaces are counted as</span>
                                           ;<span class="comment-line">#    n elements</span>
      set lineLength [llength $aList]
      set firstCol [lindex $aList 0]
      set lastCol  [lindex $aList [expr $lineLength-1]]

      if { [regexp {([0-9a-fA-F]+)-([0-9a-fA-F]+)} $firstCol] } {
                                           ;<span class="comment-line"># If the first element is</span>
                                           ;<span class="comment-line">#    an index, it's a fdb entry</span>
         set fdbCount [expr $fdbCount+1]
         set elementCount 0                ;<span class="comment-line"># no. of elements in an entry.</span>
                                           ;<span class="comment-line">#    should be 7 (ports are</span>
                                           ;<span class="comment-line">#    treated as 1 element</span>

         for {set i 0} {$i &lt;= 1} {incr i 1} {
            set tmp [lindex $aList $i]
            set elementCount [expr $i+1]
            set fdb($fdbCount,$elementCount) $tmp
<span class="comment-line">#            result_debug &#34;======== fdb(  $fdbCount, $elementCount ) = $tmp&#34;</span>
         }
         set tmp [lindex $aList 2]	;<span class="comment-line"># for vlan</span>
		 set tmpLength [string length $tmp]
		 set vlanLength  [expr $tmpLength - 7]
		 set vlanName [string range $tmp 0 $vlanLength]
         set elementCount [expr $i+1]
         set fdb($fdbCount,$elementCount) $vlanName

         for {set i 3} {$i &lt;= 5} {incr i 1} {
            set tmp [lindex $aList $i]
            set elementCount [expr $i+1]
            set fdb($fdbCount,$elementCount) $tmp
<span class="comment-line">#            result_debug &#34;======== fdb(  $fdbCount, $elementCount ) = $tmp&#34;</span>
         }

         set fdb($fdbCount,7) [lrange $aList 6 end] ;<span class="comment-line"># for fdbN(7): ports</span>
         set tmp [lrange $aList 6 end]
<span class="comment-line">#         result_debug &#34;======== fdb(  $fdbCount, 7 ) = $tmp&#34;</span>
      } elseif {[string tolower $firstCol] == &#34;total:&#34;} {   ;<span class="comment-line"># to find the overflow info.</span>
         set overflow $lastCol
<span class="comment-line">#         result_debug &#34;============= overflow=$overflow|&#34;</span>
      }
   }
   set totalFdbEntry $fdbCount
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Decode_ports_string </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	To break a ports string into an array of ports</span>
<span class="comment-line">#	put the data to expData array, and set up totalExpDataEntry</span>
<span class="comment-line">#	variable</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {entry} {fd}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: {portArray}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#        Decode_ports_string $real_ports rArray $fd</span>
<span class="comment-line"># Category: </span>
<span class="comment-line">######################################################################</span>

<strong><a name="::::Decode_ports_string_268">proc <a href="fdb.tcl-annot.html#::::Decode_ports_string">::::Decode_ports_string</a></a></strong> {entry portArray fd} {
   global spawn_id
   upvar $portArray port
   set aList [split $entry \ ,]
   set numPorts [llength $aList]           ;<span class="comment-line"># total no. of ports</span>
<span class="comment-line">#puts &#34;numPorts: $numPorts entry: $entry aList: $aList&#34;</span>
   for {set i 0} {$i &lt; $numPorts} {incr i 1} {
      set tmp [lindex $aList $i]
<span class="comment-line">#    result_debug &#34;*** tmp=$tmp|&#34;</span>
	  if {$tmp != &#34;&#34;} {
	     if {$tmp != &#34;{}&#34;} {
            set count [expr $i+1]
            set port($count) $tmp
<span class="comment-line">#            result_debug &#34;*** port ($count)=$tmp&#34;</span>
         }
      }
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Exp_entry_mac_vlan_port_info </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	Read the expected config data from file descriptor fd</span>
<span class="comment-line">#	put the data to expData array, and set up totalExpDataEntry</span>
<span class="comment-line">#	variable</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {fd}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	global expData totalExpNoDataEntry</span>
<span class="comment-line">#       Exp_entry_mac_vlan_port_info $fd_in</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">######################################################################</span>

<strong><a name="::::Exp_entry_mac_vlan_port_info_305">proc <a href="fdb.tcl-annot.html#::::Exp_entry_mac_vlan_port_info">::::Exp_entry_mac_vlan_port_info</a></a></strong> {fd} {
   global spawn_id
   global expData
   global totalExpDataEntry
   set count 0
   while {[gets $fd line] != -1} {
      if { $line != &#34;&#34; } {
         set count [expr $count+1]
         set aList [split $line]
         set expData($count,1) [lindex $aList 0]      ;<span class="comment-line"># mac</span>
         set expData($count,2) [lindex $aList 1]      ;<span class="comment-line"># vlan</span>
         set expData($count,3) [lrange $aList 2 end]  ;<span class="comment-line"># ports</span>
      }
   }
   set totalExpDataEntry $count
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Exp_noEntry_mac_vlan_port_info </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	Read the unexpected config data from file descriptor fd,</span>
<span class="comment-line">#	put the data to expNoData array, and set up totalExpNoDataEntry</span>
<span class="comment-line">#	variable</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {fd}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	global expNoData totalExpNoDataEntry</span>
<span class="comment-line">#       Exp_noEntry_mac_vlan_port_info $fd_in</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">######################################################################</span>

<strong><a name="::::Exp_noEntry_mac_vlan_port_info_340">proc <a href="fdb.tcl-annot.html#::::Exp_noEntry_mac_vlan_port_info">::::Exp_noEntry_mac_vlan_port_info</a></a></strong> {fd} {
   global spawn_id
   global expNoData
   global totalExpNoDataEntry
   set count 0
   while {[gets $fd line] != -1} {
      if { $line != &#34;&#34; } {
         set count [expr $count+1]
         set aList [split $line]
         set expNoData($count,1) [lindex $aList 0]      ;<span class="comment-line"># mac</span>
         set expNoData($count,2) [lindex $aList 1]      ;<span class="comment-line"># vlan</span>
         set expNoData($count,3) [lrange $aList 2 end]  ;<span class="comment-line"># ports</span>
      }
   }
   set totalExpNoDataEntry $count
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Fdb_overflow  </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	To find the overflow info.  return # of packets dropped</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {fd_in} {fd_res}</span>
<span class="comment-line">#	fd_in is the file contains the &#34;show fdb ...&#34; output</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns # of packets dropped</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	global overflow</span>
<span class="comment-line">#       Fdb_overflow $fd_in $fd_res</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::Fdb_overflow_373">proc <a href="fdb.tcl-annot.html#::::Fdb_overflow">::::Fdb_overflow</a></a></strong> {fd_in fd_res} {
   global spawn_id
   while {[gets $fd_in line] != -1} {         ;<span class="comment-line"># get a line</span>
      set aList [split [string tolower $line]]              ;<span class="comment-line"># n spaces are counted as</span>
     <span class="comment-line"># set aList [split $line]              ;# n spaces are counted as</span>
                                           ;<span class="comment-line">#    n elements</span>
      if {[lindex $aList 0] == &#34;total:&#34;} { ;<span class="comment-line"># to find the overflow info.</span>
         global overflow
         set overflow [lindex $aList end]
         <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;overflow=$overflow&#34;
         return overflow
      }
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Fdb_check_expData   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	Check if there is any expected fdb entry missing</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {fd}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns &#34;ok&#34; if all expected data presented, </span>
<span class="comment-line">#         &#34;error&#34; if there is any expected data missing</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set result [Fdb_check_expData $fd_res]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################  </span>

<strong><a name="::::Fdb_check_expData_404">proc <a href="fdb.tcl-annot.html#::::Fdb_check_expData">::::Fdb_check_expData</a></a></strong> {fd} {
   global spawn_id
   global totalExpDataEntry
   global totalFdbEntry
   global fdb
   global expData
   set result &#34;ok&#34;
   for {set r 1} {$r &lt;= $totalExpDataEntry} {incr r 1} {     ;<span class="comment-line"># expData</span>
      set tmp_result &#34;error&#34;
      for {set f 1} {$f &lt;= $totalFdbEntry} {incr f 1} {	      ;<span class="comment-line"># fdb</span>
<span class="comment-line">#		  result_debug &#34;--- fdb($f)=$fdb(${f},1) $fdb(${f},2) $fdb(${f},3)&#34;</span>
<span class="comment-line">#         result_debug &#34;---    $fdb(${f},4) $fdb(${f},5) $fdb(${f},6) $fdb(${f},7)&#34;</span>
	     if {$fdb(${f},5) == {d}} {				              ;<span class="comment-line"># dynamic entry</span>
		    if {$fdb(${f},2) == $expData(${r},1)} {          ;<span class="comment-line"># mac</span>
			   if {$fdb(${f},3) == $expData(${r},2)} {       ;<span class="comment-line"># vlan</span>
			      if {[<a name="::Ports_check(1)"><a href="./fdb.tcl.html#::Ports_check_560">::Ports_check</a></a> $fdb(${f},7) $expData(${r},3) $fd] == &#34;ok&#34;} { ;<span class="comment-line"># ports</span>
				     set tmp_result &#34;ok&#34;
					 break
				  }
			   }
			}
		 }
	  }
      if { $tmp_result == &#34;error&#34; } {
         set result &#34;error&#34;
	    <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$expData(${r},1), $expData(${r},2), $expData(${r},3) mssing&#34;
      }
   }
   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check fdb expected data&#34;
   if {$result == &#34;ok&#34;} {
      <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check fdb expected data passed&#34;
   } else {
	  <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check fdb expected data failed&#34;
   }
   <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $result
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Fdb_check_expNoData   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	Check if there is any unexpected fdb entry appearing</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {fd}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns &#34;ok&#34; if no unexpected data, </span>
<span class="comment-line">#         &#34;error&#34; if there is any unexpected data</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set result [Fdb_check_expNoData $fd_res]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################  </span>

<strong><a name="::::Fdb_check_expNoData_458">proc <a href="fdb.tcl-annot.html#::::Fdb_check_expNoData">::::Fdb_check_expNoData</a></a></strong> {fd} {
   global spawn_id
   global totalExpNoDataEntry
   global totalFdbEntry
   global fdb
   global expNoData
   set result &#34;ok&#34;
   for {set r 1} {$r &lt;= $totalExpNoDataEntry} {incr r 1} {     ;<span class="comment-line"># expData</span>
      set tmp_result &#34;ok&#34;
      for {set f 1} {$f &lt;= $totalFdbEntry} {incr f 1} {	      ;<span class="comment-line"># fdb</span>
<span class="comment-line">#			result_debug &#34;--- fdb($f)=$fdb(${f},1) $fdb(${f},2) $fdb(${f},3)&#34;</span>
<span class="comment-line">#			result_debug &#34;---    $fdb(${f},4) $fdb(${f},5) $fdb(${f},6) $fdb(${f},7)&#34;</span>
	     if {$fdb(${f},5) == {d}} {				              ;<span class="comment-line"># dynamic entry</span>
		    if {$fdb(${f},2) == $expNoData(${r},1)} {          ;<span class="comment-line"># mac</span>
			   if {$fdb(${f},3) == $expNoData(${r},2)} {       ;<span class="comment-line"># vlan</span>
			      if {[<a name="::Ports_check(2)"><a href="./fdb.tcl.html#::Ports_check_560">::Ports_check</a></a> $fdb(${f},7) $expNoData(${r},3) $fd] == &#34;ok&#34;} { ;<span class="comment-line"># ports</span>
				     set tmp_result &#34;error&#34;
					 break
				  }
			   }
			}
		 }
	  }
      if { $tmp_result == &#34;error&#34; } {
         set result &#34;error&#34;
	     <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$expNoData(${r},1), $expNoData(${r},2), $expNoData(${r},3) appearing&#34;
      }
   }
   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check fdb unexpected data&#34;
   if {$result == &#34;ok&#34;} {
      <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check fdb unexpected data passed&#34;
   } else {
	  <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check fdb unexpected data failed&#34;
   }
   <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $result
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Fdb_check_all_aging_out  </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	Check if all dynamic entries in FDB all aging out</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {fd}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns &#34;ok&#34; if success &#34;error&#34; if failure</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set result [Fdb_check_all_aging_out $fd_res]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::Fdb_check_all_aging_out_511">proc <a href="fdb.tcl-annot.html#::::Fdb_check_all_aging_out">::::Fdb_check_all_aging_out</a></a></strong> {fd} {
   global spawn_id
   global totalExpNoDataEntry
   global totalFdbEntry
   global fdb
   global expNoData
   set result &#34;ok&#34;
   global switchPort2DefaultRouter
   set ignorePort [<a name="::GetDUTPort(1)"><a href="./ePTPortMapping.tcl.html#::GetDUTPort_78">::GetDUTPort</a></a> $switchPort2DefaultRouter]
   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Ignore Port: $ignorePort&#34;
   for {set f 1} {$f &lt;= $totalFdbEntry} {incr f 1} {	      ;<span class="comment-line"># fdb</span>
      set tmp_result &#34;ok&#34;
      if {$fdb(${f},5) == {d}} {  ;<span class="comment-line"># dynamic entry</span>
<span class="comment-line">#         result_debug &#34;----------------- fdb(${f},7) = $fdb(${f},7)\n&#34;</span>
         if {[<a name="::Ports_check(3)"><a href="./fdb.tcl.html#::Ports_check_560">::Ports_check</a></a> $fdb(${f},7) $ignorePort $fd] != &#34;ok&#34;} { ;<span class="comment-line"># ports</span>
         set tmp_result &#34;error&#34;
				 <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;not aging out -- $fdb(${f},2) $fdb(${f},3) $fdb(${f},5) $fdb(${f},7)&#34;
         }
      }
      if { $tmp_result == &#34;error&#34; } {
         set result &#34;error&#34;
      }
   }

   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check fdb aging out&#34;
   if {$result == &#34;ok&#34;} {
      <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Fdb all aging out properly&#34;
   } else {
	  <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Fdb failed to age out properly&#34;
   }
   <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $result
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: Ports_check   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#	For a fdb entry, check if there is any port missing</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {fdb_ports} {real_ports} {fd}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns &#34;ok&#34; if no port missing, &#34;error&#34; if any port missing</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set result [check_fdb_learn $portNo $conf $fd_res $testNo]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################  </span>

<strong><a name="::::Ports_check_560">proc <a href="fdb.tcl-annot.html#::::Ports_check">::::Ports_check</a></a></strong> {fdb_ports real_ports fd} {
   global spawn_id
<span class="comment-line">#   result_debug &#34;-------- real_ports=$real_ports&#34;</span>
<span class="comment-line">#	 result_debug &#34;-------- fdb_ports=$fdb_ports&#34;</span>

   set result &#34;ok&#34;
   <a name="::Decode_ports_string(1)"><a href="./fdb.tcl.html#::Decode_ports_string_268">::Decode_ports_string</a></a> $real_ports rArray $fd	    ;<span class="comment-line"># real ports</span>
   <a name="::Decode_ports_string(2)"><a href="./fdb.tcl.html#::Decode_ports_string_268">::Decode_ports_string</a></a> $fdb_ports fArray $fd	    ;<span class="comment-line"># fdb ports</span>
   set rSize [array size rArray]
   set fSize [array size fArray]

   for {set r 1} {$r &lt;= $rSize} {incr r 1} {    ;<span class="comment-line"># real port array</span>
      set tmp_result &#34;error&#34;
      for {set f 1} {$f &lt;= $fSize} {incr f 1} {	;<span class="comment-line"># fdb port array</span>
         if { $rArray($r) == $fArray($f) } {
            set tmp_result &#34;ok&#34;
            break
         }
      }
      if { $tmp_result == &#34;error&#34; } {
	     set result &#34;error&#34;
         <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;port $rArray($r) is missing&#34;
      }
   }
   return $result
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: check_fdb_learn   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line"># 	Send &#34;show port xxx info&#34; and analyze the returned data</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {portNo} {conf} {fd} {testNo}</span>
<span class="comment-line">#	conf can be either enable or disable</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	check_fdb_learn $portNo $conf $fd_res $testNo</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################  </span>

<strong><a name="::::check_fdb_learn_602">proc <a href="fdb.tcl-annot.html#::::check_fdb_learn">::::check_fdb_learn</a></a></strong> {portNo conf fd testNo}  {
   global spawn_id
   global VERSION

   set fd_conf [open &#34;Tmp/conf_$testNo[pid]&#34; &#34;w&#34;]
   switch $VERSION {
      6 { <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show port $portNo info de&#34; $fd $fd_conf	}
	  default { <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show port $portNo info&#34; $fd $fd_conf }
   }
   close $fd_conf

   set fd_conf [open &#34;Tmp/conf_$testNo[pid]&#34; &#34;r&#34;]
   set result [<a name="::check_fdb_learn_conf(1)"><a href="./fdb.tcl.html#::check_fdb_learn_conf_644">::check_fdb_learn_conf</a></a> $fd $fd_conf]
   close $fd_conf
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;

   <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check MAC learning&#34;
   if {$result == $conf} {
      <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check MAC Learning passed&#34;
   } else {
      <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check MAC Learning failed&#34;
   }
   <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: check_fdb_learn_conf    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line"># 	Check &#34;MAC Learning&#34; from &#34;show port xxx info&#34; output that has</span>
<span class="comment-line">#		been saved in a file</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {fd} {fd_conf}</span>
<span class="comment-line">#	fd_conf is the file that already contains the output from</span>
<span class="comment-line">#		&#34;show port xxx info&#34;</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Retuen enable, disable or error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	   set result [check_fdb_learn_conf $fd $fd_conf]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################  </span>

<strong><a name="::::check_fdb_learn_conf_644">proc <a href="fdb.tcl-annot.html#::::check_fdb_learn_conf">::::check_fdb_learn_conf</a></a></strong> {fd_res fd_conf} {
   global spawn_id
   global VERSION

   while {[gets $fd_conf rawLine] != -1} {         ;<span class="comment-line"># get a line</span>
      set cookedLine [string trimleft [string tolower $rawLine] &#34; \t&#34;]

      switch $VERSION {
         6 { set target &#34;learning:&#34;
             set index1 8
             set index2 10	}
	     default { set target &#34;mac learning:&#34;
	         set index1 12
	         set index2 14  }
      }
	  set keyWord [string range $cookedLine 0 $index1\t]
puts &#34;keyWord=$keyWord&#34;
puts &#34;target=$target&#34;

	  if {$keyWord == $target} {
	     set conf [string range $cookedLine $index2 end]
	     <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- MAC Learning is ${conf}&#34;
	     return $conf
	  }
   }
   <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Can't find MAC Learning info in show port info&#34;
   return error
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckFdb    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This proc is a wrapper function of </span>
<span class="comment-line">#		CheckKeyValue &#34;show fdb&#34; $parameterList.</span>
<span class="comment-line">#	Check fdb table, by passing in a list instead of a file</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: {checkMACList} {fd} {testNo}</span>
<span class="comment-line">#	checkMACList is a list of mac, vlan, and ports</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns &#34;ok&#34; if success &#34;error&#34; if failure</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set returnFlag [CheckFdb $checkMACList $fd_res $testNo]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################  </span>

<strong><a name="::::CheckFdb_690">proc <a href="fdb.tcl-annot.html#::::CheckFdb">::::CheckFdb</a></a></strong> {checkMACList fd_res testNo} {
   global DUTs_info whichDutNow pioneerPlatform
   foreach checkMAC $checkMACList {
      set mac  [lindex $checkMAC 0]       ;<span class="comment-line"># mac</span>
      set vlan [lindex $checkMAC 1]       ;<span class="comment-line"># vlan</span>
      set port [lindex $checkMAC 2]       ;<span class="comment-line"># ports</span>
      set wantResult [lindex $checkMAC 3]
      if {$wantResult == &#34;notExist&#34;} {
         lappend parameterList &#34;{$mac .*$vlan.* d .* $port} $wantResult&#34;
      } else {
         lappend parameterList &#34;{$mac .*$vlan.*d.*m} $port&#34;
      }
   }
   if {[regexp -nocase $pioneerPlatform $DUTs_info(DUT$whichDutNow,platform)]} {
        set retValue [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show fdb&#34; $parameterList -reportResults &#34;0&#34; -showError &#34;false&#34;]
   } else {
        set retValue [<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show fdb&#34; $parameterList]
   }
   if { $retValue == &#34;ok&#34; } {
       return $retValue
   } elseif {[regexp -nocase $pioneerPlatform $DUTs_info(DUT$whichDutNow,platform)]} {
       set retValue &#34;ok&#34;
       set fdbCheck &#34;ok&#34;
       foreach checkMAC $checkMACList {
            set mac  [lindex $checkMAC 0]       ;<span class="comment-line"># mac</span>
            set vlan [lindex $checkMAC 1]       ;<span class="comment-line"># vlan</span>
            set port [lindex $checkMAC 2]       ;<span class="comment-line"># ports</span>
            set wantResult [lindex $checkMAC 3]
            set parameterList &#34;&#34;
            if {$wantResult == &#34;notExist&#34;} {
                 lappend parameterList &#34;{$mac.*$vlan.*$port} $wantResult&#34;
            } else {
                  lappend parameterList &#34;{$mac.*$vlan.*$port} exist&#34;
            }
            set retValue [<a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show fdb hardware $mac $vlan slot all&#34; $parameterList]
            if { $retValue != &#34;ok&#34; } {
              set fdbCheck &#34;error&#34;
            }
      }
      return $fdbCheck
   } else {
       return $retValue 
   }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
