<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ixiaInfo.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ixiaInfo.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ixiaInfo.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ixiaInfo.tcl-annot.html">annotations</a> | <a href="ixiaInfo.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>

package require Tclx
source ../Lib/mainLib.tcl
<span class="comment-line">#package require IxTclHal</span>
<span class="comment-line"># Connect to chassis and get chassis ID</span>

<span class="comment-line">#set hostList {&#34;10.68.7.90&#34; &#34;10.68.7.91&#34; &#34;10.68.4.3&#34; &#34;10.68.40.50&#34; &#34;10.68.1.73&#34; &#34;10.68.1.74&#34; &#34;10.68.1.42&#34; &#34;10.67.40.200&#34; \</span>
<span class="comment-line">#              &#34;10.68.102.100&#34; &#34;10.68.103.100&#34; &#34;10.68.105.111&#34; &#34;10.68.105.100&#34;}</span>

<span class="comment-line">#set hostList {&#34;10.69.1.247&#34; &#34;10.120.40.113&#34; &#34;10.127.13.249&#34; &#34;10.127.7.226&#34; &#34;10.127.8.127&#34; &#34;10.222.1.201&#34; &#34;10.50.3.30&#34; &#34;10.50.3.71&#34; &#34;10.51.3.30&#34; &#34;10.52.2.188&#34; &#34;10.52.2.189&#34; &#34;10.52.8.62&#34; &#34;10.59.1.99&#34; &#34;10.67.40.200&#34; &#34;10.68.1.42&#34; &#34;10.68.1.73&#34; &#34;10.68.1.74&#34; &#34;10.68.102.100&#34; &#34;10.68.103.100&#34; &#34;10.68.105.100&#34; &#34;10.68.105.111&#34; &#34;10.68.4.3&#34; &#34;10.68.40.50&#34; &#34;10.68.7.90&#34; &#34;10.68.7.91&#34; &#34;10.69.1.201&#34; &#34;10.69.1.205&#34; &#34;10.69.1.213&#34; &#34;10.69.1.216&#34; &#34;10.69.1.224&#34; &#34;10.69.1.227&#34; &#34;10.69.1.228&#34; &#34;10.69.1.251&#34; &#34;10.69.5.150&#34; &#34;10.69.5.151&#34; &#34;10.69.5.153&#34; &#34;10.69.5.154&#34; &#34;10.69.6.110&#34; &#34;10.69.6.111&#34;}</span>

<span class="comment-line">#set hostList {&#34;10.69.1.125&#34; &#34;10.66.1.9&#34; &#34;10.66.65.50&#34; &#34;10.68.61.51&#34; &#34;10.120.40.113&#34; &#34;10.127.13.249&#34; &#34;10.127.7.226&#34; &#34;10.127.8.127&#34; &#34;10.222.1.201&#34; &#34;10.50.3.30&#34; &#34;10.50.3.71&#34; &#34;10.51.3.30&#34; &#34;10.52.2.188&#34; &#34;10.52.2.189&#34; &#34;10.52.8.62&#34; &#34;10.59.1.99&#34; &#34;10.67.40.200&#34; &#34;10.68.1.42&#34; &#34;10.68.1.73&#34; &#34;10.68.1.74&#34; &#34;10.68.102.100&#34; &#34;10.68.103.100&#34; &#34;10.68.105.100&#34; &#34;10.68.105.111&#34; &#34;10.68.40.50&#34; &#34;10.68.7.90&#34; &#34;10.68.7.91&#34; &#34;10.69.1.201&#34; &#34;10.69.1.205&#34; &#34;10.69.1.213&#34; &#34;10.69.1.216&#34; &#34;10.69.1.224&#34; &#34;10.69.1.227&#34; &#34;10.69.1.228&#34; &#34;10.69.1.251&#34; &#34;10.69.5.150&#34; &#34;10.69.5.151&#34; &#34;10.69.5.153&#34; &#34;10.69.5.154&#34; &#34;10.69.6.110&#34; &#34;10.69.6.111&#34; &#34;10.127.9.206&#34; &#34;10.127.13.150&#34; &#34;10.69.1.229&#34; &#34;10.69.5.160&#34; &#34;10.68.4.3&#34; &#34;10.68.105.111&#34; &#34;10.127.4.36&#34; &#34;10.69.5.152&#34; &#34;10.69.1.246&#34; &#34;10.69.1.247&#34;}</span>

load [lindex [glob &#34;/usr/lib/libexpect*so*&#34;] 0]

set LIB_PATH ../Lib
lappend auto_path $LIB_PATH

puts &#34;DEBUG: Appending $LIB_PATH to autopath:$auto_path&#34;
<a name="::::gen_index(1)"><a href="./summarize.tcl.html#::::gen_index_76">::::gen_index</a></a> &#34;./../Lib&#34;

set tmplist [<a name="::egrep_unique(1)"><a href="./dynamic_reg.tcl.html#::egrep_unique_1">::egrep_unique</a></a> -f &#34;ixiaCh.*10\.6|ixiaCh.*10\.12&#34; -t cfg -ext cfg -option &#34;-h&#34;]
set hostList &#34;&#34;
foreach mh $tmplist {
    set hip [lindex $mh 2]
    set hip [string trim $hip &#34;;&#34;]
    lappend hostList $hip
}
set hostList [lsort -unique $hostList]
puts $hostList

if [catch {source &#34;../main/cfg/common.cfg&#34;} rea] {
    puts &#34;*** WARNING: Unable to source common.cfg:$rea............... ***&#34;
    puts &#34;*** WARNING: Application level variables may not be defined. ***&#34;
    exit -1
}


set cTime [clock seconds]
set ixiaDirs [glob -nocomplain -- /auto/ixia_*]


set cList &#34;&#34;
set gfList &#34;&#34;
set mdList &#34;&#34;
set fd_in [open &#34;./Tmp/ixia_inventory.csv&#34; &#34;w&#34;]

set cCount 1
puts $hostList
puts $fd_in &#34;,,,,&#34;
puts $fd_in &#34;,,,,&#34;
puts $fd_in &#34;IXIAs,,,,&#34;
puts $fd_in &#34;,,,,&#34;

set timeout 10
foreach  hostname $hostList {
    puts &#34;HERE GOES FOR $hostname&#34;
    <span class="comment-line">#set timeout 10</span>
    set send_human {.1 .3 1 .05 2}
    set telnetOK 1
    <span class="comment-line">#set send_slow {10 .001}</span>
    <span class="comment-line"># Get the chassis serial number</span>
    if [catch &#34;spawn telnet $hostname&#34; reason] {
        puts &#34;failed to spawn program: $reason\n&#34;
        puts $fd_in &#34;$hostname,NO TELENT ACCESS,,,&#34;
        set label1 &#34;Not Available&#34;
    }
    expect {
        &#34;?nable to ?onnect&#34; {
            puts &#34;failed to connect to ixia&#34;
            puts $fd_in &#34;$hostname,NO TELENT ACCESS,,,&#34;
            set label1 &#34;Not Available&#34;
            set telnetOK 0
            continue
        }
        &#34;?o route to ?ost&#34; {
            puts &#34;failed to connect to ixia&#34;
            set label1 &#34;Not Available&#34;
            puts $fd_in &#34;$hostname,NO TELENT ACCESS,,,&#34;
            set telnetOK 0
            continue
        }
        &#34;?onnection refused&#34; {
            puts &#34;failed to connect to ixia&#34;
            set label1 &#34;Not Available&#34;
            puts $fd_in &#34;$hostname,NO TELENT ACCESS,,,&#34;
            set telnetOK 0
        }
        &#34;?onnected to&#34; {
        <span class="comment-line">#wait for all remaining characters to come</span>
        <span class="comment-line">#puts &#34;Connection established&#34;</span>
        }
        timeout {
            puts $fd_in &#34;$hostname,NO TELENT ACCESS,,,&#34;
            set telnetOK 0
        }
    }

    if {$telnetOK} {
        set label2 &#34;&#34;
        set label1 &#34;&#34;
        set dummy &#34;&#34;
        sleep 2
        send  &#34;\r&#34;
        <span class="comment-line">#sleep 2</span>
        expect &#34;&gt;&#34;
        sleep 1
        send -h &#34;puts \$env(COMPUTERNAME)\r&#34;
        sleep 2
        expect {
            -re \[A-Z0-9]+\-\[A-Z0-9]+\-\[A-Z0-9]+ {
                if {[regexp -nocase {([A-Z0-9]+\-[A-Z0-9]+\-[A-Z0-9]+)} $expect_out(buffer) dummy label1]} {
                    puts &#34;Found regexp Chassis ID dummy $dummy label1 $label1&#34;
                }
            }
            -re \[A-Z0-9]+\-\[A-Z0-9]+ {
                if {[regexp -nocase {([A-Z0-9]+\-[A-Z0-9]+)} $expect_out(buffer) dummy label1]} {
                    puts &#34;Found regexp Chassis ID dummy $dummy label1 $label1&#34;
                }
            }
            -re \[A-Z]+\[0-9]+ {
                if [regexp -nocase -all {(OPT[A-Z0-9]+|[0-9A-Z]+)} $expect_out(buffer) dummy label1] {
                    puts &#34;Found regexp Chassis ID dummy $dummy label1 $label1&#34;
                }
            }
            timeout {
                set label1 &#34;NOT AVAILABLE&#34;
                puts &#34;Hit timeout $expect_out(buffer)&#34;
            }
        }
        send -h &#34;puts \$env(IXTCLHAL_LIBRARY)\r&#34;
        sleep 2
        expect {
            -re &#34;.*no such.*&#34; {
                set label2 &#34;4.10&#34;
            }
            -re \[0-9]+\.\[0-9]+ {
                if {[regexp -nocase {([0-9]+\.[0-9]+)} $expect_out(buffer) dummy label2]} {
                    puts &#34;Found regexp Ixia Version dummy $dummy label2 $label2&#34;
                }
            }
            timeout {
                set label2 &#34;4.10&#34;
                puts &#34;Hit timeout $expect_out(buffer)&#34;
            }
        }
        catch {exp_close}
        catch {wait}
    } else {
        puts $fd_in &#34;$hostname,NO TELENT ACCESS,,,&#34;
        continue
    }

    set foundDir 0
    if {$label2 != &#34;&#34;} {
        set bList [split $label2 &#34;.&#34;]
        set bString &#34;[lindex $bList 0]_[lindex $bList 1]&#34; 
        foreach id $ixiaDirs {
            puts &#34;Looking for $bString in $id&#34;
            if {[regexp -nocase $bString $id]} {
                set foundDir 1
                puts &#34;Found ixia version dir $id&#34;
                break
            }
        }
    }
    if {!$foundDir} {
        puts &#34;Could not find an Ixia Version Directory&#34;
    }
    set auto_path_temp &#34;&#34;
    set savedType &#34;&#34;
    foreach var $auto_path {
        set var1 [split $var &#34;/&#34;]
        if {![regexp -nocase &#34;ixia&#34; $var1]} {
            lappend auto_path_temp $var
        }
    }
    set auto_path $auto_path_temp

    <a name="::SetIxiaEnv(1)"><a href="./ePTMisc.tcl.html#::SetIxiaEnv_517">::SetIxiaEnv</a></a> &#34;$id&#34;
    lappend auto_path [file join $env(IXIA_HOME) &#34;lib&#34;]


    package require IxTclHal

    set host $hostname
    if [catch &#34;set out [<a name="::ixInitialize(1)"><a href="./mapping.tcl.html#::ixInitialize_55">::ixInitialize</a></a> $host]&#34; $reason] {
        puts &#34;Ixia $host is not reachable&#34;
        puts $fd_in &#34;$host,not reachable,,,&#34;
        continue;
    }
    if {[regexp -nocase &#34;error&#34; $out]} {
        puts &#34;Ixia $host is not reachable&#34;
        puts $fd_in &#34;$host,not reachable,,,&#34;
        continue;
    }

    <span class="comment-line"># Grant Added</span>
    <a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> get
    ixPuts -nonewline &#34;Company name is &#34;
    ixPuts [<a name="::version(2)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -companyName]
    ixPuts -nonewline &#34;Copyright is &#34;
    ixPuts [<a name="::version(3)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -copyright]
    ixPuts -nonewline &#34;Install Version is &#34;
    ixPuts [<a name="::version(4)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -installVersion]
    ixPuts -nonewline &#34;ixTclHAL Version is &#34;
    ixPuts [<a name="::version(5)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -ixTclHALVersion]
    ixPuts -nonewline &#34;Product Version is &#34;
    ixPuts [<a name="::version(6)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -productVersion]
    ixPuts -nonewline &#34;Product Serial Number is  &#34;
    ixPuts [<a name="::version(7)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -productVersion]

    set chas [<a name="::ixGetChassisID(1)"><a href="./mapping.tcl.html#::ixGetChassisID_85">::ixGetChassisID</a></a> $host]
    <span class="comment-line"># Get the chassis: number of cards</span>
    chassis getFromID $chas
    set ctype [chassis cget -typeName]
    set ncards [chassis cget -maxCardCount]
    ixPuts &#34;Chassis $ctype, id $chas,max card $ncards cards&#34;
    puts $fd_in &#34;$host,$ctype,$label1,[<a name="::version(8)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -installVersion],#Slots $ncards&#34;

    for {set i 1} {$i &lt;= $ncards} {incr i} {
       <span class="comment-line"># Check for missing card</span>
       if {[<a name="::card(1)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> get $chas $i] != 0} {
         continue
       }
       set portList [list [list $chas $i 1]]
       <span class="comment-line"># Get all of the card's characteristics</span>
       set fpgaVersion [<a name="::card(2)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> cget -fpgaVersion]
       set hwVersion [<a name="::card(3)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> cget -hwVersion]
       set portCount [<a name="::card(4)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> cget -portCount]
       set type [<a name="::card(5)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> cget -type]
       set typeName [<a name="::card(6)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> cget -typeName]
       set serialNumber [<a name="::card(7)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> cget -serialNumber]
       <span class="comment-line"># And list them</span>
                if {[regexp -nocase {LM Serial Number ([0-9]+).*} $serialNumber dummy sn]} {
                    puts &#34;Found regexp Serial $sn&#34;
                } else {
                    puts &#34;Missed Serial $serialNumber&#34;
                    set sn &#34;Missed&#34;
                }
       ixPuts &#34;Card $i: $typeName ($type), $portCount ports, \
       fpga: $fpgaVersion, hwVersion: $hwVersion serialNumber: $sn&#34;
       puts $fd_in &#34;Card $i,$typeName,$sn,,&#34;
       <span class="comment-line"># If the card is a 10/100 RMII, play with its settable parameters</span>
       <span class="comment-line">#if {$type == $::card10100RMii} {</span>
       <span class="comment-line">#  card config -clockRxRisingEdge 0</span>
       <span class="comment-line">#  card config -clockTxRisingEdge 1</span>
       <span class="comment-line">#  if [card set $chas $i] {</span>
       <span class="comment-line">#    ixPuts &#34;Could not card set $chas $i&#34;</span>
       <span class="comment-line">#  }</span>
       <span class="comment-line">#  ixWriteConfigToHardware portList</span>
       <span class="comment-line">#}</span>
       <span class="comment-line"># Just for fun, we'll export the data associated with the first card</span>
       <span class="comment-line"># and read it to any other cards of the same type</span>
       <span class="comment-line">#if {$i == 1} {</span>
        <span class="comment-line"># if {[card export cardfile $chas $i] != 0} {</span>
        <span class="comment-line">#   ixPuts &#34;Could not export&#34;</span>
        <span class="comment-line">#   set savedType &#34;null&#34;</span>
        <span class="comment-line"># } else {</span>
        <span class="comment-line">#   set savedType $type</span>
        <span class="comment-line"># }</span>
       <span class="comment-line">#} elseif {$type == $savedType} {</span>
       <span class="comment-line">#  if {[card import cardfile $chas $i] == 1} {</span>
       <span class="comment-line">#    ixPuts &#34;Could not import&#34;</span>
       <span class="comment-line">#  }</span>
       <span class="comment-line">#}</span>
    }
    puts $fd_in &#34;,,,,&#34;
}

close $fd_in
exit
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
