<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>biForwardingIpv6.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#biForwardingIpv6.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>biForwardingIpv6.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="biForwardingIpv6.tcl-annot.html">annotations</a> | <a href="biForwardingIpv6.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::CheckIpv6BiForwarding_2">proc <a href="biForwardingIpv6.tcl-annot.html#::::CheckIpv6BiForwarding">::::CheckIpv6BiForwarding</a></a></strong> {args} {
	<a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckIpv6BiForwarding $args {
     	txPortId &#34;1&#34;
     	rxPortId &#34;2&#34;
     	<a name="::protocol(1)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ipV6&#34;
     	sTag      &#34;none&#34;
     	dTag      &#34;none&#34;
     	nHeader  &#34;tcp&#34;
	trafficClass &#34;3&#34;
        flowLabel &#34;0&#34;
        hopLimit &#34;255&#34;
	sGIpAddr &#34;0.0.0.0&#34;
     	dGIpAddr &#34;0.0.0.0&#34;
     <span class="comment-line">#	inSaMac &#34;00:00:00:00:00:01;&#34;</span>
    <span class="comment-line"># 	inDaMac &#34;00:00:00:00:00:02&#34;</span>
        inSaMac &#34;00:a1:f1:00:00:01&#34;
        inDaMac &#34;FF:FF:FF:FF:FF:FF&#34;
     	sIpAddr &#34;3ffa:10::204:96ff:fe10:7c02&#34;
     	dIpAddr &#34;3ffa:20::204:96ff:fe10:7c00&#34;
     	frameSize &#34;128&#34;
     	percentage &#34;100&#34;
     	sPort &#34;0&#34;
     	dPort &#34;0&#34;
     	numFrames &#34;1&#34;
    	tcpSynFlag &#34;false&#34;
     	tcpFinFlag &#34;false&#34;
     	tcpRstFlag &#34;false&#34;
     	tcpAckFlag &#34;false&#34;
     	tcpPushFlag &#34;false&#34;
     	tcpUrgFlag &#34;false&#34;
     	icmpType &#34;0&#34;
     	icmpCode &#34;0&#34;
     	<span class="comment-line">#ttlDecr &#34;1&#34;</span>
     	checkPortList {&#34;20 forwarded&#34;}
     	filePt &#34;NULL&#34;
     	applyFilter &#34;0&#34;
     	udfEnable &#34;false&#34;
     	udfInitval &#34;00&#34;
     	udfOffset &#34;0&#34;
     	udfCountertype &#34;c8&#34;
     	udfContinuousCount &#34;false&#34;
     	<span class="comment-line">#ipOptions &#34;&#34;</span>
	sIpMask &#34;ffff:ffff:ffff:ffff:0000:0000:0000:0000&#34;
        dIpMask &#34;ffff:ffff:ffff:ffff:0000:0000:0000:0000&#34;
   	}

	 global TrafficGen
	switch -exact -- $TrafficGen {
                stc -
		ixia -
                ixvm {
	
   	<span class="comment-line">#get the maximum card being used in the test, ignore the passed parameter</span>
   	set maxPorts [lindex [lindex $checkPortList  \
                    [expr [llength $checkPortList] -1]] 0]
   	set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $maxPorts]
   	if { $sGIpAddr == &#34;0.0.0.0&#34; } { set sGIpAddr $dIpAddr }
   	if { $dGIpAddr == &#34;0.0.0.0&#34; } { set dGIpAddr $sIpAddr }
   	global startCardNum
        global TrafficGen
   	set pPattern &#34;abcd&#34;

   	<span class="comment-line">#map portId to Ixia port</span>
   	if {$rxPortId == $txPortId} {
      	<a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invalid port specification: txPortId=rxPortId&#34;
      	return
  	 }

   	<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId txChas txCard txPort
   	if {$rxPortId == 0} {
      	<span class="comment-line">#then just choose some random port different the txPort</span>
      	<a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId rxChas rxCard rxPort
      	if {$txPort == 1} {set rxPort 2} else {set rxPort 1}
   	} else {
      	<a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $rxPortId rxChas rxCard rxPort
   	}

 	<span class="comment-line">#setup tag</span>
   	if { $sTag == &#34;none&#34; } {
      		set wTag &#34;false&#34;
      		set tagValue $sTag
   	} else {
      		set wTag &#34;true&#34;
      		set tagValue $sTag
   	}
   	if { $dTag != &#34;none&#34; } {
      		lappend wTag &#34;true&#34;
      		lappend tagValue $dTag
   	} else {
      		lappend wTag &#34;false&#34;
      		lappend tagValue $dTag
   	}

   	<span class="comment-line">#if { $protocol == &#34;arp&#34; } { report_start_test    \</span>
         <span class="comment-line"># &#34;Message $protocol L2 forwarding check on Txport $txPortId&#34;</span>
  	<span class="comment-line"># } elseif {(($protocol== &#34;arpip&#34;) || \</span>
        <span class="comment-line">#      ($protocol==&#34;ipV6&#34;))} {report_start_test \</span>
        <span class="comment-line">#  &#34;Message $protocol L3 forwarding check on Txport $txPortId&#34;</span>
   	<span class="comment-line">#} else {</span>
      	<span class="comment-line">#report_start_test &#34;Message $protocol L3 forwarding  \</span>
            <span class="comment-line">#check on Txport $txPortId&#34;</span>
   	<span class="comment-line">#}</span>

        <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Message $protocol L3 forwarding \
                                  check on Txport $txPortId&#34;

  	 <span class="comment-line">#set to user input, will be overwritten when using learn_arp function</span>
   	 set testResult &#34;good&#34;
   	 <span class="comment-line">#generate ARP protocol server, if rxPort is set, protocol=arp</span>
   
    	 global one2oneArray
     	<span class="comment-line"># Create mapping</span>
        if {$TrafficGen != &#34;ept&#34;} {
     	<a name="::map(1)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> new -type                                             one2one
     	<a name="::map(2)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> config -type                        		  one2one
        }
     	<a name="::map(3)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> add $txChas $txCard $txPort $rxChas $rxCard $rxPort
     	<a name="::stream(1)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> setDefault
     	<a name="::protocol(2)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> setDefault
     	<a name="::protocol(3)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -ethernetType                             ethernetII
     	<a name="::protocol(4)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -name                                     ipV6


        if {$TrafficGen != &#34;ept&#34;} {
     	<a name="::ipV6(1)"><a href="./ePTClient.tcl.html#::ipV6_1593">::ipV6</a></a> setDefault
<span class="comment-line">#	ipV6 config -trafficClass                      $trafficClass</span>
<span class="comment-line">#        ipV6 config -flowLabel                         $flowLabel</span>
<span class="comment-line">#        ipV6 config -hopLimit                          $hopLimit</span>
<span class="comment-line">#	ipV6  addExtensionHeader                       $nHeader</span>
<span class="comment-line">#	ipV6  config -nextHeader                       $nHeader</span>

     	<a name="::ipV6(2)"><a href="./ePTClient.tcl.html#::ipV6_1593">::ipV6</a></a> config -sourceAddr                        $sIpAddr

     	<a name="::ipV6(3)"><a href="./ePTClient.tcl.html#::ipV6_1593">::ipV6</a></a> set                                       $txChas $txCard $txPort

	 <span class="comment-line">#Other port be configured for arp response too</span>
	
	<a name="::ipV6(4)"><a href="./ePTClient.tcl.html#::ipV6_1593">::ipV6</a></a> setDefault
        <a name="::ipV6(5)"><a href="./ePTClient.tcl.html#::ipV6_1593">::ipV6</a></a> config -sourceAddr                         $dIpAddr
        <a name="::ipV6(6)"><a href="./ePTClient.tcl.html#::ipV6_1593">::ipV6</a></a> set                                          $rxChas $rxCard $rxPort
        } else {
     	<a name="::ipV6(7)"><a href="./ePTClient.tcl.html#::ipV6_1593">::ipV6</a></a> config -sourceAddr                        $sIpAddr
        <a name="::ipV6(8)"><a href="./ePTClient.tcl.html#::ipV6_1593">::ipV6</a></a> config -sourceAddr                         $dIpAddr
        }

	<span class="comment-line">#send_neighborDiscovery_frames one2oneArray</span>
	<span class="comment-line">#getNeighborDiscovery $txPortId</span>
	<span class="comment-line">#getNeighborDiscovery $rxPortId</span>
     <span class="comment-line">#	set destMacAddrTx [SendArpRequest  $txPortId  $sIpAddr  $sTag]</span>
<span class="comment-line">#</span>
<span class="comment-line">#     	if {$destMacAddrTx == &#34;NO_ARP_REPLY&#34;} {</span>
<span class="comment-line">#      	  result_debug &#34;Expect an arp reply, but got none on port $txPortId&#34;</span>
<span class="comment-line">#      	  set testResult &#34;bad&#34;</span>
<span class="comment-line">#    	 } else {</span>
<span class="comment-line">#    	    result_debug &#34;Got an arp reply on Tx port  \</span>
<span class="comment-line">#                                $txPortId. MAC: |$destMacAddrTx|&#34;</span>
<span class="comment-line">#    	 }</span>
<span class="comment-line">#    	 set destMacAddrRx [SendArpRequest $rxPortId $dIpAddr $dTag ]</span>
<span class="comment-line">#    	 if {$destMacAddrRx == &#34;NO_ARP_REPLY&#34;} {</span>
<span class="comment-line">#    	    result_error &#34;Expect an arp reply, but got none on port $rxPortId&#34;</span>
<span class="comment-line">#    	  set testResult &#34;bad&#34;</span>
<span class="comment-line">#    	} else {</span>
<span class="comment-line">#    	    result_debug &#34;Got an arp reply on Rx port  \</span>
<span class="comment-line">#                        $rxPortId. MAC: |$destMacAddrRx|&#34;</span>
<span class="comment-line">#    	}</span>
<span class="comment-line">#   	if {$protocol==&#34;arp&#34;} {report_end_test; return}</span>
  	 

  

	if {[regexp -nocase &#34;ipV6&#34; $protocol]} {
   

      	<span class="comment-line"># Portid 1-8, 12-24 are on DUT1 and 9-12 are on DUT2</span>
     	if {($txPortId&gt;=9) &amp;&amp; ($txPortId&lt;=12)} {
        	set destMacAddrList [<a name="::GetDUTMac(1)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT2&#34;]
     	} else {
        	set destMacAddrList [<a name="::GetDUTMac(2)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT1&#34;]
     	}
	
     	if {($rxPortId&gt;=9) &amp;&amp; ($rxPortId&lt;=12)} {
        	lappend destMacAddrList [<a name="::GetDUTMac(3)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT2&#34;]
     	} else {
        	lappend destMacAddrList [<a name="::GetDUTMac(4)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT1&#34;]
     	}
   	}

         foreach checkPort $checkPortList {
        lappend portMonitorList [lindex $checkPort 0]
        }
         
 
        <a name="::ClearPortsStats(1)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portMonitorList
        <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Clearing all satitistics&#34;
        
        <a name="::StartPortsCapture(1)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portMonitorList 	
	 <span class="comment-line"># Send an ip packet for ipf learning across both switches  \</span>
             <span class="comment-line">#in order for fast path fwding in actual ip send</span>
     if {(($txPortId&gt;=9)&amp;&amp;($txPortId&lt;=12))||(($rxPortId&gt;=9)&amp;&amp;($rxPortId&lt;=12))} {
 
                 set frameSent [<a name="::ixiaConf_2Ports_ipv6(1)"><a href="./ePTL3TxIpv6.tcl.html#::ixiaConf_2Ports_ipv6_32">::ixiaConf_2Ports_ipv6</a></a> -numIxiaCd $numIxiaCd \
                -startCardNum $startCardNum -txChas $txChas -txCard $txCard \
                -txPort $txPort -frameSize $frameSize \
                -rxChas $txChas -rxCard $rxCard -rxPort $rxPort \
                -percentage $percentage -pDstPort $dPort -pSrcPort $sPort \
                -direction &#34;2Way&#34; -flowLabel $flowLabel -trafficClass  \
                $trafficClass -type $icmpType -code $icmpCode -applyFilter \
                $applyFilter -hopLimit $hopLimit -tcpSynFlag $tcpSynFlag  \
                -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
                -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
                -tcpUrgFlag $tcpUrgFlag -dataPattern $pPattern -wTag $wTag \
                -tagNo $tagValue -ipProtocol $protocol \
                -dMacAddr $destMacAddrList  -sIpAddr $sIpAddr \
                -nHeader $nHeader -udfEnable $udfEnable -udfInitval  \
                $udfInitval -udfOffset $udfOffset -udfCountertype \
                $udfCountertype -udfContinuousCount $udfContinuousCount \
                 -dIpAddr $dIpAddr -numFrames 1 -sIpMask $sIpMask \
                -dIpMask $dIpMask]

 	}


	<span class="comment-line"># Send an ip packet</span>
 		set frameSent [<a name="::ixiaConf_2Ports_ipv6(2)"><a href="./ePTL3TxIpv6.tcl.html#::ixiaConf_2Ports_ipv6_32">::ixiaConf_2Ports_ipv6</a></a> -numIxiaCd $numIxiaCd \
                -startCardNum $startCardNum -txChas $txChas -txCard $txCard \
                -txPort $txPort -frameSize $frameSize \
                -rxChas $txChas -rxCard $rxCard -rxPort $rxPort \
                -percentage $percentage -pDstPort $dPort -pSrcPort $sPort \
                -direction &#34;2Way&#34; -flowLabel $flowLabel -trafficClass  \
                $trafficClass -type $icmpType -code $icmpCode -applyFilter \
                $applyFilter -hopLimit $hopLimit -tcpSynFlag $tcpSynFlag  \
                -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
               	-tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
                -tcpUrgFlag $tcpUrgFlag -dataPattern $pPattern -wTag $wTag \
                -tagNo $tagValue -ipProtocol $protocol \
                -dMacAddr $destMacAddrList  -sIpAddr $sIpAddr \
                -nHeader $nHeader -udfEnable $udfEnable -udfInitval  \
                $udfInitval -udfOffset $udfOffset -udfCountertype \
                $udfCountertype -udfContinuousCount $udfContinuousCount \
                 -dIpAddr $dIpAddr -numFrames $numFrames -sIpMask $sIpMask \
                -dIpMask $dIpMask]


   	if {$numFrames &gt;= 10} {
     		<a name="::ixiaCheckTxDone(1)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $txChas $txCard $txPort $numFrames $txPortId
     		<a name="::ixiaCheckTxDone(2)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $rxChas $rxCard $rxPort $numFrames $txPortId
   	}
          
       <a name="::StopPortsCapture(1)"><a href="./ePTRx.tcl.html#::StopPortsCapture_862">::StopPortsCapture</a></a> $portMonitorList
        if {$TrafficGen != &#34;ept&#34;} {
        set data [<a name="::captureBuffer(1)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]
         }
	<a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FrameSentIP: $frameSent&#34;
   	<span class="comment-line">#retrieve data from ixia</span>
  	<span class="comment-line">#find how many expected packets was received</span>

   	foreach checkPort $checkPortList {
     		 set portId [lindex $checkPort 0]
      		<a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
      		set doesItForward($portId) 0



      	if {$applyFilter} {
        	 set framesReceived [lindex [<a name="::ixiaUserDefinedStat1(1)"><a href="./ePTRx.tcl.html#::ixiaUserDefinedStat1_558">::ixiaUserDefinedStat1</a></a> $portId $filePt] 1]
      	} else {
         	 <a name="::stat(1)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasisId $card $port
         	 set framesReceived [<a name="::stat(2)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]
      	}

      
	<a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;actual Frames Received on port $portId is  \
                             $framesReceived and sent frames=$numFrames&#34;
      	if {$framesReceived &gt;= $numFrames} {
        	 set doesItForward($portId) 1
      	}
   	}

   	<span class="comment-line">#now check received data against checkList to see if matched</span>
   	foreach checkPort $checkPortList {
      		set portId [lindex $checkPort 0]
      		set portFlag [lindex $checkPort 1]
      	switch -- $portFlag \
        	 &#34;forwarded&#34; {
            		set shouldForward 1
          	} &#34;notForwarded&#34; {
            		set shouldForward 0
          	} default {
           		 set shouldForward $portFlag
          	}

      	if { ($doesItForward($portId) == $shouldForward) } {
        	 <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Forwarding on port $portId checked Okay.\
                                               Was $portFlag&#34;
      	} else {
        	 <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Forwarding criteria failed on port $portId.&#34;
        
                set testResult &#34;bad&#34;
      	}
   	}

 	if {$testResult == &#34;good&#34;} {
     		<a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check data forwarding passed&#34;
   	}  else {
     		<a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check data forwarding failed&#34;
  	}

  		<a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
	}
	}
}


</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
