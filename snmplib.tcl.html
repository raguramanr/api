<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>snmplib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#snmplib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>snmplib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="snmplib.tcl-annot.html">annotations</a> | <a href="snmplib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">#source ../../Lib/mainLib.tcl</span>

global env
puts &#34;pwd = [pwd]&#34;
<span class="comment-line">#load ../../Lib/SnmpAPI.so snmpapi</span>
<span class="comment-line">#if {[regexp -nocase &#34;main&#34; [pwd]]} {</span>
  <span class="comment-line">#if running SnmpFunctionaltest </span>
<span class="comment-line">#  set load_dir &#34;../Lib/SnmpAPI.so&#34;</span>
<span class="comment-line">#} else {</span>
  <span class="comment-line">#if running Functionaltest </span>
<span class="comment-line">#  set load_dir &#34;../../Lib/SnmpAPI.so&#34;</span>
<span class="comment-line">#}</span>
set load_dir &#34;/usr/share/snmp/SnmpAPI.so&#34;
if { [catch {load $load_dir snmpapi} result] } {
    puts &#34;Error in loading the SnmpAPI.so, result=$result&#34;
    <span class="comment-line">#result_error &#34;Error in loading the SnmpAPI.so, result=$result&#34;</span>
    exit
} else {
    puts &#34;Successful in loading the SnmpAPI.so , result=$result&#34; ;<span class="comment-line">#exos</span>
    <span class="comment-line">#result_ok &#34;Successful in loading the SnmpAPI.so , result=$result&#34; ;#exos</span>
}
   
<span class="comment-line">#source ../../Lib/parse_args.tcl</span>

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpDebug</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure logs the debugging information if the global</span>
<span class="comment-line">#     debugging option is enabled by specifiying SNMP_DEBUG</span>
<span class="comment-line">#     variable to ON.</span>
<span class="comment-line">#     The debugging information includes, the function name and</span>
<span class="comment-line">#     executed API functions and its return values. It logs the</span>
<span class="comment-line">#     debugging information in a file, if a file is provided.</span>
<span class="comment-line">#     Otherwise logs in the standard output</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#     logflag - LOG / DEBUG. If LOG is specified, irrespective</span>
<span class="comment-line">#               of SNMP_DEBUG status (ON/OFF), the message will</span>
<span class="comment-line">#               be logged in the file. If DEBUG is specified,</span>
<span class="comment-line">#               if SNMP_DEBUG is ON, then only the messages are</span>
<span class="comment-line">#               logged in the file. DEBUG flag traces a procedure</span>
<span class="comment-line">#               entry and exit information. Whereas LOG specifies</span>
<span class="comment-line">#               only the output of any SNMP API functions.</span>
<span class="comment-line">#     output - Debugging string to be logged</span>
<span class="comment-line">#     fd - File descriptor in which the debugging information</span>
<span class="comment-line">#          to be logged</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#     None</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#     snmpDebug &#34;snmpGet: Sample output&#34; $fd</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpDebug_63">proc <a href="snmplib.tcl-annot.html#::::snmpDebug">::::snmpDebug</a></a></strong> {logflag output {fd NULL}} {

   global SNMP_DEBUG

   if {[info exists SNMP_DEBUG]} {
      if { &#34;$SNMP_DEBUG&#34; == &#34;ON&#34; } {
         if { $fd != &#34;NULL&#34; } {
            puts $fd &#34;&gt; $output &lt;&#34;
         } else {
            puts &#34;&gt; $output &lt;&#34;
         }
      } else {
         if {$logflag == &#34;LOG&#34; } {
            if { $fd != &#34;NULL&#34; } {
               puts $fd &#34;&gt; $output &lt;&#34;
            }
         }
      }
   } else {
      if {$logflag == &#34;LOG&#34; } {
         if { $fd != &#34;NULL&#34; } {
            puts $fd &#34;&gt; $output &lt;&#34;
         }
      }
   }
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpInit</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedures sets the environmental variable MIBS to</span>
<span class="comment-line">#     ALL. This environmental variable is required for SNMP</span>
<span class="comment-line">#     set and get operations.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#     None</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#     None</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#     snmpInit</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpInit_115">proc <a href="snmplib.tcl-annot.html#::::snmpInit">::::snmpInit</a></a></strong> {{snmpConfFileName snmp.cfg}} {

   <span class="comment-line"># Set the environment variable MIBS to ALL. This is required</span>
   <span class="comment-line"># for SNMP set or get operations</span>

   global env
  
   set func &#34;snmpInit:&#34;
   set trapdFile &#34;/var/net-snmp/snmptrapd.conf&#34;
   
   set env(MIBS) ALL
   set env(MIBDIRS) /usr/share/snmp/mibs
   set env(SNMPCONFPATH) /usr/share/snmp
 
   <span class="comment-line"># Delete the /var/net-snmp/snmptrapd.conf file if exists</span>
   if {[file exists $trapdFile]} {
      eval [file delete -force $trapdFile]
   }

   <a name="::snmpDebug(1)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34;  

   return 1
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpDutInit</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure configures the default VLAN of a DUT with</span>
<span class="comment-line">#     the given IP address</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#     dut - IP address of the DUT management port </span>
<span class="comment-line">#     dutno - DUT number (DUT1, DUT2 ..etc)</span>
<span class="comment-line">#     connect - IP address of the default VLAN</span>
<span class="comment-line">#     fd - File descriptor for logging the command outputs   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#     None</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#     snmpDutInit -dut 10.0.0.1 -dutno DUT1 -connect 10.1.2.1 -fd $fd</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpDutInit_166">proc <a href="snmplib.tcl-annot.html#::::snmpDutInit">::::snmpDutInit</a></a></strong> { args } {

   set func &#34;snmpDutInit&#34;

   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpDutInit $args {
       dut &#34;&#34;
       connect &#34;&#34;
       dutno &#34;&#34;
       fd &#34;NULL&#34;
   }
   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $dut -fd $fd
   <a name="::ConfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::ConfigGatewayNetwork_2110">::ConfigGatewayNetwork</a></a>
   <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable snmp access&#34;
   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleep 5 seconds for port to comeup&#34;
   <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5  
   <a name="::snmpDebug(2)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   return 1
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpOpenSession</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Description: </span>
<span class="comment-line">#     This function calls the API function, snmpOpenSess to </span>
<span class="comment-line">#     open SNMP session with the specified DUT. If the optional</span>
<span class="comment-line">#     arguments are not specified, the values specified in the</span>
<span class="comment-line">#     configuration file is considered. </span>
<span class="comment-line">#   </span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#     dut - IP address of the DUT specified in the configuration</span>
<span class="comment-line">#           file.</span>
<span class="comment-line">#     connect- IP address assigned to the default vlan in the DUT.</span>
<span class="comment-line">#              This is used for SNMP communication.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#     version - SNMP version. Possible values can be 1,2 or 3</span>
<span class="comment-line">#     community - Community string used for SNMP authentication</span>
<span class="comment-line">#     retry - Number of retries for the SNMP operations</span>
<span class="comment-line">#     timeout - Timeout in seconds for each SNMP operation</span>
<span class="comment-line">#     sec - Type of the security. Possible values are</span>
<span class="comment-line">#                * noAuthNoPriv</span>
<span class="comment-line">#                * authNoPriv</span>
<span class="comment-line">#                * authPriv</span>
<span class="comment-line">#     authType - Authentication protocol (MD5 or SHA)</span>
<span class="comment-line">#     auth     - Authentication string</span>
<span class="comment-line">#     privType - Encryption method (DES). This argument should </span>
<span class="comment-line">#                be specified, if the sec option value is </span>
<span class="comment-line">#                authPriv</span>
<span class="comment-line">#     priv - Privilege string. This argument should be specified, </span>
<span class="comment-line">#            if the sec option value is authPriv</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#     None </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#     0 - On failure</span>
<span class="comment-line">#     sessionid - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Typical Usage:</span>
<span class="comment-line">#  snmpOpenSession -connect 10.2.2.2  -dut DUT1</span>
<span class="comment-line">#  snmpOpenSession -connect 10.1.2.3  -dut DUT2 -version 3 </span>
<span class="comment-line">#                -sec authNoPriv -authType MD5 -auth &#34;initialmd5&#34;    </span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpOpenSession_230">proc <a href="snmplib.tcl-annot.html#::::snmpOpenSession">::::snmpOpenSession</a></a></strong> { args } {

   <span class="comment-line"># These global variables are to be defined in cfg/snmp.cfg file</span>

   global DUTs_info
   global SNMPV2_RWCOMMUNITY
   global SNMPV3_USER_NAME
   global SNMPV3_AUTH_PROTO
   global SNMPV3_AUTH_STR
   global SNMPV3_PRIV_STR
   global SNMP_RETRY
   global SNMP_TIMEOUT
   global SNMPV3_SEC_TYPE

   set func &#34;snmpOpenSession:&#34;

   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpOpenSession $args {
          connect &#34;&#34;
          dut &#34;&#34;
          <a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> &#34;&#34;
          community &#34;&#34;
          retry &#34;&#34;
          timeout &#34;&#34;
          sec &#34;&#34;
          authType &#34;&#34;
          auth &#34;&#34;
          privType &#34;&#34;
          priv &#34;&#34;
          user &#34;&#34;
          fd &#34;NULL&#34;
   }

   <a name="::snmpDebug(3)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func connect-$connect dut-$dut version-$version community-$community retry-$retry timeout-$timeout sec-$sec authType-$authType auth-$auth privType-$privType priv-$priv user-$user fd-$fd - Start&#34; $fd

   if {$dut == &#34;&#34; || $connect == &#34;&#34;} {
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func Must specify dut and connect information&#34;
      return 0
   } 

   if { $version == &#34;&#34; } {
      set version $DUTs_info($dut,snmpVersion)
   }

   if {$community == &#34;&#34;} {
      if {$version == 1 || $version == 2} {
         if { [info exists SNMPV2_RWCOMMUNITY] == 0 } {
            set community &#34;private&#34;
         } else {
            set community $SNMPV2_RWCOMMUNITY
         }
      }
   }
 
   if { $timeout == &#34;&#34; } {
      if { [info exists SNMP_TIMEOUT] == 0} {
         set timeout 10
      } else {
         set timeout $SNMP_TIMEOUT
      }
   }

   if { $retry == &#34;&#34; } {
      if { [info exists SNMP_RETRY] == 0} {
         set retry 2
      } else {
         set retry $SNMP_RETRY
      }
   }

   if {$version == 3} {
      if {$sec == &#34;&#34;} {
         if { [info exists SNMPV3_SEC_TYPE] == 0 } {
            set sec &#34;authNoPriv&#34;
         } else {
            set sec $SNMPV3_SEC_TYPE
         }
      }
     
      if {$authType == &#34;&#34;} {
         if { [info exists SNMPV3_AUTH_PROTO] == 0 } {
            set authType &#34;MD5&#34;
         } else {
            if { ! ($SNMPV3_AUTH_PROTO == &#34;MD5&#34; ||
                    $SNMPV3_AUTH_PROTO == &#34;SHA&#34;) } {
               <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;SNMPV3_AUTH_PROTO must be either MD5 or SHA&#34;
               return 0
            }
            set authType $SNMPV3_AUTH_PROTO
         }
      } else {
         if { ! ($authType == &#34;MD5&#34; ||
                    $authType == &#34;SHA&#34;) } {
               <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;authType must be either MD5 or SHA&#34;
               return 0
         }
      }
     
      if {$auth == &#34;&#34;} {
         if { [info exists SNMPV3_AUTH_STR] == 0 } {
            if { $authType == &#34;MD5&#34; } {
               if { $sec == &#34;authPriv&#34; } {
                  set auth &#34;initialmd5Priv&#34;
               } else {
                  set auth &#34;initialmd5&#34;
               }
            } elseif { $authType == &#34;SHA&#34; } {
               if { $sec == &#34;authPriv&#34; } {
                  set auth &#34;initialshaPriv&#34;
               } else {
                  set auth &#34;initialsha&#34;
               }
            }
         } else {
            set auth $SNMPV3_AUTH_STR
         }
      }
    
      if {$privType == &#34;&#34; } {
          set privType DES
      } else {
         if {$privType != &#34;DES&#34;} {
            <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;privType should be DES&#34;
            return 0
         }
      }

      if {$priv == &#34;&#34; } {
         if { [info exists SNMPV3_PRIV_STR] == 0 } {
            set priv &#34;initialmd5Priv&#34;
         } else {
            set priv $SNMPV3_PRIV_STR
         }
      }

      if {$user == &#34;&#34;} {
         if { [info exists SNMPV3_USER_NAME] == 0 } {
            if { $sec == &#34;authPriv&#34; } {
               set user $priv
            } elseif { $sec == &#34;authNoPriv&#34; } {
               set user $auth
            } else {
               set user &#34;initial&#34;
            }
         } else {
             set user $SNMPV3_USER_NAME
         }
      }
puts &#34;\n inside open session.....................&#34;
      if {$sec == &#34;noAuthNoPriv&#34; } {
         <a name="::snmpDebug(4)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func connect-$connect version-$version user-$user sec-$sec. End\n&#34; $fd
         return [snmpOpenSess -dut $connect -version $version -user $user -sec $sec]
      } elseif {$sec == &#34;authNoPriv&#34;} {
         <a name="::snmpDebug(5)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func connect-$connect version-$version user-$user sec-$sec authType-$authType auth-$auth. End\n&#34; $fd
         set ses [snmpOpenSess -dut $connect -version $version -user $user -sec $sec -authType $authType -auth $auth]
         return $ses
      } else {
         <a name="::snmpDebug(6)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func connect-$connect version-$version user-$user sec-$sec authType-$authType auth-$auth privType-$privType priv-$priv. End\n&#34; $fd
         return [snmpOpenSess -dut $connect -version $version -user $user -sec $sec -authType $authType -auth $auth -privType $privType -priv $priv]
      }
   } else {
      <a name="::snmpDebug(7)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func connect-$connect version-$version community-$community&#34;
      return [snmpOpenSess -dut $connect -version $version -community $community]
   }
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUtilGetPID</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure returns the process identifier of a specific</span>
<span class="comment-line">#    process. If the process is not running, it returns -1 as </span>
<span class="comment-line">#    process id.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    name - Name of the process</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    -1 - on failure</span>
<span class="comment-line">#    Process ID - on success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpUtilGetPID snmptrapd</span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpUtilGetPID_419">proc <a href="snmplib.tcl-annot.html#::::snmpUtilGetPID">::::snmpUtilGetPID</a></a></strong> { name } {
   catch {set output [exec /bin/ps -e | grep $name]}
   if {[info exists output]} {
      foreach item [split $output &#34;\n&#34;] {
         if { [regexp $name $item] &amp;&amp; ![regexp &#34;grep&#34; $item] } {
            return [lindex $item 0]
         }
      }
  }

  <span class="comment-line"># Process id not found </span>
  return -1
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpConfigureTrap</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure configures the trap receiver for SNMPv2 or</span>
<span class="comment-line">#     SNMPv3 and enables or disable specific traps for a given</span>
<span class="comment-line">#     DUT. It also checks whether snmptrapd daemon is running or</span>
<span class="comment-line">#     not. If not running, it tries to start that daemon.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#     session - SNMP session identifier</span>
<span class="comment-line">#     version - Trap version (1, 2 or 3)</span>
<span class="comment-line">#     connect - DUT default vlan IP address</span>
<span class="comment-line">#     dut - DUT IP address</span>
<span class="comment-line">#     fd - File descriptor for logging the command outputs   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#     snmpConfigureTrap -session $session_id -version 2 -dut \</span>
<span class="comment-line">#            10.1.2.1 -connect 10.0.0.1 -fd $fd</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpConfigureTrap_463">proc <a href="snmplib.tcl-annot.html#::::snmpConfigureTrap">::::snmpConfigureTrap</a></a></strong> { args } {
   global TRAP_RECV_PORT
   global TRAP_RECV_IPADDR
   global SNMPV2_RWCOMMUNITY
   global DUTs_info

   set func &#34;snmpConfigureTrap:&#34;

   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpConfigureTrap $args {
       <a name="::version(2)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> &#34;&#34;
       session &#34;&#34;
       dut &#34;&#34;
       fd &#34;NULL&#34;
   }
 
   if { $session == &#34;&#34; || $version == &#34;&#34; || $dut == &#34;&#34; || $fd == &#34;NULL&#34; } {
       <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func session, version, dut and fd must be specified&#34;
       return 0
   }
   <span class="comment-line"># result_error &#34;$func version-$version session-$session dut-$dut fd-$fd - Start and $fd&#34;</span>
   <a name="::snmpDebug(8)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func version-$version session-$session dut-$dut fd-$fd - Start&#34; $fd

   if { $version &gt; 3 } {
      error &#34;$func invalid version $version. Valid values are 1,2 or 3&#34;
      return 0
   }
 
   <span class="comment-line"># Determine the trap receiver address (regression PC address)</span>
   if {[info exists TRAP_RECV_IPADDR] == 1} {
       <a name="::snmpDebug(9)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func $TRAP_RECV_IPADDR is configure as trap receiver in snmp.cfg file\n&#34; $fd
   } else {
      set TRAP_RECV_IPADDR [<a name="::GetLocalIpaddr(1)"><a href="./misc.tcl.html#::GetLocalIpaddr_3277">::GetLocalIpaddr</a></a>]
      <a name="::snmpDebug(10)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func Trap receiver address is $TRAP_RECV_IPADDR&#34; $fd
   }
   <span class="comment-line"># If trap port is configured, use it otherwise use default port</span>
   if {[info exists TRAP_RECV_PORT]} {
      set trapPort $TRAP_RECV_PORT
   } else {
      <a name="::snmpDebug(11)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;TRAP_RECV_PORT NOT SET: setting trapPort 162&#34; $fd
      set trapPort 162
   }
      set trapPort 1620
puts &#34;\n trapPort : $trapPort&#34;
   <a name="::snmpDebug(12)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func Trap port number is $trapPort&#34; $fd

   <span class="comment-line"># Check whether /usr/sbin/snmptrapd is running or not.</span>
   <span class="comment-line"># If not running, start that</span>
   set trapdPID [<a name="::snmpUtilGetPID(1)"><a href="./snmplib.tcl.html#::snmpUtilGetPID_419">::snmpUtilGetPID</a></a> snmptrapd]
   if { $trapdPID != -1 } {
      <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$func /usr/sbin/snmptrapd is running with pid $trapdPID&#34;
      <a name="::snmpDebug(13)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmptrapd($trapdPID) is running&#34; $fd
   } else {
      <span class="comment-line"># snmptrapd is not running. So try and start that</span>
      <a name="::snmpDebug(14)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmptrapd is not running&#34; $fd
      
      <span class="comment-line"># Before starting, check whether snmptrapd executable exists or not</span>
      if {[file exists /usr/sbin/snmptrapd]} {
         set output [exec /usr/sbin/snmptrapd udp:$trapPort]
         set trapdPID [<a name="::snmpUtilGetPID(2)"><a href="./snmplib.tcl.html#::snmpUtilGetPID_419">::snmpUtilGetPID</a></a> snmptrapd] 
         if { $trapdPID == -1 } {
             <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func unable to start snmptrapd&#34;
             <a name="::snmpDebug(15)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func unable to start snmptrapd - End\n&#34; $fd
             return 0
         }
         <a name="::snmpDebug(16)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmptrapd started with pid $trapdPID&#34; $fd
      } else {
         <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Unable to find out /usr/sbin/snmptrapd&#34;
         <a name="::snmpDebug(17)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func /usr/sbin/snmptrapd not exists - End\n&#34; $fd
         return 0
      }
   }

   <span class="comment-line"># Login to the switch to do the trap receiver configuration</span>
   <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $dut -fd $fd

   <span class="comment-line"># Disable link-up down traps. These traps can be enabled on need basis</span>
   <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable snmp traps&#34;

   <span class="comment-line"># Remove remnant trap file in regression pc, if any</span>
   if {[file exists /tmp/snmp_trap_$dut]} {
      <a name="::snmpDebug(18)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func removing /tmp/snmp_trap_$dut file as cleanup&#34; 
      file delete -force /tmp/snmp_trap_$dut
   }

   <span class="comment-line"># Determine whether to do v2 or v3 trap settings</span>
   if { $version == 1 || $version == 2} {
      <a name="::snmpDebug(19)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func SNMP version is 2&#34; $fd
      if {[info exists SNMPV2_RWCOMMUNITY]} {
         set commStr $SNMPV2_RWCOMMUNITY
      } else {
         set commStr &#34;private&#34;
      }
      <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure snmp add trapreceiver $TRAP_RECV_IPADDR community $commStr port $trapPort&#34;
   } else {

      <span class="comment-line"># Modify the /var/net-snmp/snmptrapd.conf file to add this agent's</span>
      <span class="comment-line"># and user so that snmptrapd can process the traps from this agent</span>

      set result [snmpGet -session $session -oid snmpEngineID.0]
      <a name="::snmpDebug(20)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet:$result&#34; $fd
      
      if {[regexp {(.*STRING:)(.*)} $result res res1 res2]} {
         if {[info exists res2]} {
            set engineID [join 0x[string trim $res2] &#34;&#34;]
            <a name="::snmpDebug(21)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func engineID is $engineID&#34; $fd
            set file_d [open /var/net-snmp/snmptrapd.conf {CREAT APPEND WRONLY}]
            puts $file_d &#34;createUser -e $engineID initialmd5 MD5 initialmd5 DES initialmd5&#34;
            <span class="comment-line"># The configuration file is updated. So signal snmptrapd to re-read</span>
            <span class="comment-line"># the configuration file</span>
            catch {set [exec /bin/kill -s SIGHUP $trapdPID]}
         } else {
             <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func unable to obtain SNMPv3 EngineID. But got $result&#34;
             <a name="::snmpDebug(22)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet: $result - End\n&#34; $fd
             return 0
        }
      } else {
         <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func unable to obtain SNMPv3 EngineID from $dut&#34;
         return 0
      }
      <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure snmpv3 add target-params test_params user initialmd5 mp-model snmpv3 sec-model usm sec-level authnopriv&#34;
      <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure snmpv3 add target-addr test_target param test_params ipaddress $TRAP_RECV_IPADDR transport-port $trapPort&#34;
   }
 
   <a name="::snmpDebug(23)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   <a name="::CleanupsnmpTrapFiles(1)"><a href="./snmplib.tcl.html#::CleanupsnmpTrapFiles_2785">::CleanupsnmpTrapFiles</a></a> &#34;null&#34;
   return 1
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUnconfigureTrap</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure deletes the configured trap receiver for SNMPv2 or</span>
<span class="comment-line">#     SNMPv3</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#     session - SNMP session identifier</span>
<span class="comment-line">#     version - Trap version (1, 2 or 3)</span>
<span class="comment-line">#     connect - DUT default vlan IP address</span>
<span class="comment-line">#     dut - DUT IP address</span>
<span class="comment-line">#     fd - File descriptor for logging the command outputs   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#     snmpUnconfigureTrap -session $session_id -version 2 -dut \</span>
<span class="comment-line">#            10.1.2.1 -connect 20.0.0.1 -fd $fd</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpUnconfigureTrap_619">proc <a href="snmplib.tcl-annot.html#::::snmpUnconfigureTrap">::::snmpUnconfigureTrap</a></a></strong> { args } {
   global TRAP_RECV_PORT
   global TRAP_RECV_IPADDR
   global SNMPV2_RWCOMMUNITY
   global DUTs_info

   set func &#34;snmpUnconfigureTrap:&#34;

   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpUnconfigureTrap $args {
       <a name="::version(3)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> &#34;&#34;
       session &#34;&#34;
       connect &#34;&#34;
       dut &#34;&#34;
       fd &#34;NULL&#34;
   }
 
   if { $session == &#34;&#34; || $version == &#34;&#34; || $dut == &#34;&#34; || $connect == &#34;&#34; \
                       || $fd == &#34;NULL&#34; } {
       <a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func session, version, dut, connect and fd must be specified&#34;
       return 0
   }
    
   <a name="::snmpDebug(24)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func version-$version session-$session dut-$dut fd-$fd - Start&#34; $fd

   if { $version &gt; 3 } {
      error &#34;$func invalid version $version. Valid values are 1,2 or 3&#34;
      return 0
   }
 
   <span class="comment-line"># Determine the trap receiver address (regression PC address)</span>
   if {[info exists TRAP_RECV_IPADDR] == 1} {
       <a name="::snmpDebug(25)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func $TRAP_RECV_IPADDR is configure as trap receiver in snmp.cfg file\n&#34; $fd
   } else {
      set TRAP_RECV_IPADDR [<a name="::GetLocalIpaddr(2)"><a href="./misc.tcl.html#::GetLocalIpaddr_3277">::GetLocalIpaddr</a></a>]
      <a name="::snmpDebug(26)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func Trap receiver address is $TRAP_RECV_IPADDR&#34; $fd
   }

   <span class="comment-line"># If trap port is configured, use it otherwise use default port</span>
   if {[info exists TRAP_RECV_PORT]} {
      set trapPort $TRAP_RECV_PORT
   } else {
      set trapPort 162
   }
   <a name="::snmpDebug(27)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func Trap port number is $trapPort&#34; $fd

   <span class="comment-line"># Login to the switch to do the trap receiver configuration</span>
   <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $connect -fd $fd

   <span class="comment-line"># Determine whether to do v2 or v3 trap settings</span>
   if { $version == 1 || $version == 2} {
      <a name="::snmpDebug(28)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func SNMP version is 2&#34; $fd
      if {[info exists SNMPV2_RWCOMMUNITY]} {
         set commStr $SNMPV2_RWCOMMUNITY
      } else {
         set commStr &#34;private&#34;
      }
      <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure snmp delete trapreceiver all&#34;
   }

   <span class="comment-line"># Delete the trap file</span>
<span class="comment-line">#   set trapFile &#34;/tmp/snmp_trap_$dut&#34;</span>
<span class="comment-line">#   snmpDebug DEBUG &#34;Deleting the trap file /tmp/snmp_trap_$dut&#34; $fd</span>
<span class="comment-line">#   file delete -force $trapFile</span>

   <span class="comment-line"># Disable link-up down traps. These traps can be enabled on need basis</span>
   <span class="comment-line">#SendACmd &#34;enable snmp traps port-up-down ports all&#34;</span>

   <a name="::snmpDebug(29)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   <a name="::CleanupsnmpTrapFiles(2)"><a href="./snmplib.tcl.html#::CleanupsnmpTrapFiles_2785">::CleanupsnmpTrapFiles</a></a> $dut 
   return 1
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpHandleTraps</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     The Net-snmp's 'snmptrapd' utility receives the trap </span>
<span class="comment-line">#     message from the SNMP agent and it logs the trap information </span>
<span class="comment-line">#     in a temporary file (/tmp/snmp_trap_&lt;dut ip address&gt;). </span>
<span class="comment-line">#     This procedure parses the temporary file for the given key </span>
<span class="comment-line">#     value. </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#</span>
<span class="comment-line">#     paramList - List of key to be checked with the received </span>
<span class="comment-line">#                 trap log message</span>
<span class="comment-line">#     dut  - DUT from which the trap message is expected.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#     time - Time sensitive check for the trap message generation.</span>
<span class="comment-line">#            Starting time, interval and end time can be specified.</span>
<span class="comment-line">#            The script initially waits for starting time and</span>
<span class="comment-line">#            waits for interval time, until the end time is reached</span>
<span class="comment-line">#            or the script passes.</span>
<span class="comment-line">#     fd - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure</span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    &lt;Generate trap message ...&gt;</span>
<span class="comment-line">#    lappend paramList &#34;{.*SNMPv2-MIB::snmpTrapOID.0.*linkup.*} exist&#34;</span>
<span class="comment-line">#    lappend paramList &#34;{.*SNMPv2-MIB::snmpTrapOID.0.*ifAdmin.*} notExist&#34;</span>
<span class="comment-line">#    snmpHandleTraps $paramList -dut 20.0.0.3 -time {s: 10 i: 5 e: 30 }</span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpHandleTraps_728">proc <a href="snmplib.tcl-annot.html#::::snmpHandleTraps">::::snmpHandleTraps</a></a></strong> { paramList args } {
   
   set func &#34;snmpHandleTraps:&#34;
   set found 0

   <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpHandleTraps $args {
       dut &#34;&#34;
       time 0
       fd &#34;NULL&#34;
       type &#34;positive_test&#34;
       comment  &#34;snmpHandleTraps&#34;
   }

   if { $dut == &#34;&#34; || [llength $paramList] == 0 } {
       <a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func dut and paramList must be specified&#34;
       return 0
   }

   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;
   <a name="::snmpDebug(30)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func dut-$dut time-$time fd-$fd&#34; $fd

   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Handling SNMP traps on DUT $dut --&#34;

<span class="comment-line">##################  Handling SnmpTrap_newformat</span>
   package require fileutil

   if { [catch { glob /tmp/snmp*$dut* } output] } { 
     if {$type eq &#34;negative_test&#34;} {
        <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34; SNMP Trap files are not generated&#34;
     } else {
        <a name="::result_error(12)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34; SNMP Trap files are not generated&#34;
     }
     <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
     return 0
   } else {
     set trapFileH /tmp/snmp_trap_$dut
     foreach file_name $output {
	<a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the filename is $file_name&#34;
     if { $file_name eq [lindex $output 0] } {
          ::fileutil::writeFile $trapFileH [::fileutil::cat $file_name]
          eval [file delete $file_name]
        } else {
          ::fileutil::appendToFile $trapFileH [::fileutil::cat $file_name]
          eval [file delete $file_name]
        }
     }  
   }
<span class="comment-line">################</span>
   set trapFile $trapFileH
   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n &lt;-------- trapFile Name : $trapFile -----&gt;&#34;
   <a name="::snmpDebug(31)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func Trap file is $trapFile&#34; $fd

   if { $time != 0 } {
      set sTime [lindex $time 1]
      set iTime [lindex $time 3]
      set eTime [lindex $time 5]
      <a name="::snmpDebug(32)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;Starting at $sTime, interval $iTime and finish at $eTime sec&#34; $fd
      <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;waiting for $time seconds to receive trap&#34;
      <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $sTime
      set elpTime $sTime
   }
  <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10
  set trap_fd 0 
  while { 1 } {
     if  {[ file exists $trapFile ] } {
        <a name="::snmpDebug(33)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - opening the trap file\n&#34; $fd
        if { [catch { open $trapFile r } trap_fd] } {
           <a name="::result_error(13)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func unable to open $trapFile : $trap_fd&#34;
           <a name="::snmpDebug(34)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func unable to open $trapFile : $trap_fd&#34; $fd
           eval [file delete -force $trapFile]
           <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
           return 0
        }
        
        <span class="comment-line"># We have got the trap file. Its time to read its contents</span>
		set errList &#34;&#34;
        set foundList &#34;&#34;
        while { [gets $trap_fd line] &gt;= 0 } {
           <a name="::snmpDebug(35)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func Content of $trapFile : $line&#34; $fd
           foreach param $paramList {
              set key [lindex $param 0]
              set status [lindex $param 1]
              if { [regexp -nocase $key $line] } {
                 <a name="::snmpDebug(36)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func $key  MATCHED&#34; $fd
                 if {[string compare [string tolower $status] &#34;notexist&#34;] == 0 } {
                    lappend errList &#34;{$key} exist&#34;
		    <a name="::result_error(14)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wanted $status for $key BUT Got matching line $line&#34;
                 } else {
                    lappend foundList &#34;$key&#34;
		    <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Matching line for $key is $line&#34;
                 }
              } else {
                 <a name="::snmpDebug(37)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func $key NOT MATCHED&#34; $fd
                 if {[string compare [string tolower $status] &#34;notexist&#34;] == 0 } {
                    lappend foundList &#34;{$key notExist}&#34;
                 } else {
                    lappend errList &#34;{$key notExist}&#34;
                 }
              }
           }
        }

 
        if { $time != 0 &amp;&amp; [llength $errList] != 0 } {
           if {$elpTime &lt; $eTime} {
              <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleep for $iTime seconds, already waited \
                            $elpTime sec&#34;
	      <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The error is $errList&#34;
              <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $iTime
              set elpTime [expr $elpTime + $iTime]
              <a name="::snmpDebug(38)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func elapsdtime $elpTime, endTime $eTime, \
                               got trap, but not the needed one&#34; $fd
           } elseif {$elpTime &gt;= $eTime} {
              <a name="::result_error(15)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func unable to get the trap even after \
                            $eTime sec. FAIL&#34;
	      <a name="::result_error(16)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;The error is $errList&#34;
              <a name="::snmpDebug(39)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func -  The error is $errList End\n&#34; $fd
              <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
              close $trap_fd
              return 0
           }
        } else {
           <span class="comment-line"># Check we have any not matching entry, print them</span>
           if  {[llength $errList ] != 0} {
              foreach result $errList {
                 <a name="::result_error(17)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$result. FAIL&#34;
                 <a name="::snmpDebug(40)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$result. FAIL&#34; $fd
              }
				<a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
				close $trap_fd
				return 0
			  }
			set notfound 0
			<span class="comment-line"># Verify we have matchingentry for all the Keys in foundlist</span>
			<span class="comment-line">#result_debug &#34;Found list is $foundList&#34;</span>
			foreach param $paramList {
              set key [lindex $param 0]
              set status [lindex $param 1]
				if {$status == &#34;exist&#34;} {
                if {[lsearch $foundList $key] &gt;=0 } {
                 <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$key exist . PASS&#34;
                 <a name="::snmpDebug(41)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func result is Pass&#34; $fd
              } else {
				  <a name="::result_error(18)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$key expected but not found&#34;
				  incr notfound
			  }
			 } 
			}
			
			
           <a name="::snmpDebug(42)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
           <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
           close $trap_fd
		   if {$notfound &gt; 0} {
				return 0
		   }
           return 1
        }
        close $trap_fd
     } else {
        if { $time == 0 } {
           <a name="::result_error(19)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func Trap file $trapFile does not exist. FAIL&#34;
           <a name="::snmpDebug(43)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func Trap file $trapFile not exist - End\n&#34; $fd
           <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
           return 0
        } elseif {$elpTime &gt;= $eTime} {
           <a name="::result_error(20)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Waited for $elpTime sec, but didn't get the \
                         trap file. FAIL&#34;
           <a name="::snmpDebug(44)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func Trap file $trapFile not exist - End\n&#34; $fd
           <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
           return 0
        } else {
           <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleep for $iTime seconds, already waited $elpTime sec&#34;
           <a name="::exSleep(5)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $iTime
           set elpTime [expr $elpTime + $iTime]
           <a name="::snmpDebug(45)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func elapsdtime $elpTime, endTime $eTime, \
                            not yet got the trap file&#34; $fd
        }
     } 
  }
  <a name="::snmpDebug(46)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
  <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
  return 1
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCreateVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#  This procedure creates a vlan with the specified vlan name</span>
<span class="comment-line">#  in the given DUT.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection</span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    name   - Name of the VLAN to be created</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor for logging the command outputs   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    vlan identifier - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCreateVlan -session $sessionid -name &#34;TEST&#34;</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpCreateVlan_939">proc <a href="snmplib.tcl-annot.html#::::snmpCreateVlan">::::snmpCreateVlan</a></a></strong> { args } {
    <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCreateVlan $args {
       session &#34;&#34;
       name  &#34;&#34;
       tag  &#34;&#34;
       fd &#34;NULL&#34;
    }
 
    set func &#34;snmpCreateVlan:&#34; 

    if { $session == &#34;&#34; || $name == &#34;&#34; } {
       error &#34;$func session and vlan name must be specified&#34;
       return
    }   

    <a name="::snmpDebug(47)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session vlanname: $name tag: $tag fd-$fd -Start&#34; $fd

    <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Creating VLAN $name --&#34;

    set vlanIfIndex [snmpGet -session $session -oid extremeNextAvailableVirtIfIndex.0]

    <a name="::snmpDebug(48)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet-$vlanIfIndex&#34; $fd

    set res [<a name="::snmpUtilGetVal(1)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $vlanIfIndex]

    if { $tag != &#34;&#34; } {
         set result [snmpSet -session $session \
                        -oid extremeVlanIfDescr.$res -type s -val $name\
                        -oid extremeVlanIfVlanId.$res -type i -val $tag\
                        -oid extremeVlanIfStatus.$res -type i -val 4]
     } else {
         set result [snmpSet -session $session \
                        -oid extremeVlanIfDescr.$res -type s -val $name\
                        -oid extremeVlanIfStatus.$res -type i -val 4]
     }
    <a name="::snmpDebug(49)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet-$result&#34; $fd
    <a name="::snmpDebug(50)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func result-$res -End\n&#34; $fd
    return $res
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpDeleteVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#  This procedure deletes a vlan with the specified vlan name</span>
<span class="comment-line">#  in the given DUT.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection</span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    name   - Name of the VLAN to be deleted</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor for logging the command outputs   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    vlan identifier - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpDeleteVlan -session $sessionid -name &#34;TEST&#34;</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpDeleteVlan_1005">proc <a href="snmplib.tcl-annot.html#::::snmpDeleteVlan">::::snmpDeleteVlan</a></a></strong> {args} {

    <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpDeleteVlan $args {
       session &#34;&#34;
       vlanid  &#34;0&#34;
       fd  &#34;NULL&#34;
    }
    
    set func &#34;snmpDeleteVlan:&#34;
    
    if { $session == &#34;&#34; || $vlanid == 0} {
       error &#34;$func session and vlanid must be specified&#34;
       return 0
    }
 
    <a name="::snmpDebug(51)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session vlanid-$vlanid - Start&#34; $fd

    <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Deleting VLAN --&#34;

    set result [snmpSet -session $session -oid extremeVlanIfStatus.$vlanid -type i -val 6]

    <a name="::snmpDebug(52)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet-$result - End\n&#34; $fd

    return 1
}


<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpAddPortToVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#  This procedure adds ports to already created vlan. The ports</span>
<span class="comment-line">#  can be specified as comma separated list like 1,3,5 or port </span>
<span class="comment-line">#  ranges can be specified as 1-5. </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection</span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    vlanid - Identifier of the already created vlan</span>
<span class="comment-line">#    port - Port numbers to be added to the vlan </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    tagid - Tag identifier. If the tagid is not specified, the</span>
<span class="comment-line">#            port will be added as untagged.</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#   snmpAddPortToVlan -session $sessionid -vlanid $vlan_id \</span>
<span class="comment-line">#                                           -port 1,3,4,9-18 </span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpAddPortToVlan_1063">proc <a href="snmplib.tcl-annot.html#::::snmpAddPortToVlan">::::snmpAddPortToVlan</a></a></strong> {args} {

   <a name="::parse_args(8)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpAddPortToVlan $args {
      session &#34;&#34;
      vlanid  &#34;0&#34;
      <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;&#34;
      tagid &#34;untagged&#34;
      fd &#34;NULL&#34;
   }
 
   set func &#34;snmpAddPortToVlan:&#34;

   if {$session == &#34;&#34; || $vlanid == 0 || $port == &#34;&#34; } {
      error &#34;$func session, vlanid and port must be specified&#34;
      return
   }

   <a name="::snmpDebug(53)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session vlanid-$vlanid port-$port tag-$tagid fd-$fd - Start&#34; $fd

   <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Adding ports $port to VLAN --&#34;
   <span class="comment-line"># Parse the given port numbers</span>
   set slotList &#34;&#34;
   set portList [<a name="::snmpUtilGetSlotPort(1)"><a href="./snmplib.tcl.html#::snmpUtilGetSlotPort_2114">::snmpUtilGetSlotPort</a></a> $port slotList]
   puts &#34;slot list = $slotList&#34;
   puts &#34;port list = $portList&#34;

   <span class="comment-line"># The ports are to be added as tagged/untagged port</span>
   if {$tagid == &#34;untagged&#34;} { 
       set tagVal 2
   } else {
       set tagVal 1
   }
   set len1 [llength $slotList]
   set len2 [llength $portList]
   if { $len1 != $len2 } {
      error &#34;$func session, portList and slotList are not of equal size&#34;
      return
   } 
   for { set i 0 } { $i &lt; $len1 } { incr i } {
       set slot [lindex $slotList $i]
       set port [lindex $portList $i]
       set hexStr [<a name="::snmpUtilPortToHexStr(1)"><a href="./snmplib.tcl.html#::snmpUtilPortToHexStr_2220">::snmpUtilPortToHexStr</a></a> $port]
       <a name="::snmpDebug(54)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func Port added is $port : $hexStr&#34; $fd
       set result [snmpSet -session $session \
                       -oid extremeVlanOpaqueControlPorts.$vlanid.$slot -type x -val $hexStr \
                       -oid extremeVlanOpaqueControlOperation.$vlanid.$slot -type i -val $tagVal \
                       -oid extremeVlanOpaqueControlStatus.$vlanid.$slot -type i -val 4]

       <a name="::snmpDebug(55)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet -$result&#34; $fd
   }

   <a name="::snmpDebug(56)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   return 1 
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpDelPortFromVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#  This procedure deletes ports from already created vlan. The </span>
<span class="comment-line">#  ports can be specified as comma separated list like 1,3,5 or port </span>
<span class="comment-line">#  ranges can be specified as 1-5. </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection</span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    vlanid - Identifier of the already created vlan</span>
<span class="comment-line">#    port - Port numbers to be deleted from the vlan </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    tagid - Tag identifier. The tagid must be specified to </span>
<span class="comment-line">#            delete a tagged port.</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#   snmpDelPortFromVlan -session $sessionid -vlanid $vlan_id \</span>
<span class="comment-line">#                                           -port 1,3,4,9-18 </span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpDelPortFromVlan_1149">proc <a href="snmplib.tcl-annot.html#::::snmpDelPortFromVlan">::::snmpDelPortFromVlan</a></a></strong> {args} {
   <a name="::parse_args(9)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpDelPortFromVlan $args {
      session &#34;&#34;
      vlanid  &#34;0&#34;
      <a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;&#34;
      tagid &#34;3&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpDelPortFromVlan:&#34;
   set tagid 3
   if {$session == &#34;&#34; || $vlanid == 0 || $port == &#34;&#34; } {
      error &#34;$func session, vlanid and port must be specified&#34;
      return
   }

   <a name="::snmpDebug(57)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session vlanid-$vlanid port-$port \
                    tagid - $tagid fd-$fd - Start&#34; $fd

   <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Deleting ports $port from VLAN --&#34;
   set slotList &#34;&#34;
   set portList [<a name="::snmpUtilGetSlotPort(2)"><a href="./snmplib.tcl.html#::snmpUtilGetSlotPort_2114">::snmpUtilGetSlotPort</a></a> $port slotList]
   puts &#34;slot list = $slotList&#34;
   puts &#34;port list = $portList&#34;

   <span class="comment-line"># The ports are to be added as tagged/untagged port</span>
   set len1 [llength $slotList]
   set len2 [llength $portList]
   if { $len1 != $len2 } {
      error &#34;$func session, portList and slotList are not of equal size&#34;
      return
   } 
   for { set i 0 } { $i &lt; $len1 } { incr i } {
       set slot [lindex $slotList $i]
       set port [lindex $portList $i]
       set hexStr [<a name="::snmpUtilPortToHexStr(2)"><a href="./snmplib.tcl.html#::snmpUtilPortToHexStr_2220">::snmpUtilPortToHexStr</a></a> $port]
       <a name="::snmpDebug(58)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func Port added is $port : $hexStr&#34; $fd
       set result [snmpSet -session $session \
                       -oid extremeVlanOpaqueControlPorts.$vlanid.$slot -type x -val $hexStr \
                       -oid extremeVlanOpaqueControlOperation.$vlanid.$slot -type i -val $tagid \
                       -oid extremeVlanOpaqueControlStatus.$vlanid.$slot -type i -val 4]

       <a name="::snmpDebug(59)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet -$result&#34; $fd
   }

   <a name="::snmpDebug(60)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34;
   return 1
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCreateTag</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure creates a vlan tag with the specified values.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection</span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    tag -  Tag value to be created.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    Vlan encapsulation interface index - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#   snmpCreateTag -session $sessionid -tag 10</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpCreateTag_1223">proc <a href="snmplib.tcl-annot.html#::::snmpCreateTag">::::snmpCreateTag</a></a></strong> { args } {
   <a name="::parse_args(10)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCreateTag $args {
      session &#34;&#34;
      tagid &#34;&#34;
      fd &#34;NULL&#34;
   }
   
   set func &#34;snmpCreateTag:&#34;

   if { $session == &#34;&#34; || $tagid == &#34;&#34; } {
       error &#34;$func session and tagid value must be specified&#34;
       return
   }
 
   <a name="::snmpDebug(61)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session tagid-$tagid fd-$fd - Start&#34; $fd

   <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Creating VLAN tag $tagid --&#34;

   set res [snmpGet -session $session -oid extremeNextAvailableVirtIfIndex.0]

   <a name="::snmpDebug(62)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet - $res&#34; $fd
  
   set vlanEncapIfIndex [<a name="::snmpUtilGetVal(2)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $res]

   <a name="::snmpDebug(63)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func vlanEncapIfIndex-$vlanEncapIfIndex&#34; $fd
   
   set result [snmpSet -session $session -oid extremeVlanEncapsIfTag.$vlanEncapIfIndex -type i -val $tagid -oid extremeVlanEncapsIfType.$vlanEncapIfIndex -type i -val 1 -oid extremeVlanEncapsIfStatus.$vlanEncapIfIndex -type i -val 1]

   <a name="::snmpDebug(64)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet-$result&#34; $fd 

   <a name="::snmpDebug(65)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func return-$vlanEncapIfIndex - End\n&#34; $fd 
   return $vlanEncapIfIndex
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpDeleteTag</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure deletes already created tag.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection</span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    tag -  Tag value to be deleted.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    Vlan encapsulation interface index - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#   snmpDeleteTag -session $sessionid -tagid 10</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpDeleteTag_1282">proc <a href="snmplib.tcl-annot.html#::::snmpDeleteTag">::::snmpDeleteTag</a></a></strong> { args } {
   <a name="::parse_args(11)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpDeleteTag $args {
      session &#34;&#34;
      tagid &#34;&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpDeleteTag:&#34;

   if { $session == &#34;&#34; || $tagid == &#34;&#34; } {
       error &#34;$func session and tagid value must be specified&#34;
       return
   }

   <a name="::snmpDebug(66)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session tag-$tagid fd-$fd - Start&#34; $fd

   <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Deleting VLAN tag $tagid --&#34;

   set result [snmpSet -session $session -oid extremeVlanEncapsIfStatus.$tagid -type i -val 6]

   <a name="::snmpDebug(67)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet - $result&#34; $fd
   <a name="::snmpDebug(68)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func snmpSet - $result - End\n&#34; $fd

}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpAddProtocolToVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure associates a protocol to already created vlan.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection </span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    vlanid - Identifier for already created vlan</span>
<span class="comment-line">#    protoid - Protocol identifier (1-IP,2-ANY,3-ipx,4-decnet</span>
<span class="comment-line">#		5-netbios,6-ipx_8022,7-ipx_snap,8-appletalk)</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    set prot_indx [snmpCreateProtocol -session $sessionid \</span>
<span class="comment-line">#                   -name &#34;TEST&#34; -type ETHER  -protoid 0x2]</span>
<span class="comment-line">#    snmpAddProtocolToVlan -session $sessionid -vlanid $vlan_id\</span>
<span class="comment-line">#                   -protoid $prot_indx</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpAddProtocolToVlan_1337">proc <a href="snmplib.tcl-annot.html#::::snmpAddProtocolToVlan">::::snmpAddProtocolToVlan</a></a></strong> { args } {
   <a name="::parse_args(12)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpAddProtocolToVlan $args {
      session &#34;&#34;
      vlanid &#34;&#34;
      protoid &#34;&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpAddProtocolToVlan:&#34;

   if { $session == &#34;&#34; || $vlanid == &#34;&#34; || $protoid == &#34;&#34; } {
       error &#34;$func session,vlanid and protoid must be specified&#34;
       return
   }

   <a name="::snmpDebug(69)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func segssion-$session vlanid-$vlanid protoid-$protoid fd-$fd- Start&#34; $fd

   <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Adding protocol with protoid $protoid to VLAN --&#34;

   set result [snmpSet -session $session -oid extremeVlanProtocolVlanStatus.$vlanid.$protoid -type i -val 4]

   <a name="::snmpDebug(70)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet - $result&#34; $fd
   <a name="::snmpDebug(71)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func snmpSet - $result - End\n&#34; $fd
  
   return 1
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpDelProtocolToVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure deletes a protocol from a vlan.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection </span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    vlanid - Identifier for already created vlan</span>
<span class="comment-line">#    protoid - Protocol identifier (IP - 2, IPX - 3 NetBios - 4).</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpDelProtocolToVlan -session $sessionid -vlanid $vlan_id\</span>
<span class="comment-line">#                   -protoid $prot_indx</span>
<span class="comment-line">###############################################################</span>


<strong><a name="::::snmpDelProtocolFromVlan_1392">proc <a href="snmplib.tcl-annot.html#::::snmpDelProtocolFromVlan">::::snmpDelProtocolFromVlan</a></a></strong> { args } {
   <a name="::parse_args(13)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpDelProtocolFromVlan $args {
      session &#34;&#34;
      vlanid &#34;&#34;
      protoid &#34;&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpDelProtocolToVlan:&#34;

   if { $session == &#34;&#34; || $vlanid == &#34;&#34; || $protoid == &#34;&#34; } {
       error &#34;$func session,vlanid and protoid must be specified&#34;
       return
   }

   <a name="::snmpDebug(72)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session vlanid-$vlanid protoid-$protoid fd-$fd- Start&#34; $fd

   <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Deleting protocol with protoid $protoid from VLAN --&#34;

   set result [snmpSet -session $session -oid extremeVlanProtocolVlanStatus.$vlanid.$protoid -type i -val 6]

   <a name="::snmpDebug(73)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet - $result&#34; $fd
   <a name="::snmpDebug(74)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func snmpSet - $result - End\n&#34; $fd
   
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckFdb</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures checks whether the specified mac address </span>
<span class="comment-line">#    is learnt or not learnt through the given vlan and port id.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection </span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    vlanid - Identifier for already created vlan</span>
<span class="comment-line">#    port - Port number</span>
<span class="comment-line">#    mac - Mac address to be checked for its existence or </span>
<span class="comment-line">#          non-existence.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    testno -  Test case number used for logging</span>
<span class="comment-line">#    comment - Test case comment to be logged in the text file.</span>
<span class="comment-line">#    result - If the value is &#34;exist&#34;, the mac address must be </span>
<span class="comment-line">#             present. If &#34;notexist&#34;, mac address should not </span>
<span class="comment-line">#             be present in the FDB. Default is &#34;exist&#34; </span>
<span class="comment-line">#    val    - List of result in which the mac address to be</span>
<span class="comment-line">#             searched.</span>
<span class="comment-line">#    flag   - Flag indicating the MAC address is a static or dynamic entry</span>
<span class="comment-line">#             possible values are &#34;mgmt&#34; for static. &#34;learned&#34; for dynamic.</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line">#  </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    Logs the success message - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    set mac &#34;00:02:03:02:0A:0B&#34;</span>
<span class="comment-line">#    snmpCheckFdb -session $sessionid -vlanid $vlan_id -port 1\</span>
<span class="comment-line">#             -mac $mac -result exist -testno $testNo \</span>
<span class="comment-line">#             -comment &#34;Check $mac through vlan $vlan_id port 1&#34;</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpCheckFdb_1460">proc <a href="snmplib.tcl-annot.html#::::snmpCheckFdb">::::snmpCheckFdb</a></a></strong> { args } {
  <a name="::parse_args(14)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckFdb $args {
      session &#34;&#34;
      result &#34;exist&#34;
      mac &#34;&#34;
      vlanid &#34;&#34;
      <a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;&#34;
      testno &#34;snmpCheckFdb&#34;
      comment &#34;none&#34;
      fd &#34;NULL&#34;
      val &#34;&#34;
      flag &#34;learned&#34;
  }

  set func &#34;snmpCheckFdb:&#34;

  if { $session == &#34;&#34; || $mac == &#34;&#34; || $vlanid == &#34;&#34; || $port == &#34;&#34; } {
       error &#34;$func session,mac,vlanid and port must be specified&#34;
       return 0
  }

  if { $result != &#34;&#34; } {
     set result [string tolower $result]
     if { !([string compare &#34;exist&#34; $result] == 0  ||
          [string compare &#34;notexist&#34; $result] == 0) } {
        error &#34;$func $result is invalid argument should be exist or notexist&#34;
        return 0
     }
  }

  set flag [string tolower $flag]
  if { !([string compare &#34;learned&#34; $flag] == 0  ||
         [string compare &#34;mgmt&#34; $flag] == 0     ||
         [string compare &#34;other&#34; $flag] == 0) } {
       error &#34;$func $flag is invalid argument should be learned, mgmt or other&#34;
       return 0
  }

  <a name="::snmpDebug(75)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session result-$result mac-$mac vlanid-$vlanid port-$port - Start&#34; $fd

  <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Checking FDB entry with MAC $mac, port $port --&#34;

  <span class="comment-line"># Convert port id for multiple blade platforms</span>
  set portList [<a name="::snmpUtilParsePortList(1)"><a href="./snmplib.tcl.html#::snmpUtilParsePortList_1988">::snmpUtilParsePortList</a></a> $port]
  set port [lindex $portList 0]

  <span class="comment-line"># MAC address needs to be formated according to the output of the SNMP</span>
  <span class="comment-line"># 00:01:0A:0B:12:13 must be changed as 0:1:a:b:12:13</span>

  set mac [<a name="::snmpUtilFormatMacAddr(1)"><a href="./snmplib.tcl.html#::snmpUtilFormatMacAddr_2411">::snmpUtilFormatMacAddr</a></a> $mac]

  <a name="::snmpDebug(76)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func formated mac address is - $mac&#34; $fd

  if {$val == &#34;&#34;} {
     set output [snmpGetTable -session $session -oid extremeFdbMacFdbMacAddress]
  } else {
     set output $val
  }
  
  <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;

  foreach line [split $output &#34;\n&#34;] {
     if {[regexp -nocase $mac $line matchedRange] == 1} {
        <a name="::snmpDebug(77)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func $mac and $line matched&#34; $fd
        set seqnum [<a name="::snmpUtilGetIndex(1)"><a href="./snmplib.tcl.html#::snmpUtilGetIndex_2355">::snmpUtilGetIndex</a></a> 2 $line]
        set vlaninfo [<a name="::snmpUtilGetIndex(2)"><a href="./snmplib.tcl.html#::snmpUtilGetIndex_2355">::snmpUtilGetIndex</a></a> 1 $line]
        if { $vlaninfo != $vlanid } {
           <a name="::snmpDebug(78)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func I/P vlan id - $vlanid and O/P vlan id -$vlaninfo NOT matched&#34; $fd
           continue;
        }
        if {[info exists seqnum] == 1} {
           set prt [snmpGet -session $session -oid \
                    extremeFdbMacFdbPortIfIndex.$vlanid.$seqnum]
           <a name="::snmpDebug(79)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet-$prt&#34; $fd

           set portnum [<a name="::snmpUtilGetVal(3)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $prt]

           set res [snmpGet -session $session -oid \
                    extremeFdbMacFdbStatus.$vlanid.$seqnum]
           <a name="::snmpDebug(80)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet-$res&#34; $fd

           set flagval [<a name="::snmpUtilGetVal(4)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> inttext $res]

           if {$flagval == $flag} {
             set flagstat true
           } else {
             set flagstat false
           }

           if {$portnum == $port} {
             if {[string compare &#34;exist&#34; $result] == 0 &amp;&amp; $flagstat == &#34;true&#34;} {
                  <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;FDB Entry exist with port $port vlanid $vlanid seqnum $seqnum, expected $result. PASS&#34;   
             } elseif {[regexp -nocase &#34;notexist&#34; $result] &amp;&amp; $flagstat == &#34;false&#34;} {
                  <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$flag FDB Entry not exist with port $port vlanid $vlanid seqnum $seqnum, expected $result. PASS&#34;
             } else {
                  <a name="::result_error(21)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;FDB Entry exist with port $port vlanid $vlanid seqnum $seqnum, expected $result. FAIL&#34;   
             }
             <a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
             return
          } else {
             if {[regexp -nocase &#34;notexist&#34; $result]} {
                    <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;portnum $portnum port $port not matching result $result. PASS&#34;
             } else {
                     <a name="::result_error(22)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;portnum $portnum port $port NOT matching result $result. FAIL&#34;
             }
             <a name="::report_end_test(10)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
             <a name="::snmpDebug(81)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
             return
          }
       }
     } else {
         <a name="::snmpDebug(82)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func $mac and $line NOT matched&#34; $fd
     }
  }

  if {[string compare &#34;exist&#34; $result] == 0} {
      <a name="::result_error(23)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;FDB Entry not exist for $mac $vlanid $port, expected $result. FAIL&#34;
  } else {
      <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;FDB Entry exist for $mac $vlanid $port, expected $result. PASS&#34;
  }

  <a name="::report_end_test(11)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
  <a name="::snmpDebug(83)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
  return
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckKeyValue</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure matches the given input value with the </span>
<span class="comment-line">#    output of SNMP operation.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#   </span>
<span class="comment-line">#     paramList - Parameter containing the list of key values </span>
<span class="comment-line">#                 to be checked. If the check is to find out </span>
<span class="comment-line">#                 whether the value exists or not, then &#34;exist&#34;</span>
<span class="comment-line">#                 key word can be given along with the match pattern.</span>
<span class="comment-line">#                 Otherwise &#34;notexist&#34; can be specified. Default is</span>
<span class="comment-line">#                 &#34;exist&#34;</span>
<span class="comment-line">#     output    - The value with which the given key values to </span>
<span class="comment-line">#                 be matched. </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    testno - Test number to be put in report.txt file </span>
<span class="comment-line">#             for reference</span>
<span class="comment-line">#    comment - User specified comment to be put in report.txt </span>
<span class="comment-line">#              file for reference.</span>
<span class="comment-line">#    fd - File descriptor for logging the command outputs   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    Logs that the match is found - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#   set result snmpGet . . .</span>
<span class="comment-line">#   lappend paramList {{.*extremeFanNumber.1.* =.*1} exist}</span>
<span class="comment-line">#   lappend paramList {{.*extremeFanNumber.4.* =.*4} notexist}</span>
<span class="comment-line">#   snmpCheckKeyValue $paramList -output $result</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpCheckKeyValue_1624">proc <a href="snmplib.tcl-annot.html#::::snmpCheckKeyValue">::::snmpCheckKeyValue</a></a></strong> {paramList args} {
   <a name="::parse_args(15)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckKeyValue $args {
      output &#34;&#34;
      testno &#34;&#34;
      comment &#34;snmpCheckKeyValue&#34; 
      fd &#34;NULL&#34; 
   }

   set func &#34;snmpCheckKeyValue:&#34;

   <a name="::snmpDebug(84)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func output-$output testno-$testno - Start&#34; $fd

   <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Checking for $paramList in $output --&#34;

   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;

   set paramList [<a name="::_EnhanceStackingParameterList(1)"><a href="./OptionCheck.tcl.html#::_EnhanceStackingParameterList_1345">::_EnhanceStackingParameterList</a></a> $paramList]
   set paramList [<a name="::_EnhancePioneerParameterList(1)"><a href="./OptionCheck.tcl.html#::_EnhancePioneerParameterList_1375">::_EnhancePioneerParameterList</a></a> $paramList]
   foreach key $paramList {
      set var [lindex $key 1]
      if { $var != &#34;&#34;} {
         set status [lindex $key 1]
      } else {
         set status &#34;exist&#34;
      }

      if {[regexp -nocase [lindex $key 0] $output match] == 1} {
         if { $status != &#34;exist&#34;} {
            <a name="::result_error(24)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$key not matched with $output. FAIL&#34;
         } else {
<span class="comment-line">#            result_ok &#34;$key matched with $output. PASS&#34; </span>
            <a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$key matched with the output. PASS&#34;
         }
      } else {
         if {$status == &#34;exist&#34;} {
            <a name="::result_error(25)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$key matched with $output. FAIL&#34;
         } else {
<span class="comment-line">#            result_ok &#34;$key does not found in $output. PASS&#34;</span>
            <a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$key does not found in the output. PASS&#34;
         }
      }
   }

   <a name="::report_end_test(12)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   <a name="::snmpDebug(85)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   return
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCreateProtocol</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure creates an user defined protocol type.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection</span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    protoid   - Protocol filter identifier</span>
<span class="comment-line">#    protoidx  - Protocol filter identifier index</span>
<span class="comment-line">#    name      - Name of the protocol filter</span>
<span class="comment-line">#    encap     - Encapsulation type for the filter (1 to 5)</span>
<span class="comment-line">#    id        - Protocol number of the protocol</span>
<span class="comment-line">#    </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor for logging the command outputs   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCreateProtocol -session $sessionid -protoid 16 \</span>
<span class="comment-line">#          -name &#34;Proto1&#34; -encap 1 -id 0x45</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpCreateProtocol_1702">proc <a href="snmplib.tcl-annot.html#::::snmpCreateProtocol">::::snmpCreateProtocol</a></a></strong> {args} {
   <a name="::parse_args(16)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCreateProtocol $args {
     session &#34;&#34;
     protoid &#34;&#34;
     protoidx &#34;1&#34;
     name &#34;&#34;
     encap &#34;&#34;
     id &#34;&#34;
     fd &#34;NULL&#34;
  }

  set func &#34;snmpCreateProtocol:&#34;
 
  if { $session == &#34;&#34; || $protoid == &#34;&#34; || $name == &#34;&#34; || $encap == &#34;&#34;  || $id == &#34;&#34; } {
      error &#34;$func session, protoid, name, encap, id must be specified&#34;
      return 0
  }
  <a name="::snmpDebug(86)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session protoid-$protoid name-$name encap-$encap id-$id - Start&#34; $fd

  <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Creating protocol $name, protoid - $protoid --&#34;

  if {$protoid &gt; 7 } {
     <a name="::snmpDebug(87)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - Protocol id $protoid is not in valid range - End\n&#34; $fd
     return 0
  }

  if {$encap != 1} {
     set result [snmpSet -session $session \
            -oid extremeVlanProtocolName.$protoid.$protoidx -type s -val $name \
            -oid extremeVlanProtocolDllEncapsType.$protoid.$protoidx -type i \
              -val $encap \
            -oid extremeVlanProtocolId.$protoid.$protoidx -type i -val $id  \
            -oid extremeVlanProtocolStatus.$protoid.$protoidx -type i -val 1]
  } else {
     set result [snmpSet -session $session \
            -oid extremeVlanProtocolName.$protoid.$protoidx -type s -val $name \
            -oid extremeVlanProtocolDllEncapsType.$protoid.$protoidx -type i \
              -val $encap \
            -oid extremeVlanProtocolStatus.$protoid.$protoidx -type i -val 1] 
  }

  <a name="::snmpDebug(88)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet-$result&#34; $fd
  <a name="::snmpDebug(89)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func -End\n&#34; $fd
  return $result 
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpDeleteProtocol</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#  This procedure creates an user defined protocol type.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection</span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    protoid   - Protocol filter identifier</span>
<span class="comment-line">#    protoidx  - Protocol filter identifier index</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor for logging the command outputs   </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    vlan identifier - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpDeleteProtocol -session $sessionid -protoid 16</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpDeleteProtocol_1774">proc <a href="snmplib.tcl-annot.html#::::snmpDeleteProtocol">::::snmpDeleteProtocol</a></a></strong> {args} {
  <a name="::parse_args(17)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpDeleteProtocol $args {
     session &#34;&#34;
     protoid &#34;&#34;
     protoidx &#34;1&#34;
     fd &#34;NULL&#34;
  }

  set func &#34;snmpDeleteProtocol:&#34;

  if { $session == &#34;&#34; || $protoid == &#34;&#34; } {
     error &#34;$func session and protoid must be specified&#34;
     return 0
  }
  
  <a name="::snmpDebug(90)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session protoid-$protoid protoidindex \
                   $protoidx- Start&#34; $fd

  <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Deleting protocol with id $protoid --&#34;

  if {$protoid &gt; 7 } {
     <a name="::snmpDebug(91)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - Protocol id $protoid is not in range - End\n&#34; $fd
     return 1
  }

  set result [snmpSet -session $session -oid  extremeVlanProtocolStatus.$protoid.$protoidx -type i -val 6]

  <a name="::snmpDebug(92)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet-$result&#34; $fd
  <a name="::snmpDebug(93)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func -End\n&#34; $fd
  return 1
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpAssignIPAddrToVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure associates a protocol to already created vlan.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection </span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    vlanid - Identifier for already created vlan</span>
<span class="comment-line">#    ipaddr - IP Address for the Vlan.</span>
<span class="comment-line">#    mask   - Subnet Mask for the VLAN.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    set vlan_id [snmpCreateVlan -session $sessionid \</span>
<span class="comment-line">#                   -name &#34;VLAN1&#34;]</span>
<span class="comment-line">#    snmpAssignIPAddrToVlan -session $sessionid -vlanid $vlan_id\</span>
<span class="comment-line">#                    -addr &#34;10.0.0.1&#34; -mask &#34;255.0.0.0&#34; -fd $fd_res</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpAssignIPAddrToVlan_1836">proc <a href="snmplib.tcl-annot.html#::::snmpAssignIPAddrToVlan">::::snmpAssignIPAddrToVlan</a></a></strong> { args } {
   <a name="::parse_args(18)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpAddProtocolToVlan $args {
      session &#34;&#34;
      vlanid &#34;&#34;
      addr &#34;&#34;
      mask &#34;&#34;
      forwarding &#34;&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpAssignIPAddrToVlan:&#34;

   if { $session == &#34;&#34; || $vlanid == &#34;&#34; || $addr == &#34;&#34; || $mask == &#34;&#34;} {
       error &#34;$func session,vlanid addr and mask must be specified&#34;
       return 0
   }

   <a name="::snmpDebug(94)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session vlanid-$vlanid addr-$addr mask-$mask fd-$fd- Start&#34; $fd

   <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Assigning IP address $addr/$mask to VLAN --&#34;

   if {$forwarding == &#34;&#34;} {
     set forwarding 2
   }
   
   set result [snmpSet -session $session -oid extremeVlanIpNetAddress.$vlanid \
             -type a -val $addr -oid extremeVlanIpNetMask.$vlanid -type a \
             -val $mask -oid extremeVlanIpStatus.$vlanid -type i -val 4 \
             -oid extremeVlanIpForwardingState.$vlanid -type i -val $forwarding]

   <a name="::snmpDebug(95)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet - $result&#34; $fd
   <a name="::snmpDebug(96)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func snmpSet - $result - End\n&#34; $fd
  
   return $result
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpDelIPAddrFromVlan</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure deletes IpAddress from a vlan.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection </span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    vlanid - Identifier for already created vlan</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpDelIPAddrFromVlan -session $sessionid -vlanid $vlan_id</span>
<span class="comment-line">###############################################################</span>


<strong><a name="::::snmpDelIPAddrFromVlan_1898">proc <a href="snmplib.tcl-annot.html#::::snmpDelIPAddrFromVlan">::::snmpDelIPAddrFromVlan</a></a></strong> { args } {
   <a name="::parse_args(19)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpDelIPAddrFromVlan $args {
      session &#34;&#34;
      vlanid &#34;&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpDelIPAddrFromVlan:&#34;

   if { $session == &#34;&#34; || $vlanid == &#34;&#34; } {
       error &#34;$func session and vlanid must be specified&#34;
       return
   }

   <a name="::snmpDebug(97)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session vlanid-$vlanid fd-$fd&#34; $fd 

   <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Deleting IP address from VLAN --&#34;

   set result [snmpSet -session $session -oid extremeVlanIpStatus.$vlanid -type i -val 6]

   <a name="::snmpDebug(98)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet - $result&#34; $fd
   <a name="::snmpDebug(99)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func snmpSet - $result - End\n&#34; $fd
   
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCleanUp</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedure deletes the default route configured in         </span>
<span class="comment-line">#    each DUT.</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    None.</span>
<span class="comment-line">#     </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None.</span>
<span class="comment-line">#     </span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCleanUp</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpCleanUp_1946">proc <a href="snmplib.tcl-annot.html#::::snmpCleanUp">::::snmpCleanUp</a></a></strong> {} {
   for {set numDUT 1; global DUT${numDUT}_CONNECT} \
       {[info exists DUT${numDUT}_CONNECT] } \
       {incr numDUT ; global DUT${numDUT}_CONNECT} {
       
             set dutAddr [set DUT${numDUT}_CONNECT]
             <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $dutAddr
             <a name="::UnconfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::UnconfigGatewayNetwork_2356">::UnconfigGatewayNetwork</a></a>
             <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable snmp access&#34;
   }
}

<span class="comment-line">################################################################</span>
<span class="comment-line"># ************* SNMP UTILITY FUNCTIONS ************************#</span>
<span class="comment-line">################################################################</span>

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUtilParsePortList</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure parses the port number of the format</span>
<span class="comment-line">#     port1,port2-port10 and returns individual port numbers</span>
<span class="comment-line">#     between a range of port numbers </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    ports - Port numbers</span>
<span class="comment-line">#    ifIndex/Index - Index required.</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Empty list - on failure</span>
<span class="comment-line">#    Port number list - on success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpUtilParsePortList 1,4,5-20</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpUtilParsePortList_1988">proc <a href="snmplib.tcl-annot.html#::::snmpUtilParsePortList">::::snmpUtilParsePortList</a></a></strong> {ports {index &#34;ifIndex&#34;} } {

   set func &#34;snmpUtilParsePortList:&#34;

   <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$func ports-$ports - Start&#34;

   if { $ports == &#34;&#34; } {
      <a name="::result_error(26)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func empty ports:$ports&#34; 
      return;
   } 
<span class="comment-line">#for ifIndex the formula is (slot*1000) + port number</span>
<span class="comment-line">#for port Index the formula is (slot -1)*128 + port number</span>
   if { $index == &#34;ifIndex&#34; } {
   	set defBase 1000 
        set portIndex 0
   } else {
   	set defBase 0 
        set portIndex 1
   }
   set list &#34;&#34;

   if {[regexp {([^,0-9\- :])+} $ports] == 1} {
      <a name="::result_error(27)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func port number $ports must be in the format &lt;port&gt; | &lt;port1,port2..&gt; | &lt;port1,port2-port5&gt;&#34;
      <a name="::snmpDebug(100)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func port number $ports format is incorrect - End\n&#34;
      return $list
   }

   foreach args [split $ports &#34;,&#34;] {
       set args [string trim $args]
       if {[regexp &#34;(.*:)(.*)-(.*:)(.*)&#34; $args res1 res2 res3 res4 res5] == 1 } {
           for {set i 2} { $i &lt;=5 } {incr i 1} {
              if { [info exists res$i] == 0 } {
                   <a name="::result_error(28)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;res$i does not exist&#34;
              } 
           }
              
           set firstAppendStr $res2
           set secondAppendStr $res4
           if { $res2 != $res4 } {
               <a name="::result_error(29)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;invalid port format $ports&#34;
               return
           }

           set i 1
           set val1 $res3 
           set val2 $res5
           if { $val1 &gt; $val2 } {
               set temp $val1
               set val1 $val2
               set val2 $temp
           }
               
           for {set i $val1} { $i &lt;= $val2 } { incr i 1} {
                set card [string trim $firstAppendStr :]
                if { $portIndex == 1 } {
                     set port [expr ($card-1)*128 + $i]
                } else {
                     set port [expr $card * 1000 + $i]
                }
                lappend list &#34;$port&#34;
           }
       } elseif {[regexp &#34;(.*:)(.*)&#34; $args res1 res2 res3] == 1 } {
           set card [string trim $res2 :]
           if { $portIndex == 1 } {
                 set port [expr ($card-1)*128 + $res3]
            } else {
                 set port [expr $card * 1000 + $res3]
            }
           lappend list &#34;$port&#34;
       } elseif {[regexp &#34;.*-.*&#34; $args] == 1} {
           set i 1
           foreach arg [split $args &#34;-&#34;] {
               if {$i == 1} {
                   set val1  [string trim $arg]
                   incr i 1
               } else {
                   set val2 [string trim $arg]
               }
           }
           if { $val1 &gt; $val2 } {
                
               set temp $val1
               set val1 $val2
               set val2 $temp
           }
               
           for {set i $val1} { $i &lt;= $val2 } { incr i 1} {
               lappend list [expr $defBase + $i]
           }
       } else {
           lappend list [expr $defBase + [string trim $args]]
       }
   }

   <a name="::snmpDebug(101)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func return-$list - End\n&#34;
   return $list
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUtilGetSlotPort</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure parses the port number of the format</span>
<span class="comment-line">#     port1,port2-port10 and returns individual port numbers</span>
<span class="comment-line">#     between a range of port numbers and their corresponding slot</span>
<span class="comment-line">#     numbers in a separate list. </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    ports - Port numbers</span>
<span class="comment-line">#    sList - slot list</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     portList - list of ports</span>
<span class="comment-line">#     slotList - list of slots (using upvar)</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Empty list - on failure</span>
<span class="comment-line">#    Port number list and slot list - on success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#   set portlist [ snmpUtilGetSlotPort 1,4,5-20 $slotList]</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpUtilGetSlotPort_2114">proc <a href="snmplib.tcl-annot.html#::::snmpUtilGetSlotPort">::::snmpUtilGetSlotPort</a></a></strong> { ports sList } {
   upvar $sList slotList
   set portList &#34;&#34;
   set func &#34;snmpUtilGetSlotPort:&#34;

   puts &#34;$func ports-$ports - Start&#34;

   set list &#34;&#34;

   if {[regexp {([^,0-9\- :])+} $ports] == 1} {
      puts &#34;$func port number $ports must be in the format &lt;port&gt; | &lt;port1,port2..&gt; | &lt;port1,port2-port5&gt;&#34;
      return $list
   }

   foreach args [split $ports &#34;,&#34;] {
       set args [string trim $args]
       if {[regexp &#34;(.*:)(.*)-(.*:)(.*)&#34; $args res1 res2 res3 res4 res5] == 1 } {
           for {set i 2} { $i &lt;=5 } {incr i 1} {
              if { [info exists res$i] == 0 } {
                   puts &#34;res$i does not exist&#34;

              }
           }

           set firstAppendStr $res2
           set secondAppendStr $res4
           if { $res2 != $res4 } {
               puts &#34;invalid port format $ports&#34;
               return
           }

           set i 1
           set val1 $res3
           set val2 $res5
           if { $val1 &gt; $val2 } {
               set temp $val1
               set val1 $val2
               set val2 $temp
           }

           for {set i $val1} { $i &lt;= $val2 } { incr i 1} {
                set card [string trim $firstAppendStr :]
                lappend slotList $card
                lappend portList $i
           }
       } elseif {[regexp &#34;(.*:)(.*)&#34; $args res1 res2 res3] == 1 } {
           set card [string trim $res2 :]
           lappend slotList $card
           lappend portList $res3
       } elseif {[regexp &#34;.*-.*&#34; $args] == 1} {
           set i 1
           foreach arg [split $args &#34;-&#34;] {
               if {$i == 1} {
                   set val1  [string trim $arg]
                   incr i 1
               } else {
                   set val2 [string trim $arg]
               }
           }
           if { $val1 &gt; $val2 } {

               set temp $val1
               set val1 $val2
               set val2 $temp
           }
           set card 1
           for {set i $val1} { $i &lt;= $val2 } { incr i 1} {
                lappend slotList $card
                lappend portList $i
           }
       } else {
           set card 1
           lappend slotList $card
           lappend portList [string trim $args]
       }
   }
   <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;slot list = $slotList&#34;
   <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;port list = $portList&#34;
   return $portList
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUtilPortToHexStr</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure converts port numbers into hex string</span>
<span class="comment-line">#     Ex. Port 5</span>
<span class="comment-line">#         HEX STRING: 0800000000000000000000000000000000000000000000000000000000000000</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    port -  Port number(int)</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     </span>
<span class="comment-line">#    Hex string</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    error - On failure </span>
<span class="comment-line">#    hex string  - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    set hexStr  [snmpUtilPortToHexStr $port]</span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpUtilPortToHexStr_2220">proc <a href="snmplib.tcl-annot.html#::::snmpUtilPortToHexStr">::::snmpUtilPortToHexStr</a></a></strong> { <a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> } {
   set hexStr &#34;&#34;
   if { $port &lt;=0 } {
      <a name="::result_error(30)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;invalid port number : $port for hex string conversion&#34;
      return
   }
   set num [expr $port/4]
   set rem [expr $port%4]
   if { $num &gt; 0 &amp;&amp; $rem == 0 } {
       while { $num &gt;1 } {
           append hexStr &#34;0&#34;
           incr num -1
       }
      append hexStr &#34;1&#34;
   } elseif {  $num &gt; 0 &amp;&amp; $rem != 0 } {
       while { $num &gt;0 } {
           append hexStr &#34;0&#34;
           incr num -1
       }
   }
   set pbit &#34;&#34;
   switch $rem {
       &#34;1&#34;  { set pbit &#34;8&#34; }
       &#34;2&#34;  { set pbit &#34;4&#34; }
       &#34;3&#34;  { set pbit &#34;2&#34; }
   }
   append hexStr $pbit
   set len [string length $hexStr]
   set num [expr 64-$len]
   while { $num &gt;0 } {
           append hexStr &#34;0&#34;
           incr num -1
   }
  <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Hex string = $hexStr&#34;
  return $hexStr
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUtilGetVal</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure extracts the return value of SNMP get / set </span>
<span class="comment-line">#     commands.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    type - Type of the return value (int | string)</span>
<span class="comment-line">#    param  -  Output of SNMP set / get operation</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    error - On failure </span>
<span class="comment-line">#    extracted value - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    set output [snmpGet -session $session_id -oid $oid</span>
<span class="comment-line">#    snmpUtilGetVal int $output</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpUtilGetVal_2283">proc <a href="snmplib.tcl-annot.html#::::snmpUtilGetVal">::::snmpUtilGetVal</a></a></strong> { type param } {
 
   set func &#34;snmpUtilGetVal:&#34;

   set res &#34;&#34;
   if { $type == &#34;int&#34; } {
      regexp {.*INTEGER.* ([0-9|-]*)} $param res1 res
   } elseif { $type == &#34;intsec&#34; } {
      regexp {.*INTEGER.* ([0-9]+)} $param res1 res
   } elseif { $type == &#34;counter&#34; } {
      regexp {.*Counter(32|64).* ([0-9]*)} $param res1 res2 res
   } elseif { $type == &#34;boolean&#34; } {
      regexp {.*INTEGER.* ([a-zA-Z]*)} $param res1 res
   } elseif { $type == &#34;inttext&#34; } {
      regexp {.*INTEGER.* (.*)\(.*\)} $param res1 res
   } elseif { $type == &#34;enum&#34; } {
      regexp {.*\((.*)\)} $param res1 res 
   } elseif { $type == &#34;timetick&#34; } {
      regexp {.*\(([0-9]+)} $param res1 res
   } elseif { $type == &#34;ipaddr&#34; } {
      regexp {.*IpAddress: (.*)} $param res1 res
   } elseif { $type == &#34;hex&#34; } {
      regexp -nocase {.*Hex-STRING: ([0-9|A-F|\ ]+)} $param res1 res
   } elseif { $type == &#34;str&#34; } {
      regexp -nocase {.*STRING: \&#34;(.*)\&#34;} $param res1 res
   } elseif { $type == &#34;mac&#34; } {
      regexp -nocase {.*STRING: ([0-9|A-F|:|\ ]+)} $param res1 res
   } elseif { $type == &#34;tick&#34; } {
      regexp {.*Timeticks.*\(.*\) ([0-9|\:|\.]+)} $param res1 res
   } elseif { $type == &#34;gauge&#34; } {
      regexp {.*Gauge(32|64).* ([0-9]*)} $param res1 res2 res
   } elseif { $type == &#34;negative&#34; } {
      regexp {.*INTEGER.* (\-[0-9]*)} $param res1 res 
   } else {
       <a name="::result_error(31)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func Input $type is not supported&#34;
       return &#34;error&#34;
   }
   if {[info exists res] == 1} {
      return $res
   } else {
      <a name="::result_error(32)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func Input $param does not contain a $type value. res is $res res1 is $res1 FAIL&#34;
      return &#34;error&#34;
   }
}


<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUtilGetIndex</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure extracts the SNMP index value from an oid</span>
<span class="comment-line">#     depending on the position of the index (first or second)</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    pos - First or second index</span>
<span class="comment-line">#    param - Oid</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - on failure</span>
<span class="comment-line">#    Extracted index value - on success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    set output [snmpGet -session $session_id -oid $oid</span>
<span class="comment-line">#    snmpUtilGetIndex 1 $output</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpUtilGetIndex_2355">proc <a href="snmplib.tcl-annot.html#::::snmpUtilGetIndex">::::snmpUtilGetIndex</a></a></strong> { pos param } {

   set func &#34;snmpUtilGetIndex:&#34;

   if {$pos == 0 || $pos &gt; 2} {
       <a name="::result_error(33)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func pos should be 1 or 2&#34;
   }

   if {[regexp {.*[.]([0-9]+)[.]([0-9]+)} $param res res1 res2] == 0} {
       <a name="::result_error(34)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func index1.index2 not found in $param. FAIL&#34;
   }

   if { $pos == 1 } {
      if {[info exists res1]} {
         return $res1
      } else {
         <a name="::result_error(35)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func index1.index2 not found in $param. FAIL&#34;
      }
   }

   if { $pos == 2 } {
      if {[info exists res2]} {
         return $res2
      } else {
         <a name="::result_error(36)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$func index1.index2 not found in $param. FAIL&#34;
      }
   }

}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUtilFormatMacAddr</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#     This procedure formats the given MAC address to match</span>
<span class="comment-line">#     the SNMP MAC address representation. In SNMP output,</span>
<span class="comment-line">#     00:01:0A:0B:0C:1A MAC address is specified as</span>
<span class="comment-line">#     0:1:a:b:c:1a</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    mac - MAC address that needs to be formated</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#     Formated mac address</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#     set mac &#34;00:01:0A:0B:0C:1A&#34;</span>
<span class="comment-line">#     snmpUtilFormatMacAddr $mac</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpUtilFormatMacAddr_2411">proc <a href="snmplib.tcl-annot.html#::::snmpUtilFormatMacAddr">::::snmpUtilFormatMacAddr</a></a></strong> {mac} {
   foreach addr [split $mac &#34;:&#34;] {
      if { [regexp {(^[0])([0-9]|[A-Za-z])} $addr addr addr1 addr2] == 1 } {
         append var [string tolower $addr2]
      } else {
         append var [string tolower $addr]
      }
      append var &#34;:&#34;
   }
   
   return [string trim [string trim $var &#34;:&#34;]]
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUtilGetVlanIfIndexFromName</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures retrieves the VLAN interface index for the</span>
<span class="comment-line">#    given VLAN name</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    sessionid - SNMP session established with the DUT</span>
<span class="comment-line">#    vlanname  - Name of the VLAN</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#     VLAN ifindex / ERROR </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#     snmpUtilGetVlanIfIndexFromName $sessionid &#34;Default&#34;</span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpUtilGetVlanIfIndexFromName_2447">proc <a href="snmplib.tcl-annot.html#::::snmpUtilGetVlanIfIndexFromName">::::snmpUtilGetVlanIfIndexFromName</a></a></strong> { sessionid vlanname } {
   set result [snmpGetTable -session $sessionid -oid extremeVlanIfDescr]
   foreach vlanInfo [split $result &#34;\n&#34;] {
     if { [regexp -nocase $vlanname $vlanInfo] } {
       regexp {.*[.]([0-9]+)} $vlanInfo res vlanIfIndex
       if { [info exists vlanIfIndex] } {
          <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;snmpUtilGetVlanIfIndexFromName - VLAN ifindex for $vlanname is $vlanIfIndex&#34;
          return $vlanIfIndex
       }
     }
   }
   <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;snmpUtilGetVlanIfIndexFromName - VLAN ifindex for $vlanname is ERROR&#34;
   return &#34;ERROR&#34;
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpUtilGetTagIndexFromTag</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures retrieves the Encap interface index for the</span>
<span class="comment-line">#    given tag value</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    sessionid - SNMP session established with the DUT</span>
<span class="comment-line">#    tag  - Tag value       </span>
<span class="comment-line"># </span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#      tagIndex / ERROR </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#     snmpUtilGetTagIndexFromTag $sessionid &#34;2&#34;</span>
<span class="comment-line">###############################################################</span>
<strong><a name="::::snmpUtilGetTagIndexFromTag_2485">proc <a href="snmplib.tcl-annot.html#::::snmpUtilGetTagIndexFromTag">::::snmpUtilGetTagIndexFromTag</a></a></strong> { sessionid tag } {
   set info &#34;INTEGER: $tag&#34;
   set result [snmpGetTable -session $sessionid -oid extremeVlanEncapsIfTag]
   <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;snmp get table operation receives $result&#34;
   foreach tagInfo [split $result &#34;\n&#34;] {
     if { [regexp -nocase $info $tagInfo] } {
       regexp {.*[.]([0-9]+)} $tagInfo res tagIndex
       if { [info exists tagIndex] } {
          <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;snmpUtilGetTagIndexFromTag - Tag index for Tag $tag is \
                        $tagIndex&#34;
          return $tagIndex
       }
     }
   }
   <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;snmpUtilGetTagIndexFromTag- Tag index for Tag $tag is ERROR&#34;
   return &#34;ERROR&#34;
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  Procedure Name: snmpChangePortState</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#  This procedure chhanfes the port status to enable or disable</span>
<span class="comment-line">#  for the specified set of ports. </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection</span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    port - Port numbers to be added to the vlan </span>
<span class="comment-line">#    status - enable or disable </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#   snmpChangePortState -session $sessionid -port 1,3,4,9-18 \</span>
<span class="comment-line">#                       -status enable</span>
<span class="comment-line">#   snmpChangePortState -session $sessionid -port 1,3,4,9-18 \</span>
<span class="comment-line">#                       -status 1</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::snmpChangePortState_2533">proc <a href="snmplib.tcl-annot.html#::::snmpChangePortState">::::snmpChangePortState</a></a></strong> {args} {

   <a name="::parse_args(20)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpChangePortState $args {
      session &#34;&#34;
      <a name="::port(5)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;&#34;
      status &#34;&#34;
      fd &#34;NULL&#34;
   }
 
   set func &#34;snmpChangePortState:&#34;

   set state(1) &#34;enable&#34;
   set state(2) &#34;disable&#34;

   if {$session == &#34;&#34; || $port == &#34;&#34; || $status == &#34;&#34;} {
      error &#34;$func session, port and status must be specified&#34;
      return
   }

   if {$status == 1 || $status == 2} { 
      set value $status
   } elseif {$status == &#34;enable&#34;} {
      set value 1
   } elseif {$status == &#34;disable&#34;} {
      set value 2
   } else {
      error &#34;$func status should be either enable (1) or disable (2) &#34;
      return
   }

   <a name="::snmpDebug(102)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session port-$port change status to \
                    $state($value) fd-$fd &#34; $fd

   <span class="comment-line"># Parse the given port numbers</span>
   set portList [<a name="::snmpUtilParsePortList(2)"><a href="./snmplib.tcl.html#::snmpUtilParsePortList_1988">::snmpUtilParsePortList</a></a> $port]

   <span class="comment-line"># Change status for the ports</span>
   foreach element $portList {
      <a name="::snmpDebug(103)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func $status Port $element&#34; $fd
      set result [snmpSet -session $session -oid ifAdminStatus.$element \
                  -type i -val $value]
      <a name="::snmpDebug(104)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet -$result&#34; $fd
   }
   <a name="::snmpDebug(105)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   return 1 
}

<span class="comment-line">#######################################################################################################################</span>
<span class="comment-line"># Name: lldpSnmpWalk</span>
<span class="comment-line"># Purpose: run the snmpWalk using the netSNMP package</span>
<span class="comment-line"># input: DUT_IP</span>
<span class="comment-line">#        mibfile name</span>
<span class="comment-line">#        mibTable</span>
<span class="comment-line"># output: return of the snmpwalk call</span>
<span class="comment-line">#</span>
<span class="comment-line">########################################################################################################################</span>
<strong><a name="::::lldpSnmpWalk_2589">proc <a href="snmplib.tcl-annot.html#::::lldpSnmpWalk">::::lldpSnmpWalk</a></a></strong> { DUT_IP mibfile mibTable args} {

         <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;in snmpwalk: result&#34;
    if { [catch {exec /usr/bin/snmpwalk $DUT_IP -v2c -c private -m /usr/share/snmp/mibs/$mibfile $mibTable 2&gt;&gt;snmpLog} result]} {
         <a name="::result_error(37)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;error in snmpwalk: $result&#34;
	 set testVar [catch {exec cp snmpLog snmpLogError} result1]
    } else {
         <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SNMPWALK : $result&#34;
         <span class="comment-line">#set resArr [split $result \n]</span>
         <span class="comment-line">#foreach line $resArr {</span>
         <span class="comment-line">#    result_debug &#34;LINE:: $line&#34;</span>
         <span class="comment-line">#}</span>
    }
    return $result
}
<span class="comment-line">#######################################################################################################################</span>
<span class="comment-line"># Name: lldpSnmpGet</span>
<span class="comment-line"># Purpose: run the snmpWalk using the netSNMP package</span>
<span class="comment-line"># input: DUT_IP</span>
<span class="comment-line">#        mibfile name</span>
<span class="comment-line">#        mibTable</span>
<span class="comment-line"># output: return of the snmpget call</span>
<span class="comment-line">#</span>
<span class="comment-line">########################################################################################################################</span>
<strong><a name="::::lldpSnmpGet_2613">proc <a href="snmplib.tcl-annot.html#::::lldpSnmpGet">::::lldpSnmpGet</a></a></strong> { DUT_IP mibfile mibTable args} {

         <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;in snmpget: result&#34;
    if { [catch {exec /usr/bin/snmpget $DUT_IP -v2c -c private -m /usr/share/snmp/mibs/$mibfile $mibTable 2&gt;&gt;snmpLog} result]} {
         <a name="::result_error(38)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;error in snmpget: $result&#34;
    } else {
         <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SNMPGET : $result&#34;
         <span class="comment-line">#set resArr [split $result \n]</span>
         <span class="comment-line">#foreach line $resArr {</span>
         <span class="comment-line">#    result_debug &#34;LINE:: $line&#34;</span>
         <span class="comment-line">#}</span>
    }
    return $result
}
<span class="comment-line">#######################################################################################################################</span>
<span class="comment-line"># Name: lldpSnmpSet</span>
<span class="comment-line"># Purpose: run the snmpWalk using the netSNMP package</span>
<span class="comment-line"># input: DUT_IP</span>
<span class="comment-line">#        mibfile name</span>
<span class="comment-line">#        mibTable</span>
<span class="comment-line"># output: return of the snmpwalk call</span>
<span class="comment-line">#</span>
<span class="comment-line">########################################################################################################################</span>
<strong><a name="::::lldpSnmpSet_2636">proc <a href="snmplib.tcl-annot.html#::::lldpSnmpSet">::::lldpSnmpSet</a></a></strong> { DUT_IP mibTable type value args} {

         flush stdout
         flush stderr
         <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;in snmpset: result&#34;
    if { [catch {exec /usr/bin/snmpset -c private -v2c $DUT_IP $mibTable $type $value 2&gt;&gt;snmpLog} result]} {
         <a name="::result_error(39)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;error in snmpset: $result&#34;
    } else {
         <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SNMPSET $result&#34;
         <span class="comment-line">#set resArr [split $result \n]</span>
         <span class="comment-line">#foreach line $resArr {</span>
         <span class="comment-line">#    result_debug &#34;LINE:: $line&#34;</span>
         <span class="comment-line">#}</span>
    }
    sleep 1
    return $result
}

<span class="comment-line">###########################################################################################################</span>
<span class="comment-line"># Name: getlldpPortOid</span>
<span class="comment-line"># Purpose: return the SNMP Oid Index for the given port</span>
<span class="comment-line"># The Oid will depend on the platforms</span>
<span class="comment-line"># For summit Oid is same as port number</span>
<span class="comment-line"># For chassis based platforms , the Oid is the relative port number of the port in the DUT taking into account all ports present </span>
<span class="comment-line"># e.g</span>
<span class="comment-line"># starting with port=1, slot=1 as index , the port Oid for port 3:8 can be computed as 8 + All ports in slot 1and2</span>
<span class="comment-line"># If any slot is absent its ports are not counted</span>
<span class="comment-line"># input: Port</span>
<span class="comment-line"># output: PortOid index </span>
<span class="comment-line">#    if {([regexp -nocase &#34;BD-10808&#34; $platform] ==  1) || ([regexp -nocase &#34;Aspen|bd-88&#34; $platform] == 1)}  {}</span>
<span class="comment-line">#    elseif { ([regexp -nocase &#34;SummitX450&#34; $platform] == 1) || ([regexp -nocase &#34;bd10Ki386&#34; $platform] == 1)}  {}</span>
<span class="comment-line">##############################################################################################################</span>
<strong><a name="::::getlldpPortOid_2668">proc <a href="snmplib.tcl-annot.html#::::getlldpPortOid">::::getlldpPortOid</a></a></strong> {<a name="::port(6)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> dut} {

    global DUTs_info
    global DUTs_Slot_info
    set platform [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $dut]
    set version [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> $dut majmin]
    puts &#34;The version is $version&#34;
    <span class="comment-line"># Adding new code for 22.1 snmp index change</span>
    set newflag 0
    if { $version &gt;= 16.1 } {
      set newflag 1
    }
    puts &#34;The flag is $newflag&#34;
    puts &#34;The port is $port&#34;

    set Oid 0

    global chassis
    global i386Chassis
    global stackable
    global i386Stackable

    if { [regexp -nocase &#34;$chassis|$i386Chassis|vpex&#34; $platform] ==  1 }  {
        <span class="comment-line"># Get the slot and port number from port</span>
        set pSlot [split $port :]
        set slot  [lindex $pSlot 0]
        set portId  [lindex $pSlot 1]

        set numSlots $DUTs_info($dut,numSlots)
        <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; numSlots=$numSlots&#34;
        set numPorts 0
        for {set j 1} {$j &lt; $slot } {incr j} { 
           set state [<a name="::::DutSlotStateRT(1)"><a href="./swConf.tcl.html#::::DutSlotStateRT_1581">::::DutSlotStateRT</a></a> 1 $j]
            if {$newflag == 0} {
               set numPorts [<a name="::::DutSlotNumPorts(1)"><a href="./swConf.tcl.html#::::DutSlotNumPorts_1536">::::DutSlotNumPorts</a></a> 1 $j]
            } else {
               set numPorts 128
            }
           <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; Slot=$j, numPorts=$numPorts, state=$state &#34;
           if { [regexp -nocase &#34;Operational|Empty&#34; $state] == 1 } {
                set Oid [expr $Oid + $numPorts]
                <a name="::result_debug(42)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Oid inside loop is $Oid&#34;
           }
           <span class="comment-line">#if { [string compare $state &#34;Operational&#34;] == 0 } {</span>
           <span class="comment-line">#     set Oid [expr $Oid + $numPorts]</span>
           <span class="comment-line">#}</span>
        }
        set Oid [expr $Oid + $portId]
        <a name="::result_debug(43)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; Chassis  $platform :: slot=$slot, portId=$portId, Oid=$Oid&#34;
        return $Oid
    } elseif { [regexp -nocase &#34;$stackable|$i386Stackable&#34; $platform] == 1}  {
        <a name="::result_debug(44)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; Stackable   $platform :: port=$port, Oid=$port&#34;
        return $port
    }

    <a name="::result_error(40)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;UNKNOWN PLATFORM TYPE&#34;
    return $port
}

<span class="comment-line">#############################################################</span>
<span class="comment-line"># Name: lldpSnmpGetNext</span>
<span class="comment-line"># Purpose: run the snmpgetnext using the netSNMP package</span>
<span class="comment-line"># input: DUT_IP</span>
<span class="comment-line">#        mibfile name</span>
<span class="comment-line">#        mibTable</span>
<span class="comment-line"># output: return of the snmpget call</span>
<span class="comment-line">#</span>
<span class="comment-line">############################################################</span>
<strong><a name="::::lldpSnmpGetNext_2736">proc <a href="snmplib.tcl-annot.html#::::lldpSnmpGetNext">::::lldpSnmpGetNext</a></a></strong> { DUT_IP mibfile mibTable args} {

         <a name="::result_debug(45)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;in snmpgetnext: result&#34;
    if { [catch {exec /usr/bin/snmpgetnext $DUT_IP -v2c -c private -m /usr/share/snmp/mibs/$mibfile $mibTable 2&gt;&gt;snmpLog} result]} {
         <a name="::result_error(41)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;error in snmpget: $result&#34;
    } else {
         <a name="::result_debug(46)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SNMPGETNEXT : $result&#34;
         <span class="comment-line">#set resArr [split $result \n]</span>
         <span class="comment-line">#foreach line $resArr {</span>
         <span class="comment-line">#    result_debug &#34;LINE:: $line&#34;</span>
         <span class="comment-line">#}</span>
    }
    return $result
}


<span class="comment-line">############################################################</span>
<span class="comment-line"># Name: lldpSnmpBulkGet</span>
<span class="comment-line"># Purpose: run the snmpgetnext using the netSNMP package</span>
<span class="comment-line"># input: DUT_IP</span>
<span class="comment-line">#        mibfile name</span>
<span class="comment-line">#        mibTable</span>
<span class="comment-line"># output: return of the snmpget call</span>
<span class="comment-line">#</span>
<span class="comment-line">############################################################</span>
<strong><a name="::::lldpSnmpBulkGet_2761">proc <a href="snmplib.tcl-annot.html#::::lldpSnmpBulkGet">::::lldpSnmpBulkGet</a></a></strong> { DUT_IP mibfile mibTable args} {

         <a name="::result_debug(47)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;in snmpbulkget: result&#34;
    if { [catch {exec /usr/bin/snmpbulkget $DUT_IP -v2c -c private -m /usr/share/snmp/mibs/$mibfile $mibTable 2&gt;&gt;snmpLog} result]} {
         <a name="::result_error(42)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;error in snmpget: $result&#34;
    } else {
         <a name="::result_debug(48)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SNMPBULKGET : $result&#34;
         <span class="comment-line">#set resArr [split $result \n]</span>
         <span class="comment-line">#foreach line $resArr {</span>
         <span class="comment-line">#    result_debug &#34;LINE:: $line&#34;</span>
         <span class="comment-line">#}</span>
    }
    return $result
}

<span class="comment-line">##################  Handling SnmpTrap_newformat</span>
<span class="comment-line">############################################################</span>
<span class="comment-line"># Name: CleanupsnmpTrapFiles</span>
<span class="comment-line"># Purpose: For deleting snmp_trap generated by the DUT</span>
<span class="comment-line">#          in /tmp/ loction</span>
<span class="comment-line"># input: DUT_IP</span>
<span class="comment-line"># output: none</span>
<span class="comment-line">#</span>
<span class="comment-line">############################################################</span>
<strong><a name="::::CleanupsnmpTrapFiles_2785">proc <a href="snmplib.tcl-annot.html#::::CleanupsnmpTrapFiles">::::CleanupsnmpTrapFiles</a></a></strong> { DUT_IP } {

  global whichDutNow
  global DUT${whichDutNow}_IP
  
  if { $DUT_IP == &#34;null&#34; } {
      set DUT_IP [set DUT${whichDutNow}_IP]
  }
   <a name="::result_debug(49)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Deleting SNMP Trapfiles Generated By the DUT $DUT_IP&#34;
   if { ! [catch { glob /tmp/snmp_trap_UDP*$DUT_IP* } output] } { 
     foreach file_name $output {
	<a name="::result_debug(50)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Deleting the filename $file_name&#34;
        eval [file delete $file_name]
     }
   }  
   return 1
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
