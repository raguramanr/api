<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ospfsetupv3.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ospfsetupv3.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ospfsetupv3.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ospfsetupv3.tcl-annot.html">annotations</a> | <a href="ospfsetupv3.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<strong><a name="::::extrMakeConnectedInterface_1">proc <a href="ospfsetupv3.tcl-annot.html#::::extrMakeConnectedInterface">::::extrMakeConnectedInterface</a></a></strong> {args} {

	<a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> extrMakeConnectedInterface $args {

		interfaceIpAddress &#34;&#34;
		interfaceMacAddress &#34;&#34;
	}

	
	interfaceEntry clearAllItems addressTypeIpV6
	interfaceEntry clearAllItems addressTypeIpV4
	interfaceEntry setDefault 
	
	interfaceIpV6 setDefault 
	interfaceIpV6 config -maskWidth                          64
	interfaceIpV6 config -ipAddress                          &#34;$interfaceIpAddress&#34;
	if {[interfaceEntry addItem addressTypeIpV6]} {
		error &#34;interfaceEntry : addItem addressTypeIpV6&#34;
	}
	interfaceEntry config -enable                             true
	interfaceEntry config -description                        &#34;$interfaceIpAddress/64&#34;
	interfaceEntry config -macAddress                         &#34;$interfaceMacAddress&#34;
	if {[interfaceTable addInterface interfaceTypeConnected]} {

		error &#34;interfaceTable : addInterface interfaceTypeConnected&#34;
	}

	interfaceEntry clearAllItems addressTypeIpV6
	interfaceEntry clearAllItems addressTypeIpV4
	interfaceEntry setDefault 

	interfaceEntry config -connectedVia 			&#34;$interfaceIpAddress/64&#34;	
<span class="comment-line">#	interfaceEntry config -enable                             true</span>
<span class="comment-line">#	interfaceEntry config -description                        &#34;ProtocolInterface - $card:$port&#34;</span>
	if {[interfaceTable addInterface interfaceTypeRouted]} {

		error &#34;interfaceTable : addInterface interfaceTypeRouted&#34;
	}

}

<strong><a name="::::extrMakeOspfRouterv3_42">proc <a href="ospfsetupv3.tcl-annot.html#::::extrMakeOspfRouterv3">::::extrMakeOspfRouterv3</a></a></strong> {args} {
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> extrMakeOspfRouterv3 $args {
        interfaceIp &#34;&#34;
        areaId 0
        helloInterval 10
        deadInterval 40
        networkType &#34;ospfV3InterfaceBroadcast&#34;
        instanceId 0
        interfaceId -1
        routeMetric &#34;0&#34;
        numNetworks 0
        prefix &#34;&#34;
        metric &#34;1&#34;
        maskWidth &#34;&#34;
        routeOrigin &#34;ospfV3RouteOriginAnotherArea&#34;
        networkIp &#34;&#34;
        routerId &#34;&#34;
        txPortId  &#34;1&#34;
	routerno &#34;1&#34;
    }

       <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chassis card port
    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;extrMakeOSPFRouterV: Chas: $chassis Card: $card Port: $port&#34;

    set maskWidth $prefix
<span class="comment-line">#    ospfV3Server select $chassis $card $port</span>
<span class="comment-line">#    ospfV3Server clearAllRouters</span>
    ospfV3Interface setDefault
    ospfV3Interface config -enable true
    ospfV3Interface config -areaId $areaId
<span class="comment-line">#    ospfV3Interface config -options [expr $::ospfV3InterfaceOptionV6Bit|$::ospfV3InterfaceOptionEBit|$::ospfV3InterfaceOptionRBit]2</span>
    ospfV3Interface config -helloInterval $helloInterval
    ospfV3Interface config -deadInterval $deadInterval
    ospfV3Interface config -protocolInterfaceDescription &#34;$interfaceIp/64&#34;
    ospfV3Interface config -type $networkType
    ospfV3Interface config -instanceId 0
    ospfV3Interface config -interfaceId -1
    if {[ospfV3Router addInterface interface1]} {
        error &#34;extrMakeOspfV3Router: ospfRouterV3 addInterface interface1 failed.&#34;
    }

    set idx 0
    set rangeId 1
    while {[llength $networkIp] &gt; $idx} {
    set myIp [lindex $networkIp $idx]
    set rMetric [lindex $routeMetric $idx]
    set prefx [lindex $prefix $idx]
    set routeOrg [lindex $routeOrigin $idx]
    set noOfNetworks [lindex $numNetworks $idx]
    incr idx

    ospfV3RouteRange setDefault
    ospfV3RouteRange config -enable true
    ospfV3RouteRange config -routeOrigin $routeOrg
    ospfV3RouteRange config -metric $rMetric
    ospfV3RouteRange config -numRoutes $noOfNetworks
    ospfV3RouteRange config -maskWidth $prefx
    ospfV3RouteRange config -networkIpAddress $myIp
    ospfV3RouteRange config -iterationStep 1

    ospfV3Router addRouteRange [format &#34;routeRange%02d&#34; $rangeId]
<span class="comment-line">#    ospfV3RouteRange setDefault</span>
    incr rangeId
}

<span class="comment-line">#    if {[ospfV3Router addRouteRange routeRange1]} {</span>
<span class="comment-line">#        error &#34;extrMakeOspfRouter: ospfRouter addRouteRange routeRange1 failed.&#34;</span>
<span class="comment-line">#    }</span>

    ospfV3Router setDefault
    ospfV3Router config -enable true
    ospfV3Router config -routerId $routerId
    ospfV3Router config -disableAutoGenerateRouterLsa false
    ospfV3Router config -disableAutoGenerateLinkLsa false
    ospfV3Router config -enableDiscardLearnedLsas false
    ospfV3Router config -maxNumLsaPerSecond 1000

if {[ospfV3Server addRouter router${routerno}]} {
        error &#34;extrMakeOspfV3Router: ospfServerV3 addRouter router1 failed.&#34;
    }

    return 0
} ;<span class="comment-line"># extrMakeOspfRouter</span>

<span class="comment-line">#############################################################################################################################</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: setupOSPFRouterv3</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc is used to setup ixia port as a ospf router. It can create multiple interfaces</span>
<span class="comment-line">#              supplied via interfaceIpList</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: -1 on error only</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#setupOSPFRouter -dutIp &#34;62.1.0.109&#34; -interfaceIpList &#34;62.1.0.23&#34; -maskList &#34;255.255.255.0&#34; -areaIdList &#34;0&#34; -helloIntervalList &#34;10&#34; \</span>
<span class="comment-line">#                -deadIntervalList &#34;40&#34; -networkTypeList &#34;ospfBroadcast&#34; -metricList &#34;10&#34; -mtuSizeList 1500 \</span>
<span class="comment-line">#                -linkTypeList &#34;ospfLinkTransit&#34; -numNetworksList 10000 -prefixList &#34;30&#34; -routeOriginList &#34;ospfRouteOriginArea&#34; \</span>
<span class="comment-line">#                -networkIpList &#34;37.0.0.0&#34; -routerIdList &#34;62.1.0.23&#34; -txPortId 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::setupOSPFextraRouterv3_150">proc <a href="ospfsetupv3.tcl-annot.html#::::setupOSPFextraRouterv3">::::setupOSPFextraRouterv3</a></a></strong> {args} {
   global TrafficGen
    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupOSPFextraRouterv3 $args {
        interfaceMacList &#34;&#34;
        interfaceIpList &#34;&#34;
        maskWidth &#34;64&#34;
        areaIdList &#34;0&#34;
        helloIntervalList &#34;10&#34;
        deadIntervalList &#34;40&#34;
        networkTypeList &#34;ospfV3InterfaceBroadcast&#34;
        metricList &#34;0&#34;
        numNetworksList &#34;0&#34;
        prefixList &#34;&#34;
        routeOriginList &#34;ospfV3RouteOriginAnotherArea&#34;
        networkIpList &#34;&#34;
        routeMetricList &#34;10&#34;
        routerIdList &#34;&#34;
      dutIp &#34;&#34;
        txPortId  &#34;1&#34;
    }

   set tag &#34;none&#34;
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
         
         
    <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chassis card port
    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupOSPFRouterV3: Chas: $chassis Card: $card Port: $port&#34;

    <span class="comment-line"># select the port</span>
    <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> setDefault

    set IXIA_10G [<a name="::getIxiaPortType(1)"><a href="./ePTMisc.tcl.html#::getIxiaPortType_585">::getIxiaPortType</a></a> $txPortId]
    <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;IXIA_10G === $IXIA_10G&#34;
    if {$IXIA_10G == 98} {
            <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Chas: $chassis Card: $card Port: $port&#34;
            <a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -autonegotiate                      false
            <a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise100FullDuplex             false
            <a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise100HalfDuplex             false
            <a name="::port(5)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise10FullDuplex              false
            <a name="::port(6)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise10HalfDuplex              false
            <a name="::port(7)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise1000FullDuplex            false
            <a name="::port(8)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -portMode                           port10GigLanMode
    }

    <a name="::port(9)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chassis $card $port
    ipAddressTable clear
    ipAddressTable setDefault
    ipAddressTable config -defaultGateway 0.0.0.0
    if {[ipAddressTable set $chassis $card $port]} {
		error &#34;ipAddressTable : set $chassis $card $port.&#34;
	} 
    arpServer setDefault
    arpServer config -retries 3
    arpServer config -mode 0
    arpServer config -rate 260417
    arpServer config -requestRepeatCount 3
    if {[arpServer set $chassis $card $port]} {
		error &#34;arpServer : set $chassis $card $port.&#34;
	}
    if {[interfaceTable select $chassis $card $port]} {
		error &#34;interfaceTable : select $chassis $card $port.&#34;
	}


    interfaceTable setDefault
    interfaceTable clearAllInterfaces
	set macAddrList &#34;&#34;
	for {set i 1} {$i&lt;=[llength $interfaceIpList]} {incr i} {
	
		set macAddr [<a name="::uniqMac(1)"><a href="./bgp.tcl.html#::uniqMac_1832">::uniqMac</a></a> $chassis $card $port]
<span class="comment-line">#		set macAddr {00 01 02 03 04 ff}</span>
		set macAddr [lreplace $macAddr end end [format %02x [expr [expr 0x[lindex $macAddr end]] + $i]]]
		lappend macAddrList $macAddr
	}
puts &#34;------macAddrList ---- $macAddrList&#34;
	for {set i 0} {$i&lt;[llength $interfaceIpList]} {incr i} {
	
		set interfaceIp [lindex $interfaceIpList $i]
		set macAddr [lindex $macAddrList $i]
		<a name="::extrMakeConnectedInterface(1)"><a href="./ospfsetupv3.tcl.html#::extrMakeConnectedInterface_1">::extrMakeConnectedInterface</a></a> -interfaceIpAddress $interfaceIp -interfaceMacAddress $macAddr 
		
	}

if {0} {

    interfaceIpV6 setDefault
    interfaceIpV6 config -maskWidth $maskWidth
    interfaceIpV6 config -ipAddress [lindex $interfaceIpList 0]
    interfaceEntry addItem addressTypeIpV6


    if {[llength $interfaceMacList] &gt; 0} {
        set macAddr [lindex $interfaceMacList 0]
        if {$macAddr == &#34;default&#34;} {
            if {[<a name="::port(10)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chassis $card $port]} {
                error &#34;setupOSPFRouter: port get $chassis $card $port failed.&#34;
            }
            set macAddr [<a name="::port(11)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]

        }
    } else {
        set macAddr [<a name="::uniqMac(2)"><a href="./bgp.tcl.html#::uniqMac_1832">::uniqMac</a></a> $chassis $card $port]
    }

    interfaceEntry setDefault
    interfaceEntry config -enable true
    interfaceEntry config -description &#34;protocol interface-$card.$port&#34;
    interfaceEntry config -macAddress $macAddr
    interfaceTable addInterface
    interfaceEntry clearAllItems addressTypeIpV6
    interfaceEntry clearAllItems addressTypeIpV4

}

    if {[ospfV3Server select $chassis $card $port]} {
        error &#34;setupOSPFRouter: ospfServer select $chassis $card $port failed.&#34;

    }
    if {[ospfV3Server clearAllRouters]} {
        error &#34;setupOSPFRouter: ospfServer clearAllRouters failed.&#34;
    }

    for {set i 0} {$i&lt;[llength $interfaceIpList]} {incr i} {
        set interfaceIp [lindex $interfaceIpList $i]
        set areaId [lindex $areaIdList $i]
        set helloInterval [lindex $helloIntervalList $i]
        set deadInterval [lindex $deadIntervalList $i]
        set networkType [lindex $networkTypeList $i]
        set metric [lindex $metricList $i]
        set numNetworks [lindex $numNetworksList $i]
        set prefix [lindex $prefixList $i]
        set routeOrigin [lindex $routeOriginList $i]
        set networkIp [lindex $networkIpList $i]
        set routeMetric [lindex $routeMetricList $i]
        set routerId [lindex $routerIdList $i]

        set returnCode [<a name="::extrMakeOspfRouterv3(1)"><a href="./ospfsetupv3.tcl.html#::extrMakeOspfRouterv3_42">::extrMakeOspfRouterv3</a></a> -interfaceIp $interfaceIp \
                                           -areaId $areaId -helloInterval $helloInterval \
                                           -deadInterval $deadInterval \
                                           -networkType $networkType -metric $metric \
                                           -numNetworks $numNetworks -prefix $prefix \
                                           -routeOrigin $routeOrigin \
                                           -networkIp $networkIp \
                                           -routeMetric $routeMetric -routerId $routerId -routerno [expr $i + 1] \
                                           -txPortId $txPortId]
        if {$returnCode==-1} {
            return -1
        }
    }

    protocolServer setDefault
    protocolServer config -enableArpResponse true
    protocolServer config -enablePingResponse true
    protocolServer config -enableOspfV3Service true
    if {[protocolServer set $chassis $card $port]} {
        error &#34;setupOSPFRouter: protocolServer set $chassis $card $port failed.&#34;
    }

    set portList [list [list $chassis $card $port]]
    <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Writing Configuration to Hardware...&#34;
    if {[<a name="::ixWriteConfigToHardware(1)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList]} {
        <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error writing config to hardware&#34;
    }
      }
      stc {
         set portId $txPortId
         set txPortId [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
         <a name="::cleanupOspfV3(1)"><a href="./ospfsetupv3.tcl.html#::cleanupOspfV3_592">::cleanupOspfV3</a></a> $txPortId
         set txPortId [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
         if {[info exists mtuSizeList]} {
            <a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform SetupPortsCommand -PortList $txPortId -Mtu [lindex $mtuSizeList 0]
         }
         for {set i 0} {$i&lt;[llength $interfaceIpList]} {incr i} {
            set interfaceIp [lindex $interfaceIpList $i]
            set areaId [<a name="::int2ip(1)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> [lindex $areaIdList $i]]
<span class="comment-line">#            set areaId [getIpV4MaskWidth2 [lindex $areaIdList $i]]</span>
            set helloInterval [lindex $helloIntervalList $i]
            set deadInterval [lindex $deadIntervalList $i]
            set networkType [lindex $networkTypeList $i]
            set metric [lindex $metricList $i]
            set numNetworks [lindex $numNetworksList $i]
            set prefix [lindex $prefixList $i]
            set routeOrigin [lindex $routeOriginList $i]
            set networkIp [lindex $networkIpList $i]
            set routeMetric [lindex $routeMetricList $i]
            set routerId [lindex $routerIdList $i]
            
            set linkLocalAddr &#34;fe80::[expr 1+$portId+$i]&#34;
            
            if {($tag == &#34;none&#34;) || !$tag} {
               array set cmdResults [<a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand \
                                        -ParentList [<a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] \
                                        -port $txPortId -IfStack &#34;Ipv6If EthIIIf&#34; -IfCount &#34;1 1&#34;]
               set deviceHndl $cmdResults(-ReturnList)
               <a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv6If] \
                  -Address $interfaceIp -PrefixLength $maskWidth -gateway [<a name="::makeIpv6Gateway(1)"><a href="./spirent.tcl.html#::makeIpv6Gateway_4988">::makeIpv6Gateway</a></a> $interfaceIp]
               <a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6If -under $deviceHndl \
                  -stackedonendpoint-Targets [lindex [<a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] 0] \
                  -toplevelif-Sources $deviceHndl -Address $linkLocalAddr
            } else {
               array set cmdResults [<a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand \
                                        -ParentList [<a name="::logcmd(9)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] \
                                        -port $txPortId -IfStack &#34;Ipv6If VlanIf EthIIIf&#34; -IfCount &#34;1 1 1&#34;]
               set deviceHndl $cmdResults(-ReturnList)
               <a name="::logcmd(10)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(11)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv6If] -Address $interfaceIp \
                  -PrefixLength $maskWidth -gateway [<a name="::makeIpv6Gateway(2)"><a href="./spirent.tcl.html#::makeIpv6Gateway_4988">::makeIpv6Gateway</a></a> $interfaceIp]
               <a name="::logcmd(12)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6If -under $deviceHndl \
                  -stackedonendpoint-Targets [lindex [<a name="::logcmd(13)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] 0] \
                  -toplevelif-Sources $deviceHndl -Address $linkLocalAddr
               <a name="::logcmd(14)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(15)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] -VlanId $tag 
            }
            <a name="::logcmd(16)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $deviceHndl -RouterId $routerId
            
            if {$networkType == &#34;ospfV3InterfaceBroadcast&#34;} {
               set networkType BROADCAST
            }
				
            set ospfAttributes &#34;-under $deviceHndl&#34;
            if {$areaId != &#34;&#34;} {
               append ospfAttributes &#34; -AreaId $areaId&#34;					
            }
            if {$deadInterval != &#34;&#34;} {
               append ospfAttributes &#34; -RouterDeadInterval $deadInterval&#34;					
            }
            if {$networkType != &#34;&#34;} {
               append ospfAttributes &#34; -NetworkType $networkType&#34;					
            }
            if {$metric != &#34;&#34;} {
               if {[llength $metric] &gt; 1} {set tmetric [lindex $metric 0]} else {set tmetric $metric}
               if {$tmetric &lt; 1} {set tmetric 1}
               append ospfAttributes &#34; -IfCost $tmetric&#34;					
            }
            
            puts $ospfAttributes
            
            set ospfRouterConfig [eval &#34;logcmd stc::create Ospfv3RouterConfig [subst $ospfAttributes]&#34;]
            
            set routerLsaAttrs &#34;-under $ospfRouterConfig -AdvertisingRouterId $routerId&#34;
<span class="comment-line">#            switch -glob [lindex $routeOrigin 0] {</span>
<span class="comment-line">#               ospfV3RouteOriginExternal* { append routerLsaAttrs &#34; -RouterType EBIT&#34; }</span>
<span class="comment-line">#               ospfRouteOriginArea { append routerLsaAttrs &#34; -RouterType BBIT&#34; }</span>
<span class="comment-line">#               default { }</span>
<span class="comment-line">#            } </span>
            set hRouterLsa [eval &#34;logcmd stc::create Ospfv3RouterLsa [subst $routerLsaAttrs] -LinkStateId 0&#34;]
<span class="comment-line">#            set hLinkLsa [eval &#34;logcmd stc::create Ospfv3LinkLsaBlk -under $ospfRouterConfig -AdvertisingRouterId $routerId -LinkLocalIfAddr $linkLocalAddr&#34;]</span>
<span class="comment-line">#            logcmd stc::config [logcmd stc::get $hLinkLsa -children-Ipv6NetworkBlock] -NetworkCount 1 -StartIpList $interfaceIp</span>
            
            set idx 0
            while {[llength $networkIp] &gt; $idx} {
               set myIp [lindex $networkIp $idx]
               set rMetric [lindex $routeMetric $idx]
               set prefx [lindex $prefix $idx]
               set routeOrg [lindex $routeOrigin $idx]
               set noOfNetworks [lindex $numNetworks $idx]
               incr idx
               switch $routeOrg {
                  ospfV3RouteOriginExternalType1 {
                     <a name="::logcmd(17)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hRouterLsa -RouterType EBIT
                     set ospfRouteAttrs &#34;-under $ospfRouterConfig -LsType AS_EXT_LSA&#34;
<span class="comment-line">#                     set ospfRouteAttrs &#34;-under $ospfRouterConfig&#34;</span>
                     if {$routerId != &#34;&#34;} {
                        append ospfRouteAttrs &#34; -AdvertisingRouterId $routerId&#34;
                     }
                     if {$rMetric != &#34;&#34;} {
<span class="comment-line">#                        append ospfRouteAttrs &#34; -prefixMetric $rMetric&#34;</span>
                        append ospfRouteAttrs &#34; -Metric $rMetric&#34;
                     }
                     
                     append ospfRouteAttrs &#34; -MetricType FALSE&#34;						
<span class="comment-line">#                     set ospfRoute [eval logcmd stc::create  Ospfv3IntraAreaPrefixLsaBlk [subst $ospfRouteAttrs] -LinkStateId $idx]</span>
                     set ospfRoute [eval logcmd stc::create Ospfv3AsExternalLsaBlock [subst $ospfRouteAttrs] -LinkStateId $idx -RouteCategory unique]
                     <a name="::logcmd(18)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(19)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ospfRoute -children-Ipv6NetworkBlock] -NetworkCount $noOfNetworks -StartIpList $myIp -PrefixLength $prefx
                  }
                  ospfV3RouteOriginExternalType2 {
                     set ospfRouteAttrs &#34;-under $ospfRouterConfig -LsType AS_EXT_LSA&#34;
                     if {$routerId != &#34;&#34;} {
                        append ospfRouteAttrs &#34; -AdvertisingRouterId $routerId&#34;
                     }
                     if {$rMetric != &#34;&#34;} {
                        append ospfRouteAttrs &#34; -Metric $rMetric&#34;
                     }
                     append ospfRouteAttrs &#34; -MetricType TRUE&#34;
                     set ospfRoute [eval logcmd stc::create Ospfv3AsExternalLsaBlock [subst $ospfRouteAttrs] -LinkStateId $idx -RouteCategory unique]
                     <a name="::logcmd(20)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(21)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ospfRoute -children-Ipv6NetworkBlock] -NetworkCount $noOfNetworks -StartIpList $myIp -PrefixLength $prefx
                  }
                  ospfV3RouteOriginAnotherArea {
                     set ospfRouteAttrs &#34;-under $ospfRouterConfig &#34;
                     if {$routerId != &#34;&#34;} {
                        append ospfRouteAttrs &#34; -AdvertisingRouterId $routerId -RefLsType 8193 -LinkStateId 1&#34; ;<span class="comment-line"># -refadvertisingrouterid</span>
                     }
                     if {$rMetric != &#34;&#34;} {
                        append ospfRouteAttrs &#34; -Metric $rMetric&#34;
                     }
                     set ospfRoute [eval logcmd stc::create Ospfv3InterAreaPrefixLsaBlk [subst $ospfRouteAttrs] \
                                       -RouteCategory unique -LinkStateId $idx]
                     <a name="::logcmd(22)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(23)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ospfRoute -children-Ipv6NetworkBlock] \
                        -NetworkCount $noOfNetworks -StartIpList $myIp -PrefixLength $prefx

                  }
                  default { error &#34;Unsupported OSPFv3 route origin : $routeOrigin&#34; }
               }
            }
         }
      }
   } ;<span class="comment-line"># end of switch</span>
} ;<span class="comment-line"># setupOSPFRouter</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: startOspfV3</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc is used to start test equipment ospf protocol adjacency</span>
<span class="comment-line">#              on the list of ports supplied via txPortIdList</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  txPortIdList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      startOspf 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::startOspfV3_478">proc <a href="ospfsetupv3.tcl-annot.html#::::startOspfV3">::::startOspfV3</a></a></strong> {txPortIdList} {

   global TrafficGen
   
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
         
    set pList &#34;&#34;
    foreach txPortId $txPortIdList {
        <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startOspf: Chas: $cha Card: $car Port: $por&#34;
        lappend pList &#34;$cha $car $por&#34;
    }

    if {[ixStartOspfV3 pList]} {
        error &#34;startOspf: ixStartOspf failed.&#34;
    }
}
      stc {
         <a name="::startOspf(1)"><a href="./Ospf.tcl.html#::startOspf_1921">::startOspf</a></a> $txPortIdList
      }
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: stopOspfV3</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc is used to stop test equipment ospf protocol adjacency</span>
<span class="comment-line">#              on the list of ports supplied via txPortIdList</span>
<span class="comment-line">#              This proc is opposite of startOspf</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  txPortIdList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      stopOspf 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::stopOspfV3_522">proc <a href="ospfsetupv3.tcl-annot.html#::::stopOspfV3">::::stopOspfV3</a></a></strong> {txPortIdList} {
   
   global TrafficGen
   
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
         
    set pList &#34;&#34;
    foreach txPortId $txPortIdList {
        <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopOspf: Chas: $cha Card: $car Port: $por&#34;
        lappend pList &#34;$cha $car $por&#34;
    }

    if {[ixStopOspfV3 pList]} {
        error &#34;stopOspf: ixStopOspf failed.&#34;
    }
}
      stc {
         foreach txPortId $txPortIdList {
            set txPortId [<a name="::hMapPortIdToSpirentPort(3)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            foreach emulatedDevice [set DeviceList [<a name="::logcmd(24)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]] {
               foreach {lsatype cmd} {ospfV3AsExternalLsaBlock Ospfv3AgeExternalLsaCommand \
                                         ospfV3InterAreaPrefixLsaBlk Ospfv3AgeInterAreaPrefixLsa \
                                         Ospfv3NetworkLsa Ospfv3AgeNetworkLsaCommand \
                                         Ospfv3InterAreaRouterLsaBlock Ospfv3AgeInterAreaRouterLsaCommand \
                                         Ospfv3RouterLsa Ospfv3AgeRouterLsaCommand} {

<span class="comment-line">#                                         Ospfv3LinkLsa Ospfv3AgeLinkLsaCommand </span>


                  if {[llength [set lsalist [<a name="::logcmd(25)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::logcmd(26)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-ospfv3routerconfig] -children-$lsatype]]] &gt; 0} {
puts &#34;AGING LSAs : $lsalist&#34;
<span class="comment-line">#                     logcmd stc::perform $cmd -LsaList $lsalist</span>
<span class="comment-line">#                     logcmd stc::apply</span>
<span class="comment-line">#                      foreach lsa $lsalist {</span>
<span class="comment-line">#                         logcmd stc::delete $lsa</span>
<span class="comment-line">#                      }</span>
                  }
               }
puts &#34;SHUTTING DOWN ROUTER&#34;
<span class="comment-line">#               after 10000</span>
               <a name="::logcmd(27)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform Ospfv3ShutdownRoutersCommand -RouterList $emulatedDevice
            }
<span class="comment-line">#puts &#34;WAITING 30 SEC&#34;</span>
         }
 <span class="comment-line">#        after 30000</span>
      }
   }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: cleanupOspfV3</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc is used to cleanup test equipment port for ospfv3 configuration</span>
<span class="comment-line">#              that was performed by setupOSPFRouterV3</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  txPortIdList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      cleanupOspfV3 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::cleanupOspfV3_592">proc <a href="ospfsetupv3.tcl-annot.html#::::cleanupOspfV3">::::cleanupOspfV3</a></a></strong> {txPortIdList} {
   
   global TrafficGen
   
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
         
    foreach txPortId $txPortIdList {
        <span class="comment-line"># get the port information</span>
        <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cleanupOspf: Chas: $cha Card: $car Port: $por&#34;

        <span class="comment-line"># select the port</span>
        if {[ospfV3Server select $cha $car $por]} {
            error &#34;cleanupOspf: ospfServer select $cha $car $por failed.&#34;
        }

        if {[ospfV3Server getRouter router1]} {
            error &#34;cleanupOspf: ospfServer getRouter router1 failed.&#34;
        }

        ospfV3Router clearAllInterfaces
        ospfV3Router clearAllLsaGroups
        ospfV3Router clearAllRouteRanges
        ospfRouter setDefault

        if {[ospfV3Server clearAllRouters]} {
            error &#34;cleanupOspf: ospfServer clearAllRouters failed.&#34;
        }
        ospfV3Server write

       interfaceTable select $cha $car $por
       interfaceEntry clearAllItems addressTypeIpV6
       interfaceEntry clearAllItems addressTypeIpV4
       interfaceTable clearAllInterfaces
       interfaceEntry setDefault
       interfaceIpV6 setDefault
       interfaceTable write

        protocolServer setDefault
        protocolServer config -enableArpResponse false
        protocolServer config -enablePingResponse false
        protocolServer config -enableOspfService false

        if {[protocolServer set $cha $car $por]} {
            error &#34;cleanupOspf: Error Setting Protocol Server&#34;
        }
        if {[protocolServer write $cha $car $por]} {
            error &#34;cleanupOspf: protocolServer write $cha $car $por failed.&#34;
        }
    } ;<span class="comment-line"># foreach txPortId</span>
      }
      stc {
         foreach txPortId $txPortIdList {
            set txPortId [<a name="::hMapPortIdToSpirentPort(4)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            foreach emulatedDevice [<a name="::logcmd(28)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources] {
               set ipv4If [<a name="::logcmd(29)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-Ipv4If]
               if {$ipv4If != &#34;&#34;} {                 
                  foreach {lsatype cmd} {Ospfv3AsExternalLsaBlock Ospfv3InterAreaPrefixLsaBlk} {
                     if {[llength [set lsalist [<a name="::logcmd(30)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::logcmd(31)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-ospfv3routerconfig] -children-$lsatype]]] &gt; 0} {
                        puts &#34;DELETING LSAS&#34;
                        foreach lsa $lsalist {
                           <a name="::logcmd(32)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $lsa
                        }
                     }
                  }
               }
            }
         }
         <a name="::logcmd(33)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
<span class="comment-line">#         after 2000</span>
puts &#34;DELETING ROUTER&#34;
         <a name="::cleanupBgpv6(1)"><a href="./bgpv6.tcl.html#::cleanupBgpv6_411">::cleanupBgpv6</a></a> $txPortIdList
      }
   }
} ;<span class="comment-line"># cleanupOspf</span>

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
