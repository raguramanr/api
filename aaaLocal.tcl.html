<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>aaaLocal.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#aaaLocal.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>aaaLocal.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="aaaLocal.tcl-annot.html">annotations</a> | <a href="aaaLocal.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<strong><a name="::::my_login_1">proc <a href="aaaLocal.tcl-annot.html#::::my_login">::::my_login</a></a></strong> {ipAddr userid passwd} {

   global spawn_id
   global hostname 
   global spawn_ids
   global connectionTimeout

   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;my_login on device $ipAddr&#34;
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;userid: $userid, password: $passwd&#34;
   set newConnection 1
   <span class="comment-line">#check for existing connection</span>
   if { [ info exists hostname ] == &#34;1&#34; } {
      foreach name $hostname {
         if { $name == $ipAddr } {
            set spawn_id $spawn_ids($name)
            if { $spawn_id != &#34;INVALID&#34; } {
               <span class="comment-line"># --- use it for delay without using sleep</span>
               <span class="comment-line">#puts &#34;Login $ipAddr - Connection already exists pid=$spawn_id&#34;</span>
               set newConnection 0
            }
         }
      }
      <span class="comment-line">#if brand new connection, add to host name list</span>
      if { [lsearch $hostname $ipAddr] == -1 } {
         lappend hostname $ipAddr
      }
   } else {
      lappend hostname $ipAddr
   }  

   <span class="comment-line">#spawn new connection if not exists</span>
   if { $newConnection == 1 } {
      if [catch &#34;spawn telnet $ipAddr&#34; reason] {
         <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;failed to spawn program: $reason\n&#34;
         error &#34;failed to spawn program: $reason\n&#34;
      }
      <span class="comment-line"># it will cause hang</span>
      set spawn_ids($ipAddr) $spawn_id
      set timeout $connectionTimeout
      <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Login telnet $ipAddr,  pid=$spawn_id&#34;
      <span class="comment-line">#wait for connection</span>
      expect {
         &#34;?nable to ?onnect&#34; {
            <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> $expect_out(buffer)
            expect *
            <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> $expect_out(buffer)
            error &#34;Unable to connect&#34;
         }
         &#34;?onnected to&#34; {
            <span class="comment-line">#wait for all remaining characters to come</span>
            sleep 1
         }
      }
   }

   expect *
   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> $expect_out(buffer)
   <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Send $userid&#34;
   set timeout 1
   foreach letter $userid {
      send $letter
      expect {
         &#34;$letter&#34; {
            after 10
         }
         timeout {
            for {set c 0} {$c&lt;2} {incr c} {
               send $letter
               expect {
                  &#34;$letter&#34; {
                     break
                  }
                  timeout {
                     after 10
                  }
               }
            }
         }
      }
   }
   send &#34;\r&#34;
   expect &#34;password:&#34;
   <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;got password:&#34;
if { 0 } {
   send &#34;$passwd\r&#34;
} else {
   foreach letter $passwd {
      send $letter
      <span class="comment-line">#after 100</span>
      expect {
         &#34;$letter&#34; {
            after 10
         }
         timeout {
            for {set c 0} {$c&lt;2} {incr c} {
               send $letter
               expect {
                  &#34;$letter&#34; {
                     break
                  }
                  timeout {
                     after 10
                  }
               }
            }
         }
      }
   }
   set timeout $connectionTimeout
   send &#34;\r&#34;
}
   expect {
      &#34;Login incorrect&#34; {
         <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Login incorrect!&#34;
         expect { 
            &#34;Maximum number of login attempts reached!&#34; {
               <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Maximum number of login attempts reached!&#34;
	       expect {
                  &#34;Connection closed by foreign host&#34; {
                     <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Connection closed by foreign host&#34;;
                     <span class="comment-line"># look for hostname and set spawn id invalid</span>
                     foreach name $hostname {
                        if { $spawn_ids($name) == $spawn_id } {
                           set spawn_ids($name) &#34;INVALID&#34;
                        }
                     }
                     return 2;
                  }
                  &#34;login:&#34; {
                     <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;login:&#34;
                     return 2;
                  }
                  timeout {
                     <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;login timeout!!!&#34;
                     return -1; 
                  }
               }
            }
            &#34;login:&#34; {
               <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;login:&#34;
               return 1;
            }
            timeout {
               <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;login timeout!!!&#34;
               return -1;
            }
         }
      }
      &#34;# &#34; {
         <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> $expect_out(buffer)
	 <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
         expect *
         <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> $expect_out(buffer)
         return 0;
      }
      &#34;&gt; &#34; {
         <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> $expect_out(buffer)
	 <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
         expect *
         <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> $expect_out(buffer)
         return 0;
      }
      timeout {
         <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;login timeout!!!&#34;
         return -1 
      }
   }
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: MySendACmd</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends a CLI command to a DUT - a strip down version of SendACmd</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: cmd, fd_result, fd_input, showError</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             MySendACmd $cmd</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#	VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MySendACmd_185">proc <a href="aaaLocal.tcl-annot.html#::::MySendACmd">::::MySendACmd</a></a></strong> {{cmd &#34;NULL&#34;}
                    {fd_result &#34;NULL&#34;}
                    {fd_input  &#34;NULL&#34;}
                    {showError  &#34;true&#34;}} {
   global spawn_id
<span class="comment-line">#   global connectionTimeout</span>
   
   set timeout 20
   set result &#34;&#34;
   set exp_out_buf &#34;&#34;
   <span class="comment-line"># -- display and send the command</span>
   if {$fd_result != &#34;NULL&#34;} { puts $fd_result &#34;$cmd&#34; }
   <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- Send $cmd&#34;
   send &#34;$cmd\r&#34;
<span class="comment-line"># --- some special characaters will give the following expect trouble</span>
<span class="comment-line">#   expect $cmd</span>
   <span class="comment-line">#puts SEND:$expect_out(buffer)</span>

   <span class="comment-line"># -- loop until we receive correct string</span>
   expect {
      timeout {
         <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No response from the switch for $timeout seconds&#34;
         expect *
         <a name="::SaveOutputBuffer(1)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)
         <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
      }      
      full_buffer {
         <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*************** GOT FULL_BUFFER ****************&#34;
         regsub -all &#34;\n\r&#34; $expect_out(buffer) &#34;\n&#34; out_buf
         append exp_out_buf $out_buf
         exp_continue
      } 
      -nocase -re &#34;aspen.* # &#34;         {}
      -nocase -re &#34;appen.* &gt; &#34;         {}
      -nocase -re &#34;bd.* # &#34;            {}
      -nocase -re &#34;bd.* &gt; &#34;            {}
      -nocase -re &#34;summit.* # &#34;        {}
      -nocase -re &#34;summit.* &gt; &#34;        {}
      &#34;\r&#34; {
         if {[regexp -nocase &#34;ESC\\-&gt;&#34; $expect_out(buffer)]} {
            sleep 4
            send &#34;\033&#34;
         } else {
            regsub -all &#34;\n\r&#34; $expect_out(buffer) &#34;\n&#34; out_buf
            append exp_out_buf $out_buf
         }
         exp_continue
      }
      -re &#34;# $&#34; {
      }
      -re &#34;&gt; $&#34; {
      }
   }
   append exp_out_buf $expect_out(buffer)
   regsub -all &#34;\n\r&#34; $exp_out_buf &#34;\n&#34; exp_out_buf
   regsub -all &#34;\t&#34; $exp_out_buf &#34; &#34; exp_out_buf
   
   if {$fd_input != &#34;NULL&#34; } { puts -nonewline $fd_input $exp_out_buf }
   <a name="::result_pre(1)"><a href="./loadConsoles.tcl.html#::result_pre_15">::result_pre</a></a> $exp_out_buf
   return $exp_out_buf
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: MyCheckCmdIllegal</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sets result ok if CLI command sent to the switch </span>
<span class="comment-line">#               returns an error</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: cmd {fd_res NULL} {testNo &#34;CheckCmdIllegal&#34;}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MyCheckCmdIllegal_264">proc <a href="aaaLocal.tcl-annot.html#::::MyCheckCmdIllegal">::::MyCheckCmdIllegal</a></a></strong> {cmd {fd_res NULL} {testNo &#34;CheckCmdIllegal&#34;}} {
   global spawn_id
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <span class="comment-line">#do not need to show error status, since we know this will cause error</span>
   <a name="::MySendACmd(1)"><a href="./aaaLocal.tcl.html#::MySendACmd_185">::MySendACmd</a></a> &#34;$cmd&#34; $fd_res $fd_in false
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   set rtValue [<a name="::check_illegality(1)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;

   regsub {\{} $cmd &#34;LeftBrace&#34; cmd1;
   regsub {\}} $cmd1 &#34;rightBrace&#34; cmd;
   regsub {\[} $cmd &#34;LeftBracket&#34; cmd1;
   regsub {\]} $cmd1 &#34;RightBracket&#34; cmd;
   regsub {\010} $cmd &#34;BACK&#34; cmd1;
   regsub {\010} $cmd1 &#34;BACK&#34; cmd;
   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Command &lt;$cmd&gt; should fail&#34;
   if { $rtValue == &#34;illegal&#34; } {
      <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Command illegal as expected&#34;
   } else {
      <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Command should be illegal but accepted&#34;
   }
   <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $rtValue
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: MyCheckCmdLegal</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Test passes if Command sent to switch does not return </span>
<span class="comment-line">#               an error</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: cmd {fd_res NULL} {testNo &#34;CheckCmdLegal&#34;}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MyCheckCmdLegal_308">proc <a href="aaaLocal.tcl-annot.html#::::MyCheckCmdLegal">::::MyCheckCmdLegal</a></a></strong> {cmd {fd_res NULL} {testNo &#34;CheckCmdLegal&#34;}} {
   global spawn_id
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::MySendACmd(2)"><a href="./aaaLocal.tcl.html#::MySendACmd_185">::MySendACmd</a></a> &#34;$cmd&#34; $fd_res $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   set rtValue [<a name="::check_illegality(2)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;

   regsub {\{} $cmd &#34;LeftBrace&#34; cmd1;
   regsub {\}} $cmd1 &#34;rightBrace&#34; cmd;
   regsub {\[} $cmd &#34;LeftBracket&#34; cmd1;
   regsub {\]} $cmd1 &#34;RightBracket&#34; cmd;
   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Command &lt;$cmd&gt; executed ok&#34;
   if { $rtValue == &#34;illegal&#34; } {
      <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error in executing command&#34;
   } else {
      <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Command executed successfully&#34;
   }
   <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $rtValue
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: exIACreateAccount</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: To create account</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: userid </span>
<span class="comment-line">#		-type		can be admin or user</span>
<span class="comment-line">#		-passwd 	the password	</span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#		rtValue		&#34;&#34;, &#34;timeout&#34;, &#34;illegal&#34;</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::exIACreateAccount_346">proc <a href="aaaLocal.tcl-annot.html#::::exIACreateAccount">::::exIACreateAccount</a></a></strong> {userid args} {

   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exIACreateAccount $args {
      type &#34;admin&#34;
      passwd &#34;&#34;
   }

   set rtValue &#34;&#34;
   global whichDutNow
   global passwd3
   set testNo &#34;exIACreateAccount&#34;;

   set ver [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}];
<span class="comment-line">#   set ver [lindex [split $ver -] 0];</span>
   <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ver= $ver&#34;;
   if {[<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 11.1.0.21] &gt;=0} {
      set cmd &#34;create account $type $userid&#34;;
      <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- Send $cmd&#34;;
      send &#34;$cmd\r&#34;;
      expect &#34;$cmd&#34;;				;<span class="comment-line"># echo</span>
      expect {
         timeout {
            <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;time1&#34;;
	    set rtValue &#34;timeout&#34;;
         }
         -nocase &#34;password: &#34; {
            append exp_out_buf $expect_out(buffer);
            send &#34;$passwd\r&#34;;
            expect {
               -nocase &#34;reenter password: &#34; {
                  append exp_out_buf $expect_out(buffer);
<span class="comment-line">#	          regsub -all &#34;\n\r&#34; $exp_out_buf &#34;\n&#34; exp_out_buf</span>
	          <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$exp_out_buf&#34;;
                  global spawn_id
                  set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
                  <span class="comment-line">#do not need to show error status, since we know this will cause error</span>
                  <a name="::MySendACmd(3)"><a href="./aaaLocal.tcl.html#::MySendACmd_185">::MySendACmd</a></a> &#34;$passwd&#34; &#34;NULL&#34; $fd_in false
                  close $fd_in

                  set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
                  set rtValue [<a name="::check_illegality(3)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
                  close $fd_in
                  file delete &#34;Tmp/tmp_$testNo[pid]&#34;
		  set passwd3 $passwd ; 
		echo &#34;passwd3 == $passwd3&#34;
               }
               timeout {
                  <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;time1&#34;;
	          set rtValue &#34;timeout&#34;;
               }
            }
         }
         -nocase &#34;does not have permissions for this command.&#34; {
            set rtValue &#34;illegal&#34;
         }
      }
   } else {
      <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Old Style&#34;;
      <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create account $type $userid $passwd&#34;;
   }
   return $rtValue;
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckCreateAcctIllegal</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sets result ok if create account failed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: userid </span>
<span class="comment-line">#		-type</span>
<span class="comment-line">#		-passwd</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckCreateAcctIllegal_421">proc <a href="aaaLocal.tcl-annot.html#::::CheckCreateAcctIllegal">::::CheckCreateAcctIllegal</a></a></strong> {userid args} {

   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckCreateAcctIllegal $args {
      type &#34;admin&#34;
      passwd &#34;&#34;
   }

   global whichDutNow
   set rtValue &#34;&#34;

   set ver [<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}];
   <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ver= $ver&#34;;
   if {[<a name="::CompareRelease(2)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 11.1.0.21] &gt;=0} {
      set rtValue [<a name="::exIACreateAccount(1)"><a href="./aaaLocal.tcl.html#::exIACreateAccount_346">::exIACreateAccount</a></a> &#34;$userid&#34; -type $type -passwd &#34;$passwd&#34;];
      <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rtValue= $rtValue&#34;;
      set cmd &#34;create account $type $userid $passwd&#34;;
      regsub {\{} $cmd &#34;LeftBrace&#34; cmd1;
      regsub {\}} $cmd1 &#34;rightBrace&#34; cmd;
      regsub {\[} $cmd &#34;LeftBracket&#34; cmd1;
      regsub {\]} $cmd1 &#34;RightBracket&#34; cmd;
      regsub {\010} $cmd &#34;BACK&#34; cmd1;
      regsub {\010} $cmd1 &#34;BACK&#34; cmd;
      <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$cmd should fail&#34;
      if { $rtValue == &#34;illegal&#34; } {
         <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;create account failed&#34;
      } else {
         <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;create account should fail but passed&#34;
      }
      <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   } else {
      <a name="::CheckCmdIllegal(1)"><a href="./checkCmdLegality.tcl.html#::CheckCmdIllegal_18">::CheckCmdIllegal</a></a> &#34;create account $type $userid $passwd&#34;;
   }
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckCreateAcctLegal</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sets result ok if create account successful</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: userid </span>
<span class="comment-line">#		-type</span>
<span class="comment-line">#		-passwd</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckCreateAcctLegal_467">proc <a href="aaaLocal.tcl-annot.html#::::CheckCreateAcctLegal">::::CheckCreateAcctLegal</a></a></strong> {userid args} {

   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckCreateAcctLegal $args {
      type &#34;admin&#34;
      passwd &#34;&#34;
   }

   global whichDutNow
   set rtValue &#34;&#34;

   set ver [<a name="::GetVersion(3)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}];
   <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ver= $ver&#34;;
   if {[<a name="::CompareRelease(3)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 11.1.0.21] &gt;=0} {
      set rtValue [<a name="::exIACreateAccount(2)"><a href="./aaaLocal.tcl.html#::exIACreateAccount_346">::exIACreateAccount</a></a> &#34;$userid&#34; -type $type -passwd &#34;$passwd&#34;];
      <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rtValue= $rtValue&#34;;
      set cmd &#34;create account $type $userid $passwd&#34;;
      regsub {\{} $cmd &#34;LeftBrace&#34; cmd1;
      regsub {\}} $cmd1 &#34;rightBrace&#34; cmd;
      regsub {\[} $cmd &#34;LeftBracket&#34; cmd1;
      regsub {\]} $cmd1 &#34;RightBracket&#34; cmd;
      regsub {\010} $cmd &#34;BACK&#34; cmd1;
      regsub {\010} $cmd1 &#34;BACK&#34; cmd;
      <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$cmd should pass&#34;
      if { ($rtValue == &#34;legal&#34;) || ($rtValue == &#34;Illegal Line is Note:.*&#34;) } {
         <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;create account sucessful&#34;
      } else {
         <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;create account failed&#34;
      }
      <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   } else {
      <a name="::CheckCmdLegal(1)"><a href="./checkCmdLegality.tcl.html#::CheckCmdLegal_58">::CheckCmdLegal</a></a> &#34;create account $type $userid $passwd&#34;;
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: exIAConfigAccount</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: To pasword for an account</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: userid</span>
<span class="comment-line">#               -passwd         the password</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#               rtValue         &#34;&#34;, &#34;timeout&#34;, &#34;error&#34;, &#34;illegal&#34;</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::exIAConfigAccount_513">proc <a href="aaaLocal.tcl-annot.html#::::exIAConfigAccount">::::exIAConfigAccount</a></a></strong> {userid args} {

   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exIAConfigAccount $args {
      passwd3 &#34;&#34;
      passwd &#34;&#34;
   }

   set rtValue &#34;&#34;
   global whichDutNow
   set testNo &#34;exIACreateAccount&#34;;

   set ver [<a name="::GetVersion(4)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}];
   <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ver= $ver&#34;;
   if {[<a name="::CompareRelease(4)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 11.1.0.21] &gt;=0} {
      set cmd &#34;config account $userid&#34;;
      send &#34;$cmd\r&#34;;
      expect &#34;$cmd&#34;;                           
      expect {
         timeout {
            <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;time1&#34;;
            set rtValue &#34;timeout&#34;;
         }
         -nocase -re &#34;does not have permissions&#34; {
            append exp_out_buf $expect_out(buffer);
            expect &#34;*&#34;;
            append exp_out_buf $expect_out(buffer);
            <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$exp_out_buf&#34;;
            set rtValue &#34;illegal&#34;;
         }
     -nocase -re &#34;Current user's password:&#34; {
	if { $passwd3 != &#34;NULL&#34;} {
        	 send &#34;$passwd3\r&#34;;
	} else {
        	 send &#34;\r\r&#34;;
 	}
        expect {
             -nocase -re &#34;New password:&#34; {
                append exp_out_buf $expect_out(buffer);
                send &#34;$passwd\r&#34;;
		expect {
                -nocase -re &#34;Reenter password:&#34; {
                append exp_out_buf $expect_out(buffer);
                  regsub -all &#34;\n\r&#34; $exp_out_buf &#34;\n&#34; exp_out_buf
<span class="comment-line">#                  result_debug &#34;$exp_out_buf&#34;;</span>
                  global spawn_id
                  set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
                  <span class="comment-line">#do not need to show error status, since we know this will cause error</span>
                  <a name="::MySendACmd(4)"><a href="./aaaLocal.tcl.html#::MySendACmd_185">::MySendACmd</a></a> &#34;$passwd&#34; &#34;NULL&#34; $fd_in false
                  close $fd_in
                  set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
                  set rtValue [<a name="::check_illegality(4)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
                  close $fd_in
                  file delete &#34;Tmp/tmp_$testNo[pid]&#34;
	        }
                 timeout {
	            <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;time2&#34;;
	            set rtValue &#34;timeout&#34;;
                 }
		}
       }
         timeout {
            <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;time1&#34;;
            set rtValue &#34;timeout&#34;;
         }
}
<span class="comment-line">#        set rtValue &#34;legal&#34;;</span>
        }
 -nocase -re &#34;password: &#34; {
            append exp_out_buf $expect_out(buffer);
            send &#34;$passwd\r&#34;;
            expect {
               -nocase -re &#34;reenter password: &#34; {
                  append exp_out_buf $expect_out(buffer);
                  regsub -all &#34;\n\r&#34; $exp_out_buf &#34;\n&#34; exp_out_buf
<span class="comment-line">#                  result_debug &#34;$exp_out_buf&#34;;</span>
                  global spawn_id
                  set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
                  <span class="comment-line">#do not need to show error status, since we know this will cause error</span>
                  <a name="::MySendACmd(5)"><a href="./aaaLocal.tcl.html#::MySendACmd_185">::MySendACmd</a></a> &#34;$passwd&#34; &#34;NULL&#34; $fd_in false
                  close $fd_in
                  set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
                  set rtValue [<a name="::check_illegality(5)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
                  close $fd_in
                  file delete &#34;Tmp/tmp_$testNo[pid]&#34;
               }
               timeout {
                  set rtValue &#34;timeout&#34;;
               }
            }
         }

      }
   } else {
      <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Old Style&#34;;
      <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config account $userid $passwd&#34;;
   }
   return $rtValue;
}




<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckConfigAcctIllegal</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sets result ok if config account failed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: userid </span>
<span class="comment-line">#		-passwd</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckConfigAcctIllegal_625">proc <a href="aaaLocal.tcl-annot.html#::::CheckConfigAcctIllegal">::::CheckConfigAcctIllegal</a></a></strong> {userid args} {

   <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckConfigAcctIllegal $args {
      passwd3 &#34;&#34;
      passwd &#34;&#34;
   }

   global whichDutNow
   set rtValue &#34;&#34;

   set ver [<a name="::GetVersion(5)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}];
   <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ver= $ver&#34;;
   if {[<a name="::CompareRelease(5)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 11.1.0.21] &gt;=0} {
      set rtValue [<a name="::exIAConfigAccount(1)"><a href="./aaaLocal.tcl.html#::exIAConfigAccount_513">::exIAConfigAccount</a></a> &#34;$userid&#34; -passwd3 &#34;$passwd3&#34; -passwd &#34;$passwd&#34;];
      <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rtValue= $rtValue&#34;;
      set cmd &#34;config account $userid $passwd&#34;;
      regsub {\{} $cmd &#34;LeftBrace&#34; cmd1;
      regsub {\}} $cmd1 &#34;rightBrace&#34; cmd;
      regsub {\[} $cmd &#34;LeftBracket&#34; cmd1;
      regsub {\]} $cmd1 &#34;RightBracket&#34; cmd;
      regsub {\010} $cmd &#34;BACK&#34; cmd1;
      regsub {\010} $cmd1 &#34;BACK&#34; cmd;
      <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$cmd should fail&#34;
      if { $rtValue == &#34;illegal&#34; } {
         <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;config account failed&#34;
      } else {
         <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;config account should fail but passed&#34;
      }
      <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   } else {
      <a name="::CheckCmdIllegal(2)"><a href="./checkCmdLegality.tcl.html#::CheckCmdIllegal_18">::CheckCmdIllegal</a></a> &#34;config account $userid $passwd&#34;;
   }
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckConfigAcctLegal</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sets result ok if config account successful</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: userid </span>
<span class="comment-line">#		-passwd</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckConfigAcctLegal_670">proc <a href="aaaLocal.tcl-annot.html#::::CheckConfigAcctLegal">::::CheckConfigAcctLegal</a></a></strong> {userid args} {

   <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckConfigAcctLegal $args {
      passwd3 &#34;&#34;
      passwd &#34;&#34;
   }

   global whichDutNow
   set rtValue &#34;&#34;

   set ver [<a name="::GetVersion(6)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}];
   <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ver= $ver&#34;;
<span class="comment-line">#set passwd3 $passwd</span>
   if {[<a name="::CompareRelease(6)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 11.1.0.21] &gt;=0} {
      set rtValue [<a name="::exIAConfigAccount(2)"><a href="./aaaLocal.tcl.html#::exIAConfigAccount_513">::exIAConfigAccount</a></a> &#34;$userid&#34; -passwd3 &#34;$passwd3&#34; -passwd &#34;$passwd&#34;];
      <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rtValue= $rtValue&#34;;
      set cmd &#34;config account $userid $passwd&#34;;
      regsub {\{} $cmd &#34;LeftBrace&#34; cmd1;
      regsub {\}} $cmd1 &#34;rightBrace&#34; cmd;
      regsub {\[} $cmd &#34;LeftBracket&#34; cmd1;
      regsub {\]} $cmd1 &#34;RightBracket&#34; cmd;
      regsub {\010} $cmd &#34;BACK&#34; cmd1;
      regsub {\010} $cmd1 &#34;BACK&#34; cmd;
      <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$cmd should pass&#34;
      if { $rtValue == &#34;legal&#34; } {
         <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;config account sucessful&#34;
      } else {
         <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;config account failed&#34;
      }
      <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   } else {
      <a name="::CheckCmdLegal(2)"><a href="./checkCmdLegality.tcl.html#::CheckCmdLegal_58">::CheckCmdLegal</a></a> &#34;config account $userid $passwd&#34;;
   }
}


</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
