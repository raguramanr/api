<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>PortMapping.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#PortMapping.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>PortMapping.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="PortMapping.tcl-annot.html">annotations</a> | <a href="PortMapping.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: MapIxiaPortId</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Map user-defined ixis portId to the ixia scheme of </span>
<span class="comment-line">#	&#34;chassisNo cardNo portNo&#34;</span>
<span class="comment-line"># Input args: {portId}</span>
<span class="comment-line"># Output args: {chasisIdName} {cardName} {portName} </span>
<span class="comment-line"># Return value: integer</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	MapIxiaPortId $txPortId txChasisId txCard txPort</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MapIxiaPortId_14">proc <a href="PortMapping.tcl-annot.html#::::MapIxiaPortId">::::MapIxiaPortId</a></a></strong> {  {portId 1} 
                      {chasisIdName  1}
                      {cardName  1}
                      {portName  1} } {
			  upvar $chasisIdName chasisId $cardName card $portName port

   global ixiaPortMappingArray
   global startPortNum
   global startCardNum
   global TrafficGen


   if {$TrafficGen == &#34;stc&#34;} {
       <span class="comment-line"># NOT required for Spirent implementation</span>
       set chasisId 1
       set card 1
       set port 1
       return
   }
   if {$portId &lt;=0 } {
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;GetIxiaPortMapping: Invalid portId $portId&#34;
      error &#34;GetIxiaPortMapping: Invalid portId $portId&#34;
   }

   if { ![info exist startCardNum] } {
       <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;startCardNum not defined &#34; 
       return -1
   } 
   if { [llength [split $startCardNum :]] == 2 }  {
          set startPortNum [lindex [split $startCardNum :] 1]
          set startCardNum [lindex [split $startCardNum :] 0]
	  if { ($startPortNum &lt; 1) || ($startCardNum &lt; 1) } {
              <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;startCardNum not defined properly $startCardNum&#34; 
              return -1
          }        
   } elseif { [llength [split $startCardNum :]] == 1 }  {
	if { ![info exist startPortNum] } {
	     set startPortNum 1
	}
   } else {
       <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;startCardNum not defined properly $startCardNum&#34; 
       return -1
   } 

   if {[info exists ixiaPortMappingArray($portId)] == 1 } {
      set portMap $ixiaPortMappingArray($portId)
      set port [lindex $portMap 2]
      set card [lindex $portMap 1]
      set chasisId [lindex $portMap 0]
      <a name="::card(1)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> get $chasisId $card
      set portNum [<a name="::card(2)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> cget -portCount]
      <span class="comment-line">#return this annoying pair receive port</span>
      if {($port == 1) &amp;&amp; ($portNum &gt; 1)} {set rxPort 2} else {set rxPort 1}
      return $rxPort
   } else {
      <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;GetIxiaPortMapping: Invalid portId $portId - no mapping found&#34;
      error &#34;GetIxiaPortMapping: Invalid portId $portId&#34;
   }
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetDUTPort</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function returns the DUT port number by the given ixia</span>
<span class="comment-line">#	portId and DUT no.</span>
<span class="comment-line"># Input args: {portId} {DUTId}</span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: integer or : separated integer values</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	SendACmd &#34;enable port [GetDUTPort $switchPort2DefaultRouter 2]&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDUTPort_86">proc <a href="PortMapping.tcl-annot.html#::::GetDUTPort">::::GetDUTPort</a></a></strong> { {portId 1}
                  {DUTId  1} } {
   global DUTs_info

      if {[regexp -nocase &#34;mgmt&#34; $portId]} {
         return $portId
      }

      switch -regexp $DUTs_info(DUT$DUTId,platform) {
	   NG -
	   BD\* -
           Stack\* -
	   Aspen\* {
              global DUT${DUTId}_DefaultBlade
              set dutBlade [set DUT${DUTId}_DefaultBlade]
              if {$dutBlade==&#34;&#34;} {
                 return &#34;$portId&#34; 
      	      } else {
      	         return &#34;$dutBlade:$portId&#34; 
              }
      } Summit\* {
			return $portId
      } ENET\* {
			return $portId
      } default {
			return $portId
		}
   }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetDUTPort_FP</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#        This function returns the DUT front panel port number by the given ixia</span>
<span class="comment-line">#  portId and DUT no with default blade type.</span>
<span class="comment-line"># Input args: {portId} {DUTId_DefaultBlade_FP}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: integer or : separated integer values</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#  SendACmd &#34;enable port [GetDUTPort $switchPort2DefaultRouter 2]&#34;</span>
<span class="comment-line">#SendACmd &#34;enable port [GetDUTPort_FP $frontPanelPortToGw 1]&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDUTPort_FP_128">proc <a href="PortMapping.tcl-annot.html#::::GetDUTPort_FP">::::GetDUTPort_FP</a></a></strong> { {portId 1}
                  {DUTId  1} } {
   global DUTs_info

      if {[regexp -nocase &#34;mgmt&#34; $portId]} {
         return $portId
      }

      switch -regexp $DUTs_info(DUT$DUTId,platform) {
           NG -
           BD\* -
           Stack\* -
           Aspen\* {
              global DUT${DUTId}_DefaultBlade_FP
              set dutBlade [set DUT${DUTId}_DefaultBlade_FP]
              if {$dutBlade==&#34;&#34;} {
                 return &#34;$portId&#34;
              } else {
                 return &#34;$dutBlade:$portId&#34;
              }
      } Summit\* {
                        return $portId
      } ENET\* {
                        return $portId
      } default {
                        return $portId
                }
   }
}
<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: MapDUTPortId</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function converts the specified list of ixia portIds to</span>
<span class="comment-line">#	to the list of corresponding DUT port numbers.</span>
<span class="comment-line"># Input args: {portIdString} {DUTId}</span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: integer or : separated list of integers</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	SendACmd  &#34;config vlan1 add port [MapDUTPortId 1,3-5 1]&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MapDUTPortId_169">proc <a href="PortMapping.tcl-annot.html#::::MapDUTPortId">::::MapDUTPortId</a></a></strong> { {portIdString 1}
                  {DUTId  1} } {
   
   set portString &#34;&#34;
   global DUTs_info MAIN
   global ixiaPortMappingArray
   <span class="comment-line">#first filter the comma</span>
	regsub -all {,} $portIdString { } portRangeList
	foreach portRange $portRangeList {
	   if { [regexp {[0-9]-[0-9]} $portRange] == 1} {
	      <span class="comment-line">#if in range format</span>
	      <span class="comment-line">#puts &#34;Range: $portRange&#34;</span>
	      set temp [split $portRange &#34;-&#34;]
	      set startRange [lindex $temp 0]
	      set endRange [lindex $temp 1]
	      <span class="comment-line">#puts &#34;RangeProcessed: |$temp|$startRange|$endRange|&#34;</span>
	      for {set i $startRange} {$i &lt;= $endRange} {incr i} {
	         set DUTPort [<a name="::GetDUTPortMapping(1)"><a href="./PortMapping.tcl.html#::GetDUTPortMapping_236">::GetDUTPortMapping</a></a> $DUTId $i]
                  if {[info exists MAIN(PRINTTopoInfo)]} {
                    if {$MAIN(PRINTTopoInfo)} {
                       if {[info exists ixiaPortMappingArray($i)] == 1} {
                          <a name="::MapIxiaPortId(1)"><a href="./PortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $i chas card port
                          <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT$DUTId $DUTPort goes to portId $i -&gt; \[$chas, $card, $port\]&#34;
                       } else {
                          <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT$DUTId $DUTPort goes to portId $i&#34;
                       }  
                    }
                 }
	         append portString &#34;, $DUTPort&#34;
	      }
	   } elseif {[regexp {[0-9]} $portRange] == 1 } {
	      <span class="comment-line">#or just a single number</span>
	      <span class="comment-line">#puts &#34;Single: $portRange DUTId:$DUTId&#34;</span>
	      set DUTPort [<a name="::GetDUTPortMapping(2)"><a href="./PortMapping.tcl.html#::GetDUTPortMapping_236">::GetDUTPortMapping</a></a> $DUTId $portRange]
              if {[info exists MAIN(PRINTTopoInfo)]} {
                 if {$MAIN(PRINTTopoInfo)} {
                    if {[info exists ixiaPortMappingArray($portRange)] == 1} {
                        <a name="::MapIxiaPortId(2)"><a href="./PortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portRange chas card port
                        <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT$DUTId $DUTPort goes to portId $portRange -&gt; \[$chas, $card, $port\]&#34;
                    } else {                 
                        <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT$DUTId $DUTPort goes to portId $portRange&#34;
                    }
                 }
              }
	      append portString &#34;, $DUTPort&#34;
	   } else {
	      <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;MapDUTPortId: Unknown portId format $portRange&#34;
	      error &#34;MapDUTPortId: Unknown portId format $portRange&#34;
	   }
	}
	<span class="comment-line">#remove the first comma</span>
	regsub {, } $portString {} newString
   return $newString
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetDUTPortMapping</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Similar with GetDUTPort, this function returns the DUT port </span>
<span class="comment-line">#	number by the given ixia portId and DUT no.</span>
<span class="comment-line"># Input args: {DUT} {portId} </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: list of port mapping array</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 set DUTPort [GetDUTPortMapping $dutNo $portId]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDUTPortMapping_236">proc <a href="PortMapping.tcl-annot.html#::::GetDUTPortMapping">::::GetDUTPortMapping</a></a></strong> {{DUT 1} {portId 1}} {
   global DUTPortMappingArray

   
   if {$portId &lt;=0 } {
      <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;GetDUTPortMapping: Invalid portId $portId&#34;
      error &#34;GetDUTPortMapping: Invalid portId $portId&#34;
   }
<span class="comment-line">#   return $DUTPortMappingArray($DUT,$portId)</span>
   
   if {[info exists DUTPortMappingArray($DUT,$portId)] == 1 } {
      return $DUTPortMappingArray($DUT,$portId)
   } else {
      <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;wrong port mapping called&#34;
      return [<a name="::GetDUTPort(1)"><a href="./PortMapping.tcl.html#::GetDUTPort_86">::GetDUTPort</a></a> $portId $DUT]
   }
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GenerateDUTPortMapping</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function will generate an array to map portId to DUT port;</span>
<span class="comment-line">#	only physical connection between Ixia and DUT will be mapped here.</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 GenerateDUTPortMapping</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GenerateDUTPortMapping_266">proc <a href="PortMapping.tcl-annot.html#::::GenerateDUTPortMapping">::::GenerateDUTPortMapping</a></a></strong> { } {
   global DUTPortMappingArray
   global portMappingList
   global DUTINITSTORED
   global MAIN
   
   foreach portMap $portMappingList {
      set portId [lindex $portMap 0]
      set portDUT [lindex $portMap 1]
      set DUT [lindex $portMap 2]
      if {$DUT == &#34;&#34;} {set DUT 1}
      if {[regexp -nocase {[5-8]} $portId]&amp;&amp;$DUT==2} {
          <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\
                STANDARD Regression Test Beds Required PortId 9-12 as DUT2 Connections\n\
                You Are Configured for a Non-Standard Modified Test Bed\n\
                !!!!!!!!!!!!!!!!!!!!!!!!!!!&#34;
      }
      lappend tmpPMList &#34;$portId $portDUT $DUT&#34;
   }
   set portMappingList $tmpPMList
   foreach portMap $portMappingList {
      set portId [lindex $portMap 0]
      set portDUT [lindex $portMap 1]
      set DUT [lindex $portMap 2]
      if {$DUT == &#34;&#34;} {set DUT 1}
      <span class="comment-line">#puts &#34;GenerateDUTPortMapping: $portId $portDUT $DUT&#34;</span>
      if {[regexp -nocase {[5-8]} $portId]&amp;&amp;$DUT==2} {
          <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\
                STANDARD Regression Test Beds Required PortId 9-12 as DUT2 Connections\n\
                You Are Configured for a Non-Standard Modified Test Bed\n\
                !!!!!!!!!!!!!!!!!!!!!!!!!!!&#34;
      }
      set DUTPortMappingArray($DUT,$portId) $portDUT
      <span class="comment-line">#RTP-SQA added for fast test init file</span>
      if {[info exist MAIN(ifPipe)] &amp;&amp; ($MAIN(ifPipe) != &#34;NULL&#34;)} {
          if {![info exists DUTINITSTORED($DUT,$portId)] &amp;&amp; $portDUT != &#34;A&#34;} {
              set DUTINITSTORED($DUT,$portId) $portDUT
              puts $MAIN(ifPipe) &#34;set DUTPortMappingArray($DUT,$portId) $portDUT&#34;
          }
      }
   }
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GenerateIxiaPortMapping</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function will generate an array to map every portId to </span>
<span class="comment-line">#	ixia port scheme &#34;chassis card port&#34;.</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 GenerateIxiaPortMapping</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GenerateIxiaPortMapping_321">proc <a href="PortMapping.tcl-annot.html#::::GenerateIxiaPortMapping">::::GenerateIxiaPortMapping</a></a></strong> { } {
   global ixiaPortMappingArray
   global ixiaMappingList
   global MAIN
   
   foreach portMap $ixiaMappingList {
      set portId [lindex $portMap 0]
      set card [lindex $portMap 1]
      set port [lindex $portMap 2]
      set ixiaPortMappingArray($portId) &#34;1 $card $port&#34; 
      <span class="comment-line">#RTP-SQA added for fast test init file</span>
      if {[info exist MAIN(ifPipe)] &amp;&amp; ($MAIN(ifPipe) != &#34;NULL&#34;)} {
          puts $MAIN(ifPipe) &#34;set ixiaPortMappingArray($portId) \&#34;1 $card $port\&#34;&#34;
      }
      
   }
}

<strong><a name="::::GetExpDir_339">proc <a href="PortMapping.tcl-annot.html#::::GetExpDir">::::GetExpDir</a></a></strong> {} {

   return &#34;Exp&#34;
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: CheckPortId5Thru8</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Check the existence of logical portId5 thru 8 in case using optimized 2-node topology</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line"># Return value: integer (0 or 1)</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	CheckPortId5Thru8</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################    </span>
<strong><a name="::::CheckPortId5Thru8_355">proc <a href="PortMapping.tcl-annot.html#::::CheckPortId5Thru8">::::CheckPortId5Thru8</a></a></strong> { } {
   global portMappingList
   set returnFlag 0
   if {[info exists portMappingList]==0} {
      return $returnFlag
   }

   foreach portMap $portMappingList {
      set portId [lindex $portMap 0]
      if {[lsearch &#34;5 6 7 8&#34; $portId]!=-1} {
         set returnFlag 1
         break
      }
   }
   return $returnFlag
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: MapIxiaCardnPort</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Map ixia scheme of &#34;chassisNo cardNo portNo&#34; to </span>
<span class="comment-line">#       user-defined ixis portId</span>
<span class="comment-line"># Input args: {chasisIdName} {cardName} {portName} </span>
<span class="comment-line"># Output args: {portId}</span>
<span class="comment-line"># Return value: integer</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	MapIxiaPortId $txPortId txChasisId txCard txPort</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MapIxiaCardnPort_384">proc <a href="PortMapping.tcl-annot.html#::::MapIxiaCardnPort">::::MapIxiaCardnPort</a></a></strong> { {chasisIdName  1}
                      {cardName  1}
                      {portName  1} } {

   global ixiaPortMappingArray
   global startPortNum
		  
   if {! [info exist startPortNum]} {
       set startPortNum 1
   }
   
   set portInfo &#34;$chasisIdName $cardName $portName&#34;

   foreach {key value} [array get ixiaPortMappingArray] {
      if {$value == $portInfo} {
         set portId $key
         break
      }
   }

   if {[info exists portId] != 1 } {
      <span class="comment-line">#result_error &#34;GetIxiaPortMapping: Invalid chasis $chasisIdName card \</span>
      <span class="comment-line">#              $cardName and port $portName - no mapping found&#34;</span>
      return 0
   }
   return $portId
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetIxiaDUTPortList</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       Return the list of all ixia port numbers on DUT </span>
<span class="comment-line"># Input args: dut </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: list of integers or list of : separated integer set</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         set portList [GetIxiaDUTPortList 1]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetIxiaDUTPortList_424">proc <a href="PortMapping.tcl-annot.html#::::GetIxiaDUTPortList">::::GetIxiaDUTPortList</a></a></strong> {DUTId} {
    global portMappingList
    set portList &#34;&#34;
    
    if {![info exists portMappingList]} {
        return $portList
    }
    foreach portPair $portMappingList {
           if {$DUTId == [lindex $portPair 2]} {
               if {$portList != &#34;&#34;} {
                   append portList &#34;,&#34;
               }
               append portList [lindex $portPair 1]
           }
     }
     return $portList
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetAIxiaDUTPort</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       Return the index-th port number on DUTId that links to ixia.</span>
<span class="comment-line"># Input args: DUTId {index}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: integer or a : separated integer set</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         SendACmd  &#34;conf ebgp add port [GetAIxiaDUTPort 1 3]&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetAIxiaDUTPort_453">proc <a href="PortMapping.tcl-annot.html#::::GetAIxiaDUTPort">::::GetAIxiaDUTPort</a></a></strong> {DUTId {index 1} } {

    set portList [<a name="::GetIxiaDUTPortList(1)"><a href="./PortMapping.tcl.html#::GetIxiaDUTPortList_424">::GetIxiaDUTPortList</a></a> $DUTId]
    <span class="comment-line">#use the first switch id to get the default blade</span>
    if {$index &gt; [llength [split $portList &#34;,&#34;] ]} { return &#34;PORT_NOT_FOUND&#34; }
    if {$index &lt; 1} { return &#34;PORT_NOT_FOUND&#34; }
    return [lindex [split $portList &#34;,&#34;] [expr $index -1]]
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetAIxiaPortId</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       Return the real Ixia Id for the ixia port which connects to DUTId's index'th port to ixia </span>
<span class="comment-line"># Input args: DUTId {index}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: integer or a : separated integer set</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         SendACmd  &#34;conf ebgp add port [GetAIxiaDUTPort 1 3]&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetAIxiaPortId_472">proc <a href="PortMapping.tcl-annot.html#::::GetAIxiaPortId">::::GetAIxiaPortId</a></a></strong> {DUTId {index 1} } {

    global portMappingList
    global numDUT
    set ixiaPortIdList &#34;&#34;

    if { $DUTId == 0 } { 
         set numPortIdNeeded [<a name="::::GetHighestPortId(1)"><a href="./SystemSetup.tcl.html#::::GetHighestPortId_580">::::GetHighestPortId</a></a>]
         if {($numPortIdNeeded &gt;= 11) &amp;&amp; ( $numDUT &gt; 2 )} {
           return 9 ;
         }
    }
    
    if {![info exists portMappingList]} {
        return $ixiaPortIdList
    }
    foreach portPair $portMappingList {
           if {$DUTId == [lindex $portPair 2]} {
               if {$ixiaPortIdList != &#34;&#34;} {
                   append ixiaPortIdList &#34;,&#34;
               }
               append ixiaPortIdList [lindex $portPair 0]
           }
     }
    if {$index &gt; [llength [split $ixiaPortIdList &#34;,&#34;] ]} { return &#34;PORT_NOT_FOUND&#34; }
    if {$index &lt; 1} { return &#34;PORT_NOT_FOUND&#34; }
    return [lindex [split $ixiaPortIdList &#34;,&#34;] [expr $index -1]]
 
}
<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetDUT_FP_Port</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function returns the DUT port number by the given FP</span>
<span class="comment-line">#	    DUT no.</span>
<span class="comment-line"># Input args: {port} {DUTId}</span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: integer or : separated integer values</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	SendACmd &#34;enable port [GetDUT_FP_Port $switchPort2DefaultRouter 2]&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDUT_FP_Port_513">proc <a href="PortMapping.tcl-annot.html#::::GetDUT_FP_Port">::::GetDUT_FP_Port</a></a></strong> { {<a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> 1}
                  {DUTId  1} } {
    global DUTs_info
    
    switch -regexp $DUTs_info(DUT$DUTId,platform) {
        NG -
        BD\* -
        Stack\* -
        Aspen\* {
            global DUT${DUTId}_DefaultBlade_FP
            set dutBlade [set DUT${DUTId}_DefaultBlade_FP]
            if {$dutBlade==&#34;&#34;} {
                return &#34;$port&#34; 
            } else {
                return &#34;$dutBlade:$portId&#34; 
            }
        } Summit\* {
            return $port
        } ENET\* {
            return $port
        } default {
            return $port
        }
    }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: _getDutPorts</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return a comma delimited list of all ports used in the cfg file</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::_getDutPorts_546">proc <a href="PortMapping.tcl-annot.html#::::_getDutPorts">::::_getDutPorts</a></a></strong> {args} {
    global portMappingList trunkPortList 
    global frontPanelPortToGw

    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _getDutPorts $args {
        dut &#34;1&#34;
    }

    global DUT${dut}_DefaultBlade_FP
    
    set dutPoList &#34;&#34;
    foreach elem $portMappingList {
        if {[lindex $elem 2] == $dut &amp;&amp; ![regexp -nocase &#34;not|a&#34; [lindex $elem 1]]} {
            lappend dutPoList [lindex $elem 1]
        }
    }
    foreach elem $trunkPortList {
        if {[lindex $elem 0] == $dut} {
            lappend dutPoList [lindex $elem 2]
        }
    }
    if {[info exists frontPanelPortToGw] &amp;&amp; $frontPanelPortToGw &gt; 0} {
        if {[info exists DUT${dut}_DefaultBlade_FP] &amp;&amp; [set DUT${dut}_DefaultBlade_FP] &gt; 0} {
            lappend dutPoList [set DUT${dut}_DefaultBlade_FP]:$frontPanelPortToGw
        } else {
            lappend dutPoList $frontPanelPortToGw
        }
    }
    if {[llength $dutPoList] &gt; 0} {
        set pos [lsort -dictionary $dutPoList]
        return [join $pos &#34;,&#34;]
    }
    return &#34;&#34;
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetPortSysTypes</span>
<span class="comment-line">#</span>
<span class="comment-line"># input args -portIdList </span>
<span class="comment-line">#            -dutPortString</span>
<span class="comment-line">#            -dut</span>
<span class="comment-line">#            -returnFormat    return a list or a regexp format string</span>
<span class="comment-line">#</span>
<span class="comment-line"># returns a list of unique sysTypes for ports passed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Example:  GetPortSysTypes -portIdList &#34;1 2 10 11&#34;</span>
<span class="comment-line">#           returns -&gt; V400-48p-10GE4 X460G2-24t-24ht</span>
<span class="comment-line">#</span>
<span class="comment-line">#    GetPortSysTypes -portIdList &#34;1 2 10 11&#34; -returnFormat regex</span>
<span class="comment-line">#    returns -&gt; V400-48p-10GE4|X460G2-24t-24ht</span>
<span class="comment-line">#</span>
<span class="comment-line">#    GetPortSysTypes -dut 1 -dutPortString  &#34;[MapDUTPortId 1,2,3,4],[GetATrunkPort 1 2]&#34;</span>
<span class="comment-line">#    returns -&gt; V400-48p-10GE4 X670G2-72x</span>
<span class="comment-line">#</span>
<span class="comment-line">#    set slotType [GetPortSysTypes -dut $whichDutNow \</span>
<span class="comment-line">#             -dutPortString $portno -returnFormat regex]</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetPortSysTypes_603">proc <a href="PortMapping.tcl-annot.html#::::GetPortSysTypes">::::GetPortSysTypes</a></a></strong> {args} {
    global DutPort_Info Trunk_Info PortID_Info MAIN
    global frontPanelPortToGw

    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _getDutPorts $args {
        dut &#34;null&#34;
        dutPortString &#34;null&#34;
        portIdList &#34;1&#34;
        returnFormat &#34;list&#34;
    }

    <span class="comment-line"># local</span>
    set sysTList &#34;&#34;

    if {![info exists MAIN(PORTIDINFOSET)] || ([info exists MAIN(PORTIDINFOSET)] &amp;&amp; !$MAIN(PORTIDINFOSET))} {
        <a name="::_getPortIdTypeInfo(1)"><a href="./broadcom.tcl.html#::_getPortIdTypeInfo_985">::_getPortIdTypeInfo</a></a>
    }

    if {$dut == &#34;null&#34; &amp;&amp; $dutPortString != &#34;null&#34;} {
        <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;You must specify a DUT # if using DUT port list&#34;
        <a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Use portIdList for passing in 1-4,9-10 port ids&#34;
        return;
    }
    if {$dut != &#34;null&#34; &amp;&amp; $dutPortString != &#34;null&#34;} {
        <span class="comment-line"># switch port mode</span>
        regsub {[ ]+} $dutPortString  &#34;&#34; dutPortString
        set dpL1 [split $dutPortString &#34;,&#34;]
        foreach p $dpL1 {
            set p [string trim $p]
            if {![info exists DutPort_Info($dut,$p,sysType)]} {
                <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;DUT $dut, Port $p is not defined.  Correct DUT?&#34;
                continue;
            }
            set s $DutPort_Info($dut,$p,sysType)
            if {[lsearch $sysTList $s] &lt; 0 &amp;&amp; [string trim $s] != &#34;&#34;} {
                lappend sysTList $s
            }
        }
    } else {
        <span class="comment-line"># portid mode</span>
        foreach i $portIdList {
            set s $PortID_Info($i,sysType)
            if {[lsearch $sysTList $s] &lt; 0 &amp;&amp; [string trim $s] != &#34;&#34;} {
                lappend sysTList $s
            }
        }
    }
    if {$returnFormat == &#34;regex&#34;} {
        return [join $sysTList &#34;|&#34;]
    } else {
        return $sysTList
    }
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
