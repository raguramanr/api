<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>SendPacket.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#SendPacket.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>SendPacket.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="SendPacket.tcl-annot.html">annotations</a> | <a href="SendPacket.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendFrame</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends mac frame from a txPortId to rxPortId</span>
<span class="comment-line">#     </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: txPortId, rxPortId, protocol, protocol, sourceMac, destMac, numFrames</span>
<span class="comment-line">#             frameSize, frameSizeType, dataPattern, streamType, fcsError, saMode, daMode</span>
<span class="comment-line">#             percentage, tag, tagPriority, frameRate</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             SendFrame $txPortId</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendFrame_20">proc <a href="SendPacket.tcl-annot.html#::::SendFrame">::::SendFrame</a></a></strong> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendFrame $args {
      txPortId &#34;1&#34;
      rxPortId &#34;0&#34;
      <a name="::protocol(1)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      sourceMac &#34;default&#34;
      destMac &#34;default&#34;
      numFrames &#34;10&#34;
      frameSize &#34;64&#34;
      frameSizeType &#34;sizeFixed&#34;
      frameSizeMAX &#34;1518&#34;
      frameSizeMIN &#34;64&#34;
      dataPattern &#34;1234&#34;
      ethernetType &#34;noType&#34;
      frameType &#34;08 00&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      saCount &#34;&#34;
      daCount &#34;&#34;
      percentage &#34;100&#34;
      tag &#34;none&#34;
      tagPriority &#34;0&#34;	      
      protocolTagId &#34;null&#34;
      frameRate &#34;null&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat 1
      udfEnable &#34;false&#34;
      udfInitval &#34;00&#34;
      udfOffset &#34;0&#34;
      udfCountertype &#34;c8&#34;
      udfContinuousCount &#34;false&#34;
      udfRepeat &#34;1&#34;
      protoOffsetEnable &#34;false&#34;
      protoOffset &#34;14&#34;
      userDefTag &#34;&#34;
      dontTx &#34;0&#34;
      ZeroStats &#34;yes&#34;
   }
   global portMappingList
   global DUTs_info
   <span class="comment-line"># Using Sendframe Clears preconfigured traffic streams used in MPLS</span>
   set DUTs_info(DUT1,TrafficPrimed) 0

   set portList [lindex $portMappingList [expr $txPortId-1]]
   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT[lindex $portList 2] [lindex $portList 1] ingresses from portId [lindex $portList 0]&#34;

   
   global portMappingList

   set portList [lindex $portMappingList [expr $txPortId-1]]
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT[lindex $portList 2] [lindex $portList 1] ingresses from portId [lindex $portList 0]&#34;
   <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId txChasisId txCard txPort
   if {$rxPortId == 0} {
      set sendLearn &#34;false&#34;
      set rxPort [<a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId rxChasisId rxCard rxPo]
   } else {
      set sendLearn &#34;true&#34;
      <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $rxPortId rxChasisId rxCard rxPort
   }
   
   set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   global startCardNum
   set frameSent [<a name="::ixiaConf_2Ports(1)"><a href="./ePTTx.tcl.html#::ixiaConf_2Ports_690">::ixiaConf_2Ports</a></a> -numIxiaCd $numIxiaCd -rate $frameRate \
                  -txChas $txChasisId -txCard $txCard -txPort $txPort -startCardNum $startCardNum \
                  -rxChas $rxChasisId -rxCard $rxCard -rxPort $rxPort -sendLearn $sendLearn \
                  -protocol $protocol -numFrames $numFrames -frameSize $frameSize -frameSizeType $frameSizeType \
                  -frameSizeMAX $frameSizeMAX -frameSizeMIN $frameSizeMIN \
                  -dataPattern $dataPattern -streamType $streamType -fcsError $fcsError \
		  -frameType $frameType -ethernetType $ethernetType -protocolTagId $protocolTagId \
                  -inSaMac $sourceMac -saMode $saMode -inDaMac $destMac -daMode $daMode \
                  -percentage $percentage -wTag $wTag -tagNo $tag -tagPriority $tagPriority \
                  -tagMode $tagMode -tagRepeat $tagRepeat -saCount $saCount -daCount $daCount \
		  -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -dontTx $dontTx \
                  -udfRepeat $udfRepeat \
		  -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount -protoOffsetEnable $protoOffsetEnable -protoOffset $protoOffset \
          -userDefTag $userDefTag -ZeroStats $ZeroStats]
  if {$streamType != &#34;contPacket&#34; &amp;&amp; $numFrames &gt; 100 &amp;&amp; $dontTx==0} {
    <a name="::ixiaCheckTxDone(1)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $txChasisId $txCard $txPort $numFrames $txPortId
  }
  return $frameSent            
}



<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendFrameFromMultiplePorts</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Used to send uni/bi directional mac frames in a number of paired ports.</span>
<span class="comment-line">#     </span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#      - &lt;txPortId&gt;   - Sending ixia portId</span>
<span class="comment-line">#      - &lt;rxPortId&gt;   - Receiving ixia portId</span>
<span class="comment-line">#      - &lt;direction&gt;  - direction of the mac traffic flow &#34;1Way&#34;/&#34;2Way&#34;</span>
<span class="comment-line">#      - &lt;numFrames&gt;  - Number of mac frames to be sent</span>
<span class="comment-line">#      - &lt;protocol&gt;   - protocol to be used to send mac frames (default mac but sometimes usr specified for protocol based vlan)</span>
<span class="comment-line">#      - &lt;frameSize&gt;  - frame size to be used default 64</span>
<span class="comment-line">#      - &lt;frameSizeType&gt;    - frame size type fixed or random (sizeFixed/sizeRandom)</span>
<span class="comment-line">#      - &lt;dataPattern&gt;   - data pattern to be used to pad</span>
<span class="comment-line">#      - &lt;destIp&gt;     - destination IP address           </span>
<span class="comment-line">#      - &lt;numFrames&gt;  - how many to send</span>
<span class="comment-line">#      - &lt;streamType&gt; - type of the stream stopStream/contStream...</span>
<span class="comment-line">#      - &lt;fcsError&gt; - fcsError in the ixia frame send</span>
<span class="comment-line">#      - &lt;saMode&gt;     - source side sending mode</span>
<span class="comment-line">#      - &lt;daMode&gt;     - receive side sending mode</span>
<span class="comment-line">#      - &lt;percentage&gt; - percentage of the line rate to be sent default 100</span>
<span class="comment-line">#      - &lt;tag&gt;        - tag value to be used if tagged vlan</span>
<span class="comment-line">#      - &lt;applyFilter&gt; - flag to indicate if filter/filterPallette to be applied on the receiving buffer</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Retruns the frame sent</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             SendFrameFromMultiplePorts $txPortId $rxPortId</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendFrameFromMultiplePorts_142">proc <a href="SendPacket.tcl-annot.html#::::SendFrameFromMultiplePorts">::::SendFrameFromMultiplePorts</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendFrame $args {
      txPortId &#34;1&#34;
      rxPortId &#34;2&#34;
      direction &#34;1Way&#34;
      numFrames &#34;1&#34;
      <a name="::protocol(2)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      frameSize &#34;64&#34;
      frameSizeType &#34;sizeFixed&#34;
      dataPattern &#34;1234&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      percentage &#34;100&#34;
      tag &#34;none&#34;
      applyFilter &#34;0&#34;
      dontTx &#34;0&#34;
   }
   
   <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId txChasisId txCard txPort
   <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $rxPortId rxChasisId rxCard rxPort

   set sendLearn &#34;true&#34;
   set numIxiaCd [<a name="::::GetNumIxiaCd(2)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $rxPortId] 
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
  
   if {$txCard &lt;= $rxCard} {set startCardNum $txCard} else {set startCardNum $rxCard}
   
   <a name="::ixiaConf_groupPorts(1)"><a href="./ePTTx.tcl.html#::ixiaConf_groupPorts_461">::ixiaConf_groupPorts</a></a> -numIxiaCd $numIxiaCd -startCardNum $startCardNum -txPortId $txPortId -rxPortId $rxPortId \
                       -sendLearn $sendLearn -applyFilter $applyFilter -protocol $protocol \
                       -numFrames $numFrames -frameSize $frameSize -frameSizeType $frameSizeType \
                       -dataPattern $dataPattern -streamType $streamType -fcsError $fcsError \
                       -saMode $saMode -daMode $daMode -dontTx $dontTx \
                       -percentage $percentage -wTag $wTag -tagNo $tag

  if {$streamType != &#34;contPacket&#34; &amp;&amp; $numFrames &gt; 100 &amp;&amp; $dontTx==0} {
    <a name="::ixiaCheckTxDone(2)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $txChasisId $txCard $txPort $numFrames $txPortId
  }    
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendIpFrame</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Used to send ip packets</span>
<span class="comment-line">#     </span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># clearStats &#34;yes&#34;. By default the receive stats on the transmitting port will be cleared. Set this option to &#34;no&#34;</span>
<span class="comment-line"># if you don't want the receive stats of the port ot be cleared</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Retruns the packet sent</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#               set frameSent [SendIpFrame -txPortId 1 -destMac $destmac -sourceIp $srcIp -destIp $destaddr -ttl $ttl];</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendIpFrame_203">proc <a href="SendPacket.tcl-annot.html#::::SendIpFrame">::::SendIpFrame</a></a></strong> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendIpFrame $args {
     <a name="::protocol(3)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ip&#34;
     txPortId &#34;1&#34;
     rxPortId &#34;0&#34;
     sourceMac &#34;default&#34;
     destMac &#34;00 e0 2b 00 00 01&#34;
     sourceIp &#34;127.0.0.1&#34;
     destIp &#34;127.0.0.1&#34;
     gatewayIp &#34;127.0.0.1&#34;
     dIpMask &#34;255.255.255.0&#34;
     sIpMask &#34;255.255.255.0&#34;
     dClass &#34;classC&#34;
     sClass &#34;classC&#34;
     sourcePort &#34;0&#34;
     destPort &#34;0&#34;
     ttl &#34;64&#34;
     goodChecksum &#34;true&#34;
     numFrames &#34;1&#34;
     frameSize &#34;64&#34;
     frameSizeType &#34;sizeFixed&#34;
     frameSizeMAX &#34;1518&#34;
     frameSizeMIN &#34;64&#34;
     ipOptions &#34;&#34;
     frameRate &#34;default&#34;
     frameType &#34;08 00&#34;
     dataPattern &#34;0000&#34;
     streamType &#34;stopStream&#34;
     fcsError &#34;good&#34;
     tag &#34;none&#34;
     tagMode &#34;vIdle&#34;
     tagRepeat &#34;1&#34;
     protocolTagId &#34;null&#34;
     TOS &#34;default&#34;
     userPriority &#34;0&#34;
     percentage &#34;100&#34;
     priority &#34;0&#34;
     saMode &#34;idle&#34;
     daMode &#34;idle&#34;
     saCount &#34;&#34;
     daCount &#34;&#34;
     ipSaMode &#34;ipIdle&#34;
     ipDaMode &#34;ipIdle&#34;
     ipSaCount &#34;&#34;
     ipDaCount &#34;&#34;
     dontFrag &#34;true&#34;
     lastFrag &#34;true&#34; 
     fragmentOffset &#34;0&#34; 
     tcpSynFlag &#34;false&#34;
     tcpFinFlag &#34;false&#34;
     tcpRstFlag &#34;false&#34;
     tcpAckFlag &#34;false&#34;
     tcpPushFlag &#34;false&#34;
     tcpUrgFlag &#34;false&#34;
     tcpSeqNum &#34;0&#34;
     type &#34;8&#34;
     code &#34;0&#34;
     id &#34;0&#34;
     sequence &#34;0&#34;
     direction &#34;1Way&#34;
     maxResponseTime &#34;100&#34;
     groupAddr &#34;224.0.0.1&#34;
     applyFilter &#34;0&#34;
     udfEnable &#34;false&#34;
     udfInitval &#34;00&#34;
     udfOffset &#34;0&#34;
     udfCountertype &#34;c8&#34;
     udfContinuousCount &#34;false&#34;
     protoOffsetEnable &#34;false&#34;
     protoOffset &#34;14&#34;
     userDefTag &#34;&#34;
     clearStats &#34;yes&#34;
     dontTx &#34;0&#34;
   }
   
   set numIxiaCd [<a name="::::GetNumIxiaCd(3)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   <a name="::MapIxiaPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chasisId card port
   if {$rxPortId==0} {
      set rxPortId $txPortId
   }
   <a name="::MapIxiaPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $rxPortId ch c rxPort
   global portMappingList

   set portList [lindex $portMappingList [expr $txPortId-1]]
   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT[lindex $portList 2] [lindex $portList 1] ingresses from portId [lindex $portList 0]&#34;
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   global startCardNum
   set frameSent [<a name="::ixiaConf_2Ports_ip(1)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -numIxiaCd $numIxiaCd \
              -txChas $chasisId -txCard $card -txPort $port -startCardNum $startCardNum \
              -rxChas $ch -rxCard $c -rxPort $rxPort -frameType $frameType \
              -ipProtocol $protocol -sMacAddr $sourceMac -dMacAddr $destMac \
              -sIpAddr $sourceIp -dIpAddr $destIp -dDutIpAddr $gatewayIp -ttl $ttl \
              -pSrcPort $sourcePort -pDstPort $destPort -frameSizeType $frameSizeType \
              -frameSizeMAX $frameSizeMAX -frameSizeMIN $frameSizeMIN \
	      -goodChecksum $goodChecksum -numFrames $numFrames -frameSize $frameSize \
	      -frameRate $frameRate -dataPattern $dataPattern -streamType $streamType \
	      -fcsError $fcsError -wTag $wTag -tagNo $tag -tagNo $tag -tagMode $tagMode -tagRepeat $tagRepeat \
	      -TOS $TOS -userPriority $userPriority -protocolTagId $protocolTagId \
	      -percentage $percentage -priority $priority -ipOptions $ipOptions -direction $direction \
              -saMode $saMode -saCount $saCount -daMode $daMode -daCount $daCount \
              -ipSaMode $ipSaMode -ipSaCount $ipSaCount -ipDaMode $ipDaMode -ipDaCount $ipDaCount \
              -dIpMask $dIpMask sIpMask $sIpMask -dClass $dClass -sClass $sClass \
              -dontFrag $dontFrag -tcpSeqNum $tcpSeqNum -tcpSynFlag $tcpSynFlag -tcpFinFlag $tcpFinFlag \
              -tcpPushFlag $tcpPushFlag -tcpUrgFlag $tcpUrgFlag \
              -tcpRstFlag $tcpRstFlag -tcpAckFlag $tcpAckFlag -sequence $sequence -type $type -code $code \
              -id $id -applyFilter $applyFilter -maxResponseTime $maxResponseTime -groupAddr $groupAddr \
              -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount \
              -clearStats $clearStats -dontTx $dontTx \
              -protoOffsetEnable $protoOffsetEnable -protoOffset $protoOffset \
          -userDefTag $userDefTag -lastFrag $lastFrag -fragmentOffset $fragmentOffset] 
                                  
  if {$streamType != &#34;contPacket&#34; &amp;&amp; $numFrames &gt; 100 &amp;&amp; $dontTx==0} {
    <a name="::ixiaCheckTxDone(3)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $chasisId $card $port $numFrames $txPortId
  }  
  return $frameSent           
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendGnsRequests</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends IPX GNS request for all ethernet types ethernetII, ieee8023, ieee8022, iee8023snap.</span>
<span class="comment-line">#              Internally calls SendIpxFrames to send GNS request</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Retruns the frame sent</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         set packet [SendGnsRequests -txPortId 1 -dNetwork &#34;00 00 12 37&#34; -etherType ieee8022 -sendLearn &#34;true&#34; \</span>
<span class="comment-line">#                     -serverType &#34;00 04&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendGnsRequests_340">proc <a href="SendPacket.tcl-annot.html#::::SendGnsRequests">::::SendGnsRequests</a></a></strong> {args} {
   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendGnsRequests $args {
      txPortId &#34;1&#34;
      dNetwork &#34;00 00 00 00&#34;
      numRequests &#34;1&#34;
      etherType &#34;ethernetII&#34;
      sendLearn &#34;true&#34;
      serverType &#34;4&#34;
      sourceNodeCounterMode &#34;0&#34;
      destNodeCounterMode &#34;0&#34;
   }
   set dNode &#34;FF FF FF FF FF FF&#34;
   set sSocket &#34;socketSap&#34;
   set dSocket &#34;socketSap&#34;
   set udfCounterType &#34;c32&#34;
   regsub -all &#34; &#34; [format %04s [string trimleft $serverType &#34; 0&#34;]] &#34;0&#34; serverType
   set udfInitVal &#34;00 03 [string range $serverType 0 1] [string range $serverType 2 3]&#34;
   switch -- $etherType {
      &#34;ethernetII&#34; -
      &#34;ieee8023&#34; {
         set udfOffset &#34;44&#34;
      }
      &#34;ieee8022&#34; {
         <span class="comment-line"># These changes are required since IXIA Gbic does not support udf on odd numbers</span>
         <span class="comment-line"># Kludge to start udf1 from 46 and udf2 from 50.</span>
         set udfOffset &#34;46&#34;   ;<span class="comment-line"># used to be 47</span>
         set udfInitVal &#34;52 00 03 [string range $serverType 0 1] [string range $serverType 2 3]&#34;
      }
      &#34;ieee8023snap&#34; {
         set udfOffset &#34;52&#34;
      }
      default {
         <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;unknown etherType: $etherType&#34;
         return -1;
      }
   }
   set frameSent [<a name="::SendIpxFrames(1)"><a href="./SendPacket.tcl.html#::SendIpxFrames_409">::SendIpxFrames</a></a> -txPortId $txPortId -etherType $etherType \
              -dNetwork $dNetwork -dSocket $dSocket -dNode $dNode -sSocket $sSocket \
              -sendLearn $sendLearn -enableUdf &#34;true&#34; -numFrames $numRequests \
              -sourceNodeCounterMode $sourceNodeCounterMode \
              -destNodeCounterMode $destNodeCounterMode \
              -udfOffset $udfOffset -udfCounterType $udfCounterType -udfInitVal &#34;$udfInitVal&#34;]

   return $frameSent   
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendIpxFrames</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends IPX packets for all ethernet types ethernetII, ieee8023, ieee8022, iee8023snap.</span>
<span class="comment-line">#              Internally calls SendIpxFrames to send GNS request</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Retruns the frame sent</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#  set packet [SendIpxFrames -txPortId $txPortId -rxPortId 9 -sNetwork &#34;00 00 $txPortNw&#34; \</span>
<span class="comment-line">#               -sSocket &#34;socketRipx&#34;  -dNetwork $ixiaFormattedNw -dNode &#34;00 A3 F1 00 00 01&#34; \</span>
<span class="comment-line">#               -etherType $etherProto -sendLearn &#34;true&#34; \</span>
<span class="comment-line">#               -dSocket &#34;socketRipx&#34; -packetType &#34;typeNcp&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendIpxFrames_409">proc <a href="SendPacket.tcl-annot.html#::::SendIpxFrames">::::SendIpxFrames</a></a></strong> {args} {
   <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendIpxFrames $args {
      direction &#34;1Way&#34;
      txPortId &#34;1&#34;
      rxPortId &#34;0&#34;
      etherType &#34;ethernetII&#34;
      rxProto &#34;ethernetII&#34;
      sNetwork &#34;00 00 00 00&#34;
      sSocket &#34;4000&#34;
      dNetwork &#34;00 00 00 00&#34;
      sNode &#34;00 00 00 00 00 00&#34;
      dNode &#34;00 00 00 00 00 00&#34;
      dSocket &#34;4000&#34;
      packetType &#34;typeUnknown&#34;
      numFrames &#34;1&#34;
      frameSize &#34;64&#34;
      frameRate &#34;default&#34;
      dataPattern &#34;0000&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      tag &#34;none&#34;
	   tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
	   tagRepeat &#34;1&#34;
	   userPriority &#34;0&#34;
      percentage &#34;100&#34;
      priority &#34;0&#34;
      sendLearn &#34;true&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      chid &#34;1&#34;
      enableUdf &#34;false&#34;
      udfOffset &#34;52&#34;
      udfCounterType &#34;c32&#34;
      udfInitVal &#34;08 00&#34;
      sourceNodeCounterMode &#34;0&#34;
      destNodeCounterMode &#34;0&#34;

   }

   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   set frameSent [<a name="::ixia_SendIpxPackets(1)"><a href="./IpxUtil.tcl.html#::ixia_SendIpxPackets_288">::ixia_SendIpxPackets</a></a> -direction $direction -txPortId $txPortId -rxPortId $rxPortId \
              -etherType $etherType -sNetwork $sNetwork -sSocket $sSocket -sNode $sNode \
              -dNetwork $dNetwork -dSocket $dSocket -dNode $dNode -rxProto $rxProto \
              -packetType $packetType -numFrames $numFrames -frameSize $frameSize \
              -frameRate $frameRate -dataPattern $dataPattern -streamType $streamType \
              -fcsError $fcsError -wTag $wTag -tagNo $tag -tagCfi $tagCfi \
              -sourceNodeCounterMode $sourceNodeCounterMode \
              -destNodeCounterMode $destNodeCounterMode \
              -tagMode $tagMode -tagRepeat $tagRepeat -userPriority $userPriority \
              -percentage $percentage -priority $priority -sendLearn $sendLearn \
              -saMode $saMode -daMode $daMode -chid $chid -enableUdf $enableUdf \
              -offset $udfOffset -counterType $udfCounterType -initVal $udfInitVal]
  return $frameSent
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendIgmpFrame</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends IGMP join/leave packet based on argument type</span>
<span class="comment-line">#</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Retruns the frame sent</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#        set frameSent [SendIgmpFrame -txPortId $txPortId -type $joinGroup -destMac $destMacMulticast \</span>
<span class="comment-line">#                        -sourceIp $clientIP1   -destIp $multicastIP -groupAddr $multicastIP ]</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendIgmpFrame_485">proc <a href="SendPacket.tcl-annot.html#::::SendIgmpFrame">::::SendIgmpFrame</a></a></strong> {args} {
   <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendIgmpFrame $args {
     txPortId &#34;1&#34;
     sourceMac &#34;default&#34;
	  destMac &#34;default&#34;
	  sourceIp &#34;127.0.0.1&#34;
	  destIp &#34;127.0.0.1&#34;
	  ttl &#34;1&#34;
            TOS &#34;default&#34;
            priority &#34;0&#34;
            userPriority &#34;0&#34;
     numFrames &#34;1&#34;
     frameSize &#34;64&#34;
     dontFrag &#34;true&#34;
     ipTotalLength &#34;default&#34;
     ipDaMode &#34;ipIdle&#34;
     ipDaCount &#34;&#34;
	  tag &#34;none&#34;
	  type &#34;22&#34;
	  maxResponseTime &#34;100&#34;
	  groupAddr &#34;224.0.0.1&#34;
        igmpMode &#34;Fixed&#34;
        igmpRepeatCount &#34;&#34;
	  goodChecksum &#34;true&#34;
     streamType &#34;stopStream&#34;
     frameRate &#34;default&#34;
     udfEnable &#34;false&#34;
     udfInitval &#34;00&#34;
     udfOffset &#34;0&#34;
     udfCountertype &#34;c8&#34;
     udfContinuousCount &#34;false&#34;
     dataPattern &#34;0000&#34;	 
     srcIpMask &#34;255.255.255.0&#34;
     dstIpMask &#34;255.255.255.0&#34; 
     lengthOverride &#34;&#34;
   }
   global portMappingList

   if {$ipTotalLength == &#34;default&#34;} {
       if {$tag!=&#34;none&#34;} {
       set MACHeaderLength &#34;22&#34;
       } else {
       set MACHeaderLength &#34;18&#34;
       }
       set ipTotalLength [expr $frameSize - $MACHeaderLength]
   }


   set portList [lindex $portMappingList [expr $txPortId-1]]
   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT[lindex $portList 2] [lindex $portList 1] ingresses from portId [lindex $portList 0]&#34;
   <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sending a igmp ($type) on portId $txPortId to group $destIp&#34;
   if {$destMac == &#34;default&#34;} {
      set destMac [<a name="::GetMulticastMac(1)"><a href="./misc.tcl.html#::GetMulticastMac_605">::GetMulticastMac</a></a> $destIp]
   }
   set numIxiaCd [<a name="::::GetNumIxiaCd(4)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   <a name="::MapIxiaPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chasisId card port
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   global startCardNum
   set frameSent [<a name="::ixiaConf_2Ports_ip(2)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -numIxiaCd $numIxiaCd \
              -txChas $chasisId -txCard $card -txPort $port -startCardNum $startCardNum \
              -rxChas $chasisId -rxCard $card -rxPort $port -streamType $streamType \
              -ipProtocol &#34;igmp&#34; -sMacAddr $sourceMac -dMacAddr $destMac -frameRate $frameRate \
              -sIpAddr $sourceIp -dIpAddr $destIp -ttl $ttl -goodChecksum $goodChecksum \
              -ipDaMode $ipDaMode -ipDaCount $ipDaCount -igmpMode $igmpMode -igmpRepeatCount $igmpRepeatCount \
	      -numFrames $numFrames -frameSize $frameSize -wTag $wTag -tagNo $tag -type $type -dataPattern $dataPattern \
              -maxResponseTime $maxResponseTime -groupAddr $groupAddr -ipTotalLength $ipTotalLength \
              -dontFrag $dontFrag -sIpMask $srcIpMask -dIpMask $dstIpMask\
           -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount -lengthOverride $lengthOverride -TOS $TOS -priority $priority -userPriority $userPriority]
   <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;IGMPSent: $frameSent&#34;
   return $frameSent
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendArpFrame</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends ARP packet from txPortId to rxPortId</span>
<span class="comment-line">#</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Retruns the frame sent</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          set frameSent [SendArpFrame -txPortId $portIdTx -sourceIp $srcIp -destIp $destIp -numFrames $nArpFrames];</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendArpFrame_577">proc <a href="SendPacket.tcl-annot.html#::::SendArpFrame">::::SendArpFrame</a></a></strong> {args} {
   <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendArpFrame $args {
     txPortId &#34;1&#34;
     type &#34;arpRequest&#34;
     sourceMac &#34;default&#34;
     destMac &#34;ff ff ff ff ff ff&#34;
     saMode &#34;idle&#34;
     daMode &#34;idle&#34;
     sourceIp &#34;127.0.0.1&#34;
     destIp &#34;127.0.0.1&#34;
     arpSaMode &#34;arpIdle&#34;
     arpDaMode &#34;arpIdle&#34;
     numFrames &#34;1&#34;
     frameSize &#34;64&#34;
     frameRate &#34;default&#34;
     streamType &#34;stopStream&#34;
     srcHwAddr &#34;default&#34;
     destHwAddr &#34;default&#34;
     srcHwAddrMode &#34;arpIdle&#34;
     srcHwAddrRepeat &#34;1&#34;
     destHwAddrMode &#34;arpIdle&#34;
     destHwAddrRepeat &#34;1&#34;
     tag &#34;none&#34;
     arpSaRepeat &#34;1&#34;
     arpDaRepeat &#34;1&#34;
     percentage &#34;0.01&#34;
     udfEnable &#34;false&#34;
     udfInitval &#34;00&#34;
     udfOffset &#34;0&#34;
     udfCountertype &#34;c8&#34;
     udfContinuousCount &#34;false&#34;
     dontTx &#34;0&#34;
   }
   
   global portMappingList

   set portList [lindex $portMappingList [expr $txPortId-1]]
   <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT[lindex $portList 2] [lindex $portList 1] ingresses from portId [lindex $portList 0]&#34;
   set numIxiaCd [<a name="::::GetNumIxiaCd(5)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   set rxPo [<a name="::MapIxiaPortId(9)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chasisId card port]
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   global startCardNum
   return [<a name="::ixiaConf_2Ports_arp(1)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_arp_582">::ixiaConf_2Ports_arp</a></a> -numIxiaCd $numIxiaCd \
              -txChas $chasisId -txCard $card -txPort $port -startCardNum $startCardNum \
              -rxChas $chasisId -rxCard $card -rxPort $port -frameRate $frameRate \
              -operation $type -sMacAddr $sourceMac -dMacAddr $destMac \
              -sIpAddr $sourceIp -dIpAddr $destIp -numFrames $numFrames \
	      -saMode $saMode -daMode $daMode -srcHwAddr $srcHwAddr -destHwAddr $destHwAddr \
	      -destHwAddrMode $destHwAddrMode -destHwAddrRepeat $destHwAddrRepeat \
	      -wTag $wTag -tagNo $tag -frameSize $frameSize -streamType $streamType \
	      -arpSaMode $arpSaMode -arpDaMode $arpDaMode -percentage $percentage \
	      -arpSaRepeat $arpSaRepeat -arpDaRepeat $arpDaRepeat -srcHwAddrMode $srcHwAddrMode \
              -srcHwAddrRepeat $srcHwAddrRepeat -dontTx $dontTx -udfEnable $udfEnable \
              -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype \
              -udfContinuousCount $udfContinuousCount]
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendDhcpFrame</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends DHCP frame from txPortId to rxPortId</span>
<span class="comment-line">#</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#      - &lt;txPortId&gt;   - Sending portId</span>
<span class="comment-line">#      - &lt;sourceMac&gt;  - source Mac</span>
<span class="comment-line">#      - &lt;destMac&gt;    - destination Mac</span>
<span class="comment-line">#      - &lt;sourceIp&gt;   - source IP address</span>
<span class="comment-line">#      - &lt;destIp&gt;     - destination IP address           </span>
<span class="comment-line">#      - &lt;numFrames&gt;  - how many to send</span>
<span class="comment-line">#      - &lt;streamType&gt; - how to send the frame</span>
<span class="comment-line">#      - &lt;clientHwAddr&gt; - gateway mac</span>
<span class="comment-line">#      - &lt;opcode&gt;     - DHCP code</span>
<span class="comment-line">#      - &lt;optionCodeList&gt; - DHCP option</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Retruns the frame sent</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          set frameSent [SendArpFrame -txPortId $portIdTx -sourceIp $srcIp -destIp $destIp -numFrames $nArpFrames];</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendDhcpFrame_663">proc <a href="SendPacket.tcl-annot.html#::::SendDhcpFrame">::::SendDhcpFrame</a></a></strong> {args} {
   <a name="::parse_args(8)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendDhcpFrame $args {
     txPortId &#34;1&#34;
     sourceMac &#34;default&#34;
     destMac &#34;00 e0 2b 00 00 01&#34;
     sourceIp &#34;127.0.0.1&#34;
     destIp &#34;127.0.0.1&#34;
     sourcePort &#34;0&#34;
     destPort &#34;0&#34;
     numFrames &#34;1&#34;
     streamType &#34;stopStream&#34;
     fcsError &#34;good&#34;
     saMode &#34;idle&#34;
     daMode &#34;idle&#34;
     maxResponseTime &#34;100&#34;
     clientHwAddr &#34;00 00 86 52 55 CB&#34;
     clientIpAddr &#34;0.0.0.0&#34;
     yourIpAddr &#34;0.0.0.0&#34;
     opCode &#34;dhcpBootRequest&#34;
     optionCodeList &#34;{dhcpMessageType dhcpDiscover}&#34;
     tag &#34;none&#34;
     dontTx &#34;0&#34;
   }
   global portMappingList

   set portList [lindex $portMappingList [expr $txPortId-1]]
   <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT[lindex $portList 2] [lindex $portList 1] ingresses from portId [lindex $portList 0]&#34;

   
   global portMappingList

   set portList [lindex $portMappingList [expr $txPortId-1]]
   <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT[lindex $portList 2] [lindex $portList 1] ingresses from portId [lindex $portList 0]&#34;
   set numIxiaCd [<a name="::::GetNumIxiaCd(6)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   set rxPo [<a name="::MapIxiaPortId(10)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chasisId card port]
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   
   global startCardNum
   set frameSent [<a name="::ixiaConf_2Ports_Dhcp(1)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_Dhcp_337">::ixiaConf_2Ports_Dhcp</a></a> -numIxiaCd $numIxiaCd \
              -txChas $chasisId -txCard $card -txPort $port -startCardNum $startCardNum \
              -rxChas $chasisId -rxCard $card -rxPort $rxPo \
              -sMacAddr $sourceMac -dMacAddr $destMac -sIpAddr $sourceIp -dIpAddr $destIp \
	      -srcPort $sourcePort -dstPort $destPort -numFrames $numFrames -streamType $streamType -fcsError $fcsError \
	      -saMode $saMode -daMode $daMode -opCode $opCode \
	      -optionCodeList $optionCodeList -clientHwAddr $clientHwAddr \
	      -clientIpAddr $clientIpAddr -yourIpAddr $yourIpAddr -wTag $wTag -tagNo $tag -dontTx $dontTx]
                    
   if {$streamType != &#34;contPacket&#34; &amp;&amp; $numFrames &gt; 100 &amp;&amp; $dontTx==0} {
     <a name="::ixiaCheckTxDone(4)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $chasisId $card $port $numFrames $txPortId
   }    
   return $frameSent           
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendArpRequest</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends ARP request from ixPortId for a given IP address. It returns the</span>
<span class="comment-line">#              replier mac address</span>
<span class="comment-line">#</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#      - &lt;txPortId&gt; - Sending portId</span>
<span class="comment-line">#      - &lt;myIp&gt; - source Ip address</span>
<span class="comment-line">#      - &lt;requestIp&gt; - destination Ip address</span>
<span class="comment-line">#      - &lt;rxPortId&gt; - optional receiving portId. Will enable protocol server</span>
<span class="comment-line">#                     on this port if greater than 0, so it can reply to arp request</span>
<span class="comment-line">#      - &lt;numTries&gt; - maximum number of tries before quiting and return</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - return the target MAC address if there is a reply, otherwise</span>
<span class="comment-line">#        &#34;NO_ARP_REPLY&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          set frameSent [SendArpRequest $rxPortId $destIp &#34;194.1.1.1&#34; -numTries &#34;2&#34;];</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendArpRequest_745">proc <a href="SendPacket.tcl-annot.html#::::SendArpRequest">::::SendArpRequest</a></a></strong> {txPortId myIp requestIp {tag &#34;none&#34;} {rxPortId 0} {numTries 2} {returnFrame 0}} {

   if {$rxPortId &gt; 0} {
      <span class="comment-line"># Instead of the DUT replying to ARP requests, the caller wants the IXIA to reply.</span>
      <a name="::SaveAndSetProtocolServer(1)"><a href="./ixiaProtSrv.tcl.html#::SaveAndSetProtocolServer_1235">::SaveAndSetProtocolServer</a></a> $rxPortId $requestIp $requestIp ixInfo -arpService true;
   } else {
      <span class="comment-line"># With certain types of IXIA cards (e.g. LM1000T-5 running at 1 Gbps), if a</span>
      <span class="comment-line"># protocol server is enabled, packets destined for that protocol server won't be</span>
      <span class="comment-line"># available in the capture buffer.  Instead, they get returned as &#34;blank&#34; frames</span>
      <span class="comment-line"># to IXIA's TCL HAL.  Since this function relies on ARP replies being in the</span>
      <span class="comment-line"># capture buffer, the ARP protocol server will be temporarily disabled.</span>
      <span class="comment-line">#SaveAndSetProtocolServer $txPortId $requestIp $requestIp ixInfo -arpService false;</span>
      <a name="::SaveAndSetProtocolServer(2)"><a href="./ixiaProtSrv.tcl.html#::SaveAndSetProtocolServer_1235">::SaveAndSetProtocolServer</a></a> $txPortId $myIp  $requestIp ixInfo -arpService false;
   }
   <a name="::StartPortsCapture(1)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $txPortId;

   <span class="comment-line"># GV 05-06-2011: Sleep needed here for some Ixia's before sending traffic</span>
   <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2;

   for {set index 0} {$index &lt; $numTries} { incr index } {
      set frameSent [<a name="::SendArpFrame(1)"><a href="./SendPacket.tcl.html#::SendArpFrame_577">::SendArpFrame</a></a> -txPortId $txPortId -sourceIp $myIp -destIp $requestIp -tag $tag];
      <span class="comment-line"># Ecooper change</span>
      <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleeping for 500 ms.&#34;;
      after 500;
      <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sending an arp request to $requestIp from $myIp on portId $txPortId:&#34;;
      <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;;
      set receivedList [<a name="::GetCapturedFrames(1)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $txPortId];
      foreach frameReceived $receivedList {
         <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frames received on portId $txPortId:&#34;;
         <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameReceived&#34;;
         set messageType [<a name="::GetMessageType(1)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $frameReceived];
         if {$messageType == &#34;ARP_REPLY&#34; } {
            <span class="comment-line">#assume the reply is for us</span>
            <a name="::RestoreSavedProtocolServer(1)"><a href="./ixiaProtSrv.tcl.html#::RestoreSavedProtocolServer_1346">::RestoreSavedProtocolServer</a></a> ixInfo;
            set mac [<a name="::GetSenderMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSenderMacAddress_62">::GetSenderMacAddress</a></a> $frameReceived];
            <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Got an arp reply from $requestIp ($mac) on [expr $index + 1] tries&#34;;
            if {$returnFrame == 1} {
                return $frameReceived;
            } else {
                return $mac;
            }
         } elseif {$messageType == &#34;ARP_REQUEST&#34; } {
            <span class="comment-line">#this is done specifically for multinetting on BD, since the BD</span>
            <span class="comment-line">#will send out and arp request in response to an arp request</span>
            <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SourceIp: [<a name="::GetSourceIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frameReceived] DestIp: [<a name="::GetDestIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameReceived]&#34;;
            set mac [<a name="::GetSourceMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameReceived];
            set frameSent [<a name="::SendArpFrame(2)"><a href="./SendPacket.tcl.html#::SendArpFrame_577">::SendArpFrame</a></a> -txPortId $txPortId -destMac $mac -type &#34;arpReply&#34; \
                          -sourceIp $myIp -destIp $requestIp -tag $tag];
            <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Got an arp request. Sending an arp reply to $requestIp:&#34;;
            <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;;
         }
      }
   }
   <a name="::RestoreSavedProtocolServer(2)"><a href="./ixiaProtSrv.tcl.html#::RestoreSavedProtocolServer_1346">::RestoreSavedProtocolServer</a></a> ixInfo;
   <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No arp reply after $numTries tries for $requestIp&#34;;
   return &#34;NO_ARP_REPLY&#34;;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendFrameToOtherPort</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends IP packets from txPortId to rxPortId and checks for </span>
<span class="comment-line">#              number of packet sent equals number of packet received.</span>
<span class="comment-line">#</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#      - &lt;txPortId&gt;   - Sending portId</span>
<span class="comment-line">#      - &lt;rxPortId&gt;   - Receiving portId</span>
<span class="comment-line">#      - &lt;destMac&gt;    - Destination mac address</span>
<span class="comment-line">#      - &lt;sourceIp&gt;   - Source IP Address</span>
<span class="comment-line">#      - &lt;destIp&gt;     - Destination IP Address      </span>
<span class="comment-line">#      - &lt;percentage&gt; - Percentage of the line rate to be sent default 100         </span>
<span class="comment-line">#      - &lt;destPort&gt;   - Port number of destination </span>
<span class="comment-line">#      - &lt;frameSize&gt;  - Size of the package</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          SendFrameToOtherPort -txPortId 1 -rxPortId 8 -destMac $dut1mac \</span>
<span class="comment-line">#                     -sourceIp &#34;10.10.1.17&#34; -destIp &#34;10.20.1.2&#34; \</span>
<span class="comment-line">#                     -destPortnumber 80 -frameSize &#34;120&#34; -protocol $protocol</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendFrameToOtherPort_836">proc <a href="SendPacket.tcl-annot.html#::::SendFrameToOtherPort">::::SendFrameToOtherPort</a></a></strong> {args} {
   <a name="::parse_args(9)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendFrameToOtherPort $args {
      txPortId &#34;1&#34;
      rxPortId &#34;0&#34;
      destMac &#34;default&#34;
      sourceIp &#34;127.0.0.1&#34;
      destIp &#34;127.0.0.1&#34;
      percentage &#34;100&#34;
      destPortnumber &#34;0&#34;
      srcPortnumber &#34;0&#34;
      <a name="::protocol(4)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;tcp&#34;
      frameSize &#34;64&#34;
      dataPattern &#34;0102030405&#34;
      flag &#34;no&#34;
   }   

   <span class="comment-line"># ----- Environment variables setup</span>
   global DUTs_info;
   global DUT1_CONNECT;
   global DUT2_CONNECT;

   <span class="comment-line"># ----- Test variables setup</span>
   set txport $txPortId;
   set rxport $rxPortId;

   set dip $destIp;
   set srip $sourceIp; 

   <span class="comment-line"># ----- send a stream of IP frames</span>
   <span class="comment-line"># Send 10,000 frames at the begining because of the problem</span>
   if {$flag == &#34;yes&#34;} {
       set frameSent [<a name="::SendIpFrame(1)"><a href="./SendPacket.tcl.html#::SendIpFrame_203">::SendIpFrame</a></a> -protocol $protocol -txPortId $txport -destMac $destMac \
                  -destIp $dip -sourceIp $srip -dataPattern $dataPattern \
                  -numFrames 10000 -percentage $percentage -destPort $destPortnumber \
                  -sourcePort $srcPortnumber -frameSize $frameSize];                     
      sleep 5
   }
   
   <a name="::ClearPortsStats(1)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> &#34;$txport $rxport&#34;;
   set frameSent [<a name="::SendIpFrame(2)"><a href="./SendPacket.tcl.html#::SendIpFrame_203">::SendIpFrame</a></a> -protocol $protocol -txPortId $txport -destMac $destMac \
                  -destIp $dip -sourceIp $srip -dataPattern $dataPattern \
                  -numFrames 100000 -percentage $percentage -destPort $destPortnumber \
                  -sourcePort $srcPortnumber -frameSize $frameSize];         
   sleep 5;               
   <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;frame($protocol) sent: $frameSent&#34;;
   set numSent [<a name="::GetNumFramesSent(1)"><a href="./ePTRx.tcl.html#::GetNumFramesSent_1324">::GetNumFramesSent</a></a> $txport];
   set numRece [<a name="::GetNumFramesReceived(1)"><a href="./ePTRx.tcl.html#::GetNumFramesReceived_1346">::GetNumFramesReceived</a></a> $rxport];

   if {$numSent &gt; $numRece} {
       set diff [expr (100 - (($numRece * 100)/$numSent))];
   } else {
       set diff 0;
   }    
   set percent 4;
   <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No. Sent = $numSent : Received = $numRece : Percent = $diff&#34;;  
   if {$diff &lt;= $percent} {
       <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;No. of sent frames = $numSent and recieved frames = $numRece&#34;;
       <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;No. of sent frames = $numSent and recieved frames = $numRece&#34;;
   } else {
       <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Warning: No. of sent frames &lt;$numSent&gt; is different than recieved frames &lt;$numRece&gt;&#34;;   
       <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Warning: No. of sent frames &lt;$numSent&gt; is different than recieved frames &lt;$numRece&gt;&#34;;   
   } 
   <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: biSendFrame</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sends bidirectional mac frame from a txPortId to rxPortId</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: txPortId, rxPortId, protocol, protocol, sourceMac, destMac, numFrames</span>
<span class="comment-line">#             frameSize, frameSizeType, dataPattern, streamType, fcsError, saMode, daMode</span>
<span class="comment-line">#             percentage, tag, tagPriority, frameRate</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             biSendFrame $txPortId</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::biSendFrame_917">proc <a href="SendPacket.tcl-annot.html#::::biSendFrame">::::biSendFrame</a></a></strong> {args} {
   <a name="::parse_args(10)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendFrame $args {
      txPortId &#34;1&#34;
      rxPortId &#34;0&#34;
      <a name="::protocol(5)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      sourceMac &#34;default&#34;
      destMac &#34;default&#34;
      numFrames &#34;1&#34;
      frameSize &#34;64&#34;
      frameSizeType &#34;sizeFixed&#34;
      dataPattern &#34;1234&#34;
      frameType &#34;08 00&#34;
      ethernetType &#34;noType&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      saCount &#34;&#34;
      daCount &#34;&#34;
      percentage &#34;100&#34;
      tag &#34;none&#34;
      tagPriority &#34;0&#34;	      
      frameRate &#34;null&#34;
      direction &#34;2Way&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat 1
      dontTx &#34;0&#34;

   }
   
   <a name="::MapIxiaPortId(11)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId txChasisId txCard txPort
   if {$rxPortId == 0} {
      set sendLearn &#34;false&#34;
      set rxPort [<a name="::MapIxiaPortId(12)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId rxChasisId rxCard rxPo]
   } else {
      set sendLearn &#34;true&#34;
      <a name="::MapIxiaPortId(13)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $rxPortId rxChasisId rxCard rxPort
   }
   
   set numIxiaCd [<a name="::::GetNumIxiaCd(7)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   global startCardNum
   set frameSent [<a name="::ixiaConf_2Ports(2)"><a href="./ePTTx.tcl.html#::ixiaConf_2Ports_690">::ixiaConf_2Ports</a></a> -numIxiaCd $numIxiaCd -rate $frameRate \
                  -txChas $txChasisId -txCard $txCard -txPort $txPort \
		  -startCardNum $startCardNum -rxChas $rxChasisId \
		  -rxCard $rxCard -rxPort $rxPort -sendLearn $sendLearn \
		  -frameType $frameType -ethernetType $ethernetType \
                  -protocol $protocol -numFrames $numFrames \
		  -frameSize $frameSize -frameSizeType $frameSizeType \
                  -dataPattern $dataPattern -streamType $streamType \
		  -fcsError $fcsError -inSaMac $sourceMac -saMode $saMode \
		  -inDaMac $destMac -daMode $daMode -percentage $percentage \
		  -wTag $wTag -tagNo $tag -tagPriority $tagPriority \
                  -tagMode $tagMode -tagRepeat $tagRepeat -direction $direction \
                  -saCount $saCount -daCount $daCount -dontTx $dontTx ]
   if {$streamType != &#34;contPacket&#34; &amp;&amp; $numFrames &gt; 100 &amp;&amp; $dontTx==0} {
       <a name="::ixiaCheckTxDone(5)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $txChasisId $txCard $txPort $numFrames $txPortId
   }
  return $frameSent            
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
