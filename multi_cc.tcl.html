<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>multi_cc.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#multi_cc.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>multi_cc.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="multi_cc.tcl-annot.html">annotations</a> | <a href="multi_cc.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>

<span class="comment-line">#########################   SETUP MAIN   #################################</span>
source /auto/automation/Util/runReg.cfg
source /auto/automation/Lib/mysqlLib.tcl
global curAutoRoot
global DUTs_info

source ../Lib/mainLib.tcl
package require Tclx

load [lindex [glob &#34;/usr/lib/libexpect*so*&#34;] 0]

set curLocation [pwd]
set curDirList [split [string trim [string trim $curLocation &#34;..&#34;] &#34;/&#34;] &#34;/&#34;]
set v 0;
set pathList &#34;&#34;
set curAutoRoot &#34;&#34;
set skipCC 0
foreach cd $curDirList {
    if {$cd == &#34;main&#34; || $cd == &#34;Lib&#34; || $cd == &#34;Util&#34;} {
        for {set x 0} {$x&lt;$v} {incr x} {
            lappend pathList [lindex $curDirList $x]
        }
        set curAutoRoot &#34;/[join $pathList &#34;/&#34;]&#34;
    } else {
        incr v;
    }
}
puts &#34;CURRENT PATH: $curAutoRoot&#34;
set cDir [file tail [pwd]]
set LIB_PATH &#34;./../Lib&#34;
lappend auto_path $LIB_PATH
puts &#34;DEBUG: Appending $LIB_PATH to autopath:$auto_path&#34;

<a name="::::gen_index(1)"><a href="./summarize.tcl.html#::::gen_index_76">::::gen_index</a></a> &#34;./../Lib&#34;

<span class="comment-line">#source the local lib until it gets moved to lib</span>
source ./regtoolsLib.tcl

<strong><a name="::::print_usage_41">proc <a href="multi_cc.tcl-annot.html#::::print_usage">::::print_usage</a></a></strong> {} {
    puts &#34;\r&#34;
    puts {Usage: multi_cc.tcl -cfg &lt;config file&gt; }
    puts {   &lt;inCfgs&gt;: Path of the config file name }
    puts &#34;\r&#34;
}

<span class="comment-line"># checking command parameters</span>
if {$argc&lt;0} {
      puts &#34;Not enough parameters&#34;
      <a name="::::print_usage(1)"><a href="./summarize.tcl.html#::::print_usage_2">::::print_usage</a></a>
      return
}

<a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> multi_cc $argv {
      inCfgs    &#34;&#34;
}

set cfgFile &#34;&#34;
set numList &#34;&#34;
<span class="comment-line">## ----------------------------------------------------------------</span>
<span class="comment-line">##   Main </span>
<span class="comment-line">## ----------------------------------------------------------------</span>
fconfigure stdin -blocking 1
set chInts &#34;1 2&#34;
if {[regexp -nocase &#34;rdureg|salemreg&#34; $HOST]} {
    set choice &#34;1&#34;
    set ch(1) &#34;RDUREG/SALEMREG&#34;
    set ch(2) &#34;RDU Automation&#34;
    set chStr(1) &#34;swdev&#34;
    set chStr(2) &#34;Production&#34;
} elseif {[regexp -nocase &#34;autoregrdu&#34; $HOST]} {
    set choice &#34;1&#34;
    set ch(1) &#34;RDU Automation&#34;
    set ch(2) &#34;RDUREG/SALEMREG&#34;
    set chStr(1) &#34;Production&#34;
    set chStr(2) &#34;swdev&#34;
} else {
    set choice &#34;1&#34;
    set ch(1) &#34;RDUREG/SALEMREG&#34;
    set ch(2) &#34;RDU Automation&#34;
    set chStr(1) &#34;swdev&#34;
    set chStr(2) &#34;Production&#34;
}
while {1} {
    puts &#34;\n\n&#34;;
    puts &#34;Harness to run:&#34;
    foreach x $chInts {
        puts &#34;$x = $ch($x)&#34;
    }
    puts -nonewline &#34;What harness are you running in &lt;cr&gt;=default \[$choice\]: &#34;;
    flush stdout;
    gets stdin userChoice;
    if {$userChoice==&#34;&#34;} {
       set userChoice $choice
    }
    if {[lsearch $chInts $userChoice] &gt;=0} {
       puts &#34;You are running on: $ch($userChoice)&#34;;
       set server $chStr($userChoice);
       break;
    } else {
       puts &#34;Error: You must choose either \[join $chInts ' or ']&#34;;
       continue;
    }
}
if {$server == &#34;swdev&#34;} {
    set cfgList [<a name="::getlocked(1)"><a href="./regtoolsLib.tcl.html#::getlocked_469">::getlocked</a></a>]
    set cfgList [<a name="::swsharedbeds(1)"><a href="./regtoolsLib.tcl.html#::swsharedbeds_300">::swsharedbeds</a></a> $cfgList]
    <span class="comment-line">#puts &#34;$server Locked List $cfgList&#34;</span>
    set cfgList [<a name="::NumberedMenu(1)"><a href="./menu.tcl.html#::NumberedMenu_2">::NumberedMenu</a></a> -head &#34;Available Test Beds&#34; \
                -question1 &#34;Select test beds to run check connections on&#34; \
                -choices $cfgList \
                -menuWidth        75 \
                -keyWidth         3 \
                -headerPadChar    &#34;=&#34; \
                -chAppendList     &#34;null&#34; \
                -chPrependList    &#34;null&#34; \
                -barChar          &#34;-&#34; \
                -clearXterm       &#34;yes&#34; \
                -clearXtermInfo   &#34;&#34; ]
} else {
    while {1} {
        puts &#34;\n\n&#34;;
        set choice &#34;Yes&#34;
        puts &#34;&#34;
        puts -nonewline &#34;Only show one shared beds \[$choice\]: &#34;;
        flush stdout;
        gets stdin userChoice;
        if {$userChoice==&#34;&#34;} {
            set userChoice $choice
        }
        if {[regexp -nocase &#34;y&#34; $userChoice]} {
            set skipShare &#34;Yes&#34;
            break;
        } else {
            set skipShare &#34;No&#34;
            break;
        }
    }
    while {1} {
        puts &#34;\n\n&#34;;
        set choice &#34;21.1&#34;
        puts &#34;&#34;
        puts -nonewline &#34;Enter a release to filter test beds \[$choice\]: &#34;;
        flush stdout;
        gets stdin userChoice;
        if {$userChoice==&#34;&#34;} {
            set userChoice $choice
        }
        if {[regexp -nocase -all &#34;\[1-9]{2,2}\.\[1-9]{1,1}(\.\[0-9]+\.\[1-9]+)?&#34; $userChoice]} {
            set rel $userChoice
            set cfgList [<a name="::get_test_beds(1)"><a href="./regtoolsLib.tcl.html#::get_test_beds_499">::get_test_beds</a></a> $userChoice $skipShare];
            break;
        } else {
            puts &#34;Error: Your choice must be in the format 21.1&#34;;
            continue;
        }
    }
    while {1} {
        puts &#34;&#34;;
        set choice &#34;No&#34;
        puts &#34;&#34;
        puts &#34;HIT ENTER TO SKIP&#34;
        puts -nonewline &#34;Regex filter on cfg and owner.  Enter the string '440_G|450_G|620|mix'\[$choice\]: &#34;;
        flush stdout;
        gets stdin userChoice;
        if {$userChoice==&#34;&#34;} {
            set userChoice $choice
        }
        if {[regexp -nocase &#34;^n|^no&#34; $userChoice]} {
            <span class="comment-line">#puts &#34;return nothing&#34;</span>
            break;
        } else {
            set newCList [<a name="::get_filtered_test_beds(1)"><a href="./regtoolsLib.tcl.html#::get_filtered_test_beds_563">::get_filtered_test_beds</a></a> $cfgList $userChoice]
            if {[llength $newCList] &lt;= 0} {
                puts &#34;No match.  Using the entire release based cfg file list&#34;
                break;
            } else {
                set cfgList $newCList;
                break;
            }
        }
    }
    set mainL [<a name="::maintestbeds(1)"><a href="./regtoolsLib.tcl.html#::maintestbeds_278">::maintestbeds</a></a>];
    set ccL [<a name="::cctestbeds(1)"><a href="./regtoolsLib.tcl.html#::cctestbeds_380">::cctestbeds</a></a>];
    set qlL [<a name="::qltestbeds(1)"><a href="./regtoolsLib.tcl.html#::qltestbeds_402">::qltestbeds</a></a>];
    set vtL [<a name="::vttestbeds(1)"><a href="./regtoolsLib.tcl.html#::vttestbeds_424">::vttestbeds</a></a>];
    set lcL [<a name="::lctestbeds(1)"><a href="./regtoolsLib.tcl.html#::lctestbeds_446">::lctestbeds</a></a>];
    set cfgLen [llength $cfgList];
    set newCfgList &#34;&#34;
    for {set x 0} {$x&lt;$cfgLen} {incr x} {
        if {[lsearch $mainL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is running main.tcl&#34;;
            continue;
        }
        if {[lsearch $ccL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is running checkConnections.tcl&#34;;
            continue;
        }
        if {[lsearch $qlL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is running QLoadImage.tcl&#34;;
            continue;
        }
        if {[lsearch $vtL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is running verifyTestBed.tcl&#34;;
            continue;
        }
        if {[lsearch $lcL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is sitting a loadConsoles&#34;;
            continue;
        }
        if {[llength $inCfgs] &gt; 0} {
            if {[lsearch $inCfgs [lindex $cfgList $x]] &lt; 0} {
                puts &#34;Using Args Cfg [lindex $cfgList $x] is not passed in&#34;;
                continue;
            }
        }
        lappend newCfgList [lindex $cfgList $x]
    }
    set cfgList $newCfgList
    set test 0
    while {$test &lt; 5} {
        lappend ptest &#34;user$test value$test&#34;
        incr test
    }
    set cfgList [<a name="::NumberedMenu(2)"><a href="./menu.tcl.html#::NumberedMenu_2">::NumberedMenu</a></a> -head &#34;Available Test Beds&#34; \
                -question1 &#34;Select test beds to run check connections on&#34; \
                -choices $cfgList \
                -menuWidth        75 \
                -keyWidth         3 \
                -headerPadChar    &#34;=&#34; \
                -chAppendList     &#34;null&#34; \
                -chPrependList    &#34;null&#34; \
                -barChar          &#34;-&#34; \
                -clearXterm       &#34;yes&#34; \
                -clearXtermInfo   &#34;&#34; ]
}


fconfigure stdin -blocking 1
while (1) {
    set choice y
    puts -nonewline &#34;checkConnections will be run on all of these test beds. Continue (y/n)\[$choice\]: &#34;;
    flush stdout;
    gets stdin userChoice;
    if {$userChoice==&#34;&#34;} {
       set userChoice $choice
    }
    if {[regexp -nocase &#34;^y&#34; $userChoice]} {
        break
    } elseif {[regexp -nocase &#34;^n&#34; $userChoice]} {
        exit;
    } else {
        puts &#34;It has to be a yes or no!&#34;;
    }
}
while (1) {
    set choice y
    set usePri &#34;1&#34;
    puts -nonewline &#34;Force checkConnections 'use ima primary' (y/n)\[$choice\]: &#34;;
    flush stdout;
    gets stdin userChoice;
    if {$userChoice==&#34;&#34;} {
       set userChoice $choice
    }
    if {[regexp -nocase &#34;^y&#34; $userChoice]} {
        puts &#34;!!!! Its GO TIME !!!!&#34;
        break
    } elseif {[regexp -nocase &#34;^n&#34; $userChoice]} {
        puts &#34;!!!! NO Primary. Its GO TIME !!!!&#34;
        set usePri &#34;0&#34;
        break
    } else {
        puts &#34;It has to be a yes or no!&#34;;
    }
}
foreach cfg $cfgList {
    after 1500
    set cfg [string trimleft $cfg &#34;!&#34;]
    cd ../main
    if {$cfg != &#34;null&#34;} {
        if {![regexp -nocase &#34;^cfg&#34; $cfg] } {
            puts &#34;matched start with cfg&#34;
            set cfgFile [format %s/%s cfg $cfg]
            set cfgFile [string trim $cfgFile];
        } else {
            puts &#34;matched catch all&#34;
            set cfgFile $cfg
        }
    }
    puts &#34;Using config file: ($cfgFile)&#34;

    if {[file exists $cfgFile] == 0} {
        puts &#34;Cannot find config file: $cfgFile\n&#34;
        puts stderr &#34;Cannot find config file: $cfgFile&#34;
        return
    }

    puts &#34;************** ABOUT TO source $cfgFile *****************&#34;
    catch {source $cfgFile } reason

    set mydir [pwd]
    puts &#34;launching checkConnections for cfg $cfgFile gnome-terminal&#34;
    if {[catch {exec /usr/bin/xterm -e \
             &#34;../Util/bash_cc $cfgFile $cfgFile $usePri&#34; &amp;} reason]} {
         puts &#34;OOOPPPSSSSS&#34;
    }
    after 2000
    puts &#34;\n\n&#34;
    cd $mydir
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
