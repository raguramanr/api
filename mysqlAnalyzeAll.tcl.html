<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>mysqlAnalyzeAll.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#mysqlAnalyzeAll.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>mysqlAnalyzeAll.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="mysqlAnalyzeAll.tcl-annot.html">annotations</a> | <a href="mysqlAnalyzeAll.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>


source ../Lib/parse_args.tcl
source ../Lib/mysqlLib.tcl
set cfgFile ../main/runReg.cfg

<span class="comment-line"># Source config file that has Regression PC information</span>
if [file exists $cfgFile] {
    puts &#34;Sourcing $cfgFile now&#34;
    catch {source $cfgFile} reason
} else {
    puts &#34;!!! Configuration file $cfgFile not found !!!&#34;
    return 0
}


global mysqlIP my_db
set host $mysqlIP
set db $my_db
global host mysql_handler

<a name="::conn_to_db(1)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db

<a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> mysqlAnalyzeAll $argv {
    regId &#34;null&#34;
    run_number &#34;1&#34;
    forstats &#34;no&#34;
}

puts &#34;regId $regId&#34;
set regression_id $regId


set regType [mysqlsel $mysql_handler &#34;SELECT feature_type from regression_table WHERE regression_id = '$regression_id' &#34; -flatlist]
if {$regType == &#34;&#34;} {
    puts &#34;No regType for regression_id:$regression_id&#34;
    return 0
}
puts &#34;regType: $regType&#34;

set regSubType [mysqlsel $mysql_handler &#34;SELECT feature_sub_type from regression_table WHERE regression_id = '$regression_id' &#34; -flatlist]
if {$regSubType == &#34;&#34;} {
    puts &#34;No regSubType for regression_id:$regression_id&#34;
    return 0
}
puts &#34;regSubType: $regSubType&#34;

set regressionModules [mysqlsel $mysql_handler &#34;SELECT feature_directory FROM feature_table WHERE feature_type = '$regType' AND feature_sub_type = '$regSubType' AND status = 'Active' ORDER BY feature_name&#34; -flatlist]
if {$regressionModules == &#34;&#34;} {
    puts &#34;No modules list for regression_id: $regression_id&#34;
    return 0
}
puts &#34;regressionModules: \n$regressionModules\n&#34;

set regressionModuleIds [mysqlsel $mysql_handler &#34;SELECT feature_id FROM feature_table WHERE feature_type = '$regType' AND feature_sub_type = '$regSubType' AND status = 'Active' ORDER BY feature_name&#34; -flatlist]
if {$regressionModuleIds == &#34;&#34;} {
    puts &#34;No modules list for regression_id: $regression_id&#34;
    return 0
}
puts &#34;regressionModuleIds: \n$regressionModuleIds\n&#34;



foreach feature_id $regressionModuleIds {
     catch {
        <span class="comment-line"># let PHP analyze the report files and update log files</span>
        set regression_id_url [http_formatQuery regression_id $regression_id feature_id \
                                               $feature_id run_number $run_number forstats $forstats]
        puts &#34; regression_id_url: $regression_id_url&#34;

        if {$my_db == &#34;autoweb_db_5&#34; || $my_db == &#34;autoweb_db_7&#34;} {
          set analyseURL &#34;http://$host/phpdb4/failAnalysis.php&#34;
        } else {
          set analyseURL &#34;http://$host/failAnalysis.php&#34;
        }
        set analyseURL [append analyseURL &#34;?$regression_id_url&#34;]
        puts &#34; analyseURL: $analyseURL&#34;
        set token [http_get $analyseURL -timeout 1000000 ]
        upvar #0 $token httpState
        while { [string match eof $httpState(state)] != 1 } {
            set incommingHttp &#34;$httpState(state) [string match eof $httpState(state)]&#34;
            puts $logFileId $incommingHttp
            puts stderr $incommingHttp
            flush stderr
            if {$incommingHttp == &#34;header 0&#34;} {
              puts &#34;we got $incommingHttp which causes a loop - terminating mysqlAutomate&#34;
              return
            }
            after 100
        }
        if { [info exists httpState(error)] } {
          set lasterror $httpState(http)
          puts &#34;GOT HTTP ERROR: $lasterror&#34;
        }

     } httpResult

    if { $httpResult != &#34;&#34; } {
        puts &#34;HTTP CRASH: $httpResult&#34;
     }

}



</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
