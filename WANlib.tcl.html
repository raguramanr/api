<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>WANlib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#WANlib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>WANlib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="WANlib.tcl-annot.html">annotations</a> | <a href="WANlib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<strong><a name="::::vman_setup_1">proc <a href="WANlib.tcl-annot.html#::::vman_setup">::::vman_setup</a></a></strong><a name="::::vman_setup"></a> {DUT slot} {
    <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT

    if [regexp -nocase &#34;mixed&#34; $slot] {
        set i 1
        foreach j {2 3 4} {
            <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config default del port $j:25-$j:32&#34;
            for {set k 25} {$k &lt; 33} {incr k} {
                <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;del vlan vl$i&#34;
                <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan vl$i&#34;
                <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan vl$i add port 1:$i, $j:$k&#34;
                incr i
            }
        }
    } else {
        <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config default del port $slot:1-$slot:24&#34;
        for {set i 1} {$i &lt; 25} {incr i} {
            <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;del vlan vl$i&#34;
            <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan vl$i&#34;
            <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan vl$i add port 1:$i, $slot:$i&#34;
        } 
    } 
}

<strong><a name="::::dut_setup_25">proc <a href="WANlib.tcl-annot.html#::::dut_setup">::::dut_setup</a></a></strong><a name="::::dut_setup"></a> {DUT ipadd mask_bit_count defaultRouter} {
    global image_smm
    global image_slot
    global bladeArray
    global ${DUT}_SETUP
    global ABU_BLADE
 
    if [info exist image_smm] {
       lappend ${DUT}_SETUP &#34;use image $image_smm&#34;
    }

    lappend ${DUT}_SETUP &#34;unconfig switch all&#34;
    lappend ${DUT}_SETUP &#34;config default delete port all&#34;
    lappend ${DUT}_SETUP &#34;config mgmt ipa  $ipadd/$mask_bit_count&#34;
    lappend ${DUT}_SETUP &#34;config ipr add default $defaultRouter&#34;
    lappend ${DUT}_SETUP &#34;enable port mgmt&#34;

    if [info exist image_slot] {
       lappend ${DUT}_SETUP &#34;use image slot $bladeArray($DUT,$ABU_BLADE) $image_slot&#34;
       lappend ${DUT}_SETUP &#34;restart slot   $bladeArray($DUT,$ABU_BLADE)&#34;
    }
}

<strong><a name="::::waitForPPPAuth_48">proc <a href="WANlib.tcl-annot.html#::::waitForPPPAuth">::::waitForPPPAuth</a></a></strong><a name="::::waitForPPPAuth"></a> {DUT_IP MAX_TIME_WAIT} {
	<span class="comment-line">#Wait for authentication before checking states</span>
	<span class="comment-line">#sleep 60</span>
	<a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT_IP
	set t1 [clock seconds]
	set timerA [clock seconds]

	send &#34;sh ppp info \r&#34;
	while {1} {
		set timerB [clock seconds]
		set timer [expr $timerB-$timerA]
		if {$timer &gt;= $MAX_TIME_WAIT} {
			set t2 [clock seconds]
			set authTime [expr $t2-$t1]
			puts &#34;\nMAX_TIME_WAIT ($MAX_TIME_WAIT seconds) reached\n&#34;
			send &#34;\033&#34;
			set authStatus &#34;MAX_TIME_WAIT EXCEEDED&#34;
			break
		}
		expect {
			&#34;No Phys Link&#34; {
				continue
			}
			&#34;Connecting&#34; {
				continue
			}
			&#34;Starting&#34; {
				continue
			}
			&#34;Established * Failed&#34; {
				continue
			}
			&#34;Failed * Failed&#34; {
				set t2 [clock seconds]
				set authTime [expr $t2-$t1]
				puts &#34;\nAuthentication Failed at $authTime seconds\n&#34;
				send &#34;\033&#34;
				set authStatus &#34;Failed-FailedAuth&#34;
				break
			}
			&#34;Disabled * Failed&#34; {
				set t2 [clock seconds]
				set authTime [expr $t2-$t1]
				puts &#34;\nAuthentication Disabled at $authTime seconds\n&#34;
				send &#34;\033&#34;
				set authStatus &#34;Disabled-FailedAuth&#34;
				break
			}
			&#34;Disabled&#34; {
				set t2 [clock seconds]
				set authTime [expr $t2-$t1]
				puts &#34;\nNo Authentication Disabled at $authTime seconds\n&#34;
				send &#34;\033&#34;
				set authStatus &#34;Disabled-NoAuth&#34;
				break
			}
			&#34;Established     Successful * *CP Successful&#34; {
				set t2 [clock seconds]
				set authTime [expr $t2-$t1]
				puts &#34;\nEstablished Auth Successful at $authTime seconds\n&#34;
				send &#34;\033&#34;
				set authStatus &#34;Successful-Auth&#34;
				break
			}
			&#34;Established * *CP Successful&#34; {
				set t2 [clock seconds]
				set authTime [expr $t2-$t1]
				puts &#34;\nEstablished NoAuth at $authTime seconds\n&#34;
				send &#34;\033&#34;
				set authStatus &#34;Successful-noAuth&#34;
				break
			}
		}
	}
	send &#34;\r&#34;
	send &#34;\r&#34;
	sleep 2
	return [list $authStatus $authTime]
}

<strong><a name="::::AbuSendFrame_128">proc <a href="WANlib.tcl-annot.html#::::AbuSendFrame">::::AbuSendFrame</a></a></strong><a name="::::AbuSendFrame"></a> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> AbuSendFrame $args {
      txPortId &#34;1&#34;
      rxPortId &#34;0&#34;
      <a name="::protocol(1)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      sourceMac &#34;default&#34;
      destMac &#34;default&#34;
      numFrames &#34;1&#34;
      frameSize &#34;64&#34;
      frameSizeType &#34;sizeFixed&#34;
      dataPattern &#34;1234&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      percentage &#34;100&#34;
      tag &#34;none&#34;
      tagPriority &#34;0&#34;
      frameRate &#34;default&#34;	      
   }
   
   <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId txChasisId txCard txPort
   if {$rxPortId == 0} {
      set sendLearn &#34;false&#34;
      set rxPort [<a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId rxChasisId rxCard rxPo]
   } else {
      set sendLearn &#34;true&#34;
      <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $rxPortId rxChasisId rxCard rxPort
   }
   
   set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   global cardSpeed
   set frameSent [<a name="::::abu_ixiaConf_2Ports(1)"><a href="./WANlib.tcl.html#::::abu_ixiaConf_2Ports_222">::::abu_ixiaConf_2Ports</a></a> -numIxiaCd $numIxiaCd -cardSpeed $cardSpeed \
                  -txChas $txChasisId -txCard $txCard -txPort $txPort \
                  -rxChas $rxChasisId -rxCard $rxCard -rxPort $rxPort -sendLearn $sendLearn \
                  -protocol $protocol -numFrames $numFrames -frameSize $frameSize -frameSizeType $frameSizeType \
                  -dataPattern $dataPattern -streamType $streamType -fcsError $fcsError \
                  -inSaMac $sourceMac -saMode $saMode -inDaMac $destMac -daMode $daMode \
                  -percentage $percentage -wTag $wTag -tagNo $tag -tagPriority $tagPriority\
                  -frameRate $frameRate]
  if {$streamType != &#34;contPacket&#34; &amp;&amp; $numFrames &gt; 100} {
    <a name="::ixiaCheckTxDone(1)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $txChasisId $txCard $txPort $numFrames $txPortId
  }    
  return $frameSent            
}


<span class="comment-line">#############################################</span>
<span class="comment-line">###########################################################################</span>
<span class="comment-line"># Ixia control - TX from a port &amp; RX from another port. </span>
<span class="comment-line"># Uni-direction or bi-direction.</span>
<span class="comment-line">#</span>
<span class="comment-line"># The parameters are:</span>
<span class="comment-line">#</span>
<span class="comment-line">#      numIxiaCd :		Number of Ixia cards involved (1-16)</span>
<span class="comment-line">#                       for statistics &amp; capture purpose</span>
<span class="comment-line">#	   cardSpeed :		Ixia card speed	(10, 100, 1000)</span>
<span class="comment-line">#	   startCardNum :	Starting Ixia card slot number (1-16)</span>
<span class="comment-line">#      direction :		uni-direction (1Way) or bi-direction (2Way)</span>
<span class="comment-line">#      txChas :			TX Ixia chassis id</span>
<span class="comment-line">#      txCard :			TX Ixia card number</span>
<span class="comment-line">#      txPort :			TX Ixia port number</span>
<span class="comment-line">#      rxChas :			RX Ixia chassis id</span>
<span class="comment-line">#      rxCard :			RX Ixia card number</span>
<span class="comment-line">#      rxPort :			RX Ixia port number</span>
<span class="comment-line">#      inSaMac :		Input source MAC address</span>
<span class="comment-line">#      inDaMac :		Input destination MAC address</span>
<span class="comment-line">#      numFrames :		Number of frames to send per Ixia port</span>
<span class="comment-line">#      frameSize :		Frame size</span>
<span class="comment-line">#      dataPattern :	Packet data pattern </span>
<span class="comment-line">#      streamType :		advance, contBurst, contPacket, firstLoopCount,</span>
<span class="comment-line">#						gotofirst, stopStream (Note: see Ixia manual)</span>
<span class="comment-line">#      patternOffset :	For &#34;filterPallette&#34; (Note: see Ixia manual)</span>
<span class="comment-line">#      fcsError :		good, alignErr, bad, dribbleErr, none</span>
<span class="comment-line">#						(Note: see Ixia manual)</span>
<span class="comment-line">#      wTag :			With Tag (true, false)</span>
<span class="comment-line">#	   tagNo :			Tag number</span>
<span class="comment-line">#      priority :		Priority for the packet</span>
<span class="comment-line">#      protocol :		mac, ip, ipx</span>
<span class="comment-line">#      saMode :			contDecrement, contIncrement, ctrRandom,</span>
<span class="comment-line">#						decrement, idle, increment (Note: see Ixia manual)</span>
<span class="comment-line">#      daMode :			contDecrement, contIncrement, ctrRandom,</span>
<span class="comment-line">#						decrement, idle, increment (Note: see Ixia manual)</span>
<span class="comment-line">#      percentage :		For TX speed - Percentage of the line rate</span>
<span class="comment-line">#      sendLearn :		To send learning frames? (true, false)</span>
<span class="comment-line">#      numLearnFrames :	Number of the learning frames</span>
<span class="comment-line">#      chid :			Ixia chassis id</span>
<span class="comment-line">#      userStatFltrSA1		MAC address filter for user stat 1</span>
<span class="comment-line">#      userStatFltrDA1		MAC address filter for user stat 1</span>
<span class="comment-line"># </span>
<span class="comment-line">###########################################################################</span>

<strong><a name="::::abu_ixiaConf_2Ports_222">proc <a href="WANlib.tcl-annot.html#::::abu_ixiaConf_2Ports">::::abu_ixiaConf_2Ports</a></a></strong><a name="::::abu_ixiaConf_2Ports"></a> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> abu_ixiaConf $args {
      numIxiaCd &#34;1&#34;
	  cardSpeed &#34;100&#34;
	  startCardNum &#34;1&#34;
      direction &#34;1Way&#34;
      txChas &#34;1&#34;
      txCard &#34;1&#34;
      txPort &#34;1&#34;
      rxChas &#34;1&#34;
      rxCard &#34;1&#34;
      rxPort &#34;2&#34;
      inSaMac &#34;default&#34;
      inDaMac &#34;default&#34;
      numFrames &#34;1&#34;
      frameSizeType &#34;sizeFixed&#34;
      frameSize &#34;64&#34;
      dataPattern &#34;0000&#34;
      streamType &#34;stopStream&#34;
      patternOffset &#34;32&#34;
      fcsError &#34;good&#34;
      priority &#34;0&#34;
      <a name="::protocol(2)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      percentage &#34;100&#34;
      sendLearn &#34;false&#34;
      numLearnFrames &#34;1&#34;
      wTag &#34;false&#34;
      tagNo &#34;002&#34;
      tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat &#34;1&#34;
      tagPriority &#34;0&#34;	  
      chid &#34;1&#34;
      userDefinedStat1SA &#34;00:00:00:00:00:00&#34;
      userDefinedStat1DA &#34;00:00:00:00:00:00&#34;
      frameRate &#34;default&#34;
   }

   global spawn_id
   global one2oneArray
   global macBroadcast
   global preambleSize
   <a name="::globalSetDefault(1)"><a href="./ePTUtils.tcl.html#::globalSetDefault_1">::globalSetDefault</a></a>

   set date [clock format [clock seconds] -format &#34;%m-%d-%Y %I.%M.%S%p&#34;]
   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*** date=$date for &lt;ixiaConf_2Ports&gt;&#34;
   set time1 [clock seconds]
 <span class="comment-line">#remove this, MapIxiaPort will account for this</span>
 <span class="comment-line">#  2portsNum_adjust $startCardNum $cardSpeed numIxiaCd txCard txPort rxCard rxPort</span>

   set macBroadcast	{ff ff ff ff ff ff}
   set preambleSize	8

   <span class="comment-line"># Create mapping</span>
   <a name="::map(1)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> new -type	one2one
   <a name="::map(2)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> config -type one2one
   <a name="::map(3)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> add $txChas $txCard $txPort $rxChas $rxCard $rxPort
   if { $direction == &#34;2Way&#34; } {
      <a name="::map(4)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> add $rxChas $rxCard $rxPort $txChas $txCard $txPort
   }
   if { $sendLearn == &#34;true&#34; } {
      learn config -numframes $numLearnFrames
      send_learn_frames one2oneArray
   }


   <span class="comment-line"># Config streams for validation traffic</span>
   foreach txMap [lsort [array names one2oneArray]] {
      scan $txMap					&#34;%d,%d,%d&#34; chid c p
      <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get						$chid $c $p
      set txSpeed					[<a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -speed]
      <a name="::stream(1)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numFrames		$numFrames
      <a name="::stream(2)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -name 			S_${c}_${p}
      <a name="::stream(3)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -framesize		$frameSize
      <span class="comment-line">#random size</span>
      if {$frameSizeType == &#34;sizeRandom&#34;} {
         <a name="::stream(4)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameSizeType		$frameSizeType
         <a name="::stream(5)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameSizeMAX      1500
         <a name="::stream(6)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameSizeMIN      64
      }
      <a name="::stream(7)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -dma 			$streamType
      <span class="comment-line">#set frameRate [decideFrameRate $cardSpeed $frameSize $percentage]</span>
      set ifg [calculateGap $frameRate $frameSize $preambleSize $txSpeed]

      <span class="comment-line"># Now we configure the stream</span>
      <a name="::stream(8)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -fcs			$fcsError
      <a name="::stream(9)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -ifg			$ifg
      <a name="::stream(10)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -isg			$ifg
      <a name="::stream(11)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -ibg			$ifg
<span class="comment-line">#      stream config -fir			true		;# for timestamp</span>
      <a name="::stream(12)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -patternType nonRepeat  ;<span class="comment-line">#needed for version 3.1</span>
      <a name="::stream(13)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -dataPattern	userpattern -pattern $dataPattern
      set srcAddr					[<a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]
      set rxMap						$one2oneArray($txMap)
      scan [join $rxMap]			&#34;%d %d %d&#34; rxch rxc rxp
      <a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get						$rxch $rxc $rxp
      set destAddr					[<a name="::port(5)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]

      <a name="::stream(14)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -saRepeatCounter $saMode 
      <a name="::stream(15)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -daRepeatCounter $daMode 
      if { $saMode != &#34;idle&#34; } { <a name="::stream(16)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numSA $numFrames }
      if { $daMode != &#34;idle&#34; } { <a name="::stream(17)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numDA $numFrames }

      if { $inSaMac == &#34;default&#34; } { <a name="::stream(18)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $srcAddr
      } else {                       <a name="::stream(19)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $inSaMac }				    
      if { $inDaMac == &#34;default&#34; } { <a name="::stream(20)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $destAddr
      } else {                       <a name="::stream(21)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $inDaMac }

      <a name="::protocol(3)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> setDefault
	  <a name="::protocol(4)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -name					$protocol
	  <a name="::protocol(5)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -enable802dot1qTag	$wTag
	  <span class="comment-line">#ipx</span>
<span class="comment-line">#	  if { $protocol == &#34;ipx&#34; } {</span>
<span class="comment-line">#	   puts &#34;NetbiosOOOOOOOOOO&#34;</span>
<span class="comment-line">#	   ipx config -packetType &#34;typeNetBios&#34;</span>
<span class="comment-line">#	   ipx config -destSocket &#34;socketNetBios&#34;</span>
<span class="comment-line">#	   puts [ipx cget -packetType] }</span>

      <a name="::vlan(1)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -cfi						$tagCfi
      <a name="::vlan(2)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -mode						$tagMode
      <a name="::vlan(3)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -repeat					$tagRepeat
      <a name="::vlan(4)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -vlanID					$tagNo
      <a name="::vlan(5)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -userPriority					$tagPriority
      <a name="::vlan(6)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> set								$chid $c $p

      <a name="::stream(22)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> set							$chid $c $p 1

	<span class="comment-line"># Define filter &amp; capture</span>

      <a name="::filterPallette(1)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -DA1 			$destAddr
      <a name="::filterPallette(2)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -pattern1			$dataPattern
      <a name="::filterPallette(3)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -patternOffset1 		$patternOffset
      <a name="::filterPallette(4)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set				$rxch $rxc $rxp

      <a name="::filter(1)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable		true
      <a name="::filter(2)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable		true
  
      <span class="comment-line">#user defined stats settings</span>
      if { ( $userDefinedStat1DA != &#34;00:00:00:00:00:00&#34; ) || \
           ( $userDefinedStat1SA != &#34;00:00:00:00:00:00&#34; ) }  {
        <a name="::filter(3)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Enable		true
        if { $userDefinedStat1DA != &#34;00:00:00:00:00:00&#34; } {
          <a name="::filterPallette(5)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -DA1 			$userDefinedStat1DA
          <a name="::filter(4)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1DA		addr1
        }
        if { $userDefinedStat1SA != &#34;00:00:00:00:00:00&#34; } {
          <a name="::filterPallette(6)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -SA1 			$userDefinedStat1SA
          <a name="::filter(5)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1SA		addr1
        }
        <a name="::filterPallette(7)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set				$rxch $rxc $rxp
      } else {
        <a name="::filter(6)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Enable		false
        <a name="::filter(7)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1DA		addr1
      }      
      <a name="::filter(8)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterPattern		anyPattern
      <a name="::filter(9)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerPattern		anyPattern
      <a name="::filter(10)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerDA			anyAddr
      <a name="::filter(11)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterDA			anyAddr
      <a name="::filter(12)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> set								$rxch $rxc $rxp
   }
   <a name="::writeConfigToHardware(1)"><a href="./mapping.tcl.html#::writeConfigToHardware_148">::writeConfigToHardware</a></a> one2oneArray
   for {set c 1} {$c&lt;=$numIxiaCd} {incr c 1} { <a name="::ixiaConf_clearStat(1)"><a href="./ePTMisc.tcl.html#::ixiaConf_clearStat_258">::ixiaConf_clearStat</a></a> $c }
   <span class="comment-line">#just in case some previous function stop capture on these ports</span>
   <a name="::ixStartPortCapture(1)"><a href="./mapping.tcl.html#::ixStartPortCapture_112">::ixStartPortCapture</a></a> $txChas $txCard $txPort
   <a name="::ixStartPortCapture(2)"><a href="./mapping.tcl.html#::ixStartPortCapture_112">::ixStartPortCapture</a></a> $rxch $rxc $rxp
   <a name="::startTx(1)"><a href="./mapping.tcl.html#::startTx_94">::startTx</a></a> one2oneArray
   set time2 [clock seconds]
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*** Time for Ixia TX setup = [expr $time2-$time1] secs&#34;
   <span class="comment-line">#get the stream so we can return it later</span>
   <a name="::stream(23)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> get $txChas $txCard $txPort 1
   set streamSent [<a name="::stream(24)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> cget -packetView]

   <span class="comment-line"># Make sure TX done</span>
   if { $streamType == &#34;stopStream&#34; } {
      if { ($saMode != &#34;contIncrement&#34;) &amp;&amp; ($saMode != &#34;contDecrement&#34;) &amp;&amp;   \
           ($daMode != &#34;contIncrement&#34;) &amp;&amp; ($daMode != &#34;contDecrement&#34;) } {
         <a name="::ixiaCheckTxDone(2)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $txChas $txCard $txPort $numFrames $txPort
         if { $direction == &#34;2Way&#34; } {
            <a name="::ixiaCheckTxDone(3)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $rxChas $rxCard $rxPort $numFrames $txPort
         }
      }
   }
   after 500
   set time3 [clock seconds]
   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*** Time for Ixia TX done = [expr $time3-$time2] secs\n&#34;
   return $streamSent
}

<strong><a name="::::DOWNLOADIMAGE_412">proc <a href="WANlib.tcl-annot.html#::::DOWNLOADIMAGE">::::DOWNLOADIMAGE</a></a></strong><a name="::::DOWNLOADIMAGE"></a> {TFTPServerIP filename {image_type &#34;image&#34;} {slot {}} {compartment {}}} {
   <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- Send download $image_type $slot $TFTPServerIP $filename $compartment&#34;
   send &#34;download $image_type $slot $TFTPServerIP $filename $compartment\n&#34;
   expect {
      &#34;(Y/N)&#34; {
         send &#34;y\n&#34;
      }
      timeout {
         <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in downloading image&#34;
         return &#34;error&#34;
      }
   }

   catch {<a name="::SaveOutputBuffer(1)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)} reason
   set timeout 300
   set flag &#34;ok&#34;
   expect {
      timeout {
         <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in download config. Can't get a prompt after download&#34;
         return &#34;error&#34;
      }
      &#34;Error: Access violation&#34; {
         set flag &#34;error&#34;
      }
      &#34;ERROR:&#34; {
         set flag &#34;error&#34;
      }
      &#34;failed&#34; {
         set flag &#34;error&#34;
      }
      &#34;#&#34; {
      }
   }
   catch {<a name="::SaveOutputBuffer(2)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)} reason
<span class="comment-line">#   puts &#34;flag: $flag&#34;</span>
   return $flag
}

<strong><a name="::::SENDaCMD_450">proc <a href="WANlib.tcl-annot.html#::::SENDaCMD">::::SENDaCMD</a></a></strong><a name="::::SENDaCMD"></a> {{cmd &#34;NULL&#34;} 
               {fd_result &#34;NULL&#34;} 
               {fd_input  &#34;NULL&#34;}
               {showError  &#34;true&#34;}} {
   global spawn_id
   global connectionTimeout
   
   if ![info exists retry_cmd] {
       set retry_cmd 3
   }
   set attempt 0

   set timeout $connectionTimeout
   set result &#34;&#34;
   set flag 1
   set commandFlag &#34;true&#34;
<span class="comment-line">#   set time1 [clock seconds]</span>
   <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- Send $cmd&#34;
   <span class="comment-line">#need to clear out buffer</span>
   send &#34;$cmd\r&#34;
   expect $cmd
   <span class="comment-line">#puts SEND:$expect_out(buffer)</span>

   while { $flag == 1 } {
      expect {
         timeout {
            <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No response from the switch for $timeout seconds&#34;
            send &#34;\r&#34;
            expect *
            if {$attempt &lt; $retry_cmd} {
                <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;&gt;&gt;&gt; RE-TRYING: $cmd&#34;
                send &#34;\r$cmd\r&#34;
                expect $cmd
                if {[regexp -nocase &#34;Ambi&#34; $expect_out(buffer)] || \
                    [regexp -nocase &#34;Synt&#34; $expect_out(buffer)]} {
                    <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;&gt;&gt;&gt; FAILED-RETRY: $cmd&#34;
                    send &#34;\r$cmd\r&#34;
                }
                incr attempt
                continue    
            }
            catch {<a name="::SaveOutputBuffer(3)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)} reason
            <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
            error &#34;No response from the switch for $timeout seconds&#34;
         }      
         full_buffer {
            set flag 1
         } 
         &#34;ERROR&#34;   { set commandFlag &#34;false&#34; }
         &#34;Error&#34;   { set commandFlag &#34;false&#34; }
         &#34;error&#34;    { set commandFlag &#34;false&#34; }
         &#34;nvalid&#34;   { set commandFlag &#34;false&#34; }
         &#34;llegal&#34;   { set commandFlag &#34;false&#34; }
         &#34;Warning&#34;   { set commandFlag &#34;false&#34; }
         &#34;warning&#34;   { set commandFlag &#34;false&#34; }
         &#34;not valid&#34;   { set commandFlag &#34;false&#34; }
         &#34;xception&#34;  { set commandFlag &#34;false&#34; }
         &#34;quit:&#34; {
            set flag 1
            send &#34; &#34;
         }
         -nocase -re &#34;summit.* # &#34;   {set flag 0}
         -nocase -re &#34;msm.* # &#34;   {set flag 0}
         -nocase -re &#34;bd.* # &#34;   {set flag 0}
         -nocase -re &#34;alpine.* # &#34;   {set flag 0}
         -nocase -re &#34;enetswitch.* # &#34;   {set flag 0}
         -nocase -re &#34;godzilla.* # &#34;   {set flag 0}
      	 &#34;\\?&#34; {
            set flag 1
	         send &#34;y\r&#34;
         }
         &#34;yes, no, or cancel)&#34; {
            set flag 0
            send &#34;n/r&#34;
         }
         &#34;n)\\?  &#34; {
            <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- (y/n)?  &#34;
            set flag 0
            send &#34;y/r&#34;
         }
         &#34;\\-&gt; &#34; {    ;<span class="comment-line">#nofeep command</span>
            set flag 0
      	 }
      	 &#34;ESC\\-&gt;&#34; {
      	    <span class="comment-line">#wait for data to come</span>
      	    sleep 4
      	    <span class="comment-line">#send esc characters</span>
      	    send &#34;\033&#34;
             set flag 1
      	 }
      }
      set exp_out_buf &#34;&#34;
      regsub -all &#34;\n\r&#34; $expect_out(buffer) &#34;\n&#34; exp_out_buf
      regsub -all &#34;\t&#34; $exp_out_buf &#34; &#34; exp_out_buf
      if {$fd_input != &#34;NULL&#34; } { puts -nonewline $fd_input $exp_out_buf }
      append result $exp_out_buf
   }
   <span class="comment-line">#display buffer if there is error</span>
   if { ($commandFlag == &#34;false&#34;) &amp;&amp; ($showError == &#34;true&#34;) } {
      <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;========================== CHECK COMMAND =========================&#34;
      puts &#34;$result&#34;   ;<span class="comment-line">#result_debug does not print out correct to console</span>
      set returnFlag &#34;false&#34;
   }
   <a name="::result_pre(1)"><a href="./loadConsoles.tcl.html#::result_pre_15">::result_pre</a></a> $result
<span class="comment-line">#   result_debug &#34;Time for $cmd = [expr $time2-$time1] secs&#34;</span>
   return $commandFlag
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
