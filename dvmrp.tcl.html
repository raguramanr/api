<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>dvmrp.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#dvmrp.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>dvmrp.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="dvmrp.tcl-annot.html">annotations</a> | <a href="dvmrp.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetReservedFieldHex   </span>
<span class="comment-line"># Description: Return the reserved field of DVMRP packets like report</span>
<span class="comment-line">#	       or probe.      </span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: 4 bytes hex string</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	set reservedField [GetReservedFieldHex $dataFrame]      </span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetReservedFieldHex_13">proc <a href="dvmrp.tcl-annot.html#::::GetReservedFieldHex">::::GetReservedFieldHex</a></a></strong> {rawFrame} {

return [string range $rawFrame 114 118]

}            

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetGenerationID   </span>
<span class="comment-line"># Description: Return the generation id of DVMRP probe packet.      </span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: short integer</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	set generationID [GetGenerationID $dataFrame]      </span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetGenerationID_29">proc <a href="dvmrp.tcl-annot.html#::::GetGenerationID">::::GetGenerationID</a></a></strong> {rawFrame} {

return [<a name="::GetIntOffset(1)"><a href="./MessageDecoding.tcl.html#::GetIntOffset_854">::GetIntOffset</a></a> $rawFrame 126]

}            

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetNeighborIpAddressList   </span>
<span class="comment-line"># Description: Return the neighbor ip List of DVMRP probe packet      </span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: list of IP addresses</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set neighborIpList [GetNeighborIpAddressList $dataFrame]      </span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetNeighborIpAddressList_45">proc <a href="dvmrp.tcl-annot.html#::::GetNeighborIpAddressList">::::GetNeighborIpAddressList</a></a></strong> {rawFrame} {

   set addressList &#34;&#34;
   set numNeighbor [expr ([<a name="::GetIpTotalLength(1)"><a href="./MessageDecoding.tcl.html#::GetIpTotalLength_380">::GetIpTotalLength</a></a> $rawFrame] - 32 ) / 4 ]
   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Getting $numNeighbor numNeighbor in Probe message&#34;
   for {set count 0 } {$count &lt; $numNeighbor } {incr count } {
   set offset [expr 138 + $count * 12 ]
   lappend addressList [<a name="::GetIPAddressOffset(1)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame $offset]
   }
   
   return $addressList
}  

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendDVMRPMessage   </span>
<span class="comment-line"># Description: Send DVMRP packet from an ixia port and the packet type</span>
<span class="comment-line">#	       is given in dataPattern argement.		     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Frame sent</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	set srcMac [GetDUTMac &#34;DUT1&#34;]</span>
<span class="comment-line">#	set destMac [GetDUTMac &#34;DUT2&#34;]</span>
<span class="comment-line">#	set graftAckData &#34;13 09 3A EA 00 00 FF 03 C0 02 02 00 EF 01 02 04 00 00 00 00 00 00 00 00 00 00&#34;</span>
<span class="comment-line">#	set ipTotalLength 36 </span>
<span class="comment-line">#	set frameSent [SendDVMRPMessage -txPortId 9 -sourceIp 192.3.3.1 \</span>
<span class="comment-line">#                 -destIp 192.3.3.2 -sourceMac $srcMac -destMac $destMac \</span>
<span class="comment-line">#                 -ipTotalLength $ipTotalLength -dataPattern $graftAckData ]     </span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendDVMRPMessage_75">proc <a href="dvmrp.tcl-annot.html#::::SendDVMRPMessage">::::SendDVMRPMessage</a></a></strong> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendDVMRPMessage $args {
     txPortId &#34;1&#34;
     sourceMac &#34;default&#34;
	  destMac &#34;01 00 5E 00 00 04&#34;
	  sourceIp &#34;127.0.0.1&#34;
	  destIp &#34;224.0.0.4&#34;
	  ttl &#34;1&#34;
     numFrames &#34;1&#34;
	  tag &#34;none&#34;
	  dataPattern &#34;13 01 6F 62 00 0E FF 03 39 E4 CC 40 64 64 14 01 00 00 00 00 00 00 00 00 00 00&#34;
	  ipTotalLength 36
   }
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Host ($sourceIp) sending a DVMRP message ([lindex $dataPattern 1]) on portId $txPortId&#34;   
   set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   set rxPo [<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chasisId card port]
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   global startCardNum


   set frameSize [expr 38 + [llength $dataPattern] ]
   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FrameSize: $frameSize&#34;
   set frameSent [<a name="::ixiaConf_2Ports_ip(1)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -numIxiaCd $numIxiaCd \
              -txChas $chasisId -txCard $card -txPort $port \
              -rxChas $chasisId -rxCard $card -rxPort $rxPo \
              -ipProtocol &#34;dvmrp&#34; -sMacAddr $sourceMac -dMacAddr $destMac \
              -sIpAddr $sourceIp -dIpAddr $destIp -ttl $ttl -TOS &#34;0xC0&#34; ipTotalLength $ipTotalLength \
	           -numFrames $numFrames -wTag $wTag -tagNo $tag  -dataPattern $dataPattern -frameSize $frameSize]  
   <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DVMRPFrame: $frameSent&#34;

   return $frameSent

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: check_dvmrp  </span>
<span class="comment-line"># Description:  check if DVMRP routes exist in the display of &#34;show</span>
<span class="comment-line">#		dvmrp route&#34; </span>
<span class="comment-line"># Input args: {{dIpList {}}{fd_res &#34;NULL&#34;}{testNo &#34;0&#34;}{DUT_C &#34;127.0.0.1&#34;}</span>
<span class="comment-line">#	       {DUT_IP &#34;127.0.0.1&#34;}}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#       lappend dvmrpList &#34;yes 192.20.2.0/24 10.10.10.2&#34;</span>
<span class="comment-line">#	lappend dvmrpList &#34;yes 10.10.10.0/24 10.10.10.1&#34;</span>
<span class="comment-line">#	check_dvmrp $dvmrpList $fd_res $testNo $DUT1_CONNECT $DUT1_IP</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::check_dvmrp_122">proc <a href="dvmrp.tcl-annot.html#::::check_dvmrp">::::check_dvmrp</a></a></strong> {{dIpList {}}
                  {fd_res &#34;NULL&#34;}
                  {testNo &#34;0&#34;}
                  {DUT_C &#34;127.0.0.1&#34;}
                  {DUT_IP &#34;127.0.0.1&#34;}} {

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w+&#34;]
   set date [clock format [clock seconds] -format &#34;%m-%d-%Y %I.%M.%S%p&#34;]
   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*** date=$date&#34;

   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT_C
   <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;show dvmrp route&#34; $fd_res $fd_in
   <a name="::logout_noSave(1)"><a href="./logout.tcl.html#::logout_noSave_198">::logout_noSave</a></a>
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   foreach group $dIpList {
      set shouldExist [lindex $group 0]
      set net [lindex $group 1]
<span class="comment-line">#result_debug &#34;@@@@@@@@ net = $net&#34;</span>
      set gateway [lindex $group 2]
      set found &#34;false&#34;
      seek $fd_in 0

      while {[gets $fd_in line] != -1} {
         set inList [<a name="::eSplit(1)"><a href="./misc.tcl.html#::eSplit_115">::eSplit</a></a> $line]
	     set len [llength $inList]
	     if { $len &gt;= 7 } {
            set tmpNet [lindex $inList 0]
            set tmpGateway [lindex $inList 1]
<span class="comment-line">#result_debug &#34;@@@@@@@@ |$tmpNet|$tmpGateway|&#34;</span>
			if { $net == $tmpNet } {
			   if { $gateway == &#34;-&#34; } {
                  set found &#34;true&#34;
			   } else {
		      	  if { $gateway == $tmpGateway } {
                     set found &#34;true&#34;
				  }
			   }
			}
		 }
	  }
      set DUT_INFO &#34;&#34;
      if { $DUT_IP != &#34;127.0.0.1&#34; } { set DUT_INFO &#34;(${DUT_IP}) &#34; }

      switch $shouldExist {
         &#34;yes&#34; {
            <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Dvmrp check entry $DUT_INFO'$net'&#34;
            switch $found {
               &#34;true&#34;  { <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Dvmrp check entry $net passed&#34; }
               &#34;false&#34; { <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Dvmrp check entry $net failed&#34; }
		    }
		 } 
	     &#34;no&#34; { 
            <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Dvmrp check NO entry $DUT_INFO'$net'&#34;
            switch $found {
               &#34;true&#34;  { <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Dvmrp check NO entry $net failed&#34; }
               &#34;false&#34; { <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Dvmrp check NO entry $net passed&#34; }
		    }
		 }
      }
      <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   }
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;
}  
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
