<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ePTigmp.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ePTigmp.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ePTigmp.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ePTigmp.tcl-annot.html">annotations</a> | <a href="ePTigmp.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: startIgmp</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  start the IGMP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: txPortIdList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      startDvmrp {1}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::startIgmp_17">proc <a href="ePTigmp.tcl-annot.html#::::startIgmp">::::startIgmp</a></a></strong> {txPortIdList {groupId 101064} } {

    set pList &#34;&#34;
    foreach txPortId $txPortIdList {
	<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
	<a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startIgmp - Chas: $cha Card: $car Port: $por&#34;
	lappend pList &#34;$cha $car $por&#34;
    }
    
    if {[<a name="::ixTransmitIgmpJoin(1)"><a href="./spirent.tcl.html#::ixTransmitIgmpJoin_798">::ixTransmitIgmpJoin</a></a> pList $groupId]} {
	error &#34;startIgmp: ixTransmitIgmpJoin failed.&#34;
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: stopIgmp</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  start the IGMP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: txPortIdList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      stopDvmrp {1}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::stopIgmp_46">proc <a href="ePTigmp.tcl-annot.html#::::stopIgmp">::::stopIgmp</a></a></strong> {txPortIdList {groupId 101064} } {

    set pList &#34;&#34;;
    foreach txPortId $txPortIdList {	
	<a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por;
	<a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;StopIgmp - Chas: $cha Card: $car Port: $por&#34;;
	lappend pList &#34;$cha $car $por&#34;;
    }

    if {[ixTransmitIgmpLeave pList $groupId]} {
	error &#34;stopIgmp: ixTransmitIgmpLeave failed.&#34;
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cleanupIgmp</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  cleanup the IGMP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: txPortIdList, routerIp</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      cleanupDvmrp {4}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cleanupIgmp_75">proc <a href="ePTigmp.tcl-annot.html#::::cleanupIgmp">::::cleanupIgmp</a></a></strong> {txPortIdList} {

  foreach txPortId $txPortIdList {    
    <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chas card port;
    set pl [list [list $chas $card $port]] 
    <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cleanupIgmp - Chas: $chas Card: $card Port: $port&#34;;

    protocolServer 		setDefault      
    ipAddressTable		clear
    ipAddressTable		setDefault
    ipAddressTableItem		setDefault      
      
    igmpServer			setDefault
    igmpAddressTable		clear
    igmpAddressTable	 	setDefault
    igmpAddressTableItem 	setDefault      
      
    ipAddressTable set $chas $card $port
    igmpAddressTable set $chas $card $port
    protocolServer set $chas $card $port
    igmpServer set $chas $card $port
    protocolServer write $chas $card $port

    <span class="comment-line"># Send to the hardware </span>
    <a name="::ixWritePortsToHardware(1)"><a href="./mapping.tcl.html#::ixWritePortsToHardware_145">::ixWritePortsToHardware</a></a> pl 
  }      
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: setupIgmpServer</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:  setup the IGMP protocol server on the ixia</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               -reportMode: igmpReportToOneWhenQueried(0), igmpReportToAllWhenQueried(1),</span>
<span class="comment-line">#               igmpReportToAllUnsolicited(2)</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    setupIgmpPeer -txPortId 1 \</span>
<span class="comment-line">#               -gatewayIp &#34;61.61.1.1&#34; -ipAddress &#34;61.1.1.10&#34; \</span>
<span class="comment-line">#               -numIpAddresses &#34;10&#34; -groupIpAddress &#34;224.0.1.100&#34; \</span>
<span class="comment-line">#               -numGroupIpAddress &#34;20&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::setupIgmpServer_125">proc <a href="ePTigmp.tcl-annot.html#::::setupIgmpServer">::::setupIgmpServer</a></a></strong> {args} {
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupIgmpServer $args {
        gatewayIp &#34;1.1.1.1&#34;
        ipAddress &#34;1.1.1.2&#34;
        numIpAddr &#34;1&#34;
        groupIp &#34;224.0.1.14&#34;
        numGroupIp &#34;1&#34;
        txPortId &#34;1&#34;
        repeatCount &#34;3&#34;
        reportFrequency &#34;120&#34;
        reportMode &#34;1&#34;
        <a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> &#34;2&#34;
        tag &#34;0&#34;
    }
    set error_flag 0

    <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chas card port
    <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupIgmpServer: setting up IGMP server on port $txPortId&#34;

    protocolServer setDefault

    ipAddressTable clear
    ipAddressTable setDefault
    ipAddressTableItem setDefault
    ipAddressTableItem config -fromIpAddress $ipAddress
    ipAddressTableItem config -numAddresses $numIpAddr
    if {$tag != 0} {
           ipAddressTableItem config -enableVlan true
           ipAddressTableItem config -vlanId $tag
      }
    if {[ipAddressTableItem set]} {
        set error_flag 1
        <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IP Addr Table Item&#34;
    }

    if {[ipAddressTable addItem]} {
        set error_flag 1
        <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Add IP Address Table Item&#34;
    }
    ipAddressTable config -defaultGateway $gatewayIp
    if {[ipAddressTable set $chas $card $port]} {
        set error_flag 1
        <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IP Address Table&#34;
    }

    igmpServer setDefault
    igmpAddressTable clear
    igmpAddressTableItem setDefault
    foreach groupAddr $groupIp {
        igmpAddressTableItem config -fromClientAddress  $ipAddress
        igmpAddressTableItem config -fromGroupAddress   $groupAddr
        igmpAddressTableItem config -numClientAddresses $numIpAddr
        igmpAddressTableItem config -numGroupAddresses  $numGroupIp
        if {[igmpAddressTableItem set]} {
            set error_flag 1
            <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IGMP Addr Table Item&#34;
        }
        if {[igmpAddressTable addItem]} {
            set error_flag 1
            <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Add IGMP Address Table Item&#34;
        }
    }
    if {[igmpAddressTable set $chas $card $port]} {
        set error_flag 1
        <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IGMP Address Table&#34;
    }

    protocolServer config -enableIgmpQueryResponse    true
    protocolServer config -enableArpResponse true
    if [protocolServer set $chas $card $port] {
        set error_flag 1
        <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set Protocol Server&#34;
    }

    igmpServer config -enableQueryResponse      true
<span class="comment-line">#   igmpServer config -rate                     $rate</span>
    igmpServer config -repeatCount              $repeatCount
    igmpServer config -reportFrequency          $reportFrequency
    igmpServer config -reportMode               $reportMode
    igmpServer config -sendRouterAlert          false
    igmpServer config -version                  $version
    if {[igmpServer set $chas $card $port]} {
        set error_flag 1
        <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IGMP Server&#34;
    }

    if {[protocolServer write $chas $card $port]} {
        <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Unable to write protocolServer to h/w&#34;
        set error_flag 1
    }

   return $error_flag
}



<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetIGMPMessage</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the IGMP Messages from a frame received</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: IGMP Messages in ixia raw frame format</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     set igmpMsg [GetIGMPMessage $frame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetIGMPMessage_237">proc <a href="ePTigmp.tcl-annot.html#::::GetIGMPMessage">::::GetIGMPMessage</a></a></strong> {rawFrame} {

   <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rawFrame = $rawFrame&#34;
   set rtnMsg &#34;&#34;
   set type [string range $rawFrame 36 40]

   <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
   if {$type == &#34;81 00&#34;} {
     set leftRawFrame [string range $rawFrame 0 35]
     set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
     set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
   }

   set type [string range $rawFrame 36 40]
   <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the type $type&#34;
   if { $type == &#34;08 00&#34; } {
      set IpType [string range $rawFrame 69 70]
      if { $IpType == &#34;02&#34; } {
<span class="comment-line">#         result_debug &#34;rawFrame = $rawFrame&#34;</span>
         set macHdrLen 14
	 set ipHdrLen [expr ([string range $rawFrame 43 43] * 4)]
	 set igmpOffset [expr ($macHdrLen + $ipHdrLen) * 3]
	 set rtnMsg [string range $rawFrame $igmpOffset [string length $rawFrame]]
      }
   }
<span class="comment-line">#   result_debug &#34;igmpMsg: $rtnMsg&#34;</span>
   return $rtnMsg
}


<strong><a name="::::GetIGMPType_267">proc <a href="ePTigmp.tcl-annot.html#::::GetIGMPType">::::GetIGMPType</a></a></strong> { igmpMsg } {
   if {[string length $igmpMsg] == 0} { 
      return &#34;NOT_IP_IGMP&#34;;
   }
   set type [string range $igmpMsg 0 1]
<span class="comment-line">#   set ip_version [string range $igmpMsg 0 0]</span>
   switch -glob -- $type \
      &#34;11&#34; {
         return &#34;IP_IGMPv2_QUERRY&#34;;
   }  &#34;12&#34; {
         return &#34;IP_IGMPv1_REPORT&#34;;
   }  &#34;16&#34; {
         return &#34;IP_IGMPv2_REPORT&#34;
   }  &#34;17&#34; {
         return &#34;IP_IGMPv2_LEAVE&#34;
   }  &#34;22&#34; {
         return &#34;IP_IGMPv3_REPORT&#34;
   }  default  {
         <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Type: IP_IGMP_$type&#34;
         return &#34;IP_IGMP_$type&#34;
   }
}

<strong><a name="::::GetIGMPQueryGroup_290">proc <a href="ePTigmp.tcl-annot.html#::::GetIGMPQueryGroup">::::GetIGMPQueryGroup</a></a></strong> { igmpMsg } {
   return [<a name="::GetIPAddressOffset(1)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $igmpMsg 12];
}

<strong><a name="::::CheckIGMPV3Query_294">proc <a href="ePTigmp.tcl-annot.html#::::CheckIGMPV3Query">::::CheckIGMPV3Query</a></a></strong> { igmpMsg } {
       set maxResp [string range $igmpMsg 3 4]
       set qrv [string range $igmpMsg 25 25]
       set qqic [string range $igmpMsg 27 28]
       <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The values of maxResp: $maxResp,qrv: $qrv,qqic: $qqic&#34;
       if { ($maxResp == &#34;64&#34;) &amp;&amp; ($qrv == &#34;2&#34;) &amp;&amp; ($qqic == &#34;7D&#34;)} {
           <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Valid IGMPV3 packet received&#34;          
           <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IGMPv3 general Querry with valid QRV: $qrv, QQIC: $qqic \
                      and max response time: $maxResp received&#34;
           <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
           return &#34;VALID_IGMPV3_QUERY&#34;

       }
   return &#34;INVALID_IGMPV3_QUERY&#34;
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: sendIgmpv3BadReport</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to send Bad IGMPv3 Reports</span>
<span class="comment-line">#</span>
<span class="comment-line">#     Note!! This used to be the original proc for sending v3 reports</span>
<span class="comment-line">#            but the ip header link was wrong and this started causing</span>
<span class="comment-line">#            problems.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: Send IGMPv3 Messages</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     sendIgmpv3BadReport -txPortId $host7 -hostIp $host7ip \</span>
<span class="comment-line">#                 -srcIpAddr &#34;$srcIp4&#34; -groupAddr $grpAddr1 \</span>
<span class="comment-line">#                 -reportType &#34;15&#34; -igmpMsgType &#34;33&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: Traffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::sendIgmpv3BadReport_331">proc <a href="ePTigmp.tcl-annot.html#::::sendIgmpv3BadReport">::::sendIgmpv3BadReport</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> sendIgmpv3BadReport $args {
   igmpMsgType &#34;34&#34;
   reportType &#34;1&#34;
   hostIp &#34;137.1.1.1&#34;
   srcIpAddr &#34;137.1.1.1&#34;
   groupAddr &#34;232.1.1.1&#34;
   txPortId  &#34;1&#34;
   numSource &#34;1&#34;
   numGroup &#34;1&#34;
   streamType &#34;stopStream&#34;
  } 
set type 0
set val3 &#34;{00 00 00 00}&#34;
set val4 &#34;{00 00 00 00}&#34;
set val5 &#34;{00 00 00 00}&#34;

set type $reportType
set multicastIP 224.0.0.22
set destMacMulticast [<a name="::GetMulticastMac(1)"><a href="./misc.tcl.html#::GetMulticastMac_605">::GetMulticastMac</a></a> $multicastIP]
<a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Host Address: $hostIp source address: $val5 Group Address: $val4&#34;

set dataPattern &#34;0$type 00 00 0$numSource&#34;
<a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;dataPattern $dataPattern&#34;
set udf &#34;true&#34;
set val1 &#34;{22 00}&#34;
set val2 &#34;{00 00 00 01}&#34;
set val3 &#34;{[<a name="::snmpConvertIpAddrFormat(1)"><a href="./snmpESRPLib.tcl.html#::snmpConvertIpAddrFormat_57">::snmpConvertIpAddrFormat</a></a> $groupAddr]}&#34;

if {$numSource ==0 } {
   set udfOffset  &#34;34 38 46&#34;
   set udfInitval &#34;$val1 $val2 $val3&#34;
   set udfCounterType &#34;c16 c32 c32&#34;
   set udfContinuousCount &#34;false false false&#34;
} else {
   set srcIpAddr1 [lindex $srcIpAddr 0]
   set srcIpAddr2 [lindex $srcIpAddr 1] 
   if {$srcIpAddr2 == &#34;&#34;} { set srcIpAddr2 &#34;0.0.0.0&#34; }
   
   <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;source1 $srcIpAddr1&#34;
   <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;source2 $srcIpAddr2&#34;

   set val4 &#34;{[<a name="::snmpConvertIpAddrFormat(2)"><a href="./snmpESRPLib.tcl.html#::snmpConvertIpAddrFormat_57">::snmpConvertIpAddrFormat</a></a> $srcIpAddr1]}&#34;
   set val5 &#34;{[<a name="::snmpConvertIpAddrFormat(3)"><a href="./snmpESRPLib.tcl.html#::snmpConvertIpAddrFormat_57">::snmpConvertIpAddrFormat</a></a> $srcIpAddr2]}&#34;
   set udfOffset  &#34;34 38 46 50 54&#34;
   set udfInitval &#34;$val1 $val2 $val3 $val4 $val5&#34;
   set udfCounterType &#34;c16 c32 c32 c32 c32&#34;
   set udfContinuousCount &#34;false false false false false&#34;
}

<a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Send an IGMPv3 report of type $type for source $srcIpAddr and \
              group $groupAddr&#34;

set frameSent [<a name="::SendIpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPortId -protocol &#34;igmp&#34; -destIp $multicastIP -destMac $destMacMulticast -groupAddr $groupAddr -sourceIp $hostIp -streamType &#34;$streamType&#34; -frameRate 1 -udfEnable $udf -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCounterType -udfContinuousCount $udfContinuousCount -dataPattern $dataPattern]


<a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;IGMPSent: $frameSent&#34;
return $frameSent
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: sendIgmpv3Report</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to send IGMPv3 Reports</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: Send IGMPv3 Reports</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     sendIgmpv3BadReport -txPortId $host8 -hostIp $host8ip \</span>
<span class="comment-line">#                  -srcIpAddr &#34;$srcIp2&#34; -groupAddr $grpAddr1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: Traffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::sendIgmpv3Report_407">proc <a href="ePTigmp.tcl-annot.html#::::sendIgmpv3Report">::::sendIgmpv3Report</a></a></strong> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> sendIgmpv3Report $args {
     txPortId &#34;1&#34;
     sourceMac &#34;00 A1 F1 00 00 01&#34;
     destMac &#34;01 00 5E 00 00 16&#34;
     hostIp &#34;127.0.0.1&#34;
     destIp &#34;224.0.0.22&#34;
     streamType &#34;stopStream&#34;
     numFrames &#34;10&#34;
     tag &#34;none&#34;
     tagMode &#34;vIdle&#34;
     tagRepeat &#34;1&#34;
     percentage &#34;1&#34;
     saMode &#34;idle&#34;
     daMode &#34;idle&#34;
     ipSaMode &#34;ipIdle&#34;
     ipDaMode &#34;ipIdle&#34;
     reportType &#34;1&#34;
     groupAddr &#34;224.0.0.22&#34;
     srcIpAddr &#34;{}&#34;
     igmpType  &#34;report&#34;
     maxResponseTime &#34;100&#34;
     qqic &#34;127&#34;
     qrv  &#34;0&#34;
     numSource &#34;0&#34;
     numGroup &#34;1&#34;
     fpsRate 0
   }

   if {$tag == &#34;none&#34;} {
       set tagged &#34;false&#34;
   } else {
       set tagged &#34;true&#34;
   } 
<span class="comment-line">#   set streamType &#34;stopStream&#34;</span>
   <a name="::createStreams(1)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn $txPortId -startId 1 -endId 1 -name S1 -type &#34;ipv4_igmp&#34; -writeToHw 0
   set optionsList &#34;&#34;
   lappend optionsList &#34;enable802dot1qTag $tagged&#34;
   <a name="::setStreamOptions(1)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;protocol&#34; \
         -optionVal $optionsList -writeToHw 0

   if {$tagged == &#34;true&#34;} {
       set optionsList &#34;&#34;
       lappend optionsList &#34;vlanID $tag&#34;
       lappend optionsList &#34;mode $tagMode&#34;
       lappend optionsList &#34;repeat $tagRepeat&#34;
       lappend optionsList &#34;step 1&#34;
       <a name="::setStreamOptions(2)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;vlan&#34; \
             -optionVal $optionsList -writeToHw 0
   }
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;$sourceMac\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;81 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   if $fpsRate {
   lappend optionsList &#34;fpsRate $fpsRate&#34;
   lappend optionsList &#34;rateMode streamRateModeFps&#34;
   } else {
   lappend optionsList &#34;rateMode usePercentRate&#34;
   lappend optionsList &#34;percentPacketRate $percentage&#34;
   }
   lappend optionsList &#34;da \&#34;$destMac\&#34;&#34;
   lappend optionsList &#34;dma $streamType&#34;
   lappend optionsList &#34;dataPattern 01&#34;
   lappend optionsList &#34;numFrames $numFrames&#34;
   <a name="::setStreamOptions(3)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal $optionsList -writeToHw 0

   set optionsList &#34;&#34;
   lappend optionsList &#34;sourceIpAddr \&#34;$hostIp\&#34;&#34;
   lappend optionsList &#34;sourceIpAddrMode $ipSaMode&#34;
   lappend optionsList &#34;sourceIpAddrRepeatCount $numFrames&#34;
   lappend optionsList &#34;destIpAddr \&#34;$destIp\&#34;&#34;
   lappend optionsList &#34;destIpAddrMode $ipDaMode&#34;
   lappend optionsList &#34;destIpAddrRepeatCount $numFrames&#34;
   lappend optionsList &#34;ttl 1&#34;
   lappend optionsList &#34;options 94040000&#34;
   lappend optionsList &#34;qosMode 1&#34;
   lappend optionsList &#34;dscpMode 3&#34;
<span class="comment-line">#   lappend optionsList &#34;dscpValue C0&#34;</span>
<span class="comment-line">#   lappend optionsList &#34;fragment 1&#34;</span>
   <a name="::setStreamOptions(4)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal $optionsList -writeToHw 0

   if {$igmpType == &#34;query&#34;} {
       set sFlag &#34;true&#34;
<span class="comment-line">#       set igmpType &#34;membershipQuery&#34;</span>
       set igmpType 17
   } else {
       set sFlag &#34;false&#34;
       set igmpType 34
   }
   
   set optionsList &#34;&#34;
   lappend optionsList &#34;type $igmpType&#34;
   lappend optionsList &#34;version igmpVersion3&#34;
   lappend optionsList &#34;qqic $qqic&#34;
   lappend optionsList &#34;qrv  $qrv&#34;
   lappend optionsList &#34;maxResponseTime $maxResponseTime&#34;
   lappend optionsList &#34;igmpGroupRecordtype $reportType&#34;
   set numSource [llength $srcIpAddr]  
   lappend optionsList &#34;igmpGroupno_of_src $numSource&#34;
   lappend optionsList &#34;igmpGroupmulticastAddress $groupAddr&#34;
   lappend optionsList &#34;igmpGroupsourceIpAddressList {\&#34;$srcIpAddr\&#34;}&#34;
   <a name="::setStreamOptions(5)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;igmp&#34; \
         -optionVal $optionsList -writeToHw 0
   
   <a name="::WriteStreamsToHw(1)"><a href="./ePTStreams.tcl.html#::WriteStreamsToHw_161">::WriteStreamsToHw</a></a> $txPortId
   <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2

   <a name="::displayIGMPv3PacketFormat(1)"><a href="./frameFormat.tcl.html#::displayIGMPv3PacketFormat_564">::displayIGMPv3PacketFormat</a></a>  -txPortId &#34;$txPortId&#34; \
     -sourceMac &#34;$sourceMac&#34; \
     -destMac &#34;$destMac&#34; \
     -hostIp &#34;$hostIp&#34; \
     -destIp &#34;$destIp&#34; \
     -streamType &#34;$streamType&#34; \
     -numFrames &#34;$numFrames&#34; \
     -tag &#34;$tag&#34; \
     -tagMode &#34;$tagMode&#34; \
     -tagRepeat &#34;$tagRepeat&#34; \
     -percentage &#34;$percentage&#34; \
     -saMode &#34;$saMode&#34; \
     -daMode &#34;$daMode&#34; \
     -ipSaMode &#34;$ipSaMode&#34; \
     -ipDaMode &#34;$ipDaMode&#34; \
     -reportType &#34;$reportType&#34; \
     -groupAddr &#34;$groupAddr&#34; \
     -srcIpAddr &#34;{$srcIpAddr}&#34; \
     -igmpType  &#34;$igmpType&#34; \
     -maxResponseTime &#34;$maxResponseTime&#34; \
     -qqic &#34;$qqic&#34; \
     -qrv  &#34;$qrv&#34;

   <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId ixChassis ixCard ixPort
   <a name="::stream(1)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> get $ixChassis $ixCard $ixPort 1
   set streamSent [<a name="::stream(2)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> cget -packetView]
   <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$streamSent&#34;

   <a name="::StartPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StartPortsTransmit_922">::StartPortsTransmit</a></a> $txPortId

}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
