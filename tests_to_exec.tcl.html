<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>tests_to_exec.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#tests_to_exec.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>tests_to_exec.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="tests_to_exec.tcl-annot.html">annotations</a> | <a href="tests_to_exec.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line"># --------------------------------------------------------------------------</span>
<span class="comment-line"># proc _initCompleteTests</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Create all variables associated with a completetests.lst</span>
<span class="comment-line"># --------------------------------------------------------------------------</span>
<strong><a name="::::_initCompleteTests_6">proc <a href="tests_to_exec.tcl-annot.html#::::_initCompleteTests">::::_initCompleteTests</a></a></strong><a name="::::_initCompleteTests"></a> {args} {
    global MAIN LSTGROUPING CTLIST

    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _initCompleteTests $args {
        regPath    &#34;null&#34; 
        module     &#34;null&#34;
        <a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a>    &#34;null&#34;
        platform   &#34;null&#34;
        lst        &#34;null&#34;
    }

    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;---      Get CT List     ---&#34;
    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Feature $module Version $version Platform $platform list $lst&#34;

    set regPath [string trim $regPath &#34;.&#34;]
    set regPath [string trim $regPath &#34;/&#34;]
    set regPath [<a name="::_verifyRegPathArg(1)"><a href="./filetools.tcl.html#::_verifyRegPathArg_107">::_verifyRegPathArg</a></a> -regPath $regPath -initPath &#34;$MAIN(autoRoot)&#34;];<span class="comment-line">#</span>
    set modulePath [_verifyModuleNameArg $regPath $module]

    set cliCheck [<a name="::::_checkForCliReg(1)"><a href="./tests_to_exec.tcl.html#::::_checkForCliReg_259">::::_checkForCliReg</a></a> $modulePath]
    if {$cliCheck == 0} {
        <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;CLI Regression completetests.lst locate failed&#34;
    } elseif {$cliCheck != &#34;normal&#34;} {
        set modulePath $cliCheck
    }

    if ![file exists ${modulePath}/completetests.lst] {
        <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Does Not Exist: ${modulePath}/completetests.lst&#34;
        return 0;
    }
    
    <span class="comment-line"># open compltetetests.lst for reading</span>
    if {[set fd_in [<a name="::FileOpen(1)"><a href="./queueLib.tcl.html#::FileOpen_58">::FileOpen</a></a> &#34;${modulePath}/completetests.lst&#34; r]]==-1} {
        return 0;
    }
    <span class="comment-line"># open tmp file</span>
    set pid [pid]
    if {[set fd_t [<a name="::FileOpen(2)"><a href="./queueLib.tcl.html#::FileOpen_58">::FileOpen</a></a> &#34;/tmp/${pid}_ct_tmp.lst&#34; w]]==-1} {
        return 0;
    }
    <span class="comment-line"># make sure version is minor</span>
    set vlist [split $version &#34;.&#34;]
    set version &#34;[lindex $vlist 0].[lindex $vlist 1]&#34;
    <span class="comment-line"># make platform ctests standard</span>
    set plat [<a name="::::_getSkipPlatName(1)"><a href="./tests_to_exec.tcl.html#::::_getSkipPlatName_174">::::_getSkipPlatName</a></a> $platform]
    <span class="comment-line"># clean lines from completetests.lst</span>
    set cleanlines &#34;&#34;
    while {[gets $fd_in line] != -1} {
        set nline [string trim $line]
        set llist [split $nline &#34;;&#34;]
        set n1line [lindex $llist 0]
        if {[regexp {^set} $n1line] || [regexp {^global} $n1line] || $n1line == &#34;\}&#34;} {
            set n2line [string trim $nline &#34;;&#34;]
            if {$n1line == &#34;\}&#34;} {
                set n2line $n1line
            }
        } else {
            set llist [split $n1line &#34;#&#34;]
            set n2line [string trim [lindex $llist 0]]
        }
        if {[regexp {^([a-zA-Z0-9_\.\-\}\{]+)} $n2line]} {
            set final [split $n2line &#34; &#34;]
            if {[llength $final] == 1 || [lindex $final 0] == &#34;set&#34; || \
                  [lindex $final 0] == &#34;global&#34; || [lindex $final 0] == &#34;\}&#34;} {
                puts $fd_t &#34;$n2line&#34;
            }
        }
    }
    close $fd_t;
    close $fd_in;

    if {[catch {source &#34;/tmp/${pid}_ct_tmp.lst&#34;} oops]} {
        <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;Failed to source: /tmp/${pid}_ct_tmp.lst $oops&#34;
        catch {file delete &#34;/tmp/${pid}_ct_tmp.lst&#34;} oops
        return 0;
    } else {
        catch {file delete &#34;/tmp/${pid}_ct_tmp.lst&#34;} oops
    }

    <span class="comment-line">#MAIN(lst_arrays)</span>

    set CTLIST(quick_pass_all_dev) &#34;&#34;
    set CTLIST(quick_pass_all) &#34;&#34;
    set CTLIST(quick_pass) &#34;&#34;
    set CTLIST(quick) &#34;&#34;
    set CTLIST(pass) &#34;&#34;
    set CTLIST(all) &#34;&#34;
    set CTLIST(dev) &#34;&#34;
    set CTLIST(debug) &#34;&#34;
    set CTLIST(all_dev_debug) &#34;&#34;
    set CTLIST(dev_debug) &#34;&#34;
    set CTLIST(skip_version) &#34;&#34;
    set CTLIST(skip_platform) &#34;&#34;
    foreach lst_array $MAIN(lst_arrays) {
        if {[array exists $lst_array]} {
            foreach index [array names $lst_array] {
                set TLSTS($lst_array,$index) &#34;[set [set lst_array]($index)]&#34;
                foreach t $TLSTS($lst_array,$index) {
                    <span class="comment-line"># create quick pass all dev</span>
                    if {[string trim $t] != &#34;&#34; &amp;&amp; $lst_array != &#34;tests_to_skip&#34;} {
                        if {[regexp -nocase {[0-9]+\.[0-9]} $index]} {
                            puts &#34;Found release $index - version in $version&#34;
                            if {[<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $index $version] &gt; 0} {
                                lappend CTLIST(skip_version) $t
                            }
                        }
                        switch $lst_array {
                            &#34;tests_to_run_quick&#34; {
                                lappend CTLIST(quick_pass_all_dev) $t
                                lappend CTLIST(quick_pass_all) $t
                                lappend CTLIST(quick_pass) $t
                                lappend CTLIST(quick) $t
                            }
                            &#34;tests_to_run_pass&#34; {
                                lappend CTLIST(quick_pass_all_dev) $t
                                lappend CTLIST(quick_pass_all) $t
                                lappend CTLIST(quick_pass) $t
                                lappend CTLIST(pass) $t
                            }
                            &#34;tests_to_run_all&#34; {
                                lappend CTLIST(quick_pass_all_dev) $t
                                lappend CTLIST(quick_pass_all) $t
                                lappend CTLIST(all) $t
                                lappend CTLIST(all_dev_debug) $t
                            }
                            &#34;tests_to_run_dev&#34; {
                                lappend CTLIST(quick_pass_all_dev) $t
                                lappend CTLIST(dev) $t
                                lappend CTLIST(all_dev_debug) $t
                                lappend CTLIST(dev_debug) $t
                            }
                            &#34;tests_to_run_debug&#34; {
                                lappend CTLIST(debug) $t
                                lappend CTLIST(all_dev_debug) $t
                                lappend CTLIST(dev_debug) $t
                            }
                        }
                    }
                    if {[string trim $t] != &#34;&#34; &amp;&amp; $lst_array == &#34;tests_to_skip&#34; &amp;&amp; $index == &#34;$plat&#34;} {
                        lappend CTLIST(skip_platform) $t
                    }
                }
            }
        }
    }
    <span class="comment-line"># ---  LSTGROUPING(alldevdebug)</span>
    puts &#34;------------------ lst in $lst&#34;
    if {[info exists LSTGROUPING($lst)] &amp;&amp; [info exists CTLIST($LSTGROUPING($lst))]} {
        puts $CTLIST($LSTGROUPING($lst))
    }
    puts &#34;-----------   skip platform&#34;
    puts $CTLIST(skip_platform)

    puts &#34;-----------   skip version&#34;
    puts $CTLIST(skip_version)
}

<span class="comment-line"># --------------------------------------------------------------------------</span>
<span class="comment-line"># proc _getSkipPlatName</span>
<span class="comment-line">#</span>
<span class="comment-line">#    Legacy migration returning old tests_to_skip(NAME) </span>
<span class="comment-line">#</span>
<span class="comment-line">#    Args:  in = platform</span>
<span class="comment-line">#           out = NAME</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#   set plat [_getSkipPlatName $platform]</span>
<span class="comment-line"># --------------------------------------------------------------------------</span>
<strong><a name="::::_getSkipPlatName_174">proc <a href="tests_to_exec.tcl-annot.html#::::_getSkipPlatName">::::_getSkipPlatName</a></a></strong><a name="::::_getSkipPlatName"></a> {platform} {
    global gnssPlatform bcmPlatform i386Platform  pioneerPlatform bcmx440
    global tests_to_skip

    set plat platform

    set plat $platform

    if {[regexp -nocase $gnssPlatform $platform]} {
       set plat gnssPlatform
    }
    if {[regexp -nocase $pioneerPlatform $platform]} {
       set plat pioneerPlatform
    }
    if {[info exists tests_to_skip(mariner)]} {
       if {[regexp -nocase &#34;bd-10808&#34; $platform]} {
          set plat mariner
       }
    }
    if {[info exists tests_to_skip(olympic)]} {
       if {[regexp -nocase &#34;bd-89|bd-128&#34; $platform]} {
          set plat olympic
       }
    }
    if {[info exists tests_to_skip(torino)]} {
       if {[regexp -nocase &#34;bd-128&#34; $platform]} {
          set plat torino
       }
    }

    if {[info exists tests_to_skip(pioneer)]} {
       if {[regexp -nocase &#34;bd-16808&#34; $platform]} {
          set plat pioneer
       }
    }

    if {[regexp -nocase $bcmPlatform $platform]} {
       set plat bcmPlatform
       if {[regexp -nocase &#34;vpex|vpex_onie&#34; $platform]} {
          set plat &#34;vpex&#34;
       } 
    }

    if {[info exists tests_to_skip(bcmx440)]} {
        if {[regexp -nocase $bcmx440 $platform]} {
           set plat bcmx440
        }
    }

    if {[info exists tests_to_skip(SummitX450)]} {
       if {[regexp -nocase &#34;X450|x250|x150|x350|x650|SummitX406|NWI|x480|x460|x670|x670g2|e4g|x440|x770&#34; $platform]} {
          set plat SummitX450
       }
    }

    if {[info exists tests_to_skip(Aspen)]} {
       if {[regexp -nocase &#34;Aspen|BD-88|XCM&#34; $platform]} {
          set plat Aspen
       }
    }
    if {[info exists tests_to_skip(Everest)]} {
       if {[regexp -nocase &#34;BD-X8&#34; $platform]} {
          set plat Everest
       }
    }

    if {[regexp -nocase $i386Platform $platform]} {
       set plat i386Platform
    }
    if {[info exists tests_to_skip(Summit-PC)]||[info exists tests_to_skip(BD-PC)]} {
       if {[regexp -nocase &#34;Summit-PC|BD-PC&#34; $platform]} {
          set plat $platform
       }
    }

    return $plat

}

<span class="comment-line"># ----------------------------------------------------------------------------------</span>
<span class="comment-line"># proc _checkForCliReg</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># ----------------------------------------------------------------------------------</span>
<strong><a name="::::_checkForCliReg_259">proc <a href="tests_to_exec.tcl-annot.html#::::_checkForCliReg">::::_checkForCliReg</a></a></strong><a name="::::_checkForCliReg"></a> {modulePath} {

    if { [regexp -nocase &#34;uploadanddownload&#34; $modulePath cliReg] || \
         [regexp -nocase &#34;upgradedowngrade&#34; $modulePath cliReg] } {
        set ret [regsub $cliReg $modulePath &#34;cli-ew&#34; cliPath]
        if { $ret == 0 } {
            puts &#34;ERROR: Error in processing cli completetest.lst&#34;
            return $ret
        }
        return $cliPath
    } else {
        return &#34;normal&#34;
    }

}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
