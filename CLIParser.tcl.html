<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>CLIParser.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#CLIParser.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>CLIParser.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="CLIParser.tcl-annot.html">annotations</a> | <a href="CLIParser.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: Start_Version_Parser</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Part of the CLI Parser. Process start version section and </span>
<span class="comment-line">#              make sure it process the platform section if there is one. </span>
<span class="comment-line">#              Return the command list.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: CLICommandList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::Start_Version_Parser_18">proc <a href="CLIParser.tcl-annot.html#::::Start_Version_Parser">::::Start_Version_Parser</a></a></strong> {CLICommandList} {

    set RList &#34;&#34;;
    set listLength [llength $CLICommandList];
    set idx $listLength;
    set state 0;
    <span class="comment-line">##puts &#34;Length = $idx&#34;;</span>
    <span class="comment-line">##puts &#34;List = $CLICommandList&#34;;</span>
    set insidePlatformBlock 0
    while {$listLength} {
        <span class="comment-line"># -- get the line and change it to lowercase</span>
        set line [string tolower [lindex $CLICommandList [expr $idx - $listLength]]];
        set line [string trim $line];
        set firstword [string tolower [lindex $line 0]];

        if {[string length $firstword] == 0} {
            incr listLength -1;
            continue;
        }

        if {$insidePlatformBlock == 0} {
          <span class="comment-line"># --- check for start platform section</span>
          if {[regexp -nocase &#34;start_platform&#34; $line] } {
            set insidePlatformBlock 1
          }
        }
        if {$insidePlatformBlock == 1} {
          <span class="comment-line"># --- check for end platform section</span>
          if {[regexp -nocase &#34;end_platform&#34; $line] } {
            set insidePlatformBlock 0
          }
        }

        <span class="comment-line"># -- if state is not 0, we need to check for recursive</span>
        <span class="comment-line"># -- and not inside a platform block</span>
        if {($state == 0) &amp;&amp; ($insidePlatformBlock == 0)} {
            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $firstword]} {
                regsub -all {&gt;} $firstword {} versionFound;
                regsub -all {&lt;} $versionFound {} versionFound;
                regsub -all { } $versionFound {} versionFound;
                if {$versionFound == &#34;default&#34;} {
                    set state 1; 
                } else {
                    set rval [<a name="::cliCompareVersion(1)"><a href="./CLIParser.tcl.html#::cliCompareVersion_977">::cliCompareVersion</a></a> $versionFound];
                    if {$rval == 0} {
                        set state 1;
                    }
                }                        
            }
        } elseif {$state == 1} {
            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $firstword]} {
                incr listLength -1;
                continue;
            } else {
                <span class="comment-line"># --- check for start platform </span>
                if {[regexp -nocase &#34;start_platform&#34; $line] } {
                    set buffer &#34;&#34;;
                    incr listLength -1;
                    set line [string tolower [lindex $CLICommandList [expr $idx - $listLength]]];
                    set line [string trim $line];
                    while {(![regexp -nocase &#34;end_platform&#34; $line]) &amp;&amp; ($listLength &gt;=0)} {                    
                        lappend buffer $line;
                        incr listLength -1;
                        set line [string tolower [lindex $CLICommandList [expr $idx - $listLength]]];
                        set line [string trim $line];
                    }     
                    <span class="comment-line"># -- parse start platform section</span>
                    <span class="comment-line">##result_debug &#34;buffer ===&gt; $buffer&#34;;                    </span>
                    if {[llength $buffer] &gt; 0} {                    
                        set SPPlist [<a name="::Start_Platform_Parser(1)"><a href="./CLIParser.tcl.html#::Start_Platform_Parser_126">::Start_Platform_Parser</a></a> $buffer];
                        foreach command $SPPlist {         
                            lappend RList [string trim $command &#34; \t&#34;]
                        }  
                    }
                } else {
                    lappend RList $line;
                }    
                set state 2;
            }
        } elseif {$state == 2} {
            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $firstword]} {
                return $RList;
            } else {
                lappend RList $line;
                set state 2;
            }
        }
        incr listLength -1;
    }  
    return $RList;  
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: Start_Platform_Parser</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Part of the CLI Parser. Process the start platform section and</span>
<span class="comment-line">#              make sure it process the version section if there is one. </span>
<span class="comment-line">#              Return the command list.</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: CLICommandList {DUT_number &#34;DUT1&#34;}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::Start_Platform_Parser_126">proc <a href="CLIParser.tcl-annot.html#::::Start_Platform_Parser">::::Start_Platform_Parser</a></a></strong> {CLICommandList {DUT_number &#34;DUT1&#34;}} {
        
    set RList &#34;&#34;;
    set listLength [llength $CLICommandList];
    set idx $listLength;
    set state 0;
    <span class="comment-line">##puts &#34;Length = $idx&#34;;</span>
    <span class="comment-line">##puts &#34;List = $CLICommandList&#34;;</span>
    set insideVersionBlock 0
    while {$listLength &gt; 0} {
        <span class="comment-line"># -- get the line and change it to lowercase</span>
        set line [string tolower [lindex $CLICommandList [expr $idx - $listLength]]];
        set line [string trim $line];
        set firstword [string tolower [lindex $line 0]];
        if {[string length $firstword] == 0} {
            incr listLength -1;
            continue;
        }

        if {$insideVersionBlock == 0} {
          <span class="comment-line"># --- check for start version section</span>
          if {[regexp -nocase &#34;start_version&#34; $line] } {
            set insideVersionBlock 1
          }
        }
        if {$insideVersionBlock == 1} {
          <span class="comment-line"># --- check for end version section</span>
          if {[regexp -nocase &#34;end_version&#34; $line] } {
            set insideVersionBlock 0
          }
        }

        <span class="comment-line"># -- if state is not 0, we need to check for recursive</span>
        <span class="comment-line"># -- if we are not inside a VERSION block</span>
        if {($state == 0) &amp;&amp; ($insideVersionBlock == 0)} {


            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $firstword]} {
                regsub -all {&gt;} $firstword {} platformFound;
                regsub -all {&lt;} $platformFound {} platformFound;
                regsub -all { } $platformFound {} platformFound;
                if {$platformFound == &#34;default&#34;} {
                    set state 1; 
                } else {
                    if {$platformFound == [string tolower [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>]]} {
                        set state 1;
                    }
                }                        
            }
        } elseif {$state == 1} {
            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $firstword]} {
                incr listLength -1;
                continue;
            } else {
                 <span class="comment-line"># --- check for start version section</span>
                if {[regexp -nocase &#34;start_version&#34; $line] } {
                    set buffer &#34;&#34;;
                    incr listLength -1;
                    set line [string tolower [lindex $CLICommandList [expr $idx - $listLength]]];
                    set line [string trim $line];
                    while {(![regexp -nocase &#34;end_platform&#34; $line]) &amp;&amp; ($listLength &gt;=0)} {                    
                        lappend buffer $line;
                        incr listLength -1;
                        set line [string tolower [lindex $CLICommandList [expr $idx - $listLength]]];
                        set line [string trim $line];
                    }     
                    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;buffer ===&gt; $buffer&#34;;
                    if {[llength $buffer] &gt; 0} {                    
                        set SPPlist [<a name="::Start_Version_Parser(1)"><a href="./CLIParser.tcl.html#::Start_Version_Parser_18">::Start_Version_Parser</a></a> $buffer];
                        foreach command $SPPlist {         
                            lappend RList [string trim $command &#34; \t&#34;]
                        }  
                    }
                } else {
                    lappend RList $line;
                }    
                set state 2;
            }
        } elseif {$state == 2} {
            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $firstword]} {
                return $RList;
            } else {
                lappend RList $line;
                set state 2;
            }
        }
        incr listLength -1;
    }  
    return $RList;  
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: Start_VR_Parser</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Part of the CLI Parser. Process the start VR section and not </span>
<span class="comment-line">#	       process the version section nor platform section </span>
<span class="comment-line">#	       if there is one. </span>
<span class="comment-line">#              Return the command list.</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: CLICommandList {DUT_number &#34;DUT1&#34;}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::Start_VR_Parser_234">proc <a href="CLIParser.tcl-annot.html#::::Start_VR_Parser">::::Start_VR_Parser</a></a></strong> {CLICommandList {DUT_number &#34;DUT1&#34;}} {
        
    set RList &#34;&#34;;
    set listLength [llength $CLICommandList];
    set idx $listLength;
    set state 0;
    <span class="comment-line">##puts &#34;Length = $idx&#34;;</span>
    <span class="comment-line">##puts &#34;List = $CLICommandList&#34;;</span>
    while {$listLength} {
        <span class="comment-line"># -- get the line and change it to lowercase</span>
        set line [string tolower [lindex $CLICommandList [expr $idx - $listLength]]];
        set line [string trim $line];
        set firstword [string tolower [lindex $line 0]];
        if {[string length $firstword] == 0} {
            incr listLength -1;
            continue;
        }
        <span class="comment-line"># -- if state is not 0, we need to check for recursive</span>
        if {$state == 0} {
            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $firstword]} {
                regsub -all {&gt;} $firstword {} VrFound;
                regsub -all {&lt;} $VrFound {} VrFound;
                regsub -all { } $VrFound {} VrFound;
                if {$VrFound == &#34;default&#34;} {
                    set state 1; 
                } else {
                    if {$VrFound == [string tolower [<a name="::GetVrString(1)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a>]]} {
                        set state 1;
                    }
                }                        
            }
        } elseif {$state == 1} {
            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $firstword]} {
                incr listLength -1;
                continue;
            } else {
                 <span class="comment-line"># --- check for start version section</span>
                if {[regexp -nocase &#34;start_version&#34; $line] } {
                    set buffer &#34;&#34;;
                    incr listLength -1;
                    set line [string tolower [lindex $CLICommandList [expr $idx - $listLength]]];
                    set line [string trim $line];
                    while {(![regexp -nocase &#34;end_vr&#34; $line]) &amp;&amp; ($listLength &gt;=0)} {                    
                        lappend buffer $line;
                        incr listLength -1;
                        set line [string tolower [lindex $CLICommandList [expr $idx - $listLength]]];
                        set line [string trim $line];
                    }     
                    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;buffer ===&gt; $buffer&#34;;
                    if {[llength $buffer] &gt; 0} {                    
                        set SPPlist [<a name="::Start_Version_Parser(2)"><a href="./CLIParser.tcl.html#::Start_Version_Parser_18">::Start_Version_Parser</a></a> $buffer];
                        foreach command $SPPlist {         
                            lappend RList [string trim $command &#34; \t&#34;]
                        }  
                    }
                } else {
                    lappend RList $line;
                }    
                set state 2;
            }
        } elseif {$state == 2} {
            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $firstword]} {
                return $RList;
            } else {
                lappend RList $line;
                set state 2;
            }
        }
        incr listLength -1;
    }  
    return $RList;  
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: FilterAllCommands</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Part of CLI Parser. Get start platform or start version</span>
<span class="comment-line">#               CLI comands. Then return the command list.</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: CLIList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::FilterAllCommands_322">proc <a href="CLIParser.tcl-annot.html#::::FilterAllCommands">::::FilterAllCommands</a></a></strong> {CLIList} {
   set returnList &#34;&#34;;
   set verList &#34;&#34;;
   set listLength [llength $CLIList];
   for {set i 0}  {$i &lt; $listLength} {incr i} {
      <span class="comment-line"># -- get the commands that belong to the test platform and release software </span>
      set line [lindex $CLIList $i];
      if {[regexp -nocase &#34;start_platform&#34; $line] } {
         <span class="comment-line"># -- gather all commands for the tested platform</span>
         if {[info exist platformArray]} {unset platformArray }
         while {1} {
            incr i;
            set line [lindex $CLIList $i];
            if {[regexp -nocase &#34;end_platform&#34; $line] } {
                set rlist [<a name="::Start_Platform_Parser(2)"><a href="./CLIParser.tcl.html#::Start_Platform_Parser_126">::Start_Platform_Parser</a></a> $platformArray];
                foreach command $rlist {         
                    lappend returnList [string trim $command &#34; \t&#34;];
                }     
                break;
            } else {
               lappend platformArray $line;               
            }
         }
      } elseif {[regexp -nocase &#34;start_version&#34; $line] } {
         <span class="comment-line"># -- gather all commands for the tested release software</span>
         if {[info exist versionArray]} {unset versionArray }   
         while {1} {
            incr i;
            set line [lindex $CLIList $i];
            if {[regexp -nocase &#34;end_version&#34; $line] } { 
                set rlist [<a name="::Start_Version_Parser(3)"><a href="./CLIParser.tcl.html#::Start_Version_Parser_18">::Start_Version_Parser</a></a> $versionArray];
                foreach command $rlist {         
                    lappend returnList [string trim $command &#34; \t&#34;];
                }               
                break;
            } else {
                lappend versionArray $line;
            }
         }
      } elseif {[regexp -nocase &#34;start_vr&#34; $line] } {
         <span class="comment-line"># -- gather all commands for the tested virtual router</span>
         if {[info exist vrArray]} {unset vrArray }   
         while {1} {
            incr i;
            set line [lindex $CLIList $i];
            if {[regexp -nocase &#34;end_vr&#34; $line] } { 
                set rlist [<a name="::Start_VR_Parser(1)"><a href="./CLIParser.tcl.html#::Start_VR_Parser_234">::Start_VR_Parser</a></a> $vrArray];
                foreach command $rlist {         
                    lappend returnList [string trim $command &#34; \t&#34;];
                }               
                break;
            } else {
                lappend vrArray $line;
            }
         }
      } elseif {![<a name="::IsInKeywordList(1)"><a href="./CLIFileParser.tcl.html#::IsInKeywordList_71">::IsInKeywordList</a></a> $line]} {
         lappend returnList [string trimleft $line &#34; \t&#34;];
      }
   }
   <span class="comment-line">##result_debug &#34;returnList = $returnList&#34;;</span>
   return $returnList;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: RunCommandAndCheck</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Part of CLI Parser. This is the main function. It processes</span>
<span class="comment-line">#               the CLI commands based on the group.</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: CLIList testNumber {flag &#34;first&#34;}</span>
<span class="comment-line">#	flag : 	first - first pass</span>
<span class="comment-line">#		firstlast - first and last pass</span>
<span class="comment-line">#		second - second pass</span>
<span class="comment-line">#		secondlast - second and last pass</span>
<span class="comment-line">#		third - thid pass</span>
<span class="comment-line">#		thirdlast - third and last pass</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::RunCommandAndCheck_406">proc <a href="CLIParser.tcl-annot.html#::::RunCommandAndCheck">::::RunCommandAndCheck</a></a></strong> {CLIList testNumber {optflag &#34;true&#34;}} {
   global DUT1_DefaultBlade

   set listLength [llength $CLIList];
   set index 0;
   set i 1;
   while {$index &lt; $listLength} {
      set groupList [<a name="::GetGroupList(1)"><a href="./CLIFileParser.tcl.html#::GetGroupList_35">::GetGroupList</a></a> $CLIList $listLength index];
      set keywordLine [lindex $groupList 0];
      <span class="comment-line">#puts &#34;keywordLine = $keywordLine&#34;</span>
      <span class="comment-line">#puts &#34;groupList = $groupList&#34;</span>
      <span class="comment-line"># -- process the command and showcli section</span>
      <span class="comment-line">#result_debug &#34;groupList: $groupList&#34;</span>
      <span class="comment-line">#result_debug &#34;keywordLine: $keywordLine&#34;</span>
      <span class="comment-line">#result_debug &#34;optflag: $optflag&#34;</span>
      if {[regexp -nocase -- &#34;command:&#34; $keywordLine]} {
          <span class="comment-line">#result_debug &#34;between filterList&#34;</span>
          <span class="comment-line">#result_debug &#34;optflag: $optflag&#34;</span>
          <span class="comment-line"># -- process CLI command section  </span>
	  if {[regexp -nocase -- &#34;first*&#34; $optflag]} {
              <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;before filterList&#34;
              set filterList [<a name="::FilterAllCommands(1)"><a href="./CLIParser.tcl.html#::FilterAllCommands_322">::FilterAllCommands</a></a> $groupList];    
              <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;command filterList: $filterList&#34;
              set tmp &#34;$testNumber.$i&#34;;
              <span class="comment-line">################################################</span>
              set subTest &#34;$tmp Check commands for legal&#34;
              <span class="comment-line">################################################</span>
              result_h2 &#34;$subTest&#34;
              <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;         
              <a name="::ProcessCommand(1)"><a href="./CLIParser.tcl.html#::ProcessCommand_548">::ProcessCommand</a></a> $filterList $tmp;
              <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>          
              incr i;    
          }    
      } elseif {[regexp -nocase &#34;showcli:&#34; $keywordLine]} {
          <span class="comment-line">#result_debug &#34;before showcli filterList&#34;</span>
          <span class="comment-line"># -- process CLI show section</span>
          set filterList [<a name="::FilterAllCommands(2)"><a href="./CLIParser.tcl.html#::FilterAllCommands_322">::FilterAllCommands</a></a> $groupList]
          <span class="comment-line">#result_debug &#34;showcli filterList: $filterList&#34;</span>
          set idx [lsearch $filterList &#34;output:&#34;];
          set getshowcommand [lindex $filterList [expr $idx - 1]];
          set tmp &#34;$testNumber.$i&#34;;
          <span class="comment-line">################################################</span>
          set subTest &#34;$tmp Check output ($getshowcommand)&#34;;
          <span class="comment-line">################################################</span>
          result_h2 &#34;$subTest&#34;;
          <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
          <a name="::ProcessShow(1)"><a href="./CLIParser.tcl.html#::ProcessShow_653">::ProcessShow</a></a> $filterList $tmp;
          <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
          incr i;
      } elseif {[regexp -nocase &#34;showcli_once:&#34; $keywordLine]} {
          <span class="comment-line">#result_debug &#34;before showcli1 filterList&#34;</span>
	  if {[regexp -nocase -- &#34;first*&#34; $optflag]} {
          <span class="comment-line"># -- process CLI show section for pass 1 only</span>
             set filterList [<a name="::FilterAllCommands(3)"><a href="./CLIParser.tcl.html#::FilterAllCommands_322">::FilterAllCommands</a></a> $groupList]
             <span class="comment-line">#result_debug &#34;showcli1 filterList: $filterList&#34;</span>
             set idx [lsearch $filterList &#34;output:&#34;];
             set getshowcommand [lindex $filterList [expr $idx - 1]];
             set tmp &#34;$testNumber.$i&#34;;
             <span class="comment-line">################################################</span>
             set subTest &#34;$tmp Check output ($getshowcommand)&#34;;
             <span class="comment-line">################################################</span>
             result_h2 &#34;$subTest&#34;;
             <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
             <a name="::ProcessShow(2)"><a href="./CLIParser.tcl.html#::ProcessShow_653">::ProcessShow</a></a> $filterList $tmp;
             <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
             incr i;
	  }
      } elseif {[regexp -nocase &#34;sendafile:&#34; $keywordLine]} {
          <span class="comment-line">#result_debug &#34;before sendafile filterList&#34;</span>
	  if {[regexp -nocase -- &#34;first*&#34; $optflag]} {
 	     global tftpServerList;
	     set tftpServer [lindex $tftpServerList 0]
          <span class="comment-line"># -- process SendAFile section for pass 1 only</span>
             set filterList [<a name="::FilterAllCommands(4)"><a href="./CLIParser.tcl.html#::FilterAllCommands_322">::FilterAllCommands</a></a> $groupList]
             <span class="comment-line">#result_debug &#34;sendafile filterList: $filterList&#34;</span>
	     set pwd [pwd]
	     set moduleName [file tail $pwd]
	     set dirName &#34;../../cli-ew/$moduleName/&#34;
	     foreach SendFileArgs $filterList {
                <span class="comment-line">#set SendFileArgs [lindex $filterList 0];</span>
	        set ArgsList [split $SendFileArgs &#34; &#34;]
	        if {[llength $ArgsList] == 1} {
	           set localFile [lindex $ArgsList 0]
	           set remoteFile $localFile
	        } else {
	           set localFile [lindex $ArgsList 1]
	           set remoteFile [lindex $ArgsList 3]
	        }
	        set localFile [string trim $localFile {}]
	        set localFile &#34;$dirName$localFile&#34;
                set tmp &#34;$testNumber.$i&#34;;
                <span class="comment-line">################################################</span>
                set subTest &#34;$tmp  (SendAFile $tftpServer $localFile $remoteFile)&#34;;
                <span class="comment-line">################################################</span>
                result_h2 &#34;$subTest&#34;;
                <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
                <a name="::::cliSendAFile(1)"><a href="./upgradecheck.tcl.html#::::cliSendAFile_947">::::cliSendAFile</a></a> $tftpServer &#34;$localFile&#34; $remoteFile
                <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                incr i;
	     }
	  }
      } elseif {[regexp -nocase &#34;deleteafile:&#34; $keywordLine]} {
	  if {[regexp -nocase -- &#34;last*&#34; $optflag]} {
          <span class="comment-line"># -- process DeleteAFile section for last pass only</span>
             set filterList [<a name="::FilterAllCommands(5)"><a href="./CLIParser.tcl.html#::FilterAllCommands_322">::FilterAllCommands</a></a> $groupList]
             <span class="comment-line">#result_debug &#34;deleteafile filterList: $filterList&#34;</span>
	     foreach SendFileArgs $filterList {
                <span class="comment-line">#set SendFileArgs [lindex $filterList 0];</span>
	        set ArgsList [split $SendFileArgs &#34; &#34;]
	        set remoteFile [lindex $ArgsList 0]
	        set remoteFile [string trim $remoteFile {}]
                set tmp &#34;$testNumber.$i&#34;;
                <span class="comment-line">################################################</span>
                set subTest &#34;$tmp  (DeleteAFile $remoteFile)&#34;;
                <span class="comment-line">################################################</span>
                result_h2 &#34;$subTest&#34;;
                <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
                <a name="::DeleteAFile(1)"><a href="./misc.tcl.html#::DeleteAFile_3066">::DeleteAFile</a></a> $remoteFile
                <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                incr i;
	     }
	  }
      }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ProcessCommand</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Part of CLI Parser. Process the command part. Make sure </span>
<span class="comment-line">#              there is no cli error. Also check for platform and version. </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: filterCommandList testNo</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ProcessCommand_548">proc <a href="CLIParser.tcl-annot.html#::::ProcessCommand">::::ProcessCommand</a></a></strong> {filterCommandList testNo} {
    global DUT1_DefaultBlade;
    global tmpPath;
    
    set i 0;
    <span class="comment-line">#set filterCommand [FilterAllCommands $groupList]       </span>
    set cmdListLength1 [llength $filterCommandList]
    <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SendInTheCommand: $filterCommandList&#34;
    set filterCommandList [<a name="::ExpandCommands(1)"><a href="./CLIParser.tcl.html#::ExpandCommands_812">::ExpandCommands</a></a> $filterCommandList]
    set cmdListLength2 [llength $filterCommandList]
    if {$cmdListLength2 &gt; $cmdListLength1} {
        <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ExpandedCommand: $filterCommandList&#34;
    }
    foreach CLICommand $filterCommandList {
        if { [regexp -nocase {]} $CLICommand] == 1 ||
	     [regexp -nocase {\[} $CLICommand] == 1 } {
            set tmp $testNo;
            append tmp &#34;.$i&#34;;
            <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$tmp &lt;$CLICommand&gt; executed&#34;
            <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Command not executed due to format error&#34;
            <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>  
            incr i;           
	    continue;
	}
	set checkIllegal false
	set cliCMD	$CLICommand
	if {[regexp -nocase &#34;illegal&#34; $CLICommand] == 1} {
	    set checkIllegal true
	    regsub {illegal} $CLICommand {} CLICommand
	    <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;checkIllegal - $CLICommand&#34;
	}
        <span class="comment-line"># -- process command section</span>
        if {[string range $CLICommand 0 0] == &#34;#&#34; } {
            <span class="comment-line"># -- take out comment</span>
            <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;comment - $CLICommand&#34;
            continue;
        } elseif {[regexp -nocase &#34;sleep *&#34; $CLICommand] } {           
            <span class="comment-line"># -- process sleep command</span>
            set wait [lindex $CLICommand 1]
            <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleeping for $wait seconds&#34;
            sleep $wait
	    continue
        } else {
            <span class="comment-line"># -- check for platform dependent</span>
            if {[regexp -nocase &#34;&lt;.*&gt;&#34; $CLICommand] } {
                regsub -all {&gt;} $CLICommand {} CLICommand
                switch -regexp [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>] {
                    &#34;BD&#34; -
                    &#34;XCM*&#34; {set blade &#34;$DUT1_DefaultBlade:&#34; }
                    &#34;Asp*&#34; {set blade &#34;$DUT1_DefaultBlade:&#34; }
                    &#34;Summi*&#34; {set blade &#34;&#34; }
                    default {set blade &#34;&#34; }
                }
                regsub -all {&lt;} $CLICommand $blade CLICommand            
            }    
        }      
       
        <span class="comment-line"># -- send the command to switch</span>
        set tmp $testNo;
        append tmp &#34;.$i&#34;;
        set fd_in [open &#34;$tmpPath/tmp_$tmp&#34; &#34;w&#34;];
        <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$CLICommand&#34; NULL $fd_in;
        close $fd_in;

        <span class="comment-line"># -- check for illegal command</span>
        set fd_in [open &#34;$tmpPath/tmp_$tmp&#34; &#34;r&#34;];
        set rtValue [<a name="::check_illegality(1)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in];
        close $fd_in;
        
        <span class="comment-line"># -- report the execution</span>
<span class="comment-line">#        report_start_test &#34;$tmp &lt;$CLICommand&gt; executed&#34;</span>
        <a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$tmp &lt;$cliCMD&gt; executed&#34;
        if { $rtValue == &#34;illegal&#34; } {
	    if { $checkIllegal == &#34;true&#34; } {
                <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Command executed failed as expected&#34;
	    } else {
                <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error in executing command&#34;
	    }
        } else {
	    if { $checkIllegal == &#34;true&#34; } {
                <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Command executed successfully but should have failed&#34;
	    } else {
                <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Command executed successfully&#34;
	    }
        }
        <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>  
        incr i;           
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ProcessShow</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: part of CLI Parser. Process showcli and ouput part.</span>
<span class="comment-line">#              It also checks for platform and version. </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: filterCommandList testNo</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ProcessShow_653">proc <a href="CLIParser.tcl-annot.html#::::ProcessShow">::::ProcessShow</a></a></strong> {filterCommandList testNo} {
    global DUT1_DefaultBlade;
    
    <span class="comment-line">#set versionCommands &#34;&#34;</span>
    <span class="comment-line">#set filterList [FilterAllCommands $groupList]</span>
    <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;GetTheOutput: $filterCommandList&#34;
    set checkOutput 0
    set checkOutputList &#34;&#34;
    set textBuffer &#34;&#34;
       
    <span class="comment-line"># -- process the show section</span>
    if {[info exist flag]} {unset flag};
    foreach line $filterCommandList {
        set line [string trim $line];
        if {[regexp -nocase &#34;&lt;.*&gt;&#34; $line] } {
             <span class="comment-line"># -- check for platform dependent</span>
             regsub -all {&gt;} $line {} line
             switch -regexp [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>] {
                 &#34;BD&#34; -
                 &#34;XCM*&#34; {set blade &#34;$DUT1_DefaultBlade:&#34; }
                 &#34;Asp*&#34; {set blade &#34;$DUT1_DefaultBlade:&#34; }
                 &#34;Summi*&#34; {set blade &#34;&#34; }
                 default {set blade &#34;&#34; }
             }
             regsub -all {;&lt;|&lt;} $line $blade line 
        }
        <span class="comment-line">#replace parentheses              </span>
        regsub -all {\(} $line {.} line
        regsub -all {\)} $line {.} line
        <span class="comment-line">#replace bracket         </span>
        regsub -all {\[} $line {.} line
        regsub -all {\]} $line {.} line
        if {[string range $line 0 0] == &#34;#&#34; } {
            <span class="comment-line"># -- take out comment</span>
            <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;comment - $line&#34;
        } elseif {[regexp -nocase &#34;sleep*&#34; $line] } {           
            <span class="comment-line"># -- process sleep time</span>
            set wait [lindex $line 1]
            <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleeping for $wait seconds&#34;
            sleep $wait           
        } elseif {[regexp -nocase &#34;output:&#34; $line ]} {
            <span class="comment-line"># -- get out the loop and start checking for output</span>
            set checkOutput 1
        } elseif {$checkOutput} {
            <span class="comment-line"># -- change the commands into the script format</span>
            <span class="comment-line">#result_debug &#34;--line--&gt; $line&#34;;              </span>
            if {[string range $line 0 0] == &#34;\{&#34;} {
                <span class="comment-line">#result_debug &#34;Process Bracket Line: $line&#34;;</span>
                set str [string trimright $line &#34;\}&#34;];
                set line [string range $str 1 end];                
                if {[regexp -nocase &#34;notexist&#34; $line]} {
                    set notexist [string tolower [lindex $line 1]];
                    <span class="comment-line">##puts &#34;what is notexst : $notexist&#34;;</span>
                    <span class="comment-line">##puts &#34;what is line : $line&#34;;</span>
                    if {$notexist == &#34;notexist&#34;} {
                        set tmp [lindex $line 0];
                        lappend checkOutputList &#34;\{$tmp\} 0&#34;; 
                        lappend flag 1;                            
                    } else {
                        set tmp [lindex $line 0];
                        lappend checkOutputList &#34;\{$tmp\} 0&#34;; 
                        lappend flag 0;
                    }                     
                } elseif {[regexp -nocase &#34;exist&#34; $line]} {
                    if {[lindex $line 1] == &#34;exist&#34;} {
                        set tmp [lindex $line 0];
                        lappend checkOutputList &#34;\{$tmp\} 0&#34;; 
                        <span class="comment-line">#puts &#34;1) $checkOutputList &#34;;                           </span>
                        lappend flag 0;
                    } else {
                        set tmp [lindex $line 0];
                        lappend checkOutputList &#34;\{$tmp\} 0&#34;;
                        <span class="comment-line">#puts &#34;2) $checkOutputList &#34;;  </span>
                        lappend flag 0;
                    }         
                } else {
                   set tmp [lindex $line 0];
                   lappend checkOutputList &#34;\{$tmp\} 0&#34;; 
                   lappend flag 0;
                }                 
            } else {
                lappend checkOutputList &#34;\{$line\} 0&#34;;
                lappend flag 0;
            }
            <span class="comment-line">#result_debug &#34;--checkOutputList--&gt; $checkOutputList&#34;;</span>
        } else {
            <span class="comment-line">#SendACmd $line NULL $fd_in</span>
            set textBuffer &#34;$textBuffer {$line}&#34;  
        }
    
    } 
          
    <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;&gt;&gt;&gt;textBuffer: $textBuffer&#34;          
    <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;&gt;&gt;&gt;checkOutputList: $checkOutputList&#34;
    
    <span class="comment-line"># -- process the show command</span>
    set showCommand [lindex $textBuffer 0];
    set nofile 1;
    set returnList [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> $showCommand $checkOutputList $nofile];
    <span class="comment-line">#result_debug &#34;&gt;&gt;&gt;checkOutputList: $checkOutputList&#34;;</span>
    <span class="comment-line">#result_debug &#34;&gt;&gt;&gt;flag : $flag&#34;;</span>
    
    <span class="comment-line"># -- check for the output got back from getkeyvalue</span>
    set i 0;
    foreach checkOutput $checkOutputList {        
        set checkOutput [lindex $checkOutput 0]; 
        set firstword [lindex $checkOutput 0]; 
        set returnvalue [lindex $returnList $i];
        <span class="comment-line">#puts &#34;returnvalue ($returnvalue) length ([llength $returnvalue])&#34;;</span>
        if {[llength $returnvalue] &gt; 1} {
            set returnvalue [lindex $returnvalue 0];
        }         
        set rt [regsub -all {[()]} $returnvalue {.} newvalue];
        if {$rt &gt; 0} {
            <span class="comment-line">#puts &#34;newvalue($rt) = $newvalue &#34;;</span>
            set returnvalue $newvalue;
        } 
        set flg [lindex $flag $i];      
        set tmp &#34;$testNo.$i&#34;;
        <a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$tmp &lt;$checkOutput&gt; executed&#34;;
        set tmp1 [string tolower $firstword];
        set tmp2 [string tolower $returnvalue];
        set tmp1 [string trim $tmp1];
        set tmp2 [string trim $tmp2];
        <span class="comment-line">#set result [regexp -nocase &#34;^$tmp1&#34; &#34;^$tmp2&#34; matchedRange];</span>
        <span class="comment-line">#result_debug &#34;tmp1 ($tmp1) tmp2 ($tmp2)&#34;</span>
        if {$flg == 0} {                    
            if {[string tolower $tmp1] != [string tolower $tmp2]} {
                <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wanted($firstword) and got($returnvalue)&#34;;
            } else {
                <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Wanted($firstword) and got($returnvalue)&#34;;
            }
        } else {
            if {[string tolower $tmp1] != [string tolower $tmp2]} {
                <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Did not wanted($firstword) and got($returnvalue)&#34;;
            } else {
                <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Did not wanted($firstword) and got($returnvalue)&#34;;
            }       
        }    
        <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a> 
        incr i;
    }
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ExpandCommands</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Part of CLI Parser. Process the command part. Expand each command</span>
<span class="comment-line"># 	if include [value ...], [name ....], [string ...] structures</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: filterCommandList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::ExpandCommands_812">proc <a href="CLIParser.tcl-annot.html#::::ExpandCommands">::::ExpandCommands</a></a></strong> {cmdList} {
   set returnList &#34;&#34;
   set listLength [llength $cmdList]
   for {set i 0 } {$i &lt; $listLength} {incr i} {
      set match_type 0
      set match_name 0
      set match_string 0
      set match_value 0
      set line [lindex $cmdList $i]
<span class="comment-line">#      result_debug &#34;$line&#34;</span>
      <span class="comment-line"># try to search for string name and value</span>
      if {[regexp -nocase &#34;.name +(\[0-9a-zA-Z]+) +(\[0-9]+) +(\[0-9]+)]&#34; \
	$line dummy pattern min max] == 1} {
         set match_name 1
	 incr match_type
<span class="comment-line">#	 result_debug &#34;match_name: $dummy&#34;</span>
      }
      if {[regexp -nocase &#34;.string +(\[0-9a-zA-Z]+) +(\[0-9]+) +(\[0-9]+)]&#34; \
	$line dummy pattern min max] == 1} {
         set match_string 1
	 incr match_type
<span class="comment-line">#	 result_debug &#34;match_string: $dummy&#34;</span>
      }
      if {[regexp -nocase &#34;.value +(\[0-9]+) +(\[0-9]+) +(\[0-9]+)]&#34; \
	$line dummy value min max] == 1} {
         set match_value 1
	 incr match_type
<span class="comment-line">#	 result_debug &#34;match_value: $dummy&#34;</span>
      }
      
      if {$match_type &gt; 1 || $match_type == 0} {
         lappend returnList $line
      } else {
	 set line1 $line
	 if { $match_name == 1 || $match_string == 1 } {
	    if { $match_name == 1 } {
               regsub &#34;(.name) +(\[0-9a-zA-Z]+) +(\[0-9]+) +(\[0-9]+)]&#34; \
		  $line1 &#34;MYSUB&#34; line1
	    } else {
               regsub &#34;(.string) +(\[0-9a-zA-Z]+) +(\[0-9]+) +(\[0-9]+)]&#34; \
		  $line1 &#34;MYSUB&#34; line1
	    }
	    set length [string length $pattern]
	    set repeat [expr ($min / $length) + 1]
	    set name [string repeat $pattern $repeat]
	    set name [string range $name 0 [expr ($min - 1)]]
            regsub &#34;MYSUB&#34;  $line1 &#34;$name&#34; line2
	    lappend returnList $line2			;<span class="comment-line"># min </span>
	    if { $match_name == 1 } {
	       regsub &#34;(cre.+?) &#34; $line2 {delete } line2
	       lappend returnList $line2		;<span class="comment-line"># delete min</span>
	    }
	    set name [string range $name 0 [expr ($min - 2)]]
            regsub &#34;MYSUB&#34; $line1 &#34;$name&#34; line2
	    set line2 &#34;illegal $line2&#34;
	    lappend returnList $line2			;<span class="comment-line"># min - 1</span>
	    set repeat [expr (($max + 1) / $length) + 1]
	    set name [string repeat $pattern $repeat]
	    set name [string range $name 0  $max]
            regsub &#34;MYSUB&#34;  $line1 &#34;$name&#34; line2
	    set line2 &#34;illegal $line2&#34;
	    lappend returnList $line2			;<span class="comment-line"># max + 1</span>
	    set name [string range $name 0  [expr ($max - 1 )]]
            regsub &#34;MYSUB&#34;  $line1 &#34;$name&#34; line2
	    lappend returnList $line2			;<span class="comment-line"># max </span>
	    if { $match_name == 1 } {
	       regsub &#34;(cre.+?) &#34; $line2 {delete } line2
	       lappend returnList $line2		;<span class="comment-line"># delete max</span>
            }
	    set middle [expr ($min + $max) / 2]
	    set repeat [expr ($middle / $length) + 1]
	    set name [string repeat $pattern $repeat]
	    set name [string range $name 0 $middle]
            regsub &#34;MYSUB&#34; $line1 &#34;$name&#34; line2
	    lappend returnList $line2			;<span class="comment-line"># middle</span>
	    if { $match_name == 1 } {
	       regsub &#34;(cre.+?) &#34; $line2 {delete } line2
	       lappend returnList $line2		;<span class="comment-line"># delete middle</span>
	    }
            regsub &#34;MYSUB&#34; $line1 &#34;$pattern&#34; line2
            lappend returnList $line2			;<span class="comment-line"># pattern</span>
	    if { $match_name == 1 } {
	       regsub &#34;(cre.+?) &#34; $line2 {delete } line2
	       lappend returnList $line2		;<span class="comment-line"># delete pattern</span>
	    }
         } elseif { $match_value == 1 } {
	    set valueList &#34;&#34;
	    set minList &#34;&#34;
	    set maxList &#34;&#34;
	    set idx 0
	    set line1 $line
	    while { 1 } {
<span class="comment-line">#	       result_debug &#34;$line1&#34;</span>
	       if {[regexp &#34;.value +(\[0-9]+) +(\[0-9]+) +(\[0-9]+)]&#34; \
        		$line1 dummy value min max] == 1} {
		  lappend valueList $value
		  lappend minList $min
		  lappend maxList $max
		  regsub &#34;.value +\[0-9]+ +\[0-9]+ +\[0-9]+]&#34; $line1 \
			&#34;VALUE$idx&#34; line1
		  incr idx
	       } else {
		  break
	       }
            }
<span class="comment-line">#           result_debug &#34;idx: $idx&#34;</span>
<span class="comment-line">#           result_debug &#34;$line1&#34;</span>
<span class="comment-line">#	    result_debug &#34;valueList: $valueList&#34;</span>
<span class="comment-line">#	    result_debug &#34;minList: $minList&#34;</span>
<span class="comment-line">#	    result_debug &#34;maxList: $maxList&#34;</span>
            for {set k 0 } { $k &lt; $idx } { incr k } {
	       set line2 $line1
	       for { set j 0 } { $j &lt; $idx } { incr j } {
	          if { $j == $k } {
		     set lastValue [lindex $valueList $j]
		     set min [lindex $minList $j]
		     set max [lindex $maxList $j]
	          } else {
		     set subx [lindex $valueList $j]
	             regsub &#34;VALUE$j&#34; $line2 &#34;$subx&#34; line2
	          }
	       }
<span class="comment-line">#               result_debug &#34;$line2&#34;</span>
package require Mpexpr
	       set value [expr ($min - 1 )]
               regsub &#34;VALUE$k&#34; $line2 &#34;$value&#34; line3
	       set line3 &#34;illegal $line3&#34;
               lappend returnList $line3		;<span class="comment-line"># min - 1</span>
               regsub &#34;VALUE$k&#34; $line2 &#34;$min&#34; line3	;<span class="comment-line"># </span>
               lappend returnList $line3		;<span class="comment-line"># min</span>
	       set value [mpexpr ($max + 1 )]
               regsub &#34;VALUE$k&#34; $line2 &#34;$value&#34; line3
	       set line3 &#34;illegal $line3&#34;
               lappend returnList $line3		;<span class="comment-line"># max + 1</span>
               regsub &#34;VALUE$k&#34; $line2 &#34;$max&#34; line3	;<span class="comment-line"># </span>
               lappend returnList $line3		;<span class="comment-line"># max</span>
	       set value [mpexpr (($max + $min)/2)]
               regsub &#34;VALUE$k&#34; $line2 &#34;$value&#34; line3
               lappend returnList $line3		;<span class="comment-line"># middle</span>
               regsub &#34;VALUE$k&#34; $line2 &#34;$lastValue&#34; line3
               lappend returnList $line3		;<span class="comment-line"># default</span>
	    }
	 }
      }
   }
   return $returnList
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cliCompareVersion</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Compare the version with the version on the dut  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              version </span>
<span class="comment-line">#              dut name   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [CompareVersion $version $DUTName]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cliCompareVersion_977">proc <a href="CLIParser.tcl-annot.html#::::cliCompareVersion">::::cliCompareVersion</a></a></strong> {<a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> {DUTName &#34;DUT1&#34;}} {

    global DUTs_info;  
                
    <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CompareVersion build($version) and SW($DUTs_info($DUTName,version))&#34;
    set vn [<a name="::::cliGetVersion(1)"><a href="./upgradecheck.tcl.html#::::cliGetVersion_865">::::cliGetVersion</a></a> $DUTName 4];
    set bn [<a name="::::cliGetVersion(2)"><a href="./upgradecheck.tcl.html#::::cliGetVersion_865">::::cliGetVersion</a></a> $DUTName 3];      
    set flag [regexp -nocase {^(.*)b(.*)} $version vs vn1 bn1];
    if {$flag} {
        <span class="comment-line"># -- compare release and build number</span>
        if {$vn1 &gt; $vn} {
            return 1;
        } elseif {$vn1 &lt; $vn} {
            return -1;
        } else {
          <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Build bld($bn1) sw($bn)&#34;;
          if {$bn1 &gt; $bn} {
              return 1;
          } elseif {$bn1 &lt; $bn} {
              return -1;
          } else {
              return 0;
          }
        }    
    } else {
        <span class="comment-line"># ---- compare only release number</span>
        set sw_fullversion $vn;
        set lng [string length $version];
        <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CompareVersion build($version) and sw($sw_fullversion)&#34;
        if {$lng &gt;= [string length $sw_fullversion]} {
            set sw_shortversion $sw_fullversion;
        } else {
            set sw_shortversion [string range $sw_fullversion 0 [expr $lng-1]];   
        }     
        
        if {($version == &#34;6.2e&#34;) &amp;&amp; ($sw_shortversion != &#34;6.2e&#34;)} {
            <span class="comment-line"># to prevent s24lc code</span>
            return 1;
        } elseif {$version &gt; $sw_shortversion} {
            return 1;
        } elseif {$version &lt; $sw_shortversion} {
            return -1;
        } else {
            return 0;
        }        
    }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
