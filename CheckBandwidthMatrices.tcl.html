<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>CheckBandwidthMatrices.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#CheckBandwidthMatrices.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>CheckBandwidthMatrices.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="CheckBandwidthMatrices.tcl-annot.html">annotations</a> | <a href="CheckBandwidthMatrices.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckBandwidthMatrix   </span>
<span class="comment-line"># Description:  Verify the effects of QOS based on qos profiles matrix</span>
<span class="comment-line">#		in QOS test plan or user-specified ones</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line"># 	SendACmd &#34;create access-list permitList1 ip dest any source 192.10.1.0/24 deny ports any&#34;</span>
<span class="comment-line">#	SendACmd &#34;create access-list permitList2 ip dest any source 192.10.2.0/24 deny ports any&#34;</span>
<span class="comment-line">#	SendACmd &#34;create access-list permitList3 ip dest any source 192.10.3.0/24 permit QP3 ports any&#34;</span>
<span class="comment-line">#	SendACmd &#34;create access-list permitList4 ip dest any source 192.10.4.0/24 deny ports any&#34;</span>
<span class="comment-line">#	CheckBandwidthMatrix -checkMatrix 8 -filePt $fd_res -testFileName $testNo     </span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckBandwidthMatrix_17">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::CheckBandwidthMatrix">::::CheckBandwidthMatrix</a></a></strong> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckBandwidthMatrix $args {
     numIxiaCd &#34;3&#34;
     <a name="::protocol(1)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ip&#34;
     srcMacAddrTxList &#34;srcMac&#34;
     destMacAddrTxList &#34;DUTMac&#34;
     sIpAddrList &#34;192.10.1.2 192.10.2.2 192.10.3.2 192.10.4.2&#34;
     dIpAddrList &#34;192.20.1.2 192.20.2.2 192.20.3.2 192.20.4.2&#34;
     sPortList &#34;0 0 0 0&#34;
     dPortList &#34;0 0 0 0&#34;
     TOSList &#34;0x00 0x00 0x00 0x00&#34;
     QPList &#34;1 2 3 4&#34;
     priList &#34;0 1 2 3&#34;
     tagList &#34;none none none none&#34;
     checkQosList &#34;&#34;
     ratioExpectList &#34;25.00 25.00 25.00 25.00&#34;
     ratioThreshold &#34;18&#34;
     ratioAggregateThreshold &#34;2.5&#34;
     checkMatrix &#34;1-7&#34;
     userMatrix &#34;none&#34;
     qosType &#34;802.1p&#34;
     filePt &#34;NULL&#34;
     testFileName &#34;Temp&#34;
     initRateCheck &#34;1&#34;
   }

global startCardNum
global DUTs_info
global PortID_Info
set percent_tolerance [expr double($ratioThreshold) / double(100)]
<span class="comment-line"># Check for 10Gig platform, call different checkBwMatrix specifically</span>
global DUTs_Slot_info
set 10GigSlot 0
<span class="comment-line">#for {set i 1} {$i&lt;=$DUTs_info(DUT1,numSlots)} {incr i} {</span>
<span class="comment-line">#   if {[regexp -nocase &#34;10Gig&#34; $DUTs_Slot_info(DUT1,slot$i,hwModType)]} {</span>
<span class="comment-line">#      set 10GigSlot 1</span>
<span class="comment-line">#      break</span>
<span class="comment-line">#   }</span>
<span class="comment-line">#}</span>

if {$10GigSlot} {
   <span class="comment-line"># Call 10Gig qos routine</span>
   if {$ratioAggregateThreshold==2.5} {
      set ratioAggregateThreshold 14
   }
   if {[regexp -nocase &#34;25.00 25.00 25.00 25.00&#34; $ratioExpectList]} {
      set ratioExpectList &#34;100.00 100.00 100.00 100.00&#34;
   }
   return [<a name="::CheckBandwidthMatrix10Gig(1)"><a href="./CheckBandwidthMatrices10G.tcl.html#::CheckBandwidthMatrix10Gig_1">::CheckBandwidthMatrix10Gig</a></a> -numIxiaCd $numIxiaCd -protocol $protocol -srcMacAddrTxList $srcMacAddrTxList -destMacAddrTxList $destMacAddrTxList \
   -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList \
   -QPList $QPList -tagList $tagList -checkQosList $checkQosList \
    -ratioExpectList $ratioExpectList -ratioThreshold $ratioThreshold \
    -ratioAggregateThreshold $ratioAggregateThreshold -checkMatrix $checkMatrix \
    -qosType $qosType -filePt $filePt -testFileName $testFileName]
}

set pPattern &#34;5678&#34;
if {$protocol == &#34;multicast&#34;} {
   set joinGroup 22
   set portList {1 2 3 4}
   foreach portId $portList {
      set portIdTx [expr $portId + 8]
      set multicastIP 22[expr $portId + 4].1.2.3
      set destMacMulticast &#34;01 00 5E 01 02 03&#34; 
      set clientIP1 192.20.$portId.2
      <span class="comment-line">#send an join multicast group igmp packet</span>
      <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$clientIP1 joins multicast group $multicastIP&#34;
      set rxPort [<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx chasis card port]
      set frameSent [<a name="::ixiaConf_2Ports_ip(1)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $chasis -txCard $card  -txPort $port \
                       -rxChas $chasis -rxCard $card  -rxPort $rxPort  \
                       -ipProtocol &#34;igmp&#34; -type $joinGroup -ttl 1      \
                       -percentage $PortID_Info($portId,normTxPerc) \
                       -startCardNum $startCardNum  -dMacAddr $destMacMulticast \
                       -sIpAddr  $clientIP1  -dIpAddr $multicastIP -groupAddr $multicastIP ]
   }

   set ipProtocol &#34;udp&#34;
   set destMacAddrTxList {01:00:5E:01:02:03 01:00:5E:01:02:03 01:00:5E:01:02:03 01:00:5E:01:02:03}
   <span class="comment-line">#send join</span>
} else {
   set ipProtocol $protocol
}
set QPa &#34;QP[lindex $QPList 0]&#34;
set QPb &#34;QP[lindex $QPList 1]&#34;
set QPc &#34;QP[lindex $QPList 2]&#34;
set QPd &#34;QP[lindex $QPList 3]&#34;
set Qa [expr [lindex $QPList 0] - 1]
set Qb [expr [lindex $QPList 1] - 1]
set Qc [expr [lindex $QPList 2] - 1]
set Qd [expr [lindex $QPList 3] - 1]

if {$checkMatrix == 8} {
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 8 Bandwidth criteria using $QPa, $QPb, $QPc, $QPd&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;        
   <span class="comment-line">#Test Matrix 8</span>
   <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPa minbw 10 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPb minbw 10 maxbw 100 priority Normal port all&#34;
   <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPc minbw 10 maxbw 100 priority Medium port all&#34;
   <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPd minbw 10 maxbw 100 priority High port all&#34;
} elseif {$checkMatrix == &#34;1-7&#34;} {
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 1 Bandwidth criteria&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   
   global DUT1_CONNECT
   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt
   <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPa minbw 0 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPb minbw 0 maxbw 100 priority LowHi port all&#34;
   <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPc minbw 0 maxbw 100 priority Medium port all&#34;
   <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPd minbw 0 maxbw 100 priority MediumHi port all&#34;
}

   set portIdTxList {1 2 3 4}
   set portIdRxList {9 10 11 12}
   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      set portIdRx [expr $portIdTx + 8]
      <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdRx rxChas rxCard rxPort   
      set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
      set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
      set sPort [lindex $sPortList [expr $portIdTx - 1] ]
      set dPort [lindex $dPortList [expr $portIdTx - 1] ]
      set TOS [lindex $TOSList [expr $portIdTx - 1] ]
      set tag [lindex $tagList [expr $portIdTx - 1] ]
      set wTag &#34;true&#34;
      if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
      set priority [lindex $priList [expr $portIdTx - 1] ]
      if {$destMacAddrTxList == &#34;DUTMac&#34;} {
         set destMacAddrTx $DUTs_info(DUT1,sysMAC)
      } else {
         set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
      }
      if {![regexp -nocase &#34;10.2&#34; $qosType] &amp;&amp; $checkMatrix!=8} {
         global DUT1_CONNECT
<span class="comment-line">#         Login $DUT1_CONNECT</span>
<span class="comment-line">#         SendACmd &#34;ping $dIpAddr&#34;</span>
      } else {
         set frameSent [<a name="::ixiaConf_2Ports_ip(2)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -txChas $txChas -txCard $txCard -txPort $txPort \
                          -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \
                          -startCardNum $startCardNum -dataPattern $pPattern \
                          -TOS $TOS -numFrames 4 \
                          -percentage $PortID_Info($portIdTx,normTxPerc) \
                          -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \
                          -dMacAddr $destMacAddrTx  -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \
                          -wTag $wTag -tagNo $tag -userPriority $priority ]
      }
   }
   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      set portIdRx [expr $portIdTx + 8]
      <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdRx rxChas rxCard rxPort   
      set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
      set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
      set sPort [lindex $sPortList [expr $portIdTx - 1] ]
      set dPort [lindex $dPortList [expr $portIdTx - 1] ]
      set TOS [lindex $TOSList [expr $portIdTx - 1] ]
      set tag [lindex $tagList [expr $portIdTx - 1] ]
      set wTag &#34;true&#34;
      if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
      set priority [lindex $priList [expr $portIdTx - 1] ]
      if {$destMacAddrTxList == &#34;DUTMac&#34;} {
         set destMacAddrTx $DUTs_info(DUT1,sysMAC)
      } else {
         set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
      }

      set frameSent [<a name="::ixiaConf_2Ports_ip(3)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $txChas -txCard $txCard -txPort $txPort \
                       -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \
                       -startCardNum $startCardNum -dataPattern $pPattern \
                       -streamType &#34;contPacket&#34; -percentage $PortID_Info($portIdTx,normTxPerc) \
                       -TOS $TOS -frameSizeType &#34;sizeRandom&#34; \
                       -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \
                       -dMacAddr $destMacAddrTx  -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \
                       -wTag $wTag -tagNo $tag -userPriority $priority ]
      <span class="comment-line">#wait for things to settle down</span>
      if {$initRateCheck} {
         <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 6
         set portIdList {1 2 3 4 9 10 11 12}
         foreach portId $portIdList {
            
            <a name="::MapIxiaPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
            <a name="::stat(1)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
            set rateSent [<a name="::stat(2)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesSent]
            set rateRecv [<a name="::stat(3)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesReceived]
            set rateArray($portId,sent) $rateSent.00
            set rateArray($portId,recv) $rateRecv.00
         
            <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;
         }
         if {$checkMatrix == 8} {
         
         } elseif {$checkMatrix == &#34;1-7&#34;} {
            set ratioFound [format %.2f [expr $rateArray($portIdRx,recv)*100/($rateArray($portIdTx,sent)+1)]]
            set ratioExpect 100
            if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioThreshold } {
               <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Matrix 1 failed rate ratio threshold test on port $portIdRx. Got $ratioFound EXPECT $ratioExpect +/- $ratioThreshold&#34;
            } else {
               <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Matrix 1 pass rate ratio threshold test on port $portIdRx. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioThreshold&#34;
            }
         }         
      }

   }
   if {$checkMatrix == 8} { 
      set portIdList {1 2 3 4 9 10 11 12}
 
      set ratioExpectArray(9) 0
      set ratioExpectArray(10) 0
      set ratioExpectArray(11) 100
      set ratioExpectArray(12) 0
      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(1)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for Matrix 8 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList
      <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;

      <span class="comment-line">#check Q</span>
      <span class="comment-line">#lappend checkQosList &#34;0 1000 minPacket&#34; ;#not testing this, unpredictable for now</span>
      lappend checkQosList &#34;$Qb 10 maxPacket&#34;
      lappend checkQosList &#34;$Qc 1000 minPacket&#34;
      lappend checkQosList &#34;$Qd 10 maxPacket&#34;
      <a name="::CheckQoSMonitor(1)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName
      unset checkQosList
   } elseif {$checkMatrix == &#34;1-7&#34;} {
      set ratioExpectArray(9) 0
      set ratioExpectArray(10) 0
      set ratioExpectArray(11) 0
      set ratioExpectArray(12) 100
      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(2)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for Matrix 1 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList
      <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
      <span class="comment-line">#check Q</span>
      <span class="comment-line"># Matrix1 has qosmonitor problems when leaking to Q2.</span>
      lappend checkQosList &#34;$Qa 10 maxPacket&#34;
      lappend checkQosList &#34;$Qb 10 maxPacket&#34;
      lappend checkQosList &#34;$Qc 3000 maxPacket&#34;
      lappend checkQosList &#34;$Qd 3000 minPacket&#34;
      <a name="::CheckQoSMonitor(2)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList  

      <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPa minbw 0 maxbw 100 priority Low port all&#34;
      <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPb minbw 0 maxbw 100 priority LowHi port all&#34;
      <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPc minbw 0 maxbw 100 priority Normal port all&#34;
      <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPd minbw 0 maxbw 100 priority NormalHi port all&#34;
      set priList &#34;0 2 4 6&#34;
      if {$qosType==&#34;diffserv&#34;} {
         set TOSList &#34;0x00 0x40 0x80 0xc0&#34;
      } elseif {$qosType==&#34;diffservCodePoint&#34;} {
         <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
         <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP7&#34;
         <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP3&#34;
         set TOSList &#34;0x00 0x64 0x80 0x20&#34;
      }
      <a name="::configMatrix(1)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                   -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                   -ipProtocol $ipProtocol

   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 2 Bandwidth criteria using QP1, QP3, QP5, QP7&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   <span class="comment-line">#Test Matrix 2</span>
   <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp1 minbw 10 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp3 minbw 10 maxbw 100 priority Normal port all&#34;
   <a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp5 minbw 10 maxbw 100 priority Medium port all&#34;
   <a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp7 minbw 10 maxbw 100 priority High port all&#34;

      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
      set portIdList {1 2 3 4 9 10 11 12}
      set ratioExpectArray(9) 10.00
      set ratioExpectArray(10) 10.00
      set ratioExpectArray(11) 10.00
      set ratioExpectArray(12) 70.00
      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(3)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for Matrix 2 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList
      
      <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;0 100 minPacket&#34;
      lappend checkQosList &#34;2 100 minPacket&#34;
      lappend checkQosList &#34;4 100 minPacket&#34;
      lappend checkQosList &#34;6 700 minPacket&#34;
      <a name="::CheckQoSMonitor(3)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName
      unset checkQosList

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 0 maxbw 100 priority Low port all&#34;
      <a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 0 maxbw 100 priority Normal port all&#34;
      <a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 priority Medium port all&#34;
      <a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 0 maxbw 100 priority High port all&#34;
      set priList &#34;1 3 5 7&#34;
      if {$qosType==&#34;diffserv&#34;} {
         set TOSList &#34;0x20 0x60 0xa0 0xe0&#34;
      } elseif {$qosType==&#34;diffservCodePoint&#34;} {
         <a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
         <a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 9 qosprofile QP8&#34;
         <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP4&#34;
         set TOSList &#34;0x20 0x64 0xa0 0x24&#34;
      }
      <a name="::configMatrix(2)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                   -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                   -ipProtocol $ipProtocol

   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 3 Bandwidth criteria using QP2, QP4, QP6, QP8&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   <span class="comment-line">#Test Matrix 3</span>
   <a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp2 minbw 10 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp4 minbw 10 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp6 minbw 10 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp8 minbw 10 maxbw 100 priority Low port all&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
      set portIdList {1 2 3 4 9 10 11 12}
      set ratioExpectArray(9)  25.00
      set ratioExpectArray(10) 25.00
      set ratioExpectArray(11) 25.00
      set ratioExpectArray(12) 25.00

      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(4)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for Matrix 3 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList
      <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;1 300 minPacket&#34;
      lappend checkQosList &#34;3 300 minPacket&#34;
      lappend checkQosList &#34;5 300 minPacket&#34;
      lappend checkQosList &#34;7 300 minPacket&#34;
      <a name="::CheckQoSMonitor(4)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList  

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP2 minbw 0 maxbw 100 priority LowHi port all&#34;
      <a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 0 maxbw 100 priority NormalHi port all&#34;
      <a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP6 minbw 0 maxbw 100 priority MediumHi port all&#34;
      <a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 0 maxbw 100 priority HighHi port all&#34;
      set priList &#34;3 4 5 6&#34;
      if {$qosType==&#34;diffserv&#34;} {
         set TOSList &#34;0x60 0x80 0xa0 0xc0&#34;
      } elseif {$qosType==&#34;diffservCodePoint&#34;} {
         <a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
         <a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP7&#34;
         <a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP5&#34;
         set TOSList &#34;0x60 0x64 0xa0 0x20&#34;
      }
      <a name="::configMatrix(3)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                   -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                   -ipProtocol $ipProtocol
      
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 3b Bandwidth criteria using QP4, QP5, QP6, QP7&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;      
   <span class="comment-line">#Test Matrix 3b</span>
   <a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 10 maxbw 50 priority Low port all&#34;
   <a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 10 maxbw 50 priority Low port all&#34;
   <a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP6 minbw 10 maxbw 50 priority Low port all&#34;
   <a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 10 maxbw 70 priority Low port all&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(5)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
      set portIdList {1 2 3 4 9 10 11 12}
      foreach portId $portIdList {
         
         <a name="::MapIxiaPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
         <a name="::stat(4)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
         set rateSent [<a name="::stat(5)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesSent]
         set rateRecv [<a name="::stat(6)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesReceived]
         set rateArray($portId,sent) $rateSent.00
         set rateArray($portId,recv) $rateRecv.00
      
            <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Mtrx3b Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;
      }    
      set sum 0
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set ratioFound [format %.2f [expr $rateArray($portId,recv)*100/($rateArray($portIdTx,sent)+1)]]
         set sum [expr $sum + $ratioFound]
         set proratedRatioThresholdLow [expr 10.00/100.00*$ratioThreshold]
         set proratedRatioThresholdHigh [expr 25.00/100.00*$ratioThreshold]
         <span class="comment-line">#between 10-25%</span>
         if {($ratioFound &lt; [expr 10 - $proratedRatioThresholdLow]) || ($ratioFound &gt; [expr 25 + $proratedRatioThresholdHigh])} {
            <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Matrix 3b failed rate ratio threshold test on port $portId. Got $ratioFound EXPECT between 10 +/-$proratedRatioThresholdLow to 25 +/-$proratedRatioThresholdHigh&#34;
         } else {
            <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Matrix 3b pass rate ratio threshold test on port $portId. Got $ratioFound AS EXPECT between 10 +/-$proratedRatioThresholdLow to 25 +/-$proratedRatioThresholdHigh&#34;
         }
      }
      <span class="comment-line">#total rate</span>
      set ratioExpect 100
      set ratioFound $sum
      if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioAggregateThreshold } {
         <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Matrix 3b failed aggregate rate ratio threshold test. Got $ratioFound EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;
      } else {
         <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Matrix 3b pass rate aggregate ratio threshold test. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;
      }


      set ratioExpectArray(9)  25.00
      set ratioExpectArray(10) 25.00
      set ratioExpectArray(11) 25.00
      set ratioExpectArray(12) 25.00

      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(5)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for Matrix 3 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList


      <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;3 300 minPacket&#34;
      lappend checkQosList &#34;4 300 minPacket&#34;
      lappend checkQosList &#34;5 300 minPacket&#34;
      lappend checkQosList &#34;6 300 minPacket&#34;
      <a name="::CheckQoSMonitor(5)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(5)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList  

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(47)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 0 maxbw 100 priority NormalHi port all&#34;
      <a name="::SendACmd(48)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 priority Medium port all&#34;
      <a name="::SendACmd(49)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP6 minbw 0 maxbw 100 priority MediumHi port all&#34;
      <a name="::SendACmd(50)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 0 maxbw 100 priority High port all&#34;

   <span class="comment-line"># Matrix 4 deleted</span>
      set priList &#34;0 3 4 7&#34;
      if {$qosType==&#34;diffserv&#34;} {
         set TOSList &#34;0x00 0x60 0x80 0xe0&#34;
      } elseif {$qosType==&#34;diffservCodePoint&#34;} {
         <a name="::SendACmd(51)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
         <a name="::SendACmd(52)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP8&#34;
         <a name="::SendACmd(53)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP4&#34;
         set TOSList &#34;0x00 0x64 0x80 0x20&#34;
      }
      <a name="::configMatrix(4)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                   -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                   -ipProtocol $ipProtocol
      
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 5 Bandwidth criteria using QP1, QP4, QP5, QP8&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;          
   <span class="comment-line">#Test Matrix 5</span>
   <a name="::SendACmd(54)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 10 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(55)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 10 maxbw 50 priority Normalhi port all&#34;
   <a name="::SendACmd(56)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 10 maxbw 40 priority Medium port all&#34;
   <a name="::SendACmd(57)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 10 maxbw 30 priority Highhi port all&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(6)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      set portIdList {1 2 3 4 9 10 11 12}
      set ratioExpectArray(9) 10.00
      set ratioExpectArray(10) 20.00
      set ratioExpectArray(11) 40.00
      set ratioExpectArray(12) 30.00
      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(6)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for Matrix 5 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList
      <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(58)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;0 90 minPacket&#34;
      lappend checkQosList &#34;3 180 minPacket&#34;
      lappend checkQosList &#34;4 360 minPacket&#34;
      lappend checkQosList &#34;7 270 minPacket&#34;
      <a name="::CheckQoSMonitor(6)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(6)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList      

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(59)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 0 maxbw 100 priority Low port all&#34;
      <a name="::SendACmd(60)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 0 maxbw 100 priority NormalHi port all&#34;
      <a name="::SendACmd(61)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 priority Medium port all&#34;
      <a name="::SendACmd(62)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 0 maxbw 100 priority HighHi port all&#34;
      set priList &#34;0 1 2 3&#34;
      if {$qosType==&#34;diffserv&#34;} {
         set TOSList &#34;0x00 0x20 0x40 0x60&#34;
      } elseif {$qosType==&#34;diffservCodePoint&#34;} {
         <a name="::SendACmd(63)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
         <a name="::SendACmd(64)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP4&#34;
         <a name="::SendACmd(65)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP2&#34;
         set TOSList &#34;0x00 0x64 0x40 0x20&#34;
      }

      <a name="::configMatrix(5)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                   -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                   -ipProtocol $ipProtocol
      
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 6 Bandwidth criteria using QP1, QP2, QP3, QP4&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;  
   <span class="comment-line">#Test Matrix 6</span>
   <a name="::SendACmd(66)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 10 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(67)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP2 minbw 10 maxbw 50 priority Low port all&#34;
   <a name="::SendACmd(68)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 10 maxbw 40 priority Low port all&#34;
   <a name="::SendACmd(69)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 10 maxbw 30 priority Low port all&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(7)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
      set portIdList {1 2 3 4 9 10 11 12}
      set ratioExpectArray(9) 25.00
      set ratioExpectArray(10) 25.00
      set ratioExpectArray(11) 25.00
      set ratioExpectArray(12) 25.00

      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(7)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for Matrix 6b Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList 
      <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(70)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;0 300 minPacket&#34;
      lappend checkQosList &#34;1 300 minPacket&#34;
      lappend checkQosList &#34;2 300 minPacket&#34;
      lappend checkQosList &#34;3 300 minPacket&#34;
      <a name="::CheckQoSMonitor(7)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(7)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList   

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(71)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 0 maxbw 100 priority Low port all&#34;
      <a name="::SendACmd(72)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP2 minbw 0 maxbw 100 priority LowHi port all&#34;
      <a name="::SendACmd(73)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 0 maxbw 100 priority Normal port all&#34;
      <a name="::SendACmd(74)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 0 maxbw 100 priority NormalHi port all&#34;
      set priList &#34;4 5 6 7&#34;
      if {$qosType==&#34;diffserv&#34;} {
         set TOSList &#34;0x80 0xa0 0xc0 0xe0&#34;
      } elseif {$qosType==&#34;diffservCodePoint&#34;} {
         <a name="::SendACmd(75)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
         <a name="::SendACmd(76)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP8&#34;
         <a name="::SendACmd(77)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP6&#34;
         set TOSList &#34;0x80 0x64 0xc0 0x20&#34;
      }

      <a name="::configMatrix(6)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                   -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                   -ipProtocol $ipProtocol
   
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 6b Bandwidth criteria using QP5, QP6, QP7, QP8&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;           
   <span class="comment-line">#Test Matrix 6b</span>
   <a name="::SendACmd(78)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 10 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(79)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP6 minbw 10 maxbw 50 priority Low port all&#34;
   <a name="::SendACmd(80)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 10 maxbw 40 priority Low port all&#34;
   <a name="::SendACmd(81)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 10 maxbw 10 priority Low port all&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(8)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
      set portIdList {1 2 3 4 9 10 11 12}
      set ratioExpectArray(9) 30.00
      set ratioExpectArray(10) 30.00
      set ratioExpectArray(11) 30.00
      set ratioExpectArray(12) 9.60

      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(8)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for Matrix 6b Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList



      <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(82)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;4 300 minPacket&#34;
      lappend checkQosList &#34;5 300 minPacket&#34;
      lappend checkQosList &#34;6 300 minPacket&#34;
      lappend checkQosList &#34;7 100 minPacket&#34;
      <a name="::CheckQoSMonitor(8)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(8)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList    

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(83)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 priority Medium port all&#34;
      <a name="::SendACmd(84)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP6 minbw 0 maxbw 100 priority MediumHi port all&#34;
      <a name="::SendACmd(85)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 0 maxbw 100 priority High port all&#34;
      <a name="::SendACmd(86)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 0 maxbw 100 priority HighHi port all&#34;
      set priList &#34;0 2 4 6&#34;
      if {$qosType==&#34;diffserv&#34;} {
         set TOSList &#34;0x00 0x40 0x80 0xc0&#34;
      } elseif {$qosType==&#34;diffservCodePoint&#34;} {
         <a name="::SendACmd(87)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
         <a name="::SendACmd(88)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP7&#34;
         <a name="::SendACmd(89)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP3&#34;
         set TOSList &#34;0x00 0x64 0x80 0x20&#34;
      }
      <a name="::configMatrix(7)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                   -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                   -ipProtocol $ipProtocol
      
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 7 Bandwidth criteria using QP1, QP3, QP5, QP7&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(9)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;        
   <span class="comment-line">#Test Matrix 7</span>
   <a name="::SendACmd(90)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 10 maxbw 50 priority Low port all&#34;
   <a name="::SendACmd(91)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 20 maxbw 50 priority Normal port all&#34;
   <a name="::SendACmd(92)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 25 maxbw 50 priority Medium port all&#34;
   <a name="::SendACmd(93)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 35 maxbw 50 priority High port all&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(9)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      set portIdList {1 2 3 4 9 10 11 12}
      set ratioExpectArray(9) 10.00
      set ratioExpectArray(10) 20.00
      set ratioExpectArray(11) 25.00
      set ratioExpectArray(12) 45.00

      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(9)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for Matrix 7 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList

      <a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <span class="comment-line">#check Q</span>
      <a name="::SendACmd(94)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      lappend checkQosList &#34;0 100 minPacket&#34;
      lappend checkQosList &#34;2 180 minPacket&#34;
      lappend checkQosList &#34;4 260 minPacket&#34;
      lappend checkQosList &#34;6 450 minPacket&#34;
      <a name="::CheckQoSMonitor(9)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(9)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList   
      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(95)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 0 maxbw 100 priority Low port all&#34;
      <a name="::SendACmd(96)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 0 maxbw 100 priority Normal port all&#34;
      <a name="::SendACmd(97)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 priority Medium port all&#34;
      <a name="::SendACmd(98)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 0 maxbw 100 priority High port all&#34;
               
} elseif {$checkMatrix == &#34;user&#34;} {
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking User Bandwidth criteria&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(10)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
      
   if {$userMatrix == 5} {
      <a name="::SendACmd(99)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 10 maxbw 100 priority Low port all&#34;
      <a name="::SendACmd(100)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 10 maxbw 50 priority Normalhi port all&#34;
      <a name="::SendACmd(101)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 10 maxbw 40 priority Medium port all&#34;
      <a name="::SendACmd(102)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 10 maxbw 30 priority Highhi port all&#34;
      <span class="comment-line">#set ratioExpectArray(9) 10.00</span>
      <span class="comment-line">#set ratioExpectArray(10) 20.00</span>
      <span class="comment-line">#set ratioExpectArray(11) 40.00</span>
      <span class="comment-line">#set ratioExpectArray(12) 30.00</span>
      <span class="comment-line">#lappend checkQosList &#34;0 90 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;3 180 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;4 360 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;7 270 minPacket&#34;      </span>
      <a name="::exSleep(10)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5   
   }
   if {$userMatrix == 7} {
      <a name="::SendACmd(103)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 10 maxbw 50 priority Low port all&#34;
      <a name="::SendACmd(104)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 20 maxbw 50 priority Normal port all&#34;
      <a name="::SendACmd(105)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 25 maxbw 50 priority Medium port all&#34;
      <a name="::SendACmd(106)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 35 maxbw 50 priority High port all&#34;
      <span class="comment-line">#set ratioExpectArray(9) 10.00</span>
      <span class="comment-line">#set ratioExpectArray(10) 18.70</span>
      <span class="comment-line">#set ratioExpectArray(11) 26.30</span>
      <span class="comment-line">#set ratioExpectArray(12) 45.00</span>
      <span class="comment-line">#lappend checkQosList &#34;0 100 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;2 180 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;4 260 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;6 450 minPacket&#34;</span>
      <a name="::exSleep(11)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
   }



   <span class="comment-line">#wait for things to settle down</span>
   <a name="::exSleep(12)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
   set portIdList {1 2 3 4 9 10 11 12}
   set sum 0
   set ratioExpectArray(9) [lindex $ratioExpectList 0]
   set ratioExpectArray(10) [lindex $ratioExpectList 1]
   set ratioExpectArray(11) [lindex $ratioExpectList 2]
   set ratioExpectArray(12) [lindex $ratioExpectList 3]

   set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
   lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
   lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
   lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
   lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
   foreach portId $portIdRxList {
      set portIdTx [expr $portId - 8]
      set t [expr $portIdTx - 1];
      set tag [lindex $tagList $t]
      if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
      lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
   }
   <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
   <a name="::CheckRatesTxRx(10)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for USER MATRIX Rates based on QP Assignment&#34; \
                  $percent_tolerance SumRx $ratioExpect
   unset checkRateList

   <a name="::report_end_test(10)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   <a name="::SendACmd(107)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
   <span class="comment-line">#check Q</span>
   <a name="::CheckQoSMonitor(10)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(10)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
   unset checkQosList 
}
   <span class="comment-line">#special check for multicast, these commands should not cause switch to crash</span>
   if {$protocol == &#34;multicast&#34;} { 
      global DUT2_CONNECT
      <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT -fd $filePt
<span class="comment-line">#      SendACmd	&#34;clear igmp snooping&#34;</span>
<span class="comment-line">#      SendACmd	&#34;disable pim&#34;</span>
<span class="comment-line">#      SendACmd	&#34;enable pim&#34;</span>

      global DUT1_CONNECT
      <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt
<span class="comment-line">#      SendACmd	&#34;clear igmp snooping&#34;</span>
<span class="comment-line">#      SendACmd	&#34;disable pim&#34;</span>
<span class="comment-line">#      SendACmd	&#34;enable pim&#34;</span>
   }
   <span class="comment-line">#stop Tx</span>
   foreach portIdTx $portIdTxList {
         <a name="::MapIxiaPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
         <a name="::ixStopPortTransmit(1)"><a href="./mapping.tcl.html#::ixStopPortTransmit_103">::ixStopPortTransmit</a></a>  $txChas $txCard $txPort  
   }
   <span class="comment-line">#restore to default</span>
   <a name="::SendACmd(108)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 0 maxbw 100 priority Low port all&#34;
   <a name="::SendACmd(109)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP2 minbw 0 maxbw 100 priority LowHi port all&#34;
   <a name="::SendACmd(110)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 0 maxbw 100 priority Normal port all&#34;
   <a name="::SendACmd(111)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 0 maxbw 100 priority NormalHi port all&#34;
   <a name="::SendACmd(112)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 priority Medium port all&#34;
   <a name="::SendACmd(113)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP6 minbw 0 maxbw 100 priority MediumHi port all&#34;
   <a name="::SendACmd(114)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 0 maxbw 100 priority High port all&#34;
   <a name="::SendACmd(115)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 0 maxbw 100 priority HighHi port all&#34;

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckQoSMonitor   </span>
<span class="comment-line"># Description:  Verify packets are greater or less than specified</span>
<span class="comment-line">#               numbers for each of 8 queues</span>
<span class="comment-line"># Input args: port checkList fd_res testNo</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      lappend checkQosList &#34;0 1000 minPacket&#34;</span>
<span class="comment-line">#      lappend checkQosList &#34;3 1000 minPacket&#34;</span>
<span class="comment-line">#      lappend checkQosList &#34;4 1000 minPacket&#34;</span>
<span class="comment-line">#      lappend checkQosList &#34;7 1000 minPacket&#34;</span>
<span class="comment-line">#      CheckQoSMonitor [GetATrunkPort 1 2 1] $checkQosList $filePt $testFileName      </span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckQoSMonitor_898">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::CheckQoSMonitor">::::CheckQoSMonitor</a></a></strong> { <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> checkList fd_res testNo} {

   global spawn_id
   global PortID_Info
   global bcmPlatform
   global DUTs_info
   global whichDutNow

   <a name="::exSleep(13)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
   <a name="::report_start_test(11)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking port $port qosmonitor&#34;
   <a name="::SendACmd(116)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show ports $port qosmonitor no-refresh&#34;
   if [regexp -nocase &#34;$bcmPlatform&#34; $DUTs_info(DUT$whichDutNow,platform)] {
      <a name="::exSleep(14)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
      <a name="::SendACmd(117)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show ports $port qosmonitor no-refresh&#34;
   }
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::SendACmd(118)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show ports $port qosmonitor&#34; $fd_res $fd_in
   close $fd_in
   
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]   
   set indexFound -1
   while {[gets $fd_in line] != -1} {
      set words [split $line]
      if {[string trim [lindex $words 0]] == $port} {
         set indexFound 0
         set lineFound $line         
      }
   }   
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;
   if {$indexFound &gt;= 0} {
      foreach qosItem $checkList {
         set index [lindex $qosItem 0]
         set valueWanted [lindex $qosItem 1]
         set compareFlag [lindex $qosItem 2]
         set valueFound [lindex $lineFound [expr $indexFound + $index + 1]]
	      set Qid  [expr $index + 1]
         switch $compareFlag {
            &#34;minPacket&#34; {
               if {$valueWanted &lt;= $valueFound } {
                  <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checking Q$Qid minimum value passed. Is over $valueWanted packets.&#34;
               } else {
                  <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Checking Q$Qid minimum value failed. Wanted $valueWanted BUTGOT $valueFound&#34;
               }
            }
            &#34;maxPacket&#34; {
               if {$valueWanted &gt; $valueFound } {
                  <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checking Q$Qid maximum value passed. Is under $valueWanted packets.&#34;
               } else {
                  <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Checking Q$Qid maximum value failed. Wanted $valueWanted BUTGOT $valueFound&#34;
               }
            }
            &#34;exactPacket&#34; -
            default {
               if {$valueWanted == $valueFound } {
                  <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checking Q$Qid exact value passed. Is exactly $valueWanted packets.&#34;
               } else {
                  <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Checking Q$Qid exact value failed. Wanted $valueWanted BUTGOT $valueFound&#34;
               }
            }
         }
      }            
   } else {
     <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No QoS data found for port $port&#34;
   }
   <a name="::report_end_test(11)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: QosTestSetup   </span>
<span class="comment-line"># Description:  Set up required vlans on 2 DUTs according to test cases in </span>
<span class="comment-line">#		QOS test plan</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      	set mode &#34;multicast&#34;</span>
<span class="comment-line">#	set vlanDUT1 &#34;single&#34;</span>
<span class="comment-line">#	set sIpAddrList &#34;192.10.1.2 192.10.1.3 192.10.1.4 192.10.1.5&#34;</span>
<span class="comment-line">#	set vlanDUT1IpAddrList &#34;192.10.1.1&#34;</span>
<span class="comment-line">#	QosTestSetup -mode $mode -vlanDUT1 $vlanDUT1 -sIpAddrList $sIpAddrList \</span>
<span class="comment-line">#             	     -vlanDUT1IpAddrList $vlanDUT1IpAddrList -filePt $fd_res</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::QosTestSetup_982">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::QosTestSetup">::::QosTestSetup</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> QosTestSetup $args {
     mode &#34;unicast&#34;
     vlanDUT1 &#34;multiple&#34;
     vlanDUT2 &#34;multiple&#34;
     sIpAddrList &#34;192.10.1.2 192.10.2.2 192.10.3.2 192.10.4.2&#34;
     dIpAddrList &#34;192.20.1.2 192.20.2.2 192.20.3.2 192.20.4.2&#34;
     vlanDUT1IpAddrList &#34;192.10.1.1 192.10.2.1 192.10.3.1 192.10.4.1&#34;
     vlanDUT2IpAddrList &#34;192.20.1.1 192.20.2.1 192.20.3.1 192.20.4.1&#34;
     wTagDUT1 &#34;false false false false&#34;
	  tagListDUT1 &#34;10 20 30 40&#34;
     wTagDUT2 &#34;false false false false&#34;
	  tagListDUT2 &#34;10 20 30 40&#34;
     filePt &#34;NULL&#34;
     }
global DUT1_CONNECT
global PortID_Info
<a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt
<a name="::SendACmd(119)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config default add port [<a name="::::GetATrunkPort(11)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
<a name="::SendACmd(120)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config default ipa 192.207.38.1&#34;

if {$vlanDUT1 == &#34;multiple&#34;} {
   <a name="::SendACmd(121)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan1&#34;
   <a name="::SendACmd(122)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan2&#34;
   <a name="::SendACmd(123)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan3&#34;
   <a name="::SendACmd(124)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan4&#34;

   <a name="::SendACmd(125)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 ipa [lindex $vlanDUT1IpAddrList 0]&#34;
   <a name="::SendACmd(126)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan2 ipa [lindex $vlanDUT1IpAddrList 1]&#34;
   <a name="::SendACmd(127)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan3 ipa [lindex $vlanDUT1IpAddrList 2]&#34;
   <a name="::SendACmd(128)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan4 ipa [lindex $vlanDUT1IpAddrList 3]&#34;

   for {set i 1} {$i &lt;= 4} {incr i 1} {
      set tCount [expr $i - 1]
      if { [lindex $wTagDUT1 $tCount] == &#34;true&#34; } { 
         <a name="::SendACmd(129)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan$i tag [lindex $tagListDUT1 $tCount]&#34;
         <a name="::SendACmd(130)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan$i add port [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $i] tag&#34;
      } else {
         <a name="::SendACmd(131)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan$i add port [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $i]&#34;
	   }
   }
} else {
   <a name="::SendACmd(132)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan1&#34;
   <a name="::SendACmd(133)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 ipa [lindex $vlanDUT1IpAddrList 0]&#34;
   if { [lindex $wTagDUT1 0] == &#34;true&#34; } { 
      <a name="::SendACmd(134)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 tag [lindex $tagListDUT1 0]&#34;
      <a name="::SendACmd(135)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 add port [<a name="::MapDUTPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1-4] tag&#34;
   } else {
      <a name="::SendACmd(136)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 add port [<a name="::MapDUTPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1-4]&#34;
   }
}

if {$mode == &#34;unicast&#34;} {
   <a name="::SendACmd(137)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipforwarding&#34;
   <span class="comment-line">#SendACmd	&#34;config rip add vlan all&#34;</span>
   <span class="comment-line">#SendACmd	&#34;enable rip&#34;</span>
   <a name="::SendACmd(138)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf ipr add default 192.207.38.2&#34;
} else {
   <a name="::SendACmd(139)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable igmp&#34;
   <a name="::SendACmd(140)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure igmp 250 10 1 5&#34;
   <a name="::SendACmd(141)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure igmp snooping timer 1000 1000&#34;
   <a name="::SendACmd(142)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable igmp snooping&#34;
   <a name="::SendACmd(143)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipforwarding&#34;
   <span class="comment-line">#SendACmd	&#34;config rip add vlan all&#34;</span>
   <span class="comment-line">#SendACmd	&#34;enable rip&#34;</span>
   <a name="::SendACmd(144)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf ipr add default 192.207.38.2&#34;
   <a name="::SendACmd(145)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipmcforwarding&#34;
   <a name="::SendACmd(146)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config pim add vlan all&#34;
   <a name="::SendACmd(147)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable pim&#34;
}

<a name="::SendACmd(148)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $sIpAddrList 0] 00:A1:F1:00:00:01&#34;
<a name="::SendACmd(149)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $sIpAddrList 1] 00:A1:F2:00:00:01&#34;
<a name="::SendACmd(150)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $sIpAddrList 2] 00:A1:F3:00:00:01&#34;
<a name="::SendACmd(151)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $sIpAddrList 3] 00:A1:F4:00:00:01&#34;

global DUT2_CONNECT
<a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT -fd $filePt
<a name="::SendACmd(152)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config default add port [<a name="::::GetATrunkPort(12)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1 1]&#34;
<a name="::SendACmd(153)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config default ipa 192.207.38.2&#34;

global DUTs_info
<span class="comment-line"># Check for 10Gig platform, call different checkBwMatrix specifically</span>
global DUTs_Slot_info
set 10GigSlot 0
<span class="comment-line">#for {set i 1} {$i&lt;=$DUTs_info(DUT1,numSlots)} {incr i} {</span>
<span class="comment-line">#   if {[regexp -nocase &#34;10Gig&#34; $DUTs_Slot_info(DUT1,slot$i,hwModType)]} {</span>
<span class="comment-line">#      set 10GigSlot 1</span>
<span class="comment-line">#      break</span>
<span class="comment-line">#   }</span>
<span class="comment-line">#}</span>
if {$10GigSlot} {
   <a name="::SendACmd(154)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;nofeep&#34;
   foreach po [<a name="::::GetATrunkPort(13)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1] {
      set c 0
      set p 0
      scan $po %d:%d c p
      if {$p!=0} {
         <a name="::SendACmd(155)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;hurricanelb [expr $c-1],3&#34;
      }
   }
   <a name="::SendACmd(156)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;shswitch&#34;
}


if {$vlanDUT2 == &#34;multiple&#34;} {
   <a name="::SendACmd(157)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan1&#34;
   <a name="::SendACmd(158)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan2&#34;
   <a name="::SendACmd(159)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan3&#34;
   <a name="::SendACmd(160)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan4&#34;

   <a name="::SendACmd(161)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan1 ipa [lindex $vlanDUT2IpAddrList 0]&#34;
   <a name="::SendACmd(162)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan2 ipa [lindex $vlanDUT2IpAddrList 1]&#34;
   <a name="::SendACmd(163)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan3 ipa [lindex $vlanDUT2IpAddrList 2]&#34;
   <a name="::SendACmd(164)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan4 ipa [lindex $vlanDUT2IpAddrList 3]&#34;

   for {set i 1} {$i &lt;= 4} {incr i 1} {
      set tCount [expr $i - 1]
      set tPort [expr $i + 8]
      if { [lindex $wTagDUT2 $tCount] == &#34;true&#34; } { 
         <a name="::SendACmd(165)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan$i tag [lindex $tagListDUT2 $tCount]&#34;
         <a name="::SendACmd(166)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan$i add port [<a name="::MapDUTPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $tPort 2] tag&#34;
      } else {
         <a name="::SendACmd(167)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan$i add port [<a name="::MapDUTPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $tPort 2]&#34;
	  }
   }
   <a name="::SendACmd(168)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F1:00:00:01 vlan1 ports [<a name="::MapDUTPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 9 2]&#34;
   <a name="::SendACmd(169)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F2:00:00:01 vlan2 ports [<a name="::MapDUTPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 10 2]&#34;
   <a name="::SendACmd(170)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F3:00:00:01 vlan3 ports [<a name="::MapDUTPortId(9)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 11 2]&#34;
   <a name="::SendACmd(171)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F4:00:00:01 vlan4 ports [<a name="::MapDUTPortId(10)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 12 2]&#34;
} else {
   <a name="::SendACmd(172)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan1&#34;
   <a name="::SendACmd(173)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan1 ipa [lindex $vlanDUT2IpAddrList 0]&#34;

   if { [lindex $wTagDUT2 0] == &#34;true&#34; } { 
      <a name="::SendACmd(174)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 tag [lindex $tagListDUT2 0]&#34;
      <a name="::SendACmd(175)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 add port [<a name="::MapDUTPortId(11)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 9-12 2] tag&#34;
   } else {
      <a name="::SendACmd(176)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 add port [<a name="::MapDUTPortId(12)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 9-12 2]&#34;
   }
   <a name="::SendACmd(177)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F1:00:00:01 vlan1 ports [<a name="::MapDUTPortId(13)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 9 2]&#34;
   <a name="::SendACmd(178)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F2:00:00:01 vlan1 ports [<a name="::MapDUTPortId(14)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 10 2]&#34;
   <a name="::SendACmd(179)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F3:00:00:01 vlan1 ports [<a name="::MapDUTPortId(15)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 11 2]&#34;
   <a name="::SendACmd(180)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F4:00:00:01 vlan1 ports [<a name="::MapDUTPortId(16)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 12 2]&#34;
}
<a name="::SendACmd(181)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $dIpAddrList 0] 00:A3:F1:00:00:01&#34;
<a name="::SendACmd(182)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $dIpAddrList 1] 00:A3:F2:00:00:01&#34;
<a name="::SendACmd(183)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $dIpAddrList 2] 00:A3:F3:00:00:01&#34;
<a name="::SendACmd(184)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $dIpAddrList 3] 00:A3:F4:00:00:01&#34;

if {$mode == &#34;unicast&#34;} {
   <a name="::SendACmd(185)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipforwarding&#34;
   <span class="comment-line">#SendACmd	&#34;config rip add vlan all&#34;</span>
   <span class="comment-line">#SendACmd	&#34;enable rip&#34;</span>
   <span class="comment-line">#exSleep 10</span>
   <a name="::SendACmd(186)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config ipr add default 192.207.38.1&#34;
} else {
   <a name="::SendACmd(187)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable igmp&#34;
   <a name="::SendACmd(188)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure igmp 250 10 1 5&#34;
   <a name="::SendACmd(189)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure igmp snooping timer 1000 1000&#34;
   <a name="::SendACmd(190)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable igmp snooping&#34;
   <a name="::SendACmd(191)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipforwarding&#34;
   <span class="comment-line">#SendACmd	&#34;config rip add vlan all&#34;</span>
   <span class="comment-line">#SendACmd	&#34;enable rip&#34;</span>
   <a name="::SendACmd(192)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf ipr add default 192.207.38.1&#34;
   <a name="::SendACmd(193)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipmcforwarding&#34;
   <a name="::SendACmd(194)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config pim add vlan all&#34;
   <a name="::SendACmd(195)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable pim&#34;
}
<a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<a name="::SendACmd(196)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>     &#34;disable rip&#34;;
<a name="::exSleep(15)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10;
<a name="::SendACmd(197)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>     &#34;enable rip&#34;;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: QosTestCleanup   </span>
<span class="comment-line"># Description:  Clean up the QOS config set up by QosTestSetup                   </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line"># 	QosTestCleanup -mode $mode -vlanDUT1 $vlanDUT1 -sIpAddrList $sIpAddrList     </span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::QosTestCleanup_1167">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::QosTestCleanup">::::QosTestCleanup</a></a></strong> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> QosTestCleanup $args {
     mode &#34;unicast&#34;
     vlanDUT1 &#34;multiple&#34;
     vlanDUT2 &#34;multiple&#34;
     sIpAddrList &#34;192.10.1.2 192.10.2.2 192.10.3.2 192.10.4.2&#34;
     dIpAddrList &#34;192.20.1.2 192.20.2.2 192.20.3.2 192.20.4.2&#34;
     filePt &#34;NULL&#34;
     }
global DUT1_CONNECT
global PortID_Info
global whichDutNow
global bcmPlatform
global DUTs_info

<a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt
<a name="::SendACmd(198)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config default del port [<a name="::::GetATrunkPort(14)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
<a name="::SendACmd(199)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf ipr del default 192.207.38.2&#34;
<a name="::SendACmd(200)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconfig default ipa&#34;
if ![regexp -nocase &#34;$bcmPlatform&#34; $DUTs_info(DUT$whichDutNow,platform)] {
   <a name="::SendACmd(201)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconfig qosprofile&#34;
   <a name="::SendACmd(202)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconfig qosprofile port all&#34;
}
<a name="::SendACmd(203)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $sIpAddrList 0]&#34;
<a name="::SendACmd(204)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $sIpAddrList 1]&#34;
<a name="::SendACmd(205)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $sIpAddrList 2]&#34;
<a name="::SendACmd(206)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $sIpAddrList 3]&#34;

if {$vlanDUT1 == &#34;multiple&#34;} {
   <a name="::SendACmd(207)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconf access-list&#34;
   <a name="::SendACmd(208)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan1&#34;
   <a name="::SendACmd(209)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan2&#34;
   <a name="::SendACmd(210)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan3&#34;
   <a name="::SendACmd(211)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan4&#34;
} else {
   <a name="::SendACmd(212)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconf access-list&#34;
   <a name="::SendACmd(213)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan1&#34;
}

if {$mode == &#34;unicast&#34;} {
   <a name="::SendACmd(214)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable ipforwarding&#34;
   <span class="comment-line">#SendACmd	&#34;config rip del vlan all&#34;</span>
   <span class="comment-line">#SendACmd	&#34;disable rip&#34;</span>
} else {
   <a name="::SendACmd(215)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable igmp&#34;
   <a name="::SendACmd(216)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable igmp snooping&#34;
   <a name="::SendACmd(217)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>     &#34;unconfigure igmp&#34;
   <a name="::SendACmd(218)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable ipmcforwarding&#34;
   <a name="::SendACmd(219)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config pim del vlan all&#34;
   <a name="::SendACmd(220)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable pim&#34;
   <a name="::SendACmd(221)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable ipforwarding&#34;
   <span class="comment-line">#SendACmd	&#34;config rip del vlan all&#34;</span>
   <span class="comment-line">#SendACmd	&#34;disable rip&#34;</span>
}

<span class="comment-line">#SendACmd	&#34;configure ports [GetATrunkPort 1 2 1] auto on&#34;</span>

global DUT2_CONNECT
<a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT -fd $filePt
<a name="::SendACmd(222)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config default del port [<a name="::::GetATrunkPort(15)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1 1]&#34;
<a name="::SendACmd(223)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf ipr del default 192.207.38.1&#34;
<a name="::SendACmd(224)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconfig default ipa&#34;
<a name="::SendACmd(225)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $dIpAddrList 0]&#34;
<a name="::SendACmd(226)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $dIpAddrList 1]&#34;
<a name="::SendACmd(227)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $dIpAddrList 2]&#34;
<a name="::SendACmd(228)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $dIpAddrList 3]&#34;

if {$vlanDUT2 == &#34;multiple&#34;} {
   <a name="::SendACmd(229)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F1:00:00:01 vlan vlan1&#34;
   <a name="::SendACmd(230)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F2:00:00:01 vlan vlan2&#34;
   <a name="::SendACmd(231)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F3:00:00:01 vlan vlan3&#34;
   <a name="::SendACmd(232)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F4:00:00:01 vlan vlan4&#34;
   
   <a name="::SendACmd(233)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan1&#34;
   <a name="::SendACmd(234)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan2&#34;
   <a name="::SendACmd(235)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan3&#34;
   <a name="::SendACmd(236)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan4&#34;
} else {
   <a name="::SendACmd(237)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F1:00:00:01 vlan vlan1&#34;
   <a name="::SendACmd(238)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F2:00:00:01 vlan vlan1&#34;
   <a name="::SendACmd(239)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F3:00:00:01 vlan vlan1&#34;
   <a name="::SendACmd(240)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F4:00:00:01 vlan vlan1&#34;
   
   <a name="::SendACmd(241)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan1&#34;
}
if {$mode == &#34;unicast&#34;} {
   <a name="::SendACmd(242)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable ipforwarding&#34;
   <span class="comment-line">#SendACmd	&#34;config rip del vlan all&#34;</span>
   <span class="comment-line">#SendACmd	&#34;disable rip&#34;</span>
} else {
   <a name="::SendACmd(243)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable igmp&#34;
   <a name="::SendACmd(244)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable igmp snooping&#34;
   <a name="::SendACmd(245)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>     &#34;unconfigure igmp&#34;
   <a name="::SendACmd(246)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable ipmcforwarding&#34;
   <a name="::SendACmd(247)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config pim del vlan all&#34;
   <a name="::SendACmd(248)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable pim&#34;
   <a name="::SendACmd(249)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable ipforwarding&#34;
   <span class="comment-line">#SendACmd	&#34;config rip del vlan all&#34;</span>
   <span class="comment-line">#SendACmd	&#34;disable rip&#34;</span>
}

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: QosTestSetupSingleVlan   </span>
<span class="comment-line"># Description:  Set up one vlan only on both DUTs per single vlan QOS tests</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line"># 	QosTestSetupSingleVlan -wTag &#34;true&#34; -filePt $fd_res     </span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::QosTestSetupSingleVlan_1280">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::QosTestSetupSingleVlan">::::QosTestSetupSingleVlan</a></a></strong> {args} {
   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> QosTestSetupSingleVlan $args {
     sIpAddrList &#34;192.10.1.11 192.10.1.12 192.10.1.13 192.10.1.14&#34;
     dIpAddrList &#34;192.10.1.21 192.10.1.22 192.10.1.23 192.10.1.24&#34;
     vlanDUT1IpAddrList &#34;192.10.1.1&#34;
     vlanDUT2IpAddrList &#34;192.10.1.100&#34;
     wTag &#34;false&#34;
	 tagNo &#34;2&#34;
     filePt &#34;NULL&#34;
     }
global DUT1_CONNECT
global DUTs_info
global whichDutNow
global PortID_Info
global bcmPlatform
   

set 10GigSlot 0
<span class="comment-line">#for {set i 1} {$i&lt;=$DUTs_info(DUT1,numSlots)} {incr i} {</span>
<span class="comment-line">#   if {[regexp -nocase &#34;10Gig&#34; $DUTs_Slot_info(DUT1,slot$i,hwModType)]} {</span>
<span class="comment-line">#      set 10GigSlot 1</span>
<span class="comment-line">#      break</span>
<span class="comment-line">#   }</span>
<span class="comment-line">#}</span>

if {$10GigSlot} {
   <span class="comment-line"># Call 10Gig qos routine</span>
   return [<a name="::QosTestSetupSingleVlan10Gig(1)"><a href="./CheckBandwidthMatrices10G.tcl.html#::QosTestSetupSingleVlan10Gig_628">::QosTestSetupSingleVlan10Gig</a></a> -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList -vlanDUT1IpAddrList $vlanDUT1IpAddrList -vlanDUT2IpAddrList $vlanDUT2IpAddrList -wTag $wTag -tagNo $tagNo -filePt $filePt]
}

<a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt

   <a name="::SendACmd(250)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan1&#34;
   <a name="::SendACmd(251)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan1 ipa [lindex $vlanDUT1IpAddrList 0]&#34;
   if { $wTag == &#34;true&#34; } { 
      <a name="::SendACmd(252)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 tag $tagNo&#34;
      <a name="::SendACmd(253)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan1 add port [<a name="::MapDUTPortId(17)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1-4], [<a name="::::GetATrunkPort(16)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] tag&#34;
   } else {
      <a name="::SendACmd(254)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan1 add port [<a name="::MapDUTPortId(18)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1-4], [<a name="::::GetATrunkPort(17)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   }

   <a name="::SendACmd(255)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $sIpAddrList 0] 00:A1:F1:00:00:01&#34;
   <a name="::SendACmd(256)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $sIpAddrList 1] 00:A1:F2:00:00:01&#34;
   <a name="::SendACmd(257)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $sIpAddrList 2] 00:A1:F3:00:00:01&#34;
   <a name="::SendACmd(258)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $sIpAddrList 3] 00:A1:F4:00:00:01&#34;

   global bcmPlatform
   <span class="comment-line"># add 1 as debug use static for all platforms</span>
   if {1 || [regexp -nocase &#34;$bcmPlatform&#34; $DUTs_info(DUT$whichDutNow,platform)]} {
      <a name="::SendACmd(259)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F1:00:00:01 vlan1 ports [<a name="::::GetATrunkPort(18)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(260)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F2:00:00:01 vlan1 ports [<a name="::::GetATrunkPort(19)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(261)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F3:00:00:01 vlan1 ports [<a name="::::GetATrunkPort(20)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(262)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F4:00:00:01 vlan1 ports [<a name="::::GetATrunkPort(21)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   }
global DUT2_CONNECT
<a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT -fd $filePt

   <a name="::SendACmd(263)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan1&#34;

   if { $wTag == &#34;true&#34; } { 
      <a name="::SendACmd(264)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 tag $tagNo&#34;
      <a name="::SendACmd(265)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan1 add port [<a name="::MapDUTPortId(19)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 9-12 2], [<a name="::::GetATrunkPort(22)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1 1] tag&#34;
   } else {
      <a name="::SendACmd(266)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan1 add port [<a name="::MapDUTPortId(20)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 9-12 2], [<a name="::::GetATrunkPort(23)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1 1]&#34;
   }
   
   <a name="::SendACmd(267)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan vlan1 ipa [lindex $vlanDUT2IpAddrList 0]&#34;
   <a name="::SendACmd(268)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F1:00:00:01 vlan1 ports [<a name="::MapDUTPortId(21)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 9 2]&#34;
   <a name="::SendACmd(269)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F2:00:00:01 vlan1 ports [<a name="::MapDUTPortId(22)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 10 2]&#34;
   <a name="::SendACmd(270)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F3:00:00:01 vlan1 ports [<a name="::MapDUTPortId(23)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 11 2]&#34;
   <a name="::SendACmd(271)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F4:00:00:01 vlan1 ports [<a name="::MapDUTPortId(24)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 12 2]&#34;

   <a name="::SendACmd(272)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $dIpAddrList 0] 00:A3:F1:00:00:01&#34;
   <a name="::SendACmd(273)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $dIpAddrList 1] 00:A3:F2:00:00:01&#34;
   <a name="::SendACmd(274)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $dIpAddrList 2] 00:A3:F3:00:00:01&#34;
   <a name="::SendACmd(275)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp add [lindex $dIpAddrList 3] 00:A3:F4:00:00:01&#34;

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: QosTestCleanupSingleVlan   </span>
<span class="comment-line"># Description: Clean up the QOS config set up by QosTestSetupSingleVlan  </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      	QosTestCleanupSingleVlan -filePt $fd_res</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::QosTestCleanupSingleVlan_1369">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::QosTestCleanupSingleVlan">::::QosTestCleanupSingleVlan</a></a></strong> {args} {
   <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> QosTestCleanupSingleVlan $args {
     sIpAddrList &#34;192.10.1.11 192.10.1.12 192.10.1.13 192.10.1.14&#34;
     dIpAddrList &#34;192.10.1.21 192.10.1.22 192.10.1.23 192.10.1.24&#34;
     filePt &#34;NULL&#34;
     }
global DUT1_CONNECT
global PortID_Info
global whichDutNow
global bcmPlatform
global DUTs_info
set 10GigSlot 0
<span class="comment-line">#for {set i 1} {$i&lt;=$DUTs_info(DUT1,numSlots)} {incr i} {</span>
<span class="comment-line">#   if {[regexp -nocase &#34;10Gig&#34; $DUTs_Slot_info(DUT1,slot$i,hwModType)]} {</span>
<span class="comment-line">#      set 10GigSlot 1</span>
<span class="comment-line">#      break</span>
<span class="comment-line">#   }</span>
<span class="comment-line">#}</span>

if {$10GigSlot} {
   <span class="comment-line"># Call 10Gig qos routine</span>
   return [<a name="::QosTestCleanupSingleVlan10Gig(1)"><a href="./CheckBandwidthMatrices10G.tcl.html#::QosTestCleanupSingleVlan10Gig_692">::QosTestCleanupSingleVlan10Gig</a></a> -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList -filePt $filePt]
}
<a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt

   <a name="::SendACmd(276)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $sIpAddrList 0]&#34;
   <a name="::SendACmd(277)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $sIpAddrList 1]&#34;
   <a name="::SendACmd(278)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $sIpAddrList 2]&#34;
   <a name="::SendACmd(279)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $sIpAddrList 3]&#34;
   global bcmPlatform
   <span class="comment-line"># Add 1 for debug to add static for genesis as well</span>
   if {1 || [regexp -nocase &#34;$bcmPlatform&#34; $DUTs_info(DUT$whichDutNow,platform)]} {
      <a name="::SendACmd(280)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F1:00:00:01 vlan1&#34;
      <a name="::SendACmd(281)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F2:00:00:01 vlan1&#34;
      <a name="::SendACmd(282)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F3:00:00:01 vlan1&#34;
      <a name="::SendACmd(283)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F4:00:00:01 vlan1&#34;
   }
   if ![regexp -nocase &#34;$bcmPlatform&#34; $DUTs_info(DUT$whichDutNow,platform)] {
      <a name="::SendACmd(284)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconfig qosprofile&#34;
      <a name="::SendACmd(285)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconfig qosprofile port all&#34;
   }
   <a name="::SendACmd(286)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconf access-list&#34;
   <a name="::SendACmd(287)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan1&#34;



<span class="comment-line">#SendACmd	&#34;configure ports [GetATrunkPort 1 2 1] auto on&#34;</span>

global DUT2_CONNECT
<a name="::Login(12)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT -fd $filePt

   <a name="::SendACmd(288)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $dIpAddrList 0]&#34;
   <a name="::SendACmd(289)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $dIpAddrList 1]&#34;
   <a name="::SendACmd(290)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $dIpAddrList 2]&#34;
   <a name="::SendACmd(291)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config iparp del [lindex $dIpAddrList 3]&#34;


   <a name="::SendACmd(292)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F1:00:00:01 vlan vlan1&#34;
   <a name="::SendACmd(293)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F2:00:00:01 vlan vlan1&#34;
   <a name="::SendACmd(294)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F3:00:00:01 vlan vlan1&#34;
   <a name="::SendACmd(295)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F4:00:00:01 vlan vlan1&#34;
   
   <a name="::SendACmd(296)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan1&#34;

}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: configMatrix   </span>
<span class="comment-line"># Description:  Send IP stream from a list of ports after acess-list or port/vlan/fdb</span>
<span class="comment-line">#		are configured per qosType</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#  	configMatrix -priList $priList -portIdTxList $portIdTxList -qosType $qosType \</span>
<span class="comment-line">#		     -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList -sPortList $sPortList \</span>
<span class="comment-line">#                    -dPortList $dPortList -TOSList $TOSList -tagList $tagList \</span>
<span class="comment-line">#		     -destMacAddrTxList $destMacAddrTxList -ipProtocol $ipProtocol    </span>
<span class="comment-line"># Category: SetupSwitch, SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::configMatrix_1450">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::configMatrix">::::configMatrix</a></a></strong> {args} {
   <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> configMatrix $args {
     priList &#34;0 1 2 3&#34;
     portIdTxList &#34;1 2 3 4&#34;
     qosType &#34;802.1p&#34;
     destMacAddrTxList &#34;DUTMac&#34;
     sIpAddrList &#34;192.10.1.2 192.10.2.2 192.10.3.2 192.10.4.2&#34;
     dIpAddrList &#34;192.20.1.2 192.20.2.2 192.20.3.2 192.20.4.2&#34;
     sPortList &#34;0 0 0 0&#34;
     dPortList &#34;0 0 0 0&#34;
     TOSList &#34;0x00 0x00 0x00 0x00&#34;
     tagList &#34;none none none none&#34;
     ipProtocol &#34;ip&#34;
   }
   global startCardNum
   global DUTs_info
   global PortID_Info

   set 10GigSlot 0
<span class="comment-line">#   for {set i 1} {$i&lt;=$DUTs_info(DUT1,numSlots)} {incr i} {</span>
<span class="comment-line">#      if {[regexp -nocase &#34;10Gig&#34; $DUTs_Slot_info(DUT1,slot$i,hwModType)]} {</span>
<span class="comment-line">#         set 10GigSlot 1</span>
<span class="comment-line">#         break</span>
<span class="comment-line">#      }</span>
<span class="comment-line">#   }</span>

   if {$10GigSlot} {
      <span class="comment-line"># Call 10Gig qos routine</span>
      return [<a name="::configMatrix10Gig(1)"><a href="./CheckBandwidthMatrices10G.tcl.html#::configMatrix10Gig_730">::configMatrix10Gig</a></a> -priList $priList -portIdTxList $portIdTxList \
   -qosType $qosType -destMacAddrTxList $destMacAddrTxList \
   -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList -sPortList $sPortList \
   -dPortList $dPortList -TOSList $TOSList -tagList $tagList -ipProtocol $ipProtocol]
}
   set pPattern &#34;5678&#34;
   
   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(9)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      <a name="::ixStopPortTransmit(2)"><a href="./mapping.tcl.html#::ixStopPortTransmit_103">::ixStopPortTransmit</a></a>  $txChas $txCard $txPort  
   }

   set QPa &#34;QP[expr [lindex $priList 0]+1]&#34;
   set QPb &#34;QP[expr [lindex $priList 1]+1]&#34;
   set QPc &#34;QP[expr [lindex $priList 2]+1]&#34;
   set QPd &#34;QP[expr [lindex $priList 3]+1]&#34;

   switch $qosType {
      &#34;port&#34; {
         <a name="::SendACmd(297)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf port [<a name="::MapDUTPortId(25)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1] qosprofile $QPa&#34;
         <a name="::SendACmd(298)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf port [<a name="::MapDUTPortId(26)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 2] qosprofile $QPb&#34;
         <a name="::SendACmd(299)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf port [<a name="::MapDUTPortId(27)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 3] qosprofile $QPc&#34;
         <a name="::SendACmd(300)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf port [<a name="::MapDUTPortId(28)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 4] qosprofile $QPd&#34;
      }
      &#34;mac&#34; {
         <a name="::SendACmd(301)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F1:00:00:01 vlan vlan1&#34;
         <a name="::SendACmd(302)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F2:00:00:01 vlan vlan1&#34;
         <a name="::SendACmd(303)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F3:00:00:01 vlan vlan1&#34;
         <a name="::SendACmd(304)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F4:00:00:01 vlan vlan1&#34;
         <a name="::SendACmd(305)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F1:00:00:01 vlan vlan1 port [<a name="::::GetATrunkPort(24)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosprofile $QPa&#34;
         <a name="::SendACmd(306)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F2:00:00:01 vlan vlan1 port [<a name="::::GetATrunkPort(25)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosprofile $QPb&#34;
         <a name="::SendACmd(307)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F3:00:00:01 vlan vlan1 port [<a name="::::GetATrunkPort(26)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosprofile $QPc&#34;
         <a name="::SendACmd(308)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F4:00:00:01 vlan vlan1 port [<a name="::::GetATrunkPort(27)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosprofile $QPd&#34;
      }
      &#34;vlan&#34; {
         <a name="::SendACmd(309)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf vlan1 qosprofile $QPa&#34;
         <a name="::SendACmd(310)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf vlan2 qosprofile $QPb&#34;
         <a name="::SendACmd(311)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf vlan3 qosprofile $QPc&#34;
         <a name="::SendACmd(312)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf vlan4 qosprofile $QPd&#34;
      }
      &#34;10.1.1&#34; {
         <a name="::SendACmd(313)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsFor10.1.1 $QPa $QPb $QPc $QPd]
      }
      &#34;10.1.2&#34; {
         <a name="::SendACmd(314)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsFor10.1.2 $QPa $QPb $QPc $QPd]
      }
      &#34;10.1.4&#34; {
         <a name="::SendACmd(315)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsFor10.1.4 $QPa $QPb $QPc $QPd]
      }
      &#34;10.1.5&#34; {
         <a name="::SendACmd(316)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsFor10.1.5 &#34;destination-port&#34; $dPortList &#34;tcp&#34; $QPa $QPb $QPc $QPd]
      }
      &#34;10.1.6&#34; {
         <a name="::SendACmd(317)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsFor10.1.5 &#34;source-port&#34; $sPortList  &#34;udp&#34; $QPa $QPb $QPc $QPd]
      }
      &#34;10.1.7&#34; {
         <a name="::SendACmd(318)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsFor10.1.7 $QPa $QPb $QPc $QPd]
      }
      &#34;10.2.1&#34; {
         <a name="::SendACmd(319)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;32 32 32 32&#34; \
                      -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
      }
      &#34;10.2.2&#34; {
         <a name="::SendACmd(320)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;32 32 32 32&#34; \
                      -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
      }
      &#34;10.2.3&#34; {
         <a name="::SendACmd(321)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;8 16 24 8&#34; \
                      -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
      }
      &#34;10.2.4&#34; {
         <a name="::SendACmd(322)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;24 24 24 24&#34; \
                      -dstPortList $dPortList -proto $ipProtocol \
                      -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
      }
      &#34;10.2.5&#34; {
         <a name="::SendACmd(323)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;24 24 24 24&#34; \
                      -srcPortList $sPortList -proto $ipProtocol \
                      -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
      }
      &#34;10.2.6&#34; {
         <a name="::SendACmd(324)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
         set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;24 24 24 24&#34; \
                      -srcPortList $sPortList -proto $ipProtocol -dstPortList $dPortList \
                      -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
      }
      default {
      }
   }

   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(10)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      set portIdRx [expr $portIdTx + 8]
      <a name="::MapIxiaPortId(11)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdRx rxChas rxCard rxPort   
      set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
      set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
      set sPort [lindex $sPortList [expr $portIdTx - 1] ]
      set dPort [lindex $dPortList [expr $portIdTx - 1] ]
      set TOS [lindex $TOSList [expr $portIdTx - 1] ]
      set tag [lindex $tagList [expr $portIdTx - 1] ]
      set wTag &#34;true&#34;
      if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
      set priority [lindex $priList [expr $portIdTx - 1] ]
      if {$destMacAddrTxList == &#34;DUTMac&#34;} {
         global DUTs_info
         set destMacAddrTx $DUTs_info(DUT1,sysMAC)
      } else {
         set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
      }
      <span class="comment-line">#send a continuous ip stream</span>
      if {![regexp -nocase &#34;10.2&#34; $qosType]} {
         global DUT1_CONNECT
         <a name="::Login(13)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<span class="comment-line">#         SendACmd &#34;ping $dIpAddr&#34;</span>
      } else {
      set frameSent [<a name="::ixiaConf_2Ports_ip(4)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $txChas -txCard $txCard -txPort $txPort \
                       -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \
                       -startCardNum $startCardNum -dataPattern $pPattern \
                       -percentage $PortID_Info($portIdTx,normTxPerc) \
                       -TOS $TOS \
                       -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \
                       -dMacAddr $destMacAddrTx -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \
                       -wTag $wTag -tagNo $tag -userPriority $priority ]
      }
   }
   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(12)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      set portIdRx [expr $portIdTx + 8]
      <a name="::MapIxiaPortId(13)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdRx rxChas rxCard rxPort   
      set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
      set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
      set sPort [lindex $sPortList [expr $portIdTx - 1] ]
      set dPort [lindex $dPortList [expr $portIdTx - 1] ]
      set TOS [lindex $TOSList [expr $portIdTx - 1] ]
      set tag [lindex $tagList [expr $portIdTx - 1] ]
      set wTag &#34;true&#34;
      if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
      set priority [lindex $priList [expr $portIdTx - 1] ]
      if {$destMacAddrTxList == &#34;DUTMac&#34;} {
         global DUTs_info
         set destMacAddrTx $DUTs_info(DUT1,sysMAC)
      } else {
         set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
      }
      set frameSent [<a name="::ixiaConf_2Ports_ip(5)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $txChas -txCard $txCard -txPort $txPort \
                       -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \
                       -startCardNum $startCardNum -dataPattern $pPattern \
                       -streamType &#34;contPacket&#34; -percentage $PortID_Info($portIdTx,normTxPerc) \
                       -TOS $TOS -frameSizeType &#34;sizeRandom&#34; \
                       -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \
                       -dMacAddr $destMacAddrTx  -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \
                       -wTag $wTag -tagNo $tag -userPriority $priority ]
      <span class="comment-line">#wait for things to settle down</span>
<span class="comment-line">#      exSleep 3</span>
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: configBCMMatrixQosType   </span>
<span class="comment-line"># Description:  Send Variable Percentage IP stream from a list of </span>
<span class="comment-line">#               ports after acess-list or port/vlan/fdb</span>
<span class="comment-line">#       		are configured per qosType</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#  	configMatrixQosType -priList $priList -portIdTxList $portIdTxList -qosType $qosType \</span>
<span class="comment-line">#		     -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList -sPortList $sPortList \</span>
<span class="comment-line">#                    -dPortList $dPortList -TOSList $TOSList -tagList $tagList \</span>
<span class="comment-line">#		     -destMacAddrTxList $destMacAddrTxList -ipProtocol $ipProtocol    </span>
<span class="comment-line"># Category: SetupSwitch, SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckBCMMatrixQosType_1661">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::CheckBCMMatrixQosType">::::CheckBCMMatrixQosType</a></a></strong> {args} {
    <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> configMatrix $args {
        priList &#34;0 1 2 3&#34;
        portIdTxList &#34;1 2 3 4&#34;
        <a name="::protocol(2)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ip&#34;
        qosType &#34;802.1p&#34;
        srcMacAddrTxList &#34;srcMac&#34;
        destMacAddrTxList &#34;DUTMac&#34;
        sIpAddrList &#34;192.10.1.2 192.10.2.2 192.10.3.2 192.10.4.2&#34;
        dIpAddrList &#34;192.20.1.2 192.20.2.2 192.20.3.2 192.20.4.2&#34;
        sPortList &#34;0 0 0 0&#34;
        dPortList &#34;0 0 0 0&#34;
        TOSList &#34;0x00 0x00 0x00 0x00&#34;
        tagList &#34;none none none none&#34;
        ratioThreshold &#34;2.5&#34;
        qosEnable &#34;1&#34;
        percent_tolerance &#34;.061&#34;
    
    }
    
    set ipProtocol $protocol
    
    global startCardNum
    global PortID_Info
    global DUTs_info


    <span class="comment-line"># Local Variables</span>
    set portIdTxList &#34;1 2 3 4&#34;
    set portIdRxList &#34;9 10 11 12&#34;

    set 10GigSlot 0
<span class="comment-line">#   for {set i 1} {$i&lt;=$DUTs_info(DUT1,numSlots)} {incr i} {</span>
<span class="comment-line">#      if {[regexp -nocase &#34;10Gig&#34; $DUTs_Slot_info(DUT1,slot$i,hwModType)]} {</span>
<span class="comment-line">#         set 10GigSlot 1</span>
<span class="comment-line">#         break</span>
<span class="comment-line">#      }</span>
<span class="comment-line">#   }</span>

    if {$10GigSlot} {
        <span class="comment-line"># Call 10Gig qos routine</span>
        return [<a name="::configMatrix10Gig(2)"><a href="./CheckBandwidthMatrices10G.tcl.html#::configMatrix10Gig_730">::configMatrix10Gig</a></a> -priList $priList -portIdTxList $portIdTxList \
        -qosType $qosType -destMacAddrTxList $destMacAddrTxList \
        -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList -sPortList $sPortList \
        -dPortList $dPortList -TOSList $TOSList -tagList $tagList -ipProtocol $ipProtocol]
    }
    set pPattern &#34;5678&#34;
    
    foreach portIdTx $portIdTxList {
       <a name="::MapIxiaPortId(14)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
       <a name="::ixStopPortTransmit(3)"><a href="./mapping.tcl.html#::ixStopPortTransmit_103">::ixStopPortTransmit</a></a>  $txChas $txCard $txPort  
    }
    
    set QPa &#34;QP[expr [lindex $priList 0]+1]&#34;
    set QPb &#34;QP[expr [lindex $priList 1]+1]&#34;
    set QPc &#34;QP[expr [lindex $priList 2]+1]&#34;
    set QPd &#34;QP[expr [lindex $priList 3]+1]&#34;

    switch $qosType {
        &#34;port&#34; {
             <a name="::SendACmd(325)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf port [<a name="::MapDUTPortId(29)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1] qosprofile $QPa&#34;
             <a name="::SendACmd(326)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf port [<a name="::MapDUTPortId(30)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 2] qosprofile $QPb&#34;
             <a name="::SendACmd(327)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf port [<a name="::MapDUTPortId(31)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 3] qosprofile $QPc&#34;
             <a name="::SendACmd(328)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf port [<a name="::MapDUTPortId(32)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 4] qosprofile $QPd&#34;
        }
        &#34;mac&#34; {
             <a name="::SendACmd(329)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F1:00:00:01 vlan vlan1&#34;
             <a name="::SendACmd(330)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F2:00:00:01 vlan vlan1&#34;
             <a name="::SendACmd(331)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F3:00:00:01 vlan vlan1&#34;
             <a name="::SendACmd(332)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete fdbentry 00:A3:F4:00:00:01 vlan vlan1&#34;
             <a name="::SendACmd(333)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F1:00:00:01 vlan vlan1 port [<a name="::::GetATrunkPort(28)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosprofile $QPa&#34;
             <a name="::SendACmd(334)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F2:00:00:01 vlan vlan1 port [<a name="::::GetATrunkPort(29)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosprofile $QPb&#34;
             <a name="::SendACmd(335)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F3:00:00:01 vlan vlan1 port [<a name="::::GetATrunkPort(30)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosprofile $QPc&#34;
             <a name="::SendACmd(336)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create fdbentry 00:A3:F4:00:00:01 vlan vlan1 port [<a name="::::GetATrunkPort(31)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosprofile $QPd&#34;
        }
        &#34;vlan&#34; {
             <a name="::SendACmd(337)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf vlan1 qosprofile $QPa&#34;
             <a name="::SendACmd(338)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf vlan2 qosprofile $QPb&#34;
             <a name="::SendACmd(339)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf vlan3 qosprofile $QPc&#34;
             <a name="::SendACmd(340)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf vlan4 qosprofile $QPd&#34;
        }
        &#34;10.1.1&#34; {
             <a name="::SendACmd(341)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsFor10.1.1 $QPa $QPb $QPc $QPd]
        }
        &#34;10.1.2&#34; {
             <a name="::SendACmd(342)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsFor10.1.2 $QPa $QPb $QPc $QPd]
        }
        &#34;10.1.4&#34; {
             <a name="::SendACmd(343)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsFor10.1.4 $QPa $QPb $QPc $QPd]
        }
        &#34;10.1.5&#34; {
             <a name="::SendACmd(344)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsFor10.1.5 &#34;destination-port&#34; $dPortList &#34;tcp&#34; $QPa $QPb $QPc $QPd]
        }
        &#34;10.1.6&#34; {
             <a name="::SendACmd(345)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsFor10.1.5 &#34;source-port&#34; $sPortList  &#34;udp&#34; $QPa $QPb $QPc $QPd]
        }
        &#34;10.1.7&#34; {
             <a name="::SendACmd(346)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsFor10.1.7 $QPa $QPb $QPc $QPd]
        }
        &#34;10.2.1&#34; {
             <a name="::SendACmd(347)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;32 32 32 32&#34; \
                          -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
        }
        &#34;10.2.2&#34; {
             <a name="::SendACmd(348)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;32 32 32 32&#34; \
                          -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
        }
        &#34;10.2.3&#34; {
             <a name="::SendACmd(349)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;8 16 24 8&#34; \
                          -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
        }
        &#34;10.2.4&#34; {
             <a name="::SendACmd(350)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;24 24 24 24&#34; \
                          -dstPortList $dPortList -proto $ipProtocol \
                          -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
        }
        &#34;10.2.5&#34; {
             <a name="::SendACmd(351)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;24 24 24 24&#34; \
                          -srcPortList $sPortList -proto $ipProtocol \
                          -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
        }
        &#34;10.2.6&#34; {
             <a name="::SendACmd(352)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uncon access-list&#34;
             set polName [CreateACLsforMCast -dIpAddrList $dIpAddrList -dMaskList &#34;24 24 24 24&#34; \
                          -srcPortList $sPortList -proto $ipProtocol -dstPortList $dPortList \
                          -sIpAddrList $sIpAddrList -sMaskList &#34;24 24 24 24&#34; -qpList &#34;$QPa $QPb $QPc $QPd&#34;]
        }
        default {
        }
    }
    <span class="comment-line">#</span>
    <span class="comment-line"># Prime the traffic</span>
    <span class="comment-line">#</span>
   <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;---------------- PRIME Traffic ----------------&#34;
   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(15)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      set portIdRx [expr $portIdTx + 8]
      <a name="::MapIxiaPortId(16)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdRx rxChas rxCard rxPort   
      set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
      set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
      set sPort [lindex $sPortList [expr $portIdTx - 1] ]
      set dPort [lindex $dPortList [expr $portIdTx - 1] ]
      set TOS [lindex $TOSList [expr $portIdTx - 1] ]
      set tag [lindex $tagList [expr $portIdTx - 1] ]
      set wTag &#34;true&#34;
      if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
         set priority [lindex $priList [expr $portIdTx - 1] ]
      if {$destMacAddrTxList == &#34;DUTMac&#34;} {
         global DUTs_info
         set destMacAddrTx $DUTs_info(DUT1,sysMAC)
      } else {
         set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
      }
      <span class="comment-line">#send a continuous ip stream</span>
      if {![regexp -nocase &#34;10.2&#34; $qosType]} {
         global DUT1_CONNECT
         <a name="::Login(14)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
      } else {
         <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Prime% ID$portIdTx : $PortID_Info($portIdTx,normTxPerc) &#34;
         set frameSent [<a name="::ixiaConf_2Ports_ip(6)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $txChas -txCard $txCard -txPort $txPort \
                 -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \
                 -startCardNum $startCardNum -dataPattern $pPattern \
                 -percentage $PortID_Info($portIdTx,normTxPerc) \
                 -TOS $TOS \
                 -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \
                 -dMacAddr $destMacAddrTx -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \
                 -wTag $wTag -tagNo $tag -userPriority $priority ]
      }
   }


<span class="comment-line">#Matrix Values.  Traffic is throttled by the trunk port</span>
set qpList &#34;$QPa $QPb $QPc $QPd&#34;
if {$qosEnable} {
   set eTitle &#34;Enabled&#34;
   <span class="comment-line"># This is a little cryptic but qosPortOrder is a port</span>
   <span class="comment-line">#  ordering from lowest priority (1234 port 1 lowest 4 highest)</span>
   <span class="comment-line">#  (1342 port 1 lowest 3 next highest 4 next highest, 2 highest priority </span>
   set txBW {&#34;20  100 100 100&#34; &#34;20  33  100 100&#34; &#34;20  33  50  100&#34; &#34;20  34  50  100&#34;}
   set rxBW {&#34;100 0   0   0&#34;   &#34;100 100 0   0&#34;   &#34;100 100 100   0&#34; &#34;100 100 100 100&#34;}
   if {0} {
   for {set p 0} {$p&lt;4} {incr p} {
      set qpIn [lindex $qpList $p]
      switch $qpIn {
         &#34;QP1&#34; {
                set txPortBW1 [lindex $txBW 0]
                set rxPortBW1 [lindex $rxBW 0]
                lappend txBW $txPortBW1
                lappend rxBW $rxPortBW1
             }
         &#34;QP2&#34; {
                set txPortBW2 [lindex $txBW 1]
                set rxPortBW2 [lindex $rxBW 1]
                lappend txBW $txPortBW2
                lappend rxBW $rxPortBW2
             }
         &#34;QP3&#34; { 
                set txPortBW3 [lindex $txBW 2]
                set rxPortBW3 [lindex $rxBW 2]
                lappend txBW $txPortBW3
                lappend rxBW $rxPortBW3
             }
         &#34;QP4&#34; {
                set txPortBW4 [lindex $txBW 3]
                set rxPortBW4 [lindex $rxBW 3]
                lappend txBW $txPortBW4
                lappend rxBW $rxPortBW4
             }
      }
   }
   }
   <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$txBW&#34;
   <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$rxBW&#34;

} else {
    set eTitle &#34;Disabled&#34;
    set txBW {{20 50 75 100} \
                       {20 50 75 100} \
                       {20 50 75 100} \
                       {20 50 75 100}}
    set rxBW {{100 50 33 25} \
                       {100 50 33 25} \
                       {100 50 33 25} \
                       {100 50 33 25}}
}

    <span class="comment-line">################################################</span>
    set subTest &#34;Checking $qosType $eTitle Bandwidth criteria using $QPa, $QPb, $QPc, $QPd&#34;
    <span class="comment-line">################################################</span>
    result_h2 &#34;$subTest&#34;
    <a name="::report_start_test(12)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
    set j 0;
    foreach priValue $priList {
        <span class="comment-line">################################################</span>
        set subTest &#34;Matrix Variable Rates $QPa Rx=[lindex [lindex $rxBW 0] $j] $QPb Rx=[lindex [lindex $rxBW 1] $j] $QPc Rx=[lindex [lindex $rxBW 2] $j] $QPd Rx=[lindex [lindex $rxBW 3] $j]&#34;
        <span class="comment-line">################################################</span>
        result_h2 &#34;$subTest&#34;
        <a name="::report_start_test(13)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
           set portIndex 0;
           foreach portIdTx $portIdTxList {
              <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;TX % ID$portIdTx : [expr (double([lindex [lindex $txBW $portIndex] $j]) * double($PortID_Info($portIdTx,normTxPercBy100)))]&#34;
              set portIdRx [expr $portIdTx + 8]
              set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
              set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
              set sPort [lindex $sPortList $portIndex ]
              set dPort [lindex $dPortList $portIndex ]
              set TOS [lindex $TOSList $portIndex ]
              set tag [lindex $tagList $portIndex ]
              set wTag &#34;true&#34;
              if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
              set priority [lindex $priList [expr $portIdTx - 1] ]
              if {$destMacAddrTxList == &#34;DUTMac&#34;} {
                 global DUTs_info
                 set destMacAddrTx $DUTs_info(DUT1,sysMAC)
              } else {
                 set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
              }
              <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;TOS = $TOS Test percentage [lindex [lindex $txBW $portIndex] $j]&#34;;
              <span class="comment-line">#set frameSent [ixiaConf_2Ports_ip	-txChas $txChas -txCard $txCard -txPort $txPort \</span>
              <span class="comment-line">#                 -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \</span>
              <span class="comment-line">#                 -startCardNum $startCardNum -dataPattern $pPattern \</span>
              <span class="comment-line">#                 -streamType &#34;contPacket&#34; -percentage [lindex [lindex $txBW $portIndex] $j] -TOS $TOS -frameSizeType &#34;sizeRandom&#34; \</span>
              <span class="comment-line">#                 -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \</span>
              <span class="comment-line">#                 -dMacAddr $destMacAddrTx  -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \</span>
              <span class="comment-line">#                 -wTag $wTag -tagNo $tag -userPriority $priority ]</span>
              <span class="comment-line">#wait for things to settle down</span>
              <a name="::SendIpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $portIdTx -streamType &#34;contPacket&#34; \
              -tag $tag \
              -userPriority $priority -TOS $TOS \
              -percentage [expr (double([lindex [lindex $txBW $portIndex] $j]) * double($PortID_Info($portIdTx,normTxPercBy100)))] \
              -destMac $destMacAddrTx \
              -sourceIp [lindex $sIpAddrList $portIndex] \
              -destIp [lindex $dIpAddrList $portIndex] \
              -sourcePort [lindex $sPortList $portIndex] \
              -destPort [lindex $dPortList  $portIndex]
        <span class="comment-line">#      exSleep 3</span>
              incr portIndex;
          }              
           
          set tag [lindex $tagList $j]
          if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }

          <a name="::SendACmd(353)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear count&#34;
           
          <a name="::ClearPortsStats(1)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdTxList
          <a name="::ClearPortsStats(2)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdRxList
            
          <a name="::exSleep(16)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
          lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
          lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
          lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
          lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
          lappend checkRateList &#34;{1 [lindex [lindex $txBW 0] $j]} {9  [lindex [lindex $rxBW 0] $j]} $tag&#34;
          lappend checkRateList &#34;{2 [lindex [lindex $txBW 1] $j]} {10 [lindex [lindex $rxBW 1] $j]} $tag&#34;
          lappend checkRateList &#34;{3 [lindex [lindex $txBW 2] $j]} {11 [lindex [lindex $rxBW 2] $j]} $tag&#34;
          lappend checkRateList &#34;{4 [lindex [lindex $txBW 3] $j]} {12 [lindex [lindex $rxBW 3] $j]} $tag&#34;
          <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
          <a name="::CheckRatesTxRx(11)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for receive rates based on QP Assignment&#34; $percent_tolerance
          unset checkRateList
          <a name="::StopPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $portIdTxList;
            
          <a name="::report_end_test(12)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
          incr j;
     }
     <a name="::report_end_test(13)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
}


<span class="comment-line">#############################################################################</span>
<strong><a name="::::CheckBCMMatrix_1981">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::CheckBCMMatrix">::::CheckBCMMatrix</a></a></strong> {args} {
   <a name="::parse_args(8)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckBandwidthMatrix $args {
     <a name="::protocol(3)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ip&#34;
     srcMacAddrTxList &#34;srcMac&#34;
     destMacAddrTxList &#34;DUTMac&#34;
     sIpAddrList &#34;192.10.1.2 192.10.2.2 192.10.3.2 192.10.4.2&#34;
     dIpAddrList &#34;192.20.1.2 192.20.2.2 192.20.3.2 192.20.4.2&#34;
     sPortList &#34;0 0 0 0&#34;
     dPortList &#34;0 0 0 0&#34;
     TOSList &#34;0x00 0x00 0x00 0x00&#34;
     QPList &#34;1 2 3 4&#34;
     tagList &#34;none none none none&#34;
     rxPortsTagged &#34;0&#34;
     checkQosList &#34;&#34;
     checkMatrix &#34;BasicL2&#34;
     ratioThreshold &#34;3&#34;
     qosType &#34;802.1p&#34;
     filePt &#34;NULL&#34;
     testFileName &#34;Temp&#34;
     qosEnable &#34;1&#34;
   }
global startCardNum
global DUTs_info
global PortID_Info
<span class="comment-line"># Local Variables</span>
set portIdTxList &#34;1 2 3 4&#34;
set portIdRxList &#34;9 10 11 12&#34;
set pPattern &#34;5678&#34;

if {$protocol == &#34;multicast&#34;} {
   set joinGroup 22
   set portList {1 2 3 4}
   foreach portId $portList {
      set portIdTx [expr $portId + 8]
      set multicastIP 22[expr $portId + 4].1.2.3
      set destMacMulticast &#34;01 00 5E 01 02 03&#34; 
      set clientIP1 192.20.$portId.2
      <span class="comment-line">#send an join multicast group igmp packet</span>
      <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$clientIP1 joins multicast group $multicastIP&#34;
      set rxPort [<a name="::MapIxiaPortId(17)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx chasis card port]
      set frameSent [<a name="::ixiaConf_2Ports_ip(7)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $chasis -txCard $card  -txPort $port \
                       -rxChas $chasis -rxCard $card  -rxPort $rxPort  \
                       -ipProtocol &#34;igmp&#34; -type $joinGroup -ttl 1      \
                       -startCardNum $startCardNum  -dMacAddr $destMacMulticast \
                       -sIpAddr  $clientIP1  -dIpAddr $multicastIP -groupAddr $multicastIP ]
   }

   set ipProtocol &#34;udp&#34;
   set destMacAddrTxList {01:00:5E:01:02:03 01:00:5E:01:02:03 01:00:5E:01:02:03 01:00:5E:01:02:03}
   <span class="comment-line">#send join</span>
} else {
   set ipProtocol $protocol
}
set QPa &#34;QP[lindex $QPList 0]&#34;
set QPb &#34;QP[lindex $QPList 1]&#34;
set QPc &#34;QP[lindex $QPList 2]&#34;
set QPd &#34;QP[lindex $QPList 3]&#34;
set Qa [expr [lindex $QPList 0] - 1]
set Qb [expr [lindex $QPList 1] - 1]
set Qc [expr [lindex $QPList 2] - 1]
set Qd [expr [lindex $QPList 3] - 1]
<span class="comment-line">#Matrix Values.  Traffic is throttled by the trunk port</span>
if {$qosEnable} {
    <span class="comment-line"># This is a little cryptic but qosPortOrder is a port</span>
    <span class="comment-line">#  ordering from lowest priority (1234 port 1 lowest 4 highest)</span>
    <span class="comment-line">#  (1342 port 1 lowest 3 next highest 4 next highest, 2 highest priority </span>
    set txBW {&#34;20  100 100 100&#34; &#34;20  33  100 100&#34; &#34;20  33  50  100&#34; &#34;20  34  50  100&#34;}
    set rxBW {&#34;100 0   0   0  &#34; &#34;100 100 0   0&#34;   &#34;100 100 100   0&#34; &#34;100 100 100 100&#34;}
    if {0} {
    for {set p 0} {$p&lt;4} {incr p} {
        set qpIn [lindex $QPList $p]
        switch $qpIn {
            &#34;4&#34; {
                   set txPortBW1 [lindex $txBW $p]
                   set rxPortBW1 [lindex $rxBW $p]
                   lappend txBW $txPortBW1
                   lappend rxBW $rxPortBW1
                }
            &#34;3&#34; {
                   set txPortBW2 [lindex $txBW $p]
                   set rxPortBW2 [lindex $rxBW $p]
                   lappend txBW $txPortBW2
                   lappend rxBW $rxPortBW2
                }
            &#34;2&#34; { 
                   set txPortBW3 [lindex $txBW $p]
                   set rxPortBW3 [lindex $rxBW $p]
                   lappend txBW $txPortBW3
                   lappend rxBW $rxPortBW3
                }
            &#34;1&#34; {
                   set txPortBW4 [lindex $txBW $p]
                   set rxPortBW4 [lindex $rxBW $p]
                   lappend txBW $txPortBW4
                   lappend rxBW $rxPortBW4
                }
        }
    }
    }

} else {
    set txBW  {&#34;20 50 75 100&#34; \
                        &#34;20 50 75 100&#34; \
                        &#34;20 50 75 100&#34; \
                        &#34;20 50 75 100&#34; }
    set rxBW  {&#34;100 50 33 25&#34; \
                        &#34;100 50 33 25&#34; \
                        &#34;100 50 33 25&#34; \
                        &#34;100 50 33 25&#34;}
}


if {$checkMatrix == &#34;BasicL2&#34;} {

    <span class="comment-line">################################################</span>
    set subTest &#34;Checking Basic L2 Bandwidth criteria using $QPa, $QPb, $QPc, $QPd&#34;
    <span class="comment-line">################################################</span>
    result_h2 &#34;$subTest&#34;
    <a name="::report_start_test(14)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
    set w 0;
    foreach qpValue $QPList {
        <span class="comment-line">################################################</span>
        set subTest &#34;$QPa Tx=[lindex [lindex $txBW 0] $w] dot1P=[expr [lindex $QPList 0] - 1] $QPb Tx=[lindex [lindex $txBW 1] $w] dot1P=[expr [lindex $QPList 1] - 1]  $QPc Tx=[lindex [lindex $txBW 2] $w] dot1P=[expr [lindex $QPList 2] - 1] $QPd Tx=[lindex [lindex $txBW 3] $w] dot1P=[expr [lindex $QPList 3] - 1] &#34;
        <span class="comment-line">################################################</span>
        result_h2 &#34;$subTest&#34;
        <a name="::report_start_test(15)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
        set idListIndex 0;
        foreach portIdTx $portIdTxList {
            <a name="::SendFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $portIdTx -streamType &#34;contPacket&#34; \
            -tag [lindex $tagList $idListIndex] \
            -tagPriority [expr [lindex $QPList $idListIndex] - 1] \
            -sourceMac [lindex $srcMacAddrTxList $idListIndex] \
            -percentage [expr (double([lindex [lindex $txBW $idListIndex] $w])  * double($PortID_Info($portIdTx,normTxPercBy100)))] \
            -destMac [lindex $destMacAddrTxList $idListIndex]
    
            <span class="comment-line">#make a taglist for the rate check below</span>
            if {[lindex $tagList $idListIndex] == &#34;none&#34; || !$rxPortsTagged} {
                lappend tagRateList &#34;{}&#34;
            } else {
                lappend tagRateList [lindex $tagList $idListIndex]
            }

            incr idListIndex
        }



        <a name="::SendACmd(354)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear count&#34;
        
        <a name="::ClearPortsStats(3)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdTxList
        <a name="::ClearPortsStats(4)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdRxList
        
        <a name="::exSleep(17)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
        lappend checkRateList {&#34;negTest&#34; &#34;1 0&#34;}
        lappend checkRateList {&#34;negTest&#34; &#34;2 0&#34;}
        lappend checkRateList {&#34;negTest&#34; &#34;3 0&#34;}
        lappend checkRateList {&#34;negTest&#34; &#34;4 0&#34;}
        lappend checkRateList &#34;{1 [lindex [lindex $txBW 0] $w]} {9  [lindex [lindex $rxBW 0] $w] [lindex $tagRateList 0]} &#34;
        lappend checkRateList &#34;{2 [lindex [lindex $txBW 1] $w]} {10 [lindex [lindex $rxBW 1] $w] [lindex $tagRateList 1]} &#34;
        lappend checkRateList &#34;{3 [lindex [lindex $txBW 2] $w]} {11 [lindex [lindex $rxBW 2] $w] [lindex $tagRateList 2]} &#34;
        lappend checkRateList &#34;{4 [lindex [lindex $txBW 3] $w]} {12 [lindex [lindex $rxBW 3] $w] [lindex $tagRateList 3]} &#34;
        <a name="::CheckRatesTxRx(12)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for receive rates based on QP Assignment&#34; $ratioThreshold
        unset checkRateList
        <a name="::StopPortsTransmit(2)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $portIdTxList;
        
        incr w;

        <a name="::report_end_test(14)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
    }
    <a name="::report_end_test(15)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
}
if {$checkMatrix == &#34;BasicL3&#34;} {

    <span class="comment-line">################################################</span>
    set subTest &#34;Checking Basic L3 Bandwidth criteria using $QPa, $QPb, $QPc, $QPd&#34;
    <span class="comment-line">################################################</span>
    result_h2 &#34;$subTest&#34;
    <a name="::report_start_test(16)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
    set w 0;
    foreach qpValue $QPList {
        <span class="comment-line">################################################</span>
        set subTest &#34;$QPa Tx=[lindex [lindex $txBW 0] $w] dot1P=[expr [lindex $QPList 0] - 1] $QPb Tx=[lindex [lindex $txBW 1] $w] dot1P=[expr [lindex $QPList 1] - 1]  $QPc Tx=[lindex [lindex $txBW 2] $w] dot1P=[expr [lindex $QPList 2] - 1] $QPd Tx=[lindex [lindex $txBW 3] $w] dot1P=[expr [lindex $QPList 3] - 1] &#34;
        <span class="comment-line">################################################</span>
        result_h2 &#34;$subTest&#34;
        <a name="::report_start_test(17)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
        set idListIndex 0;
        foreach portIdTx $portIdTxList {

            if {$destMacAddrTxList == &#34;DUTMac&#34;} {
               global DUTs_info
               set destMacAddrTx $DUTs_info(DUT1,sysMAC)
            } else {
               set destMacAddrTx [lindex $destMacAddrTxList $idListIndex ]
            }

            <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;txid = $portIdTx -tag [lindex $tagList $idListIndex] \
            -userPriority [expr [lindex $QPList $idListIndex] - 1] \
            -percentage [expr (double([lindex [lindex $txBW $idListIndex] $w]) * double($PortID_Info($portIdTx,normTxPercBy100)))] \
            -destMac $destMacAddrTx \
            -sourceIp [lindex $sIpAddrList $idListIndex] \
            -destIp [lindex $dIpAddrList $idListIndex] \
            -sourcePort [lindex $sPortList $idListIndex] \
            -destPort [lindex $dPortList  $idListIndex]&#34;

            <a name="::SendIpFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $portIdTx -streamType &#34;contPacket&#34; \
            -tag [lindex $tagList $idListIndex] \
            -userPriority [expr [lindex $QPList $idListIndex] - 1] \
            -percentage [expr (double([lindex [lindex $txBW $idListIndex] $w])  * double($PortID_Info($portIdTx,normTxPercBy100)))] \
            -destMac $destMacAddrTx \
            -sourceIp [lindex $sIpAddrList $idListIndex] \
            -destIp [lindex $dIpAddrList $idListIndex] \
            -sourcePort [lindex $sPortList $idListIndex] \
            -destPort [lindex $dPortList  $idListIndex]
    
            <span class="comment-line">#make a taglist for the rate check below</span>
            if {[lindex $tagList $idListIndex] == &#34;none&#34; || !$rxPortsTagged} {
                lappend tagRateList &#34;{}&#34;
            } else {
                lappend tagRateList [lindex $tagList $idListIndex]
            }

            incr idListIndex
        }

        set tag [lindex $tagList $w ]
        if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
        <a name="::Login(15)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT1,connect)
        <a name="::SendACmd(355)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear count&#34;
        <a name="::SendACmd(356)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show ipr&#34;
        <a name="::SendACmd(357)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show port [<a name="::MapDUTPortId(33)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1-4],[<a name="::::GetATrunkPort(32)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] stat&#34;
        <a name="::SendACmd(358)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear count&#34;
        <a name="::Login(16)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT2,connect)
        <a name="::SendACmd(359)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear count&#34;
        <a name="::SendACmd(360)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show ipr&#34;
        <a name="::SendACmd(361)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show port [<a name="::MapDUTPortId(34)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 9-12 2],[<a name="::::GetATrunkPort(33)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1 1] stat&#34;
        <a name="::ClearPortsStats(5)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdTxList
        <a name="::ClearPortsStats(6)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdRxList
        
        <span class="comment-line">#puts &#34;\nDebug Traffic Flow Sleeping&#34;;</span>
        <a name="::exSleep(18)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
        lappend checkRateList {&#34;negTest&#34; &#34;1 0&#34;}
        lappend checkRateList {&#34;negTest&#34; &#34;2 0&#34;}
        lappend checkRateList {&#34;negTest&#34; &#34;3 0&#34;}
        lappend checkRateList {&#34;negTest&#34; &#34;4 0&#34;}
        lappend checkRateList &#34;{1 [lindex [lindex $txBW 0] $w]} {9  [lindex [lindex $rxBW 0] $w] [lindex $tagRateList 0]}&#34;
        lappend checkRateList &#34;{2 [lindex [lindex $txBW 1] $w]} {10 [lindex [lindex $rxBW 1] $w] [lindex $tagRateList 1]}&#34;
        lappend checkRateList &#34;{3 [lindex [lindex $txBW 2] $w]} {11 [lindex [lindex $rxBW 2] $w] [lindex $tagRateList 2]}&#34;
        lappend checkRateList &#34;{4 [lindex [lindex $txBW 3] $w]} {12 [lindex [lindex $rxBW 3] $w] [lindex $tagRateList 3]}&#34;
        <a name="::CheckRatesTxRx(13)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for receive rates based on QP Assignment&#34; $ratioThreshold
        unset checkRateList
        <a name="::StopPortsTransmit(3)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $portIdTxList;
        
        incr w;

        <a name="::report_end_test(16)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
    }
    <a name="::report_end_test(17)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
}


   if {$protocol == &#34;multicast&#34;} { 
      global DUT2_CONNECT
      <a name="::Login(17)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT -fd $filePt
      <span class="comment-line">#SendACmd	&#34;clear igmp snooping&#34;</span>

      global DUT1_CONNECT
      <a name="::Login(18)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt
      <span class="comment-line">#SendACmd	&#34;clear igmp snooping&#34;</span>
   }

}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CreateBcmQPs   </span>
<span class="comment-line"># Description:  Since only Qp1 and Qp8 are on BCM by default.. </span>
<span class="comment-line">#		        create the rest or a portion</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#  	CreateBcmQPs -dutList &#34;1 2&#34;   </span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CreateBcmQPs_2263">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::CreateBcmQPs">::::CreateBcmQPs</a></a></strong> {args} {
   <a name="::parse_args(9)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CreateBcmQPs $args {
      dutList &#34;1&#34;
      qpList &#34;2 3 4 5 6 7&#34;
      defaultDot1P &#34;1&#34;
   }
   global DUTs_info
   foreach dutID $dutList {
       <a name="::Login(19)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT${dutID},connect)
       foreach qp $qpList {
           <a name="::SendACmd(362)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create qosprofile qp$qp&#34;;
       }
       if {$defaultDot1P} {
           foreach qp $qpList {
               <a name="::SendACmd(363)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure dot1p type [expr $qp -1] qp$qp&#34;
           }
       }
   }
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: DeleteBcmQPs   </span>
<span class="comment-line"># Description:  Since only Qp1 and Qp8 are on BCM by default.. </span>
<span class="comment-line">#		        This state should be returned to after a test runs</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#  	DeleteBcmQPs -dutList &#34;1 2&#34;   </span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::DeleteBcmQPs_2293">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::DeleteBcmQPs">::::DeleteBcmQPs</a></a></strong> {args} {
   <a name="::parse_args(10)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CreateBcmQPs $args {
      dutList &#34;1&#34;
      qpList &#34;2 3 4 5 6 7&#34;
      cleanDot1P &#34;1&#34;
   }
   global DUTs_info
   foreach dutID $dutList {
       <a name="::Login(20)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT${dutID},connect)
       if {$cleanDot1P} {
           foreach qp $qpList {
               if {$qp != 8} {
                   <a name="::SendACmd(364)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure dot1p type [expr $qp - 1] qp1&#34;
               } else {
                   <a name="::SendACmd(365)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure dot1p type 7 qp8&#34;
               }
               
           }
       }
       foreach qp $qpList {
           <a name="::SendACmd(366)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete qosprofile qp$qp&#34;;
       }
   }
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ConfigDiffServExamMapping   </span>
<span class="comment-line"># Description:  Since only Qp1 and Qp8 are on BCM by default.. </span>
<span class="comment-line">#		  diffserv examination dscp mapping values</span>
<span class="comment-line">#                 are set to none standard values.  This function</span>
<span class="comment-line">#                 allows for creation of dscp to qp mappings </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#  	ConfigDiffServExamMapping -dutList &#34;1&#34; -dscpList &#34;0 8 16&#34; \</span>
<span class="comment-line">#             -qpList &#34;1 2 3&#34;</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ConfigDiffServExamMapping_2331">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::ConfigDiffServExamMapping">::::ConfigDiffServExamMapping</a></a></strong> {args} {
   <a name="::parse_args(11)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CreateBcmQPs $args {
      dutList &#34;1&#34;
      dscpList &#34;0 8 16 23 24 25 32 40 48 50 56&#34;
      qpList   &#34;1 2 3  3  4  4  5  6  7  7  8&#34;
   }
   global DUTs_info
   foreach dutID $dutList {
       <a name="::Login(21)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT${dutID},connect)
       set i 0;
       foreach qp $qpList {
           <a name="::SendACmd(367)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf diff exam code-point [lindex $dscpList $i] qp[lindex $qpList $i]&#34;;
           incr i;
       }
   }
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: UnConfigBcmDiffServExam   </span>
<span class="comment-line"># Description:  Since only Qp1 and Qp8 are on BCM by default.. </span>
<span class="comment-line">#		  diffserv examination values are set to none </span>
<span class="comment-line">#                 standard values.  This function returns </span>
<span class="comment-line">#                 diffserv exam to base bcm config </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#  	UnConfigDiffServExamMapping -dutList &#34;1&#34; -dscpList &#34;0 8 16&#34;</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::UnConfigBcmDiffServExamMapping_2360">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::UnConfigBcmDiffServExamMapping">::::UnConfigBcmDiffServExamMapping</a></a></strong> {args} {
   <a name="::parse_args(12)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CreateBcmQPs $args {
      dutList &#34;1&#34;
      dscpList &#34;0 8 16 23 24 25 32 40 48 50 56&#34;
   }
   global DUTs_info
   foreach dutID $dutList {
      <a name="::Login(22)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT${dutID},connect)
      foreach ds $dscpList {
         if {$ds &lt; 56} {
            <a name="::SendACmd(368)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf diff exam code-point $ds qp1&#34;;               
         } else {
            <a name="::SendACmd(369)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf diff exam code-point $ds qp8&#34;;
         }
      }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckBCMQueuePriority   </span>
<span class="comment-line"># Description:  Since BCM has no QOS MONITOR we need a way </span>
<span class="comment-line">#               to gaurantee traffic is on the right queue.  This</span>
<span class="comment-line">#               Function will send traffic on the queue directly</span>
<span class="comment-line">#               below the test traffic and none should pass.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#  	CheckBCMQueuePriority -priorityList 0 -txPortList 2 \</span>
<span class="comment-line">#		     -sIpAddrList 192.168.1.12 -dIpAddrList 192.168.2.12 -sPortList 0 \</span>
<span class="comment-line">#                    -dPortList 0 -TOSList 0x00 -tagList &#34;none&#34; \</span>
<span class="comment-line">#		     -destMacList DUTMac -ipProtocol ip    </span>
<span class="comment-line"># Category: SetupSwitch, SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckBCMQueuePriority_2395">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::CheckBCMQueuePriority">::::CheckBCMQueuePriority</a></a></strong> {args} {
    <a name="::parse_args(13)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> configMatrix $args {
        traffic &#34;L3&#34;
        priorityList &#34;0&#34;
        txPortList &#34;2&#34;
        rxPortList &#34;4&#34;
        <a name="::protocol(4)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ip&#34;
        srcMacAddrList &#34;default&#34;
        destMacList &#34;DUTMac&#34;
        sIpAddrList &#34;192.10.1.2&#34;
        dIpAddrList &#34;192.20.1.2&#34;
        dIpGwAddrList &#34;192.20.1.1&#34;
        sPortList &#34;0&#34;
        dPortList &#34;0&#34;
        TOSList &#34;0x00&#34;
        tagList &#34;none&#34;
        ratioThreshold &#34;2&#34;
        percentage &#34;100&#34;
    }

global PortID_Info
if {$traffic == &#34;L3&#34;} {

    <span class="comment-line">################################################</span>
    set subTest &#34;Start L3 traffic on a lower QP.  If shoud not pass&#34;
    <span class="comment-line">################################################</span>
    result_h2 &#34;$subTest&#34;
    <a name="::report_start_test(18)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;

    global DUTs_info

    set i 0;
    foreach txPort $txPortList {
        <a name="::SendArpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId [lindex $rxPortList $i] \
         -sourceIp [lindex $dIpAddrList $i] -destIp [lindex $dIpGwAddrList $i]

        incr i;
    }

    set i 0;
    foreach txPort $txPortList {
        if {[lindex $destMacList $i] == &#34;DUTMac&#34;} {
           set destMacAddrTx $DUTs_info(DUT1,sysMAC)
        } else {
           set destMacAddrTx [lindex $destMacList $i]
        }
    
        <a name="::SendIpFrame(3)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPort -streamType &#34;contPacket&#34; \
        -tag [lindex $tagList $i] \
        -userPriority [lindex $priorityList $i] -TOS [lindex $TOSList $i] \
        -percentage $percentage \
        -destMac $destMacAddrTx \
        -sourceIp [lindex $sIpAddrList $i] \
        -destIp [lindex $dIpAddrList $i] \
        -sourcePort [lindex $sPortList $i] \
        -destPort [lindex $dPortList  $i]

        incr i;
    }

    <a name="::ClearPortsStats(7)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $txPortList
    <a name="::ClearPortsStats(8)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $rxPortList
    
    <a name="::exSleep(19)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3;

    set i 0;
    foreach txPort $txPortList {
        if {[lindex $tagList $i] == &#34;none&#34;} {
            set tag &#34;&#34;;
        } else {
            set tag [lindex $tagList $i];
        }
        lappend checkRateList &#34;{[lindex $portIdTxList $i] $percentage} {[lindex $portIdRxList $i] 0 $tag}&#34;
        incr i;
    }
    <a name="::CheckRatesTxRx(14)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for receive rates based on QP Assignment&#34; $ratioThreshold
    unset checkRateList
    <a name="::StopPortsTransmit(4)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $txPortList;
}

if {$traffic == &#34;L2&#34;} {

    <span class="comment-line">################################################</span>
    set subTest &#34;Start L2 traffic on a lower QP.  If shoud not pass&#34;
    <span class="comment-line">################################################</span>
    result_h2 &#34;$subTest&#34;
    <a name="::report_start_test(19)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;

    <span class="comment-line"># Prime receive fdb</span>
    set i 0;
    foreach txPort $txPortList {
            <a name="::SendFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId [lindex $rxPortList $i] \
            -tag [lindex $tagList $i] \
            -sourceMac [lindex $destMacList $i] \
            -destMac [lindex $srcMacAddrList $i]
    
            incr i;
    }    

    set i 0;
    foreach txPort $txPortList {
        <a name="::SendFrame(3)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $txPort -streamType &#34;contPacket&#34; \
        -tag [lindex $tagList $i] \
        -tagPriority [lindex $priorityList $i] \
        -sourceMac [lindex $srcMacAddrList $i] \
        -percentage $percentage \
        -destMac [lindex $destMacList $i]

        incr i;
    }

    <a name="::ClearPortsStats(9)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $txPortList
    <a name="::ClearPortsStats(10)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $rxPortList
    
    <a name="::exSleep(20)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3;

    set i 0;
    foreach txPort $txPortList {
        if {[lindex $tagList $i] == &#34;none&#34;} {
            set tag &#34;&#34;;
        } else {
            set tag [lindex $tagList $i];
        }
        lappend checkRateList &#34;{[lindex $portIdTxList $i] $percentage} {[lindex $portIdRxList $i] 0 $tag}&#34;
        incr i;
    }
    <a name="::CheckRatesTxRx(15)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for receive rates based on QP Assignment&#34; $ratioThreshold
    unset checkRateList
    <a name="::StopPortsTransmit(5)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $txPortList;

}

}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckBWMatrixNewGenBCom   </span>
<span class="comment-line"># Description:  Verify the effects of QOS based on qos profiles matrix</span>
<span class="comment-line">#		in QOS test plan or user-specified ones</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line"># 	SendACmd &#34;create access-list permitList1 ip dest any source 192.10.1.0/24 deny ports any&#34;</span>
<span class="comment-line">#	SendACmd &#34;create access-list permitList2 ip dest any source 192.10.2.0/24 deny ports any&#34;</span>
<span class="comment-line">#	SendACmd &#34;create access-list permitList3 ip dest any source 192.10.3.0/24 permit QP3 ports any&#34;</span>
<span class="comment-line">#	SendACmd &#34;create access-list permitList4 ip dest any source 192.10.4.0/24 deny ports any&#34;</span>
<span class="comment-line">#	CheckBWMatrixNewGenBCom -checkMatrix 8 -filePt $fd_res \</span>
<span class="comment-line">#                          -testFileName $testNo     </span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckBWMatrixNewGenBCom_2546">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::CheckBWMatrixNewGenBCom">::::CheckBWMatrixNewGenBCom</a></a></strong> {args} {
   <a name="::parse_args(14)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckBWMatrixNewGenBCom $args {
     numIxiaCd &#34;3&#34;
     <a name="::protocol(5)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ip&#34;
     srcMacAddrTxList &#34;srcMac&#34;
     destMacAddrTxList &#34;DUTMac&#34;
     sIpAddrList &#34;192.10.1.2 192.10.2.2 192.10.3.2 192.10.4.2&#34;
     dIpAddrList &#34;192.20.1.2 192.20.2.2 192.20.3.2 192.20.4.2&#34;
     sPortList &#34;0 0 0 0&#34;
     dPortList &#34;0 0 0 0&#34;
     TOSList &#34;0x00 0x00 0x00 0x00&#34;
     QPList &#34;1 2 3 4&#34;
     priList &#34;0 1 2 3&#34;
     tagList &#34;none none none none&#34;
     checkQosList &#34;&#34;
     ratioExpectList &#34;25.00 25.00 25.00 25.00&#34;
     ratioThreshold &#34;20&#34;
     ratioAggregateThreshold &#34;2.5&#34;
     checkMatrix &#34;1-7&#34;
     userMatrix &#34;none&#34;
     qosType &#34;802.1p&#34;
     filePt &#34;NULL&#34;
     testFileName &#34;Temp&#34;
     initRateCheck &#34;1&#34;
     frameSizeType &#34;sizeRandom&#34;
     frameSize &#34;64&#34;
   }

set percent_tolerance [expr double($ratioThreshold) / double(100)]
global startCardNum
global DUTs_info
global PortID_Info
<span class="comment-line"># Check for 10Gig platform, call different checkBwMatrix specifically</span>
global DUTs_Slot_info
set 10GigSlot 0
<span class="comment-line">#for {set i 1} {$i&lt;=$DUTs_info(DUT1,numSlots)} {incr i} {</span>
<span class="comment-line">#   if {[regexp -nocase &#34;10Gig&#34; $DUTs_Slot_info(DUT1,slot$i,hwModType)]} {</span>
<span class="comment-line">#      set 10GigSlot 1</span>
<span class="comment-line">#      break</span>
<span class="comment-line">#   }</span>
<span class="comment-line">#}</span>

if {$10GigSlot} {
   <span class="comment-line"># Call 10Gig qos routine</span>
   if {$ratioAggregateThreshold==2.5} {
      set ratioAggregateThreshold 14
   }
   if {[regexp -nocase &#34;25.00 25.00 25.00 25.00&#34; $ratioExpectList]} {
      set ratioExpectList &#34;100.00 100.00 100.00 100.00&#34;
   }
   return [<a name="::CheckBandwidthMatrix10Gig(2)"><a href="./CheckBandwidthMatrices10G.tcl.html#::CheckBandwidthMatrix10Gig_1">::CheckBandwidthMatrix10Gig</a></a> -numIxiaCd $numIxiaCd -protocol $protocol -srcMacAddrTxList $srcMacAddrTxList -destMacAddrTxList $destMacAddrTxList \
   -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList \
   -QPList $QPList -tagList $tagList -checkQosList $checkQosList \
    -ratioExpectList $ratioExpectList -ratioThreshold $ratioThreshold \
    -ratioAggregateThreshold $ratioAggregateThreshold -checkMatrix $checkMatrix \
    -qosType $qosType -filePt $filePt -testFileName $testFileName]
}

set pPattern &#34;5678&#34;
if {$protocol == &#34;multicast&#34;} {
   set joinGroup 22
   set portList {1 2 3 4}
   foreach portId $portList {
      set portIdTx [expr $portId + 8]
      set multicastIP 22[expr $portId + 4].1.2.3
      set destMacMulticast &#34;01 00 5E 01 02 03&#34; 
      set clientIP1 192.20.$portId.2
      <span class="comment-line">#send an join multicast group igmp packet</span>
      <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$clientIP1 joins multicast group $multicastIP&#34;
      set rxPort [<a name="::MapIxiaPortId(18)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx chasis card port]
      set frameSent [<a name="::ixiaConf_2Ports_ip(8)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $chasis -txCard $card  -txPort $port \
                       -rxChas $chasis -rxCard $card  -rxPort $rxPort  \
                       -ipProtocol &#34;igmp&#34; -type $joinGroup -ttl 1      \
                       -percentage $PortID_Info($portId,normTxPerc) \
                       -startCardNum $startCardNum  -dMacAddr $destMacMulticast \
                       -sIpAddr  $clientIP1  -dIpAddr $multicastIP -groupAddr $multicastIP ]
   }

   set ipProtocol &#34;udp&#34;
   set destMacAddrTxList {01:00:5E:01:02:03 01:00:5E:01:02:03 01:00:5E:01:02:03 01:00:5E:01:02:03}
   <span class="comment-line">#send join</span>
} else {
   set ipProtocol $protocol
}
set QPa &#34;QP[lindex $QPList 0]&#34;
set QPb &#34;QP[lindex $QPList 1]&#34;
set QPc &#34;QP[lindex $QPList 2]&#34;
set QPd &#34;QP[lindex $QPList 3]&#34;
set Qa [expr [lindex $QPList 0] - 1]
set Qb [expr [lindex $QPList 1] - 1]
set Qc [expr [lindex $QPList 2] - 1]
set Qd [expr [lindex $QPList 3] - 1]

if {$checkMatrix == 8} {
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 8 Bandwidth criteria using $QPa, $QPb, $QPc, $QPd&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(20)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;        
   <span class="comment-line">#Test Matrix 8</span>
   <a name="::SendACmd(370)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPa minbw 10 maxbw 100 port [<a name="::::GetATrunkPort(34)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(371)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPb minbw 10 maxbw 100 port [<a name="::::GetATrunkPort(35)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(372)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPc minbw 10 maxbw 100 port [<a name="::::GetATrunkPort(36)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(373)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPd minbw 10 maxbw 100 port [<a name="::::GetATrunkPort(37)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
} elseif {$checkMatrix == &#34;1-7&#34;} {
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 1 Bandwidth criteria&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(21)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   
   global DUT1_CONNECT
   <a name="::Login(23)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt
   <a name="::SendACmd(374)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPa minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(38)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(375)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPb minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(39)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(376)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPc minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(40)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(377)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPd minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(41)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
}

   set portIdTxList {1 2 3 4}
   set portIdRxList {9 10 11 12}
   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(19)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      set portIdRx [expr $portIdTx + 8]
      <a name="::MapIxiaPortId(20)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdRx rxChas rxCard rxPort   
      set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
      set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
      set sPort [lindex $sPortList [expr $portIdTx - 1] ]
      set dPort [lindex $dPortList [expr $portIdTx - 1] ]
      set TOS [lindex $TOSList [expr $portIdTx - 1] ]
      set tag [lindex $tagList [expr $portIdTx - 1] ]
      set wTag &#34;true&#34;
      if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
      set priority [lindex $priList [expr $portIdTx - 1] ]
      if {$destMacAddrTxList == &#34;DUTMac&#34;} {
         set destMacAddrTx $DUTs_info(DUT1,sysMAC)
      } else {
         set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
      }
      if {![regexp -nocase &#34;10.2&#34; $qosType] &amp;&amp; $checkMatrix!=8} {
         global DUT1_CONNECT
<span class="comment-line">#         Login $DUT1_CONNECT</span>
<span class="comment-line">#         SendACmd &#34;ping $dIpAddr&#34;</span>
      } else {
         set frameSent [<a name="::ixiaConf_2Ports_ip(9)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -txChas $txChas -txCard $txCard -txPort $txPort \
                          -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \
                          -startCardNum $startCardNum -dataPattern $pPattern \
                          -TOS $TOS -numFrames 4 \
                          -percentage $PortID_Info($portIdTx,normTxPerc) \
                          -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \
                          -dMacAddr $destMacAddrTx  -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \
                          -wTag $wTag -tagNo $tag -userPriority $priority ]
      }
   }
   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(21)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      set portIdRx [expr $portIdTx + 8]
      <a name="::MapIxiaPortId(22)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdRx rxChas rxCard rxPort   
      set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
      set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
      set sPort [lindex $sPortList [expr $portIdTx - 1] ]
      set dPort [lindex $dPortList [expr $portIdTx - 1] ]
      set TOS [lindex $TOSList [expr $portIdTx - 1] ]
      set tag [lindex $tagList [expr $portIdTx - 1] ]
      set wTag &#34;true&#34;
      if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
      set priority [lindex $priList [expr $portIdTx - 1] ]
      if {$destMacAddrTxList == &#34;DUTMac&#34;} {
         set destMacAddrTx $DUTs_info(DUT1,sysMAC)
      } else {
         set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
      }

      set frameSent [<a name="::ixiaConf_2Ports_ip(10)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $txChas -txCard $txCard -txPort $txPort \
                       -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \
                       -startCardNum $startCardNum -dataPattern $pPattern \
                       -streamType &#34;contPacket&#34; -percentage $PortID_Info($portIdTx,normTxPerc) \
                       -TOS $TOS -frameSizeType &#34;$frameSizeType&#34; \
                       -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \
                       -dMacAddr $destMacAddrTx  -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \
                       -wTag $wTag -tagNo $tag -userPriority $priority ]
      <span class="comment-line">#wait for things to settle down</span>
      if {$initRateCheck} {
         <a name="::exSleep(21)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 6
         set portIdList {1 2 3 4 9 10 11 12}
         foreach portId $portIdList {
            
            <a name="::MapIxiaPortId(23)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
            <a name="::stat(7)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
            set rateSent [<a name="::stat(8)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesSent]
            set rateRecv [<a name="::stat(9)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesReceived]
            set rateArray($portId,sent) $rateSent.00
            set rateArray($portId,recv) $rateRecv.00
         
            <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;
         }
         if {$checkMatrix == 8} {
         
         } elseif {$checkMatrix == &#34;1-7&#34;} {
            set ratioFound [format %.2f [expr $rateArray($portIdRx,recv)*100/($rateArray($portIdTx,sent)+1)]]
            set ratioExpect 100
            if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioThreshold } {
               <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Matrix 1 failed rate ratio threshold test on port $portIdRx. Got $ratioFound EXPECT $ratioExpect +/- $ratioThreshold&#34;
            } else {
               <a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Matrix 1 pass rate ratio threshold test on port $portIdRx. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioThreshold&#34;
            }
         }         
      }

   }
   if {$checkMatrix == 8} { 
      set portIdList {1 2 3 4 9 10 11 12}
      foreach portId $portIdList {
         
         <a name="::MapIxiaPortId(24)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
         <a name="::stat(10)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
         set rateSent [<a name="::stat(11)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesSent]
         set rateRecv [<a name="::stat(12)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesReceived]
         set rateArray($portId,sent) $rateSent.00
         set rateArray($portId,recv) $rateRecv.00
      
            <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Mtrx8 Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;
      } 
      set ratioExpectArray(9) 0
      set ratioExpectArray(10) 0
      set ratioExpectArray(11) 100
      set ratioExpectArray(12) 0

      <a name="::exSleep(22)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         <span class="comment-line">##set portIdTx [expr $portId - 8]</span>
         <span class="comment-line">##set ratioFound [format %.2f [expr $rateArray($portId,recv)*100/($rateArray($portIdTx,sent)+1)]]</span>
         <span class="comment-line">##set ratioExpect $ratioExpectArray($portId)</span>
         <span class="comment-line">##if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioThreshold } {</span>
         <span class="comment-line">##   result_error &#34;Matrix 8 failed rate ratio threshold test on port $portId. Got $ratioFound EXPECT $ratioExpect +/- $ratioThreshold&#34;</span>
         <span class="comment-line">##} else {</span>
         <span class="comment-line">##   result_ok &#34;Matrix 8 pass rate ratio threshold test on port $portId. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioThreshold&#34;</span>
         <span class="comment-line">##}</span>
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }

      <span class="comment-line">################# Replace Old Gorp with New Proc  ##################</span>
      <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(16)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 8 Rates based on QP Assignment&#34; $percent_tolerance
      unset checkRateList

      <span class="comment-line">####################################################################</span>
      <a name="::report_end_test(18)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(378)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;

      <span class="comment-line">#check Q</span>
      <span class="comment-line">#lappend checkQosList &#34;0 1000 minPacket&#34; ;#not testing this, unpredictable for now</span>
      lappend checkQosList &#34;$Qb 10 maxPacket&#34;
      lappend checkQosList &#34;$Qc 1000 minPacket&#34;
      lappend checkQosList &#34;$Qd 10 maxPacket&#34;
      <a name="::CheckQoSMonitor(11)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(42)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName
      unset checkQosList
   } elseif {$checkMatrix == &#34;1-7&#34;} {
      set ratioExpectArray(9) 0
      set ratioExpectArray(10) 0
      set ratioExpectArray(11) 0
      set ratioExpectArray(12) 100
      <span class="comment-line">#foreach portId $portIdRxList {</span>
      <span class="comment-line">#   set portIdTx [expr $portId - 8]</span>
      <span class="comment-line">#   set ratioFound [format %.2f [expr $rateArray($portId,recv)*100/($rateArray($portIdTx,sent)+1)]]</span>
      <span class="comment-line">#   set ratioExpect $ratioExpectArray($portId)</span>
      <span class="comment-line">#   if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioThreshold } {</span>
      <span class="comment-line">#      result_error &#34;Matrix 1 failed rate ratio threshold test on port $portId. Got $ratioFound EXPECT $ratioExpect +/- $ratioThreshold&#34;</span>
      <span class="comment-line">#   } else {</span>
      <span class="comment-line">#      result_ok &#34;Matrix 1 pass rate ratio threshold test on port $portId. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioThreshold&#34;</span>
      <span class="comment-line">#   }</span>
      <span class="comment-line">#}</span>

      <a name="::exSleep(23)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(17)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 1 Rates based on QP Assignment&#34; $percent_tolerance
      unset checkRateList

      <a name="::report_end_test(19)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(379)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <a name="::SendACmd(380)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show ports [<a name="::::GetATrunkPort(43)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosmonitor no-refresh&#34;
      <span class="comment-line">#check Q</span>
      <span class="comment-line"># Matrix1 has qosmonitor problems when leaking to Q2.</span>
      lappend checkQosList &#34;$Qa 10 maxPacket&#34;
      lappend checkQosList &#34;$Qb 10 maxPacket&#34;
      lappend checkQosList &#34;$Qc 4000 maxPacket&#34;
      lappend checkQosList &#34;$Qd 4000 minPacket&#34;
      <a name="::CheckQoSMonitor(12)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(44)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList  

      <a name="::SendACmd(381)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPa minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(45)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(382)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPb minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(46)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(383)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPc minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(47)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(384)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPd minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(48)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;

   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 2 Bandwidth criteria using QP1, QP3, QP5, QP7&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(22)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   <span class="comment-line">#Test Matrix 2</span>
   set priList &#34;0 2 4 6&#34;
   if {$qosType==&#34;diffserv&#34;} {
      set TOSList &#34;0x00 0x40 0x80 0xc0&#34;
   } elseif {$qosType==&#34;diffservCodePoint&#34;} {
      <a name="::SendACmd(385)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
      <a name="::SendACmd(386)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP7&#34;
      <a name="::SendACmd(387)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP3&#34;
      set TOSList &#34;0x00 0x64 0x80 0x20&#34;
   }
   <a name="::configMatrix(8)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                -ipProtocol $ipProtocol

   <a name="::SendACmd(388)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp1 minbw 10 maxbw 100 port [<a name="::::GetATrunkPort(49)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(389)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp3 minbw 10 maxbw 100 port [<a name="::::GetATrunkPort(50)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(390)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp5 minbw 10 maxbw 100 port [<a name="::::GetATrunkPort(51)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(391)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp7 minbw 10 maxbw 100 port [<a name="::::GetATrunkPort(52)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;

      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(24)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
      set portIdList {1 2 3 4 9 10 11 12}
 
      set sum 0
      set ratioExpectArray(9) 10.00
      set ratioExpectArray(10) 10.00
      set ratioExpectArray(11) 10.00
      set ratioExpectArray(12) 70.00

      set ratioExpect 100


      <a name="::exSleep(25)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(18)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 2 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList
      <a name="::report_end_test(20)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

      <a name="::SendACmd(392)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <a name="::exSleep(26)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;0 100 minPacket&#34;
      lappend checkQosList &#34;2 100 minPacket&#34;
      lappend checkQosList &#34;4 100 minPacket&#34;
      lappend checkQosList &#34;6 700 minPacket&#34;
      <a name="::CheckQoSMonitor(13)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(53)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName
      unset checkQosList

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(393)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 0 maxbw 100  port [<a name="::::GetATrunkPort(54)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(394)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(55)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(395)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(56)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(396)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(57)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;

   <span class="comment-line"># Matrix 3 does not apply to broadcom because priority is not available.</span>
   <span class="comment-line"># Matrix 4 deleted</span>

      
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 5 Bandwidth criteria using QP1, QP4, QP5, QP8&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(23)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;          
   <span class="comment-line">#Test Matrix 5</span>
   set priList &#34;0 3 4 7&#34;
   if {$qosType==&#34;diffserv&#34;} {
      set TOSList &#34;0x00 0x60 0x80 0xe0&#34;
   } elseif {$qosType==&#34;diffservCodePoint&#34;} {
      <a name="::SendACmd(397)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
      <a name="::SendACmd(398)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP8&#34;
      <a name="::SendACmd(399)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP4&#34;
      set TOSList &#34;0x00 0x64 0x80 0x20&#34;
   }
   <a name="::configMatrix(9)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                -ipProtocol $ipProtocol   

   <a name="::SendACmd(400)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 10 maxbw 100  port [<a name="::::GetATrunkPort(58)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(401)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 10 maxbw 50 port [<a name="::::GetATrunkPort(59)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(402)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 10 maxbw 40 port [<a name="::::GetATrunkPort(60)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(403)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 10 maxbw 30 port [<a name="::::GetATrunkPort(61)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(27)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      set portIdList {1 2 3 4 9 10 11 12}
      <span class="comment-line">#foreach portId $portIdList {</span>
      <span class="comment-line">#   </span>
      <span class="comment-line">#   MapIxiaPortId $portId chasisId card port</span>
      <span class="comment-line">#   stat getRate statAllStats $chasisId $card $port</span>
      <span class="comment-line">#   set rateSent [stat cget -bytesSent]</span>
      <span class="comment-line">#   set rateRecv [stat cget -bytesReceived]</span>
      <span class="comment-line">#   set rateArray($portId,sent) $rateSent.00</span>
      <span class="comment-line">#   set rateArray($portId,recv) $rateRecv.00</span>
      <span class="comment-line">#</span>
      <span class="comment-line">#      result_debug &#34;Mtrx5 Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;</span>
      <span class="comment-line">#} </span>
      <span class="comment-line">#set sum 0</span>
      set ratioExpectArray(9) 10.00
      set ratioExpectArray(10) 20.00
      set ratioExpectArray(11) 40.00
      set ratioExpectArray(12) 30.00
      <span class="comment-line">#foreach portId $portIdRxList {</span>
      <span class="comment-line">#   set portIdTx [expr $portId - 8]</span>
      <span class="comment-line">#   set ratioFound [format %.2f [expr $rateArray($portId,recv)*100/($rateArray($portIdTx,sent)+1)]]</span>
      <span class="comment-line">#   set ratioExpect $ratioExpectArray($portId)</span>
      <span class="comment-line">#   set proratedRatioThreshold [expr $ratioExpect/100.00*$ratioThreshold]</span>
      <span class="comment-line">#   set sum [expr $ratioFound + $sum]</span>
      <span class="comment-line">#   if {[expr abs($ratioFound - $ratioExpect)] &gt; $proratedRatioThreshold } {</span>
      <span class="comment-line">#      result_error &#34;Matrix 5 failed rate ratio threshold test on port $portId. Got $ratioFound EXPECT $ratioExpect +/- $proratedRatioThreshold&#34;</span>
      <span class="comment-line">#   } else {</span>
      <span class="comment-line">#      result_ok &#34;Matrix 5 pass rate ratio threshold test on port $portId. Got $ratioFound AS EXPECT $ratioExpect +/- $proratedRatioThreshold&#34;</span>
      <span class="comment-line">#   }</span>
      <span class="comment-line">#} </span>
      <span class="comment-line">#total rate</span>
      set ratioExpect 100
      <span class="comment-line">#set ratioFound $sum</span>
      <span class="comment-line">#if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioAggregateThreshold } {</span>
      <span class="comment-line">#   result_error &#34;Matrix 5 failed aggregate rate ratio threshold test. Got $ratioFound EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;</span>
      <span class="comment-line">#} else {</span>
      <span class="comment-line">#   result_ok &#34;Matrix 5 pass rate aggregate ratio threshold test. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;</span>
      <span class="comment-line">#}</span>

      <a name="::exSleep(28)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(19)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 5 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList

      <a name="::report_end_test(21)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(404)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <a name="::exSleep(29)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;0 90 minPacket&#34;
      lappend checkQosList &#34;3 180 minPacket&#34;
      lappend checkQosList &#34;4 360 minPacket&#34;
      lappend checkQosList &#34;7 270 minPacket&#34;
      <a name="::CheckQoSMonitor(14)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(62)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList      

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(405)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(63)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(406)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(64)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(407)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(65)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(408)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(66)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;

      
   <span class="comment-line">## Removed Matrix 6 - Broadcom Q priority can not be changed</span>
      
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 7 Bandwidth criteria using QP1, QP3, QP5, QP7&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(24)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;        
   <span class="comment-line">#Test Matrix 7</span>
   set priList &#34;0 2 4 6&#34;
   if {$qosType==&#34;diffserv&#34;} {
      set TOSList &#34;0x00 0x40 0x80 0xc0&#34;
   } elseif {$qosType==&#34;diffservCodePoint&#34;} {
      <a name="::SendACmd(409)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination&#34;      
      <a name="::SendACmd(410)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP7&#34;
      <a name="::SendACmd(411)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP3&#34;
      set TOSList &#34;0x00 0x64 0x80 0x20&#34;
   }
   <a name="::configMatrix(10)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                -ipProtocol $ipProtocol   

   <a name="::SendACmd(412)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 10 maxbw 50  port [<a name="::::GetATrunkPort(67)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(413)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 20 maxbw 50 port [<a name="::::GetATrunkPort(68)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(414)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 25 maxbw 50 port [<a name="::::GetATrunkPort(69)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(415)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 35 maxbw 50 port [<a name="::::GetATrunkPort(70)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(30)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      set portIdList {1 2 3 4 9 10 11 12}
      <span class="comment-line">#foreach portId $portIdList {</span>
      <span class="comment-line">#   </span>
      <span class="comment-line">#   MapIxiaPortId $portId chasisId card port</span>
      <span class="comment-line">#   stat getRate statAllStats $chasisId $card $port</span>
      <span class="comment-line">#   set rateSent [stat cget -bytesSent]</span>
      <span class="comment-line">#   set rateRecv [stat cget -bytesReceived]</span>
      <span class="comment-line">#   set rateArray($portId,sent) $rateSent.00</span>
      <span class="comment-line">#   set rateArray($portId,recv) $rateRecv.00</span>
      <span class="comment-line">#</span>
      <span class="comment-line">#      result_debug &#34;Mtrx7 Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;</span>
      <span class="comment-line">#} </span>
      <span class="comment-line">#set sum 0</span>
      set ratioExpectArray(9) 10.00
      set ratioExpectArray(10) 18.70
      set ratioExpectArray(11) 26.30
      set ratioExpectArray(12) 45.00
      <span class="comment-line">#foreach portId $portIdRxList {</span>
      <span class="comment-line">#   set portIdTx [expr $portId - 8]</span>
      <span class="comment-line">#   set ratioFound [format %.2f [expr $rateArray($portId,recv)*100/($rateArray($portIdTx,sent)+1)]]</span>
      <span class="comment-line">#   set ratioExpect $ratioExpectArray($portId)</span>
      <span class="comment-line">#   set proratedRatioThreshold [expr $ratioExpect/100.00*$ratioThreshold]</span>
      <span class="comment-line">#   set sum [expr $ratioFound + $sum]</span>
      <span class="comment-line">#   if {[expr abs($ratioFound - $ratioExpect)] &gt; $proratedRatioThreshold } {</span>
      <span class="comment-line">#      result_error &#34;Matrix 7 failed rate ratio threshold test on port $portId. Got $ratioFound EXPECT $ratioExpect +/- $proratedRatioThreshold&#34;</span>
      <span class="comment-line">#   } else {</span>
      <span class="comment-line">#      result_ok &#34;Matrix 7 pass rate ratio threshold test on port $portId. Got $ratioFound AS EXPECT $ratioExpect +/- $proratedRatioThreshold&#34;</span>
      <span class="comment-line">#   }</span>
      <span class="comment-line">#} </span>
      <span class="comment-line">#total rate</span>
      set ratioExpect 100
      <span class="comment-line">#set ratioFound $sum</span>
      <span class="comment-line">#if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioAggregateThreshold } {</span>
      <span class="comment-line">#   result_error &#34;Matrix 7 failed aggregate rate ratio threshold test. Got $ratioFound EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;</span>
      <span class="comment-line">#} else {</span>
      <span class="comment-line">#   result_ok &#34;Matrix 7 pass rate aggregate ratio threshold test. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;</span>
      <span class="comment-line">#}</span>

      <a name="::exSleep(31)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(20)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 7 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList
      <a name="::report_end_test(22)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <span class="comment-line">#check Q</span>
      <a name="::SendACmd(416)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <a name="::exSleep(32)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
      lappend checkQosList &#34;0 100 minPacket&#34;
      lappend checkQosList &#34;2 180 minPacket&#34;
      lappend checkQosList &#34;4 260 minPacket&#34;
      lappend checkQosList &#34;6 450 minPacket&#34;
      <a name="::CheckQoSMonitor(15)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(71)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList   
      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(417)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 0 maxbw 100  port [<a name="::::GetATrunkPort(72)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(418)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(73)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(419)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(74)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(420)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(75)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
               
} elseif {$checkMatrix == &#34;user&#34;} {
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking User Bandwidth criteria&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(25)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
      
   if {$userMatrix == 5} {
      <a name="::SendACmd(421)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 10 maxbw 100  port [<a name="::::GetATrunkPort(76)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(422)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 10 maxbw 50 port [<a name="::::GetATrunkPort(77)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(423)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 10 maxbw 40 port [<a name="::::GetATrunkPort(78)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(424)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 10 maxbw 30 port [<a name="::::GetATrunkPort(79)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <span class="comment-line">#set ratioExpectArray(9) 10.00</span>
      <span class="comment-line">#set ratioExpectArray(10) 20.00</span>
      <span class="comment-line">#set ratioExpectArray(11) 40.00</span>
      <span class="comment-line">#set ratioExpectArray(12) 30.00</span>
      <span class="comment-line">#lappend checkQosList &#34;0 90 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;3 180 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;4 360 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;7 270 minPacket&#34;      </span>
      <a name="::exSleep(33)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5   
   }
   if {$userMatrix == 7} {
      <a name="::SendACmd(425)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 10 maxbw 50  port [<a name="::::GetATrunkPort(80)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(426)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 20 maxbw 50 port [<a name="::::GetATrunkPort(81)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(427)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 25 maxbw 50 port [<a name="::::GetATrunkPort(82)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(428)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 35 maxbw 50 port [<a name="::::GetATrunkPort(83)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <span class="comment-line">#set ratioExpectArray(9) 10.00</span>
      <span class="comment-line">#set ratioExpectArray(10) 18.70</span>
      <span class="comment-line">#set ratioExpectArray(11) 26.30</span>
      <span class="comment-line">#set ratioExpectArray(12) 45.00</span>
      <span class="comment-line">#lappend checkQosList &#34;0 100 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;2 180 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;4 260 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;6 450 minPacket&#34;</span>

      <a name="::exSleep(34)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
   }

      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(35)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
      set portIdList {1 2 3 4 9 10 11 12}

      set ratioExpectArray(9) [lindex $ratioExpectList 0]
      set ratioExpectArray(10) [lindex $ratioExpectList 1]
      set ratioExpectArray(11) [lindex $ratioExpectList 2]
      set ratioExpectArray(12) [lindex $ratioExpectList 3]
      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
            
      <a name="::exSleep(36)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(21)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for USER MATRIX Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList

      <a name="::report_end_test(23)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(429)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <span class="comment-line">#check Q</span>
      <a name="::CheckQoSMonitor(16)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(84)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList 
}
   <span class="comment-line">#special check for multicast, these commands should not cause switch to crash</span>
   if {$protocol == &#34;multicast&#34;} { 
      global DUT2_CONNECT
      <a name="::Login(24)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT -fd $filePt
<span class="comment-line">#      SendACmd	&#34;clear igmp snooping&#34;</span>
<span class="comment-line">#      SendACmd	&#34;disable pim&#34;</span>
<span class="comment-line">#      SendACmd	&#34;enable pim&#34;</span>

      global DUT1_CONNECT
      <a name="::Login(25)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt
<span class="comment-line">#      SendACmd	&#34;clear igmp snooping&#34;</span>
<span class="comment-line">#      SendACmd	&#34;disable pim&#34;</span>
<span class="comment-line">#      SendACmd	&#34;enable pim&#34;</span>
   }
   <span class="comment-line">#stop Tx</span>
   foreach portIdTx $portIdTxList {
         <a name="::MapIxiaPortId(25)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
         <a name="::ixStopPortTransmit(4)"><a href="./mapping.tcl.html#::ixStopPortTransmit_103">::ixStopPortTransmit</a></a>  $txChas $txCard $txPort  
   }
   <span class="comment-line">#restore to default</span>
   <a name="::SendACmd(430)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(85)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(431)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP2 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(86)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(432)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(87)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(433)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(88)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(434)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(89)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(435)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP6 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(90)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(436)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(91)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(437)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 minbw 0 maxbw 100 port [<a name="::::GetATrunkPort(92)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;

}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckBWMatrixPioneer   </span>
<span class="comment-line"># Description:  Verify the effects of QOS based on qos profiles matrix</span>
<span class="comment-line">#		in QOS test plan or user-specified ones</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line"># 	SendACmd &#34;create access-list permitList1 ip dest any source 192.10.1.0/24 deny ports any&#34;</span>
<span class="comment-line">#	SendACmd &#34;create access-list permitList2 ip dest any source 192.10.2.0/24 deny ports any&#34;</span>
<span class="comment-line">#	SendACmd &#34;create access-list permitList3 ip dest any source 192.10.3.0/24 permit QP3 ports any&#34;</span>
<span class="comment-line">#	SendACmd &#34;create access-list permitList4 ip dest any source 192.10.4.0/24 deny ports any&#34;</span>
<span class="comment-line">#	CheckBWMatrixPioneer -checkMatrix 8 -filePt $fd_res \</span>
<span class="comment-line">#                          -testFileName $testNo     </span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckBWMatrixPioneer_3250">proc <a href="CheckBandwidthMatrices.tcl-annot.html#::::CheckBWMatrixPioneer">::::CheckBWMatrixPioneer</a></a></strong> {args} {
   <a name="::parse_args(15)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckBWMatrixPioneer $args {
     numIxiaCd &#34;3&#34;
     <a name="::protocol(6)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ip&#34;
     srcMacAddrTxList &#34;srcMac&#34;
     destMacAddrTxList &#34;DUTMac&#34;
     sIpAddrList &#34;192.10.1.2 192.10.2.2 192.10.3.2 192.10.4.2&#34;
     dIpAddrList &#34;192.20.1.2 192.20.2.2 192.20.3.2 192.20.4.2&#34;
     sPortList &#34;0 0 0 0&#34;
     dPortList &#34;0 0 0 0&#34;
     TOSList &#34;0x00 0x00 0x00 0x00&#34;
     QPList &#34;1 2 3 4&#34;
     priList &#34;0 1 2 3&#34;
     tagList &#34;none none none none&#34;
     checkQosList &#34;&#34;
     ratioExpectList &#34;25.00 25.00 25.00 25.00&#34;
     ratioThreshold &#34;20&#34;
     ratioAggregateThreshold &#34;2.5&#34;
     checkMatrix &#34;1-7&#34;
     userMatrix &#34;none&#34;
     qosType &#34;802.1p&#34;
     filePt &#34;NULL&#34;
     testFileName &#34;Temp&#34;
     initRateCheck &#34;1&#34;
     frameSizeType &#34;sizeRandom&#34;
     frameSize &#34;64&#34;
   }

set percent_tolerance [expr double($ratioThreshold) / double(100)]
global startCardNum
global DUTs_info
global PortID_Info
<span class="comment-line"># Check for 10Gig platform, call different checkBwMatrix specifically</span>

set pPattern &#34;5678&#34;
if {$protocol == &#34;multicast&#34;} {
   set joinGroup 22
   set portList {1 2 3 4}
   foreach portId $portList {
      set portIdTx [expr $portId + 8]
      set multicastIP 22[expr $portId + 4].1.2.3
      set destMacMulticast &#34;01 00 5E 01 02 03&#34; 
      set clientIP1 192.20.$portId.2
      <span class="comment-line">#send an join multicast group igmp packet</span>
      <span class="comment-line">#PortID_Info($portIdTx,portSpeed)</span>
      <span class="comment-line"># --------------------------  Traffic Note -------------------</span>
      <span class="comment-line">#       In the new format all traffic is sent at 100Mbps</span>
      <span class="comment-line">#       which is the peak bandwidth of any qp on the wan link</span>
      <span class="comment-line"># </span>
      switch $PortID_Info($portId,portSpeed) {
          &#34;100&#34; {
              set LimitPerc 100;
          }
          &#34;1000&#34; {
              set LimitPerc 10;
          }
          &#34;10000&#34; {
              set LimitPerc 1;
          }
          default {
              set LimitPerc 10;
          }
      }

      <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$clientIP1 joins multicast group $multicastIP&#34;
      set rxPort [<a name="::MapIxiaPortId(26)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx chasis card port]
      set frameSent [<a name="::ixiaConf_2Ports_ip(11)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $chasis -txCard $card  -txPort $port \
                       -rxChas $chasis -rxCard $card  -rxPort $rxPort  \
                       -ipProtocol &#34;igmp&#34; -type $joinGroup -ttl 1      \
                       -percentage $LimitPerc \
                       -startCardNum $startCardNum  -dMacAddr $destMacMulticast \
                       -sIpAddr  $clientIP1  -dIpAddr $multicastIP -groupAddr $multicastIP ]
   }

   set ipProtocol &#34;udp&#34;
   set destMacAddrTxList {01:00:5E:01:02:03 01:00:5E:01:02:03 01:00:5E:01:02:03 01:00:5E:01:02:03}
   <span class="comment-line">#send join</span>
} else {
   set ipProtocol $protocol
}
set QPa &#34;QP[lindex $QPList 0]&#34;
set QPb &#34;QP[lindex $QPList 1]&#34;
set QPc &#34;QP[lindex $QPList 2]&#34;
set QPd &#34;QP[lindex $QPList 3]&#34;
set Qa [expr [lindex $QPList 0] - 1]
set Qb [expr [lindex $QPList 1] - 1]
set Qc [expr [lindex $QPList 2] - 1]
set Qd [expr [lindex $QPList 3] - 1]
<span class="comment-line"># Just make sure before we start</span>
<a name="::SendACmd(438)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination port all&#34;

if {$checkMatrix == 8} {
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 8 Bandwidth criteria using $QPa, $QPb, $QPc, $QPd&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(26)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;        
   <span class="comment-line">#Test Matrix 8</span>
   <a name="::SendACmd(439)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPa weight 10 peak_rate 100 M port [<a name="::::GetATrunkPort(93)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(440)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPb weight 10 peak_rate 100 M port [<a name="::::GetATrunkPort(94)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(441)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPc weight 10 peak_rate 100 M port [<a name="::::GetATrunkPort(95)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(442)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPd weight 10 peak_rate 100 M port [<a name="::::GetATrunkPort(96)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
} elseif {$checkMatrix == &#34;1-7&#34;} {
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 1 Bandwidth criteria&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(27)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   
   global DUT1_CONNECT
   <a name="::Login(26)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt
   <a name="::SendACmd(443)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPa weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(97)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(444)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPb weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(98)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(445)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPc weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(99)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(446)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPd weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(100)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
}

   set portIdTxList {1 2 3 4}
   set portIdRxList {9 10 11 12}
   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(27)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      set portIdRx [expr $portIdTx + 8]
      <a name="::MapIxiaPortId(28)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdRx rxChas rxCard rxPort   
      set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
      set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
      set sPort [lindex $sPortList [expr $portIdTx - 1] ]
      set dPort [lindex $dPortList [expr $portIdTx - 1] ]
      set TOS [lindex $TOSList [expr $portIdTx - 1] ]
      set tag [lindex $tagList [expr $portIdTx - 1] ]
      set wTag &#34;true&#34;
      if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
      set priority [lindex $priList [expr $portIdTx - 1] ]
      if {$destMacAddrTxList == &#34;DUTMac&#34;} {
         set destMacAddrTx $DUTs_info(DUT1,sysMAC)
      } else {
         set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
      }
      if {![regexp -nocase &#34;10.2&#34; $qosType] &amp;&amp; $checkMatrix!=8} {
         global DUT1_CONNECT
<span class="comment-line">#         Login $DUT1_CONNECT</span>
<span class="comment-line">#         SendACmd &#34;ping $dIpAddr&#34;</span>
      } else {
            <span class="comment-line">#PortID_Info($portIdTx,portSpeed)</span>
            <span class="comment-line"># --------------------------  Traffic Note -------------------</span>
            <span class="comment-line">#       In the new format all traffic is sent at 100Mbps</span>
            <span class="comment-line">#       which is the peak bandwidth of any qp on the wan link</span>
            <span class="comment-line"># </span>
            switch $PortID_Info($portIdTx,portSpeed) {
                &#34;100&#34; {
                    set LimitPerc 100;
                }
                &#34;1000&#34; {
                    set LimitPerc 10;
                }
                &#34;10000&#34; {
                    set LimitPerc 1;
                }
                &#34;40000&#34; {
                    set LimitPerc 1;
                }
                default {
                    set LimitPerc 10;
                }
            }
            set frameSent [<a name="::ixiaConf_2Ports_ip(12)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -txChas $txChas -txCard $txCard -txPort $txPort \
                          -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \
                          -startCardNum $startCardNum -dataPattern $pPattern \
                          -TOS $TOS -numFrames 4 \
                          -percentage $LimitPerc \
                          -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \
                          -dMacAddr $destMacAddrTx  -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \
                          -wTag $wTag -tagNo $tag -userPriority $priority ]
      }
   }
   foreach portIdTx $portIdTxList {
      <a name="::MapIxiaPortId(29)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
      set portIdRx [expr $portIdTx + 8]
      <a name="::MapIxiaPortId(30)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdRx rxChas rxCard rxPort   
      set sIpAddr [lindex $sIpAddrList [expr $portIdTx - 1] ]
      set dIpAddr [lindex $dIpAddrList [expr $portIdTx - 1] ]
      set sPort [lindex $sPortList [expr $portIdTx - 1] ]
      set dPort [lindex $dPortList [expr $portIdTx - 1] ]
      set TOS [lindex $TOSList [expr $portIdTx - 1] ]
      set tag [lindex $tagList [expr $portIdTx - 1] ]
      set wTag &#34;true&#34;
      if { $tag == &#34;none&#34; } { set wTag &#34;false&#34; }
      set priority [lindex $priList [expr $portIdTx - 1] ]
      if {$destMacAddrTxList == &#34;DUTMac&#34;} {
         set destMacAddrTx $DUTs_info(DUT1,sysMAC)
      } else {
         set destMacAddrTx [lindex $destMacAddrTxList [expr $portIdTx - 1] ]
      }
      <span class="comment-line">#PortID_Info($portIdTx,portSpeed)</span>
      <span class="comment-line"># --------------------------  Traffic Note -------------------</span>
      <span class="comment-line">#       In the new format all traffic is sent at 100Mbps</span>
      <span class="comment-line">#       which is the peak bandwidth of any qp on the wan link</span>
      <span class="comment-line"># </span>
      switch $PortID_Info($portIdTx,portSpeed) {
          &#34;100&#34; {
              set LimitPerc 100;
          }
          &#34;1000&#34; {
              set LimitPerc 10;
          }
          &#34;10000&#34; {
              set LimitPerc 1;
          }
          &#34;40000&#34; {
              set LimitPerc 1;
          }
          default {
              set LimitPerc 10;
          }
      }
      set frameSent [<a name="::ixiaConf_2Ports_ip(13)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a>	-txChas $txChas -txCard $txCard -txPort $txPort \
                       -rxChas $rxChas -rxCard $rxCard -rxPort $rxPort  \
                       -startCardNum $startCardNum -dataPattern $pPattern \
                       -streamType &#34;contPacket&#34; -percentage $LimitPerc \
                       -TOS $TOS -frameSizeType &#34;$frameSizeType&#34; \
                       -ipProtocol $ipProtocol -pDstPort $dPort -pSrcPort $sPort \
                       -dMacAddr $destMacAddrTx  -sIpAddr $sIpAddr  -dIpAddr $dIpAddr \
                       -wTag $wTag -tagNo $tag -userPriority $priority ]
      <span class="comment-line">#wait for things to settle down</span>
      if {$initRateCheck} {
         <a name="::exSleep(37)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 6
         set portIdList {1 2 3 4 9 10 11 12}
         foreach portId $portIdList {
            
            <a name="::MapIxiaPortId(31)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
            <a name="::stat(13)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
            set rateSent [<a name="::stat(14)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesSent]
            set rateRecv [<a name="::stat(15)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesReceived]
            set rateArray($portId,sent) $rateSent.00
            set rateArray($portId,recv) $rateRecv.00
         
            <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;
         }
         if {$checkMatrix == 8} {
         
         } elseif {$checkMatrix == &#34;1-7&#34;} {
            set ratioFound [format %.2f [expr $rateArray($portIdRx,recv)*100/($rateArray($portIdTx,sent)+1)]]
            set ratioExpect 100
            if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioThreshold } {
               <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Matrix 1 failed rate ratio threshold test on port $portIdRx. Got $ratioFound EXPECT $ratioExpect +/- $ratioThreshold&#34;
            } else {
               <a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Matrix 1 pass rate ratio threshold test on port $portIdRx. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioThreshold&#34;
            }
         }         
      }

   }
   if {$checkMatrix == 8} { 
      set portIdList {1 2 3 4 9 10 11 12}
      foreach portId $portIdList {
         
         <a name="::MapIxiaPortId(32)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
         <a name="::stat(16)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
         set rateSent [<a name="::stat(17)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesSent]
         set rateRecv [<a name="::stat(18)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesReceived]
         set rateArray($portId,sent) $rateSent.00
         set rateArray($portId,recv) $rateRecv.00
      
            <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Mtrx8 Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;
      } 
      set ratioExpectArray(9) 0
      set ratioExpectArray(10) 0
      set ratioExpectArray(11) 100
      set ratioExpectArray(12) 0

      <a name="::exSleep(38)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         <span class="comment-line">##set portIdTx [expr $portId - 8]</span>
         <span class="comment-line">##set ratioFound [format %.2f [expr $rateArray($portId,recv)*100/($rateArray($portIdTx,sent)+1)]]</span>
         <span class="comment-line">##set ratioExpect $ratioExpectArray($portId)</span>
         <span class="comment-line">##if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioThreshold } {</span>
         <span class="comment-line">##   result_error &#34;Matrix 8 failed rate ratio threshold test on port $portId. Got $ratioFound EXPECT $ratioExpect +/- $ratioThreshold&#34;</span>
         <span class="comment-line">##} else {</span>
         <span class="comment-line">##   result_ok &#34;Matrix 8 pass rate ratio threshold test on port $portId. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioThreshold&#34;</span>
         <span class="comment-line">##}</span>
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }

      <span class="comment-line">################# Replace Old Gorp with New Proc  ##################</span>
      <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(22)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 8 Rates based on QP Assignment&#34; $percent_tolerance
      unset checkRateList

      <span class="comment-line">####################################################################</span>
      <a name="::report_end_test(24)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(447)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;

      <span class="comment-line">#check Q</span>
      <span class="comment-line">#lappend checkQosList &#34;0 1000 minPacket&#34; ;#not testing this, unpredictable for now</span>
      lappend checkQosList &#34;$Qb 10 maxPacket&#34;
      lappend checkQosList &#34;$Qc 1000 minPacket&#34;
      lappend checkQosList &#34;$Qd 10 maxPacket&#34;
      <a name="::CheckQoSMonitor(17)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(101)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName
      unset checkQosList
   } elseif {$checkMatrix == &#34;1-7&#34;} {
      set ratioExpectArray(9) 0
      set ratioExpectArray(10) 0
      set ratioExpectArray(11) 0
      set ratioExpectArray(12) 100
      <span class="comment-line">#foreach portId $portIdRxList {</span>
      <span class="comment-line">#   set portIdTx [expr $portId - 8]</span>
      <span class="comment-line">#   set ratioFound [format %.2f [expr $rateArray($portId,recv)*100/($rateArray($portIdTx,sent)+1)]]</span>
      <span class="comment-line">#   set ratioExpect $ratioExpectArray($portId)</span>
      <span class="comment-line">#   if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioThreshold } {</span>
      <span class="comment-line">#      result_error &#34;Matrix 1 failed rate ratio threshold test on port $portId. Got $ratioFound EXPECT $ratioExpect +/- $ratioThreshold&#34;</span>
      <span class="comment-line">#   } else {</span>
      <span class="comment-line">#      result_ok &#34;Matrix 1 pass rate ratio threshold test on port $portId. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioThreshold&#34;</span>
      <span class="comment-line">#   }</span>
      <span class="comment-line">#}</span>

      <a name="::exSleep(39)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(23)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 1 Rates based on QP Assignment&#34; $percent_tolerance
      unset checkRateList

      <a name="::report_end_test(25)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(448)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <a name="::SendACmd(449)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show ports [<a name="::::GetATrunkPort(102)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] qosmonitor no-refresh&#34;
      <span class="comment-line">#check Q</span>
      <span class="comment-line"># Matrix1 has qosmonitor problems when leaking to Q2.</span>
      lappend checkQosList &#34;$Qa 10 maxPacket&#34;
      lappend checkQosList &#34;$Qb 10 maxPacket&#34;
      lappend checkQosList &#34;$Qc 4000 maxPacket&#34;
      lappend checkQosList &#34;$Qd 4000 minPacket&#34;
      <a name="::CheckQoSMonitor(18)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(103)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList  

      <a name="::SendACmd(450)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPa weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(104)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(451)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPb weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(105)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(452)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPc weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(106)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(453)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile $QPd weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(107)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;

   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 2 Bandwidth criteria using QP1, QP3, QP5, QP7&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(28)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   <span class="comment-line">#Test Matrix 2</span>
   set priList &#34;0 2 4 6&#34;
   if {$qosType==&#34;diffserv&#34;} {
      set TOSList &#34;0x00 0x40 0x80 0xc0&#34;
   } elseif {$qosType==&#34;diffservCodePoint&#34;} {
      <a name="::SendACmd(454)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination port all&#34;      
      <a name="::SendACmd(455)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP7 port all&#34;
      <a name="::SendACmd(456)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP3 port all&#34;
      set TOSList &#34;0x00 0x64 0x80 0x20&#34;
   }
   <a name="::configMatrix(11)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                -ipProtocol $ipProtocol

   <a name="::SendACmd(457)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp1 weight 10 peak_rate 100 M port [<a name="::::GetATrunkPort(108)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(458)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp3 weight 10 peak_rate 100 M port [<a name="::::GetATrunkPort(109)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(459)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp5 weight 10 peak_rate 100 M port [<a name="::::GetATrunkPort(110)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(460)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile qp7 weight 10 peak_rate 100 M port [<a name="::::GetATrunkPort(111)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;

      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(40)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
      set portIdList {1 2 3 4 9 10 11 12}
 
      set sum 0
      set ratioExpectArray(9) 10.00
      set ratioExpectArray(10) 10.00
      set ratioExpectArray(11) 10.00
      set ratioExpectArray(12) 70.00

      set ratioExpect 100


      <a name="::exSleep(41)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(24)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 2 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList
      <a name="::report_end_test(26)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

      <a name="::SendACmd(461)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <a name="::exSleep(42)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;0 100 minPacket&#34;
      lappend checkQosList &#34;2 100 minPacket&#34;
      lappend checkQosList &#34;4 100 minPacket&#34;
      lappend checkQosList &#34;6 700 minPacket&#34;
      <a name="::CheckQoSMonitor(19)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(112)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName
      unset checkQosList

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(462)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 weight 0 peak_rate 100 M  port [<a name="::::GetATrunkPort(113)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(463)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(114)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(464)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(115)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(465)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(116)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;

   <span class="comment-line"># Matrix 3 does not apply to broadcom because priority is not available.</span>
   <span class="comment-line"># Matrix 4 deleted</span>

      
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 5 Bandwidth criteria using QP1, QP4, QP5, QP8&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(29)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;          
   <span class="comment-line">#Test Matrix 5</span>
   set priList &#34;0 3 4 7&#34;
   if {$qosType==&#34;diffserv&#34;} {
      set TOSList &#34;0x00 0x60 0x80 0xe0&#34;
   } elseif {$qosType==&#34;diffservCodePoint&#34;} {
      <a name="::SendACmd(466)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination port all&#34;      
      <a name="::SendACmd(467)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP8 port all&#34;
      <a name="::SendACmd(468)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP4 port all&#34;
      set TOSList &#34;0x00 0x64 0x80 0x20&#34;
   }
   <a name="::configMatrix(12)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                -ipProtocol $ipProtocol   

   <a name="::SendACmd(469)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 weight 10 peak_rate 100 M  port [<a name="::::GetATrunkPort(117)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(470)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 weight 10 peak_rate 50 M port [<a name="::::GetATrunkPort(118)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(471)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 weight 10 peak_rate 40 M port [<a name="::::GetATrunkPort(119)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(472)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 weight 10 peak_rate 30 M port [<a name="::::GetATrunkPort(120)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(43)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      set portIdList {1 2 3 4 9 10 11 12}
      <span class="comment-line">#foreach portId $portIdList {</span>
      <span class="comment-line">#   </span>
      <span class="comment-line">#   MapIxiaPortId $portId chasisId card port</span>
      <span class="comment-line">#   stat getRate statAllStats $chasisId $card $port</span>
      <span class="comment-line">#   set rateSent [stat cget -bytesSent]</span>
      <span class="comment-line">#   set rateRecv [stat cget -bytesReceived]</span>
      <span class="comment-line">#   set rateArray($portId,sent) $rateSent.00</span>
      <span class="comment-line">#   set rateArray($portId,recv) $rateRecv.00</span>
      <span class="comment-line">#</span>
      <span class="comment-line">#      result_debug &#34;Mtrx5 Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;</span>
      <span class="comment-line">#} </span>
      <span class="comment-line">#set sum 0</span>
      set ratioExpectArray(9) 10.00
      set ratioExpectArray(10) 20.00
      set ratioExpectArray(11) 40.00
      set ratioExpectArray(12) 30.00
      <span class="comment-line">#foreach portId $portIdRxList {</span>
      <span class="comment-line">#   set portIdTx [expr $portId - 8]</span>
      <span class="comment-line">#   set ratioFound [format %.2f [expr $rateArray($portId,recv)*100/($rateArray($portIdTx,sent)+1)]]</span>
      <span class="comment-line">#   set ratioExpect $ratioExpectArray($portId)</span>
      <span class="comment-line">#   set proratedRatioThreshold [expr $ratioExpect/100.00*$ratioThreshold]</span>
      <span class="comment-line">#   set sum [expr $ratioFound + $sum]</span>
      <span class="comment-line">#   if {[expr abs($ratioFound - $ratioExpect)] &gt; $proratedRatioThreshold } {</span>
      <span class="comment-line">#      result_error &#34;Matrix 5 failed rate ratio threshold test on port $portId. Got $ratioFound EXPECT $ratioExpect +/- $proratedRatioThreshold&#34;</span>
      <span class="comment-line">#   } else {</span>
      <span class="comment-line">#      result_ok &#34;Matrix 5 pass rate ratio threshold test on port $portId. Got $ratioFound AS EXPECT $ratioExpect +/- $proratedRatioThreshold&#34;</span>
      <span class="comment-line">#   }</span>
      <span class="comment-line">#} </span>
      <span class="comment-line">#total rate</span>
      set ratioExpect 100
      <span class="comment-line">#set ratioFound $sum</span>
      <span class="comment-line">#if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioAggregateThreshold } {</span>
      <span class="comment-line">#   result_error &#34;Matrix 5 failed aggregate rate ratio threshold test. Got $ratioFound EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;</span>
      <span class="comment-line">#} else {</span>
      <span class="comment-line">#   result_ok &#34;Matrix 5 pass rate aggregate ratio threshold test. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;</span>
      <span class="comment-line">#}</span>

      <a name="::exSleep(44)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(25)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 5 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList

      <a name="::report_end_test(27)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(473)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <a name="::exSleep(45)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
      <span class="comment-line">#check Q</span>
      lappend checkQosList &#34;0 90 minPacket&#34;
      lappend checkQosList &#34;3 180 minPacket&#34;
      lappend checkQosList &#34;4 360 minPacket&#34;
      lappend checkQosList &#34;7 270 minPacket&#34;
      <a name="::CheckQoSMonitor(20)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(121)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList      

      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(474)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(122)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(475)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(123)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(476)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(124)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(477)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 weight 0 peak_rate 100 M port [<a name="::::GetATrunkPort(125)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;

      
   <span class="comment-line">## Removed Matrix 6 - Broadcom Q priority can not be changed</span>
      
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking Matrix 7 Bandwidth criteria using QP1, QP3, QP5, QP7&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(30)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;        
   <span class="comment-line">#Test Matrix 7</span>
   set priList &#34;0 2 4 6&#34;
   if {$qosType==&#34;diffserv&#34;} {
      set TOSList &#34;0x00 0x40 0x80 0xc0&#34;
   } elseif {$qosType==&#34;diffservCodePoint&#34;} {
      <a name="::SendACmd(478)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfig diffserv examination port all&#34;      
      <a name="::SendACmd(479)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 8 qosprofile QP7 port all&#34;
      <a name="::SendACmd(480)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config diffserv examination code-point 25 qosprofile QP3 prot all&#34;
      set TOSList &#34;0x00 0x64 0x80 0x20&#34;
   }
   <a name="::configMatrix(13)"><a href="./CheckBandwidthMatrices.tcl.html#::configMatrix_1450">::configMatrix</a></a> -priList $priList -portIdTxList $portIdTxList -qosType $qosType -sIpAddrList $sIpAddrList -dIpAddrList $dIpAddrList \
                -sPortList $sPortList -dPortList $dPortList -TOSList $TOSList -tagList $tagList -destMacAddrTxList $destMacAddrTxList \
                -ipProtocol $ipProtocol   

   <a name="::SendACmd(481)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 weight 10 peak_rate 50 M  port [<a name="::::GetATrunkPort(126)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(482)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 weight 20 peak_rate 50 M port [<a name="::::GetATrunkPort(127)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(483)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 weight 25 peak_rate 50 M port [<a name="::::GetATrunkPort(128)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
   <a name="::SendACmd(484)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 weight 35 peak_rate 50 M port [<a name="::::GetATrunkPort(129)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      
      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(46)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      set portIdList {1 2 3 4 9 10 11 12}
      <span class="comment-line">#foreach portId $portIdList {</span>
      <span class="comment-line">#   </span>
      <span class="comment-line">#   MapIxiaPortId $portId chasisId card port</span>
      <span class="comment-line">#   stat getRate statAllStats $chasisId $card $port</span>
      <span class="comment-line">#   set rateSent [stat cget -bytesSent]</span>
      <span class="comment-line">#   set rateRecv [stat cget -bytesReceived]</span>
      <span class="comment-line">#   set rateArray($portId,sent) $rateSent.00</span>
      <span class="comment-line">#   set rateArray($portId,recv) $rateRecv.00</span>
      <span class="comment-line">#</span>
      <span class="comment-line">#      result_debug &#34;Mtrx7 Rate on port $portId Sent: $rateSent Recv: $rateRecv&#34;</span>
      <span class="comment-line">#} </span>
      <span class="comment-line">#set sum 0</span>
      set ratioExpectArray(9) 10.00
      set ratioExpectArray(10) 18.70
      set ratioExpectArray(11) 26.30
      set ratioExpectArray(12) 45.00
      <span class="comment-line">#foreach portId $portIdRxList {</span>
      <span class="comment-line">#   set portIdTx [expr $portId - 8]</span>
      <span class="comment-line">#   set ratioFound [format %.2f [expr $rateArray($portId,recv)*100/($rateArray($portIdTx,sent)+1)]]</span>
      <span class="comment-line">#   set ratioExpect $ratioExpectArray($portId)</span>
      <span class="comment-line">#   set proratedRatioThreshold [expr $ratioExpect/100.00*$ratioThreshold]</span>
      <span class="comment-line">#   set sum [expr $ratioFound + $sum]</span>
      <span class="comment-line">#   if {[expr abs($ratioFound - $ratioExpect)] &gt; $proratedRatioThreshold } {</span>
      <span class="comment-line">#      result_error &#34;Matrix 7 failed rate ratio threshold test on port $portId. Got $ratioFound EXPECT $ratioExpect +/- $proratedRatioThreshold&#34;</span>
      <span class="comment-line">#   } else {</span>
      <span class="comment-line">#      result_ok &#34;Matrix 7 pass rate ratio threshold test on port $portId. Got $ratioFound AS EXPECT $ratioExpect +/- $proratedRatioThreshold&#34;</span>
      <span class="comment-line">#   }</span>
      <span class="comment-line">#} </span>
      <span class="comment-line">#total rate</span>
      set ratioExpect 100
      <span class="comment-line">#set ratioFound $sum</span>
      <span class="comment-line">#if {[expr abs($ratioFound - $ratioExpect)] &gt; $ratioAggregateThreshold } {</span>
      <span class="comment-line">#   result_error &#34;Matrix 7 failed aggregate rate ratio threshold test. Got $ratioFound EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;</span>
      <span class="comment-line">#} else {</span>
      <span class="comment-line">#   result_ok &#34;Matrix 7 pass rate aggregate ratio threshold test. Got $ratioFound AS EXPECT $ratioExpect +/- $ratioAggregateThreshold&#34;</span>
      <span class="comment-line">#}</span>

      <a name="::exSleep(47)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(26)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for MATRIX 7 Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList
      <a name="::report_end_test(28)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <span class="comment-line">#check Q</span>
      <a name="::SendACmd(485)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <a name="::exSleep(48)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
      lappend checkQosList &#34;0 100 minPacket&#34;
      lappend checkQosList &#34;2 180 minPacket&#34;
      lappend checkQosList &#34;4 260 minPacket&#34;
      lappend checkQosList &#34;6 450 minPacket&#34;
      <a name="::CheckQoSMonitor(21)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(130)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList   
      <span class="comment-line">#restore to default</span>
      <a name="::SendACmd(486)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconfigure qosprofile&#34;
               
} elseif {$checkMatrix == &#34;user&#34;} {
   <span class="comment-line">################################################</span>
   set subTest &#34;Checking User Bandwidth criteria&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(31)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
      
   if {$userMatrix == 5} {
      <a name="::SendACmd(487)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 weight 10 peak_rate 100 M  port [<a name="::::GetATrunkPort(131)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(488)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP4 weight 10 peak_rate 50 M port [<a name="::::GetATrunkPort(132)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(489)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 weight 10 peak_rate 40 M port [<a name="::::GetATrunkPort(133)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(490)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP8 weight 10 peak_rate 30 M port [<a name="::::GetATrunkPort(134)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <span class="comment-line">#set ratioExpectArray(9) 10.00</span>
      <span class="comment-line">#set ratioExpectArray(10) 20.00</span>
      <span class="comment-line">#set ratioExpectArray(11) 40.00</span>
      <span class="comment-line">#set ratioExpectArray(12) 30.00</span>
      <span class="comment-line">#lappend checkQosList &#34;0 90 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;3 180 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;4 360 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;7 270 minPacket&#34;      </span>
      <a name="::exSleep(49)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5   
   }
   if {$userMatrix == 7} {
      <a name="::SendACmd(491)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP1 weight 10 peak_rate 50 M port [<a name="::::GetATrunkPort(135)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(492)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP3 weight 20 peak_rate 50 M port [<a name="::::GetATrunkPort(136)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(493)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP5 weight 25 peak_rate 50 M port [<a name="::::GetATrunkPort(137)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <a name="::SendACmd(494)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config qosprofile QP7 weight 35 peak_rate 50 M port [<a name="::::GetATrunkPort(138)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]&#34;
      <span class="comment-line">#set ratioExpectArray(9) 10.00</span>
      <span class="comment-line">#set ratioExpectArray(10) 18.70</span>
      <span class="comment-line">#set ratioExpectArray(11) 26.30</span>
      <span class="comment-line">#set ratioExpectArray(12) 45.00</span>
      <span class="comment-line">#lappend checkQosList &#34;0 100 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;2 180 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;4 260 minPacket&#34;</span>
      <span class="comment-line">#lappend checkQosList &#34;6 450 minPacket&#34;</span>

      <a name="::exSleep(50)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
   }

      <span class="comment-line">#wait for things to settle down</span>
      <a name="::exSleep(51)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
      set portIdList {1 2 3 4 9 10 11 12}

      set ratioExpectArray(9) [lindex $ratioExpectList 0]
      set ratioExpectArray(10) [lindex $ratioExpectList 1]
      set ratioExpectArray(11) [lindex $ratioExpectList 2]
      set ratioExpectArray(12) [lindex $ratioExpectList 3]
      set ratioExpect [expr $ratioExpectArray(9)+$ratioExpectArray(10)+$ratioExpectArray(11)+$ratioExpectArray(12)]
            
      <a name="::exSleep(52)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 4
      lappend checkRateList {&#34;negTest&#34; &#34;1  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;2  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;3  0&#34;}
      lappend checkRateList {&#34;negTest&#34; &#34;4  0&#34;}
      foreach portId $portIdRxList {
         set portIdTx [expr $portId - 8]
         set t [expr $portIdTx - 1];
         set tag [lindex $tagList $t]
         if { $tag == &#34;none&#34; } { set $tag &#34;&#34; }
         lappend checkRateList &#34;{$portIdTx 100} {$portId $ratioExpectArray($portId)} $tag&#34;         
      }
      <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$checkRateList&#34;
      <a name="::CheckRatesTxRx(27)"><a href="./ePTRx.tcl.html#::CheckRatesTxRx_1631">::CheckRatesTxRx</a></a> $checkRateList &#34;Check for USER MATRIX Rates based on QP Assignment&#34; \
                     $percent_tolerance SumRx $ratioExpect
      unset checkRateList

      <a name="::report_end_test(29)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      <a name="::SendACmd(495)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counter&#34;
      <span class="comment-line">#check Q</span>
      <a name="::CheckQoSMonitor(22)"><a href="./CheckBandwidthMatrices.tcl.html#::CheckQoSMonitor_898">::CheckQoSMonitor</a></a> [<a name="::::GetATrunkPort(139)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] $checkQosList $filePt $testFileName 
      unset checkQosList 
}
   <span class="comment-line">#special check for multicast, these commands should not cause switch to crash</span>
   if {$protocol == &#34;multicast&#34;} { 
      global DUT2_CONNECT
      <a name="::Login(27)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT -fd $filePt
<span class="comment-line">#      SendACmd	&#34;clear igmp snooping&#34;</span>
<span class="comment-line">#      SendACmd	&#34;disable pim&#34;</span>
<span class="comment-line">#      SendACmd	&#34;enable pim&#34;</span>

      global DUT1_CONNECT
      <a name="::Login(28)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -fd $filePt
<span class="comment-line">#      SendACmd	&#34;clear igmp snooping&#34;</span>
<span class="comment-line">#      SendACmd	&#34;disable pim&#34;</span>
<span class="comment-line">#      SendACmd	&#34;enable pim&#34;</span>
   }
   <span class="comment-line">#stop Tx</span>
   foreach portIdTx $portIdTxList {
         <a name="::MapIxiaPortId(33)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portIdTx txChas txCard txPort
         <a name="::ixStopPortTransmit(5)"><a href="./mapping.tcl.html#::ixStopPortTransmit_103">::ixStopPortTransmit</a></a>  $txChas $txCard $txPort  
   }
   <span class="comment-line">#restore to default</span>
   <a name="::SendACmd(496)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;unconfig qosprofile&#34;

}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
