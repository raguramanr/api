<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>Ospfv3.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#Ospfv3.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>Ospfv3.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="Ospfv3.tcl-annot.html">annotations</a> | <a href="Ospfv3.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">#############################################################</span>
<span class="comment-line"># procedure name: getOspfv3DRandBDR</span>
<span class="comment-line"># </span>
<span class="comment-line"># gives the DR and BDR for a given DUT and an interface on it </span>
<span class="comment-line">#############################################################</span>
set ipv6(IPV6_ICMP_HDR_DEF) &#34;3A&#34;
set ipv6(IPV6_OSPF_HDR_DEF) &#34;59&#34;
set ipv6(IPV6_HOP_HDR_DEF)  &#34;00&#34;
set ipv6(IPV6_OSPF_HDR_LEN) &#34;16&#34;

<strong><a name="::::getOspfv3DRandBDR_12">proc <a href="Ospfv3.tcl-annot.html#::::getOspfv3DRandBDR">::::getOspfv3DRandBDR</a></a></strong> {dut interface} {

    global [set dut]_CONNECT
    <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set [set dut]_CONNECT]

    lappend parameterList &#34;{^$interface} 5&#34;
    set state [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show ospfv3 interfaces &#34; $parameterList]
    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; AJAY INTERFACE STATE= $state&#34;
    return $state


    <span class="comment-line">#set intf [SendACmd &#34;show ospfv3 interfaces&#34;]</span>
    <span class="comment-line">#set intf [split $intf \n]</span>

    <span class="comment-line">#foreach line $intf {</span>
    <span class="comment-line">#   if { [regexp &#34;^$interface.*&#34; $line] == 1} {</span>
    <span class="comment-line">#        regexp &#34;(^$interface).* +(DOWN|UP|ODR|BDR|DR).*&#34; $line match interf state</span>
    <span class="comment-line">#        #regexp {(^/$interface).* +[^ ]+ +[^ ]+ +[^ ]+ +[^ ]+ +([^ ]+).*} $line match interf state</span>
    <span class="comment-line">#        break</span>
    <span class="comment-line">#   }</span>
    <span class="comment-line">#}</span>
    <span class="comment-line">#      </span>
    <span class="comment-line">#if [info exists interf] {</span>
    <span class="comment-line">#    if [info exists state] {</span>
    <span class="comment-line">#    result_debug &#34; AJAY st= $state&#34;</span>
    <span class="comment-line">#         return $state</span>
    <span class="comment-line">#    } else { </span>
    <span class="comment-line">#         result_debug &#34; AJAY NO STATE&#34;</span>
    <span class="comment-line">#         return -1</span>
    <span class="comment-line">#    }</span>
    <span class="comment-line">#}</span>
}

<span class="comment-line">#############################################################</span>
<span class="comment-line"># procedure name: checkInterfaceState</span>
<span class="comment-line">#</span>
<span class="comment-line"># checks the DR and BDR for a given DUT and an interface on it</span>
<span class="comment-line">#############################################################</span>
<span class="comment-line">#proc checkInterfaceState {dut interface state} {</span>
<span class="comment-line">#</span>
<span class="comment-line">#       set dutState [getOspfv3DRandBDR $dut $interface]</span>
<span class="comment-line">#</span>
<span class="comment-line">#       #if {[regexp -- $state $dutState] == 1} {}</span>
<span class="comment-line">#       if {[string compare $state $dutState] == 0} {</span>
<span class="comment-line">#          result_ok &#34;dut= $dut, interface= $interface, state= $state&#34;</span>
<span class="comment-line">#       } else {</span>
<span class="comment-line">#          result_error &#34;dut= $dut, interface= $interface, expected state= $state, current state= $dutState&#34;</span>
<span class="comment-line">#       }</span>
<span class="comment-line">#}</span>


<span class="comment-line">#############################################################</span>
<span class="comment-line"># procedure name: checkInterfaceState</span>
<span class="comment-line">#</span>
<span class="comment-line"># checks the DR and BDR for a given DUT and an interface on it</span>
<span class="comment-line">#############################################################</span>
<strong><a name="::::checkInterfaceState_68">proc <a href="Ospfv3.tcl-annot.html#::::checkInterfaceState">::::checkInterfaceState</a></a></strong> {dut interface state} {

    global [set dut]_CONNECT
    <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set [set dut]_CONNECT]

    lappend parameterList &#34;{$interface.*$state} exist&#34;
    <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show ospfv3 interfaces &#34; $parameterList -time {s: 0 i: 5 d: 5 f: 60 r}
    unset parameterList
}


<strong><a name="::::strip8021qTag_79">proc <a href="Ospfv3.tcl-annot.html#::::strip8021qTag">::::strip8021qTag</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]

   <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
   if {$type == &#34;81 00&#34;} {
     set leftRawFrame [string range $rawFrame 0 35]
     set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
     set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
   }


  return $rawFrame
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
