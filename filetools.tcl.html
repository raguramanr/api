<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>filetools.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#filetools.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>filetools.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="filetools.tcl-annot.html">annotations</a> | <a href="filetools.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line"># --------------------------------------------------------------------</span>
<span class="comment-line"># proc showLocalFileInfo</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># --------------------------------------------------------------------</span>
<strong><a name="::::showLocalFileInfo_6">proc <a href="filetools.tcl-annot.html#::::showLocalFileInfo">::::showLocalFileInfo</a></a></strong> {myFile} {
    puts  &#34;file name: $myFile&#34;
    if ![ file  exists  $myFile ] {
        puts &#34;The file, $myFile does not exist&#34;
        return;
    }
    puts  &#34;exists: [ file  exists  $myFile ]&#34;
    puts  &#34;----------------&#34;
    puts  &#34;type: [ file  type  $myFile ]&#34;
    puts  &#34;size: [ file  size  $myFile ]&#34;
    puts  &#34;&#34;
    puts  &#34;atime: [ file  atime  $myFile ]&#34;
    puts  &#34;mtime: [ file  mtime  $myFile ]&#34;
    puts  &#34;&#34;
    puts  &#34;pathtype: [ file  pathtype  $myFile ]&#34;
    puts  &#34;dirname: [ file  dirname  $myFile ]&#34;
    puts  &#34;separator: [ file  separator  $myFile ]&#34;
    puts  &#34;nativename: [ file  nativename  $myFile ]&#34;
    puts  &#34;normalize: [ file  normalize  $myFile ]&#34;
    puts  &#34;rootname: [ file  rootname  $myFile ]&#34;
    puts  &#34;tail: [ file  tail  $myFile ]&#34;
    puts  &#34;extension: [ file  extension  $myFile ]&#34;
    puts  &#34;join: [ file  join  $myFile ]&#34;
    puts  &#34;&#34;
    puts  &#34;attributes: [ file  attributes  $myFile ]&#34;
    puts  &#34;owned: [ file  owned  $myFile ]&#34;
    puts  &#34;readable: [ file  readable  $myFile ]&#34;
    puts  &#34;writable: [ file  writable  $myFile ]&#34;
    puts  &#34;executable: [ file  executable  $myFile ]&#34;
    puts  &#34;&#34;
    puts  &#34;channels: [ file  channels  $myFile ]&#34;
    puts  &#34;system: [ file  system  $myFile ]&#34;
}
<span class="comment-line"># --------------------------------------------------------------------</span>
<span class="comment-line">#   proc _createSupportDirectories</span>
<span class="comment-line"># </span>
<span class="comment-line">#       Create a list of directories in the current location</span>
<span class="comment-line">#   args:  list of directories to verify or create</span>
<span class="comment-line">#          out - None</span>
<span class="comment-line"># </span>
<span class="comment-line"># </span>
<span class="comment-line"># </span>
<span class="comment-line">#</span>
<span class="comment-line"># --------------------------------------------------------------------              </span>
<strong><a name="::::_createSupportDirectories_50">proc <a href="filetools.tcl-annot.html#::::_createSupportDirectories">::::_createSupportDirectories</a></a></strong> {args} {
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _createSupportDirectories  $args {
        dirList &#34;Tmp&#34;
        owner   &#34;null&#34;
        chmodall &#34;1&#34;
    }

    foreach d $dirList {
        if {![file isdirectory $d]} {
            if [catch {file mkdir $d} rea] {
                puts &#34;WARNING: failed to create directory $d&#34;
                <span class="comment-line"># - The directory create failed.</span>
                <span class="comment-line"># - determine who the owner of the parent is</span>
                set folderList [file split $d]
                if {[llength $folderList] == 1} {
                    if {![file owned [pwd]]} {
                        <span class="comment-line"># Note - Tclx provides these id commands</span>
                        set preId [id effective userid]
                        file lstat [pwd] fInfo
                        set fUid $fInfo(uid);
                        catch {id userid $fUid} oopsid
                        if [catch {file mkdir $d} rea] {
                            if [catch {exec mkdir $d} rea] {
                                puts &#34;Well we tried.  Assuming this was important, so EXIT&#34;
                                error &#34;Could not create directory $d&#34;;
                            }
                        }
                        id userid $preId;<span class="comment-line"># Back to the original id</span>
                    } 
                } else {
                    <span class="comment-line"># pop the last folder and see who owns that</span>
                }
            } else {
                if {$owner != &#34;null&#34;} {
                    if {[catch {exec chown $owner $d} res]} {
                        puts &#34;Error changing ownership of $d&#34;
                    }
                }
                if {$chmodall} {
                    if {[catch {exec chmod 777 $d} res]} {
                        puts &#34;Error executing chmod 777 $d&#34;
                    }
                }
            }
        }
    }
}
<span class="comment-line"># --------------------------------------------------------------------</span>
<span class="comment-line">#   proc _verifyRegPathArg</span>
<span class="comment-line">#</span>
<span class="comment-line">#      **** N O T E   to be called only from the main dir ****</span>
<span class="comment-line">#      This proc maintains the original ability to match short, regex</span>
<span class="comment-line">#      directory names.</span>
<span class="comment-line">#</span>
<span class="comment-line">#   args : In - regPath value to be compared with</span>
<span class="comment-line">#          out -</span>
<span class="comment-line"># --------------------------------------------------------------------</span>
<strong><a name="::::_verifyRegPathArg_107">proc <a href="filetools.tcl-annot.html#::::_verifyRegPathArg">::::_verifyRegPathArg</a></a></strong> {args} {
    
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _verifyRegPathArg $args {
        regPath      &#34;Functional&#34;
        initPath     &#34;..&#34;
    }

    set rl [split $regPath &#34;/&#34;]
    if {[llength $rl] &gt; 1} {
        set rll [llength $rl]
        set regPath [lindex $rl [expr $rll - 1]]
    }    

    set regressions [glob -- ${initPath}/*]
    set regNames &#34;&#34;
    set regPath [string trim $regPath &#34;.&#34;]
    set regPath [string trim $regPath &#34;/&#34;]
    
    foreach regName $regressions {
       if {[file isdir $regName]} {
          lappend regNames $regName
       }
    }
    foreach regName $regNames {
       set match &#34;&#34;
       set str &#34;&#34;
       if {[regexp -nocase &#34;(^.*/$regPath.*)&#34; $regName match str]} {
          return $str
       }
    }
    puts &#34;\n\n!!!!! ERROR \n$regPath does not match any regression type directories \n!!!!!&#34;
    exit;
}
<span class="comment-line"># --------------------------------------------------------------------</span>
<span class="comment-line">#   proc _setCurrentAutoDir</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Clean the path up to the base required for sourcing files and executing.</span>
<span class="comment-line">#</span>
<span class="comment-line">#   In  - none</span>
<span class="comment-line">#   Out - normalized dir</span>
<span class="comment-line">#</span>
<span class="comment-line"># --------------------------------------------------------------------</span>
<strong><a name="::::_setCurrentAutoDir_149">proc <a href="filetools.tcl-annot.html#::::_setCurrentAutoDir">::::_setCurrentAutoDir</a></a></strong> {} {
    set curLocation [pwd]
    set curDirList [split [string trim [string trim $curLocation &#34;..&#34;] &#34;/&#34;] &#34;/&#34;]
    set v 0;
    set pathList &#34;&#34;
    set curAutoRoot &#34;&#34;
    foreach cd $curDirList {
        if {$cd == &#34;main&#34; || $cd == &#34;Lib&#34; || $cd == &#34;Util&#34;} {
            for {set x 0} {$x&lt;$v} {incr x} {
                lappend pathList [lindex $curDirList $x]
            }
            set curAutoRoot &#34;/[join $pathList &#34;/&#34;]&#34;
        } else {
            incr v;
        }
    }
    return $curAutoRoot;
}
<span class="comment-line"># --------------------------------------------------------------------</span>
<span class="comment-line"># proc _cleanAutoPath</span>
<span class="comment-line"># </span>
<span class="comment-line"># Initial purpose is to strip any ixia variables from the environment</span>
<span class="comment-line"># We want to use values from the common.cfg</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#    In args - none</span>
<span class="comment-line">#    out     - cleaned path</span>
<span class="comment-line">#</span>
<span class="comment-line"># --------------------------------------------------------------------</span>
<strong><a name="::::_cleanAutoPath_178">proc <a href="filetools.tcl-annot.html#::::_cleanAutoPath">::::_cleanAutoPath</a></a></strong> {args} {
    global auto_path

    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _cleanAutoPath $args {
        remove &#34;ixia&#34;                        
    }

    set auto_path_temp &#34;&#34;
    foreach var $auto_path {
       set var1 [split $var &#34;/&#34;]
       if {![regexp -nocase &#34;$remove&#34; $var1]} {
          lappend auto_path_temp $var
       }
    }
    return $auto_path_temp;

}
<span class="comment-line"># --------------------------------------------------------------------</span>
<span class="comment-line"># proc _getRepoVersion  </span>
<span class="comment-line">#</span>
<span class="comment-line">#     get the svn or... later git version of the directory under test</span>
<span class="comment-line">#</span>
<span class="comment-line"># --------------------------------------------------------------------</span>
<strong><a name="::::_getRepoVersion_201">proc <a href="filetools.tcl-annot.html#::::_getRepoVersion">::::_getRepoVersion</a></a></strong> {} {
    global regLogin regPassword

    set x [catch {exec svn info --username $regLogin --password $regPassword} what]

    set lines [split $what &#34;\n&#34;]
    foreach line $lines {
        set words [split $line &#34; &#34;]
        set i 0
        foreach word $words {
            if {[string tolower $word] == &#34;revision:&#34;} {
                set rev [lindex $words [expr $i + 1]]
                if {$rev &gt; 1000} {
                    return $rev
                } else {
                    return &#34;null&#34;
                }
            } else {
                incr i
            }
        }
    }
}
<span class="comment-line"># --------------------------------------------------------------------</span>
<span class="comment-line"># Procedure: _setAllDirFilePrivs</span>
<span class="comment-line">#</span>
<span class="comment-line"># set priv in Tmp dir to all 777s</span>
<span class="comment-line">#</span>
<span class="comment-line"># --------------------------------------------------------------------</span>
<strong><a name="::::_setAllDirFilePrivs_230">proc <a href="filetools.tcl-annot.html#::::_setAllDirFilePrivs">::::_setAllDirFilePrivs</a></a></strong> {args} {
    global MAIN
    <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _setAllDirFilePrivs  $args {
        dir       &#34;Tmp&#34;
        filestr   &#34;*&#34;
        sudouser  &#34;autotest-rtp&#34;
        priv      &#34;777&#34;
    }

    set fList [glob -types {f} -path ${dir}/ $filestr]
    if {[info exists MAIN(user)] &amp;&amp; $MAIN(user) == &#34;$sudouser&#34;} {
        puts &#34;chmod sudo as autotest-rtp&#34;
        foreach f $fList {
            if {[catch {exec sudo chmod $priv ${f}} rea]} {
                puts &#34;Failed the chmod $priv tmp file: $rea&#34;
            }
        }
    } else {
        puts &#34;hmm user set file privs&#34;
        foreach f $fList {
            puts &#34;sudo chmod $priv ${f}&#34;
            if {[catch {exec sudo chmod $priv ${f}} rea]} {
                puts &#34;Failed the chmod $priv tmp file: $rea&#34;
            }
        }
    }
}
<span class="comment-line"># --------------------------------------------------------------------</span>
<strong><a name="::::_walkDirs_258">proc <a href="filetools.tcl-annot.html#::::_walkDirs">::::_walkDirs</a></a></strong> {args} {
    global MAIN
    <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _walkDirs  $args {
        action    &#34;cleanTmp&#34;
    }
    set AllDirs [glob -type d *]
    set h [pwd]
    foreach d $AllDirs {
        cd $d
        puts &#34;cd to $d&#34;
        catch {glob -type d *} subDirs
        if {[lsearch $subDirs &#34;Tmp&#34;] &gt;= 0} {
            <a name="::_setAllDirFilePrivs(1)"><a href="./filetools.tcl.html#::_setAllDirFilePrivs_230">::_setAllDirFilePrivs</a></a> -dir &#34;Tmp&#34;
        }
        cd $h
    }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
