<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>bgpv6.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#bgpv6.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>bgpv6.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="bgpv6.tcl-annot.html">annotations</a> | <a href="bgpv6.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">###################################################################</span>
<span class="comment-line">#  EBGP ipv6 routes</span>
<span class="comment-line">#  ----------------</span>
<span class="comment-line">#  setupEBGPv6Peer $dutIp $asNumber $ipNetworkList $numRoutesList $txPortId ...</span>
<span class="comment-line">#  startBGPv6 $txPortId</span>
<span class="comment-line">#  stopBGPv6  $txPortId</span>
<span class="comment-line">#</span>
<span class="comment-line">#  - dutIp          : DUT IP address</span>
<span class="comment-line">#  - asNumber       : Ixia AS number</span>
<span class="comment-line">#  - ipNetworkList  : Start IP address list of broadcast routes</span>
<span class="comment-line">#  - fromPrefixList : Start routes' mask list</span>
<span class="comment-line">#  - thruPrefixList : End routes' mask list</span>
<span class="comment-line">#  - numRoutesList  : List number of routes to broadcast</span>
<span class="comment-line">#  - txPortId       : Ixia port to broadcast the routes </span>
<span class="comment-line">#  - communityList  : List of community</span>
<span class="comment-line">#  - clusterList    : List of cluster</span>
<span class="comment-line">#  - asPathList     : List of AS path</span>
<span class="comment-line">###################################################################</span>
<span class="comment-line">#  IBGP ipv6 routes</span>
<span class="comment-line">#  ----------------</span>
<span class="comment-line">#  setupIBGPv6Peer $dutIp $asNumber $ipNetwork $numRoutes $txPortId</span>
<span class="comment-line">#  startBGPv6 $txPortId</span>
<span class="comment-line">#  stopBGPv6  $txPortId</span>
<span class="comment-line">#</span>
<span class="comment-line">#  - dutIp     : DUT IP address</span>
<span class="comment-line">#  - asNumber  : AS number</span>
<span class="comment-line">#  - ipNetwork : Start IP address of broadcast routes</span>
<span class="comment-line">#  - numRoutes : Number of routes to broadcast</span>
<span class="comment-line">#  - txPortId  : Ixia port to broadcast the routes</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">####################################################################</span>
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: startBgpv6</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  start the BGP protocol server for ipv6 on the ixia</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: txPortIdList</span>
<span class="comment-line"># args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      startBgpv6 1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::startBgpv6_54">proc <a href="bgpv6.tcl-annot.html#::::startBgpv6">::::startBgpv6</a></a></strong> {txPortIdList} {

	global TrafficGen
	switch -exact -- $TrafficGen {

	 ixia -
         ixvm {
    set pList &#34;&#34;
    foreach txPortId $txPortIdList {
        <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startBgpv6: Chas: $cha Card: $car Port: $por&#34;
        lappend pList &#34;$cha $car $por&#34;
    }

    if {[ixStartBGP4 pList]} {
        error &#34;startBgpv6: ixStartBGP6 failed.&#34;
    } 
	}
	stc {
			
			set globalDeviceList &#34;&#34;
			foreach txPortId $txPortIdList {
				set txPortId [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
				set deviceList [<a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
				<a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startBgpv6: Device List - $deviceList&#34;
				set globalDeviceList [concat $globalDeviceList $deviceList]				
			}

			if {[catch {<a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStartCommand -DeviceList $globalDeviceList} retCode]} {
				error &#34;startBgpv6: Spirent device start failed.&#34;
			} 
		}
	}
      
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: stopBgpv6</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Stop the BGP protocol server for ipv6 on the ixia</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: txPortIdList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#        stopBgpv6 {1 2 3 4}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::stopBgpv6_106">proc <a href="bgpv6.tcl-annot.html#::::stopBgpv6">::::stopBgpv6</a></a></strong> {txPortIdList} {
    set pList &#34;&#34;
	global TrafficGen
	switch -exact -- $TrafficGen {
		ixia -
                ixvm {
	
    foreach txPortId $txPortIdList {	
        <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        if {[<a name="::ixPortClearOwnership(1)"><a href="./mapping.tcl.html#::ixPortClearOwnership_76">::ixPortClearOwnership</a></a> $cha $car $por force]!=0} {
           <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Can not clear ixia port ownership:$cha $car $por&#34;
        }
        <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopBgpv6: Chas: $cha Card: $car Port: $por&#34;
        lappend pList &#34;$cha $car $por&#34;
    }

    if {[ixStopBGP4 pList]} {
        error &#34;stopBgpv6: ixStopBGPv6 failed.&#34;
    }
}
		stc {
			
			set globalDeviceList &#34;&#34;
			foreach txPortId $txPortIdList {
				set txPortId [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
				set deviceList [<a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
				<a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopBgpv6: Device List - $deviceList&#34;
				set globalDeviceList [concat $globalDeviceList $deviceList]				
			}

			if {[catch {<a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStopCommand -DeviceList $globalDeviceList} retCode]} {
				error &#34;stopBgpv6: Spirent device start failed.&#34;
			} 
		}
	}
    
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPv6Messages</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the BGP Messages from a frame received</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: List of BGP Messages in ixia raw frame format</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     set bgpMsgs [GetBGPMessages $frame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">#if {0} {</span>
<strong><a name="::::GetBGPv6Messages_162">proc <a href="bgpv6.tcl-annot.html#::::GetBGPv6Messages">::::GetBGPv6Messages</a></a></strong> {rawFrame} {
   set rtnMsgs &#34;&#34;
<span class="comment-line">#   set type [string range $rawFrame 36 40]</span>
set type [string range $rawFrame 48 52]
<a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the rawframe $rawFrame&#34;

   <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
<span class="comment-line">#   if {$type == &#34;86 DD&#34;} {</span>
 <span class="comment-line">#    set leftRawFrame [string range $rawFrame 0 35]</span>
<span class="comment-line">#result_debug &#34;the leftRawFrame is $leftRawFrame&#34;</span>
 <span class="comment-line">#    set rightRawFrame [string range $rawFrame 41 [string length $rawFrame]]</span>
<span class="comment-line">#result_debug &#34;the rightRawFrame is $rightRawFrame&#34;</span>
<span class="comment-line">#     set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]</span>
<span class="comment-line"># result_debug &#34;the rawframe $rawFrame&#34;</span>
 <span class="comment-line">#  }</span>

<span class="comment-line">#   set type [string range $rawFrame 36 40]</span>

<span class="comment-line">#   result_debug &#34;the type $type&#34;</span>
   if { $type == &#34;86 DD&#34; } {
      set IpType [string range $rawFrame 72 73]
<span class="comment-line">#result_debug &#34;the rawFrame is $rawFrame&#34;</span>
<a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the IpType is $IpType&#34;
      if { $IpType == &#34;06&#34; } {
         set srcPort [<a name="::GetIPv6SourcePort(1)"><a href="./bgpv6.tcl.html#::GetIPv6SourcePort_240">::GetIPv6SourcePort</a></a> $rawFrame]
         set dstPort [<a name="::GetIPv6DestPort(1)"><a href="./bgpv6.tcl.html#::GetIPv6DestPort_271">::GetIPv6DestPort</a></a> $rawFrame]
         <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The srcPort $srcPort and dstPort $dstPort&#34;
         if {$srcPort==&#34;179&#34;||$dstPort==&#34;179&#34;} {
            set macHdrLen 14
	    set ipHdrLen 40
	    set ipLenPos 22
	    set bgpMakerLen 16
	    set ipLen [<a name="::GetShortIntOffset(1)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame [expr ($ipLenPos * 3)]]
            <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The ipLen is $ipLen&#34;
            set ipLen [expr ($ipLen + 40)]
	    <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The ipLen $ipLen&#34;
	    set tcpLenPos [expr (70 * 3)]
            set tcpHdrLen [expr ([<a name="::hextodec(1)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $rawFrame $tcpLenPos $tcpLenPos]] * 4)]
           <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The tcpHdrLen $tcpHdrLen&#34;
	    set ipOffset [ expr ($ipHdrLen + $tcpHdrLen)]
          <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The ipOffset $ipOffset&#34;
	    while {$ipOffset &lt; $ipLen} {
               set bgpLengthPos [expr (14 + 16 + $ipOffset) * 3]
	       set bgpLength [<a name="::GetShortIntOffset(2)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame $bgpLengthPos]
<a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The bgpLength $bgpLength&#34;
<a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The bgpLengthPos $bgpLengthPos&#34;
	       set b_start [expr (($ipOffset +14 ) * 3)]
	       set b_end [expr ($b_start + ([expr $bgpLength * 3]) - 2)]
<span class="comment-line">#result_debug &#34;The b_start is $b_start&#34;</span>
<span class="comment-line">#result_debug &#34;The b_end is $b_end&#34;</span>
	       lappend rtnMsgs [string range $rawFrame $b_start $b_end]
<span class="comment-line">#result_debug &#34;The rtnMsgs is $rtnMsgs&#34;</span>
	       set ipOffset [expr ($ipOffset + $bgpLength)]
            }
         }
      }
   }
<span class="comment-line">#   result_debug &#34;bgpMsgs: $rtnMsgs&#34;</span>
   return $rtnMsgs
}
<span class="comment-line">#}</span>
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetIPv6SourcePort</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the decimal source port from tcp/udp packet header</span>
<span class="comment-line">#     Supports tagged frames too.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># Return value: Short integer or -1 on error</span>
<span class="comment-line"># GetIPSourcePort frame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetIPv6SourcePort_240">proc <a href="bgpv6.tcl-annot.html#::::GetIPv6SourcePort">::::GetIPv6SourcePort</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;86 DD&#34; {
      <span class="comment-line">#return [GetShortIntOffset $rawFrame 168]</span>
      return [<a name="::GetShortIntOffset(3)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 162]
   }   &#34;81 00&#34; {
      return [<a name="::GetIPv6SourcePort(2)"><a href="./bgpv6.tcl.html#::GetIPv6SourcePort_240">::GetIPv6SourcePort</a></a> [string range $rawFrame 12 end ]]          ;<span class="comment-line"># for tagged frame   </span>
   } default {
      <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Type: $type&#34;
      return -1
   }
   
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetIPv6DestPort</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the decimal destination port from tcp/udp packet header</span>
<span class="comment-line">#     Supports tagged frames too.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: Short integer or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># GetIPDestPort frame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetIPv6DestPort_271">proc <a href="bgpv6.tcl-annot.html#::::GetIPv6DestPort">::::GetIPv6DestPort</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;86 DD&#34; {
<span class="comment-line">#      return [GetShortIntOffset $rawFrame 174]</span>
      return [<a name="::GetShortIntOffset(4)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 168]
   }   &#34;81 00&#34; {
      return [<a name="::GetIPv6DestPort(2)"><a href="./bgpv6.tcl.html#::GetIPv6DestPort_271">::GetIPv6DestPort</a></a> [string range $rawFrame 12 end ]]          ;<span class="comment-line"># for tagged frame   </span>
   } default {
      <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Type: $type&#34;
      return -1
   }
   
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPv6MsgTypes</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the BGP Message Types from a list of BGP</span>
<span class="comment-line">#     messages which is obtained from raw frame via GetBGPMesssges</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: list of BGP Messages</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: List of BGP Message types</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    set bgpMsgs [GetBGPMessages $frame]</span>
<span class="comment-line">#    set bgpMsgTypes [GetBGPMsgTypes $$bgpMsgs]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPv6MsgTypes_303">proc <a href="bgpv6.tcl-annot.html#::::GetBGPv6MsgTypes">::::GetBGPv6MsgTypes</a></a></strong> {bgpMsgs} {
   set rtnTypes &#34;&#34;
   foreach bgpMsg $bgpMsgs {
      set bgpTypeOffset 22
      set bgpTypePos [expr ($bgpTypeOffset * 3)]
      set bgpType [<a name="::GetByteOffset(1)"><a href="./MessageDecoding.tcl.html#::GetByteOffset_789">::GetByteOffset</a></a> $bgpMsg $bgpTypePos]
      switch -- $bgpType \
      &#34;1&#34;  {
         lappend rtnTypes &#34;IP_BGPv6_OPEN&#34;
      }  &#34;2&#34;  {
         lappend rtnTypes &#34;IP_BGPv6_UPDATE&#34;
      }  &#34;3&#34;  {
         lappend rtnTypes &#34;IP_BGPv6_NOTIFICATION&#34;
      }  &#34;4&#34;  {
         lappend rtnTypes &#34;IP_BGPv6_KEEPALIVE&#34;
      }  default  {
         lappend rtnTypes &#34;IP_TCP&#34;
      }
   }
<span class="comment-line">#   result_debug &#34;bgpMsgTypes: $rtnTypes&#34;</span>
   return $rtnTypes
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetDestIPAddressV6</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the destination IP address  from an IPv6 packet header</span>
<span class="comment-line">#     Supports tagged frames too.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: IP Address or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># GetDestIPAddressV6 frame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDestIPAddressV6_343">proc <a href="bgpv6.tcl-annot.html#::::GetDestIPAddressV6">::::GetDestIPAddressV6</a></a></strong> { rawFrame } {

   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;81 00&#34; {
      <span class="comment-line">#result_debug &#34;126 to 172 [string range $rawFrame 126 172 ]&#34;</span>
      <span class="comment-line">#result_debug &#34;type 174 to 176 [string range $rawFrame 174 176 ]&#34;</span>
      <span class="comment-line">#result_debug &#34;code 177 to 179 [string range $rawFrame 177 179 ]&#34;</span>
      return [string range $rawFrame 126 172 ]
   }  &#34;86 DD&#34; {
      <span class="comment-line">#result_debug &#34;114 to 160 [string range $rawFrame 114 160 ]&#34;</span>
      <span class="comment-line">#result_debug &#34;type 162 to 164 [string range $rawFrame 162 164 ]&#34;</span>
      <span class="comment-line">#result_debug &#34;code 165 to 167 [string range $rawFrame 165 167 ]&#34;</span>
      return [string range $rawFrame 114 160 ]
   }  default {
      <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Type: $type&#34;
      return -1
   }

}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetSourceIPAddressV6</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the source IP address  from an IPv6 packet header</span>
<span class="comment-line">#     Supports tagged frames too.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: IP Address or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># GetDestIPAddressV6 frame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetSourceIPAddressV6_380">proc <a href="bgpv6.tcl-annot.html#::::GetSourceIPAddressV6">::::GetSourceIPAddressV6</a></a></strong> { rawFrame } {

   set type [string range $rawFrame 36 40]
   switch $type {
      &#34;81 00&#34; {return [string range $rawFrame 78 124 ]}
      &#34;86 DD&#34; {return [string range $rawFrame 66 112 ]}
      default {
         <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Type: $type&#34;
         return -1
      }
   }
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cleanupBgpv6</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Disable and cleanup the BGP protocol server for ipv6</span>
<span class="comment-line">#	                     on the ixia</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: txPortIdList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      cleanupBgpv6 {1 2 3 4}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cleanupBgpv6_411">proc <a href="bgpv6.tcl-annot.html#::::cleanupBgpv6">::::cleanupBgpv6</a></a></strong> {txPortIdList} {

global TrafficGen
	switch -exact -- $TrafficGen {
		ixia -
                ixvm {

foreach txPortId $txPortIdList {    
   <span class="comment-line"># get the port information</span>
   <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
   set chas(1) $cha
   set card(1) $car
   set port(1) $por
   <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Chas: $cha Card: $car Port: $por&#34;
   
   <span class="comment-line"># select the port</span>
   bgp4Server setDefault
   if {[bgp4Server select $chas(1) $card(1) $port(1)]} {
      <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Connecting to bgp4Server&#34;
      exit
   }
   bgp4RouteItem clearASPathList
   bgp4RouteItem clearExtendedCommunityList
   bgp4RouteItem setDefault
   bgp4Neighbor clearAllRouteRanges
   bgp4Neighbor setDefault
   bgp4Server clearAllNeighbors
   bgp4Server setDefault
   bgp4Server  set
     	
   ipAddressTable setDefault
   ipAddressTable clear
   if {[ipAddressTable set $chas(1) $card(1) $port(1)]} {
       <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cleanupBgpv6: ipAddressTable set $chas(1) $card(1) $port(1) failed.&#34;
   }

    <span class="comment-line">#--- This will delete the interface table</span>
    interfaceTable select $chas(1) $card(1) $port(1)
    interfaceTable getInterface &#34;Port $card(1):$port(1) Interface&#34;
    interfaceTable delInterface &#34;Port $card(1):$port(1) Interface&#34;
    <span class="comment-line"># EY-07-17-2008: Removed invalid parameter to &#34;interfaceTable</span>
    <span class="comment-line"># clearAllInterfaces&#34; command.</span>
    interfaceTable clearAllInterfaces;
    interfaceTable write;


   protocolServer setDefault
   protocolServer get $chas(1) $card(1) $port(1)
   protocolServer config -enableArpResponse false
   protocolServer config -enableBgp4Service false
   if {[protocolServer set $chas(1) $card(1) $port(1)]} {
      <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Setting Protocol Server&#34;
   }
   if {[protocolServer write $chas(1) $card(1) $port(1)]} {
      <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cleanupBgpv6: protocolServer write $chas(1) $card(1) $port(1) failed.&#34;
   }
   if {[<a name="::ixPortClearOwnership(2)"><a href="./mapping.tcl.html#::ixPortClearOwnership_76">::ixPortClearOwnership</a></a> $chas(1) $card(1) $port(1) force]!=0} {
      <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Can not clear ixia port ownership:$chas(1) $card(1) $port(1)&#34;
   }
}
		}
		stc {
			foreach txPortId $txPortIdList {
					set txPortId [<a name="::hMapPortIdToSpirentPort(3)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
					foreach emulatedDevice [<a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources] {
						set ipv6If [<a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-Ipv6If]
						if {$ipv6If != &#34;&#34;} {
							<a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $emulatedDevice							
						}
					}
				}
		}
	}


   
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: setupEBGPv6Peer</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Setup an EBGP ipv6 peer on the ixia</span>
<span class="comment-line">#              protocol server</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::setupEBGPv6Peer_505">proc <a href="bgpv6.tcl-annot.html#::::setupEBGPv6Peer">::::setupEBGPv6Peer</a></a></strong> {args} {
	global TrafficGen
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupEBGPv6Peer $args {
     dutIp &#34;2002:1::1&#34;
     myIp &#34;&#34;
     asNumber &#34;9999&#34;
     numPeers &#34;1&#34;
     bgpId &#34;1.1.1.1&#34;
     ipNetworkList &#34;&#34;
     fromPrefixList &#34;&#34;
     thruPrefixList &#34;&#34;
     originProtocolList &#34;&#34;
     numRoutesList &#34;&#34;
     txPortId  &#34;1&#34;
     communityList &#34;&#34;
     expcomList &#34;&#34;
     localPrefList &#34;&#34;
     clusterList &#34;&#34;
     asTypeList &#34;&#34;
     clearinter &#34;&#34; 
     mode &#34;&#34;
     asPathList &#34;&#34;
     medList &#34;&#34;
     atomicaggregate &#34;&#34;
     routeFlapDropTimeList &#34;&#34;
     routeFlapTimeList &#34;&#34;
     routesToFlapFromList &#34;&#34;
     routesToFlapToList &#34;&#34;
     linkFlapDropTime &#34;&#34;
     linkFlapTime &#34;&#34;
     extendedcommunity &#34;false&#34;
     extendedcommunityList &#34;&#34;
     tag &#34;none&#34;
     vlanPrio &#34;0&#34;
     enGraResList &#34;&#34;
     resTimList &#34;&#34;
     staleTimeList &#34;&#34;
     multProtocol &#34;false&#34;
     4byteAs &#34;false&#34;
   }

   switch -exact -- $TrafficGen {
   
		stc {
			set txPortIndex $txPortId
			set txPortId [<a name="::hMapPortIdToSpirentPort(4)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
		
			for {set i 0} {$i&lt;$numPeers} {incr i} {
		
				
				set dutIpi $dutIp 
				set ipNetworkListValue [lindex $ipNetworkList $i]
				set fromPrefixListValue [lindex $fromPrefixList $i]
				set thruPrefixListValue [lindex $thruPrefixList $i]
				set numRoutesListValue [lindex $numRoutesList $i]
				set communityListValue [lindex $communityList $i]
				set expcomListValue [lindex $expcomList $i]
				set clusterListValue [lindex $clusterList $i]
				set localPrefListValue [lindex $localPrefList $i]
				set originProtocolListValue [lindex $originProtocolList $i]
				set asTypeListValue [lindex $asTypeList $i]
				set asPathListValue [lindex $asPathList $i]
				set medListValue [lindex $medList $i]
				set modeListValue [lindex $mode $i]
				set graceRestartValue [ lindex $enGraResList $i]
				set resTimeValue [lindex $resTimList $i]
				set staleTimeValue [lindex $staleTimeList $i]
				set asPathTypeListValue [lindex $asPathList $i]
				set atomicaggregateListValue [lindex $atomicaggregate $i]
				set asNum [lindex $asNumber $i]
		
				<span class="comment-line"># Create emulated device</span>
				
				if {$myIp == &#34;&#34;} {
				  if {$i == 0} {
					set myIpi [<a name="::incrIpv6Field(1)"><a href="./spirent.tcl.html#::incrIpv6Field_407">::incrIpv6Field</a></a> $dutIpi 16 [expr $i+1]]
				   } else {
						set myIpi [<a name="::incrIpv6Field(2)"><a href="./spirent.tcl.html#::incrIpv6Field_407">::incrIpv6Field</a></a> $myIpi 16 [expr 1]]
				   }
				  } else {
					set myIpi $myIp
				  }
				
				 set showOutput &#34;&#34;
				 lappend showOutput &#34;\{As\} 2&#34;
				 <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;showOutput $showOutput&#34;
				 set dutASN [lindex [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show bgp&#34; $showOutput] 0]
				
				set linkLocalAddr &#34;fe80::[expr 1+$txPortIndex+$i]&#34;
				
				if {$tag == &#34;none&#34;} {
					array set cmdResults [<a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(9)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv6If EthIIIf&#34; -IfCount &#34;1 1&#34;]
					set deviceHndl $cmdResults(-ReturnList)
					<a name="::logcmd(10)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(11)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -primaryif-Targets] -Address $myIpi -Gateway $dutIpi
					<a name="::logcmd(12)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6If -under $deviceHndl -stackedonendpoint-Targets [lindex [<a name="::logcmd(13)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] 0] -toplevelif-Sources $deviceHndl -Address $linkLocalAddr
				} else {
					array set cmdResults [<a name="::logcmd(14)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(15)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv6If VlanIf EthIIIf&#34; -IfCount &#34;1 1 1&#34;]
					set deviceHndl $cmdResults(-ReturnList)
					<a name="::logcmd(16)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(17)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -primaryif-Targets] -Address $myIpi -Gateway $dutIpi
					<a name="::logcmd(18)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(19)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] -VlanId $tag -Priority $vlanPrio
										<a name="::logcmd(20)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6If -under $deviceHndl -stackedonendpoint-Targets [lindex [<a name="::logcmd(21)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] 0] -toplevelif-Sources $deviceHndl -Address $linkLocalAddr
				}
				
				
				set bgpAttributes &#34;-under $deviceHndl -BgpSessionIpAddress INTERFACE_IP -DutIpv6Addr $dutIpi&#34; 
				if {!$4byteAs} {
					append bgpAttributes &#34; -AsNum $asNum -DutAsNum $dutASN&#34;
				} else {
					append bgpAttributes &#34; -AsNum4Byte $asNum -Enable4ByteAsNum TRUE -DutAsNum4Byte $dutASN&#34;
				}
				if {($graceRestartValue != &#34;&#34;) &amp;&amp; $graceRestartValue} {
					append bgpAttributes &#34;-GracefulRestart $graceRestartValue -RestartTime $resTimeValue -RestartDelay $staleTimeValue&#34;					
				}					
				
				set bgpRouterConfigHndl [eval &#34;logcmd stc::create BgpRouterConfig [subst $bgpAttributes] -IpVersion IPV6&#34;] 
				
				set numOfIpv6Routes [llength $fromPrefixListValue]
					
				for {set j 0} {$j &lt; $numOfIpv6Routes} {incr j} {
				
					set ipNetworkValue [lindex $ipNetworkListValue $j]
					set modeValue [lindex $modeListValue $j]
					set atomicaggregateValue [lindex $atomicaggregateListValue $j]
					set clusterIdValue [lindex $clusterListValue $j]
					set communityValue [lindex $communityListValue $j]
					set localPrefValue [lindex $localPrefListValue $j]
					set fromPrefixValue [lindex $fromPrefixListValue $j]
					set numRoutesValue [lindex $numRoutesListValue $j]
					set medValue [lindex $medListValue $j]
					set asTypeValue [lindex $asTypeListValue $j]
					set asPathValue [lindex $asPathListValue $j]
				
				
					if {$modeValue == &#34;unicast&#34;} {
						set modeValue &#34;UNICAST&#34;
					} else {
						set modeValue &#34;MULTICAST&#34;
					}
											
					set ipv6RouteAttrs &#34;-under $bgpRouterConfigHndl -Origin EGP&#34;
					if {$asPathValue == &#34;&#34;} {
						set asPathValue $asNum
					}
					append ipv6RouteAttrs &#34; -AsPath \{$asPathValue\}&#34;
					if {$atomicaggregateValue != &#34;&#34;} {
						append ipv6RouteAttrs &#34; -AtomicAggregatePresent $atomicaggregateValue&#34;						
					}
					if {$clusterIdValue != &#34;&#34;} {
						append ipv6RouteAttrs &#34; -ClusterIdList $clusterIdValue&#34;						
					}
					if {($communityValue != &#34;&#34;) &amp;&amp; ($communityValue != &#34;null&#34;) } {
						append ipv6RouteAttrs &#34; -Community $communityValue&#34;						
					}
					if {$localPrefValue != &#34;&#34;} {
						append ipv6RouteAttrs &#34; -LocalPreference $localPrefValue&#34;						
					}
					if {$medValue != &#34;&#34;} {
						append ipv6RouteAttrs &#34; -Med $medValue&#34;						
					}
					if {$asTypeValue != &#34;&#34;} {
						append ipv6RouteAttrs &#34; -AsPathSegmentType $asTypeValue&#34;						
					}
					set hBgpIpv6Route [eval &#34;logcmd stc::create BgpIpv6RouteConfig  [subst $ipv6RouteAttrs]&#34;]
					
					if {[llength $fromPrefixValue] != 0} {
						<a name="::logcmd(22)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(23)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hBgpIpv6Route -children-Ipv6NetworkBlock] -NetworkCount $numRoutesValue -StartIpList $ipNetworkValue -PrefixLength $fromPrefixValue
					}
				}
				
				
			}
			
			
		}
   
		ixia -
                ixvm {
   
   <span class="comment-line"># get the port information</span>
   <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
   set chas(1) $cha
   set card(1) $car
   set port(1) $por
   <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Chas: $cha Card: $car Port: $por&#34;

   set IXIA_10G [<a name="::getIxiaPortType(1)"><a href="./ePTMisc.tcl.html#::getIxiaPortType_585">::getIxiaPortType</a></a> $txPortId]
   <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;IXIA_10G === $IXIA_10G&#34;
   if {$IXIA_10G == 98} {
           <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Chas: $cha Card: $car Port: $por&#34;
            <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -autonegotiate                      false
            <a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise100FullDuplex             false
            <a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise100HalfDuplex             false
            <a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise10FullDuplex              false
            <a name="::port(5)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise10HalfDuplex              false
            <a name="::port(6)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise1000FullDuplex            false
            <a name="::port(7)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -portMode                           port10GigLanMode
    }

   if {[bgp4Server select $chas(1) $card(1) $port(1)]} {
      <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Connecting to bgp4Server&#34;
      return -code return testSkipped
   }
   bgp4RouteItem clearASPathList
   bgp4RouteItem clearExtendedCommunityList
   bgp4RouteItem setDefault
   bgp4Neighbor clearAllRouteRanges
   bgp4Neighbor setDefault
   bgp4Server clearAllNeighbors
   bgp4Server setDefault
   bgp4Server  set

   for {set i 0} {$i&lt;$numPeers} {incr i} {
      set ipNetworkListValue [lindex $ipNetworkList $i]
      set fromPrefixListValue [lindex $fromPrefixList $i]
      set thruPrefixListValue [lindex $thruPrefixList $i]
      set numRoutesListValue [lindex $numRoutesList $i]
      set communityListValue [lindex $communityList $i]
      set expcomListValue [lindex $expcomList $i]
      set clusterListValue [lindex $clusterList $i]
      set localPrefListValue [lindex $localPrefList $i]
      set originProtocolListValue [lindex $originProtocolList $i]
      set asTypeListValue [lindex $asTypeList $i]
      if {$mode != &#34;&#34;} {
      set modeListValue [lindex $mode $i]
      } else {
      set modeListValue &#34;&#34;
      }
      set asPathListValue [lindex $asPathList $i]
      set medListValue [lindex $medList $i]
      if {$myIp == &#34;&#34;} {
      if {$i == 0} {
        set myIp1 [<a name="::incrIpField(1)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $dutIp 4 [expr $i+1]]
       } else {
        set myIp1 [<a name="::incrIpField(2)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $myIp1 4 [expr 1]]
       }
      } else {
      set myIp1 $myIp
      }
      set asNum [lindex $asNumber $i]
      set rId [lindex $bgpId $i]

      set routeFlapDropTimeListValue [lindex $routeFlapDropTimeList $i]
      set routeFlapTimeListValue [lindex $routeFlapTimeList $i]
      set routesToFlapFromListValue [lindex $routesToFlapFromList $i]
      set routesToFlapToListValue [lindex $routesToFlapToList $i]
      set linkFlapDropTimeValue [lindex $linkFlapDropTime $i]
      set linkFlapTimeValue [lindex $linkFlapTime $i]
      set atomicaggregateValue [lindex $atomicaggregate $i]
      <span class="comment-line">#set extendedcommunityValue [lindex $extendedcommunity $i]</span>
      set extendedcommunityValue $extendedcommunity
      if {[regexp -nocase $extendedcommunityValue &#34;true&#34;]} {
      set extendedcommunityListValue [lindex $extendedcommunityList $i]
      } else {
      set extendedcommunityListValue &#34;&#34;
      }

      set graceRestartValue [ lindex $enGraResList $i]
      set resTimeValue [lindex $resTimList $i]
      set staleTimeValue [lindex $staleTimeList $i]
<a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the asPathListValue $asPathListValue and asNum $asNum&#34;


      set returnCode [<a name="::icetMakeExternalIpv6Peer(1)"><a href="./bgpv6.tcl.html#::icetMakeExternalIpv6Peer_1207">::icetMakeExternalIpv6Peer</a></a> -myIp $myIp1 -dutIp $dutIp -asNumber $asNum \
          -ipNetworkList $ipNetworkListValue -routerId $rId \
          -fromPrefixList $fromPrefixListValue -thruPrefixList $thruPrefixListValue -numRoutesList $numRoutesListValue \
          -txPortId $txPortId -communityList $communityListValue -clusterList $clusterListValue -asTypeList $asTypeListValue \
          -medList $medListValue -atomicaggregateList $atomicaggregateValue -mode $modeListValue \
          -asPathList $asPathListValue -originProtocolList $originProtocolListValue \
          -localPrefList $localPrefListValue -expcomList $expcomListValue \
          -localPrefList $localPrefListValue \
          -routeFlapDropTimeList $routeFlapDropTimeListValue \
          -routeFlapTimeList $routeFlapTimeListValue -routesToFlapFromList $routesToFlapFromListValue \
          -routesToFlapToList $routesToFlapToListValue -linkFlapDropTime $linkFlapDropTimeValue \
          -linkFlapTime $linkFlapTimeValue -extendedcommunityList $extendedcommunityListValue -extendedcommunity $extendedcommunityValue -graceRestart $graceRestartValue \
  -graResTime $resTimeValue -graStaleTime $staleTimeValue -4byteAs $4byteAs]
      if {$returnCode==-1} {
          return -code return testSkipped
      }
set neib [expr $i+1]
if {[bgp4Server  addNeighbor  neighbor$neib]} {
   <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;error adding bgp neighbor $neib&#34;
}
}

   if {[bgp4Server  set]} {
       <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error setting bgp server&#34;
   }

   <span class="comment-line">#set IP address table</span>
   <a name="::setIpv6AddressTable(1)"><a href="./bgpv6.tcl.html#::setIpv6AddressTable_1828">::setIpv6AddressTable</a></a> $dutIp $numPeers $chas(1) $card(1) $port(1) &#34;&#34; $tag $multProtocol
   set myMac [format &#34;00 be ef 00 %02x %02x&#34; $card(1) $port(1)]

   if {![regexp -nocase &#34;3.50&#34; [<a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -installVersion]]} {
       interfaceTable               select            $chas(1) $card(1) $port(1)
       if {$multProtocol == &#34;false&#34;} {
          interfaceIpV6                setDefault
       }
       interfaceIpV6                setDefault
      <span class="comment-line"># interfaceIpV6                config            -gatewayIpAddress                   &#34;$dutIp&#34;</span>
       interfaceIpV6                config            -maskWidth                          64
       interfaceIpV6                config            -ipAddress                          &#34;$myIp&#34;
       interfaceEntry               addItem           addressTypeIpV6
       if {$multProtocol == &#34;false&#34;} {
          interfaceEntry               setDefault
       }
       interfaceEntry               config            -enable                             true
       interfaceEntry               config            -description                        &#34;Port $card(1):$port(1) Interface&#34;
       interfaceEntry               config            -macAddress                         &#34;$myMac&#34;
       interfaceEntry               config            -eui64Id                            {02 00 04 FF FE A0 B4 F7} 
       if {$tag !=&#34;none&#34;} {
          interfaceEntry               config            -enableVlan                         &#34;true&#34;
          interfaceEntry               config            -vlanId                             $tag
          interfaceEntry               config            -vlanPriority                      $vlanPrio 
       } else {
          interfaceEntry               config            -enableVlan                         false
          interfaceEntry               config            -vlanId                             0
          interfaceEntry               config            -vlanPriority                       0
       }

 	
   set ResetInter 1	
   if {$clearinter == &#34;noclear&#34;} {	
   set ResetInter 0	
   } else {	
   set ResetInter 1	
   } 	

   if {$ResetInter == 1} {	
   interfaceTable clearAllInterfaces	
   }
  
 <span class="comment-line">#      interfaceTable               clearAllInterfaces	</span>

       interfaceEntry               clearAllItems     addressTypeIpV6
       <span class="comment-line">#interfaceEntry               clearAllItems     addressTypeIpV4</span>
   }

   <span class="comment-line"># just for naming the port</span>
   <span class="comment-line">#port get $chas(1) $card(1) $port(1)</span>
   <span class="comment-line">#port config -name &#34;$numPeers Peers/[expr $numPeers * $rangePerPeer * $routePerRange] routes EBGP&#34;</span>
   <a name="::port(8)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chas(1) $card(1) $port(1)

   set myportList [list [format &#34;%s,%s,%s&#34; $chas(1) $card(1) $port(1)]]
   <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Writing Configuration to Hardware...&#34;
   if {[<a name="::writeConfigToHardware(1)"><a href="./mapping.tcl.html#::writeConfigToHardware_148">::writeConfigToHardware</a></a> myportList]} {
      <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error writing config to hardware&#34;
      return -code return testSkipped
   }

   <span class="comment-line">#----This proc would run only if </span>
   <span class="comment-line">#----4byte AS flage is set and Asnumber greater than 65535</span>
   if {![regexp -nocase &#34;false&#34; $4byteAs]} {
      <a name="::setEbgpAsnum(1)"><a href="./bgpv6.tcl.html#::setEbgpAsnum_2773">::setEbgpAsnum</a></a> $txPortId $numPeers $asNumber
   }
}
	}
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: setupIBGPv6Peer</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Setup an IBGP ipv6 Peer on the Ixia protocol server</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::setupIBGPv6Peer_879">proc <a href="bgpv6.tcl-annot.html#::::setupIBGPv6Peer">::::setupIBGPv6Peer</a></a></strong> {args} {
	global TrafficGen
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupIBGPPeer $args {
     dutIp &#34;2000::1&#34;
     myIp &#34;&#34;
     bgpServerMac &#34;&#34;
     asNumber &#34;9999&#34;
     bgpId &#34;2.3.4.5&#34;
     numPeers &#34;1&#34;
     ipNetworkList &#34;&#34;
     fromPrefixList &#34;&#34;
     thruPrefixList &#34;&#34;
     numRoutesList &#34;&#34;
     txPortId  &#34;1&#34;
     communityList &#34;&#34;
     expcomList &#34;&#34;
     clusterList &#34;&#34;
     localPrefList &#34;&#34;
     originProtocolList &#34;&#34;
     asTypeList &#34;&#34;
     mode &#34;&#34;
     asPathList &#34;&#34;
     medList &#34;&#34;
     nextHopList &#34;&#34;
     routeFlapDropTimeList &#34;&#34;
     routeFlapTimeList &#34;&#34;
     routesToFlapFromList &#34;&#34;
     routesToFlapToList &#34;&#34;
     linkFlapDropTime &#34;&#34;
     linkFlapTime &#34;&#34;
     originatorId &#34;&#34;
     extendedcommunity &#34;false&#34;
     extendedcommunityList &#34;&#34;
     4byteAs &#34;false&#34;
   }
    switch -exact -- $TrafficGen {
		
		stc {
			set txPortIndex $txPortId
			set txPortId [<a name="::hMapPortIdToSpirentPort(5)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
		
			for {set i 0} {$i&lt;$numPeers} {incr i} {
		
				
				set dutIpi $dutIp 
				set ipNetworkListValue [lindex $ipNetworkList $i]
				set fromPrefixListValue [lindex $fromPrefixList $i]
				set thruPrefixListValue [lindex $thruPrefixList $i]
				set numRoutesListValue [lindex $numRoutesList $i]
				set communityListValue [lindex $communityList $i]
				set expcomListValue [lindex $expcomList $i]
				set clusterListValue [lindex $clusterList $i]
				set localPrefListValue [lindex $localPrefList $i]
				set originProtocolListValue [lindex $originProtocolList $i]
				set asTypeListValue [lindex $asTypeList $i]
				set asPathListValue [lindex $asPathList $i]
				set medListValue [lindex $medList $i]
				set modeListValue [lindex $mode $i]
				set asPathTypeListValue [lindex $asPathList $i]
				set asNum [lindex $asNumber $i]
				
				if {$myIp == &#34;&#34;} {
				  if {$i == 0} {
					set myIpi [<a name="::incrIpv6Field(3)"><a href="./spirent.tcl.html#::incrIpv6Field_407">::incrIpv6Field</a></a> $dutIpi 16 [expr $i+1]]
				   } else {
						set myIpi [<a name="::incrIpv6Field(4)"><a href="./spirent.tcl.html#::incrIpv6Field_407">::incrIpv6Field</a></a> $myIpi 16 [expr 1]]
				   }
				  } else {
					set myIpi $myIp
				  }
		
				<span class="comment-line"># Create emulated device</span>
				set linkLocalAddr &#34;fe80::[expr 1+$txPortIndex+$i]&#34;
				
					if {$tag == &#34;none&#34;} {
					array set cmdResults [<a name="::logcmd(24)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(25)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv6If EthIIIf&#34; -IfCount &#34;1 1&#34;]
					set deviceHndl $cmdResults(-ReturnList)
					<a name="::logcmd(26)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(27)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -primaryif-Targets] -Address $myIpi -Gateway $dutIpi
					<a name="::logcmd(28)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6If -under $deviceHndl -stackedonendpoint-Targets [lindex [<a name="::logcmd(29)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] 0] -toplevelif-Sources $deviceHndl -Address $linkLocalAddr
				} else {
					array set cmdResults [<a name="::logcmd(30)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(31)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv6If VlanIf EthIIIf&#34; -IfCount &#34;1 1 1&#34;]
					set deviceHndl $cmdResults(-ReturnList)
					<a name="::logcmd(32)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(33)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -primaryif-Targets] -Address $myIpi -Gateway $dutIpi
					<a name="::logcmd(34)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(35)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] -VlanId $tag -Priority $vlanPrio
										<a name="::logcmd(36)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6If -under $deviceHndl -stackedonendpoint-Targets [lindex [<a name="::logcmd(37)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] 0] -toplevelif-Sources $deviceHndl -Address $linkLocalAddr
				}
				
				set bgpAttributes &#34;-under $deviceHndl -BgpSessionIpAddress INTERFACE_IP -DutIpv6Addr $dutIpi&#34; 
				if {!$4byteAs} {
					append bgpAttributes &#34; -AsNum $asNum -DutAsNum $asNum&#34;
				} else {
					append bgpAttributes &#34; -AsNum4Byte asNum -Enable4ByteAsNum TRUE -DutAsNum4Byte $asNum&#34;
				}
							
				
				set bgpRouterConfigHndl [eval &#34;logcmd stc::create BgpRouterConfig [subst $bgpAttributes] -IpVersion IPV6&#34;] 
				
				set numOfIpv6Routes [llength $fromPrefixListValue]
					
				for {set j 0} {$j &lt; $numOfIpv6Routes} {incr j} {
				
					set ipNetworkValue [lindex $ipNetworkListValue $j]
					set modeValue [lindex $modeListValue $j]
					set clusterIdValue [lindex $clusterListValue $j]
					set communityValue [lindex $communityListValue $j]
					set localPrefValue [lindex $localPrefListValue $j]
					set fromPrefixValue [lindex $fromPrefixListValue $j]
					set numRoutesValue [lindex $numRoutesListValue $j]
					set medValue [lindex $medListValue $j]
					set asTypeValue [lindex $asTypeListValue $j]
					set asPathValue [lindex $asPathListValue $j]
				
				
					if {$modeValue == &#34;unicast&#34;} {
						set modeValue &#34;UNICAST&#34;
					} else {
						set modeValue &#34;MULTICAST&#34;
					}
											
					set ipv6RouteAttrs &#34;-under $bgpRouterConfigHndl -Origin IGP&#34;
					if {$asPathValue == &#34;&#34;} {
						set asPathValue $asNum
					}
					append ipv6RouteAttrs &#34; -AsPath \{$asPathValue\}&#34;
					if {$clusterIdValue != &#34;&#34;} {
						append ipv6RouteAttrs &#34; -ClusterIdList $clusterIdValue&#34;						
					}
					if {($communityValue != &#34;&#34;) &amp;&amp; ($communityValue != &#34;null&#34;) } {
						append ipv6RouteAttrs &#34; -Community $communityValue&#34;						
					}
					if {$localPrefValue != &#34;&#34;} {
						append ipv6RouteAttrs &#34; -LocalPreference $localPrefValue&#34;						
					}
					if {$medValue != &#34;&#34;} {
						append ipv6RouteAttrs &#34; -Med $medValue&#34;						
					}
					if {$asTypeValue != &#34;&#34;} {
						append ipv6RouteAttrs &#34; -AsPathSegmentType $asTypeValue&#34;						
					}
					set hBgpIpv6Route [eval &#34;logcmd stc::create BgpIpv6RouteConfig  [subst $ipv6RouteAttrs]&#34;]
					
					if {[llength $fromPrefixValue] != 0} {
						<a name="::logcmd(38)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(39)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hBgpIpv6Route -children-Ipv6NetworkBlock] -NetworkCount $numRoutesValue -StartIpList $ipNetworkValue -PrefixLength $fromPrefixValue
					}						
					
				}
				
			}
			
			
		}
		
		ixia -
                ixvm {   
   <span class="comment-line"># get the port information</span>
   <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
   set chas(1) $cha
   set card(1) $car
   set port(1) $por
   <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Chas: $cha Card: $car Port: $por&#34;

   set IXIA_10G [<a name="::getIxiaPortType(2)"><a href="./ePTMisc.tcl.html#::getIxiaPortType_585">::getIxiaPortType</a></a> $txPortId]
   <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;IXIA_10G === $IXIA_10G&#34;
   if {$IXIA_10G == 98} {
           <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Chas: $cha Card: $car Port: $por&#34;
            <a name="::port(9)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -autonegotiate                      false
            <a name="::port(10)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise100FullDuplex             false
            <a name="::port(11)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise100HalfDuplex             false
            <a name="::port(12)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise10FullDuplex              false
            <a name="::port(13)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise10HalfDuplex              false
            <a name="::port(14)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise1000FullDuplex            false
            <a name="::port(15)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -portMode                           port10GigLanMode
    }

   bgp4Server setDefault
   if {[bgp4Server select $chas(1) $card(1) $port(1)]} {
      <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Connecting to bgp6Server&#34;
      return -code return testSkipped
   }
   bgp4RouteItem clearASPathList
   bgp4RouteItem clearExtendedCommunityList
   bgp4RouteItem setDefault
   bgp4Neighbor clearAllRouteRanges
   bgp4Neighbor setDefault
   bgp4Server clearAllNeighbors
   bgp4Server setDefault
   bgp4Server  set

<span class="comment-line">#--newely added for mode</span>

<span class="comment-line">#   if {[llength $mode] &lt; 1} {</span>
<span class="comment-line">#      set numpeer [llength $ipNetworkList]</span>
<span class="comment-line">#       for {set i 1} {$i &lt;= $numpeer} {incr i} {</span>
<span class="comment-line">#       lappend mode unicast</span>
<span class="comment-line">#    }</span>
<span class="comment-line">#}</span>

  for {set i 0} {$i&lt;$numPeers} {incr i} {
      set ipNetworkListValue [lindex $ipNetworkList $i]
      set fromPrefixListValue [lindex $fromPrefixList $i]
      set thruPrefixListValue [lindex $thruPrefixList $i]
      set numRoutesListValue [lindex $numRoutesList $i]
      set communityListValue [lindex $communityList $i]
      set expcomListValue [lindex $expcomList $i]
      set clusterListValue [lindex $clusterList $i]
      set localPrefListValue [lindex $localPrefList $i]
      set originProtocolListValue [lindex $originProtocolList $i]
      set asTypeListValue [lindex $asTypeList $i]
      if {$mode != &#34;&#34;} {
        set modeListValue [lindex $mode $i]
      } else {
        set modeListValue &#34;&#34;
      }
      set asPathListValue [lindex $asPathList $i]
      set medListValue [lindex $medList $i]
      if {$myIp == &#34;&#34;} {
       if {$i == 0} {
           set myIp1 [<a name="::incrIpField(3)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $dutIp 4 [expr $i+1]]
           <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;incrementing here in dutip&#34;
       } else {
           set myIp1 [<a name="::incrIpField(4)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $myIp1 4 [expr 1]]
           <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;incrementing here in myip&#34;
           <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;myIp1 here is $myIp1&#34;
       }
      } else {
      set myIp1 $myIp
      }
      <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;myIp is $myIp1&#34;
      set nextHopListValue [lindex $nextHopList $i]

      set routeFlapDropTimeListValue [lindex $routeFlapDropTimeList $i]
      set routeFlapTimeListValue [lindex $routeFlapTimeList $i]
      set routesToFlapFromListValue [lindex $routesToFlapFromList $i]
      set routesToFlapToListValue [lindex $routesToFlapToList $i]
      set linkFlapDropTimeValue [lindex $linkFlapDropTime $i]
      set linkFlapTimeValue [lindex $linkFlapTime $i]
      set originatorId [lindex $originatorId $i]
      set rId [lindex $bgpId $i]

      <span class="comment-line">#set extendedcommunityValue [lindex $extendedcommunity $i]</span>
      set extendedcommunityValue $extendedcommunity
      if {[regexp $extendedcommunityValue &#34;true&#34;]} {
         set extendedcommunityListValue [lindex $extendedcommunityList $i]
      } else {
         set extendedcommunityListValue &#34;&#34;
      }
      
<span class="comment-line">#---- set the local as number of the bgp peer</span>

      <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the asPathListValue $asPathListValue, nextHopListValue $nextHopListValue&#34;

      set returnCode [<a name="::icetMakeInternalIpv6Peer(1)"><a href="./bgpv6.tcl.html#::icetMakeInternalIpv6Peer_1518">::icetMakeInternalIpv6Peer</a></a> -myIp $myIp1 -dutIp $dutIp -asNumber $asNumber \
          -ipNetworkList $ipNetworkListValue -routerId $rId \
          -fromPrefixList $fromPrefixListValue -thruPrefixList $thruPrefixListValue -numRoutesList $numRoutesListValue \
          -txPortId $txPortId -communityList $communityListValue -clusterList $clusterListValue -asTypeList $asTypeListValue \
          -medList $medListValue -asPathList $asPathListValue -originProtocolList $originProtocolListValue \
          -localPrefList $localPrefListValue -nextHopList $nextHopListValue -mode $modeListValue \
          -routeFlapDropTimeList $routeFlapDropTimeListValue -expcomList $expcomListValue \
          -routeFlapTimeList $routeFlapTimeListValue -routesToFlapFromList $routesToFlapFromListValue \
          -routesToFlapToList $routesToFlapToListValue -linkFlapDropTime $linkFlapDropTimeValue -extendedcommunity $extendedcommunityValue \
          -linkFlapTime $linkFlapTimeValue -originatorId $originatorId -extendedcommunityList $extendedcommunityListValue -4byteAs $4byteAs]
      if {$returnCode==-1} {
          return -code return testSkipped
      }

set neib [expr $i+1]
if {[bgp4Server  addNeighbor  neighbor$neib]} {
   <a name="::result_debug(42)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;error adding bgp neighbor $neib&#34;
}

if {![regexp -nocase &#34;false&#34; $4byteAs]} {
   bgp4Server  config -internalLocalAsNum4Byte $asNumber
} else {             
   bgp4Server  config -internalLocalAsNum $asNumber   
}
   if {[bgp4Server  set]} {
       <a name="::result_debug(43)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error setting bgp server&#34;
   }

}


   <span class="comment-line">#set IP address table</span>
   <a name="::setIpv6AddressTable(2)"><a href="./bgpv6.tcl.html#::setIpv6AddressTable_1828">::setIpv6AddressTable</a></a> $dutIp $numPeers $chas(1) $card(1) $port(1) $bgpServerMac

   <span class="comment-line">#port get $chas(1) $card(1) $port(1)</span>
   <span class="comment-line">#port config -name &#34;$numPeers Peers/[expr $numPeers * $rangePerPeer * $routePerRange] routes EBGP&#34;</span>
   <span class="comment-line">#port set $chas(1) $card(1) $port(1)</span>

   set myportList [list [format &#34;%s,%s,%s&#34; $chas(1) $card(1) $port(1)]]
   <a name="::result_debug(44)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Writing Configuration to Hardware...&#34;
   if {[<a name="::writeConfigToHardware(2)"><a href="./mapping.tcl.html#::writeConfigToHardware_148">::writeConfigToHardware</a></a> myportList]} {
      <a name="::result_debug(45)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error writing config to hardware&#34;
      return -code return testSkipped
   }
   if {![regexp -nocase &#34;false&#34; $4byteAs]} {
      <a name="::setIbgpAsnum(1)"><a href="./bgpv6.tcl.html#::setIbgpAsnum_2808">::setIbgpAsnum</a></a> $txPortId $asNumber
   }
}
	}
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: icetMakeExternalIpv6Peer</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:  Setup an external BGP ipv6 peer on the ixia protocol</span>
<span class="comment-line">#               server. Internal proc not exposed out of lib.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      set returnCode [icetMakeExternalIpv6Peer -myIp $myIp -dutIp $dutIp -asNumber $asNum \</span>
<span class="comment-line">#          -ipNetworkList $ipNetworkListValue \</span>
<span class="comment-line">#          -fromPrefixList $fromPrefixListValue -thruPrefixList $thruPrefixListValue -numRoutesList $numRoutesListValue \</span>
<span class="comment-line">#          -txPortId $txPortId -communityList $communityListValue -clusterList $clusterListValue -asTypeList $asTypeListValue \</span>
<span class="comment-line">#          -medList $medListValue -asPathList $asPathListValue -originProtocolList $originProtocolListValue \</span>
<span class="comment-line">#          -localPrefList $localPrefListValue \</span>
<span class="comment-line">#          -routeFlapDropTimeList $routeFlapDropTimeListValue \</span>
<span class="comment-line">#          -routeFlapTimeList $routeFlapTimeListValue -routesToFlapFromList $routesToFlapFromListValue \</span>
<span class="comment-line">#          -routesToFlapToList $routesToFlapToListValue -linkFlapDropTime $linkFlapDropTimeValue \</span>
<span class="comment-line">#          -linkFlapTime $linkFlapTimeValue]</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::icetMakeExternalIpv6Peer_1207">proc <a href="bgpv6.tcl-annot.html#::::icetMakeExternalIpv6Peer">::::icetMakeExternalIpv6Peer</a></a></strong> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> icetMakeExternalIpv6Peer $args {
     dutIp &#34;2000::1&#34;
     myIp &#34;2000::2&#34;
     asNumber &#34;9999&#34;
     routerId &#34;7.7.7.7&#34;
     ipNetworkList &#34;&#34;
     fromPrefixList &#34;&#34;
     thruPrefixList &#34;&#34;
     localPrefList &#34;&#34;
     numRoutesList &#34;&#34;
     originProtocolList &#34;&#34;
     txPortId  &#34;1&#34;
     communityList &#34;&#34;
     expcomList &#34;&#34;
     clusterList &#34;&#34;
     asTypeList &#34;&#34;
     mode &#34;&#34;
     asPathList &#34;&#34;
     medList &#34;&#34;
     atomicaggregateList &#34;&#34;
     routeFlapDropTimeList &#34;&#34;
     routeFlapTimeList &#34;&#34;
     routesToFlapFromList &#34;&#34;
     routesToFlapToList &#34;&#34;
     linkFlapDropTime &#34;&#34;
     linkFlapTime &#34;&#34;
     extendedcommunity &#34;false&#34;
     extendedcommunityList &#34;&#34;
     graceRestart &#34;&#34;
     graResTime &#34;&#34;
     graStaleTime &#34;&#34;
     4byteAs &#34;false&#34;
   }

   <a name="::result_debug(46)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;myIp=($myIp) dutIp=($dutIp)&#34;

   set index [llength $ipNetworkList]
   <a name="::result_debug(47)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;index = $index&#34;;
   if {[llength $fromPrefixList]!=$index || [llength $thruPrefixList]!=$index || [llength $numRoutesList]!=$index} {
      <a name="::result_debug(48)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in input args:fromPrefixList,thruPrefixList,numRoutesList,ipNetworkList should be same length&#34;
      return -1
   }
   for {set i 0} {$i&lt;$index} {incr i} {
       set ipNetwork [lindex $ipNetworkList $i]
       set fromPrefix [lindex $fromPrefixList $i]
       set thruPrefix [lindex $thruPrefixList $i]
       set numRoutes [lindex $numRoutesList $i]
       <span class="comment-line">#set ecom [lindex $extendedcommunity $i]</span>
       set ecom $extendedcommunity
       if {[regexp -nocase $ecom &#34;true&#34;]} {
         set extcom [lindex $extendedcommunityList $i]
       } else {
         set extcom &#34;&#34;
       }
       <a name="::result_debug(49)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ipNetwork $ipNetwork&#34;
       <a name="::result_debug(50)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;fromPrefix $fromPrefix&#34;
       <a name="::result_debug(51)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;thruPrefix $thruPrefix&#34;
       <a name="::result_debug(52)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numRoutes $numRoutes&#34;
       <a name="::result_debug(53)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ecom $ecom&#34;
       <a name="::result_debug(54)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;extcom $extcom&#34;

 <span class="comment-line">#---newely added for extended community</span>
        set param &#34;&#34;
        set valueLst &#34;&#34;
        set extcommunity &#34;&#34;
        if {($ecom == &#34;true&#34;) &amp;&amp; ($extcom != &#34;null&#34;)} {
           bgp4RouteItem clearExtendedCommunityList
           bgp4ExtendedCommunity setDefault
        foreach extcommunity $extcom {
        set param &#34;&#34;
        set valueLst &#34;&#34;
        set param [split $extcommunity :]
         if {[lindex $param 0] == &#34;rt&#34;} {
            bgp4ExtendedCommunity config -subType 2
         } else {
             bgp4ExtendedCommunity config -subType 3
         }
        if {[regexp {[0-9]+\.} [lindex $param 1]]} {
         bgp4ExtendedCommunity config -type 1
          set ipLst [split [lindex $param 1] &#34;.&#34;]
         foreach ip $ipLst {
          set value1 [<a name="::dectohex(1)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> $ip]
         if {[string length $value1] == 1} {
         lappend valueLst &#34;0$value1&#34;
         } elseif {[string length $value1] == 2} {
         lappend valueLst &#34;$value1&#34;
         }
        }
          set value2 [<a name="::dectohex(2)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> [lindex $param 2]]
         lappend valueLst [<a name="::conVal2Byte(1)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 2 $value2]
       } else {
         regexp {[0-9]+} [lindex $param 1] val
         set value1 [<a name="::dectohex(3)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> $val]
         set value2 [<a name="::dectohex(4)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> [lindex $param 2]]
         if [regexp -nocase &#34;L&#34; [lindex $param 1]] {
            bgp4ExtendedCommunity config -type 2
            lappend valueLst [<a name="::conVal2Byte(2)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 4 $value1]
            lappend valueLst [<a name="::conVal2Byte(3)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 2 $value2]
         } else {
            bgp4ExtendedCommunity config -type 0
            lappend valueLst [<a name="::conVal2Byte(4)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 2 $value1]
            lappend valueLst [<a name="::conVal2Byte(5)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 4 $value2]
         }
     }
       set valueLst [join $valueLst]
       <a name="::result_debug(55)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;value list is $valueLst&#34;
       bgp4ExtendedCommunity config -value  &#34;$valueLst&#34;
       bgp4RouteItem addExtendedCommunity
     }
  }
       bgp4RouteItem setDefault
       bgp4RouteItem config -ipType addressTypeIpV6
       bgp4RouteItem config -networkAddress $ipNetwork
       bgp4RouteItem config -fromPrefix $fromPrefix
       bgp4RouteItem config -thruPrefix $thruPrefix
       bgp4RouteItem config -numRoutes $numRoutes
       if {[llength $localPrefList]!=0} {
          set localPref [lindex $localPrefList $i]
          if {$localPref!=&#34;&#34;} {
             <a name="::result_debug(56)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;localPref $localPref&#34;
             bgp4RouteItem config -enableLocalPref 1
             bgp4RouteItem config -localPref $localPref
           }
       }

<span class="comment-line">#---newely added for mode</span>

       if {$mode != &#34;&#34;} {
       set modeType [lindex $mode $i]
       <a name="::result_debug(57)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;modeType $modeType&#34;
       if {$modeType == &#34;unicast&#34;} {
           bgp4RouteItem config -enableIncludeMulticast false
           bgp4RouteItem config -enableProperSafi false
           bgp4RouteItem config -enableTraditionalNlriUpdate true
          } else {
           bgp4RouteItem config -enableIncludeMulticast true
           bgp4RouteItem config -enableProperSafi true
           bgp4RouteItem config -enableTraditionalNlriUpdate false
      }
      }

       bgp4RouteItem config -enableNextHop 1
       bgp4RouteItem config -nextHopIpType addressTypeIpV6
       bgp4RouteItem config -nextHopIpAddress $myIp
       bgp4RouteItem config -originProtocol [lindex $originProtocolList $i]
       bgp4RouteItem config -enableRouteRange true
       if {[llength $communityList] != 0} {
           <span class="comment-line"># --- 65535:65281 = NO_EXPORT</span>
           set community1 [lindex $communityList $i]
           if {[llength $expcomList] != 0} {
           set expcom [lindex $expcomList $i]
           } else {
           set expcom &#34;null&#34;
          }

           if {($community1 != &#34;null&#34;) &amp;&amp; ($expcom == &#34;null&#34;)} {
               <a name="::result_debug(58)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;community1 $community1&#34;
               bgp4RouteItem config -enableCommunity  1
               bgp4RouteItem config -communityList $community1
           } elseif {($community1 != &#34;null&#34;) &amp;&amp; ($expcom != &#34;null&#34;) } {
            <a name="::result_debug(59)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;community1 $community1&#34;
            <a name="::result_debug(60)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;expcom $expcom&#34;
            <span class="comment-line">#expcom = 1 (NO_EXPORT)</span>
            <span class="comment-line">#expcom = 2 (NO_ADVERTISE)</span>
            <span class="comment-line">#expcom = 3 (NO_EXPORT_SUBCONFED)</span>
              if {$expcom ==1} {
               bgp4RouteItem config -enableCommunity  1
               bgp4RouteItem config -communityList &#34;$community1 65535:65281&#34;
               } elseif {$expcom ==2} {
               bgp4RouteItem config -enableCommunity  1
               bgp4RouteItem config -communityList &#34;$community1 65535:65282&#34;
              } else {
               bgp4RouteItem config -enableCommunity  1
               bgp4RouteItem config -communityList &#34;$community1 65535:65283&#34;
            }
         }
       }
       if {[llength $clusterList] != 0} {
           set cluster1 [lindex $clusterList $i]
           if {$cluster1 != &#34;null&#34;} {
               <a name="::result_debug(61)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cluster1 $cluster1&#34;
               bgp4RouteItem config -enableCluster 1
               bgp4RouteItem config -clusterList $cluster1
           }
       }
       bgp4RouteItem config -enableASPath  1
       bgp4AsPathItem setDefault
       if {[llength $asPathList]!=0} {
          set aslist [lindex $asPathList $i]
          set asSegmentTypes [lindex $asTypeList $i]
          if {$aslist!=&#34;&#34;} {
             set indice 0
             bgp4RouteItem clearASPathList
             foreach asType $asSegmentTypes {
                bgp4AsPathItem config -enableAsSegment true
                bgp4AsPathItem config -asSegmentType $asType
                if {[llength $asSegmentTypes]&gt;1} {
                   bgp4AsPathItem config -asList [lindex $aslist $indice]
                } else {
                   bgp4AsPathItem config -asList $aslist
                }
                incr indice
                if {[bgp4RouteItem addASPathItem]} {
                   <a name="::result_debug(62)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Adding AS_PATH item&#34;
                }
             }
          } else {
              bgp4AsPathItem config -enableAsSegment false
              bgp4AsPathItem config -asPathSeqList [list $asNumber 257 ]
              bgp4RouteItem clearASPathList    ;<span class="comment-line"># for ixia 3.5 version and above</span>
          }
       } else {
             bgp4AsPathItem config -enableAsSegment false
          bgp4AsPathItem config -asPathSeqList [list $asNumber 257 ]
          bgp4RouteItem clearASPathList    ;<span class="comment-line"># for ixia 3.5 version and above</span>
       }
       if {[llength $medList]!=0} {
           set med [lindex $medList $i]
           if {$med!=&#34;&#34;} {
               <a name="::result_debug(63)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;med $med&#34;
               bgp4RouteItem config -enableMED 1
               bgp4RouteItem config -med $med
           }
       }
       <span class="comment-line"># add ATomic aggregate</span>
       if {[llength $atomicaggregateList]!=0} {
           set aggregate [lindex $atomicaggregateList $i]
           if {$aggregate == 1} {
              bgp4RouteItem config -enableAtomicAggregate true
           } else {
              bgp4RouteItem config -enableAtomicAggregate false
           }
       }
       <span class="comment-line"># add route flap</span>
       set routeFlapDropTime [lindex $routeFlapDropTimeList $i]
       if {($routeFlapDropTime!=&#34;&#34;) &amp;&amp; ($routeFlapDropTime!=&#34;null&#34;)} {
           <a name="::result_debug(64)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;-Do route Flap&#34;
           set routeFlapTime [lindex $routeFlapTimeList $i]
           set routesToFlapFrom [lindex $routesToFlapFromList $i]
           set routesToFlapTo [lindex $routesToFlapToList $i]
           bgp4RouteItem config -enableRouteFlap 1
           bgp4RouteItem config -routeFlapDropTime $routeFlapDropTime
           bgp4RouteItem config -routeFlapTime $routeFlapTime
           bgp4RouteItem config -routesToFlapFrom $routesToFlapFrom
           bgp4RouteItem config -routesToFlapTo $routesToFlapTo
           bgp4RouteItem config -ipType addressTypeIpV6
       } else {
           bgp4RouteItem config -enableRouteFlap 0
       }
       set rr [expr $i +1]
       if {[bgp4Neighbor addRouteRange routeRange$rr]} {
           <a name="::result_debug(65)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Adding Route item&#34;
       }
   }
   bgp4Neighbor config  -type  bgp4NeighborExternal
   bgp4Neighbor config  -enable true
   bgp4Neighbor config -localIpAddress $myIp
   bgp4Neighbor config -rangeCount 1
   bgp4Neighbor config -dutIpAddress $dutIp
   bgp4Neighbor config -ipType addressTypeIpV6
   bgp4Neighbor config -enableBgpId true
   bgp4Neighbor config -bgpId $routerId

   if {![regexp -nocase &#34;false&#34; $4byteAs]} {
      bgp4Neighbor config -enable4ByteAsNumber $4byteAs
   }
   bgp4Neighbor config -localAsNumber $asNumber
   <span class="comment-line"># add link flap</span>
   if {$linkFlapDropTime!=&#34;&#34;} {
       bgp4Neighbor config -enableLinkFlap true
       bgp4Neighbor config -linkFlapDropTime $linkFlapDropTime
       bgp4Neighbor config -linkFlapTime $linkFlapTime
   } else {
       bgp4Neighbor config -enableLinkFlap false
   }
if {$graceRestart !=&#34;&#34;} {
    bgp4Neighbor config -enableGracefulRestart  true
    bgp4Neighbor config -restartTime $graResTime
    bgp4Neighbor config -staleTime   $graStaleTime
}

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: icetMakeInternalIpv6Peer</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:  Setup an internal BGP ipv6 peer on the ixia protocol server.</span>
<span class="comment-line">#               Internal proc not to be exposed out of lib.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      set returnCode [icetMakeInternalIpv6Peer -myIp $myIp -dutIp $dutIp -asNumber $asNumber \</span>
<span class="comment-line">#          -ipNetworkList $ipNetworkListValue \</span>
<span class="comment-line">#          -fromPrefixList $fromPrefixListValue -thruPrefixList $thruPrefixListValue -numRoutesList $numRoutesListValue \</span>
<span class="comment-line">#          -txPortId $txPortId -communityList $communityListValue -clusterList $clusterListValue -asTypeList $asTypeListValue \</span>
<span class="comment-line">#          -medList $medListValue -asPathList $asPathListValue -originProtocolList $originProtocolListValue \</span>
<span class="comment-line">#          -localPrefList $localPrefListValue -nextHopList $nextHopListValue \</span>
<span class="comment-line">#          -routeFlapDropTimeList $routeFlapDropTimeListValue \</span>
<span class="comment-line">#          -routeFlapTimeList $routeFlapTimeListValue -routesToFlapFromList $routesToFlapFromListValue \</span>
<span class="comment-line">#          -routesToFlapToList $routesToFlapToListValue -linkFlapDropTime $linkFlapDropTimeValue \</span>
<span class="comment-line">#          -linkFlapTime $linkFlapTimeValue]</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::icetMakeInternalIpv6Peer_1518">proc <a href="bgpv6.tcl-annot.html#::::icetMakeInternalIpv6Peer">::::icetMakeInternalIpv6Peer</a></a></strong> {args} {
   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> icetMakeInternalIpv6Peer $args {
     myIp &#34;200::2&#34;
     dutIp &#34;200::1&#34;
     asNumber &#34;9999&#34;
     routerId &#34;8.8.8.8&#34;
     ipNetworkList &#34;&#34;
     fromPrefixList &#34;&#34;
     thruPrefixList &#34;&#34;
     numRoutesList &#34;&#34;
     originProtocolList &#34;&#34;
     txPortId  &#34;1&#34;
     localPrefList &#34;&#34;
     communityList &#34;&#34;
     expcomList &#34;&#34;
     clusterList &#34;&#34;
     asTypeList &#34;&#34;
     mode &#34;&#34;
     asPathList &#34;&#34;
     medList &#34;&#34;
     nextHopList &#34;&#34;
     routeFlapDropTimeList &#34;&#34;
     routeFlapTimeList &#34;&#34;
     routesToFlapFromList &#34;&#34;
     routesToFlapToList &#34;&#34;
     linkFlapDropTime &#34;&#34;
     linkFlapTime &#34;&#34;
     originatorId &#34;&#34;
     extendedcommunity &#34;false&#34;
     extendedcommunityList &#34;&#34;
     4byteAs &#34;false&#34;
   }

   set index [llength $ipNetworkList]
   puts &#34;index = $index&#34;;
   if {[llength $fromPrefixList]!=$index || [llength $thruPrefixList]!=$index || [llength $numRoutesList]!=$index} {
      <a name="::result_debug(66)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in input args:fromPrefixList,thruPrefixList,numRoutesList,ipNetworkList should be same length&#34;
      return -1
   }

   for {set i 0} {$i &lt; $index} {incr i} {
       set ipNetwork [lindex $ipNetworkList $i]
       set fromPrefix [lindex $fromPrefixList $i]
       set thruPrefix [lindex $thruPrefixList $i]
       set numRoutes [lindex $numRoutesList $i]
       set nextHop [lindex $nextHopList $i]
       set origId [lindex $originatorId $i]
       <span class="comment-line">#set ecom [lindex $extendedcommunity $i]</span>
       set ecom $extendedcommunity
       if {[regexp -nocase $ecom &#34;true&#34;]} {
         set extcom [lindex $extendedcommunityList $i]
       } else {
         set extcom &#34;&#34;
       }
       <a name="::result_debug(67)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ipNetwork $ipNetwork&#34;
       <a name="::result_debug(68)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;fromPrefix $fromPrefix&#34;
       <a name="::result_debug(69)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;thruPrefix $thruPrefix&#34;
       <a name="::result_debug(70)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numRoutes $numRoutes&#34;
       <a name="::result_debug(71)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ecom $ecom&#34;
       <a name="::result_debug(72)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;extcom $extcom&#34;

 <span class="comment-line">#---newely added for extended community</span>
        set param &#34;&#34;
        set valueLst &#34;&#34;
        set extcommunity &#34;&#34;
        if {($ecom == &#34;true&#34;) &amp;&amp; ($extcom != &#34;null&#34;)} {
          puts &#34;#############*********** coming here ########*********&#34;
           bgp4RouteItem clearExtendedCommunityList
           bgp4ExtendedCommunity setDefault
        foreach extcommunity $extcom {
        set param &#34;&#34;
        set valueLst &#34;&#34;
        set param [split $extcommunity :]
         if {[lindex $param 0] == &#34;rt&#34;} {
            bgp4ExtendedCommunity config -subType 2
         } else {
             bgp4ExtendedCommunity config -subType 3
         }
        if {[regexp {[0-9]+\.} [lindex $param 1]]} {
         bgp4ExtendedCommunity config -type 1
          set ipLst [split [lindex $param 1] &#34;.&#34;]
         foreach ip $ipLst {
          set value1 [<a name="::dectohex(5)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> $ip]
         if {[string length $value1] == 1} {
         lappend valueLst &#34;0$value1&#34;
         } elseif {[string length $value1] == 2} {
         lappend valueLst &#34;$value1&#34;
         }
        }
          set value2 [<a name="::dectohex(6)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> [lindex $param 2]]
         lappend valueLst [<a name="::conVal2Byte(6)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 2 $value2]
       } else {
         regexp {[0-9]+} [lindex $param 1] val
         set value1 [<a name="::dectohex(7)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> $val]
         set value2 [<a name="::dectohex(8)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> [lindex $param 2]]
         if [regexp -nocase &#34;L&#34; [lindex $param 1]] {
            bgp4ExtendedCommunity config -type 2
            lappend valueLst [<a name="::conVal2Byte(7)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 4 $value1]
            lappend valueLst [<a name="::conVal2Byte(8)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 2 $value2]
         } else {
            bgp4ExtendedCommunity config -type 0
            lappend valueLst [<a name="::conVal2Byte(9)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 2 $value1]
            lappend valueLst [<a name="::conVal2Byte(10)"><a href="./bgpv6.tcl.html#::conVal2Byte_2749">::conVal2Byte</a></a> 4 $value2]
         }
     }

       set valueLst [join $valueLst]
       <a name="::result_debug(73)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;value list is $valueLst&#34;
       bgp4ExtendedCommunity config -value  &#34;$valueLst&#34;
       bgp4RouteItem addExtendedCommunity
     }
  }
       bgp4RouteItem setDefault
       bgp4RouteItem config -ipType addressTypeIpV6
       bgp4RouteItem config -asPathSetMode bgpRouteAsPathNoInclude
       bgp4RouteItem config -networkAddress $ipNetwork
       bgp4RouteItem config -fromPrefix $fromPrefix
       bgp4RouteItem config -thruPrefix $thruPrefix
       bgp4RouteItem config -numRoutes $numRoutes

<span class="comment-line">#---newely added for mode</span>

      if {$mode != &#34;&#34;} {
       set modeType [lindex $mode $i]
       <a name="::result_debug(74)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;modeType $modeType&#34;
       if {$modeType == &#34;unicast&#34;} {
           bgp4RouteItem config -enableIncludeMulticast false
           bgp4RouteItem config -enableProperSafi false
           bgp4RouteItem config -enableTraditionalNlriUpdate true
          } else {
           bgp4RouteItem config -enableIncludeMulticast true
           bgp4RouteItem config -enableProperSafi true
           bgp4RouteItem config -enableTraditionalNlriUpdate false
      }
      }

       bgp4RouteItem config -enableNextHop 1
       if {$nextHop!=&#34;&#34;} {
          <a name="::result_debug(75)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the nexthop $nextHop&#34;
          bgp4RouteItem config -nextHopIpType addressTypeIpV6
          bgp4RouteItem config -nextHopIpAddress $nextHop
	  bgp4RouteItem config -nextHopIpType addressTypeIpV6
          bgp4RouteItem config -nextHopMode 1
          bgp4RouteItem config -nextHopSetMode bgpRouteNextHopSetManually
       } else {
          bgp4RouteItem config -nextHopIpType addressTypeIpV6
          bgp4RouteItem config -nextHopIpAddress $myIp
       }
       if {$origId !=&#34;&#34;} {
          bgp4RouteItem config -enableOriginatorId true
          bgp4RouteItem config -originatorId $origId
       }
       set localPref [lindex $localPrefList $i]
       if {$localPref==&#34;&#34;} {
          set $localPref 0
       }
       <a name="::result_debug(76)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;localPref $localPref&#34;
       bgp4RouteItem config -enableLocalPref 1
       bgp4RouteItem config -localPref $localPref
       bgp4RouteItem config -originProtocol [lindex $originProtocolList $i]
       bgp4RouteItem config -enableRouteRange true
       if {[llength $communityList] != 0} {
           <span class="comment-line"># --- 65535:65281 = NO_EXPORT</span>
           set community1 [lindex $communityList $i]
           if {[llength $expcomList] != 0} {
           set expcom [lindex $expcomList $i]
           } else {
           set expcom &#34;null&#34;
          }

           if {($community1 != &#34;null&#34;) &amp;&amp; ($expcom == &#34;null&#34;)} {
               <a name="::result_debug(77)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;community1 $community1&#34;
               bgp4RouteItem config -enableCommunity  1
               bgp4RouteItem config -communityList $community1
           } elseif {($community1 != &#34;null&#34;) &amp;&amp; ($expcom != &#34;null&#34;) } {
            <a name="::result_debug(78)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;community1 $community1&#34;
            <a name="::result_debug(79)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;expcom $expcom&#34;
            <span class="comment-line">#expcom = 1 (NO_EXPORT)</span>
            <span class="comment-line">#expcom = 2 (NO_ADVERTISE)</span>
            <span class="comment-line">#expcom = 3 (NO_EXPORT_SUBCONFED)</span>
              if {$expcom ==1} {
               bgp4RouteItem config -enableCommunity  1
               bgp4RouteItem config -communityList &#34;$community1 65535:65281&#34;
               } elseif {$expcom ==2} {
               bgp4RouteItem config -enableCommunity  1
               bgp4RouteItem config -communityList &#34;$community1 65535:65282&#34;
              } else {
               bgp4RouteItem config -enableCommunity  1
               bgp4RouteItem config -communityList &#34;$community1 65535:65283&#34;
            }
         }
       }
       if {[llength $clusterList] != 0} {
           set cluster1 [lindex $clusterList $i]
           if {$cluster1 != &#34;null&#34;} {
               <a name="::result_debug(80)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cluster1 $cluster1&#34;
               bgp4RouteItem config -enableCluster 1
               bgp4RouteItem config -clusterList $cluster1
           }
       }

       bgp4RouteItem config -enableASPath  1
       bgp4AsPathItem setDefault
       if {[llength $asPathList]!=0} {
          set aslist [lindex $asPathList $i]
          set asSegmentTypes [lindex $asTypeList $i]
          if {$aslist!=&#34;&#34;} {
             set indice 0
             bgp4RouteItem clearASPathList
             foreach asType $asSegmentTypes {
                <a name="::result_debug(81)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the asType $asType and asList $aslist&#34;
                bgp4AsPathItem config -enableAsSegment true
                bgp4AsPathItem config -asSegmentType $asType
                if {[llength $asSegmentTypes]&gt;1} {
                   bgp4AsPathItem config -asList [lindex $aslist $indice]
                } else {
                   bgp4AsPathItem config -asList $aslist
                }
                incr indice
                if {[bgp4RouteItem addASPathItem]} {
                   <a name="::result_debug(82)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Adding AS_PATH item&#34;
                }
             }
          } else {
             bgp4AsPathItem config -enableAsSegment false
              bgp4AsPathItem config -asPathSeqList [list $asNumber 257 ]
<span class="comment-line">#              if {[bgp4RouteItem addASPathItem]} {</span>
<span class="comment-line">#                 result_debug &#34;Error Adding AS_PATH item&#34;</span>
<span class="comment-line">#              }</span>
             bgp4RouteItem clearASPathList    ;<span class="comment-line"># for ixia 3.5 version and above</span>
          }
          <span class="comment-line">#result_debug &#34;AS_PATH ($aslist)&#34;</span>
       } else {
             bgp4AsPathItem config -enableAsSegment false
          bgp4AsPathItem config -asPathSeqList [list $asNumber 257 ]
<span class="comment-line">#          if {[bgp4RouteItem addASPathItem]} {</span>
<span class="comment-line">#             result_debug &#34;Error Adding AS_PATH item&#34;</span>
<span class="comment-line">#          }</span>
         bgp4RouteItem                clearASPathList    ;<span class="comment-line"># for ixia 3.5 version and above</span>
       }

       if {[llength $medList]!=0} {
           set med [lindex $medList $i]
           if {$med!=&#34;&#34;} {
               <a name="::result_debug(83)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;med $med&#34;
               bgp4RouteItem config -enableMED 1
               bgp4RouteItem config -med $med
           }
       }
       <span class="comment-line"># add route flap</span>
       set routeFlapDropTime [lindex $routeFlapDropTimeList $i]
       if {($routeFlapDropTime!=&#34;&#34;) &amp;&amp; ($routeFlapDropTime != &#34;null&#34;)} {
           <a name="::result_debug(84)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;-Do route Flap&#34;
           set routeFlapTime [lindex $routeFlapTimeList $i]
           set routesToFlapFrom [lindex $routesToFlapFromList $i]
           set routesToFlapTo [lindex $routesToFlapToList $i]
           bgp4RouteItem config -enableRouteFlap 1
           bgp4RouteItem config -routeFlapDropTime $routeFlapDropTime
           bgp4RouteItem config -routeFlapTime $routeFlapTime
           bgp4RouteItem config -routesToFlapFrom $routesToFlapFrom
           bgp4RouteItem config -routesToFlapTo $routesToFlapTo
       } else {
           bgp4RouteItem config -enableRouteFlap 0
       }
       set rr [expr $i +1]
       if {[bgp4Neighbor addRouteRange routeRange$rr]} {
           <a name="::result_debug(85)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Adding Route item&#34;
       }
}
   
   bgp4Neighbor config  -type  bgp4NeighborInternal
   bgp4Neighbor config  -enable true
   if {![regexp -nocase &#34;false&#34; $4byteAs]} {
      bgp4Neighbor config -enable4ByteAsNumber $4byteAs
   }
   bgp4Neighbor config -ipType addressTypeIpV6
   bgp4Neighbor config -localIpAddress $myIp
   bgp4Neighbor config -rangeCount 1
   bgp4Neighbor config -dutIpAddress $dutIp
   bgp4Neighbor config -enableBgpId true
   bgp4Neighbor config -bgpId $routerId


   <span class="comment-line"># add link flap</span>
   if {$linkFlapDropTime!=&#34;&#34;} {
       bgp4Neighbor config -enableLinkFlap true
       bgp4Neighbor config -linkFlapDropTime $linkFlapDropTime
       bgp4Neighbor config -linkFlapTime $linkFlapTime
   } else {
       bgp4Neighbor config -enableLinkFlap false
   }

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: setIpV6AddressTable</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Setup an IPV6 address table in the ixia protocol server </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: gatewayIP count chas card port</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      setIpV6AddressTable 2000::1 100 1 1 1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::setIpv6AddressTable_1828">proc <a href="bgpv6.tcl-annot.html#::::setIpv6AddressTable">::::setIpv6AddressTable</a></a></strong> {gatewayIP count chas card port {macAddress &#34;&#34;} {vlanTag &#34;none&#34;} {multipleProt &#34;false&#34;}} {
   <span class="comment-line">#puts &#34;setIpAddressTable is deprecated, please use icetSetIpv6AddressTable&#34;</span>

   <a name="::result_debug(86)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Setting Addr Tbl Item...&#34;
   if {$multipleProt == &#34;false&#34; } {
      ipAddressTableItem setDefault
   }
   ipAddressTableItem config -fromIpAddress [<a name="::incrIpField(5)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $gatewayIP 4 1]
   if {$macAddress != &#34;&#34;} {
       if {$macAddress == &#34;default&#34;} {
           if {[<a name="::port(16)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port]} {
               error &#34;setIpAddressTable: port get $chas $card $port failed.&#34;
           }
           set macAddress [<a name="::port(17)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]
       }
   } else {
       set macAddress [<a name="::uniqMac(1)"><a href="./bgpv6.tcl.html#::uniqMac_1895">::uniqMac</a></a> $chas $card $port]
   }
   ipAddressTableItem config -fromMacAddress $macAddress
   ipAddressTableItem config -numAddresses $count
   if {$vlanTag !=&#34;none&#34;} {
      ipAddressTableItem           config            -enableVlan                         true
      ipAddressTableItem           config            -vlanId                             $vlanTag
    }
   if [ipAddressTableItem set] {
      <a name="::result_debug(87)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Setting IP Address Table Item&#34;
   }
   
   <a name="::result_debug(88)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Setting Addr Table...&#34;
   ipAddressTable setDefault
   <span class="comment-line">#ipAddressTable config -defaultGateway $gatewayIP</span>
   if [ipAddressTable addItem] {
      <a name="::result_debug(89)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Adding IPv6 Address Table Item&#34;
   }
   if [ipAddressTable set $chas $card $port] {
      <a name="::result_debug(90)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Setting IPv6 Address Table&#34;
   }
   <a name="::result_debug(91)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Configuring Protocol Server on $chas $card $port&#34;
   if {$multipleProt == &#34;false&#34; } {
   protocolServer setDefault
   }
   protocolServer config -enablePingResponse 1
   protocolServer config -enableArpResponse 1
   protocolServer config -enableBgp4Service 1
   if [protocolServer set $chas $card $port] {
      <a name="::result_debug(92)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Setting Protocol Server&#34;
   }
   <a name="::result_debug(93)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Default Gateway: [ipAddressTable cget -defaultGateway]&#34;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: uniqMac</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  format 3 hex bytes into a specific MAC format</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: ch ca po</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: &#34;6a be [format &#34;%02x %02x %02x&#34; $ch $ca $po] 00&#34;</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#       uniqMac 11 22 33</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::uniqMac_1895">proc <a href="bgpv6.tcl-annot.html#::::uniqMac">::::uniqMac</a></a></strong> {ch ca po} { 
   return &#34;6a be [format &#34;%02x %02x %02x&#34; $ch $ca $po] 00&#34;
}

<span class="comment-line">#####################################################################################################</span>
<span class="comment-line">#if 0 {</span>
<span class="comment-line">##</span>
<span class="comment-line">## New Functions for XOS</span>
<span class="comment-line">##</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPv6Messages</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the BGP Messages from a frame received</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: List of BGP Messages in ixia raw frame format</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     set bgpMsgs [GetBGPMessages $frame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
if {0} {
<strong><a name="::::GetBGPv6Messages_1922">proc <a href="bgpv6.tcl-annot.html#::::GetBGPv6Messages">::::GetBGPv6Messages</a></a></strong> {rawFrame} {

   set rtnMsgs &#34;&#34;
   set type [string range $rawFrame 36 40]

   <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
   if {$type == &#34;86 DD&#34;} {
      set IpType [string range $rawFrame 60 61]
<span class="comment-line">#result_debug &#34;the rawFrame is $rawFrame&#34;</span>
<span class="comment-line">#result_debug &#34;the IpType is $IpType&#34;</span>
      if { $IpType == &#34;06&#34; } {
         set srcPort [<a name="::GetIPv6SourcePort(3)"><a href="./bgpv6.tcl.html#::GetIPv6SourcePort_240">::GetIPv6SourcePort</a></a> $rawFrame]
         set dstPort [<a name="::GetIPv6DestPort(3)"><a href="./bgpv6.tcl.html#::GetIPv6DestPort_271">::GetIPv6DestPort</a></a> $rawFrame]
         <a name="::result_debug(94)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The srcPort $srcPort and dstPort $dstPort&#34;
         if {$srcPort==&#34;179&#34;||$dstPort==&#34;179&#34;} {
            set macHdrLen 14
            set ipHdrLen 40
            set ipLenPos 18
            set bgpMakerLen 16
            set ipLen [<a name="::GetShortIntOffset(5)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame [expr ($ipLenPos * 3)]]
            set ipLen [expr ($ipLen + 40)]
<span class="comment-line">#           result_debug &#34;The ipLen $ipLen&#34;</span>
            set tcpLenPos [expr (66 * 3)]
            set tcpHdrLen [expr ([<a name="::hextodec(2)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $rawFrame $tcpLenPos $tcpLenPos]] * 4)]
 <span class="comment-line">#           result_debug &#34;The tcpHdrLen $tcpHdrLen&#34;</span>
            set ipOffset [ expr ($ipHdrLen + $tcpHdrLen)]
  <span class="comment-line">#          result_debug &#34;The ipOffset $ipOffset&#34;</span>
            while {$ipOffset &lt; $ipLen} {
               set bgpLengthPos [expr (14 + 16 + $ipOffset) * 3]
               set bgpLength [<a name="::GetShortIntOffset(6)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame $bgpLengthPos]
<span class="comment-line">#result_debug &#34;The bgpLength $bgpLength&#34;</span>
               set b_start [expr (($ipOffset +14 ) * 3)]
               set b_end [expr ($b_start + ([expr $bgpLength * 3]) - 2)]
<span class="comment-line">#result_debug &#34;The b_start is $b_start&#34;</span>
<span class="comment-line">#result_debug &#34;The b_end is $b_end&#34;</span>
               lappend rtnMsgs [string range $rawFrame $b_start $b_end]
<span class="comment-line">#result_debug &#34;The rtnMsgs is $rtnMsgs&#34;</span>
               set ipOffset [expr ($ipOffset + $bgpLength)]
            }
         }
      }
   }
<span class="comment-line">#   result_debug &#34;bgpMsgs: $rtnMsgs&#34;</span>
   return $rtnMsgs
}
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPMsgTypes</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the BGP Message Types from a list of BGP</span>
<span class="comment-line">#     messages which is obtained from raw frame via GetBGPMesssges</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: list of BGP Messages</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: List of BGP Message types</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    set bgpMsgs [GetBGPMessages $frame]</span>
<span class="comment-line">#    set bgpMsgTypes [GetBGPMsgTypes $$bgpMsgs]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPMsgTypes_1987">proc <a href="bgpv6.tcl-annot.html#::::GetBGPMsgTypes">::::GetBGPMsgTypes</a></a></strong> {bgpMsgs} {
   set rtnTypes &#34;&#34;
   foreach bgpMsg $bgpMsgs {
      set bgpTypeOffset 18
      set bgpTypePos [expr ($bgpTypeOffset * 3)]
      set bgpType [<a name="::GetByteOffset(2)"><a href="./MessageDecoding.tcl.html#::GetByteOffset_789">::GetByteOffset</a></a> $bgpMsg $bgpTypePos]
      switch -- $bgpType \
      &#34;1&#34;  {
         lappend rtnTypes &#34;IP_BGPv4_OPEN&#34;
      }  &#34;2&#34;  {
         lappend rtnTypes &#34;IP_BGPv4_UPDATE&#34;
      }  &#34;3&#34;  {
         lappend rtnTypes &#34;IP_BGPv4_NOTIFICATION&#34;
      }  &#34;4&#34;  {
         lappend rtnTypes &#34;IP_BGPv4_KEEPALIVE&#34;
      }  default  {
         lappend rtnTypes &#34;IP_TCP&#34;
      }
   }
<span class="comment-line">#   result_debug &#34;bgpMsgTypes: $rtnTypes&#34;</span>
   return $rtnTypes
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPNotificationErrorCodes</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the BGP Notification Error Codes from </span>
<span class="comment-line">#     a list of BGP messages which is obtained from raw frame via GetBGPMesssges</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: list of BGP Messages</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: List of BGP Notificaton Error Codes/Subcodes</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    set bgpMsgs [GetBGPMessages $frame]</span>
<span class="comment-line">#    set bgpNotifErrCodes [GetBGPNotificationErrorCodes $$bgpMsgs]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPNotificationErrorCodes_2028">proc <a href="bgpv6.tcl-annot.html#::::GetBGPNotificationErrorCodes">::::GetBGPNotificationErrorCodes</a></a></strong> {bgpMsgs} {
   set rtnCodes &#34;&#34;
   foreach bgpMsg $bgpMsgs {
      set bgpTypeOffset 18
      set bgpTypePos [expr ($bgpTypeOffset * 3)]
      set bgpType [<a name="::GetByteOffset(3)"><a href="./MessageDecoding.tcl.html#::GetByteOffset_789">::GetByteOffset</a></a> $bgpMsg $bgpTypePos]
      switch -- $bgpType \
      &#34;3&#34;  {
         set bgpCodeOffset 19
	 set bgpCodePos [expr ($bgpCodeOffset * 3)]
         set bgpCode [<a name="::GetByteOffset(4)"><a href="./MessageDecoding.tcl.html#::GetByteOffset_789">::GetByteOffset</a></a> $bgpMsg $bgpCodePos]
         set bgpSubCodeOffset 20
	 set bgpSubCodePos [expr ($bgpSubCodeOffset * 3)]
         set bgpSubCode [<a name="::GetByteOffset(5)"><a href="./MessageDecoding.tcl.html#::GetByteOffset_789">::GetByteOffset</a></a> $bgpMsg $bgpSubCodePos]
	 lappend rtnCodes &#34;$bgpCode $bgpSubCode&#34;
      }
   }
<span class="comment-line">#   result_debug &#34;bgpNotificationCodes: $rtnCodes&#34;</span>
   return $rtnCodes
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPUpdateAttributes</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the BGP the specified attribute values from </span>
<span class="comment-line">#     a list of BGP messages which is obtained from raw frame via GetBGPMesssges</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: list of BGP Messages, and the attribute type</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: List of BGP the specified attribute values</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    set bgpMsgs [GetBGPMessages $frame]</span>
<span class="comment-line">#    set attriType 3</span>
<span class="comment-line">#    set bgpNextHops [GetBGPUpdateNextHops $$bgpMsgs $attriType]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPv6UpdateAttributes_2068">proc <a href="bgpv6.tcl-annot.html#::::GetBGPv6UpdateAttributes">::::GetBGPv6UpdateAttributes</a></a></strong> {bgpMsgs attrType} {
<span class="comment-line">#   result_debug &#34;bgpMsgs: $bgpMsgs&#34;</span>
   set rtnAttrs &#34;&#34;
   foreach bgpMsg $bgpMsgs {
      <a name="::result_debug(95)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;bgpMsg: $bgpMsg&#34;
      set bgpTypeOffset 18
      set bgpTypePos [expr ($bgpTypeOffset * 3)]
      set bgpType [<a name="::GetByteOffset(6)"><a href="./MessageDecoding.tcl.html#::GetByteOffset_789">::GetByteOffset</a></a> $bgpMsg $bgpTypePos]
      <a name="::result_debug(96)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;bgpType: $bgpType&#34;
      switch -- $bgpType \
      &#34;2&#34;  {
	 set bgpUFRLOffset 19
	 set bgpUFRLPos [expr ($bgpUFRLOffset * 3)]
         set bgpUFRL [<a name="::GetShortIntOffset(7)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $bgpMsg $bgpUFRLPos]
         set bgpPALOffset [expr (21 + $bgpUFRL)]     ;<span class="comment-line"># path attr length field</span>
	 set bgpPALPos [expr ($bgpPALOffset * 3)]
         set bgpPAL [<a name="::GetShortIntOffset(8)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $bgpMsg $bgpPALPos]
	 set bgpPAOffset [expr ($bgpPALOffset + 2)]
	 set paOffset 0
	 <a name="::result_debug(97)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;bgpPAL: $bgpPAL, bgpPAOffset: $bgpPAOffset&#34;
	 while {$paOffset &lt; $bgpPAL} {
	    set typeOffset [expr $paOffset + 1]
	    set typePos [expr (($typeOffset + $bgpPAOffset) * 3)]
            set type [<a name="::GetByteOffset(7)"><a href="./MessageDecoding.tcl.html#::GetByteOffset_789">::GetByteOffset</a></a> $bgpMsg $typePos]
	    set lengthOffset [expr $typeOffset + 1]
	    set lengthPos [expr (($lengthOffset + $bgpPAOffset) * 3)]
            set length [<a name="::GetByteOffset(8)"><a href="./MessageDecoding.tcl.html#::GetByteOffset_789">::GetByteOffset</a></a> $bgpMsg $lengthPos]
            set length1 [<a name="::GetShortIntOffset(9)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $bgpMsg $lengthPos]
            set attrOffset [expr $paOffset + 3]
            set b_start [expr (($attrOffset + $bgpPAOffset) * 3)]
            <span class="comment-line">#result_debug &#34;b_start is $b_start&#34;</span>
            <span class="comment-line">#result_debug &#34;type is $type&#34;</span>
            <span class="comment-line">#result_debug &#34;attrType is $attrType&#34;</span>
            <span class="comment-line">#result_debug &#34;length is $length&#34;</span>
            <span class="comment-line">#result_debug &#34;length1 is $length1&#34;</span>
	    if {$type == $attrType } {
               switch -- $attrType \
      	       &#34;14&#34;  {
                  set length [expr $length1 + 2]
                  set b_start1 [expr $b_start + 15]
                 <span class="comment-line"># result_debug &#34;b_start1 is $b_start1&#34;</span>
                  set b_start [string trimright $b_start1]
                 <span class="comment-line"># result_debug &#34;b_start is $b_start&#34;</span>
                  set attr [<a name="::GetIPv6AddressOffset(1)"><a href="./bgpv6.tcl.html#::GetIPv6AddressOffset_2148">::GetIPv6AddressOffset</a></a> $bgpMsg $b_start]
                  lappend rtnAttrs $attr
	       } &#34;4&#34; {
                  set attr [<a name="::GetIntOffset(1)"><a href="./MessageDecoding.tcl.html#::GetIntOffset_854">::GetIntOffset</a></a> $bgpMsg $b_start]
	          lappend rtnAttrs $attr
	       } &#34;8&#34; {
                  set b_end [expr (($attrOffset + $bgpPAOffset + $length) * 3)- 2]
                  set attr [string range $bgpMsg $b_start $b_end]
	          lappend rtnAttrs $attr
               }
	    }
	    <a name="::result_debug(98)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;type, length, attr Offset: $typeOffset, $lengthOffset, $attrOffset&#34;
	    set paOffset [expr $paOffset + $length + 3]
	 }
      }
   }
   <a name="::result_debug(99)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;bgpUpdateAttributes: $rtnAttrs&#34;
   return $rtnAttrs
}

<span class="comment-line">################################################################# </span>
<span class="comment-line"># Procedure Name: GetIPAddressOffset</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the ip address of the form a.b.c.d a</span>
<span class="comment-line">#     given offset value from a rawFrame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame: Hex data to scan from, offsetStart:Start of the offset to get bytes from</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return Value: IpAddress</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># GetIPAddressOffset asciiHexData offsetStart</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetIPv6AddressOffset_2148">proc <a href="bgpv6.tcl-annot.html#::::GetIPv6AddressOffset">::::GetIPv6AddressOffset</a></a></strong> { rawFrame offsetStart} {
   <a name="::result_debug(100)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rawFrame: $rawFrame&#34;
   <a name="::result_debug(101)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;offsetStart: $offsetStart&#34;
   set offsetEnd [expr $offsetStart + 46]
   <a name="::result_debug(102)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;offsetEnd: $offsetEnd&#34; 
   set IP [string range $rawFrame $offsetStart $offsetEnd]
   puts &#34;IPAddress:$IP&#34;   
   return $IP
}


<span class="comment-line">##################################################</span>

<span class="comment-line">## NEW Functions added for EXOS from EWARE </span>

<span class="comment-line">##################################################</span>


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPUpdateLengths</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:  Parse Update Length from a BGP update frame</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: updateLengths</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#        GetBGPUpdateLengths $rawFrame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPUpdateLengths_2183">proc <a href="bgpv6.tcl-annot.html#::::GetBGPUpdateLengths">::::GetBGPUpdateLengths</a></a></strong> {rawFrame} {
   set messageType [<a name="::GetMessageType(1)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set updateLengths &#34;&#34;
   if {$messageType==&#34;IP_BGPv4_UPDATE&#34;} {
      set type [string range $rawFrame 36 40]
      <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
      if {$type == &#34;81 00&#34;} {
        set leftRawFrame [string range $rawFrame 0 35]
        set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
        set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
      }
      set routeRangeLength [<a name="::GetShortIntOffset(10)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 210]   ;<span class="comment-line"># This serves as</span>
 first route range length
      lappend updateLengths $routeRangeLength
      set bgpMarker 162  ;<span class="comment-line"># BGP packet starts at 162 in IP_TCP packet</span>
      for {set startLoc $bgpMarker} {[expr $startLoc+[expr $routeRangeLength*3]]
&lt;=[expr [string length $rawFrame]-12]} {incr startLoc [expr $routeRangeLength*3]
} {
         set routeRangeLength [<a name="::GetShortIntOffset(11)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame [expr $startLoc+[expr
 $routeRangeLength*3]+48]]
<span class="comment-line">#         result_debug &#34;the updateLengths $updateLengths and routeRangeLength $r</span>
outeRangeLength"
         lappend updateLengths $routeRangeLength
      }
   }
   return $updateLengths
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPUpdatePathAttributeLength</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:  Parse BGP Update path attribute length from a</span>
<span class="comment-line">#               BGP update frame</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: pathAttributeLengths</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       GetBGPUpdatePathAttributeLength $rawFrame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPUpdatePathAttributeLength_2228">proc <a href="bgpv6.tcl-annot.html#::::GetBGPUpdatePathAttributeLength">::::GetBGPUpdatePathAttributeLength</a></a></strong> {rawFrame} {
   set messageType [<a name="::GetMessageType(2)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set pathAttributeLengths &#34;&#34;
   if {$messageType==&#34;IP_BGPv4_UPDATE&#34;} {
      set type [string range $rawFrame 36 40]
      <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
      if {$type == &#34;81 00&#34;} {
        set leftRawFrame [string range $rawFrame 0 35]
        set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
        set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
      }
      set routeLengths [<a name="::GetBGPUpdateLengths(1)"><a href="./bgpv6.tcl.html#::GetBGPUpdateLengths_2183">::GetBGPUpdateLengths</a></a> $rawFrame]
      set unfeasibleRoutesLen [<a name="::GetShortIntOffset(12)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 219]
      set pathAttributeLength [<a name="::GetShortIntOffset(13)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame [expr 210+15+[expr $u
nfeasibleRoutesLen*3]]]   ;<span class="comment-line"># This serves as first path attribute length</span>
      lappend pathAttributeLengths $pathAttributeLength
      set bgpMarker 162  ;<span class="comment-line"># BGP packet starts at 162 in IP_TCP packet</span>
      set i 0
      set routeRangeLength [lindex $routeLengths $i]
      <a name="::result_debug(103)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the pathAttributeLength $pathAttributeLength and routeRangeL
ength $routeRangeLength&#34;
      for {set startLoc $bgpMarker} {[expr $startLoc+[expr $routeRangeLength*3]]
&lt;=[expr [string length $rawFrame]-12]} {incr startLoc [expr $routeRangeLength*3]
} {
         incr i
         set pathAttributeLength [<a name="::GetShortIntOffset(14)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame [expr $startLoc+48
+15]]
         set routeRangeLength [lindex $routeLengths $i]
         <a name="::result_debug(104)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the pathAttributeLength $pathAttributeLength and routeRan
geLength $routeRangeLength and startLoc $startLoc&#34;
         lappend pathAttributeLengths $pathAttributeLength
      }
   }
   return $pathAttributeLengths
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPUpdateTypeCodes</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:  Parse BGP typecodes from a frame</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: typeCodeList</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       GetBGPUpdateTypeCodes $rawFrame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPUpdateTypeCodes_2281">proc <a href="bgpv6.tcl-annot.html#::::GetBGPUpdateTypeCodes">::::GetBGPUpdateTypeCodes</a></a></strong> {rawFrame} {
   set messageType [<a name="::GetMessageType(3)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set typeCodeList &#34;&#34;
   if {$messageType==&#34;IP_BGPv4_UPDATE&#34;} {
      set type [string range $rawFrame 36 40]
      <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
      if {$type == &#34;81 00&#34;} {
        set leftRawFrame [string range $rawFrame 0 35]
        set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
        set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
      }
      set routeLengths [<a name="::GetBGPUpdateLengths(2)"><a href="./bgpv6.tcl.html#::GetBGPUpdateLengths_2183">::GetBGPUpdateLengths</a></a> $rawFrame]
      set attribLengths [<a name="::GetBGPUpdatePathAttributeLength(1)"><a href="./bgpv6.tcl.html#::GetBGPUpdatePathAttributeLength_2228">::GetBGPUpdatePathAttributeLength</a></a> $rawFrame]
      <a name="::result_debug(105)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the routeLengths $routeLengths and attribLengths $attribLeng
ths&#34;
      set unfeasibleRoutesLen [<a name="::GetShortIntOffset(15)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 219]
      set typeCodeStart [expr 210+24+[expr $unfeasibleRoutesLen*3]]
      for {set i 0} {$i&lt;[llength $routeLengths]} {incr i} {
         set routeLength [lindex $routeLengths $i]
         set attribLength [lindex $attribLengths $i]
         set j $typeCodeStart
         set typeCodes &#34;&#34;
         while {$j&lt;[expr $typeCodeStart+[expr $attribLength*3]]} {
            lappend typeCodes [<a name="::hextodec(3)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $rawFrame $j [expr $j+1]]]
            set attribDataLength [<a name="::hextodec(4)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $rawFrame [expr $j+3] [
expr $j+4]]]
            incr j [expr [expr $attribDataLength+1+1+1]*3]   ;<span class="comment-line"># 1 byte for lengt</span>
h field, 1 for attrib flags
            <span class="comment-line">#result_debug &#34;the typeCodes $typeCodes, attribDataLength $attribDat</span>
aLength and j $j&#34;
         }
         set typeCodeStart [expr [expr $routeLength*3]+$typeCodeStart]
         lappend typeCodeList $typeCodes
         <span class="comment-line">#result_debug &#34;the typeCodeStart is $typeCodeStart now and typeCodeList</span>
 $typeCodeList&#34;
      }
   }
   return $typeCodeList
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPUpdateNextHops</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:  Parse BGP next hop info from a frame</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: nextHops</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      GetBGPUpdateNextHops $rawFrame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPUpdateNextHops_2338">proc <a href="bgpv6.tcl-annot.html#::::GetBGPUpdateNextHops">::::GetBGPUpdateNextHops</a></a></strong> {rawFrame} {
   set messageType [<a name="::GetMessageType(4)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set nextHops &#34;&#34;
   if {$messageType==&#34;IP_BGPv4_UPDATE&#34;} {
      set type [string range $rawFrame 36 40]
      <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
      if {$type == &#34;81 00&#34;} {
        set leftRawFrame [string range $rawFrame 0 35]
        set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
        set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
      }
      set routeLengths [<a name="::GetBGPUpdateLengths(3)"><a href="./bgpv6.tcl.html#::GetBGPUpdateLengths_2183">::GetBGPUpdateLengths</a></a> $rawFrame]
      set attributeTypeCodes [<a name="::GetBGPUpdateTypeCodes(1)"><a href="./bgpv6.tcl.html#::GetBGPUpdateTypeCodes_2281">::GetBGPUpdateTypeCodes</a></a> $rawFrame]
      set nexthopStartLoc 252    ;<span class="comment-line"># First attt type found at 252 in a IP_TCP_BGP</span>
 packet
      set startLoc 210
      <a name="::result_debug(106)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the routeLengths $routeLengths and attributeTypeCodes $attri
buteTypeCodes&#34;
      for {set i 0} {$i&lt;[llength $routeLengths]} {incr i} {
         foreach typeCode [lindex $attributeTypeCodes $i] {
            if {$typeCode==3} {    ;<span class="comment-line"># if attribute is next hop</span>
               lappend nextHops [<a name="::GetIPAddressOffset(1)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame [expr $nexthopStar
tLoc]]
               set nexthopStartLoc [expr $startLoc+[expr [lindex $routeLengths $
i]*3]+42]
               <a name="::result_debug(107)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the nextHops $nextHops and nexthopStartLoc $nexthop
StartLoc&#34;
               incr startLoc [expr [lindex $routeLengths $i]*3]
            }
         }
      }
   }
   return $nextHops
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPUpdateMEDs</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Parse BGP MED info from a frame</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: meds</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#        GetBGPUpdateMEDs $rawFrame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPUpdateMEDs_2390">proc <a href="bgpv6.tcl-annot.html#::::GetBGPUpdateMEDs">::::GetBGPUpdateMEDs</a></a></strong> {rawFrame} {
   set messageType [<a name="::GetMessageType(5)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set meds &#34;&#34;
   if {$messageType==&#34;IP_BGPv4_UPDATE&#34;} {
      set type [string range $rawFrame 36 40]
      <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
      if {$type == &#34;81 00&#34;} {
        set leftRawFrame [string range $rawFrame 0 35]
        set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
        set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
      }
      set routeLengths [<a name="::GetBGPUpdateLengths(4)"><a href="./bgpv6.tcl.html#::GetBGPUpdateLengths_2183">::GetBGPUpdateLengths</a></a> $rawFrame]
      set attributeTypeCodes [<a name="::GetBGPUpdateTypeCodes(2)"><a href="./bgpv6.tcl.html#::GetBGPUpdateTypeCodes_2281">::GetBGPUpdateTypeCodes</a></a> $rawFrame]
      set medStartLoc 252    ;<span class="comment-line"># First attr type found at 252 in a IP_TCP_BGP pac</span>
ket
      set startLoc 210
      <a name="::result_debug(108)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the routeLengths $routeLengths and attributeTypeCodes $attri
buteTypeCodes&#34;
      for {set i 0} {$i&lt;[llength $routeLengths]} {incr i} {
         foreach typeCode [lindex $attributeTypeCodes $i] {
            if {$typeCode==4} {    ;<span class="comment-line"># if attribute is med</span>
               lappend meds [<a name="::GetIntOffset(2)"><a href="./MessageDecoding.tcl.html#::GetIntOffset_854">::GetIntOffset</a></a> $rawFrame [expr $medStartLoc]]
               set medStartLoc [expr $startLoc+[expr [lindex $routeLengths $i]*3
]+42]
               <a name="::result_debug(109)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the meds $meds and medStartLoc $medStartLoc&#34;
               incr startLoc [expr [lindex $routeLengths $i]*3]
            }
         }
      }
   }
   return $meds
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPUpdateCommunities</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Parse BGP Community info from a frame</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: communityAtt</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         GetBGPUpdateCommunities $rawFrame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetBGPUpdateCommunities_2440">proc <a href="bgpv6.tcl-annot.html#::::GetBGPUpdateCommunities">::::GetBGPUpdateCommunities</a></a></strong> {rawFrame} {
   set messageType [<a name="::GetMessageType(6)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set communityAtt &#34;&#34;
   if {$messageType==&#34;IP_BGPv4_UPDATE&#34;} {
      set type [string range $rawFrame 36 40]
      <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
      if {$type == &#34;81 00&#34;} {
        set leftRawFrame [string range $rawFrame 0 35]
        set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
        set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
      }
      set routeLengths [<a name="::GetBGPUpdateLengths(5)"><a href="./bgpv6.tcl.html#::GetBGPUpdateLengths_2183">::GetBGPUpdateLengths</a></a> $rawFrame]
      set attributeTypeCodes [<a name="::GetBGPUpdateTypeCodes(3)"><a href="./bgpv6.tcl.html#::GetBGPUpdateTypeCodes_2281">::GetBGPUpdateTypeCodes</a></a> $rawFrame]
      set comStartLoc 249    ;<span class="comment-line"># First attt type found at 249 in a IP_TCP_BGP pac</span>
ket
      set startLoc 210
      <a name="::result_debug(110)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the routeLengths $routeLengths and attributeTypeCodes $attri
buteTypeCodes&#34;
      for {set i 0} {$i&lt;[llength $routeLengths]} {incr i} {
         foreach typeCode [lindex $attributeTypeCodes $i] {
            if {$typeCode==8} {    ;<span class="comment-line"># if attribute is community</span>
               set attribLength [<a name="::hextodec(5)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $rawFrame $comStartLoc [
expr $comStartLoc+1]]]
               set communityAtt [string range $rawFrame [expr $comStartLoc+3] [e
xpr $comStartLoc+1+[expr $attribLength*3]]]
               <a name="::result_debug(111)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the communityAtt $communityAtt, attribLength $attri
bLength&#34;
            }
         }
      }
   }
   return $communityAtt
}



<span class="comment-line">#################################################################</span>
<span class="comment-line"># Procedure Name: GetBGPOpenAsNum</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Parse BGP AS Number from OPEN message</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: AS Number</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         GetBGPOpenAsNum $rawFrame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">################################################################</span>
<strong><a name="::::GetBGPOpenAsNum_2493">proc <a href="bgpv6.tcl-annot.html#::::GetBGPOpenAsNum">::::GetBGPOpenAsNum</a></a></strong> {frame} {
    set bgpframes [<a name="::GetBGPMessages(1)"><a href="./bgp.tcl.html#::GetBGPMessages_1856">::GetBGPMessages</a></a> $frame]
    set asNum &#34;&#34;
    set type [string range $frame 36 40]
       if {$type == &#34;08 00&#34;} {
	set asNum [<a name="::GetShortIntOffset(16)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $bgpframes 61]
        <a name="::result_debug(112)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The value of As Number is $asNum&#34;
	return $asNum
      }
}


<span class="comment-line">#################################################################</span>
<span class="comment-line"># Procedure Name : GetBGPGRCapability</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Decodes the BGP Graceful Restart(GR) Capability advertisement</span>
<span class="comment-line"># and returns a list of BGP GR capabilities </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: BGP Frame</span>
<span class="comment-line"># Return value: List of BGP GR capabilities</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         GetBGPGRCapability $bgpFrame </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::GetBGPGRCapability_2521">proc <a href="bgpv6.tcl-annot.html#::::GetBGPGRCapability">::::GetBGPGRCapability</a></a></strong> {bgpFrame} {
     global capList
     set capList &#34;&#34;

     if {[<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1 majmin] &gt;= &#34;12.1&#34; } {
     <a name="::GetBGPGRCapabilityFromZugspitz(1)"><a href="./bgpv6.tcl.html#::GetBGPGRCapabilityFromZugspitz_2669">::GetBGPGRCapabilityFromZugspitz</a></a> $bgpFrame
     return $capList
     
     } else {

     set BGPMarker [string range $bgpFrame 1 47]
     <a name="::result_debug(113)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPMarker :: $BGPMarker&#34;
     lappend capList $BGPMarker

     regsub -all &#34; &#34; [string range $bgpFrame 49 53] &#34;&#34; BGPOpenMesgLen
     <a name="::result_debug(114)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPOpenMesgLen :: [format &#34;%u&#34; &#34;0x$BGPOpenMesgLen&#34;]&#34;
     set BGPOpenMesgLen [format &#34;%u&#34; &#34;0x$BGPOpenMesgLen&#34;]
     lappend capList $BGPOpenMesgLen
     
     if { $BGPOpenMesgLen &lt;= 29 } {
        <a name="::result_debug(115)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP OPEN Message doesn't have any BGP GR capability advertisements&#34;
        return $capList
     } else {
        set BGPCapability [<a name="::hextodec(6)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 94 95]]
        <a name="::result_debug(116)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPCapability :: $BGPCapability&#34;
        lappend capList $BGPCapability

        set BGPGRMsgLen [<a name="::hextodec(7)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 97 98]]    
        <a name="::result_debug(117)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPGRMsgLen :: $BGPGRMsgLen&#34;
        lappend capList $BGPGRMsgLen

        set BGPRestartCap [<a name="::hextodec(8)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 100 101]]          
        <a name="::result_debug(118)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPRestartCap :: $BGPRestartCap&#34;
        lappend capList $BGPRestartCap
 
        set BGPRestartTime [<a name="::hextodec(9)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 103 104]]
        <a name="::result_debug(119)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPRestartTime :: $BGPRestartTime&#34;
        lappend capList $BGPRestartTime

        if {$BGPGRMsgLen &lt;= 2 } {
           <a name="::result_debug(120)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP GR Advertisement doesn't have any address family information&#34;
           return $capList
        } else {
           regsub -all &#34; &#34; [string range $bgpFrame 106 110] &#34;&#34; BGPAddrFamily
           <a name="::result_debug(121)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPAddrFamily :: [format &#34;%u&#34; &#34;0x$BGPAddrFamily&#34;]&#34;
           lappend capList &#34;[format &#34;%u&#34; &#34;0x$BGPAddrFamily&#34;]&#34;

           set BGPSAddrFamily [<a name="::hextodec(10)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 112 113]]
           <a name="::result_debug(122)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPSAddrFamily :: $BGPSAddrFamily&#34;
           lappend capList $BGPSAddrFamily

           set BGPAFFlags [string range $bgpFrame 115 116]
           <a name="::result_debug(123)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPAFFlags :: $BGPAFFlags&#34;
           lappend capList $BGPAFFlags
        }

     }  
     }

     return $capList
} 



<span class="comment-line">#################################################################</span>
<span class="comment-line"># Procedure Name : CheckBGPv6EndOfRIBUpdate</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Decodes the BGP IP_BGPv4_UPDATE frame and check for</span>
<span class="comment-line">#              whether it is a End-of-RIB BGP UPDATE message</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: BGP IP_BGPv4_UPDATE frame</span>
<span class="comment-line"># Return value: true/false</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         CheckBGPEndOfRIBUpdate_MBGP -frameList $rawframe -afi &#34;00 01&#34; -safi &#34;02&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">################################################################  </span>

<strong><a name="::::CheckBGPv6EndOfRIBUpdate_2601">proc <a href="bgpv6.tcl-annot.html#::::CheckBGPv6EndOfRIBUpdate">::::CheckBGPv6EndOfRIBUpdate</a></a></strong> {args} {
 <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckBGPv6EndOfRIBUpdate $args {
	frameList &#34;&#34;
	afi &#34;00 02&#34;
	safi &#34;01&#34;
}
   set returnType &#34;false&#34;

   <span class="comment-line"># ---- Get frame captured on the ixia port, check for End-of-RIB BGP UPDATE message</span>
   if { [llength $frameList] == 0 } {
      <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No Frames are captured&#34;
      return $returnType
   }

   foreach frame $frameList {
      <a name="::result_debug(124)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;frame :: $frame&#34;
      set bgpMsgs [<a name="::GetBGPv6Messages(1)"><a href="./bgpv6.tcl.html#::GetBGPv6Messages_1922">::GetBGPv6Messages</a></a> $frame]
      <a name="::result_debug(125)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;bgpMsgs :: $bgpMsgs&#34;
      set bgpMsgTypes [<a name="::GetBGPv6MsgTypes(1)"><a href="./bgpv6.tcl.html#::GetBGPv6MsgTypes_303">::GetBGPv6MsgTypes</a></a> $bgpMsgs]
      <a name="::result_debug(126)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;bgpMsgTypes :: $bgpMsgTypes&#34;
      <a name="::result_debug(127)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;bgpMsgs :: $bgpMsgs&#34;

      if {[lsearch -glob $bgpMsgTypes &#34;IP_BGPv6_UPDATE&#34;] &gt;= 0} {
         <a name="::result_debug(128)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP UPDATE Packet : $bgpMsgs&#34;

         foreach bgpMsg $bgpMsgs {
            <span class="comment-line"># --- Check that it is a End-of-RIB packet</span>
            <a name="::result_debug(129)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;RIB :: [string range $bgpMsg 63 64]&#34;
            <a name="::result_debug(130)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Type :: [string range $bgpMsg 66 67]&#34;
<span class="comment-line">#length of update message 30 byte ==1e in hex</span>
            if { ([string range $bgpMsg 63 64] == &#34;1E&#34;) &amp;&amp; ([string range $bgpMsg 66 67] == &#34;02&#34;) } {
		<a name="::result_debug(131)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The bgp frame is \n [string range $bgpMsg 48 90] \n\n&#34;
               set returnType &#34;true&#34;
		<a name="::result_debug(132)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;other than ipv4 address family, it is an UPDATE message that contains \
			only the MP_UNREACH_NLRI attribute with no withdrawn routes for that &lt;AFI, SAFI&gt; to indicate EOR&#34;
               <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Received update length = [string range $bgpMsg 63 64]&#34;
               return $returnType
	     } else {
		<a name="::result_debug(133)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Received path attir type for mp-unreachnlri:[string range $bgpMsg 72 73] \n&#34;
		<a name="::result_debug(134)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Received AFI is:[string range $bgpMsg 75 79] \n&#34;
		<a name="::result_debug(135)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Received SAFI is:[string range $bgpMsg 84 85]&#34;
		}
            }
         }
      }
   unset bgpMsgs
   unset bgpMsgTypes
   return $returnType
}

<span class="comment-line">#################################################################</span>
<span class="comment-line"># Procedure Name : GetBGPGRCapabilityFromZugspitz</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Decodes the BGP Graceful Restart(GR) Capability advertisement</span>
<span class="comment-line"># and returns a list of BGP GR capabilities. This proc supports decoding from </span>
<span class="comment-line"># Zugspitz ownwards for earlier builds use proc GetBGPGRCapability.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: BGP Frame</span>
<span class="comment-line"># Return value: List of BGP GR capabilities</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         GetBGPGRCapabilityFromZugspitz $bgpFrame </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">################################################################</span>


<strong><a name="::::GetBGPGRCapabilityFromZugspitz_2669">proc <a href="bgpv6.tcl-annot.html#::::GetBGPGRCapabilityFromZugspitz">::::GetBGPGRCapabilityFromZugspitz</a></a></strong> {bgpFrame} {
     global capList
 
     set BGPMarker [string range $bgpFrame 1 47]
     <a name="::result_debug(136)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPMarker :: $BGPMarker&#34;
     lappend capList $BGPMarker

     regsub -all &#34; &#34; [string range $bgpFrame 49 53] &#34;&#34; BGPOpenMesgLen
     <a name="::result_debug(137)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPOpenMesgLen :: [format &#34;%u&#34; &#34;0x$BGPOpenMesgLen&#34;]&#34;
     set BGPOpenMesgLen [format &#34;%u&#34; &#34;0x$BGPOpenMesgLen&#34;]
     lappend capList $BGPOpenMesgLen
     <a name="::result_debug(138)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;capList :: $capList&#34;
     
     if { $BGPOpenMesgLen &lt;= 50 } {
        <a name="::result_debug(139)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP OPEN Message doesn't have any BGP GR capability advertisements&#34;
        return $capList
     } else {
        set BGPCapability [<a name="::hextodec(11)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 166 167]]
        <a name="::result_debug(140)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPCapability :: $BGPCapability&#34;
        lappend capList $BGPCapability

        set BGPGRMsgLen [<a name="::hextodec(12)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 169 170]]    
        <a name="::result_debug(141)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPGRMsgLen :: $BGPGRMsgLen&#34;
        lappend capList $BGPGRMsgLen

        set BGPRestartCap [<a name="::hextodec(13)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 172 173]]          
        <a name="::result_debug(142)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPRestartCap :: $BGPRestartCap&#34;
        lappend capList $BGPRestartCap
 
        set BGPRestartTime [<a name="::hextodec(14)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 175 176]]
        <a name="::result_debug(143)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPRestartTime :: $BGPRestartTime&#34;
        lappend capList $BGPRestartTime

        if {$BGPGRMsgLen &lt;= 2 } {
           <a name="::result_debug(144)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP GR Advertisement doesn't have any address family information&#34;
           return $capList
        } else {
           regsub -all &#34; &#34; [string range $bgpFrame 178 182] &#34;&#34; BGPAddrFamily
           <a name="::result_debug(145)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPAddrFamily :: [format &#34;%u&#34; &#34;0x$BGPAddrFamily&#34;]&#34;
           lappend capList &#34;[format &#34;%u&#34; &#34;0x$BGPAddrFamily&#34;]&#34;

           set BGPSAddrFamily [<a name="::hextodec(15)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> [string range $bgpFrame 184 185]]
           <a name="::result_debug(146)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPSAddrFamily :: $BGPSAddrFamily&#34;
           lappend capList $BGPSAddrFamily

           set BGPAFFlags [string range $bgpFrame 187 188]
           <a name="::result_debug(147)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPAFFlags :: $BGPAFFlags&#34;
           lappend capList $BGPAFFlags
        }

     }  

     return $capList
} 

<strong><a name="::::BGPChangeConnRetTimer_2724">proc <a href="bgpv6.tcl-annot.html#::::BGPChangeConnRetTimer">::::BGPChangeConnRetTimer</a></a></strong> {dividerValue} {

global DUT1_CONNECT
global DUT2_CONNECT
global DUT3_CONNECT
global DUT4_CONNECT
global DUT5_CONNECT
global numDUT

set i 1
for {set i 1} {$i &lt;= $numDUT} {incr i} {
 global DUT${i}_CONNECT
if {[info exist DUT${i}_CONNECT]} { 
 <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${i}_CONNECT] 
 <a name="::EnableDebugMode(1)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
 <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;jerry configure bgp conn-retry-timer-divider $dividerValue&#34;
   
} else {
  break
}

}

}

<strong><a name="::::conVal2Byte_2749">proc <a href="bgpv6.tcl-annot.html#::::conVal2Byte">::::conVal2Byte</a></a></strong> {noBytes conValue} {
set x $noBytes
set a $conValue
set c [expr [string length $a] % 2]
set b [expr $x - [expr [string length $a] /2]-$c]

for {set i 1} {$i &lt;=$b} {incr i} {
lappend value &#34;00&#34;
}
if {$c} {
lappend value &#34;0[string range $a 0 0]&#34;
for {set i 1} {$i &lt; [string length $a]} {incr i 2} {
   lappend value [string range $a $i [expr $i +1]]
}
} else {

for {set i 0} {$i &lt; [string length $a]} {incr i 2} {
   lappend value [string range $a $i [expr $i +1]]
}
}
return $value
}


<strong><a name="::::setEbgpAsnum_2773">proc <a href="bgpv6.tcl-annot.html#::::setEbgpAsnum">::::setEbgpAsnum</a></a></strong> {txPortId numPeers asnumLst} {
   <a name="::MapIxiaPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
   set chas(1) $cha
   set card(1) $car
   set port(1) $por
   <a name="::result_debug(148)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Chas: $cha Card: $car Port: $por&#34;

   if {[bgp4Server select $chas(1) $card(1) $port(1)]} {
      <a name="::result_debug(149)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Connecting to bgp4Server&#34;
      return -code return testSkipped
   }

   for {set i 0} {$i&lt;$numPeers} {incr i} {
      set neib [expr $i+1]
      set asNumber [lindex $asnumLst $i]
      if [bgp4Server getNeighbor neighbor$neib] {
         ixPuts &#34;unable to get the neighborid for the server&#34;
      }
    set asnumconfig [bgp4Neighbor cget -localAsNumber]
    ixPuts &#34;the AS number conigured is $asnumconfig&#34;
    if {$asnumconfig != $asNumber} {
      bgp4Neighbor config -localAsNumber $asNumber
      bgp4Server setNeighbor neighbor$neib
    }
    if {[bgp4Server set]} {
      <a name="::result_debug(150)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error setting bgp server&#34;
    }

    if {[bgp4Server write]} {
           <a name="::result_debug(151)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error writing bgp server&#34;
    }

   }
}

<strong><a name="::::setIbgpAsnum_2808">proc <a href="bgpv6.tcl-annot.html#::::setIbgpAsnum">::::setIbgpAsnum</a></a></strong> {txPortId asNumber} {
   <a name="::MapIxiaPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
   set chas(1) $cha
   set card(1) $car
   set port(1) $por
   <a name="::result_debug(152)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Chas: $cha Card: $car Port: $por&#34;

   if {[bgp4Server select $chas(1) $card(1) $port(1)]} {
      <a name="::result_debug(153)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Connecting to bgp4Server&#34;
      return -code return testSkipped
   }
    set asnumconfig [bgp4Server cget -internalLocalAsNum4Byte]
    ixPuts &#34;the AS number conigured is $asnumconfig&#34;
    if {$asnumconfig != $asNumber} {
      bgp4Server config -internalLocalAsNum4Byte $asNumber
    }
    if {[bgp4Server set]} {
      <a name="::result_debug(154)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error setting bgp server&#34;
    }

    if {[bgp4Server write]} {
           <a name="::result_debug(155)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error writing bgp server&#34;
    }

}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name:GetBGPCapability</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the BGP capabilities from bgp open message.</span>
<span class="comment-line">#It has capability code in capTypes and the full cap message in capMessage.</span>
<span class="comment-line">#Parse capMessage to get the AFI/SAFI</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: BGP open message</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: List of capability codes</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    set bgpMsgs [GetBGPMessages $frame]</span>
<span class="comment-line">#   set capList [GetBGPCapability $bgpMsgs]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetBGPCapability_2855">proc <a href="bgpv6.tcl-annot.html#::::GetBGPCapability">::::GetBGPCapability</a></a></strong> {bgpFrame} {
    set capTypes &#34;&#34;
    global capMessage
    <span class="comment-line"># set capMessage &#34;&#34;</span>
    set BGPMarker [string range $bgpFrame 1 47]
    <a name="::result_debug(156)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPMarker :: $BGPMarker&#34;
    regsub -all &#34; &#34; [string range $bgpFrame 49 53] &#34;&#34; BGPOpenMesgLen
    <a name="::result_debug(157)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGPOpenMesgLen :: [format &#34;%u&#34; &#34;0x$BGPOpenMesgLen&#34;]&#34;
    set BGPOpenMesgLen [format &#34;%u&#34; &#34;0x$BGPOpenMesgLen&#34;]
    <span class="comment-line">#puts &#34;There are [string length $bgpFrame] characters&#34;</span>
    if { $BGPOpenMesgLen &lt;= 29 } {
        puts &#34;BGP OPEN Message doesn't have any capability advertisements&#34;
        return $capTypes
    } else {
        <a name="::result_debug(158)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;start of cap msg: [string range $bgpFrame 91 92]&#34;
        set capLen [format &#34;%u&#34; &#34;0x[string range $bgpFrame 91 92]&#34;]
        <a name="::result_debug(159)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;capability length is $capLen\n&#34;
        set currentLen 1
        <span class="comment-line">#get the capabilityies alone</span>
        regsub -all &#34; &#34; [string range $bgpFrame 94 [string length $bgpFrame]] &#34;&#34; CapabilityMsg
        <a name="::result_debug(160)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The complete capability message is $CapabilityMsg \n&#34;
        <span class="comment-line">#current length</span>
        set i 0
        set j 0
        set capStrLen [expr $capLen *2]
        while { $i &lt; $capStrLen } {
        <a name="::result_debug(161)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Type$j : &#34;
        lappend capTypes [string range $CapabilityMsg $i [expr $i+1]]
        set type [string range $CapabilityMsg $i [expr $i+1]]
        <span class="comment-line">#capability code in hex</span>
       switch $type {
             &#34;01&#34; { <a name="::result_debug(162)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Capability is Multiprotocol&#34; }
             &#34;02&#34; { <a name="::result_debug(163)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;capability is route-refresh&#34;}
             &#34;80&#34; { <a name="::result_debug(164)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;capability is route-refresh new&#34;}
             &#34;40&#34; { <a name="::result_debug(165)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;capability is graceful restart&#34;}
             &#34;41&#34; { <a name="::result_debug(166)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;capability is 4-byte As&#34;}
             default { <a name="::result_debug(167)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Capability not-defined: if known define it&#34; }
        }

        <span class="comment-line">#puts &#34;capability type [string range $CapabilityMsg $i [expr $i+1]]&#34;</span>
        set length [format &#34;%u&#34; &#34;0x[string range $CapabilityMsg [expr $i+2] [expr $i+3]]&#34;]
        <a name="::result_debug(168)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;capability length is $length&#34;
        lappend capMessage [string range $CapabilityMsg $i [expr $i + $length*2 +3]]
        <a name="::result_debug(169)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The capability message is [string range $CapabilityMsg $i [expr $i + $length*2 +3]] \n&#34;
        incr i [expr $length*2 +4]
        <span class="comment-line">#puts &#34;current value of i is $i&#34;</span>
        incr j
        }
    }
    <a name="::result_debug(170)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the cap list is $capTypes&#34;
    return $capTypes
}

<strong><a name="::::checkRestartBit_2908">proc <a href="bgpv6.tcl-annot.html#::::checkRestartBit">::::checkRestartBit</a></a></strong> { rawframe } {
<span class="comment-line">#check restart bit is set in open message</span>
foreach frame $rawframe {
   set bgpMsgs [<a name="::GetBGPMessages(2)"><a href="./bgp.tcl.html#::GetBGPMessages_1856">::GetBGPMessages</a></a> $frame]
   set bgpMsgTypes [<a name="::GetBGPMsgTypes(1)"><a href="./bgpv6.tcl.html#::GetBGPMsgTypes_1987">::GetBGPMsgTypes</a></a> $bgpMsgs]
   set result 1
if {[lsearch -glob $bgpMsgTypes &#34;IP_BGPv4_OPEN&#34;] &gt;= 0} {
      <a name="::result_debug(171)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP OPEN Packet : $bgpMsgs&#34;
      <span class="comment-line">#set capList [GetBGPGRCapability $bgpMsgs]</span>
        set capList [<a name="::GetBGPGRCapabilityFromZugspitz(2)"><a href="./bgpv6.tcl.html#::GetBGPGRCapabilityFromZugspitz_2669">::GetBGPGRCapabilityFromZugspitz</a></a> $bgpMsgs]
if { [lindex $capList 1] &lt;= &#34;29&#34; } {
         <a name="::result_debug(172)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP OPEN Message doesn't have GR Capability advertisements&#34;
         <a name="::result_debug(173)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP OPEN Message Length :: [lindex $capList 1]&#34;
         set result 0
      } elseif { [lindex $capList 2] != &#34;64&#34; } {
<span class="comment-line"># --- Check that BGP GR capability code is set properly</span>
          <a name="::result_debug(174)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP GR capability code is not set properly&#34;
         <a name="::result_debug(175)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP GR capability code :: [lindex $capList 2]&#34;
         set result 0
      } elseif { [lindex $capList 4] != &#34;0&#34; } {
         <a name="::result_debug(176)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP Restart capability is not set properly&#34;
         <a name="::result_debug(177)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP Restart capability :: [lindex $capList 4]&#34;
         set result 1
      }
}
}
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name:Check_MaxPrefix_Log</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to check the max-prefix log. If the seesion is not torn down use -tear_down &#34;0&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#               Check_MaxPrefix_Log -threshold 80 -max_prefix 2000 -peer &#34;10.10.10.1&#34; -tear_down &#34;0&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>


<strong><a name="::::Check_MaxPrefix_Log_2955">proc <a href="bgpv6.tcl-annot.html#::::Check_MaxPrefix_Log">::::Check_MaxPrefix_Log</a></a></strong> {args} {
 <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> Check_MaxPrefix_Log $args {
        threshold &#34;75&#34;
        max_prefix &#34;&#34;
        afi &#34;1&#34;
        safi &#34;1&#34;
        peer &#34;&#34;
        tear_down &#34;1&#34;
        exceed_limit &#34;1&#34;
}
set parameterList &#34;&#34;

lappend parameterList &#34;{The number of prefixes from a peer has reached the warning threshold} \
        {Neighbor IP address.*$peer} inLine exist 1&#34;
lappend parameterList &#34;{The number of prefixes from a peer has reached the warning threshold} \
        {Number of prefixes.*[expr $threshold * $max_prefix / 100 ]} inLine exist 4&#34;
if {1} {
if {$exceed_limit} {
lappend parameterList &#34;{The number of prefixes from a peer has reached the warning threshold} \
                        {Neighbor IP address.*$peer} inLine exist 1&#34;
lappend parameterList &#34;{The number of prefixes from a peer has reached the warning threshold} \
                        {Configured max prefixes:.*$max_prefix} inLine exist 5&#34;
}

if {$tear_down} {
lappend parameterList &#34;{The maximum number of prefixes stored for a neighbor would be exceeded} \
                        {Neighbor IP address.*$peer} inLine exist 1&#34;
lappend parameterList &#34;{The maximum number of prefixes stored for a neighbor would be exceeded} \
                        {Defined max prefixes:.*$max_prefix} inLine exist 4&#34;
lappend parameterList &#34;{The maximum number of prefixes stored for a neighbor would be exceeded} \
                        {Dropping connection:.*1} inLine exist 5&#34;
}
}
<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show log warning&#34; $parameterList -time {s: 1 i: 4 d: 60 f: 60 r} -comment &#34; with two messages in reaching threshold ($threshold%, 100%)&#34;
unset parameterList
}


<span class="comment-line">#########################################################################</span>
<span class="comment-line">#########################################################################</span>
<strong><a name="::::Check_BGP_OpenMessage_2995">proc <a href="bgpv6.tcl-annot.html#::::Check_BGP_OpenMessage">::::Check_BGP_OpenMessage</a></a></strong> {args} {

<span class="comment-line">#parse_args Check_BGP_OpenMessage $args {</span>
	set capList &#34;&#34;
	global capMessage
	set capMessage &#34;&#34;
	set result 1
	set gotGRMsg 0
	set cMessage &#34;&#34;
<span class="comment-line">#}</span>

set frameList [<a name="::GetCapturedFrames(1)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $args]
<span class="comment-line">#set frameList1 [GetCapturedFrames $args]</span>

set gotPkt 0
if { [llength $frameList] == 0 } {
   <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No Frames are captured&#34;
}
foreach frame $frameList {
   <a name="::result_debug(178)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;frame :: $frame&#34;
   set bgpMsgs [<a name="::GetBGPv6Messages(2)"><a href="./bgpv6.tcl.html#::GetBGPv6Messages_1922">::GetBGPv6Messages</a></a> $frame]
   <a name="::result_debug(179)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;bgpMsgs :: $bgpMsgs&#34;
   set bgpMsgTypes [<a name="::GetBGPv6MsgTypes(2)"><a href="./bgpv6.tcl.html#::GetBGPv6MsgTypes_303">::GetBGPv6MsgTypes</a></a> $bgpMsgs]
   <a name="::result_debug(180)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;bgpMsgTypes :: $bgpMsgTypes&#34;

   if {[lsearch -glob $bgpMsgTypes &#34;IP_BGPv6_OPEN&#34;] &gt;= 0} {
      <a name="::result_debug(181)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP OPEN Packet : $bgpMsgs&#34;
      set capList [<a name="::GetBGPCapability(1)"><a href="./bgpv6.tcl.html#::GetBGPCapability_2855">::GetBGPCapability</a></a> $bgpMsgs]
<span class="comment-line">#EXOS 12.5</span>
        if {[lsearch -glob $capList &#34;40&#34;] &gt;= 0} {
        <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;graceful restart capability present in open message&#34;
        <a name="::result_debug(182)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;capList is $capList&#34;
        set index [lsearch -glob $capList &#34;40&#34;]
        incr gotPkt
        set cMessage &#34;&#34;
        set cMessage [lindex $capMessage $index]
        puts &#34;the capability message for GR is $cMessage\n&#34;
        <span class="comment-line">#length should be 2-octect</span>
    if { [string range $cMessage 7 8] != &#34;80&#34; } {
         <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;BGP Restart capability is not set properly&#34;
         <a name="::result_debug(183)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP Restart capability :: [string range $cMessage 7 8]&#34;
         set result 0
      }

      <span class="comment-line"># --- Check that BGP Restart Time is set properly</span>
<span class="comment-line">#78 in hex = 120 in deci. default restart time is 120 sec</span>
      if { [string range $cMessage 6 7] != &#34;78&#34; } {
         <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;BGP Restart Time is not set properly&#34;
         <a name="::result_debug(184)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BGP Restart Time :: [string range $cMessage 6 7]&#34;
         set result 0
      }

        } else {
        <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No graceful restart message present in open message&#34;
        }
   }
}
if { $gotPkt == 0 } {
   if { [llength $frameList] == 0 } {
      <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No BGP packet is captured. Expected BGP OPEN message&#34;
   } else {
       <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;BGP OPEN Message doesn't have GR Capability advertisements&#34;
   }
}
}



<span class="comment-line">#SendACmd	&#34;disable bgp sync&#34;</span>
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
