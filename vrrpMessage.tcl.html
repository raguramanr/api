<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>vrrpMessage.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#vrrpMessage.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>vrrpMessage.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="vrrpMessage.tcl-annot.html">annotations</a> | <a href="vrrpMessage.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckMSMPorts</span>
<span class="comment-line"># Description: Checks for the aspen blade 10gx2c and skips the testcase.</span>
<span class="comment-line">#This proc is to be used if msm operations are performed on the</span>
<span class="comment-line">#same blade which it does not support.</span>
<span class="comment-line"># Input args: None</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: return</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::CheckMSMPorts_13">proc <a href="vrrpMessage.tcl-annot.html#::::CheckMSMPorts">::::CheckMSMPorts</a></a></strong><a name="::::CheckMSMPorts"></a> {} {
global DUT1_CONNECT
global bd8kChassis
upvar time1 time1
upvar time2 time2
upvar testNo testNo

set plat [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]
if { [regexp -nocase $bd8kChassis $plat] } {
   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
   set port &#34;&#34;
   set parameterlist &#34;&#34;
   set port [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1]
   set port [split $port :]
   set slot [lindex $port 0]
   lappend parameterlist &#34;Slot-$slot 1&#34;
   set blade [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show slot&#34; $parameterlist]
   puts &#34;The blade that is used : $blade&#34;
   if { [regexp -nocase &#34;10G2xc&#34; $blade&#34;] } {
      result_skip &#34;Skipping this testcase as MSM operations are not supported on Tribeca Blade&#34;
      set time2 [clock seconds];
      result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
      <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
      <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return -code return 0
   }
}

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: RunFailoverSupported</span>
<span class="comment-line"># Description: If DUT does not support Run Failover</span>
<span class="comment-line">#              exit the test.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: - (1 is default) or 2 or 3..</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: return</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#to skip a test if DUT1 does not support Failover use:</span>
<span class="comment-line">#       RunFailoverSupported</span>
<span class="comment-line"># to skip a test if DUT2 does not support Failover use:</span>
<span class="comment-line">#       RunFailoverSupported 2</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::RunFailoverSupported_57">proc <a href="vrrpMessage.tcl-annot.html#::::RunFailoverSupported">::::RunFailoverSupported</a></a></strong><a name="::::RunFailoverSupported"></a> {{dut &#34;1&#34;}} {
global  DUT[set dut]_CONNECT
global chassis
global cfgFile
upvar time1 time1
upvar time2 time2
upvar testNo testNo
set plat [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT[set dut]]

if {![regexp -nocase &#34;$chassis&#34; $plat]} {
   result_skip &#34;Run failover is only supported on Chassis&#34;
   set time2 [clock seconds];
   result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
   <a name="::close_result_file(2)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
   <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return -code return 0
}
<a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dut]_CONNECT]
set parameterList &#34;&#34;
lappend parameterList &#34;{Slot-1} 1&#34;
set blade [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show slot&#34; $parameterList]
set blade [lindex $blade 0]
if { [regexp -nocase &#34;empty&#34; $blade] } {
puts &#34;The Blade on slot 1 was $blade&#34;
puts &#34;Checking on slot 2&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Slot-2} 1&#34;
set blade [<a name="::GetKeyValue(3)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show slot&#34; $parameterList]
set blade [lindex $blade 0]
}
puts &#34;The blade is $blade&#34;
<a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
if { [regexp -nocase &#34;8500&#34; $blade] } {
   set parameterlist &#34;&#34;
   lappend parameterlist &#34;{MSM-A} {8500} inLine exist&#34;
   set msm [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot&#34; $parameterlist]

   if { [regexp -nocase &#34;ok&#34; $msm] } {
      result_skip &#34;This hardware does not support MSM failover&#34;
      set time2 [clock seconds];
      result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
      <a name="::close_result_file(3)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
      <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return -code return 0
   }
}
}




<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendVrrpMessage   </span>
<span class="comment-line"># Description: Send Vrrp packet from an ixia port and the packet type</span>
<span class="comment-line">#	       is given in dataPattern argement.		     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Frame sent</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	set srcMac [GetDUTMac &#34;DUT1&#34;]</span>
<span class="comment-line">#	set destMac [GetDUTMac &#34;DUT2&#34;]</span>
<span class="comment-line">#	set graftAckData &#34;13 09 3A EA 00 00 FF 03 C0 02 02 00 EF 01 02 04 00 00 00 00 00 00 00 00 00 00&#34;</span>
<span class="comment-line">#	set ipTotalLength 36 </span>
<span class="comment-line">#	set frameSent [SendVrrpMessage -txPortId 9 -sourceIp 192.3.3.1 \</span>
<span class="comment-line">#                 -destIp 192.3.3.2 -sourceMac $srcMac -destMac $destMac \</span>
<span class="comment-line">#                 -ipTotalLength $ipTotalLength -dataPattern $graftAckData ]     </span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendVrrpMessage_125">proc <a href="vrrpMessage.tcl-annot.html#::::SendVrrpMessage">::::SendVrrpMessage</a></a></strong><a name="::::SendVrrpMessage"></a> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendVrrpMessage $args {
     txPortId &#34;1&#34;
     sourceMac &#34;default&#34;
	  destMac &#34;01 00 5E 00 00 12&#34;
	  sourceIp &#34;127.0.0.1&#34;
	  destIp &#34;224.0.0.18&#34;
	  ttl &#34;255&#34;
     numFrames &#34;1&#34;
	  tag &#34;none&#34;
	  dataPattern &#34;21 7B FF 01 00 01 7B 80 64 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00&#34;
	  ipTotalLength 36
   }
   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Host ($sourceIp) sending a Vrrp message ([lindex $dataPattern 1]) on portId $txPortId&#34;   
   set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   set rxPo [<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chasisId card port]
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   global startCardNum


   set frameSize [expr 38 + [llength $dataPattern] ]
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FrameSize: $frameSize&#34;
   set frameSent [<a name="::ixiaConf_2Ports_ip(1)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -numIxiaCd $numIxiaCd \
              -txChas $chasisId -txCard $card -txPort $port \
              -rxChas $chasisId -rxCard $card -rxPort $rxPo \
              -ipProtocol &#34;112&#34; -sMacAddr $sourceMac -dMacAddr $destMac \
              -sIpAddr $sourceIp -dIpAddr $destIp -ttl $ttl -TOS &#34;0xC0&#34; ipTotalLength $ipTotalLength \
	           -numFrames $numFrames -wTag $wTag -tagNo $tag  -dataPattern $dataPattern -frameSize $frameSize]  
   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;VrrpFrame: $frameSent&#34;

   return $frameSent

}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
