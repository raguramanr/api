<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>Bgpv6Setup.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#Bgpv6Setup.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>Bgpv6Setup.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="Bgpv6Setup.tcl-annot.html">annotations</a> | <a href="Bgpv6Setup.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupDUTAsIBGPv6</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: set up DUT1 as IBGP peer </span>
<span class="comment-line"># Assumes the peer is another DU2, strictly works for DUT1&lt;-&gt;DUT2 not for test equiment</span>
<span class="comment-line">#</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupDUTAsIBGPv6_19">proc <a href="Bgpv6Setup.tcl-annot.html#::::SetupDUTAsIBGPv6">::::SetupDUTAsIBGPv6</a></a></strong> {} {
    <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create vlan vibgp&#34;;
    <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vibgp add port [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1]&#34;;
    <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vibgp ipaddress 2010:10:10::2/64&#34;;
    <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config iproute add default 2010:10:10::1&#34;;
    <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp as-number 100&#34;;
    <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp routerid 10.10.10.2&#34;;
    <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create bgp neighbor 2010:10:10::1 remote 100&#34;;
<a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;enable bgp neighbor all capability ipv6-unicast&#34;
<a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;enable bgp neighbor all capability ipv6-multicast&#34;
    <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable ipforwarding ipv6 vibgp&#34;;
    <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp neighbor all&#34;;      
    <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp&#34;;       
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupDUTAsIBGPv6</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Cleans up DUT1 as IBGP peer with DUT2 </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupDUTAsIBGPv6_49">proc <a href="Bgpv6Setup.tcl-annot.html#::::CleanupDUTAsIBGPv6">::::CleanupDUTAsIBGPv6</a></a></strong> {} {
    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CleanupDUTAsIBGP&#34;
    <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config iproute delete default 2010:10:10::1&#34;; 
    <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable ipforwarding ipv6&#34;;
<span class="comment-line">#    SendACmd  &#34;en bgp sync&#34;;</span>
    <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable bgp&#34;;
    <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete bgp neighbor all&#34;;
    <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete vibgp&#34;;
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupDUTAsEBGPv6</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  set up DUT3 as EBGP with DUT1.</span>
<span class="comment-line">#     Assumes dUT1 sets up DUT3 as EBGP peer as well. Strictly meant for DUT3&lt;-&gt;DUT1</span>
<span class="comment-line">#     would not work for test equiment</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupDUTAsEBGPv6_78">proc <a href="Bgpv6Setup.tcl-annot.html#::::SetupDUTAsEBGPv6">::::SetupDUTAsEBGPv6</a></a></strong> {} {

    <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create vlan vebgp&#34;;
    <a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vebgp add port [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 1]&#34;;
    <a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vebgp ipaddress 2020:10:10::2/64&#34;;
    <a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config iproute add default 2020:10:10::1&#34;; 
    <a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp as-number 200&#34;;
    <a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp routerid 20.10.10.2&#34;;
    <a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create bgp neighbor 2020:10:10::1 remote 100&#34;;
<a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;enable bgp neighbor all capability ipv6-unicast&#34;
<a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;enable bgp neighbor all capability ipv6-multicast&#34;
    <a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable ipforwarding ipv6 vebgp&#34;;  
    <a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp neighbor all&#34;;      
    <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp&#34;;        
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupDUTAsEBGPv6</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Cleanup DUT EBGP info</span>
<span class="comment-line">#               Assumes DUT was configured using SetupDUTAsEBGP</span>
<span class="comment-line">#</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupDUTAsEBGPv6_110">proc <a href="Bgpv6Setup.tcl-annot.html#::::CleanupDUTAsEBGPv6">::::CleanupDUTAsEBGPv6</a></a></strong> {} {
    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CleanupDUTAsEBGP&#34;
    <a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config iproute delete default 2020:10:10::1&#34;; 
    <a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable ipforwarding ipv6&#34;;
    <a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable bgp&#34;;       
    <a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete bgp neighbor all&#34;;
    <a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete vebgp&#34;;    
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupDUT1v6</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  sets up DUT1 with IBGP peer to DUT2 and EBGP peer with DUT3</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupDUT1v6_135">proc <a href="Bgpv6Setup.tcl-annot.html#::::SetupDUT1v6">::::SetupDUT1v6</a></a></strong> {} {
    <a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create vlan vibgp&#34;;
    <a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vibgp add port [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2]&#34;;
    <a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vibgp ipaddress 2010:10:10::1/64&#34;;

    <a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create vlan vebgp&#34;;
    <a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vebgp add port [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 3]&#34;;
    <a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vebgp ipaddress 2020:10:10::1/64&#34;;

    <a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf bgp as-number 100&#34;;
    <a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf bgp routerid 20.10.10.1&#34;;
    <a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create bgp neighbor 2010:10:10::2 remote 100&#34;;
    <a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create bgp neighbor 2020:10:10::2 remote 200&#34;
<a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;enable bgp neighbor all capability ipv6-unicast&#34;
<a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;enable bgp neighbor all capability ipv6-multicast&#34;
    <a name="::SendACmd(47)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable ipforwarding ipv6&#34; 
    <a name="::SendACmd(48)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp neighbor all&#34;;
<a name="::SendACmd(49)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp&#34;;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupDUT1v6</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  cleans up DUT with bgp information.</span>
<span class="comment-line">#  mainly called to cleanup config from SetupDUT1</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupDUT1v6_172">proc <a href="Bgpv6Setup.tcl-annot.html#::::CleanupDUT1v6">::::CleanupDUT1v6</a></a></strong> {} {
    <a name="::SendACmd(50)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable ipforwarding ipv6&#34;; 
<span class="comment-line">#    SendACmd  &#34;en bgp sync&#34;; </span>
    <a name="::SendACmd(51)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable bgp&#34;;      
    <a name="::SendACmd(52)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete bgp neighbor all&#34;;
    <a name="::SendACmd(53)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete vebgp&#34;;
    <a name="::SendACmd(54)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vibgp&#34;
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name:VerifyNotABGPv6Neighbor</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to verify a given bgp neighbor does not exist</span>
<span class="comment-line">#     by using sh bgp neigh and sh bgp             </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: IPAddress, asNum, IOrE</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#         VerifyNotABGPNeighbor $ipAddress $asNum $IOrE</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyNotABGPv6Neighbor_199">proc <a href="Bgpv6Setup.tcl-annot.html#::::VerifyNotABGPv6Neighbor">::::VerifyNotABGPv6Neighbor</a></a></strong> {ipAddress asNum IOrE} {

    set e e

   <span class="comment-line">################################################</span>
   set subTest &#34;Verify that neighbor $ipAddress does not exist&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   lappend parameterList &#34;{$IOrE$e.* $ipAddress *$asNum .* ESTABLISHED} notExist&#34;;
   <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp neighbor&#34; $parameterList -comment &#34;BGP neighbor not established&#34; -time {s: 0 i: 4 d: 60 f: 60 r};
   unset parameterList;
   <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyCorrectBGPv6Neighbor</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to verify a given bgp neighbor exists with right i or e</span>
<span class="comment-line">#     neighbor flag. It also checks the correct number of i or e routes learned.  </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: IPAddress, asNum, numRoutes, IOrE</span>
<span class="comment-line"># Output args: ok/error</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#        VerifyNotABGPNeighbor $ipAddress, asNum, $numRoutes, $I</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyCorrectBGPv6Neighbor_232">proc <a href="Bgpv6Setup.tcl-annot.html#::::VerifyCorrectBGPv6Neighbor">::::VerifyCorrectBGPv6Neighbor</a></a></strong> {ipAddress asNum numRoutes IOrE} {

    set e e

   <span class="comment-line">################################################</span>
   set subTest &#34;Verify that neighbor $ipAddress ESTABLISHED&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   lappend parameterList &#34;{$IOrE$e.* $ipAddress *$asNum .* ESTABLISHED} exist&#34;;
   if {[regexp -nocase [<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp neighbor&#34; $parameterList -comment &#34;BGP neighbor established&#34; -time {s: 1 i: 4 d: 60 f: 60 r}] &#34;error&#34;]} {
   return &#34;error&#34;
   }
   unset parameterList;
   <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
 
   if {[regexp -nocase $IOrE &#34;i&#34;]} {
      lappend parameterList &#34;{Routes from IBGP *: $numRoutes} exist&#34;;
      return [<a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp&#34; $parameterList -comment &#34;Verify numRoutes learned from internal neighbor&#34; -time {s: 0 i: 4 d: 60 f: 60 r}]
      <span class="comment-line">#unset parameterList;</span>
   } elseif {[regexp -nocase $IOrE &#34;e&#34;]} {
      lappend parameterList &#34;{Routes from EBGP *: *$numRoutes} exist&#34;;
      return [<a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp&#34; $parameterList -comment &#34;Verify numRoutes learned from external neighbor&#34; -time {s: 0 i: 4 d: 60 f: 60 r}];
      <span class="comment-line">#unset parameterList;</span>
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyCorrectBGPv6NeighborList</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to verify a given list of bgp neighbor exists with right i or e</span>
<span class="comment-line">#     neighbor flag. </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: peerIp - list of nbr ip address, peerAsNum - List of peer's </span>
<span class="comment-line">#                      AS Number, peerType - List of peer's type. </span>
<span class="comment-line">#                      List order should be the same for all the lists</span>
<span class="comment-line">#                      mentioned above</span>
<span class="comment-line"># Output args: ok/error</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#        VerifyNotABGPNeighbor $ipAddress, asNum, $numRoutes, $I</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyCorrectBGPv6NeighborList_280">proc <a href="Bgpv6Setup.tcl-annot.html#::::VerifyCorrectBGPv6NeighborList">::::VerifyCorrectBGPv6NeighborList</a></a></strong> {args} {

    set e e

   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyCorrectBGPv6RoutesLearned $args {
      peerIp &#34;&#34; 
      peerAsNum &#34;&#34;
      peerType &#34;&#34;
   }

for {set index 0} {$index&lt;[llength $peerIp]} {incr index} {
   set peerIpValue [lindex $peerIp $index]
   set peerAsNum [lindex $peerAsNum $index]
   set peerTypeValue [lindex $peerType $index]

   lappend parameterList &#34;{$peerTypeValue$e.* $peerIpValue *$peerAsNum .* ESTABLISHED} exist&#34;;
}
   return [<a name="::CheckKeyValue(5)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp neighbor&#34; $parameterList -comment &#34;BGP neighbor established&#34; -time {s: 1 i: 4 d: 120 f: 120 r}];
   <span class="comment-line">#unset parameterList;</span>
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyCorrectBGPv6RoutesLearned</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Verify that specific BGP routes are learned on the</span>
<span class="comment-line">#               switch.</span>
<span class="comment-line">#               It uses route attributes in a list along with network ip</span>
<span class="comment-line">#               to verify the learning</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyCorrectBGPv6RoutesLearned_319">proc <a href="Bgpv6Setup.tcl-annot.html#::::VerifyCorrectBGPv6RoutesLearned">::::VerifyCorrectBGPv6RoutesLearned</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyCorrectBGPRoutesLearned $args {
      peerIp &#34;&#34; 
      peerAsPath &#34;&#34;
      ipNwList &#34;&#34;
      originList &#34;0&#34;
      routesList &#34;&#34;
      nextHopList &#34;&#34;
      fromPrefixList &#34;&#34;
      bestRouteList &#34;&#34;
      fromPrefixList &#34;&#34;
      thruPrefixList &#34;&#34;
      localPrefList &#34;&#34;
      asTypeList &#34;&#34;
      asPathList &#34;&#34;
      medList &#34;&#34;
      peerType &#34;&#34;
   }

for {set index 0} {$index&lt;[llength $peerIp]} {incr index} {
   set peerIpValue [lindex $peerIp $index]
   set peerAsPathVal [lindex $peerAsPath $index]
   set ipNwListValue [lindex $ipNwList $index]
   set fromPrefixListValue [lindex $fromPrefixList $index]
   set thruPrefixListValue [lindex $thruPrefixList $index]
   set originListValue [lindex $originList $index]
   set nextHopListValue [lindex $nextHopList $index]
   set routesListValue [lindex $routesList $index]
   set medListValue [lindex $medList $index]
   set asPathListValue [lindex $asPathList $index]
   set asTypeListValue [lindex $asTypeList $index]
   set localPrefListValue [lindex $localPrefList $index]
   set bestRouteListValue [lindex $bestRouteList $index]
   set peerTypeValue [lindex $peerType $index]
   set length [llength $ipNwListValue]
   set incompleteRoutesList &#34;&#34;
   set incompleteRoutesList1 &#34;&#34;
   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;length=$length and asPathListValue $asPathListValue&#34;;

   <span class="comment-line">################################################</span>
   set subTest &#34;Verify correct routes learned from peer $peerIpValue&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   
   if {[llength $fromPrefixListValue]!=$length || [llength $thruPrefixListValue]!=$length || [llength $routesListValue]!=$length || \
       [llength $nextHopListValue]!=$length} {
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error in input args:fromPrefixList,thruPrefixList,routesList,ipNwList,nextHopList should be same length&#34;
      <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return -1
   }
   
   for {set i 0} {$i&lt;$length} {incr i} {
      set ipNetwork [lindex $ipNwListValue $i]
      set fromPrefix [lindex $fromPrefixListValue $i]
      set thruPrefix [lindex $thruPrefixListValue $i]
      set originType [lindex $originListValue $i]
      set nextHop [lindex $nextHopListValue $i]
      set localPref [lindex $localPrefListValue $i]
      set numRoutes [lindex $routesListValue $i]
      set med [lindex $medListValue $i]
      set bestRoute [lindex $bestRouteListValue $i]
      set peerTypeVal [lindex $peerTypeValue $i]

      switch -- $originType \
         &#34;1&#34; {
             set originCode EGP
         } &#34;0&#34; {
             set originCode IGP
         } &#34;2&#34; {
             set originCode Incomplete
         } default {
             set originCode IGP
         }
      
      if {$peerTypeVal==&#34;i&#34;} {
         set peerAsPathList &#34;&#34;
      } else {
         set peerAsPathList $peerAsPathVal
      }
      if {[llength $asPathListValue]!=0} {
         set aslist [lindex $asPathListValue $i]
         set asSegmentTypes [lindex $asTypeListValue $i]
         if {$aslist!=&#34;&#34;} {
            set indice 0
            foreach asType $asSegmentTypes {
               if {[llength $asSegmentTypes]&gt;1} {             
                  lappend peerAsPathList [lindex $aslist $indice]
               } else {
                  if {$asType==1} {
                     set aslist [list $aslist]   ;<span class="comment-line"># in order to properly check the set of AS_SET</span>
                  }
                  foreach asl $aslist {
                     lappend peerAsPathList $asl
                  }
               }
               incr indice
            }
         }
      }
      for {set j 0} {$j&lt;$numRoutes} {incr j} {
         set myIP [<a name="::incrIpField(1)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $ipNetwork 3 $j]
         scan $myIP %d.%d.%d.%d a b c d
         set myIP [format %d.%d.%d.%d $a $b $c 0]
         if {$localPref!=&#34;&#34;} {
            if {$med!=&#34;&#34;} {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop, LPref $localPref, MED $med} inLine exist 1&#34;
            } else {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop, LPref $localPref} inLine exist 1&#34;
            }
         } else {
            if {$med!=&#34;&#34;} {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop.* MED $med} inLine exist 1&#34;
            } else {
<span class="comment-line">#               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop.*} inLine exist 1&#34;</span>
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop} inLine exist 1&#34;
            }
         }
         if {$bestRoute==1} {
            lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix, *Peer $peerIpValue, *BEST} {AS-PATH: $peerAsPathList} inLine exist 3&#34;
         } else {
            lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix, *Peer $peerIpValue} {AS-PATH: $peerAsPathList} inLine exist 3&#34;
         }
      }
   }
<span class="comment-line">#   result_debug &#34;the constructed incompleteRoutesList $incompleteRoutesList&#34;</span>
<span class="comment-line">#   result_debug &#34;the constructed incompleteRoutesList1 $incompleteRoutesList1&#34;</span>
   
   <a name="::CheckKeyValue(6)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp neighbor $peerIpValue address-family ipv6-unicast received-routes detail all&#34; $incompleteRoutesList -comment &#34;BGP neighbor incomplete routes&#34;  -time {s: 0 i: 5 d: 15 f: 15 r};
   <span class="comment-line">#CheckKeyValue &#34;show bgp neighbor $peerIpValue received-routes detail all&#34; $incompleteRoutesList1 -comment &#34;BGP neighbor incomplete routes correct AS-PATH&#34;;</span>
   unset incompleteRoutesList
   <span class="comment-line">#unset incompleteRoutesList1</span>
   
   <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
