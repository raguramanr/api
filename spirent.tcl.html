<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>spirent.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#spirent.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>spirent.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="spirent.tcl-annot.html">annotations</a> | <a href="spirent.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line"># File support for Spirent stc API.</span>

<span class="comment-line">#puts auto_path\t$auto_path</span>
<span class="comment-line">#package require SpirentTestCenter</span>

<span class="comment-line">#set ::auto_path [linsert $::auto_path 0 . ]</span>
<span class="comment-line">################################################################################</span>
<span class="comment-line"># Init STC Lab Server Environment Vars</span>
<span class="comment-line">################################################################################</span>
<strong><a name="::::stcInit_11">proc <a href="spirent.tcl-annot.html#::::stcInit">::::stcInit</a></a></strong> {labserver} {
   global env   
   <a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> set env(STC_SERVER_ADDRESS) $labserver
   <a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> set env(STC_SESSION_NAME) __NEW_TEST_SESSION__
   <span class="comment-line">#set env(STC_SESSION_NAME) </span>
   <a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> set env(STC_SESSION_SYNCFILES_ON_SEQ_COMPLETE) 1
   <a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> set env(STC_SESSION_TERMINATE_ON_DISCONNECT) 1
   <span class="comment-line">#set env(STC_SESSION_ADDRESS) 2</span>
   set env(IXIA_VERSION) n/a
   <span class="comment-line"># set some ixia global variables to get past some weird code</span>
   set ::checkOldGenSlotInChassis 0
}



<strong><a name="::::logcmd_26">proc <a href="spirent.tcl-annot.html#::::logcmd">::::logcmd</a></a></strong> {args} {
   global _DEBUG _DEBUGFILE
   if {![info exists _DEBUG]} {set _DEBUG 2}
   if {$_DEBUG &gt; 0} {
      if {![info exists _DEBUGFILE]} {
         set _DEBUGFILE [open debug.[clock format [clock seconds] -format %m%d%y%H%M].log w]
      }
      if {$_DEBUG == 3} {puts $_DEBUGFILE &#34;\#\# [clock format [clock seconds] -format %T]&#34;}
      if {[llength $args] == 1} {
         eval puts $_DEBUGFILE $args
      } else {
         puts $_DEBUGFILE $args
      }
      <span class="comment-line">### temp</span>
      flush $_DEBUGFILE
   }
   if {[llength $args] == 1} {
      set err [catch {eval uplevel $args} retval]
   } else {
      set err [catch {uplevel $args} retval]
   }
   if {$err} {
      if {$_DEBUG &gt; 0} {
         puts $_DEBUGFILE &#34;\#ERROR: Could not execute command:\n\
                          \#   \&#34;$args\&#34;\n\
                          \#Exiting with error:\n\
                          \#   $retval&#34;
         flush $_DEBUGFILE
      }
      error &#34;ERROR: Could not execute command:\n   $args\nExiting with error:\n   $retval&#34;
   }
   if {$_DEBUG &gt; 1} {
      if {$retval != {} } {
         regsub -all {\n} $retval &#34;\n\# &#34; dbgtxt
         puts $_DEBUGFILE &#34;\# $dbgtxt&#34;
         puts $_DEBUGFILE &#34;&#34;
      }
   }
   return $retval
}

<strong><a name="::::ReservePorts_67">proc <a href="spirent.tcl-annot.html#::::ReservePorts">::::ReservePorts</a></a></strong> {} {
   global ahSpirentPort
   global SPIRENTCH1
   global cfg ixiaMappingList
   global STCMAIN STCPORT STCPORTID
    
   <span class="comment-line"># Blanco Work</span>
   <span class="comment-line"># Reserve a few ports.</span>
   <span class="comment-line"># Physical topology</span>
   
   <span class="comment-line"># Create the root project objec</span>
   set hProject [<a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create project]
   set STCMAIN(project) $hProject
   <span class="comment-line"># Configure automation options.</span>
   <a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config system1.AutomationOptions -LogLevel ERROR
   
   foreach portMap $ixiaMappingList {
       set portId [lindex $portMap 0]
       set card [lindex $portMap 1]
       set port [lindex $portMap 2]
       puts &#34;Set stc port //$SPIRENTCH1/$card/$port&#34;
       set ahSpirentPort($portId) [<a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject \
              -location //$SPIRENTCH1/$card/$port]
       lappend lstPorts $ahSpirentPort($portId)
   }
   
   <span class="comment-line"># Create ports</span>
if {0} {
   if {[regexp &#34;std&#34; $cfg]} {
      set ahSpirentPort(1) [<a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/1]
      set ahSpirentPort(2) [<a name="::logcmd(9)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/2]
      set ahSpirentPort(3) [<a name="::logcmd(10)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/3]
      set ahSpirentPort(4) [<a name="::logcmd(11)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/4]
      set ahSpirentPort(5) [<a name="::logcmd(12)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/5]
      set ahSpirentPort(6) [<a name="::logcmd(13)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/6]
      set ahSpirentPort(7) [<a name="::logcmd(14)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/7]
      set ahSpirentPort(8) [<a name="::logcmd(15)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/8]
      set ahSpirentPort(9) [<a name="::logcmd(16)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/9]
      set ahSpirentPort(10) [<a name="::logcmd(17)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/10]
      set ahSpirentPort(11) [<a name="::logcmd(18)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/11]
      set ahSpirentPort(12) [<a name="::logcmd(19)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/1/12]
      set lstPorts {}
      
      foreach i {1 2 3 4 5 6 7 8 9 10 11 12} {
         lappend lstPorts $ahSpirentPort($i)
      }
   } else {
      puts &#34;rtr 5 node config $cfg&#34; 
      set ahSpirentPort(10) [<a name="::logcmd(20)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/1]
      set ahSpirentPort(11) [<a name="::logcmd(21)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/2]
      set ahSpirentPort(7) [<a name="::logcmd(22)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/3]
      set ahSpirentPort(8) [<a name="::logcmd(23)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/4]
      set ahSpirentPort(5) [<a name="::logcmd(24)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/5]
      set ahSpirentPort(6) [<a name="::logcmd(25)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/6]
      set ahSpirentPort(3) [<a name="::logcmd(26)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/7]
      set ahSpirentPort(4) [<a name="::logcmd(27)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/8]
      set ahSpirentPort(9) [<a name="::logcmd(28)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/9]
      set ahSpirentPort(1) [<a name="::logcmd(29)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/10]
      set ahSpirentPort(2) [<a name="::logcmd(30)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create port -under $hProject -location //$SPIRENTCH1/2/11]
      set lstPorts {}
      
      foreach i {1 2 3 4 5 6 7 8 9 10 11} {
         lappend lstPorts $ahSpirentPort($i)
      }
   }
}  

 
   <span class="comment-line"># Attach ports. (One command takes care of three) </span>
   <span class="comment-line"># Connect to a chassis, reserve ports, and create the mapping between the </span>
   <span class="comment-line">#   physical ports and their logical representation in the test configuration.</span>
   puts &#34;[clock format [clock seconds] -format %m-%d-%Y%l:%M:%S%p] Attaching Ports ...&#34;
   <a name="::logcmd(31)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform attachPorts -portList $lstPorts -autoConnect TRUE
   
   <span class="comment-line"># Subscribe to realtime results</span>
   <a name="::logcmd(32)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::subscribe -Parent $hProject -ConfigType Analyzer -resulttype AnalyzerPortResults
   <a name="::logcmd(33)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::subscribe -Parent $hProject -ConfigType Generator -resulttype GeneratorPortResults

   foreach i [lsort -dictionary [array names ahSpirentPort]] {
       set phyList [<a name="::getPhyObject(1)"><a href="./spirent.tcl.html#::getPhyObject_5748">::getPhyObject</a></a> $ahSpirentPort($i)]
       set STCPORTID($i,port) $ahSpirentPort($i)
       puts &#34;phyList $phyList&#34;
       set pLen [llength $phyList]
       <span class="comment-line">#set myPhy [lindex $phyList [expr $pLen - 1]]</span>
       set myPhy [lindex $phyList 0]
       set STCPORTID($i,speed) [string toupper [<a name="::logcmd(34)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $myPhy -LineSpeedStatus]]
       set STCPORT($ahSpirentPort($i),speed) $STCPORTID($i,speed)
       puts &#34;Got port speed $STCPORTID($i,speed)&#34;      
   }

   <span class="comment-line"># configure analyzers to NOT use signature filter</span>
   foreach port $lstPorts {
      <a name="::logcmd(35)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(36)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $port -children-Analyzer] -FilterOnStreamId FALSE
   }

   <span class="comment-line"># set phy mode fiber if needed</span>
   if {[info exist ::phyMode]} {
      if {[llength [join $::phyMode { }]] == 1} {
         switch [string tolower $::phyMode] {
            copper {}
            fiber  {
               foreach port [lsort -dictionary [array names ahSpirentPort]] {
                  set FiberClient [<a name="::logcmd(37)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create &#34;EthernetFiber&#34; \
                                      -under $ahSpirentPort($port) \
                                      -LineSpeed $STCPORTID($port,speed) \
                                      -AutoNegotiation &#34;TRUE&#34; \
                                      -AutoNegotiationMasterSlave &#34;MASTER&#34; \
                                      -FlowControl &#34;FALSE&#34; \
                                      -DataPathMode &#34;NORMAL&#34; \
                                      -Mtu &#34;1500&#34; \
                                      -PortSetupMode &#34;PORTCONFIG_ONLY&#34; \
                                      -Active &#34;TRUE&#34; \
                                      -LocalActive &#34;TRUE&#34; \
                                      -Name &#34;Fiber client $port&#34; ]
                  <a name="::logcmd(38)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $ahSpirentPort($port) -ActivePhy-targets $FiberClient                 
               }
            }
            default { error &#34;Unexpected phyMode '$::phyMode' should be 'copper', 'fiber' or '&lt;port&gt; &lt;mode&gt; ...'&#34;}
         }
      } else {
         set a 0
         foreach {<a name="::port(1)"><a href="./spirent.tcl.html#::port_927">::port</a></a> mode} [join $::phyMode { }] {
            switch [string tolower $mode] {
               a {}
               copper {}
               fiber  {
                  set FiberClient [<a name="::logcmd(39)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create &#34;EthernetFiber&#34; \
                                      -under $ahSpirentPort($port) \
                                      -LineSpeed $STCPORTID($port,speed) \
                                      -AutoNegotiation &#34;TRUE&#34; \
                                      -AutoNegotiationMasterSlave &#34;MASTER&#34; \
                                      -FlowControl &#34;FALSE&#34; \
                                      -DataPathMode &#34;NORMAL&#34; \
                                      -Mtu &#34;1500&#34; \
                                      -PortSetupMode &#34;PORTCONFIG_ONLY&#34; \
                                      -Active &#34;TRUE&#34; \
                                      -LocalActive &#34;TRUE&#34; \
                                      -Name &#34;Fiber client $port&#34; ]
                  <a name="::logcmd(40)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $ahSpirentPort($port) -ActivePhy-targets $FiberClient                 
               }
               default { error &#34;Unexpected phyMode '$::phyMode' should be 'copper', 'fiber' or '&lt;port&gt; &lt;mode&gt; ...'&#34;}
            }
            incr a
         }
      }
   }
   <a name="::logcmd(41)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
}

<strong><a name="::::hMapPortIdToSpirentPort_216">proc <a href="spirent.tcl-annot.html#::::hMapPortIdToSpirentPort">::::hMapPortIdToSpirentPort</a></a></strong> {lstIxiaPortIds} {
   global ahSpirentPort
   
   set lsthPorts {}
   
   foreach iIxiaPortId $lstIxiaPortIds {
      if {[string is integer $iIxiaPortId]} {
         lappend lsthPorts $ahSpirentPort($iIxiaPortId)
      } else {
         lappend lsthPorts $iIxiaPortId
      }
   }
   
   return $lsthPorts
}

<strong><a name="::::stcGetPortPhy_232">proc <a href="spirent.tcl-annot.html#::::stcGetPortPhy">::::stcGetPortPhy</a></a></strong> {portId} {

    return [<a name="::logcmd(42)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -ActivePhy]

}

<strong><a name="::::stcGetMedia_238">proc <a href="spirent.tcl-annot.html#::::stcGetMedia">::::stcGetMedia</a></a></strong> {portId} {
    set phy [<a name="::logcmd(43)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -ActivePhy]
    if {[regexp -nocase &#34;iber&#34; $phy]} {
        return &#34;FIBER&#34;
    } elseif {[regexp -nocase &#34;opper&#34; $phy]} {
        return &#34;COPPER&#34;
    } else {
        return &#34;DEFAULT&#34;
    }
}

<strong><a name="::::nl_resetIxiaPort_249">proc  <a href="spirent.tcl-annot.html#::::nl_resetIxiaPort">::::nl_resetIxiaPort</a></a></strong> { {portId &#34;1&#34;} } {
    <span class="comment-line">#Stop generator before making changes.</span>
    set hand [<a name="::hMapPortIdToSpirentPort(3)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]
    set hGenerator [<a name="::logcmd(44)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hand -children-Generator]
    <a name="::logcmd(45)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $hGenerator
    <span class="comment-line"># Delete all streamblocks on tx port</span>
    <a name="::deleteAllStreams(1)"><a href="./spirent.tcl.html#::deleteAllStreams_3469">::deleteAllStreams</a></a> $hand
    <span class="comment-line"># Delete all devices on the port</span>
    <a name="::cleanupBgp(1)"><a href="./spirent.tcl.html#::cleanupBgp_4924">::cleanupBgp</a></a> $portId
    <span class="comment-line"># clear all the stats</span>
    <a name="::ixClearStats(1)"><a href="./spirent.tcl.html#::ixClearStats_692">::ixClearStats</a></a> $portId
}

<strong><a name="::::setStreamAdvanceMode_262">proc <a href="spirent.tcl-annot.html#::::setStreamAdvanceMode">::::setStreamAdvanceMode</a></a></strong> {{portId 1}} {
    puts &#34;setStreamAdvanceMode $portId ignored on STC&#34;
}
<strong><a name="::::SaveToDatabase_265">proc <a href="spirent.tcl-annot.html#::::SaveToDatabase">::::SaveToDatabase</a></a></strong> {} {
   <a name="::logcmd(46)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform SaveToTccCommand -FileName config.tcc
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetFrameContentsFromStreamblock</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Retrieve streamblock header information</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              handle to a Spirent streamblock</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: string contain header and attribute value pairs</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################            </span>
<strong><a name="::::GetFrameContentsFromStreamblock_284">proc <a href="spirent.tcl-annot.html#::::GetFrameContentsFromStreamblock">::::GetFrameContentsFromStreamblock</a></a></strong> {hStreamblock} {
   
   set szFrameContents &#34;&#34;
   
   <span class="comment-line"># Retrieve headers from streamblock.</span>
   foreach hChild [<a name="::logcmd(47)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hStreamblock -children] {
      <a name="::GetObjectAttributes(1)"><a href="./spirent.tcl.html#::GetObjectAttributes_296">::GetObjectAttributes</a></a> $hChild szFrameContents
   }
   
   return [string trimleft $szFrameContents \n]
}

<strong><a name="::::GetObjectAttributes_296">proc <a href="spirent.tcl-annot.html#::::GetObjectAttributes">::::GetObjectAttributes</a></a></strong> {hParent szFrameContentsName} {
   upvar $szFrameContentsName szFrameContents
   
   <span class="comment-line"># Ignore the following objects.</span>
   if {[regexp -nocase modifier|vntags $hParent]} { return }
   
   <span class="comment-line"># Retrieve attribute/value pairs.</span>
   set lstElements [<a name="::logcmd(48)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hParent]
   set szAttributes &#34;&#34;
   foreach {szAttribute szValue} $lstElements {
      if {![regexp -nocase -- -parent|-Active|-Name|-children $szAttribute]} {
         append szAttributes &#34; $szAttribute $szValue&#34;
      }
   }
   
   if {![string equal $szAttributes &#34;&#34;]} {
      append szFrameContents \n[lindex [split $hParent :] 0]: &#34; $szAttributes&#34;
   }
   
   <span class="comment-line"># Retrieve children objects from parent.</span>
   set lsthChildren [<a name="::logcmd(49)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hParent -children]
   
   foreach hChild $lsthChildren {
      <a name="::GetObjectAttributes(2)"><a href="./spirent.tcl.html#::GetObjectAttributes_296">::GetObjectAttributes</a></a> $hChild szFrameContents
   }
   return $szFrameContents
}

<span class="comment-line">#proc MapIxiaPortId {portId chasName cardName portName} {</span>
<span class="comment-line">#  upvar $chasName chas</span>
<span class="comment-line">#  upvar $cardName card</span>
<span class="comment-line">#  upvar $portName port</span>

<span class="comment-line">#  set chas 1</span>
<span class="comment-line">#  set card 1</span>
<span class="comment-line">#  set port 1</span>
<span class="comment-line">#}</span>
<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: stcCheckTxDone</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	 Check if trafficcneter transmission is done as expected no. of frames.</span>
<span class="comment-line"># Input args: {$txPortId} {targetTxNum}</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	ixiaCheckTxDone -txPortId 1</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ixiaCheckTxDone_343">proc <a href="spirent.tcl-annot.html#::::ixiaCheckTxDone">::::ixiaCheckTxDone</a></a></strong> {txChasisId txCard txPort numFrames txPortId} {
   puts &#34;[lindex [info level 0] 0] : $txChasisId $txCard $txPort $numFrames $txPortId&#34;
   return [<a name="::stcCheckTxDone(1)"><a href="./spirent.tcl.html#::stcCheckTxDone_348">::stcCheckTxDone</a></a> -txPortId $txPortId]
}

<strong><a name="::::stcCheckTxDone_348">proc <a href="spirent.tcl-annot.html#::::stcCheckTxDone">::::stcCheckTxDone</a></a></strong> { args } {
   
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> stcCheckTxDone $args {
      txPortId &#34;1&#34;
      maxWait &#34;360&#34;
   }
   
   
   set hGenerator [<a name="::logcmd(50)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(4)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId] -children-Generator]
   set genState [<a name="::logcmd(51)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hGenerator -State]
   
   set endtime [expr [clock seconds] + $maxWait]
   while {$genState != &#34;STOPPED&#34;} {
      <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Waiting for STC Traffic to Complete.  Current State: $genState&#34;
      <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
      set genState [<a name="::logcmd(52)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hGenerator -State]
      if {[clock seconds] &gt;= $endtime} {
         <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;The TestCenter port did not finish transmission in $maxWait seconds&#34;
         stc::perform GeneratorStop -GeneratorList $hGenerator
         return
      }
   }
}

<span class="comment-line">###############################################################################</span>
<span class="comment-line"># Procedure:   getIpV4MaskWidth</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc gets ip mask as input and calculates the maskWidth.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Arguments:   ip mask - ipV4 format.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Returns      mask width.</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::getIpV4MaskWidth2_381">proc <a href="spirent.tcl-annot.html#::::getIpV4MaskWidth2">::::getIpV4MaskWidth2</a></a></strong> {ipV4Mask} {
   scan $ipV4Mask &#34;%d.%d.%d.%d&#34; b1 b2 b3 b4
   
   set result  [expr ($b4 | $b3 &lt;&lt; 8 | $b2 &lt;&lt; 16 | $b1 &lt;&lt; 24) ^ 0xFFFFFFFF]
   
   for {set mask  0} { $mask &lt; 32} {incr mask} {
      if { [expr $result &gt;&gt; $mask] == 0} {
         break;
      }
   }
   set mask [expr 32 - $mask]
   
   return $mask
}
<span class="comment-line">########################################################################</span>
<span class="comment-line"># Procedure: incrIpv6Field</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Increments the specified byte of IPv6 address</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Argument(s):</span>
<span class="comment-line">#   ipAddress       IPv6 address whose byte to be incremented</span>
<span class="comment-line">#   byteNum         the byte field to be incremented</span>
<span class="comment-line">#   amount             increment the field by this number</span>
<span class="comment-line">#</span>
<span class="comment-line">########################################################################</span>
<strong><a name="::::incrIpv6Field_407">proc <a href="spirent.tcl-annot.html#::::incrIpv6Field">::::incrIpv6Field</a></a></strong> {ipv6Address {byteNum 16} {amount 1}} {
   set ipv6Address [regsub :: $ipv6Address [string repeat &#34;:0&#34; [expr 8-[llength [split $ipv6Address :]]+1]]:]
   set byteIndex [expr round($byteNum/2.0) - 1]
   return [join [lreplace [split $ipv6Address :] $byteIndex $byteIndex [format %x [expr 0x[lindex [split $ipv6Address :] $byteIndex]+$amount]] ] :]
   
}

<span class="comment-line">################################################################################</span>
<span class="comment-line"># Default MAC address based on portId</span>
<span class="comment-line">################################################################################</span>
<strong><a name="::::GetDefaultPortIdMAC_417">proc <a href="spirent.tcl-annot.html#::::GetDefaultPortIdMAC">::::GetDefaultPortIdMAC</a></a></strong> {args} {
   
   array set arg $args
   
   switch -exact -- $arg(-portId) {
      &#34;port1&#34; - 
      &#34;1&#34; {
         return &#34;00:A1:F1:00:00:01&#34;
      }
      &#34;port2&#34; -
      &#34;2&#34; {
         return &#34;00:A1:F2:00:00:01&#34;
      }
      &#34;port3&#34; -
      &#34;3&#34; {
         return &#34;00:A1:F3:00:00:01&#34;
      }
      &#34;port4&#34; -
      &#34;4&#34; {
         return &#34;00:A1:F4:00:00:01&#34;
      }
      &#34;port5&#34; -
      &#34;5&#34; {
         return &#34;00:A2:F1:00:00:01&#34;
      }
      &#34;port6&#34; -
      &#34;6&#34; {
         return &#34;00:A2:F2:00:00:01&#34;
      }
      &#34;port7&#34; -
      &#34;7&#34; {
         return &#34;00:A2:F3:00:00:01&#34;
      }
      &#34;port8&#34; -
      &#34;8&#34; {
         return &#34;00:A2:F4:00:00:01&#34;
      }
      &#34;port9&#34; -
      &#34;9&#34; {
         return &#34;00:A3:F1:00:00:01&#34;
        }
      &#34;port10&#34; -
      &#34;10&#34; {
         return &#34;00:A3:F2:00:00:01&#34;
      }
      &#34;port11&#34; -
      &#34;11&#34; {
         return &#34;00:A3:F3:00:00:01&#34;
      }
      &#34;port12&#34; -
      &#34;12&#34; {
         return &#34;00:A3:F4:00:00:01&#34;
      }
      default { error &#34;Could not get default MAC address for port \&#34;$arg(-portId)\&#34;&#34;}
   }
}

<span class="comment-line"># from CheckArp.tcl</span>
<strong><a name="::::EnableProtocolServer_475">proc <a href="spirent.tcl-annot.html#::::EnableProtocolServer">::::EnableProtocolServer</a></a></strong> {portIdList ipAddressList {taglist &#34;none&#34;} {pingEnable &#34;false&#34;} \
                          {gwIpList &#34;0.0.0.0&#34;} {nwrangelist &#34;none&#34;} {numAddr 1} {netMask 24} } {

   if {$nwrangelist == &#34;none&#34; } {
      if {[llength $portIdList] != [llength $ipAddressList]} {
         <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Number of list elements do not match.&#34;
         return 0
      }    
   }

   foreach portId $portIdList tag $taglist gwIp $gwIpList ipAddr $ipAddressList {
      if {$nwrangelist == &#34;none&#34; } {
         set tag $taglist 
      }
      if {$gwIp == &#34;&#34;} {set gwIp &#34;$ipAddr&#34;}       
      set devhandle [<a name="::AddIpAddress(1)"><a href="./ixiaProtSrv.tcl.html#::AddIpAddress_468">::AddIpAddress</a></a> $portId $ipAddr -tag $tag -netMask $netMask -gwIpAddr $gwIp]
      <a name="::logcmd(53)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $devhandle -EnablePingResponse $pingEnable
   }
   <a name="::logcmd(54)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
   return 1 
}

<strong><a name="::::DisableProtocolServer_497">proc <a href="spirent.tcl-annot.html#::::DisableProtocolServer">::::DisableProtocolServer</a></a></strong> {portIdList ipAddressList} {
   foreach portId $portIdList ipAddress $ipAddressList {
      set devlist [<a name="::logcmd(55)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(5)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -affiliationport-Sources]
      foreach dev $devlist {
         set items [concat [<a name="::logcmd(56)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $dev -children-ipv4if] [<a name="::logcmd(57)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $dev -children-ipv6if]]
         puts $items
         set ipaddrs {}
         foreach item $items {lappend ipaddrs [<a name="::logcmd(58)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $item -address]}
         puts $ipaddrs
         foreach ipaddr $ipaddrs {
            if {$ipaddr == $ipAddress} {
               <a name="::logcmd(59)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $dev -active false
            }
         }
      }
   }
}

<strong><a name="::::SaveAndSetProtocolServer_515">proc <a href="spirent.tcl-annot.html#::::SaveAndSetProtocolServer">::::SaveAndSetProtocolServer</a></a></strong> {portId ipAddr gwIpAddr objName args} {
    puts &#34;Don't save proto server on Spirent&#34;
    return
}


<strong><a name="::::RestoreProtocolServer_521">proc <a href="spirent.tcl-annot.html#::::RestoreProtocolServer">::::RestoreProtocolServer</a></a></strong> {portIdList ipAddressList arpEnable {pingEnable &#34;&#34;}} {
   if {[llength $portIdList] != [llength $ipAddressList]} {
      <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Number of list elements do not match.&#34;
      return
   }
   foreach portId $portIdList ipAddress $ipAddressList {
      set devlist [<a name="::logcmd(60)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(6)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -children-router]
      foreach dev $devlist {
         set ipaddr [<a name="::logcmd(61)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::logcmd(62)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $dev -children-ipv4if] -address]
         if {$ipaddr == $ipAddress} {
            <a name="::logcmd(63)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $dev -active true
         }
      }
   }
}
  
<span class="comment-line"># do not set protocol gateway in this proc so make it do nothing</span>
<strong><a name="::::SetGwIpAddr_538">proc <a href="spirent.tcl-annot.html#::::SetGwIpAddr">::::SetGwIpAddr</a></a></strong> {portId gIpAddr args} {
   return
}

<span class="comment-line"># return 1 because the Delte IP address code will determine if one needs to be deleted</span>
<strong><a name="::::GetIpAddress_543">proc <a href="spirent.tcl-annot.html#::::GetIpAddress">::::GetIpAddress</a></a></strong> {portId ipAddr args} {
   return 1
}

<span class="comment-line"># not used so do nothing</span>
<strong><a name="::::GetProtocolServerInfo_548">proc <a href="spirent.tcl-annot.html#::::GetProtocolServerInfo">::::GetProtocolServerInfo</a></a></strong> {portId args} {
   return
}

<span class="comment-line"># not used so do nothing</span>
<strong><a name="::::SetProtocolServerInfo_553">proc <a href="spirent.tcl-annot.html#::::SetProtocolServerInfo">::::SetProtocolServerInfo</a></a></strong> {portId args} {
   return
}

<span class="comment-line"># not used so do nothing</span>
<strong><a name="::::GetGwIpAddr_558">proc <a href="spirent.tcl-annot.html#::::GetGwIpAddr">::::GetGwIpAddr</a></a></strong> {portId} {
   return n/a
}

<strong><a name="::::getIxiaCardType_562">proc <a href="spirent.tcl-annot.html#::::getIxiaCardType">::::getIxiaCardType</a></a></strong> {id} {
   return n/a
}

<strong><a name="::::ixiaCapturedFramesTimeStamp_566">proc <a href="spirent.tcl-annot.html#::::ixiaCapturedFramesTimeStamp">::::ixiaCapturedFramesTimeStamp</a></a></strong> {{ch 1} {cd 1} {pt 1} {fd_res &#34;NULL&#34;} {fd_in &#34;NULL&#34;}} {
   set portId $pt
   <a name="::StopPortsCapture(1)"><a href="./spirent.tcl.html#::StopPortsCapture_828">::StopPortsCapture</a></a> $portId
   set hCapture [<a name="::logcmd(64)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(7)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -children-capture]
   set pktCount [<a name="::logcmd(65)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hCapture -PktCount]
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;pktCount $pktCount&#34;
   set packetCaptureTimestamps {}
   for {set i 0} {$i &lt; $pktCount} {incr i} {
      array set returnList [<a name="::logcmd(66)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureGetFrameCommand -CaptureProxyId $hCapture -FrameIndex $i]
      lappend packetCaptureTimestamps $returnList(-Timestamp)
   }      
   return $packetCaptureTimestamps
}

<strong><a name="::::ixiaConf_clearStat_580">proc <a href="spirent.tcl-annot.html#::::ixiaConf_clearStat">::::ixiaConf_clearStat</a></a></strong> {{cardNo 1} {chid 1}} {
   <span class="comment-line"># always assume we will clear stats on all ports</span>
   <a name="::logcmd(67)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList [<a name="::getPortList(1)"><a href="./spirent.tcl.html#::getPortList_3759">::getPortList</a></a>]
}

<strong><a name="::::ixServer_read_585">proc <a href="spirent.tcl-annot.html#::::ixServer_read">::::ixServer_read</a></a></strong> {channel} {
   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}

<strong><a name="::::SetupIxiaConnections_590">proc <a href="spirent.tcl-annot.html#::::SetupIxiaConnections">::::SetupIxiaConnections</a></a></strong> {} { return }

<strong><a name="::::ixDisconnectTclServer_592">proc <a href="spirent.tcl-annot.html#::::ixDisconnectTclServer">::::ixDisconnectTclServer</a></a></strong> {{serverName &#34;&#34;}} {
   <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixInitialize_596">proc <a href="spirent.tcl-annot.html#::::ixInitialize">::::ixInitialize</a></a></strong> {serverName} {
   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixConnectToTclServer_600">proc <a href="spirent.tcl-annot.html#::::ixConnectToTclServer">::::ixConnectToTclServer</a></a></strong> {serverName} {
   <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixLogin_604">proc <a href="spirent.tcl-annot.html#::::ixLogin">::::ixLogin</a></a></strong> {userName} {
   <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixLogout_608">proc <a href="spirent.tcl-annot.html#::::ixLogout">::::ixLogout</a></a></strong> {} {
   <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixTakeOwnership_612">proc <a href="spirent.tcl-annot.html#::::ixTakeOwnership">::::ixTakeOwnership</a></a></strong> {txRxList {takeType &#34;&#34;}} {
   <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixPortTakeOwnership_616">proc <a href="spirent.tcl-annot.html#::::ixPortTakeOwnership">::::ixPortTakeOwnership</a></a></strong> {chassis lm port {takeType &#34;&#34;}} {
   <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return 0
}
<strong><a name="::::ixClearOwnership_620">proc <a href="spirent.tcl-annot.html#::::ixClearOwnership">::::ixClearOwnership</a></a></strong> {{txRxList &#34;&#34; } {takeType &#34;&#34;}} {
   <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixPortClearOwnership_624">proc <a href="spirent.tcl-annot.html#::::ixPortClearOwnership">::::ixPortClearOwnership</a></a></strong> {chassis lm port {takeType &#34;&#34;}} {
   <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return 0
}
<strong><a name="::::ixCheckOwnership_628">proc <a href="spirent.tcl-annot.html#::::ixCheckOwnership">::::ixCheckOwnership</a></a></strong> {txRxList} {
   <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixConnectToChassis_632">proc <a href="spirent.tcl-annot.html#::::ixConnectToChassis">::::ixConnectToChassis</a></a></strong> {chassisList {cableLength cable3feet}} {
   <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixGetChassisID_636">proc <a href="spirent.tcl-annot.html#::::ixGetChassisID">::::ixGetChassisID</a></a></strong> {chassisName} {
   <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return n/a
}
<strong><a name="::::ixDisconnectFromChassis_640">proc <a href="spirent.tcl-annot.html#::::ixDisconnectFromChassis">::::ixDisconnectFromChassis</a></a></strong> {args} {
   <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixStartTransmit_644">proc <a href="spirent.tcl-annot.html#::::ixStartTransmit">::::ixStartTransmit</a></a></strong> {PortList} {
   set ports [<a name="::hMapPortIdToSpirentPort(8)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> [<a name="::getPortsFromChassCardPortList(1)"><a href="./spirent.tcl.html#::getPortsFromChassCardPortList_5505">::getPortsFromChassCardPortList</a></a> [uplevel &#34;set $PortList&#34;]]]
   <a name="::StartPortsTransmit(1)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $ports
<span class="comment-line">#   result_debug &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;</span>
   return
}
<strong><a name="::::startTx_650">proc <a href="spirent.tcl-annot.html#::::startTx">::::startTx</a></a></strong> {PortList} {
   set ports [<a name="::hMapPortIdToSpirentPort(9)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> [<a name="::getPortsFromChassCardPortList(2)"><a href="./spirent.tcl.html#::getPortsFromChassCardPortList_5505">::getPortsFromChassCardPortList</a></a> [uplevel &#34;set $PortList&#34;]]]
   <a name="::StartPortsTransmit(2)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $ports
<span class="comment-line">#   result_debug &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;</span>
   return
}
<strong><a name="::::ixStartPortTransmit_656">proc <a href="spirent.tcl-annot.html#::::ixStartPortTransmit">::::ixStartPortTransmit</a></a></strong> {chassis lm port} {
   set ports [<a name="::hMapPortIdToSpirentPort(10)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> [<a name="::getPortsFromChassCardPortList(3)"><a href="./spirent.tcl.html#::getPortsFromChassCardPortList_5505">::getPortsFromChassCardPortList</a></a> [uplevel &#34;set $PortList&#34;]]]
   <a name="::StartPortsTransmit(3)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $ports
<span class="comment-line">#   result_debug &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;</span>
   return
}
<strong><a name="::::ixStopTransmit_662">proc <a href="spirent.tcl-annot.html#::::ixStopTransmit">::::ixStopTransmit</a></a></strong> {PortList} {
   set ports [<a name="::hMapPortIdToSpirentPort(11)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> [<a name="::getPortsFromChassCardPortList(4)"><a href="./spirent.tcl.html#::getPortsFromChassCardPortList_5505">::getPortsFromChassCardPortList</a></a> [uplevel &#34;set $PortList&#34;]]]
   <a name="::StopPortsTransmit(1)"><a href="./spirent.tcl.html#::StopPortsTransmit_902">::StopPortsTransmit</a></a> $ports
<span class="comment-line">#   result_debug &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;</span>
   return
}
<strong><a name="::::ixStartCapture_668">proc <a href="spirent.tcl-annot.html#::::ixStartCapture">::::ixStartCapture</a></a></strong> {PortList} {
   <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixStopCapture_672">proc <a href="spirent.tcl-annot.html#::::ixStopCapture">::::ixStopCapture</a></a></strong> {PortList} {
   <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixStartPortCapture_676">proc <a href="spirent.tcl-annot.html#::::ixStartPortCapture">::::ixStartPortCapture</a></a></strong> {chassis lm port} {
      <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::stopPortCapture_680">proc <a href="spirent.tcl-annot.html#::::stopPortCapture">::::stopPortCapture</a></a></strong> {chassis lm port} {
   <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::startPortCapture_684">proc <a href="spirent.tcl-annot.html#::::startPortCapture">::::startPortCapture</a></a></strong> {chassis lm port} {
   <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixStopPortCapture_688">proc <a href="spirent.tcl-annot.html#::::ixStopPortCapture">::::ixStopPortCapture</a></a></strong> {chassis lm port {groupId 710} {create create} {destroy destroy}} {
   <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixClearStats_692">proc <a href="spirent.tcl-annot.html#::::ixClearStats">::::ixClearStats</a></a></strong> {PortList} {
   set ports [<a name="::hMapPortIdToSpirentPort(12)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> [<a name="::getPortsFromChassCardPortList(5)"><a href="./spirent.tcl.html#::getPortsFromChassCardPortList_5505">::getPortsFromChassCardPortList</a></a> &#34;$PortList&#34;]]
   <a name="::logcmd(68)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList $ports
   
   return
}
<strong><a name="::::ixClearPortStats_698">proc <a href="spirent.tcl-annot.html#::::ixClearPortStats">::::ixClearPortStats</a></a></strong> {chassis lm port} {
   <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::zeroPortStats_702">proc <a href="spirent.tcl-annot.html#::::zeroPortStats">::::zeroPortStats</a></a></strong> {chassis lm port} {
   <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixSetPacketStreamMode_706">proc <a href="spirent.tcl-annot.html#::::ixSetPacketStreamMode">::::ixSetPacketStreamMode</a></a></strong> {TxRxArray {write nowrite}} {
   <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixSetPortPacketStreamMode_710">proc <a href="spirent.tcl-annot.html#::::ixSetPortPacketStreamMode">::::ixSetPortPacketStreamMode</a></a></strong> {chassis lm port {write nowrite}} {
   <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixWritePortsToHardware_714">proc <a href="spirent.tcl-annot.html#::::ixWritePortsToHardware">::::ixWritePortsToHardware</a></a></strong> {PortArray args} {
   <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::writeConfigToHardware_718">proc <a href="spirent.tcl-annot.html#::::writeConfigToHardware">::::writeConfigToHardware</a></a></strong> {PortArray args} {
   <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}

<strong><a name="::::ixWriteConfigToHardware_723">proc <a href="spirent.tcl-annot.html#::::ixWriteConfigToHardware">::::ixWriteConfigToHardware</a></a></strong> {PortArray args} {
   <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}

<strong><a name="::::ixCheckTransmitDone_728">proc <a href="spirent.tcl-annot.html#::::ixCheckTransmitDone">::::ixCheckTransmitDone</a></a></strong> {PortArray} {

   set maxWait 10

   set endtime [expr [clock seconds] + $maxWait]
   puts $PortArray
   puts [uplevel &#34;set $PortArray&#34;]
   set ports [<a name="::hMapPortIdToSpirentPort(13)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> [<a name="::getPortsFromChassCardPortList(6)"><a href="./spirent.tcl.html#::getPortsFromChassCardPortList_5505">::getPortsFromChassCardPortList</a></a> [uplevel &#34;set $PortArray&#34;]]]
   set generators {}
   foreach port $ports { 
      lappend generators [<a name="::logcmd(69)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(14)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $port] -children-Generator]
   }
   while {1} {
      if {[clock seconds] &gt; $endtime} { break }
      set done 1
      foreach hGenerator $generators {
         if {[<a name="::logcmd(70)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hGenerator -State] != &#34;STOPPED&#34;} { set done 0 ; break }
      }
      if {$done == 1} { break }
   }
   stc::perform GeneratorStop -GeneratorList $generators
   <span class="comment-line">#  result_debug &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;</span>
   return
}

<strong><a name="::::ixCheckPortTransmitDone_753">proc <a href="spirent.tcl-annot.html#::::ixCheckPortTransmitDone">::::ixCheckPortTransmitDone</a></a></strong> {chassis lm port} {
   <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixCheckLinkState_757">proc <a href="spirent.tcl-annot.html#::::ixCheckLinkState">::::ixCheckLinkState</a></a></strong> {PortArray {message messageOn}} {
   <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixRequestStats_761">proc <a href="spirent.tcl-annot.html#::::ixRequestStats">::::ixRequestStats</a></a></strong> {TxRxArray} {
   <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixEnableArpResponse_765">proc <a href="spirent.tcl-annot.html#::::ixEnableArpResponse">::::ixEnableArpResponse</a></a></strong> { mapType PortMap } {
   <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixEnablePortArpResponse_769">proc <a href="spirent.tcl-annot.html#::::ixEnablePortArpResponse">::::ixEnablePortArpResponse</a></a></strong> { mapType chassis lm port {write write}} {
   <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixDisableArpResponse_773">proc <a href="spirent.tcl-annot.html#::::ixDisableArpResponse">::::ixDisableArpResponse</a></a></strong> { PortMap } {
   <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixTransmitArpRequest_777">proc <a href="spirent.tcl-annot.html#::::ixTransmitArpRequest">::::ixTransmitArpRequest</a></a></strong> {TxRxArray} {
   <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixDisablePortArpResponse_781">proc <a href="spirent.tcl-annot.html#::::ixDisablePortArpResponse">::::ixDisablePortArpResponse</a></a></strong> {chassis lm port {write write}} {
   <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixTransmitPortArpRequest_785">proc <a href="spirent.tcl-annot.html#::::ixTransmitPortArpRequest">::::ixTransmitPortArpRequest</a></a></strong> {chassis lm port} {
   <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[lindex [info level 0] 0] : Not Supported by Spirent TestCenter&#34;
   return
}
<strong><a name="::::ixiaStartCaptureCards_789">proc <a href="spirent.tcl-annot.html#::::ixiaStartCaptureCards">::::ixiaStartCaptureCards</a></a></strong> {{numIxiaCd 1} {startCardNum 1} {chid 1}} {
   <a name="::StartPortsCapture(1)"><a href="./spirent.tcl.html#::StartPortsCapture_807">::StartPortsCapture</a></a> [<a name="::getPortList(2)"><a href="./spirent.tcl.html#::getPortList_3759">::getPortList</a></a>] 
}
<strong><a name="::::ixiaStopCaptureCards_792">proc <a href="spirent.tcl-annot.html#::::ixiaStopCaptureCards">::::ixiaStopCaptureCards</a></a></strong> {{numIxiaCd 1} {startCardNum 1} {chid 1}} {
  <a name="::StopPortsCapture(2)"><a href="./spirent.tcl.html#::StopPortsCapture_828">::StopPortsCapture</a></a> [<a name="::getPortList(3)"><a href="./spirent.tcl.html#::getPortList_3759">::getPortList</a></a>] 
}
<strong><a name="::::ixiaStopTxCards_795">proc <a href="spirent.tcl-annot.html#::::ixiaStopTxCards">::::ixiaStopTxCards</a></a></strong> {{numIxiaCd 1} {startCardNum 1} {chid 1}} {
   <a name="::StartPortsTransmit(4)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> [<a name="::getPortList(4)"><a href="./spirent.tcl.html#::getPortList_3759">::getPortList</a></a>]
}
<strong><a name="::::ixTransmitIgmpJoin_798">proc <a href="spirent.tcl-annot.html#::::ixTransmitIgmpJoin">::::ixTransmitIgmpJoin</a></a></strong> {PortList} {
   set notsure [<a name="::getPortsFromChassCardPortList(7)"><a href="./spirent.tcl.html#::getPortsFromChassCardPortList_5505">::getPortsFromChassCardPortList</a></a> [uplevel &#34;set $PortList&#34;]]
   set ports [<a name="::hMapPortIdToSpirentPort(15)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> [<a name="::getPortsFromChassCardPortList(8)"><a href="./spirent.tcl.html#::getPortsFromChassCardPortList_5505">::getPortsFromChassCardPortList</a></a> [uplevel &#34;set $PortList&#34;]]]
   puts [uplevel &#34;set $PortList&#34;]
   puts &#34;NOTSURE:  $ports&#34;
   puts &#34;PORTS:    $ports&#34;
   <a name="::startIgmp(1)"><a href="./ePTigmp.tcl.html#::startIgmp_17">::startIgmp</a></a> $ports
}

<strong><a name="::::StartPortsCapture_807">proc <a href="spirent.tcl-annot.html#::::StartPortsCapture">::::StartPortsCapture</a></a></strong> {portIdList} {
   <span class="comment-line"># Enable capture on each of the ports.</span>
   foreach iPortId $portIdList {
      <span class="comment-line"># Get the capture object. (Automatically created)</span>
      if {[string is integer $iPortId]} {set iPortId [<a name="::hMapPortIdToSpirentPort(16)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $iPortId]}
      set hCapture [<a name="::logcmd(71)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $iPortId -children-capture]
      
      <span class="comment-line"># check to see if capture is already running if so, do nothing</span>
      if {[<a name="::logcmd(72)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hCapture -CaptureState] == &#34;RUNNING&#34;} { 
         puts &#34;CAPTURE ALREADY RUNNING&#34;
         continue 
      }

      <span class="comment-line"># Configure capture options.</span>
      <a name="::logcmd(73)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hCapture -mode REGULAR_MODE -srcMode TX_RX_MODE
      
      <span class="comment-line"># Start capturing on the port.</span>
      <a name="::logcmd(74)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureStart -captureProxyId $hCapture
   }
}

<strong><a name="::::StopPortsCapture_828">proc <a href="spirent.tcl-annot.html#::::StopPortsCapture">::::StopPortsCapture</a></a></strong> {portIdList} {
   <span class="comment-line"># Enable capture on each of the ports.</span>
   foreach iPortId $portIdList {
      <span class="comment-line"># Get the capture object. (Automatically created)</span>
      if {[string is integer $iPortId]} {set iPortId [<a name="::hMapPortIdToSpirentPort(17)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $iPortId]}
      set hCapture [<a name="::logcmd(75)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $iPortId -children-capture]
      
      <span class="comment-line"># Stop capturing on the port.</span>
      <a name="::logcmd(76)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureStop -captureProxyId $hCapture
      set TIMESTAMP [clock format [clock seconds] -format %m%d%y%H%M]
      <a name="::logcmd(77)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureDataSave -captureProxyId $hCapture -FileName &#34;/tmp/capture-$TIMESTAMP.pcap&#34; -FileNameFormat PCAP
      
   }
}

<strong><a name="::::GetCapturedFrames_843">proc <a href="spirent.tcl-annot.html#::::GetCapturedFrames">::::GetCapturedFrames</a></a></strong> {portId {fd_res &#34;NULL&#34;} {packThreshold 200} {retCount 0}} {
   <span class="comment-line"># Get the capture object.</span>
   <a name="::StopPortsCapture(3)"><a href="./spirent.tcl.html#::StopPortsCapture_828">::StopPortsCapture</a></a> $portId
   set hCapture [<a name="::logcmd(78)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(18)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -children-capture]
   set pktCount [<a name="::logcmd(79)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hCapture -PktCount]
   <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;pktCount $pktCount&#34;
   if {$pktCount &gt; $packThreshold} {
      set pktCount $retCount
      if {$retCount == 0} {
         <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;High number of packets ($pktCount) captured. \
                    Return without getting any packets&#34;
         return
      }
   }

   set packetCaptureData {}
   for {set i 0} {$i &lt; $pktCount} {incr i} {
      array set returnList [<a name="::logcmd(80)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureGetFrameCommand -CaptureProxyId $hCapture -FrameIndex $i]
      <span class="comment-line"># handle werid capture when in 10mbs mode, for some reason the preamble is 2 bytes shorter</span>
      if {[string match 5555555555D5* $returnList(-PacketData)]} {
         set szFrameContents [string range $returnList(-PacketData) 12 end]
      } else {
         set szFrameContents [string range $returnList(-PacketData) 16 end]
      }
      <span class="comment-line">#set szFrameContents [string range $returnList(-PacketData) 0 end]</span>
      set szFrameContents [scan $szFrameContents  [string repeat &#34;%2s&#34; [expr [string length $szFrameContents]/2]]]
      lappend packetCaptureData $szFrameContents
   }
   return $packetCaptureData   
}

<strong><a name="::::GetCapturedFramesTimeStampIndexed_874">proc <a href="spirent.tcl-annot.html#::::GetCapturedFramesTimeStampIndexed">::::GetCapturedFramesTimeStampIndexed</a></a></strong> {indexes portId} {
   <a name="::StopPortsCapture(4)"><a href="./spirent.tcl.html#::StopPortsCapture_828">::StopPortsCapture</a></a> $portId
   set hCapture [<a name="::logcmd(81)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(19)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -children-capture]
   set packetCaptureTimestamps {}
   foreach i $indexes {
      array set returnList [<a name="::logcmd(82)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureGetFrameCommand -CaptureProxyId $hCapture -FrameIndex $i]
      lappend packetCaptureTimestamps [expr round($returnList(-RawTimestamp)/ 400000000.0)]
      puts &#34;REAL TIMESTAMP : $returnList(-Timestamp)&#34;
   }      
   return $packetCaptureTimestamps
}

<strong><a name="::::StartPortsTransmit_886">proc <a href="spirent.tcl-annot.html#::::StartPortsTransmit">::::StartPortsTransmit</a></a></strong> {portIdList} {
   set idList {}
   foreach iPortId $portIdList {
      <span class="comment-line"># Retrieve the generator object for the port.</span>
      if {[string is integer $iPortId]} {set iPortId [<a name="::hMapPortIdToSpirentPort(20)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $iPortId]}
      lappend idList [<a name="::logcmd(83)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $iPortId -children-Generator]
   }
   <span class="comment-line"># Start the generator.</span>
   <a name="::logcmd(84)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStart -GeneratorList $idList

   <span class="comment-line"># Can't use this since rate tests are calculated after this call. There would be no rates</span>
   <span class="comment-line">#       if the traffic had completed.</span>
   <span class="comment-line"># Wait for traffic to stop.  Maximum wait time is 300 seconds.</span>
   <span class="comment-line">#  stc::perform GeneratorWaitForStop -GeneratorList $hGenerator -WaitTimeout 300</span>
}

<strong><a name="::::StopPortsTransmit_902">proc <a href="spirent.tcl-annot.html#::::StopPortsTransmit">::::StopPortsTransmit</a></a></strong> {portIdList} {
   set idList {}
   foreach iPortId $portIdList {
   <span class="comment-line"># Retrieve the generator object for the port.</span>
      if {[string is integer $iPortId]} {set iPortId [<a name="::hMapPortIdToSpirentPort(21)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $iPortId]}
      lappend idList [<a name="::logcmd(85)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $iPortId -children-Generator]
   }
   <span class="comment-line"># Start the generator.</span>
   <a name="::logcmd(86)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $idList

   <span class="comment-line"># Can't use this since rate tests are calculated after this call. There would be no rates</span>
   <span class="comment-line">#       if the traffic had completed.</span>
   <span class="comment-line"># Wait for traffic to stop.  Maximum wait time is 300 seconds.</span>
   <span class="comment-line">#  stc::perform GeneratorWaitForStop -GeneratorList $hGenerator -WaitTimeout 300</span>
}

<span class="comment-line">############################################################################################</span>
<span class="comment-line"># Ixia library commands to be overwritten</span>
<span class="comment-line">############################################################################################</span>

<span class="comment-line">#</span>
<span class="comment-line"># sample usage</span>
<span class="comment-line">#   stat getRate statAllStats $chasisId $card $port</span>
<span class="comment-line">#   set rateSent [stat cget -bytesSent]</span>
<span class="comment-line">#</span>
<strong><a name="::::port_927">proc <a href="spirent.tcl-annot.html#::::port">::::port</a></a></strong> {cmd args} {
   switch [string tolower $cmd] {
      get {  set ::_stc_portId [lindex $args 2] ;<span class="comment-line"># puts &#34;FOUND PORT ID $::_stc_portId from $args&#34; </span>}
      getrate {
         <span class="comment-line"># get port from argument (this is the port &#34;id&#34;, no need to translate)</span>
         <span class="comment-line"># set port to global as target</span>
         set ::_stc_ccp $args
         set ::_stc_portId [lindex $args 3]
         return 0
      }
      cget {
         foreach arg [string tolower $args] {
            switch $arg {
               -macaddress { return [<a name="::uniqMac(1)"><a href="./spirent.tcl.html#::uniqMac_4863">::uniqMac</a></a> [lindex $::_stc_ccp 0] [lindex $::_stc_ccp 1] [lindex $::_stc_ccp 2]] }
               -speed { 
                    switch [string toupper [<a name="::logcmd(87)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::getPhyObject(2)"><a href="./spirent.tcl.html#::getPhyObject_5748">::getPhyObject</a></a> [<a name="::hMapPortIdToSpirentPort(22)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $::_stc_portId]] -LineSpeedStatus]] {
                        SPEED_10M   { return 10 }
                        SPEED_100M  { return 100 }
                        SPEED_1G    { return 1000 }
                        SPEED_2500M { return 2500 }
                        SPEED_5G    { return 5000 }
                        SPEED_10G   { return 10000 }
                        SPEED_25G   { return 25000 }
                        SPEED_40G   { return 40000 }
                        SPEED_25G   { return 25000 }
                        SPEED_50G   { return 50000 }
                        SPEED_100G  { return 100000 }
                        default     { return 1000 }
                    }
               }
               -linkstate {
                  set state [string tolower [<a name="::logcmd(88)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::getPhyObject(3)"><a href="./spirent.tcl.html#::getPhyObject_5748">::getPhyObject</a></a> $::_stc_portId] -LinkStatus]]
                  if {$state == &#34;up&#34;} {return 1} else {return 0}
               }
               default { error &#34;STC does not support Port cget $arg&#34; }
            }
         }
      }  
   }
}
<strong><a name="::::stat_967">proc <a href="spirent.tcl-annot.html#::::stat">::::stat</a></a></strong> {cmd args} {
   
   switch [string tolower $cmd] {
      get -
      getrate {
         <span class="comment-line"># get port from argument (this is the port &#34;id&#34;, no need to translate)</span>
         <span class="comment-line"># set port to global as target</span>
         set ::_stc_portId [lindex $args 3]
      }
      cget {
         switch [set item [lindex $args 0]] {
            -bytesSent {
               return [<a name="::logcmd(89)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $::_stc_portId.Generator.GeneratorPortResults -GeneratorOctetCount]
            }
            -bytesReceived {
               return [<a name="::logcmd(90)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $::_stc_portId.Analyzer.AnalyzerPortResults -TotalOctetCount]
            }
            -framesSent {
               return [<a name="::logcmd(91)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $::_stc_portId.Generator.GeneratorPortResults -GeneratorFrameCount]
               error &#34;stat \&#34;$item\&#34; not supported BUT needs to be&#34;
            }
            -framesReceived {
               return [<a name="::logcmd(92)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $::_stc_portId.Analyzer.AnalyzerPortResults -TotalFrameCount]
            }
            -bitsReceived {
               return [expr wide([<a name="::logcmd(93)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $::_stc_portId.Analyzer.AnalyzerPortResults -TotalOctetCount]*8)]
            }
            -oversize {
               error &#34;stat \&#34;$item\&#34; not supported BUT needs to be&#34;
            }
            -vlanTaggedFramesRx {
               error &#34;stat \&#34;$item\&#34; not supported BUT needs to be&#34;
            }
            -rxArpRequest {
               error &#34;stat \&#34;$item\&#34; not supported BUT needs to be&#34;
            }
            -userDefinedStat1 {
               if {[set filtres [<a name="::logcmd(94)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [set ana [<a name="::logcmd(95)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $::_stc_portId -children-Analyzer]]\
                                    -children-FilteredStreamResults]] == {}} {
                  <a name="::logcmd(96)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::subscribe -parent project1 -resulttype FilteredStreamResults -configType Analyzer \
                     -viewAttributeList FrameRate -resultParent $::_stc_portId -interval 1
                  set ana [<a name="::logcmd(97)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $::_stc_portId -children-Analyzer]
                  set timeout [expr [clock seconds] + 5]
                  while {[set filtres [<a name="::logcmd(98)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ana -children-FilteredStreamResults]] == {}} {
                     after 1000
                     if {$timeout &lt; [clock seconds]} { 
                        return [<a name="::logcmd(99)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $::_stc_portId.Analyzer.AnalyzerPortResults -TotalFrameRate] 
                     }
                  }
               }
               set timeout [expr [clock seconds] + 10]
               while {[set darate [<a name="::logcmd(100)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $filtres -FrameRate]] == 0} {
                  after 1000
                  if {$timeout &lt; [clock seconds]} { return $darate }
               }
               return $darate
               <span class="comment-line"># return [logcmd stc::get $::_stc_portId.Analyzer.AnalyzerPortResults -TotalFrameRate]</span>
            }
            -rxPingReply {
               error &#34;stat \&#34;$item\&#34; not supported BUT needs to be&#34;
            }
            -counterVal {
               error &#34;stat \&#34;$item\&#34; not supported BUT needs to be&#34;
            }
            -ixTclProtocolVersion {
               return n/a
            }
            default { error &#34;stat \&#34;$item\&#34; not supported&#34;}
         }
      }
   }
}

<strong><a name="::::version_1040">proc <a href="spirent.tcl-annot.html#::::version">::::version</a></a></strong> {cmd args} {

   switch [string tolower $cmd] {
      get {}
      cget {
         switch [lindex $args 0] {
            -productVersion { return n/a }
         }
      }
   }
}

<strong><a name="::::map_1052">proc <a href="spirent.tcl-annot.html#::::map">::::map</a></a></strong> {args} { return }
<strong><a name="::::protocol_1053">proc <a href="spirent.tcl-annot.html#::::protocol">::::protocol</a></a></strong> {args} { return }
<strong><a name="::::ipV6_1054">proc <a href="spirent.tcl-annot.html#::::ipV6">::::ipV6</a></a></strong> {args} { return }
<strong><a name="::::stream_1055">proc <a href="spirent.tcl-annot.html#::::stream">::::stream</a></a></strong> {args} { return }
<strong><a name="::::captureBuffer_1056">proc <a href="spirent.tcl-annot.html#::::captureBuffer">::::captureBuffer</a></a></strong> {args} { return }
<strong><a name="::::mldServer_1057">proc <a href="spirent.tcl-annot.html#::::mldServer">::::mldServer</a></a></strong> {args} { return }

<strong><a name="::::ixStopPortTransmit_1059">proc <a href="spirent.tcl-annot.html#::::ixStopPortTransmit">::::ixStopPortTransmit</a></a></strong> {chas card port} {

    <a name="::StopPortsTransmit(2)"><a href="./spirent.tcl.html#::StopPortsTransmit_902">::StopPortsTransmit</a></a> $port
}

<strong><a name="::::MapIxiaPortId_1064">proc <a href="spirent.tcl-annot.html#::::MapIxiaPortId">::::MapIxiaPortId</a></a></strong> {  {portId 1}
                      {chasisIdName  1}
                      {cardName  1}
                      {portName  1} } {

   upvar $chasisIdName chasisId $cardName card $portName port
   set port [<a name="::hMapPortIdToSpirentPort(23)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]
   set loc [split [<a name="::logcmd(101)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $port -Location] /]
   set chasisId [lindex [split [lindex $loc 2] .] end]
   set card [lindex $loc 3]

   return $port
}

<strong><a name="::::GetNumIxiaCd_1078">proc <a href="spirent.tcl-annot.html#::::GetNumIxiaCd">::::GetNumIxiaCd</a></a></strong> {{totalPorts 0}} {
   return n/a
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: ixiaConf_2Ports_Dhcp</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       Set up an ixia port to send DHCP packets based on given</span>
<span class="comment-line">#       opCode and optionCodeList parameters</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       set frameSent [ixiaConf_2Ports_Dhcp -numIxiaCd $numIxiaCd \</span>
<span class="comment-line">#              -txChas $chasisId -txCard $card -txPort $port -startCardNum $startCardNum \</span>
<span class="comment-line">#              -rxChas $chasisId -rxCard $card -rxPort $rxPo \</span>
<span class="comment-line">#              -sMacAddr $sourceMac -dMacAddr $destMac \</span>
<span class="comment-line">#              -numFrames $numFrames -streamType $streamType -fcsError $fcsError \</span>
<span class="comment-line">#              -saMode $saMode -daMode $daMode -opCode $opCode \</span>
<span class="comment-line">#              -optionCodeList $optionCodeList -clientHwAddr $clientHwAddr ]</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ixiaConf_2Ports_Dhcp_1100">proc <a href="spirent.tcl-annot.html#::::ixiaConf_2Ports_Dhcp">::::ixiaConf_2Ports_Dhcp</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> ixiaConf_2Ports_Dhcp $args {
      numIxiaCd &#34;1&#34;
      startCardNum &#34;1&#34;
      direction &#34;1Way&#34;
      txChas &#34;n/a&#34;
      txCard &#34;n/a&#34;
      txPort &#34;port1&#34;
      rxChas &#34;n/a&#34;
      rxCard &#34;n/a&#34;
      rxPort &#34;port2&#34;
      sMacAddr &#34;00 00 86 52 55 CB&#34;
      dMacAddr &#34;ff ff ff ff ff ff&#34;
      sIpAddr &#34;0.0.0.0&#34;
      dIpAddr &#34;255.255.255.255&#34;
      srcPort &#34;68&#34;
      dstPort &#34;67&#34;
      numFrames &#34;1&#34;
      dataPattern &#34;0000&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      chid &#34;1&#34;
      clientHwAddr &#34;00 00 86 52 55 CB&#34;
      clientIpAddr &#34;0.0.0.0&#34;
      yourIpAddr &#34;0.0.0.0&#34;
      opCode &#34;dhcpBootRequest&#34;
      optionCodeList &#34;{dhcpMessageType dhcpDiscover}&#34;
      dontTx &#34;0&#34;
      wTag &#34;false&#34;
      tagNo &#34;002&#34;
      tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat &#34;1&#34;
   }

   global spawn_id
   global one2oneArray
   global macBroadcast
   global preambleSize
   
   set date [clock format [clock seconds] -format &#34;%m-%d-%Y %I.%M.%S%p&#34;]
   set time1 [clock seconds]
   
   set streamType       stopStream
   set patternOffset    32
   set macBroadcast     {ff ff ff ff ff ff}
   set preambleSize     8

   <span class="comment-line"># Config streams for validation traffic</span>
   set wkTag $wTag
   set wkTagNo $tagNo
   set portNo 0
   set portList {}
   set counter 0
   set txPorts {}
   lappend portList $txPort $rxPort
   if {$direction == &#34;2Way&#34;} {lappend portList $rxPort $txPort}

   foreach {txPort rxPort} $portList {
      set dataoffset 0
      set pktoffsets {}
      if { $wkTag == &#34;true&#34; } {
         set wTag &#34;true&#34;
         set tagNo [lindex $wkTagNo $portNo]
         incr portNo
         if { $tagNo == &#34;&#34; } {set tagNo [lindex $wkTagNo 0]}
         if { $tagNo == 0 || $tagNo == &#34;none&#34; } {set wTag &#34;false&#34;}
         <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;wTag = $wTag, tagNo = $tagNo&#34;
      }

      <span class="comment-line">#Stop generator before making changes.</span>
      <a name="::logcmd(102)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $txPort
      
      <span class="comment-line"># Delete all streamblocks on tx port</span>
      <a name="::deleteAllStreams(2)"><a href="./spirent.tcl.html#::deleteAllStreams_3469">::deleteAllStreams</a></a> $txPort
      
      <span class="comment-line"># initialize streamblock arguments</span>
      set stream_args {-insertSig FALSE -frameconfig {}}

      <span class="comment-line"># $fcsError</span>
      if {$fcsError == &#34;good&#34;} {
         lappend stream_args -EnableFcsErrorInsertion false
      } else {
         lappend stream_args -EnableFcsErrorInsertion true
      }
      <span class="comment-line"># Create basic stream</span>
      lappend stream_args -frameLengthMode AUTO -EqualRxPortDistribution &#34;FALSE&#34;
      set hStreamBlock [eval logcmd stc::create streamBlock -under $txPort $stream_args]
      
      set eth_args {}
      
      <span class="comment-line"># get mac addresses</span>
      set srcAddr  [<a name="::GetDefaultPortIdMAC(1)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $txPort]
      set destAddr [<a name="::GetDefaultPortIdMAC(2)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $rxPort]
      if { $sMacAddr == &#34;default&#34; } {
         lappend eth_args -srcMac [set sMacAddr $srcAddr]
      } else {
         lappend eth_args -srcMac [join $sMacAddr :]
      }
      lappend eth_args -dstMac [join $dMacAddr :]

      <a name="::logcmd(103)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hStreamBlock
      
      <span class="comment-line"># Ether stuff</span>
      lappend eth_args -etherType 0800
      set hEthernet [eval logcmd stc::create ethernet:EthernetII -under $hStreamBlock \
                        -name sb1_eth $eth_args]
      incr dataoffset 14 ; lappend pktoffsets sb1_eth $dataoffset
      set vlanlen [<a name="::addVlans(1)"><a href="./spirent.tcl.html#::addVlans_3663">::addVlans</a></a> -stream $hStreamBlock -ethobj $hEthernet -wTag $wTag -tagNo $tagNo -tagCfi $tagCfi\
                      -tagMode $tagMode -tagRepeat $tagRepeat -protocolTagId null]
      if {$vlanlen &gt; 0} {incr dataoffset $vlanlen  ; lappend pktoffsets sb1_vlans $dataoffset}
      
      set hIpv4 [<a name="::logcmd(104)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                    -sourceAddr $sIpAddr -destAddr $dIpAddr -ttl 1 -identification 0]
      
      <a name="::logcmd(105)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 17
 <span class="comment-line">#      set hUdp [logcmd stc::create udp:Udp -under $hStreamBlock -name sb_udp\</span>
 <span class="comment-line">#         -destPort $dstPort -sourcePort $srcPort -checksum 0x7fff]</span>
      set hUdp [<a name="::logcmd(106)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create udp:Udp -under $hStreamBlock -name sb_udp\
                   -destPort 67 -sourcePort 68]
      incr dataoffset 8
      set hDhcp [<a name="::logcmd(107)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create dhcp:Dhcpclientmsg -under $hStreamBlock -name sb_dhcp\
                    -clientAddr $clientIpAddr -clientMac [join $clientHwAddr :]\
                    -elapsed 7680 -haddrLen 6 -hardwareType 1 \
                    -hops 0 -messageType [<a name="::getDhcpOpCode(1)"><a href="./spirent.tcl.html#::getDhcpOpCode_1290">::getDhcpOpCode</a></a> $opCode]\
                    -xid 1 -yourAddr $yourIpAddr -xid 1266680334]
      set hOpt [<a name="::logcmd(108)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create options -under $hDhcp]
      set idx 0
      foreach {opt val} $optionCodeList {
         set hDhcpOpt [<a name="::logcmd(109)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create DHCPOption -under $hOpt]
         switch -glob [string tolower $opt] {
            *messagetype* {
               set opt_$idx [<a name="::logcmd(110)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create messageType -under $hDhcpOpt -code [<a name="::getDhcpOpCode(2)"><a href="./spirent.tcl.html#::getDhcpOpCode_1290">::getDhcpOpCode</a></a> $val]]
            }
            *clientid* {
               set opt_$idx [<a name="::logcmd(111)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create clientIdHW -under $hDhcpOpt -idtype [lindex $val 0]\
                                -clientHWA [join [lrange $val 1 end] :] -optionLength [format %02x [llength $val]]]
            }
            *requestedipaddr* {
               set opt_$idx [<a name="::logcmd(112)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create reqAddr -under $hDhcpOpt -reqAddr $val]
            }
            *svridentifier* {
               set opt_$idx [<a name="::logcmd(113)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create serverId -under $hDhcpOpt -reqAddr $val]
            }
            *hostname* {
               binary scan $val H* hexval
               set len [format %02x [string length $val]]
               set opt_$idx [<a name="::logcmd(114)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create hostName -under $hDhcpOpt -value $hexval -length $len]
            }
            *paramrequest* {
               set len [format %02x [expr [string length [join $val {}]]/2]]
               set opt_$idx [<a name="::logcmd(115)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create paramReqList -under $hDhcpOpt -value [join $val {}] -length $len]
            }
            default {error &#34;Unsupported DHCP Option Type $opt=$val&#34;}
         }
         incr idx
      }
      set hDhcpOpt [<a name="::logcmd(116)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create DHCPOption -under $hOpt]
      <a name="::logcmd(117)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create endOfOptions -under $hDhcpOpt
      <a name="::logcmd(118)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hStreamBlock
<span class="comment-line">#       for {set i 0} {$i &lt; $idx} {incr i} {</span>
<span class="comment-line">#          logcmd stc::get [subst $[subst opt_$idx]]</span>
<span class="comment-line">#       }</span>

      set gen_args {}
      lappend gen_args -loadunit PERCENT_LINE_RATE -FixedLoad 50
      lappend gen_args -DurationMode BURSTS -BurstSize $numFrames -duration 1
      set hGeneratorConfig [eval logcmd stc::config $txPort.Generator.GeneratorConfig $gen_args]
      stc::apply
   }
   <a name="::logcmd(119)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply

   <a name="::logcmd(120)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList &#34;$txPort $rxPort&#34;
   if {$dontTx==0} {
      <a name="::StartPortsTransmit(5)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $txPort
   }
   if {[string tolower $streamType] != &#34;contpacket&#34; &amp;&amp; $dontTx==0} {
      <a name="::stcCheckTxDone(2)"><a href="./spirent.tcl.html#::stcCheckTxDone_348">::stcCheckTxDone</a></a> -txPortId $txPort
   }
   if {$dontTx==0} {
      return [<a name="::getFrameContents(1)"><a href="./spirent.tcl.html#::getFrameContents_3204">::getFrameContents</a></a> $hStreamBlock arp]
   } else {
      return &#34;&#34;
   }

}

<strong><a name="::::getDhcpOpCode_1290">proc <a href="spirent.tcl-annot.html#::::getDhcpOpCode">::::getDhcpOpCode</a></a></strong> {string} {
   switch -glob [string tolower $string] {
      *boot*     -
      *discover* { return 1 }
      *offer*    { return 2 }
      *request*  { return 3 }
      *decline*  { return 4 }
      *ack*      { return 5 }
      *neg*      { return 6 }
      *release*  { return 7 }
      *info*     { return 8 }
      default { error &#34;Could not translate DHCP message type '$string'&#34; }
   }
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaConf_2Ports_ip   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#	Set up an ixia port to send IP packets (tcp/udp/icmp/igmp)		     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 set frameSent [ixiaConf_2Ports_ip -numIxiaCd $numIxiaCd \</span>
<span class="comment-line">#             -txChas $chasisId -txCard $card -txPort $port -startCardNum $startCardNum \</span>
<span class="comment-line">#             -rxChas $ch -rxCard $c -rxPort $rxPort \</span>
<span class="comment-line">#             -ipProtocol $protocol -sMacAddr $sourceMac -dMacAddr $destMac \</span>
<span class="comment-line">#             -sIpAddr $sourceIp -dIpAddr $destIp -dDutIpAddr $gatewayIp -ttl $ttl \</span>
<span class="comment-line">#             -pSrcPort $sourcePort -pDstPort $destPort \</span>
<span class="comment-line">#             -frameSizeType $frameSizeType -frameSizeMIN $frameSizeMIN  -frameSizeMAX $frameSizeMAX \</span>
<span class="comment-line">#	      -goodChecksum $goodChecksum -numFrames $numFrames -frameSize $frameSize \</span>
<span class="comment-line">#	      -frameRate $frameRate -dataPattern $dataPattern -streamType $streamType \</span>
<span class="comment-line">#	      -fcsError $fcsError -wTag $wTag -tagNo $tag -TOS $TOS -userPriority $userPriority \</span>
<span class="comment-line">#	      -percentage $percentage -priority $priority -ipOptions $ipOptions -direction $direction \</span>
<span class="comment-line">#             -saMode $saMode -daMode $daMode -ipSaMode $ipSaMode -ipDaMode $ipDaMode -dIpMask $dIpMask sIpMask $sIpMask \</span>
<span class="comment-line">#             -dontFrag $dontFrag -tcpSeqNum $tcpSeqNum -tcpSynFlag $tcpSynFlag -tcpFinFlag $tcpFinFlag \</span>
<span class="comment-line">#             -tcpRstFlag $tcpRstFlag -tcpAckFlag $tcpAckFlag -sequence $sequence -type $type -code $code \</span>
<span class="comment-line">#             -id $id -applyFilter $applyFilter -maxResponseTime $maxResponseTime -groupAddr $groupAddr \</span>
<span class="comment-line">#             -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype ]   </span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ixiaConf_2Ports_ip_1331">proc <a href="spirent.tcl-annot.html#::::ixiaConf_2Ports_ip">::::ixiaConf_2Ports_ip</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;

   
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> ixiaConf_2Ports_ip $args {
      numIxiaCd &#34;1&#34;
      startCardNum &#34;1&#34;
      direction &#34;1Way&#34;
      txChas &#34;n/a&#34;
      txCard &#34;n/a&#34;
      txPort &#34;port1&#34;
      rxChas &#34;n/a&#34;
      rxCard &#34;n/a&#34;
      rxPort &#34;port2&#34;
      ipProtocol &#34;ip&#34;
      pSrcPort &#34;00&#34;
      pDstPort &#34;00&#34;
      sMacAddr &#34;default&#34;
      dMacAddr &#34;00 e0 2b 00 00 01&#34;
      sIpAddr &#34;127.0.0.1&#34;
      dIpAddr &#34;127.0.0.1&#34;
      dDutIpAddr &#34;127.0.0.1&#34;
      sIpMask &#34;255.255.255.0&#34;
      dIpMask &#34;255.255.255.0&#34;
      sClass &#34;classC&#34;
      dClass &#34;classC&#34;
      ttl &#34;64&#34;
      goodChecksum &#34;true&#34;
      ipOptions &#34;&#34;
      ipTotalLength &#34;20&#34;
      TOS &#34;default&#34;
      numFrames &#34;1&#34;
      frameSize &#34;64&#34;
      frameSizeType &#34;sizeFixed&#34;
      frameSizeMAX &#34;1518&#34;
      frameSizeMIN &#34;64&#34;
      frameRate &#34;default&#34;
      dataPattern &#34;0000&#34;
      frameType &#34;08 00&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      wTag &#34;false&#34;
      tagNo &#34;002&#34;
      tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat &#34;1&#34;
      protocolTagId &#34;null&#34;
      userPriority &#34;0&#34;
      applyFilter &#34;0&#34;
      percentage &#34;100&#34;
      priority &#34;0&#34;
      sendArp &#34;false&#34;
      numArpFrames &#34;2&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      saCount &#34;&#34;
      daCount &#34;&#34;
      ipSaMode &#34;ipIdle&#34;
      ipDaMode &#34;ipIdle&#34;
      ipSaCount &#34;&#34;
      ipDaCount &#34;&#34;
      dontFrag &#34;true&#34; 
      lastFrag &#34;true&#34;
      fragmentOffset &#34;0&#34;
      tcpSynFlag &#34;false&#34;
      tcpFinFlag &#34;false&#34;
      tcpRstFlag &#34;false&#34;
      tcpAckFlag &#34;false&#34;
      tcpPushFlag &#34;false&#34;
      tcpUrgFlag &#34;false&#34;
      tcpSeqNum &#34;000000000&#34;
      type &#34;8&#34;
      code &#34;0&#34;
      id &#34;0&#34;
      sequence &#34;0&#34;
      maxResponseTime &#34;100&#34;
      igmpMode &#34;Fixed&#34;
      igmpRepeatCount &#34;&#34;
      groupAddr &#34;224.0.0.1&#34;
      chid &#34;1&#34;
      ipApplication &#34;ip&#34;
      ripCommand &#34;ripRequest&#34;
      ripVersion &#34;2&#34;
      ripAuthen &#34;&#34;
      ripAuthenType &#34;2&#34;
      ripNumRoute &#34;1&#34;
      ripRouteFamilyId {2}
      ripRouteIp {0.0.0.0}
      ripRouteTag {00}
      ripRouteMask {0.0.0.0} 
      ripRouteNextHop {0.0.0.0}
      ripRouteMetric {16}
      udfEnable &#34;false&#34;
      udfInitval &#34;00&#34;
      udfOffset &#34;0&#34;
      udfCountertype &#34;c8&#34;
      udfContinuousCount &#34;false&#34;
      protoOffsetEnable &#34;false&#34;
      protoOffset &#34;14&#34;
      userDefTag &#34;&#34;
      clearStats &#34;yes&#34;
      dontTx &#34;0&#34;
      lengthOverride &#34;&#34;
   }

   global spawn_id
   global one2oneArray
   global macBroadcast
   global preambleSize
   set ipoffset 14
   set dataoffset 0
   set disableContents 0

   set date [clock format [clock seconds] -format &#34;%m-%d-%Y %I.%M.%S%p&#34;]
   <span class="comment-line">#result_debug &#34;\n*** date=$date&#34;</span>
   set time1 [clock seconds]
   
   set enableUDF4DVMRP 0
   <span class="comment-line"># a hack to set dvmrp message</span>
   if {$ipProtocol == &#34;dvmrp&#34; } { 
      set ipProtocol &#34;ip&#34;
      set enableUDF4DVMRP 1
   }
   
   set enablepimdm 0
   if {$ipProtocol == &#34;pim-dm&#34; } { 
      set ipProtocol &#34;ip&#34;
      set enablepimdm 1
   }
   
   set patternOffset          30    ;<span class="comment-line"># offset1 for filterPallette pattern1</span>
   set macBroadcast           {FF FF FF FF FF FF}
   set preambleSize           8


   if { $sendArp == &#34;true&#34; } {
      set numLearnFrames 2
   }

   <span class="comment-line"># Config streams for validation traffic</span>
   set counter 0
   set chid $txChas
   set c $txCard
   set p $txPort
<span class="comment-line">#   set txSpeed 100</span>
   set txSpeed [<a name="::getPortSpeed(1)"><a href="./spirent.tcl.html#::getPortSpeed_3479">::getPortSpeed</a></a> $txPort]
           
   <span class="comment-line">#Stop generator before making changes.</span>
   <a name="::logcmd(121)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $txPort
   
   <span class="comment-line"># Delete all streamblocks on tx port</span>
   <a name="::deleteAllStreams(3)"><a href="./spirent.tcl.html#::deleteAllStreams_3469">::deleteAllStreams</a></a> $txPort
   
   
   <span class="comment-line"># initialize streamblock arguments</span>
   set stream_args {-insertSig FALSE -EqualRxPortDistribution FALSE -EnableHighSpeedResultAnalysis FALSE}
   
   <span class="comment-line"># $fcsError</span>
   if {$fcsError == &#34;good&#34;} {
      lappend stream_args -EnableFcsErrorInsertion false
   } else {
      lappend stream_args -EnableFcsErrorInsertion true
   }

   <span class="comment-line"># Pattern work : $dataPattern (ixia has &#34;nonRepeat&#34; .. not sure what that means)</span>
   if {[string length $dataPattern] &lt;= 4} {
      lappend stream_args -ConstantFillPattern 0x$dataPattern -frameconfig {}
   } else {
      lappend stream_args -ConstantFillPattern 0 -frameconfig {}
   }

   <span class="comment-line"># Create basic stream</span>
   set hStreamBlock [eval logcmd stc::create streamBlock -under $txPort $stream_args]
   
   <span class="comment-line"># Create Ethernet part of stream</span>
   <span class="comment-line"># $sMacAddr</span>
   set eth_args {}
   if {$sMacAddr == &#34;default&#34;} {
      set sMacAddr [<a name="::GetDefaultPortIdMAC(3)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $txPort]
   }
   lappend eth_args -srcMac [join $sMacAddr :]

   <span class="comment-line"># $dMacAddr</span>
   lappend eth_args -dstMac [join $dMacAddr :]

   <span class="comment-line"># $frameType</span>
   lappend eth_args -etherType [join $frameType {}]

   set hEthernet [eval logcmd stc::create ethernet:EthernetII -under $hStreamBlock \
                     -name sb1_eth $eth_args]
   incr dataoffset 14
   
   <span class="comment-line"># handle other various UDFs</span>
   if {$udfEnable == &#34;true&#34;} {
      if {$streamType == &#34;continuous&#34;} {set recycleCount 0} else {set recycleCount $numFrames}
      foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
         if {[set place [expr $udfOffs - $dataoffset]] &lt; 0} {
            switch $place {
               -2 {
                  <span class="comment-line"># ethernet type </span>
                  set hRangeModifer1 [<a name="::logcmd(122)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                         -under $hStreamBlock \
                                         -ModifierMode INCR \
                                         -Mask ffff \
                                         -StepValue 1 \
                                         -Data [join $initVal {}] \
                                         -RecycleCount $recycleCount \
                                         -RepeatCount 0 \
                                         -DataType NATIVE \
                                         -EnableStream false \
                                         -OffsetReference &#34;sb1_eth.etherType&#34;]
               }
            }
            foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
         }
      }
   }

   <a name="::modifyMacAddrs(1)"><a href="./spirent.tcl.html#::modifyMacAddrs_3595">::modifyMacAddrs</a></a> -stream $hStreamBlock -saMode $saMode -daMode $daMode -saCount $saCount \
      -daCount $daCount -sMacAddr $sMacAddr -dMacAddr $dMacAddr -numFrames $numFrames


   <span class="comment-line"># Kludge to get the first mac address      </span>
   if {[llength $dMacAddr]&gt;2} {
      set dMacAdd $dMacAddr
   } else {
      set dMacAdd [lindex $dMacAddr $counter]
   }
   
   if {$counter==0} {
      if {[llength $dMacAddr]&gt;2} {set dMacAddToFilter $dMacAddr} else {set dMacAddToFilter [lindex $dMacAddr 1]}
   } else {
      set dMacAddToFilter [lindex $dMacAddr 0]
   }
   
   set vlanlen [<a name="::addVlans(2)"><a href="./spirent.tcl.html#::addVlans_3663">::addVlans</a></a> -stream $hStreamBlock -ethobj $hEthernet -wTag $wTag -tagNo $tagNo -tagCfi $tagCfi \
                   -tagMode $tagMode -tagRepeat $tagRepeat -protocolTagId $protocolTagId -tagPriority $userPriority \
                   -protoOffsetEnable $protoOffsetEnable -userDefTag $userDefTag]
   incr dataoffset $vlanlen
   incr ipoffset $vlanlen


   set hIpv4 [<a name="::logcmd(123)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                 -sourceAddr $sIpAddr -destAddr $dIpAddr -ttl $ttl -identification 0]
   incr dataoffset 20
   
   set disableContents [<a name="::modifyIpAddrs(1)"><a href="./spirent.tcl.html#::modifyIpAddrs_3522">::modifyIpAddrs</a></a> -stream $hStreamBlock -sIpAddr $sIpAddr -dIpAddr $dIpAddr -ipSaMode $ipSaMode\
                           -ipDaMode $ipDaMode -ipSaCount $ipSaCount -ipDaCount $ipDaCount -numFrames $numFrames]

   <span class="comment-line"># disable IP ID field auto increment</span>
   set hRangeModifier [<a name="::logcmd(124)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                          -under $hStreamBlock \
                          -ModifierMode INCR \
                          -Mask 65535 \
                          -StepValue &#34;1&#34; \
                          -Data 0 \
                          -RecycleCount 65535 \
                          -DataType NATIVE \
                          -EnableStream false \
                          -RepeatCount 0 \
                          -OffsetReference &#34;sb1_ip.identification&#34;]
   
   if {$goodChecksum == &#34;false&#34;} { 
      <a name="::logcmd(125)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -checksum 65535
   }
   
   if {$TOS == &#34;default&#34;} { set TOS 0}
   set hTosDiffserv [<a name="::logcmd(126)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create tosDiffserv -under $hIpv4]
   
   set hTOS [<a name="::logcmd(127)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create tos -under $hTosDiffserv -precedence [expr ($TOS &amp; 0xE0) &gt;&gt; 5] \
                -dBit [expr ($TOS &amp; 0x10) &gt;&gt; 4] \
                -tBit [expr ($TOS &amp; 0x8) &gt;&gt; 3] \
                -rBit [expr ($TOS &amp; 0x4) &gt;&gt; 2] \
                -mBit [expr ($TOS &amp; 0x2) &gt;&gt; 1]]

   <span class="comment-line"># Offset 12 is assumed to be always etherType field of the IP header</span>
   if {[string length $ipOptions] &gt; 0} {
      <span class="comment-line"># Set the ip header length - </span>
      set ipOptions [<a name="::getAdjustedOptions(1)"><a href="./spirent.tcl.html#::getAdjustedOptions_3344">::getAdjustedOptions</a></a> $ipOptions]
      puts &#34;IP OPTIONS $ipOptions&#34;
      set len [expr 5+([string length $ipOptions]/8)]
      <a name="::logcmd(128)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -ihl $len
      set chksum [<a name="::getIPv4Checksum(1)"><a href="./spirent.tcl.html#::getIPv4Checksum_3353">::getIPv4Checksum</a></a> -ilh $len -optionstr [join $ipOptions {}] -length [expr $frameSize - $ipoffset - 4] \
                     -sourceAddr $sIpAddr -destAddr $dIpAddr -ttl $ttl -tos $TOS -protocol [<a name="::getIpProtocol(1)"><a href="./spirent.tcl.html#::getIpProtocol_3441">::getIpProtocol</a></a> $ipProtocol]]
      puts [format %04x $chksum]
      <a name="::logcmd(129)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -checksum [expr $chksum + 0]

      set options [<a name="::logcmd(130)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $hStreamBlock -pattern [join $ipOptions {}]]
      incr dataoffset [expr [string length [join $ipOptions {}]]/2]
   }
   
   if {$ipTotalLength != &#34;default&#34; &amp; $lengthOverride != &#34;&#34; } {
       <a name="::logcmd(131)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -destPrefixLength $ipTotalLength
   }
   set ipdataoffset $dataoffset

   puts &#34;$udfOffset $udfInitval $udfCountertype&#34;
   <span class="comment-line">#kludge get frame contents fails if the udf are in there</span>
   <span class="comment-line"># doing UDF offset for IP here not under the switch statement below</span>
   if {$udfEnable == &#34;true&#34;} {
      if {$streamType == &#34;continuous&#34;} {set recycleCount 0} else {set recycleCount $numFrames}
      if {[llength $udfOffset] == 1} {set udfInitval [join $udfInitval {}]}
      foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
         set place [expr $udfOffs - $ipdataoffset]
         if {$place &gt;= -20 &amp; $place &lt; 0} {
   puts &#34;$udfOffset $udfInitval $udfCountertype&#34;
            set disableContents 1
            <a name="::modifyOtherIPFields(1)"><a href="./spirent.tcl.html#::modifyOtherIPFields_3829">::modifyOtherIPFields</a></a> $hStreamBlock $hIpv4 $initVal $place $counterType $numFrames
            foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
         }
      }
   }

   <span class="comment-line"># Note: setting IPV4 protocol explicitly just incase there are are ipOptions (using custom header)</span>
   switch [string tolower $ipProtocol] {
      &#34;tcp&#34;  {         
         <a name="::logcmd(132)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 6
         foreach var {tcpSynFlag tcpFinFlag tcpRstFlag tcpAckFlag tcpPushFlag tcpUrgFlag} {
            switch [subst $[subst $var]] {
               1 -
               true  { set $var 1 }
               0 -
               false { set $var 0 }
               default { error &#34;Unacceptable value for $var = '[subst $[subst $var]]'&#34;}
            }
         }
         set hTcp [eval logcmd stc::create tcp:Tcp -under $hStreamBlock -name tcp\
                      -destPort [expr $pDstPort+0] -sourcePort [expr $pSrcPort+0]\
                      -seqNum $tcpSeqNum -synBit $tcpSynFlag -finBit $tcpFinFlag\
                      -rstBit $tcpRstFlag -ackBit $tcpAckFlag -pshBit $tcpPushFlag -urgBit $tcpUrgFlag\
                      -checksum 0]
         incr dataoffset 20
      }
      &#34;udp&#34; {
         if {$ipApplication != &#34;rip&#34;} {
            <a name="::logcmd(133)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 17
            set hUdp [<a name="::logcmd(134)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create udp:Udp -under $hStreamBlock -name sb_udp\
                         -destPort [expr $pDstPort+0] -sourcePort [expr $pSrcPort+0] -checksum 0]
            incr dataoffset 8
            <span class="comment-line"># check if s/d port are being incremented via udf</span>
            if {$udfEnable == &#34;true&#34;} {
               if {$streamType == &#34;continuous&#34;} {set recycleCount 0} else {set recycleCount $numFrames}
               foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
                  set place [expr $udfOffs - $dataoffset]
                  if {$place &gt;= -8 &amp; $place &lt; 0} {
                     switch $place {
                        -8 {
                           <span class="comment-line"># do source ip</span>
                           set hRangeModifer1 [<a name="::logcmd(135)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                                  -under $hStreamBlock \
                                                  -ModifierMode INCR \
                                                  -Mask 0xffff \
                                                  -StepValue 1 \
                                                  -Data [expr [string trimleft $initVal 0]+0] \
                                                  -RecycleCount $recycleCount \
                                                  -RepeatCount 0 \
                                                  -DataType NATIVE \
                                                  -EnableStream false \
                                                  -OffsetReference &#34;sb_udp.sourcePort&#34;]
                        }
                        -6 {
                           <span class="comment-line"># do dest ip</span>
                           set hRangeModifer1 [<a name="::logcmd(136)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                                  -under $hStreamBlock \
                                                  -ModifierMode INCR \
                                                  -Mask 0xFFFF\
                                                  -StepValue 1 \
                                                  -Data [expr [string trimleft $initVal 0]+0] \
                                                  -RecycleCount $recycleCount \
                                                  -RepeatCount 0 \
                                                  -DataType NATIVE \
                                                  -EnableStream false \
                                                  -OffsetReference &#34;sb_udp.destAddr&#34;]
                        }
                        default { <span class="comment-line"># error &#34;Unsupported UDF in IP address of L2 packet offset = $place&#34;</span>
                     }
                     }
                     foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
                  }
               }
            }
         }
      }
      &#34;ip&#34; {
         <a name="::logcmd(137)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 255
      }
      &#34;58&#34; -
      &#34;icmp&#34; {
         <a name="::logcmd(138)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 1
         set hUdp [<a name="::logcmd(139)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create icmp:IcmpEchoRequest -under $hStreamBlock -name icmp\
                      -code $code -type $type -identifier $id -seqNum $sequence]
         incr dataoffset 10
         if {$udfEnable == &#34;true&#34;} {
            if {$streamType == &#34;continuous&#34;} {set recycleCount 0} else {set recycleCount $numFrames}
            foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
               set place [expr $udfOffs - $dataoffset]
               if {$place &gt;= -8 &amp; $place &lt; 0} {
                  switch $place {
                     -8 {
                        <span class="comment-line"># checksum</span>
                        set hRangeModifer1 [<a name="::logcmd(140)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                               -under $hStreamBlock \
                                               -ModifierMode INCR \
                                               -Mask 0xffff \
                                               -StepValue 1 \
                                               -Data [expr [string trimleft $initVal 0]+0] \
                                               -RecycleCount $recycleCount \
                                               -RepeatCount 0 \
                                               -DataType NATIVE \
                                               -EnableStream false \
                                               -OffsetReference &#34;icmp.checksum&#34;]
                     }
                     default { error &#34;unsupported icmp offset for udf&#34; }
                  }
                  foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
                  set disableContents 1
               }
            }
         }
       }
      &#34;igmp&#34; {
         <a name="::logcmd(141)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 2
         switch -exact -- [format %i $type] {
            &#34;17&#34; -
            &#34;18&#34; {
               <span class="comment-line"># IGMPv1 Report</span>
               set hIgmp [<a name="::logcmd(142)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create igmp:Igmpv1 -under $hStreamBlock -groupAddress $groupAddr -type [format %02x $type] -name sb_igmp]
               incr dataoffset 8
               foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
                  if {[set place [expr $udfOffs - $dataoffset]] &lt; 0} {
                     puts &#34;IGMPv1 UDFs : place $place offset $udfOffs init $initVal type $counterType&#34;
                     switch $place {
                        -8 {
                           <a name="::logcmd(143)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIgmp -type 0x[lindex $initVal 0] -unused 0x[lindex $initVal 1]
                        }
                     }
                     foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
                  }
               }
            }
            &#34;22&#34; -
            &#34;23&#34; {
               <span class="comment-line"># IGMPv2 Report</span>
               set igmpchecksum [<a name="::getIGMPv2Checksum(1)"><a href="./spirent.tcl.html#::getIGMPv2Checksum_3391">::getIGMPv2Checksum</a></a> -type $type -groupAddress $groupAddr -maxreaptime $maxResponseTime]
               set hIgmp [<a name="::logcmd(144)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create igmp:Igmpv2 -under $hStreamBlock -groupAddress $groupAddr \
                             -maxRespTime $maxResponseTime -type [format %02x $type] -name sb_igmp]
               incr dataoffset 8
            }
            &#34;34&#34; {
               <span class="comment-line"># IGMPv3 Report</span>
               set hIgmp [<a name="::logcmd(145)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create igmp:Igmpv3Report -under $hStreamBlock -numGrpRecords 1 -type [format %02x $type] -name sb_igmp]
               set grpRecordsObj [<a name="::logcmd(146)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create grpRecords -under $hIgmp]
               set grpRecord [<a name="::logcmd(147)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create GroupRecord -under $grpRecordsObj -mcastAddr $groupAddr -recordType 1]
               set srcListGroup [<a name="::logcmd(148)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create addrList -under $grpRecord -name sourceList]
               set src(1) [<a name="::logcmd(149)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv4Addr -under $srcListGroup -name addr1 -value 0.0.0.0]
               incr dataoffset 20
               foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
                  if {[set place [expr $udfOffs - $dataoffset]] &lt; 0} {
                     puts &#34;IGMPv3 UDFs : place $place offset $udfOffs init $initVal type $counterType&#34;
                     switch $place {
                        -20 {
                           <a name="::logcmd(150)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIgmp -type 0x$initVal
                        }
                        -13 {
                           <a name="::logcmd(151)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $grpRecord -recordType 0x[lindex $initVal 1] -auxDataLen 0x[lindex $initVal 2]\
                              -numSource 0x[lindex $initVal 3][lindex $initVal 2]
                        }
                        -9 {
                           <a name="::logcmd(152)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $grpRecord -numSource 0x[lindex $initVal 0]
                           <a name="::logcmd(153)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $grpRecord -mcastAddr [<a name="::int2ip(1)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> 0x[join [lrange $initVal 1 end] {}]00]
                        }
                        -5 {
                           set temp [<a name="::logcmd(154)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $grpRecord -mcastAddr]
                           <a name="::logcmd(155)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $grpRecord -mcastAddr [<a name="::int2ip(2)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> [expr [<a name="::ip2int(1)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> $temp] + 0x[lindex $initVal 0]]]
                           <a name="::logcmd(156)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $src(1) -value [<a name="::int2ip(3)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> 0x[join [lrange $initVal 1 end] {}]00]
                        }
                        -1 {
                           set temp [<a name="::logcmd(157)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $src(1) -value]
                           <a name="::logcmd(158)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $src(1) -value [<a name="::int2ip(4)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> [expr [<a name="::ip2int(2)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> $temp] + 0x[lindex $initVal 0]]]
                        }
                     }
                     foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
                  }
               }
            }
            default { error &#34;IGMP type of $type not supported&#34; }
         }
         if {$igmpMode != &#34;Fixed&#34;} {
            if {$igmpRepeatCount == {}} {set igmpRepeatCount $numFrames}
            set hRangeModifer1 [<a name="::logcmd(159)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                   -under $hStreamBlock \
                                   -ModifierMode INCR \
                                   -Mask 255.255.255.255 \
                                   -StepValue 0.0.0.1 \
                                   -Data $groupAddr \
                                   -RecycleCount $igmpRepeatCount \
                                   -RepeatCount 0 \
                                   -DataType NATIVE \
                                   -EnableStream false \
                                   -OffsetReference &#34;sb_igmp.groupAddress&#34;]
            set hRangeModifer1 [<a name="::logcmd(160)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                   -under $hStreamBlock \
                                   -ModifierMode DECR \
                                   -Mask 0xffff \
                                   -StepValue 1 \
                                   -Data $igmpchecksum \
                                   -RecycleCount $igmpRepeatCount \
                                   -RepeatCount 0 \
                                   -DataType NATIVE \
                                   -EnableStream false \
                                   -OffsetReference &#34;sb_igmp.checksum&#34;]
         }
      }
      default {
         if {[string is integer $ipProtocol]} {
            <a name="::logcmd(161)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol $ipProtocol
         } else {
            error &#34;Unsupported ipProtocol = $ipProtocol&#34;
         }
      }
   }
   

   if  { $ipApplication == &#34;rip&#34; } {
      <a name="::logcmd(162)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 17
      set riphdr [<a name="::logcmd(163)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $hStreamBlock -name sb_rip \
                     -pattern [set riphex [<a name="::makeRipHeader(1)"><a href="./spirent.tcl.html#::makeRipHeader_3773">::makeRipHeader</a></a> -ripCommand $ripCommand \
                                  -ripVersion $ripVersion -ripAuthen $ripAuthen \
                                  -ripNumRoute $ripNumRoute -ripRouteFamilyId $ripRouteFamilyId \
                                  -ripRouteIp $ripRouteIp -ripRouteTag $ripRouteTag \
                                  -ripRouteMask $ripRouteMask -ripRouteNextHop $ripRouteNextHop \
                                  -ripRouteMetric $ripRouteMetric -destPort [expr $pDstPort+0] \
                                              -sourcePort [expr $pSrcPort+0] -checksum 0]]]
      
      incr dataoffset [expr [string length $riphex]/2]
      set ipProtocol rip
   }

   if { $enableUDF4DVMRP } {
      <a name="::logcmd(164)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 2
   }
   
   if {$enablepimdm} {
      <a name="::logcmd(165)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 67
   }
   
   if {$udfEnable == &#34;true&#34;} {
      set inter 0
      foreach udfOffs $udfOffset {
         if {$udfOffs != 12} {
            continue
         }
         <a name="::logcmd(166)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hEthernet -etherType [join [lindex $udfInitval $inter] &#34;&#34;]
         
      }	
   }
   
   <span class="comment-line"># adjust packet size</span>
   <span class="comment-line"># Size work : frameSizeType frameSizeMAX frameSizeMIN frameSize</span>
   switch [string tolower $frameSizeType] {
      &#34;sizerandom&#34; {
         set stream_args [list -FixedFrameLength &#34;64&#34; -frameLengthMode RANDOM -maxFrameLength $frameSizeMAX\
                             -MinFrameLength [<a name="::adjustStcPacketSize(1)"><a href="./spirent.tcl.html#::adjustStcPacketSize_3766">::adjustStcPacketSize</a></a> $frameSizeMIN $dataoffset]]
      }
      &#34;sizefixed&#34; {
         puts &#34;FRAME : $frameSize -- OFFSET : $dataoffset  CALC : [<a name="::adjustStcPacketSize(2)"><a href="./spirent.tcl.html#::adjustStcPacketSize_3766">::adjustStcPacketSize</a></a> $frameSize $dataoffset]&#34;
         set stream_args [list -frameLengthMode FIXED -FixedFrameLength [<a name="::adjustStcPacketSize(3)"><a href="./spirent.tcl.html#::adjustStcPacketSize_3766">::adjustStcPacketSize</a></a> $frameSize $dataoffset]]
      }
      default { error &#34;Unsupported frameSizeType = $frameSizeType&#34; }
   }
   eval logcmd stc::config $hStreamBlock $stream_args

   if {[string length $dataPattern] &gt; 4} {
      set patternlen [expr $frameSize - $dataoffset - 5]
      set streampattern [<a name="::createFillStr(1)"><a href="./spirent.tcl.html#::createFillStr_3280">::createFillStr</a></a> $dataPattern $patternlen]
      set fill [<a name="::logcmd(167)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $hStreamBlock -pattern $streampattern]
   }
   
   if {$udfEnable == &#34;true&#34; &amp; [llength $udfOffset] &gt; 0} {
      set udflen [<a name="::InsertUDFs(1)"><a href="./spirent.tcl.html#::InsertUDFs_3240">::InsertUDFs</a></a> $hStreamBlock $dataoffset $dataPattern $udfOffset $udfInitval $udfCountertype $numFrames $streamType]
      incr dataoffset $udflen
   }

   <span class="comment-line"># configure generator</span>
   <a name="::configGen(1)"><a href="./spirent.tcl.html#::configGen_3141">::configGen</a></a> $txPort $streamType $frameSize $frameRate $percentage $txSpeed $numFrames
   
   stc::apply
   if {$clearStats == &#34;yes&#34; } {
      <a name="::logcmd(168)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList &#34;$txPort $rxPort&#34;
   }
  
   if {$dontTx==0} {
       <a name="::StartPortsTransmit(6)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $txPort
   }
   if {![string match cont* $streamType] &amp;&amp; $dontTx==0} {
      <a name="::stcCheckTxDone(3)"><a href="./spirent.tcl.html#::stcCheckTxDone_348">::stcCheckTxDone</a></a> -txPortId $txPort
   }

   if {($dontTx==0 &amp; $disableContents==0) } {
      return [<a name="::getFrameContents(2)"><a href="./spirent.tcl.html#::getFrameContents_3204">::getFrameContents</a></a> $hStreamBlock $ipProtocol $ipoffset]
   } else {
      return &#34;&#34;
   }
}


<span class="comment-line"># Procedure Name: ixiaConf_2Ports_ipv6</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       Set up an ixia port to send IP packets (tcp/udp/icmpv6)</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#        set frameSent [ixiaConf_2Ports_ipv6 -numIxiaCd $numIxiaCd \</span>
<span class="comment-line">#               -txChas $chasisId -txCard $card -txPort $port          \</span>
<span class="comment-line">#               -startCardNum $startCardNum -rxChas $ch -rxCard $c  \</span>
<span class="comment-line">#               -rxPort $rxPort -ipProtocol $protocol -sMacAddr $sourceMac \</span>
<span class="comment-line">#               -dMacAddr $destMac -sIpAddr $sourceIp -dIpAddr $destIp  \</span>
<span class="comment-line">#               -pSrcPort $sourcePort -pDstPort $destPort  \</span>
<span class="comment-line">#               -frameSizeType $frameSizeType -nHeader $nHeader \</span>
<span class="comment-line">#               -goodChecksum $goodChecksum -numFrames $numFrames \</span>
<span class="comment-line">#               -frameSize $frameSize -frameRate $frameRate        \</span>
<span class="comment-line">#               -dataPattern $dataPattern -streamType $streamType \</span>
<span class="comment-line">#               -fcsError $fcsError -wTag $wTag -tagNo $tag  \</span>
<span class="comment-line">#               -userPriority $userPriority -percentage $percentage  \</span>
<span class="comment-line">#               -priority $priority  -direction $direction -saMode $saMode  \</span>
<span class="comment-line">#               -daMode $daMode -ipSaMode $ipSaMode -ipDaMode $ipDaMode  \</span>
<span class="comment-line">#               -tcpSeqNum $tcpSeqNum -tcpSynFlag $tcpSynFlag             \</span>
<span class="comment-line">#               -tcpFinFlag $tcpFinFlag  -tcpRstFlag $tcpRstFlag  \</span>
<span class="comment-line">#               -tcpAckFlag $tcpAckFlag -sequence $sequence \</span>
<span class="comment-line">#               -type $type -code $code -id $id -applyFilter $applyFilter  \</span>
<span class="comment-line">#               -maxResponseTime $maxResponseTime -groupAddr $groupAddr \</span>
<span class="comment-line">#               -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset \</span>
<span class="comment-line">#               -udfCountertype $udfCountertype ]</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::ixiaConf_2Ports_ipv6_1967">proc <a href="spirent.tcl-annot.html#::::ixiaConf_2Ports_ipv6">::::ixiaConf_2Ports_ipv6</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;
   
   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> ixiaConf_2Ports_ipv6 $args {
      numIxiaCd &#34;1&#34;
      startCardNum &#34;1&#34;
      direction &#34;1Way&#34;
      txChas &#34;n/a&#34;
      txCard &#34;n/a&#34;
      txPort &#34;port1&#34;
      rxChas &#34;n/a&#34;
      rxCard &#34;1&#34;
      rxPort &#34;2&#34;
      ipProtocol &#34;ipV6&#34;
      nHeader &#34;tcp&#34;
      pSrcPort &#34;0&#34;
      pDstPort &#34;0&#34;
      sMacAddr &#34;default&#34;
      dMacAddr &#34;00 e0 2b 00 00 01&#34;
      sIpAddr &#34;3555:5555:6666:6666:7777:7777:8888:8888&#34;
      dIpAddr &#34;FE80:0:0:0:201:3FF:FE00:100&#34;
      dDutIpAddr &#34;default&#34;
      sIpMask &#34;ffff:ffff:ffff:ffff:0000:0000:0000:0000&#34;
      dIpMask &#34;ffff:ffff:ffff:ffff:0000:0000:0000:0000&#34;
      trafficClass &#34;3&#34;
      flowLabel &#34;0&#34;
      hopLimit &#34;255&#34;
      numFrames &#34;1&#34;
      frameSize &#34;128&#34;
      frameSizeType &#34;sizeFixed&#34;
      frameRate &#34;default&#34;
      dataPattern &#34;0000&#34;
      frameType &#34;86 DD&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      wTag &#34;false&#34;
      tagNo &#34;002&#34;
      tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat &#34;1&#34;
      userPriority &#34;0&#34;
      applyFilter &#34;0&#34;
      percentage &#34;100&#34;
      priority &#34;0&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      saCount &#34;&#34;
      daCount &#34;&#34;
      ipSaMode &#34;ipV6Idle&#34;
      ipDaMode &#34;ipV6Idle&#34;
      ipSaCount &#34;&#34;
      ipDaCount &#34;&#34;
      tcpSynFlag &#34;false&#34;
      tcpFinFlag &#34;false&#34;
      tcpRstFlag &#34;false&#34;
      tcpAckFlag &#34;false&#34;
      tcpPushFlag &#34;false&#34;
      tcpUrgFlag &#34;false&#34;
      tcpSeqNum &#34;0&#34;
      type &#34;8&#34;
      code &#34;0&#34;
      id &#34;0&#34;
      sequence &#34;0&#34;
      maxResponseTime &#34;100&#34;
      chid &#34;1&#34;
      udfEnable &#34;false&#34;
      udfInitval &#34;00&#34;
      udfOffset &#34;0&#34;
      udfCountertype &#34;c8&#34;
      udfContinuousCount &#34;false&#34;
      udfUpdown &#34;uuuu&#34;
      udfRepeat &#34;1&#34;
      udfStep &#34;1&#34;
      clearStats &#34;yes&#34;
      dontTx &#34;0&#34;
      invalidUdpChk &#34;0&#34;
   }
   
   global spawn_id
   global one2oneArray
   global preambleSize
   set ipoffset 14
   set dataoffset 0
   set disableContents 0
   
   set date [clock format [clock seconds] -format &#34;%m-%d-%Y %I.%M.%S%p&#34;]
   <a name="::result_debug(42)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n*** date=$date&#34;
   set time1 [clock seconds]
   
   set enableUDF4DVMRP 0
   if {$ipProtocol == &#34;dvmrp&#34; } {
      set ipProtocol &#34;ipV6&#34;
      set enableUDF4DVMRP 1
   }
   
   set enablepimdm 0
   if {$ipProtocol == &#34;pim-dm&#34; } {
      set ipProtocol &#34;ipV6&#34;
      set enablepimdm 1
   }
   
   set macBroadcast     {ff ff ff ff ff ff}
   set patternOffset		30
   set preambleSize		8
   
   <span class="comment-line"># Config streams for validation traffic</span>
   
   set ipoffset 14
   set counter 0
   set dataoffset 0
   set portList {}
   set txPorts  {}
   set dataPattern [join $dataPattern {}]

   lappend portList $txPort $rxPort
   if {$direction == &#34;2Way&#34;} {lappend portList $rxPort $txPort}
   
   foreach {txPort rxPort} $portList {
      <a name="::logcmd(169)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $txPort
      
      <span class="comment-line"># Delete all streamblocks on tx port</span>
      <a name="::deleteAllStreams(4)"><a href="./spirent.tcl.html#::deleteAllStreams_3469">::deleteAllStreams</a></a> $txPort
      
      <span class="comment-line"># initialize streamblock arguments</span>
      set stream_args {-insertSig FALSE}
      
      <span class="comment-line"># Size work : frameSizeType frameSizeMAX frameSizeMIN frameSize</span>
      switch [string tolower $frameSizeType] {
         &#34;sizerandom&#34; {
            lappend stream_args -FixedFrameLength &#34;128&#34; -frameLengthMode RANDOM -maxFrameLength 1500 \
               -MinFrameLength 128 -EnableHighSpeedResultAnalysis &#34;FALSE&#34; -EqualRxPortDistribution &#34;FALSE&#34;
         }
         &#34;sizefixed&#34; {
            lappend stream_args -frameLengthMode FIXED -FixedFrameLength $frameSize -EqualRxPortDistribution &#34;FALSE&#34;
         }
         default { error &#34;Unsupported frameSizeType = $frameSizeType&#34;
         }
      }
      
      set txSpeed [<a name="::getPortSpeed(2)"><a href="./spirent.tcl.html#::getPortSpeed_3479">::getPortSpeed</a></a> $txPort]
      
      <span class="comment-line"># $fcsError</span>
      if {$fcsError == &#34;good&#34;} {
         lappend stream_args -EnableFcsErrorInsertion false
      } else {
         lappend stream_args -EnableFcsErrorInsertion true
      }
      
      
      <span class="comment-line"># Pattern work : $dataPattern (ixia has &#34;nonRepeat&#34; .. not sure what that means)</span>
      if {[string length $dataPattern] &lt;= 4} {
         lappend stream_args -ConstantFillPattern 0x$dataPattern -frameconfig {}
      } else {
         lappend stream_args -ConstantFillPattern 0 -frameconfig {}
      }
    
      <span class="comment-line"># Create basic stream</span>
      set hStreamBlock [eval logcmd stc::create streamBlock -under $txPort $stream_args]
      
      set eth_args {}
      if {$sMacAddr == &#34;default&#34;} {
         lappend eth_args -srcMac [join [<a name="::GetDefaultPortIdMAC(4)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $txPort] :]
      } else {
         lappend eth_args -srcMac [join $sMacAddr :]
      }
      
      <span class="comment-line"># $dMacAddr</span>
      if {$dMacAddr == &#34;default&#34;} {
         lappend eth_args -dstMac [join [<a name="::GetDefaultPortIdMAC(5)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $rxPort] :]
      } else {
         lappend eth_args -dstMac [join [lindex $dMacAddr $counter] :]
      }
      
      <span class="comment-line"># $frameType</span>
      lappend eth_args -etherType [join $frameType {}]
      
      set hEthernet [eval logcmd stc::create ethernet:EthernetII -under $hStreamBlock \
                        -name sb1_eth $eth_args]
      incr dataoffset 14
      
      <a name="::modifyMacAddrs(2)"><a href="./spirent.tcl.html#::modifyMacAddrs_3595">::modifyMacAddrs</a></a> -stream $hStreamBlock -saMode $saMode -daMode $daMode -saCount $saCount \
          -daCount $daCount -sMacAddr $sMacAddr -dMacAddr $dMacAddr -numFrames $numFrames
      
      
      <span class="comment-line"># Kludge to get the first mac address DON'T think this is necessary</span>
      if {[llength $dMacAddr]&gt;2} {
         set dMacAdd $dMacAddr
      } else {
         set dMacAdd [lindex $dMacAddr $counter]
      }
      
      if {$counter==0} {
         if {[llength $dMacAddr]&gt;2} {set dMacAddToFilter $dMacAddr} else {set dMacAddToFilter [lindex $dMacAddr 1]}
      } else {
         set dMacAddToFilter [lindex $dMacAddr 0]
      }
      
      set vlanlen [<a name="::addVlans(3)"><a href="./spirent.tcl.html#::addVlans_3663">::addVlans</a></a> -stream $hStreamBlock -ethobj $hEthernet -wTag [lindex $wTag $counter]\
                      -tagNo [lindex $tagNo $counter] -tagCfi $tagCfi\
                      -tagMode $tagMode -tagRepeat $tagRepeat -tagPriority $userPriority]
      incr dataoffset $vlanlen
      incr ipoffset $vlanlen
      if {$counter == 0} {
         set sip [lindex [split $sIpAddr /] 0] ;  set dip [lindex [split $dIpAddr /] 0]
      } else {
         set sip [lindex [split $dIpAddr /] 0] ;  set dip [lindex [split $sIpAddr /] 0]
      }
      
      

      set hIpv6 [<a name="::logcmd(170)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv6:IPv6 -under $hStreamBlock -name sb1_ip \
                    -trafficClass $trafficClass -flowLabel $flowLabel \
                    -sourceAddr $sip -destAddr $dip -hopLimit $hopLimit\
                    -nextHeader [<a name="::getIpv6NextHeaderValue(1)"><a href="./spirent.tcl.html#::getIpv6NextHeaderValue_3452">::getIpv6NextHeaderValue</a></a> $nHeader]]
      incr dataoffset 40
      
      if {![string match -nocase *idle* $ipSaMode]} {
         set disableContents 1
         switch -glob [string tolower $ipSaMode] {
            *inc* { set mode INCR }
            *dec* { set mode DECR }
            default { set mode INCR }
         }
         if {$ipSaCount == {}} {set ipSaCount $numFrames}
         <span class="comment-line"># Use modifier to generate multiple streams.</span>
         <a name="::result_debug(43)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nCreating Modifier on Stream Block&#34;
         set hRangeModifer1 [<a name="::logcmd(171)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                -under $hStreamBlock \
                                -ModifierMode $mode \
                                -Mask ::FFFF:FFFF \
                                -StepValue ::1 \
                                -Data $sIpAddr \
                                -RecycleCount $ipSaCount \
                                -RepeatCount 0 \
                                -DataType NATIVE \
                                -EnableStream false \
                                -OffsetReference &#34;sb1_ip.sourceAddr&#34;]
      }
      
      if {![string match -nocase *idle* $ipDaMode]} {
         set disableContents 1
         switch -glob [string tolower $ipDaMode] {
            *inc* { set mode INCR }
            *dec* { set mode DECR }
            default { set mode INCR }
         }
         if {$ipDaCount == {}} {set ipDaCount $numFrames}     
         <span class="comment-line"># Use modifier to generate multiple streams.</span>
         <a name="::result_debug(44)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nCreating Modifier on Stream Block&#34;
         set hRangeModifer1 [<a name="::logcmd(172)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                -under $hStreamBlock \
                                -ModifierMode $mode \
                                -Mask ::FFFF:FFFF \
                                -StepValue ::1 \
                                -Data $dIpAddr \
                                -RecycleCount $ipDaCount \
                                -RepeatCount 0 \
                                -DataType NATIVE \
                                -EnableStream false \
                                -OffsetReference &#34;sb1_ip.destAddr&#34;]
      }
      
      if {$udfEnable == &#34;true&#34;} {
         if {$streamType == &#34;continuous&#34;} {set recycleCount 0} else {set recycleCount $numFrames}
         foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
            if {[set place [expr $udfOffs - $dataoffset]] &lt; 0} {
puts &#34;PLACE : $place&#34;
               switch $place {
                  -34 {
                     <span class="comment-line"># do next header</span>
                     set hRangeModifer1 [<a name="::logcmd(173)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                            -under $hStreamBlock \
                                            -ModifierMode INCR \
                                            -Mask 0xFF \
                                            -StepValue 1 \
                                            -Data 0x[join $initVal {}] \
                                            -RecycleCount $recycleCount \
                                            -RepeatCount 0 \
                                            -DataType NATIVE \
                                            -EnableStream false \
                                            -OffsetReference &#34;sb1_ip.nextHeader&#34;]
                  }
                  default { error &#34;Unsupported UDF in IP address of L2 packet offset = $place&#34;}
               }
               foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
            }
         }
      }

      switch [string tolower $nHeader] {
         &#34;tcp&#34;  {
            <a name="::logcmd(174)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv6 -nextHeader 6
            foreach var {tcpSynFlag tcpFinFlag tcpRstFlag tcpAckFlag tcpPushFlag tcpUrgFlag} {
               switch [subst $[subst $var]] {
                  1 -
                  true  { set $var 1 }
                  0 -
                  false { set $var 0 }
                  default { error &#34;Unacceptable value for $var = '[subst $[subst $var]]'&#34;}
               }
            }
            set hTcp [eval logcmd stc::create tcp:Tcp -under $hStreamBlock -name tcp\
                         -destPort [expr $pDstPort+0] -sourcePort [expr $pSrcPort+0]\
                         -seqNum $tcpSeqNum -synBit $tcpSynFlag -finBit $tcpFinFlag\
                         -rstBit $tcpRstFlag -ackBit $tcpAckFlag -pshBit $tcpPushFlag -urgBit $tcpUrgFlag\
                         -checksum 0]
            incr dataoffset 20
        }
         &#34;udp&#34; {
            <a name="::logcmd(175)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv6 -nextHeader 17
            set hUdp [<a name="::logcmd(176)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create udp:Udp -under $hStreamBlock -name sb_udp\
                         -destPort [expr $pDstPort+0] -sourcePort [expr $pSrcPort+0]]
            incr dataoffset 8
            <span class="comment-line"># check if s/d port are being incremented via udf</span>
            if {$udfEnable == &#34;true&#34;} {
               if {$streamType == &#34;continuous&#34;} {set recycleCount 0} else {set recycleCount $numFrames}
               foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
                  if {[set place [expr $udfOffs - $dataoffset]] &lt; 0} {
                     set disableContents 1
                     switch $place {
                        -8 {
                           <span class="comment-line"># do source ip</span>
                           set hRangeModifer1 [<a name="::logcmd(177)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                                  -under $hStreamBlock \
                                                  -ModifierMode INCR \
                                                  -Mask 0xffff \
                                                  -StepValue 1 \
                                                  -Data [expr [string trimleft $initVal 0]+0] \
                                                  -RecycleCount $recycleCount \
                                                  -RepeatCount 0 \
                                                  -DataType NATIVE \
                                                  -EnableStream false \
                                                  -OffsetReference &#34;sb_udp.sourcePort&#34;]
                        }
                        -6 {
                           <span class="comment-line"># do dest ip</span>
                           set hRangeModifer1 [<a name="::logcmd(178)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                                  -under $hStreamBlock \
                                                  -ModifierMode INCR \
                                                  -Mask 0xFFFF\
                                                  -StepValue 1 \
                                                  -Data [expr [string trimleft $initVal 0]+0] \
                                                  -RecycleCount $recycleCount \
                                                  -RepeatCount 0 \
                                                  -DataType NATIVE \
                                                  -EnableStream false \
                                                  -OffsetReference &#34;sb_udp.destAddr&#34;]
                        }
                        default { error &#34;Unsupported UDF in IP address of L2 packet offset = $place&#34;}
                     }
                     foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
                  }
               }
            }
         }
         &#34;58&#34; -
         &#34;icmpv6&#34; {
            <a name="::logcmd(179)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv6 -nextHeader 1
            set hUdp [<a name="::logcmd(180)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create icmp:Icmpv6EchoRequest -under $hStreamBlock -name icmp\
                         -code $code -type $type -identifier $id $seqNum $sequence]
            incr dataoffset 10
         }
      }
      
      if { $enableUDF4DVMRP } {
         <a name="::logcmd(181)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv6 -nextHeader 2
      }
      
      if {$enablepimdm} {
         <a name="::logcmd(182)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv6 -nextHeader 67
      }
      
      if {[string length $dataPattern] &gt; 4} {
         set patternlen [expr $frameSize - $dataoffset - 4]
         puts &#34;DATAPATTERN $dataPattern&#34;
         puts &#34;LENGTH : $patternlen&#34;
         set streampattern [<a name="::createFillStr(2)"><a href="./spirent.tcl.html#::createFillStr_3280">::createFillStr</a></a> $dataPattern $patternlen]
         set fill [<a name="::logcmd(183)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $hStreamBlock -pattern $streampattern]
      }
      
      if {$udfEnable == &#34;true&#34;} {
         set inter 0
         foreach udfOffs $udfOffset {
            if {$udfOffs != 12} {
               continue
            }
            <a name="::logcmd(184)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hEthernet -etherType [join [lindex $udfInitval $inter] &#34;&#34;]
            
         }	
      }
      
      puts &#34;UDFOFFSET : $udfOffset&#34;

      if {$udfEnable == &#34;true&#34; &amp; [llength $udfOffset] &gt; 0} {
         set udflen [<a name="::InsertUDFs(2)"><a href="./spirent.tcl.html#::InsertUDFs_3240">::InsertUDFs</a></a> $hStreamBlock $dataoffset $dataPattern $udfOffset $udfInitval $udfCountertype $numFrames $streamType]
         incr dataoffset $udflen
      }
      
      <span class="comment-line"># adjust packet size</span>
      <span class="comment-line"># Size work : frameSizeType frameSizeMAX frameSizeMIN frameSize</span>
      switch [string tolower $frameSizeType] {
         &#34;sizerandom&#34; {
            set stream_args [list -FixedFrameLength &#34;64&#34; -frameLengthMode RANDOM -maxFrameLength $frameSizeMAX\
                                -MinFrameLength [<a name="::adjustStcPacketSize(4)"><a href="./spirent.tcl.html#::adjustStcPacketSize_3766">::adjustStcPacketSize</a></a> $frameSizeMIN $dataoffset]]
         }
         &#34;sizefixed&#34; {
            set stream_args [list -frameLengthMode FIXED -FixedFrameLength [<a name="::adjustStcPacketSize(5)"><a href="./spirent.tcl.html#::adjustStcPacketSize_3766">::adjustStcPacketSize</a></a> $frameSize $dataoffset]]
         }
         default { error &#34;Unsupported frameSizeType = $frameSizeType&#34;
         }
      }
      eval logcmd stc::config $hStreamBlock $stream_args
      <span class="comment-line"># configure generator</span>
      <a name="::configGen(2)"><a href="./spirent.tcl.html#::configGen_3141">::configGen</a></a> $txPort $streamType $frameSize $frameRate $percentage $txSpeed $numFrames

      lappend txPorts $txPort
      incr counter
   }

   if {$clearStats == &#34;yes&#34; } {
      <a name="::logcmd(185)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList &#34;$txPort $rxPort&#34;
   }
   
   if {$dontTx==0} {
      <a name="::StartPortsTransmit(7)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $txPorts
   }
   
   if {[string tolower $streamType] != &#34;contpacket&#34; &amp;&amp; $dontTx==0} {
      foreach txPort $txPorts {
         <a name="::stcCheckTxDone(4)"><a href="./spirent.tcl.html#::stcCheckTxDone_348">::stcCheckTxDone</a></a> -txPortId $txPort
      }
   } elseif {[string tolower $streamType]  == &#34;contpacket&#34; &amp;&amp; $dontTx==0} {
      <span class="comment-line"># doing rate based traffic so clear stats to get accurate rates</span>
      <a name="::logcmd(186)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList &#34;$txPort $rxPort&#34;
   }      
   
   if {$dontTx==0 &amp; $disableContents==0} {
         return [<a name="::getFrameContents(3)"><a href="./spirent.tcl.html#::getFrameContents_3204">::getFrameContents</a></a> $hStreamBlock $ipProtocol]
   }
}



<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: ixiaConf_2Ports</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line"># Ixia control - TX from a port &amp; RX from another port.</span>
<span class="comment-line"># Uni-direction or bi-direction.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#      numIxiaCd :              Number of Ixia cards involved (1-16)</span>
<span class="comment-line">#                       for statistics &amp; capture purpose</span>
<span class="comment-line">#          startCardNum :       Starting Ixia card slot number (1-16)</span>
<span class="comment-line">#      direction :              uni-direction (1Way) or bi-direction (2Way)</span>
<span class="comment-line">#      txChas :                 TX Ixia chassis id</span>
<span class="comment-line">#      txCard :                 TX Ixia card number</span>
<span class="comment-line">#      txPort :                 TX Ixia port number</span>
<span class="comment-line">#      rxChas :                 RX Ixia chassis id</span>
<span class="comment-line">#      rxCard :                 RX Ixia card number</span>
<span class="comment-line">#      rxPort :                 RX Ixia port number</span>
<span class="comment-line">#      inSaMac :                Input source MAC address</span>
<span class="comment-line">#      inDaMac :                Input destination MAC address</span>
<span class="comment-line">#      numFrames :              Number of frames to send per Ixia port</span>
<span class="comment-line">#      frameSize :              Frame size</span>
<span class="comment-line">#      dataPattern :    Packet data pattern</span>
<span class="comment-line">#      streamType :             advance, contBurst, contPacket, firstLoopCount,</span>
<span class="comment-line">#                                               gotofirst, stopStream (Note: see Ixia manual)</span>
<span class="comment-line">#      patternOffset :  For &#34;filterPallette&#34; (Note: see Ixia manual)</span>
<span class="comment-line">#      fcsError :               good, alignErr, bad, dribbleErr, none</span>
<span class="comment-line">#                                               (Note: see Ixia manual)</span>
<span class="comment-line">#      wTag :                   With Tag (true, false)</span>
<span class="comment-line">#          tagNo :                      Tag number</span>
<span class="comment-line">#      priority :               Priority for the packet</span>
<span class="comment-line">#      protocol :               mac, ip, ipx</span>
<span class="comment-line">#      saMode :                 contDecrement, contIncrement, ctrRandom,</span>
<span class="comment-line">#                                               decrement, idle, increment (Note: see Ixia manual)</span>
<span class="comment-line">#      daMode :                 contDecrement, contIncrement, ctrRandom,</span>
<span class="comment-line">#                                               decrement, idle, increment (Note: see Ixia manual)</span>
<span class="comment-line">#      percentage :             For TX speed - Percentage of the line rate</span>
<span class="comment-line">#      sendLearn :              To send learning frames? (true, false)</span>
<span class="comment-line">#      numLearnFrames : Number of the learning frames</span>
<span class="comment-line">#      chid :                   Ixia chassis id</span>
<span class="comment-line">#      userStatFltrSA1          MAC address filter for user stat 1</span>
<span class="comment-line">#      userStatFltrDA1          MAC address filter for user stat 1</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#   set frameSent [ixiaConf_2Ports -numIxiaCd $numIxiaCd \</span>
<span class="comment-line">#                  -txChas $txChasisId -txCard $txCard -txPort $txPort -direction &#34;2Way&#34; \</span>
<span class="comment-line">#                  -rxChas $rxChasisId -rxCard $rxCard -rxPort $rxPort -sendLearn $sendLearn \</span>
<span class="comment-line">#                  -protocol $protocol -numFrames $numFrames -frameSize $frameSize \</span>
<span class="comment-line">#                  -frameSizeType $frameSizeType -frameSizeMIN $frameSizeMIN  -frameSizeMAX $frameSizeMAX \</span>
<span class="comment-line">#                  -dataPattern $dataPattern -streamType $streamType -fcsError $fcsError]</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::ixiaConf_2Ports_2469">proc <a href="spirent.tcl-annot.html#::::ixiaConf_2Ports">::::ixiaConf_2Ports</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;

   <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> ixiaConf_2Ports $args {
      numIxiaCd &#34;1&#34;
      startCardNum &#34;1&#34;
      direction &#34;1Way&#34;
      txChas &#34;n/a&#34;
      txCard &#34;n/a&#34;
      txPort &#34;port1&#34;
      rxChas &#34;n/a&#34;
      rxCard &#34;n/a&#34;
      rxPort &#34;port2&#34;
      inSaMac &#34;default&#34;
      inDaMac &#34;default&#34;
      numFrames &#34;1&#34;
      frameSizeType &#34;sizeFixed&#34;
      frameSizeMAX &#34;1518&#34;
      frameSizeMIN &#34;64&#34;
      frameSize &#34;64&#34;
      dataPattern &#34;0000&#34;
      ethernetType &#34;noType&#34;
      frameType &#34;08 00&#34;
      streamType &#34;stopStream&#34;
      patternOffset &#34;32&#34;
      fcsError &#34;good&#34;
      priority &#34;0&#34;
      <a name="::protocol(1)"><a href="./spirent.tcl.html#::protocol_1053">::protocol</a></a> &#34;mac&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      saCount &#34;&#34;
      daCount &#34;&#34;
      percentage &#34;100&#34;
      sendLearn &#34;false&#34;
      numLearnFrames &#34;1&#34;
      wTag &#34;false&#34;
      tagNo &#34;002&#34;
      tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat &#34;1&#34;
      tagPriority &#34;0&#34;
      protocolTagId &#34;null&#34;
      chid &#34;1&#34;
      userDefinedStat1SA &#34;00:00:00:00:00:00&#34;
      userDefinedStat1DA &#34;00:00:00:00:00:00&#34;
      rate               &#34;null&#34;
      udfEnable &#34;false&#34;
      udfInitval &#34;00&#34;
      udfOffset &#34;0&#34;
      udfCountertype &#34;c8&#34;
      udfContinuousCount &#34;false&#34;
      udfRepeat &#34;1&#34;
      protoOffsetEnable &#34;false&#34;
      protoOffset &#34;14&#34;
      userDefTag &#34;&#34;
      dontTx &#34;0&#34;
      ZeroStats &#34;yes&#34;
   }
   global spawn_id
   global one2oneArray
   global macBroadcast
   global preambleSize
   
   set date [clock format [clock seconds] -format &#34;%m-%d-%Y %I.%M.%S%p&#34;]
   set time1 [clock seconds]
   
   set macBroadcast     {ff ff ff ff ff ff}
   set preambleSize     8


   <span class="comment-line"># Config streams for validation traffic</span>
   set wkTag $wTag
   set wkTagNo $tagNo
   set portNo 0
   set portList {}
   set counter 0
   set txPorts {}
   lappend portList $txPort $rxPort
   if {$direction == &#34;2Way&#34;} {lappend portList $rxPort $txPort}
   
   foreach {txPort rxPort} $portList {
      set dataoffset 0
      set pktoffsets {}
      if { $wkTag == &#34;true&#34; } {
         set wTag &#34;true&#34;
         set tagNo [lindex $wkTagNo $portNo]
         incr portNo
         if { $tagNo == &#34;&#34; } {set tagNo [lindex $wkTagNo 0]}
         if { $tagNo == 0 || $tagNo == &#34;none&#34; } {set wTag &#34;false&#34;}
         <a name="::result_debug(45)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;wTag = $wTag, tagNo = $tagNo&#34;
      }
      
      <span class="comment-line">#Stop generator before making changes.</span>
      <a name="::logcmd(187)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $txPort
      
      <span class="comment-line"># Delete all streamblocks on tx port</span>
      <a name="::deleteAllStreams(5)"><a href="./spirent.tcl.html#::deleteAllStreams_3469">::deleteAllStreams</a></a> $txPort
      
      <span class="comment-line"># initialize streamblock arguments</span>
      set stream_args {-insertSig FALSE}
      
      <span class="comment-line"># Size work : frameSizeType frameSizeMAX frameSizeMIN frameSize</span>
      switch [string tolower $frameSizeType] {
         &#34;sizerandom&#34; {
            lappend stream_args -FixedFrameLength &#34;128&#34; -frameLengthMode RANDOM -maxFrameLength $frameSizeMAX \
               -MinFrameLength $frameSizeMIN -EnableHighSpeedResultAnalysis &#34;FALSE&#34; -EqualRxPortDistribution &#34;FALSE&#34;
         }
         &#34;sizefixed&#34; {
            lappend stream_args -frameLengthMode FIXED -FixedFrameLength $frameSize -EqualRxPortDistribution &#34;FALSE&#34;
         }
         default { error &#34;Unsupported frameSizeType = $frameSizeType&#34;
         }
      }
      
      set txSpeed [<a name="::getPortSpeed(3)"><a href="./spirent.tcl.html#::getPortSpeed_3479">::getPortSpeed</a></a> $txPort]
      
      set eth_args {}
      <span class="comment-line"># get mac addresses</span>
      set srcAddr  [<a name="::GetDefaultPortIdMAC(6)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $txPort]
      set destAddr [<a name="::GetDefaultPortIdMAC(7)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $rxPort]
      if {$direction == &#34;2Way&#34;} {
         if {($txPort == $rxPort)} {
            if { $inSaMac == &#34;default&#34; } {
               lappend eth_args -srcMac [set sMacAddr $srcAddr]
            } else {
               lappend eth_args -srcMac [set sMacAddr [join $inDaMac :]]
            }
            if { $inDaMac == &#34;default&#34; } {
               lappend eth_args -dstMac [set dMacAddr $destAddr]
            } else {
               lappend eth_args -dstMac [set dMacAddr [join $inSaMac :]]
            }   
         } else {
            if { $inSaMac == &#34;default&#34; } {
               lappend eth_args -srcMac [set sMacAddr $srcAddr]
            } else {
               lappend eth_args -srcMac [set sMacAddr [join $inSaMac :]]
            }
            if { $inDaMac == &#34;default&#34; } {
               lappend eth_args -dstMac [set dMacAddr $destAddr]
            } else {
               lappend eth_args -dstMac [set dMacAddr [join $inDaMac :]]
            }
         }
      } else {
         if { $inSaMac == &#34;default&#34; } {
            lappend eth_args -srcMac [set sMacAddr $srcAddr]
         } else {
            lappend eth_args -srcMac [set sMacAddr [join $inSaMac :]]
         }
         if { $inDaMac == &#34;default&#34; } {
            lappend eth_args -dstMac [set dMacAddr $destAddr]
         } else {
            lappend eth_args -dstMac [set dMacAddr [join $inDaMac :]]
         }
      }         
      <span class="comment-line"># $fcsError</span>
      if {$fcsError == &#34;good&#34;} {
         lappend stream_args -EnableFcsErrorInsertion false
      } else {
         lappend stream_args -EnableFcsErrorInsertion true
      }
      
      <span class="comment-line"># Pattern work : $dataPattern (ixia has &#34;nonRepeat&#34; .. not sure what that means)</span>
      if {[string length $dataPattern] &lt;= 4} {
         lappend stream_args -ConstantFillPattern 0x$dataPattern -frameconfig {}
      } else {
         lappend stream_args -ConstantFillPattern 0 -frameconfig {}
      }
      
      <span class="comment-line"># Create basic stream</span>
      set hStreamBlock [eval logcmd stc::create streamBlock -under $txPort $stream_args]
      
      
      switch $ethernetType {
         ethernetII -
         noType {
            lappend eth_args -etherType [join $frameType {}]
            set hEthernet [eval logcmd stc::create ethernet:EthernetII -under $hStreamBlock \
                              -name sb1_eth $eth_args]
            incr dataoffset 14 ; lappend pktoffsets sb1_eth $dataoffset
            set vlanlen [<a name="::addVlans(4)"><a href="./spirent.tcl.html#::addVlans_3663">::addVlans</a></a> -stream $hStreamBlock -ethobj $hEthernet -wTag $wTag -tagNo $tagNo -tagCfi $tagCfi\
                            -tagMode $tagMode -tagRepeat $tagRepeat -protocolTagId $protocolTagId -tagPriority $tagPriority \
                            -protoOffsetEnable $protoOffsetEnable -userDefTag $userDefTag]
            if {$vlanlen &gt; 0} {incr dataoffset $vlanlen  ; lappend pktoffsets sb1_vlans $dataoffset}
         }
         ieee8022 {
            set hEthernet [eval logcmd stc::create ethernet:Ethernet8022 -under $hStreamBlock \
                              -name sb1_eth $eth_args]
            incr dataoffset 14; lappend pktoffsets sb1_eth $dataoffset
            set vlanlen [<a name="::addVlans(5)"><a href="./spirent.tcl.html#::addVlans_3663">::addVlans</a></a> -stream $hStreamBlock -ethobj $hEthernet -wTag $wTag -tagNo $tagNo -tagCfi $tagCfi\
                            -tagMode $tagMode -tagRepeat $tagRepeat -protocolTagId $protocolTagId -tagPriority $tagPriority \
                            -protoOffsetEnable $protoOffsetEnable -userDefTag $userDefTag]
            if {$vlanlen &gt; 0} {incr dataoffset $vlanlen  ; lappend pktoffsets sb1_vlans $dataoffset}
            set hLlc [eval logcmd stc::create llcheader -under $hEthernet \
                              -name sb1_llc]
            
            incr dataoffset 3 ; lappend pktoffsets sb1_llc $dataoffset
         }
         ieee8023snap {
            set hEthernet [eval logcmd stc::create ethernet:EthernetSnap -under $hStreamBlock \
                              -name sb1_eth $eth_args]
            incr dataoffset 14 ; lappend pktoffsets sb1_eth $dataoffset
            set vlanlen [<a name="::addVlans(6)"><a href="./spirent.tcl.html#::addVlans_3663">::addVlans</a></a> -stream $hStreamBlock -ethobj $hEthernet -wTag $wTag -tagNo $tagNo -tagCfi $tagCfi\
                            -tagMode $tagMode -tagRepeat $tagRepeat -protocolTagId $protocolTagId -tagPriority $tagPriority \
                            -protoOffsetEnable $protoOffsetEnable -userDefTag $userDefTag]
            if {$vlanlen &gt; 0} {incr dataoffset $vlanlen  ; lappend pktoffsets sb1_vlans $dataoffset}
            set hLlc [eval logcmd stc::create llcheader -under $hEthernet \
                              -name sb1_llc]
            incr dataoffset 3 ; lappend pktoffsets sb1_llc $dataoffset
            set hSnap [eval logcmd stc::create snapheader -under $hEthernet \
                              -name sb1_snap]
            incr dataoffset 5 ; lappend pktoffsets sb1_snap $dataoffset
         }
         default { error &#34;Ethernet Type not supported $ethernetType&#34; }
      }

      <a name="::modifyMacAddrs(3)"><a href="./spirent.tcl.html#::modifyMacAddrs_3595">::modifyMacAddrs</a></a> -stream $hStreamBlock -saMode $saMode -daMode $daMode -saCount $saCount \
         -daCount $daCount -sMacAddr $sMacAddr -dMacAddr $dMacAddr -numFrames $numFrames
      
      <span class="comment-line"># Kludge to get the first mac address DON'T think this is necessary</span>
      if {[llength $dMacAddr]&gt;2} {
         set dMacAdd $dMacAddr
      } else {
         set dMacAdd [lindex $dMacAddr $counter]
      }
      
      

      puts $pktoffsets
      if {$udfEnable == &#34;true&#34;} {
         if {$streamType == &#34;continuous&#34;} {set recycleCount 0} else {set recycleCount $numFrames}
         foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
            if {[set place [expr $udfOffs - $dataoffset]] &lt; 0} {
               <a name="::insertUdfInHeader(1)"><a href="./spirent.tcl.html#::insertUdfInHeader_3966">::insertUdfInHeader</a></a> $hStreamBlock $pktoffsets $initVal $udfOffs $counterType
               foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
            }
         }
      }                     
      
      switch [string tolower $protocol] {
         <a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> {
            set hIpv4 [<a name="::logcmd(188)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                          -protocol 255 -identification 0]
            <span class="comment-line"># disable IP ID field auto increment </span>
            set hRangeModifier [<a name="::logcmd(189)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                   -under $hStreamBlock \
                                   -ModifierMode INCR \
                                   -Mask 65535 \
                                   -StepValue &#34;1&#34; \
                                   -Data 0 \
                                   -RecycleCount 65535 \
                                   -DataType NATIVE \
                                   -EnableStream false \
                                   -RepeatCount 0 \
                                   -OffsetReference &#34;sb1_ip.identification&#34;]
            incr dataoffset 20 ; lappend pktoffsets sb1_ip $dataoffset
            <span class="comment-line"># check if s/d IP addresses are being incremented via udf</span>
            if {$udfEnable == &#34;true&#34;} {
               if {$streamType == &#34;continuous&#34;} {set recycleCount 0} else {set recycleCount $numFrames}
               foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
                  if {[set place [expr $udfOffs - $dataoffset]] &lt; 0} {
                     switch $place {
                        -14 {
                           <span class="comment-line"># do source ip</span>
                           set hRangeModifer1 [<a name="::logcmd(190)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                                  -under $hStreamBlock \
                                                  -ModifierMode INCR \
                                                  -Mask 0xffff \
                                                  -StepValue 1 \
                                                  -Data 0x[join $initVal {}] \
                                                  -RecycleCount $recycleCount \
                                                  -RepeatCount 0 \
                                                  -DataType NATIVE \
                                                  -EnableStream false \
                                                  -OffsetReference &#34;sb1_ip.fragOffset&#34;]
                        }
                        -8 {
                           <span class="comment-line"># do source ip</span>
                           set hRangeModifer1 [<a name="::logcmd(191)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                                  -under $hStreamBlock \
                                                  -ModifierMode INCR \
                                                  -Mask 255.255.255.255 \
                                                  -StepValue 0.0.0.1 \
                                                  -Data [<a name="::int2ip(5)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> 0x[join $initVal {}]] \
                                                  -RecycleCount $recycleCount \
                                                  -RepeatCount 0 \
                                                  -DataType NATIVE \
                                                  -EnableStream false \
                                                  -OffsetReference &#34;sb1_ip.sourceAddr&#34;]
                        }
                        -4 {
                           <span class="comment-line"># do dest ip</span>
                           set hRangeModifer1 [<a name="::logcmd(192)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                                  -under $hStreamBlock \
                                                  -ModifierMode INCR \
                                                  -Mask 255.255.255.255 \
                                                  -StepValue 0.0.0.1 \
                                                  -Data [<a name="::int2ip(6)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> 0x[join $initVal {}]] \
                                                  -RecycleCount $recycleCount \
                                                  -RepeatCount 0 \
                                                  -DataType NATIVE \
                                                  -EnableStream false \
                                                  -OffsetReference &#34;sb1_ip.destAddr&#34;]
                        }
                        default { error &#34;Unsupported UDF in IP address of L2 packet offset = $place&#34;}
                     }
                     foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
                  }
               }
            }
         }
         mac {
            <a name="::logcmd(193)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hEthernet -etherType [join $dataPattern {}]
         }
         <a name="::ipx(1)"><a href="./ePTClient.tcl.html#::ipx_1107">::ipx</a></a> {
            if {$ethernetType == &#34;noType&#34; || $ethernetType == &#34;ethernetII&#34;} {
               <a name="::logcmd(194)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hEthernet -etherType 8137
            }
         }
         default { error &#34;Protocol not supported : $protocol&#34; }
      }
      if {$udfEnable == &#34;true&#34; &amp; [llength $udfOffset] &gt; 0} {
         set udflen [<a name="::InsertUDFs(3)"><a href="./spirent.tcl.html#::InsertUDFs_3240">::InsertUDFs</a></a> $hStreamBlock $dataoffset $dataPattern $udfOffset $udfInitval $udfCountertype $numFrames $streamType]
         incr dataoffset $udflen 
      }

      if {[string length $dataPattern] &gt; 4} {
         set patternlen [expr $frameSize - $dataoffset - 5]
         set streampattern [<a name="::createFillStr(3)"><a href="./spirent.tcl.html#::createFillStr_3280">::createFillStr</a></a> $dataPattern $patternlen]
         set fill [<a name="::logcmd(195)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $hStreamBlock -pattern $streampattern]
      }
      
      <span class="comment-line"># configure generator</span>
      <a name="::configGen(3)"><a href="./spirent.tcl.html#::configGen_3141">::configGen</a></a> $txPort $streamType $frameSize $rate $percentage $txSpeed $numFrames
      lappend txPorts $txPort
      incr counter
   }

   if {$ZeroStats == &#34;yes&#34; } {
      <a name="::logcmd(196)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList $txPorts
   }
   
   if {$dontTx==0} {
      <a name="::StartPortsTransmit(8)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $txPorts
   }

   if {[string tolower $streamType] != &#34;contpacket&#34; &amp;&amp; $dontTx==0} {
      foreach txPort $txPorts {
         <a name="::stcCheckTxDone(5)"><a href="./spirent.tcl.html#::stcCheckTxDone_348">::stcCheckTxDone</a></a> -txPortId $txPort
      }
   }
   
   if {$dontTx==0} {
      <span class="comment-line"># return the last packet created (this really only useful for 1-way traffic)</span>
      return [<a name="::getFrameContents(4)"><a href="./spirent.tcl.html#::getFrameContents_3204">::getFrameContents</a></a> $hStreamBlock $protocol]
   }
}



<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaConf_2Ports_arp   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#	Set up an ixia port to send ARP packets (request or reply)		     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	set frameSent [ixiaConf_2Ports_arp -numIxiaCd $numIxiaCd \</span>
<span class="comment-line">#             -txChas $chasisId -txCard $card -txPort $port -startCardNum $startCardNum \</span>
<span class="comment-line">#             -rxChas $chasisId -rxCard $card -rxPort $rxPo \</span>
<span class="comment-line">#             -operation $type -sMacAddr $sourceMac -dMacAddr $destMac \</span>
<span class="comment-line">#             -sIpAddr $sourceIp -dIpAddr $destIp -numFrames $numFrames \</span>
<span class="comment-line">#	      -wTag $wTag -tagNo $tag -frameSize $frameSize -streamType $streamType \</span>
<span class="comment-line">#	      -arpSaMode $arpSaMode -arpDaMode $arpDaMode -percentage $percentage \</span>
<span class="comment-line">#	      -arpSaRepeat $arpSaRepeat -arpDaRepeat $arpDaRepeat]   </span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ixiaConf_2Ports_arp_2847">proc <a href="spirent.tcl-annot.html#::::ixiaConf_2Ports_arp">::::ixiaConf_2Ports_arp</a></a></strong> {args} {
puts &#34;[lindex [info level 0] 0] : $args&#34;
   <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> ixiaConf_2Ports_arp $args {
      numIxiaCd &#34;1&#34;
      startCardNum &#34;1&#34;
      direction &#34;1Way&#34;
      txChas &#34;n/a&#34;
      txCard &#34;n/a&#34;
      txPort &#34;port1&#34;
      rxChas &#34;n/a&#34;
      rxCard &#34;n/a&#34;
      rxPort &#34;port2&#34;
      sMacAddr &#34;default&#34;
      dMacAddr &#34;ff ff ff ff ff ff&#34;
      sIpAddr &#34;127.0.0.1&#34;
      dIpAddr &#34;127.0.0.1&#34;
      arpSaMode &#34;arpIdle&#34;
      arpDaMode &#34;arpIdle&#34;
      operation &#34;arpRequest&#34;
      goodChecksum &#34;true&#34;
      numFrames &#34;1&#34;
      frameSize &#34;64&#34;
      frameRate &#34;default&#34;
      dataPattern &#34;0000&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      wTag &#34;false&#34;
      tagNo &#34;002&#34;
      tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat &#34;1&#34;
      userPriority &#34;0&#34;
      percentage &#34;0.01&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      chid &#34;1&#34;
      arpSaRepeat &#34;1&#34;
      arpDaRepeat &#34;1&#34;
      srcHwAddr &#34;default&#34;
      srcHwAddrMode &#34;arpIdle&#34;
      srcHwAddrRepeat &#34;1&#34;
      destHwAddr &#34;default&#34;
      destHwAddrMode &#34;arpIdle&#34;
      destHwAddrRepeat &#34;1&#34;   
      udfEnable &#34;false&#34;
      udfInitval &#34;00&#34;
      udfOffset &#34;0&#34;
      udfCountertype &#34;c8&#34;
      udfContinuousCount &#34;false&#34;
      dontTx &#34;0&#34;
   }
   global spawn_id
   global one2oneArray
   global macBroadcast
   global preambleSize
<span class="comment-line">#   protocolStackSetDefault</span>

   set date [clock format [clock seconds] -format &#34;%m-%d-%Y %I.%M.%S%p&#34;]
   <span class="comment-line">#result_debug &#34;\n*** date=$date&#34;</span>
   set time1 [clock seconds]
   set patternOffset				32
   set macBroadcast					{ff ff ff ff ff ff}
   set preambleSize					8


   <span class="comment-line"># Config streams for validation traffic</span>
   set wkTag $wTag
   set wkTagNo $tagNo
   set portNo 0
   set portList {}
   lappend portList $txPort $rxPort
   if {$direction == &#34;2Way&#34;} {lappend portList $rxPort $txPort}


   <span class="comment-line"># Config streams for validation traffic</span>

   foreach {txPort rxPort} $portList {
      set dataoffset 0
      if { $wkTag == &#34;true&#34; } {
         set wTag &#34;true&#34;
         set tagNo [lindex $wkTagNo $portNo]
         incr portNo
         if { $tagNo == &#34;&#34; } {set tagNo [lindex $wkTagNo 0]}
         if { $tagNo == 0 || $tagNo == &#34;none&#34; } {set wTag &#34;false&#34;}
         <a name="::result_debug(46)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;wTag = $wTag, tagNo = $tagNo&#34;
      }

      <span class="comment-line">#Stop generator before making changes.</span>
      <a name="::logcmd(197)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $txPort
      
      <span class="comment-line"># Delete all streamblocks on tx port</span>
      set lsthStreamblocks [<a name="::logcmd(198)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPort -children-StreamBlock]
      foreach hStreamblock $lsthStreamblocks {
         <a name="::logcmd(199)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $hStreamblock
      }
      <a name="::logcmd(200)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
      
      <span class="comment-line"># initialize streamblock arguments</span>
      set stream_args {-insertSig FALSE}

      lappend stream_args -frameLengthMode FIXED -FixedFrameLength $frameSize -EqualRxPortDistribution &#34;FALSE&#34;
   
      set txSpeed [<a name="::getPortSpeed(4)"><a href="./spirent.tcl.html#::getPortSpeed_3479">::getPortSpeed</a></a> $txPort]

      <span class="comment-line"># $fcsError</span>
      if {$fcsError == &#34;good&#34;} {
         lappend stream_args -EnableFcsErrorInsertion false
      } else {
         lappend stream_args -EnableFcsErrorInsertion true
      }

      <span class="comment-line"># Pattern work : $dataPattern (ixia has &#34;nonRepeat&#34; .. not sure what that means)</span>
      if {[string length $dataPattern] &lt;= 4} {
         lappend stream_args -ConstantFillPattern 0x$dataPattern -frameconfig {}
      } else {
         lappend stream_args -ConstantFillPattern 0 -frameconfig {}
      }
    
      <span class="comment-line"># Create basic stream</span>
      set hStreamBlock [eval logcmd stc::create streamBlock -under $txPort $stream_args]

      set eth_args {}
      if {$sMacAddr == &#34;default&#34;} {
         set sMacAddr [<a name="::GetDefaultPortIdMAC(8)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $txPort]
      }
      lappend eth_args -srcMac [join $sMacAddr :]
      
      
      <span class="comment-line"># $dMacAddr</span>
      if {$dMacAddr == &#34;default&#34;} {
         set dMacAddr [<a name="::GetDefaultPortIdMAC(9)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $rxPort]
      }
      lappend eth_args -dstMac [join $dMacAddr :]
      
      set hEthernet [eval logcmd stc::create ethernet:EthernetII -under $hStreamBlock \
                        -name sb1_eth $eth_args]
      incr dataoffset 14

      <a name="::modifyMacAddrs(4)"><a href="./spirent.tcl.html#::modifyMacAddrs_3595">::modifyMacAddrs</a></a> -stream $hStreamBlock -saMode $saMode -daMode $daMode \
         -sMacAddr $sMacAddr -dMacAddr $dMacAddr -numFrames $numFrames

      set vlanlen [<a name="::addVlans(7)"><a href="./spirent.tcl.html#::addVlans_3663">::addVlans</a></a> -stream $hStreamBlock -ethobj $hEthernet -wTag $wTag -tagNo $tagNo -tagCfi $tagCfi \
                      -tagMode $tagMode -tagRepeat $tagRepeat -tagPriority $userPriority]
      incr dataoffset $vlanlen
     
      if {$srcHwAddr==&#34;default&#34;} {
         set srcHwAddr $sMacAddr
      }
      
      if {$destHwAddr==&#34;default&#34;} {
         set destHwAddr $dMacAddr
      }

      switch $operation {
         arpRequest {set op 1}
         arpReply   {set op 2}
         default    {error &#34;Unsupported ARP opertation type: $operation&#34;}
      }
      set hArp [<a name="::logcmd(201)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create arp:ARP -under $hStreamBlock -name sb1_arp -operation $op \
                   -senderHwAddr [join $srcHwAddr :] -targetHwAddr [join $destHwAddr :] \
                   -senderPAddr $sIpAddr -targetPAddr $dIpAddr]

      incr dataoffset 28
      if {$arpSaMode != &#34;arpIdle&#34;} {
         set hRangeModifier [<a name="::logcmd(202)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                -under $hStreamBlock \
                                -ModifierMode INCR \
                                -Mask &#34;255.255.255.255&#34; \
                                -StepValue &#34;0.0.0.1&#34; \
                                -Data $sIpAddr \
                                -RecycleCount $arpSaRepeat \
                                -DataType NATIVE \
                                -EnableStream false \
                                -OffsetReference &#34;sb1_arp.senderPAddr&#34;]
      }
      if {$arpDaMode != &#34;arpIdle&#34;} {
         set hRangeModifier [<a name="::logcmd(203)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                -under $hStreamBlock \
                                -ModifierMode INCR \
                                -Mask &#34;255.255.255.255&#34; \
                                -StepValue &#34;0.0.0.1&#34; \
                                -Data $dIpAddr \
                                -RecycleCount $arpDaRepeat \
                                -DataType NATIVE \
                                -EnableStream false \
                                -OffsetReference &#34;sb1_arp.targetPAddr&#34;]
      }
      
      if {$srcHwAddrMode != &#34;arpIdle&#34;} {
         <span class="comment-line"># Use modifier to generate multiple streams.</span>
         set hRangeModifier [<a name="::logcmd(204)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                -under $hStreamBlock \
                                -ModifierMode INCR \
                                -Mask &#34;00:00:FF:FF:FF:FF&#34; \
                                -StepValue &#34;00:00:00:00:00:01&#34; \
                                -Data [join $srcHwAddr :] \
                                -RecycleCount $srcHwAddrRepeat \
                                -DataType NATIVE \
                                -EnableStream false \
                                -OffsetReference &#34;sb1_arp.senderHwAddr&#34;]
      }
      if {$destHwAddrMode != &#34;arpIdle&#34;} {
         <span class="comment-line"># Use modifier to generate multiple streams.</span>
         set hRangeModifier [<a name="::logcmd(205)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                -under $hStreamBlock \
                                -ModifierMode INCR \
                                -Mask &#34;00:00:FF:FF:FF:FF&#34; \
                                -StepValue &#34;00:00:00:00:00:01&#34; \
                                -Data [join $destHwAddr :] \
                                -RecycleCount $destHwAddrRepeat \
                                -DataType NATIVE \
                                -EnableStream false \
                                -OffsetReference &#34;sb1_arp.targetHwAddr&#34;]
      }
      if {$udfEnable == &#34;true&#34;} {
         if {$streamType == &#34;continuous&#34;} {set recycleCount 0} else {set recycleCount $numFrames}
         foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
            set counterByteLen [<a name="::getCounterByteLen(1)"><a href="./spirent.tcl.html#::getCounterByteLen_3302">::getCounterByteLen</a></a> $counterType]
            if {[set place [expr $udfOffs - $dataoffset]] &lt; 0} {
               switch $place {
                  -28 {
                     set hRangeModifer1 [<a name="::logcmd(206)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                            -under $hStreamBlock \
                                            -ModifierMode INCR \
                                            -Mask [<a name="::makeMaskOffset(1)"><a href="./spirent.tcl.html#::makeMaskOffset_3296">::makeMaskOffset</a></a> 2 $counterByteLen] \
                                            -StepValue [<a name="::makeStepValue(1)"><a href="./spirent.tcl.html#::makeStepValue_3314">::makeStepValue</a></a> 2 $counterByteLen] \
                                            -Data [<a name="::makeDataValue(1)"><a href="./spirent.tcl.html#::makeDataValue_3310">::makeDataValue</a></a> 2 $counterByteLen $initVal] \
                                            -RecycleCount $recycleCount \
                                            -RepeatCount 0 \
                                            -DataType NATIVE \
                                            -EnableStream false \
                                            -OffsetReference &#34;sb1_arp.hardware&#34;]
                  }
               }  
               foreach var { udfOffset udfInitval udfCountertype } { set $var [eval lrange $$var 1 end] }
            }
         }
      }
      if {[string length $dataPattern] &gt; 4} {
         set patternlen [expr $frameSize - $dataoffset - 5]
         set streampattern [<a name="::createFillStr(4)"><a href="./spirent.tcl.html#::createFillStr_3280">::createFillStr</a></a> $dataPattern $patternlen]
         set fill [<a name="::logcmd(207)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $hStreamBlock -pattern $streampattern]
      }

      if {$udfEnable == &#34;true&#34; &amp; [llength $udfOffset] &gt; 0} {
         set udflen [<a name="::InsertUDFs(4)"><a href="./spirent.tcl.html#::InsertUDFs_3240">::InsertUDFs</a></a> $hStreamBlock $dataoffset $dataPattern $udfOffset $udfInitval $udfCountertype $numFrames $streamType]
         incr dataoffset $udflen
      }
   }

   <a name="::logcmd(208)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
   
   <a name="::logcmd(209)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList &#34;$txPort $rxPort&#34;
   
   set gen_args {}
   <span class="comment-line"># Rate work:  $txSpeed $frameSize $percentage</span>
   if { $frameRate == &#34;default&#34; } {
      set frameRate [<a name="::decideFrameRate(1)"><a href="./ePTMisc.tcl.html#::decideFrameRate_423">::decideFrameRate</a></a> $txSpeed $frameSize $percentage]
      if {$frameRate &lt; 1} {
         set percentage [<a name="::decidePercentage(1)"><a href="./ePTMisc.tcl.html#::decidePercentage_471">::decidePercentage</a></a> $txSpeed $frameSize 1]
      }
   } else {
      set percentage [<a name="::decidePercentage(2)"><a href="./ePTMisc.tcl.html#::decidePercentage_471">::decidePercentage</a></a> $txSpeed $frameSize $frameRate]
   }
   if {$percentage &gt; 100} {set percentage 100}
   lappend gen_args -loadunit PERCENT_LINE_RATE -FixedLoad $percentage
   
   <span class="comment-line"># Count work: $numFrames $streamType (replaces &#34;decideLoopCount $numFrames $streamType&#34;)</span>
    switch [string tolower $streamType] {
      &#34;stopstream&#34; { lappend gen_args -DurationMode BURSTS -BurstSize $numFrames -duration 1 }
      &#34;contpacket&#34; -
      &#34;continuous&#34; { lappend gen_args -DurationMode CONTINUOUS }
      default { error &#34;Unsupported streamType = $streamType&#34; }
   }
   set hGeneratorConfig [eval logcmd stc::config $txPort.Generator.GeneratorConfig $gen_args]
   
   <span class="comment-line"># Apply changes.</span>
   <a name="::logcmd(210)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
   
   if {$dontTx==0} {
      <a name="::StartPortsTransmit(9)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $txPort
   }
   if {[string tolower $streamType] != &#34;contpacket&#34; &amp;&amp; $dontTx==0} {
      <a name="::stcCheckTxDone(6)"><a href="./spirent.tcl.html#::stcCheckTxDone_348">::stcCheckTxDone</a></a> -txPortId $txPort
   }
   
   if {$dontTx==0} {
      return [<a name="::getFrameContents(5)"><a href="./spirent.tcl.html#::getFrameContents_3204">::getFrameContents</a></a> $hStreamBlock arp]
   } else {
      return &#34;&#34;
   }
}


<strong><a name="::::configGen_3141">proc <a href="spirent.tcl-annot.html#::::configGen">::::configGen</a></a></strong> {txPort streamType frameSize frameRate percentage txSpeed numFrames} {

   <span class="comment-line"># reset gen to default config before modifying</span>
   <a name="::logcmd(211)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $txPort.Generator.GeneratorConfig -AdvancedInterleaving FALSE -BurstSize 1 \
      -Duration 30 -DurationMode CONTINUOUS -FixedLoad 10 \
      -InterFrameGap 12 -InterFrameGapUnit BYTES -JumboFrameThreshold 1518 \
      -LoadMode FIXED -LoadUnit PERCENT_LINE_RATE -OversizeFrameThreshold 9018 \
      -RandomLengthSeed 10900842 -RandomMaxLoad 100 -RandomMinLoad 10 \
      -SchedulingMode PORT_BASED -StepSize 1 -TimestampLatchMode START_OF_FRAME \
      -UndersizeFrameThreshold 64
   <a name="::logcmd(212)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply

   <span class="comment-line"># set new args</span>
   set gen_args {}
   if { ![string is double $frameRate] } {
      set frameRate [<a name="::getRateFromPct(1)"><a href="./spirentStreams.tcl.html#::getRateFromPct_390">::getRateFromPct</a></a> $percentage $frameSize $txSpeed]
   }

   <span class="comment-line"># Count work: $numFrames $streamType (replaces &#34;decideLoopCount $numFrames $streamType&#34;)</span>
   switch -glob [string tolower $streamType] {
      stop* { 
         lappend gen_args -DurationMode BURSTS -BurstSize $numFrames -duration 1 \
            -loadunit FRAMES_PER_SECOND -FixedLoad [<a name="::getRateFromPct(2)"><a href="./spirentStreams.tcl.html#::getRateFromPct_390">::getRateFromPct</a></a> 10 $frameSize $txSpeed]
      }
      cont*  { 
         lappend gen_args -DurationMode CONTINUOUS -duration 30
         lappend gen_args -loadunit FRAMES_PER_SECOND -FixedLoad $frameRate
      }
      default { error &#34;Unsupported streamType = $streamType&#34; }
   }
   lappend gen_args -SchedulingMode PORT_BASED 
   set hGeneratorConfig [eval logcmd stc::config $txPort.Generator.GeneratorConfig $gen_args]
   <span class="comment-line"># Apply changes.</span>
   <a name="::logcmd(213)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
}

<strong><a name="::::adjustUdpTcpPacketContents_3177">proc <a href="spirent.tcl-annot.html#::::adjustUdpTcpPacketContents">::::adjustUdpTcpPacketContents</a></a></strong> { hexlist ipoffset } {

   <span class="comment-line">#pad with zero if</span>
   set mainhex [lrange $hexlist [expr $ipoffset+12] end-2]
   lappend mainhex 00 00
   set len [expr [llength $mainhex]-8]
   if {[set pad [expr [set length [llength $mainhex]] % 4]] &gt; 0} {
      for {set i 0} {$i &lt; $pad} {incr i} { lappend mainhex 00}
   }

   <span class="comment-line"># sum up the mainhex </span>
   set sum 0
   for {set i 0} {$i &lt; $length} {incr i 4} {
      set tmp &#34;0x[join [lrange $mainhex $i [expr {$i + 3}]] {}]&#34;
      set sum [expr {$sum + $tmp}]
   }

   <span class="comment-line"># add on the protocol and UDP length</span>
   set tmp  0x[lindex $hexlist [expr $ipoffset + 9]][format %04X $len]
   set sum [expr $sum + $tmp]
 
   set sumx [expr ($sum &amp; 0x0000ffff) + (($sum &gt;&gt; 16) &amp; 0x0000ffff) + (($sum &gt;&gt; 32) &amp; 0x0000ffff)]
   set sumx [expr ($sumx &amp; 0x0000ffff) + (($sumx &gt;&gt; 16) &amp; 0x0000ffff)]
   set sum [string toupper [format %04x [expr {$sumx ^ 0xffff}]]]
   return [lreplace $hexlist end-1 end [string range $sum 0 1] [string range $sum 2 3]]
}

<strong><a name="::::getFrameContents_3204">proc <a href="spirent.tcl-annot.html#::::getFrameContents">::::getFrameContents</a></a></strong> {streamobj protocol {ipoffset 14}} {
   package require crc32
   <a name="::logcmd(214)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GetPreviewData -StreamBlock $streamobj
   set szFrameContents [string toupper [string range &#34;[<a name="::logcmd(215)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::logcmd(216)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $streamobj -children-PreviewData] -HexData]&#34; 16 end]]
   set szFrameContents [scan $szFrameContents  [string repeat &#34;%2s&#34; [expr [string length $szFrameContents]/2]]]
   if {$protocol == &#34;udp&#34; | $protocol == &#34;tcp&#34;} {set szFrameContents [<a name="::adjustUdpTcpPacketContents(1)"><a href="./spirent.tcl.html#::adjustUdpTcpPacketContents_3177">::adjustUdpTcpPacketContents</a></a> $szFrameContents $ipoffset]}
   set crc [crc::crc32 -format %08X [binary format H* [join $szFrameContents {}]]]
   set crc [list [string range $crc 6 7] [string range $crc 4 5] [string range $crc 2 3] [string range $crc 0 1]]
   eval lappend szFrameContents $crc
   <a name="::result_debug(47)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$szFrameContents&#34;
   <span class="comment-line"># attempted udp hack</span>
   return $szFrameContents
}

<span class="comment-line"># return that the port is not 8 or 82 (fiber ports in Ixia world)</span>
<strong><a name="::::getIxiaPortType_3219">proc <a href="spirent.tcl-annot.html#::::getIxiaPortType">::::getIxiaPortType</a></a></strong> {<a name="::port(2)"><a href="./spirent.tcl.html#::port_927">::port</a></a> } {
   return 1
}

<strong><a name="::::dec2bin_3223">proc <a href="spirent.tcl-annot.html#::::dec2bin">::::dec2bin</a></a></strong> {int} {
   return [format %llb $int]
}

<strong><a name="::::int2bits_3227">proc <a href="spirent.tcl-annot.html#::::int2bits">::::int2bits</a></a></strong> {int cnt} {
   set bin [string trimleft [string map {
      0 {000} 1 {001} 2 {010} 3 {011} 4 {100} 5 {101} 6 {110} 7 {111}
   } [format %o $int]] 0]
   if {$bin == {}} {set bin 0}
   return [format %0${cnt}s $bin]
}


<strong><a name="::::InsertStaticUDFs_3236">proc <a href="spirent.tcl-annot.html#::::InsertStaticUDFs">::::InsertStaticUDFs</a></a></strong> {streamblockHndl dataoffset pattern udfOffset udfInitval udfCountertype recycleCount streamtype} {

}

<strong><a name="::::InsertUDFs_3240">proc <a href="spirent.tcl-annot.html#::::InsertUDFs">::::InsertUDFs</a></a></strong> {streamblockHndl dataoffset pattern udfOffset udfInitval udfCountertype recycleCount streamtype} {
   puts &#34;[lindex [info level 0] 0] : $streamblockHndl {$dataoffset} {$pattern} {$udfOffset} {$udfInitval} {$udfCountertype} {$recycleCount} {$streamtype}&#34;

   <span class="comment-line"># make the custom header </span>
   set highoffset [lindex $udfOffset 0]
   if {[string is integer [lindex $udfCountertype 0]]} {
      set highbitcnt [lindex $udfCountertype 0]
   } else {
      set highbitcnt [string range [lindex $udfCountertype 0] 1 end]
   }
puts &#34;HIGHBITCNT : $highbitcnt&#34;
puts &#34;UDFOFFSET  : $udfOffset&#34;
   if {[llength $udfOffset] &gt; 1} {
      foreach i $udfOffset j $udfCountertype { 
         if {$highoffset &lt; $i} {set highoffset $i}
         if {$highbitcnt &lt; [string range $j 1 end]} {set highbitcnt $j}
      }
   }
   set udflen 0
   foreach ctr $udfCountertype { incr udflen [<a name="::getCounterByteLen(2)"><a href="./spirent.tcl.html#::getCounterByteLen_3302">::getCounterByteLen</a></a> $ctr]}
puts &#34;UDFLEN     : $udflen&#34;
   set hdrlen [expr $highoffset+$udflen -$dataoffset]
   set customHeader [<a name="::logcmd(217)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $streamblockHndl -pattern [<a name="::createFillStr(5)"><a href="./spirent.tcl.html#::createFillStr_3280">::createFillStr</a></a> $pattern $hdrlen] -Name udf_field]

   foreach udfOffs $udfOffset initVal $udfInitval counterType $udfCountertype {
      if {$streamtype == &#34;continuous&#34;} {set recycleCount 0}
      set mask [<a name="::makeMask(1)"><a href="./spirent.tcl.html#::makeMask_3290">::makeMask</a></a> [<a name="::getCounterByteLen(3)"><a href="./spirent.tcl.html#::getCounterByteLen_3302">::getCounterByteLen</a></a> $counterType]]
      set hRangeModifer [<a name="::logcmd(218)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                            -under $streamblockHndl \
                            -StepValue 1 \
                            -Mask $mask \
                            -Data [join $initVal &#34;&#34;] \
                            -DataType BYTE \
                            -RecycleCount $recycleCount \
                            -offset [expr $udfOffs-$dataoffset] \
                            -OffsetReference &#34;udf_field.pattern&#34;]
   }
   return $hdrlen
}
 
<strong><a name="::::createFillStr_3280">proc <a href="spirent.tcl-annot.html#::::createFillStr">::::createFillStr</a></a></strong> {fill length} {
   incr length $length
   set fill [join $fill {}]
   while {[string length $fill] &lt; $length} {
      append fill $fill
   }
   set fill [string range $fill 0 $length]
   return $fill
}

<strong><a name="::::makeMask_3290">proc <a href="spirent.tcl-annot.html#::::makeMask">::::makeMask</a></a></strong> {length} {
   set mask {}
   for {set i 0} {$i &lt; $length} {incr i} {append mask ff}
   return $mask
}

<strong><a name="::::makeMaskOffset_3296">proc <a href="spirent.tcl-annot.html#::::makeMaskOffset">::::makeMaskOffset</a></a></strong> {fieldlen incrlen} {
   set retmask [<a name="::makeMask(2)"><a href="./spirent.tcl.html#::makeMask_3290">::makeMask</a></a> $incrlen]
   for {set i 1} {$i &lt;= [expr $fieldlen-$incrlen]} {incr i} {append retmask 00}
   return $retmask
}

<strong><a name="::::getCounterByteLen_3302">proc <a href="spirent.tcl-annot.html#::::getCounterByteLen">::::getCounterByteLen</a></a></strong> {countertype} {
   if {[string is integer $countertype]} {
      return [expr $countertype/8]
   } else {
      return [expr [string range $countertype 1 end]/8]
   }
}

<strong><a name="::::makeDataValue_3310">proc <a href="spirent.tcl-annot.html#::::makeDataValue">::::makeDataValue</a></a></strong> {fieldlen incrlen value} {
   return [<a name="::makeStepValue(2)"><a href="./spirent.tcl.html#::makeStepValue_3314">::makeStepValue</a></a> $fieldlen $incrlen 0x$value]
}

<strong><a name="::::makeStepValue_3314">proc <a href="spirent.tcl-annot.html#::::makeStepValue">::::makeStepValue</a></a></strong> {fieldlen incrlen {incr 1}} {
   return [format %0[expr $fieldlen*2]X [expr $incr &lt;&lt; [expr ($fieldlen-$incrlen)*8]]]
}

<strong><a name="::::getIPv4Header_3318">proc <a href="spirent.tcl-annot.html#::::getIPv4Header">::::getIPv4Header</a></a></strong> { object ipoffset } {

   set pktbytelist [<a name="::getFrameContents(6)"><a href="./spirent.tcl.html#::getFrameContents_3204">::getFrameContents</a></a> $object ip $ipoffset]
   set iphdr [lrange $pktbytelist $ipoffset [expr ((0x[lindex $pktbytelist $ipoffset] &amp; 0x0F)*4)+$ipoffset]]
   return $iphdr
}

<strong><a name="::::getIPv4Checksum.old_3325">proc <a href="spirent.tcl-annot.html#::::getIPv4Checksum.old">::::getIPv4Checksum.old</a></a></strong> {hexstr {options {}}} {
   set hexstr [string replace [join $hexstr {}] 20 23 0000]
   set length [expr [string length $hexstr]/2]
   set sum 0
   for {set i 0} {$i &lt; $length} {incr i 4} {
      set tmp &#34;0x[string range $hexstr $i [expr {$i + 3}]]&#34;
      set sum [expr {$sum + $tmp}]
      if {$sum &gt; 0xffff} {
         set sum [expr {($sum &amp; 0xffff) + 1}]
      } 
   }
<span class="comment-line">#    set sumx [expr ($sum &amp; 0x0000ffff) + (($sum &gt;&gt; 16) &amp; 0x0000ffff) + (($sum &gt;&gt; 32) &amp; 0x0000ffff)]</span>
<span class="comment-line">#    set sum [string toupper [format %04x [expr {$sumx ^ 0xffff}]]]</span>
   
   set sum [expr {$sum ^ 0xffff}]     
   return $sum
}


<strong><a name="::::getAdjustedOptions_3344">proc <a href="spirent.tcl-annot.html#::::getAdjustedOptions">::::getAdjustedOptions</a></a></strong> {hexstr} {
   set zeros [expr 8 - [string length [join $hexstr {}]]%8]
   if {$zeros == 8} {set zeros 0}
   for {set i 0} {$i &lt; [expr $zeros/2]} {incr i 2} {
      lappend hexstr 00
   }
   return $hexstr
}

<strong><a name="::::getIPv4Checksum_3353">proc <a href="spirent.tcl-annot.html#::::getIPv4Checksum">::::getIPv4Checksum</a></a></strong> {args} {

   set arg(-ilh)        5
   set arg(-sourceaddr) 0.0.0.0
   set arg(-destaddr)   0.0.0.0
   set arg(-ttl)        255
   set arg(-id)         0
   set arg(-protocol)   0
   set arg(-optionstr)  {}
   set arg(-tos)        0
   set arg(-length)     64 

   array set arg [string tolower $args]

   set ip {}
   append ip 4[format %01x $arg(-ilh)][format %02x $arg(-tos)][format %04x $arg(-length)]
   append ip [format %04x $arg(-id)]0000
   append ip [format %02x $arg(-ttl)][format %02x $arg(-protocol)]0000
   append ip [format %08x [<a name="::ip2int(3)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> $arg(-sourceaddr)]]
   append ip [format %08x [<a name="::ip2int(4)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> $arg(-destaddr)]]
   append ip $arg(-optionstr)
puts &#34;IP STRING $ip&#34;
   set length [expr [string length $ip]/2]
   set sum 0
   for {set i 0} {$i &lt; $length} {incr i 4} {
      set tmp &#34;0x[string range $ip $i [expr {$i + 3}]]&#34;
      set sum [expr {$sum + $tmp}]
      if {$sum &gt; 0xffff} {
         set sum [expr {($sum &amp; 0xffff) + 1}]
      } 
   }
<span class="comment-line">#    set sumx [expr ($sum &amp; 0x0000ffff) + (($sum &gt;&gt; 16) &amp; 0x0000ffff) + (($sum &gt;&gt; 32) &amp; 0x0000ffff)]</span>
<span class="comment-line">#    set sum [string toupper [format %04x [expr {$sumx ^ 0xffff}]]]</span>
   
   set sum [expr {$sum ^ 0xffff}]     
   return $sum
   
}
<strong><a name="::::getIGMPv2Checksum_3391">proc <a href="spirent.tcl-annot.html#::::getIGMPv2Checksum">::::getIGMPv2Checksum</a></a></strong> {args} {

   set arg(-type)         0x11
   set arg(-groupaddress) 225.0.0.1
   set arg(-maxreaptime)  100

   array set arg [string tolower $args]

   set igmp {}
   append igmp [format %02x $arg(-type)][format %02x $arg(-maxreaptime)]0000
   append igmp [format %08x [<a name="::ip2int(5)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> $arg(-groupaddress)]]
   set length [string length $igmp]
   set sum 0
   for {set i 0} {$i &lt; $length} {incr i 4} {
      set tmp &#34;0x[string range $igmp $i [expr {$i + 3}]]&#34;
      <span class="comment-line">#puts &#34;[format %04x $sum] + $tmp = ...&#34;</span>
      set sum [expr {$sum + $tmp}]
      if {$sum &gt; 0xffff} {
         set sum [expr {($sum &amp; 0xffff) + 1}]
      }
      <span class="comment-line"># puts [format %04x $sum]</span>
   }
   set sum [expr {$sum ^ 0xffff}]     
   return $sum
   
}

<strong><a name="::::ip2int_3418">proc <a href="spirent.tcl-annot.html#::::ip2int">::::ip2int</a></a></strong> {<a name="::ip(2)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a>} {
   foreach {a b c d} [split $ip .] {}
   set a1 [format %u [expr $a&lt;&lt;24]]
   return [expr {$a1 + ($b &lt;&lt; 16) + ($c &lt;&lt; 8) + $d}]
}

<strong><a name="::::int2ip_3424">proc <a href="spirent.tcl-annot.html#::::int2ip">::::int2ip</a></a></strong> {int} {
   if {[llength [split $int .]] == 1} {
      set x [format %08x $int]
      set oper 255
      for {set i 0} {$i &lt;= 6} {incr i 2} {
         set ip($i) [expr int(0x[string range $x $i [expr $i+1]])]
      }
      return $ip(0).$ip(2).$ip(4).$ip(6)
   }
   return $int
}

<strong><a name="::::cleanRoute_3436">proc <a href="spirent.tcl-annot.html#::::cleanRoute">::::cleanRoute</a></a></strong> { <a name="::ip(3)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> mask } {
   set temp [expr [<a name="::ip2int(6)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> $ip] &gt;&gt; (32-$mask)]
   return [<a name="::int2ip(7)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> [expr $temp &lt;&lt;  (32-$mask)]]
}

<strong><a name="::::getIpProtocol_3441">proc <a href="spirent.tcl-annot.html#::::getIpProtocol">::::getIpProtocol</a></a></strong> {name} {
   switch [string tolower $name] {
      &#34;tcp&#34;  { return 6 }
      &#34;udp&#34; { return 17 }
      &#34;ip&#34; { return 255 }
      &#34;icmp&#34; { return 1 }
      default {
         if {[string is integer $name]} {return $name} else {error &#34;Unrecognized IPv4 protocol $name&#34;}
      }
   }  
}
<strong><a name="::::getIpv6NextHeaderValue_3452">proc <a href="spirent.tcl-annot.html#::::getIpv6NextHeaderValue">::::getIpv6NextHeaderValue</a></a></strong> {name} {
   if {[string is integer $name]} {return $name}
   switch [string tolower $name] {
      &#34;tcp&#34;  { return 6 }
      &#34;udp&#34; { return 17 }
      &#34;ip&#34; { return 255 }
      &#34;icmp&#34; { return 1 }
      &#34;icmpv6&#34; { return 58 }
      &#34;igmp&#34; { return 2 }
      &#34;ipv6nonextheader&#34; { return 59 }
      &#34;ipv6hopbyhopoptions&#34; { return 0 }
      default {
         if {[string is integer $name]} {return $name} else {error &#34;Unrecognized IPv6 next header $name&#34;}
      }
   }  
}

<strong><a name="::::deleteAllStreams_3469">proc <a href="spirent.tcl-annot.html#::::deleteAllStreams">::::deleteAllStreams</a></a></strong> {portlist} {
   foreach port $portlist {
      set lsthStreamblocks [<a name="::logcmd(219)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $port -children-StreamBlock]
      foreach hStreamblock $lsthStreamblocks {
         <a name="::logcmd(220)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $hStreamblock
      }
   }
   <a name="::logcmd(221)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
}

<strong><a name="::::getPortSpeed_3479">proc <a href="spirent.tcl-annot.html#::::getPortSpeed">::::getPortSpeed</a></a></strong> {<a name="::port(3)"><a href="./spirent.tcl.html#::port_927">::port</a></a>} {
   global STCPORT
   <span class="comment-line">#set myPhy [logcmd stc::get $port -ActivePhy]</span>
   <span class="comment-line">#puts &#34;\n!!\n!!\n!!\nGot active phy $myPhy\n!!\n!!\n!!&#34;;</span>
   <span class="comment-line">#switch -regexp $myPhy {</span>
   <span class="comment-line">#    ethernet10gigcopper {</span>
   <span class="comment-line">#        set txSpeed [logcmd stc::get [logcmd stc::get $port -children-ethernet10gigcopper] -LineSpeedStatus]</span>
   <span class="comment-line">#    }</span>
   <span class="comment-line">#    ethernet10gigfiber {</span>
   <span class="comment-line">#        set txSpeed [logcmd stc::get [logcmd stc::get $port -children-ethernet10gigfiber] -LineSpeedStatus]</span>
   <span class="comment-line">#    }</span>
   <span class="comment-line">#    ethernetcopper {</span>
   <span class="comment-line">#        set txSpeed [logcmd stc::get [lindex [logcmd stc::get $port -children-ethernetcopper] 0] -LineSpeedStatus]</span>
   <span class="comment-line">#    }</span>
   <span class="comment-line">#    ethernetfiber {</span>
   <span class="comment-line">#        set txSpeed [logcmd stc::get [lindex [logcmd stc::get $port -children-ethernetfiber] 0] -LineSpeedStatus]</span>
   <span class="comment-line">#    }</span>
   <span class="comment-line">#    default {</span>
   <span class="comment-line">#        set txSpeed [logcmd stc::get [lindex [logcmd stc::get $port -children-ethernetcopper] 0] -LineSpeedStatus]</span>
   <span class="comment-line">#    }</span>
   <span class="comment-line">#}</span>
   <span class="comment-line">#set phyList [getPhyObject $port]</span>
   <span class="comment-line">#set pLen [llength $phyList]</span>
   <span class="comment-line">#set myPhy [lindex $phyList [expr $pLen - 1]]</span>
   <span class="comment-line">#set myPhy [lindex $phyList 0]</span>
   <span class="comment-line">#set txSpeed [string toupper [logcmd stc::get $myPhy -LineSpeedStatus]]</span>
   <span class="comment-line">#Port speed is identified at systemsetup</span>
   switch $STCPORT($port,speed) {
      SPEED_100G { set txSpeed 100000 }
      SPEED_50G { set txSpeed 50000 }
      SPEED_40G { set txSpeed 40000 }
      SPEED_25G { set txSpeed 25000 }
      SPEED_10G { set txSpeed 10000 }
      SPEED_5G { set txSpeed 5000 }
      SPEED_2500M { set txSpeed 2500 }
      SPEED_1G { set txSpeed 1000 }
      SPEED_10M { set txSpeed 10 }
      SPEED_100M { set txSpeed 100 }
      default  { error &#34;Port speed not supported \&#34;$txSpeed\&#34;&#34;}
   }
   return $txSpeed
}

<strong><a name="::::modifyIpAddrs_3522">proc <a href="spirent.tcl-annot.html#::::modifyIpAddrs">::::modifyIpAddrs</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;
   <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> modifyIpAddrs $args {
      <a name="::stream(1)"><a href="./spirent.tcl.html#::stream_1055">::stream</a></a> {}
      numFrames &#34;&#34;
      sIpAddr &#34;&#34;
      dIpAddr &#34;&#34;
      sIpMask &#34;255.255.255.0&#34;
      dIpMask &#34;255.255.255.0&#34;
      ipSaMode &#34;ipIdle&#34;
      ipDaMode &#34;ipIdle&#34;
      ipSaCount &#34;&#34;
      ipDaCount &#34;&#34;
   }

   set sbitems [<a name="::logcmd(222)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $stream -children]
   set ipobj [lindex $sbitems [lsearch $sbitems *ipv4*]]
   if {$sIpAddr == {}} {
      set sIpAddr [<a name="::logcmd(223)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ipobj -sourceAddr]
   }
   if {$dIpAddr == {}} {
      set dIpAddr [<a name="::logcmd(224)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ipobj -destAddr]
   }
   set disableContents 0
   if { $ipSaMode != &#34;ipIdle&#34; } {
      set disableContents 1
      switch -glob [string tolower $ipSaMode] {
         *inc* { set mode INCR }
         *dec* { set mode DECR }
         *rand* { set mode SHUFFLE }
         default { error &#34;Unsupported stream modifier ipSaMode = $ipSaMode&#34;}
      }
      if {$ipSaCount == {}} {set ipSaCount $numFrames}
      <span class="comment-line"># Use modifier to generate multiple streams.</span>
      <a name="::result_debug(48)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nCreating Modifier on Stream Block&#34;
      set hRangeModifer1 [<a name="::logcmd(225)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                             -under $stream \
                             -ModifierMode $mode \
                             -Mask 255.255.255.255 \
                             -StepValue 0.0.0.1 \
                             -Data $sIpAddr \
                             -RecycleCount $ipSaCount \
                             -RepeatCount 0 \
                             -DataType NATIVE \
                             -EnableStream false \
                             -OffsetReference &#34;sb1_ip.sourceAddr&#34;]
   }
   if {($ipDaMode != &#34;ipIdle&#34;)} {
      set disableContents 1
      switch -glob [string tolower $ipDaMode] {
         *inc* { set mode INCR }
         *dec* { set mode DECR }
         *rand* { set mode SHUFFLE }
         default { error &#34;Unsupported stream modifier ipDaMode = $ipDaMode&#34;}
      }
      if {$ipDaCount == {}} {set ipDaCount $numFrames}
      <span class="comment-line"># Use modifier to generate multiple streams.</span>
      <a name="::result_debug(49)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nCreating Modifier on Stream Block&#34;
      set hRangeModifer1 [<a name="::logcmd(226)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                             -under $stream \
                             -ModifierMode $mode \
                             -Mask 255.255.255.255 \
                             -StepValue 0.0.0.1 \
                             -Data $dIpAddr \
                             -RecycleCount $ipDaCount \
                             -RepeatCount 0 \
                             -DataType NATIVE \
                             -EnableStream false \
                             -OffsetReference &#34;sb1_ip.destAddr&#34;]
   }
   return $disableContents
}

<strong><a name="::::modifyMacAddrs_3595">proc <a href="spirent.tcl-annot.html#::::modifyMacAddrs">::::modifyMacAddrs</a></a></strong> {args} {

   <a name="::parse_args(8)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> ixiaConf_2Ports_arp $args {
      <a name="::stream(2)"><a href="./spirent.tcl.html#::stream_1055">::stream</a></a> {}
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      saCount &#34;&#34;
      daCount &#34;&#34;
      sMacAddr &#34;&#34;
      dMacAddr &#34;&#34;
      numFrames 1
   }
  
   set sbitems [<a name="::logcmd(227)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $stream -children]
   set ethobj [lindex $sbitems [lsearch $sbitems *ethernet*]]
   if {$sMacAddr == {}} {
      set sMacAddr [<a name="::logcmd(228)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ethobj -srcMac]
   }
   if {$dMacAddr == {}} {
      set dMacAddr [<a name="::logcmd(229)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ethobj -dstMac]
   }

   if {$saMode != &#34;idle&#34;} {
      switch -glob [string tolower $saMode] {
         *inc* { set mode INCR }
         *dec* { set mode DECR }
         *rand* { set mode SHUFFLE }
         default { error &#34;Unsupported stream modifier saMode = $saMode&#34;}
      }
      <span class="comment-line"># Use modifier to generate multiple streams.</span>
      if {$saCount == &#34;&#34;} {set saCount $numFrames}
      
      set hRangeModifier [<a name="::logcmd(230)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                             -under $stream \
                             -ModifierMode $mode \
                             -Mask &#34;00:00:FF:FF:FF:FF&#34; \
                             -StepValue &#34;00:00:00:00:00:01&#34; \
                             -Data [join $sMacAddr :] \
                             -RecycleCount $saCount \
                             -RepeatCount 0 \
                             -DataType NATIVE \
                             -EnableStream false \
                             -OffsetReference &#34;sb1_eth.srcMac&#34;]
   }
   
   if {$daMode != &#34;idle&#34;} {
      switch -glob [string tolower $daMode] {
         *inc* { set mode INCR }
         *dec* { set mode DECR }
         *rand* { set mode SHUFFLE }
         default { error &#34;Unsupported stream modifier saMode = $saMode&#34;}
      }
      <span class="comment-line"># Use modifier to generate multiple streams.</span>
      if {$daCount == &#34;&#34;} {set daCount $numFrames}
      set hRangeModifier [<a name="::logcmd(231)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                             -under $stream \
                             -ModifierMode INCR \
                             -Mask &#34;00:00:FF:FF:FF:FF&#34; \
                             -StepValue &#34;00:00:00:00:00:01&#34; \
                             -Data [join $dMacAddr :] \
                             -RecycleCount $daCount \
                             -RepeatCount 0 \
                             -DataType NATIVE \
                             -EnableStream false \
                             -OffsetReference &#34;sb1_eth.dstMac&#34;]
   }
}

<strong><a name="::::addVlans_3663">proc <a href="spirent.tcl-annot.html#::::addVlans">::::addVlans</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] $args&#34;
   <a name="::parse_args(9)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> addVlans $args {
      <a name="::stream(3)"><a href="./spirent.tcl.html#::stream_1055">::stream</a></a> {}
      ethobj {}
      wTag &#34;false&#34;
      tagNo &#34;002&#34;
      tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat &#34;1&#34;
      tagPriority &#34;1&#34;
      protocolTagId &#34;null&#34;
      protoOffsetEnable &#34;false&#34;
      userDefTag &#34;&#34;
   }
   
   set length 0
   regsub -all &#34; &#34; $userDefTag &#34;&#34; userDefTag
   if {[lindex $wTag 0] == &#34;true&#34; } {
      <span class="comment-line"># Add only ONE vlan here</span>
      <span class="comment-line"># Add a Vlan container object</span>
      set hVlanContainer [<a name="::logcmd(232)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ethobj -children-vlans]
      if {$hVlanContainer == {}} { set hVlanContainer [<a name="::logcmd(233)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create vlans -under $ethobj]}
      
      <span class="comment-line"># Add a Vlan header to the container object.  This is required </span>
      <span class="comment-line"># since there can be multiple VLANs </span>
      <span class="comment-line"># as in Q-in-Q.</span>
      if {$tagCfi == &#34;resetCFI&#34;} {set tagCfi 0} else {set tagCfi 1}
      if {$protocolTagId != &#34;null&#34;} {
<span class="comment-line">#         set vlanHeaderHandle [logcmd stc::create Vlan -under $hVlanContainer -pri [int2bits $tagPriority 3] \</span>
<span class="comment-line">#                                  -cfi $tagCfi -id [format %i 0x$tagNo] -type [expr $protocolTagId]]</span>
         set vlanHeaderHandle [<a name="::logcmd(234)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Vlan -under $hVlanContainer -pri [<a name="::int2bits(1)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> $tagPriority 3] \
                                  -cfi $tagCfi -id $tagNo -type [expr $protocolTagId]]
      } else {
<span class="comment-line">#         set vlanHeaderHandle [logcmd stc::create Vlan -under $hVlanContainer -pri [int2bits $tagPriority 3] \</span>
<span class="comment-line">#                                  -cfi $tagCfi -id [format %i 0x$tagNo]]</span>
         set vlanHeaderHandle [<a name="::logcmd(235)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Vlan -under $hVlanContainer -pri [<a name="::int2bits(2)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> $tagPriority 3] \
                                  -cfi $tagCfi -id $tagNo]
      }
      if {$tagMode != &#34;vIdle&#34;} {
         set hRangeModifier [<a name="::logcmd(236)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                -under $stream \
                                -ModifierMode INCR \
                                -StepValue &#34;1&#34; \
                                -Mask 0xFFFF \
                                -Data [format %i $tagNo] \
                                -RecycleCount $tagRepeat \
                                -DataType NATIVE \
                                -EnableStream false \
                                -OffsetReference &#34;[<a name="::logcmd(237)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ethobj -name].vlans.[<a name="::logcmd(238)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $vlanHeaderHandle -name].id&#34;]
      }
      incr length 4
   } elseif {$protoOffsetEnable == &#34;true&#34;} {
      <span class="comment-line"># Add one or more vlans here</span>
      <span class="comment-line"># Add a Vlan container object.</span>
      set hVlanContainer [<a name="::logcmd(239)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create vlans -under $ethobj]
      
      <span class="comment-line"># Add a Vlan header to the container object.  This is required </span>
      <span class="comment-line"># since there can be multiple VLANs </span>
      <span class="comment-line"># as in Q-in-Q. </span>
      set i 0
      set vlanInfoList [split $userDefTag &#34;&#34;]
      puts &#34;UDT $userDefTag&#34;
      set udtl [llength $vlanInfoList]
      set udtTop [expr $udtl - 3]
      for {set i 0} {$i &lt; $udtl} {incr i 8} {
         set vlanTagType [join [lrange $vlanInfoList $i [expr $i+3]] &#34;&#34;]
         puts &#34;vlanTagType $vlanTagType  vlanInfoList len = [llength $vlanInfoList]&#34;
         if {[expr $i+5] &lt;= $udtl} {
             puts &#34;vlanPrio = [string range [<a name="::int2bits(3)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> [expr 0x[join [lrange $vlanInfoList [expr $i+4] [expr $i+5]] &#34;&#34;]] 8] 0 2]&#34;
             set vlanPrio [string range [<a name="::int2bits(4)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> [expr 0x[join [lrange $vlanInfoList [expr $i+4] [expr $i+5]] &#34;&#34;]] 8] 0 2]
             puts &#34;cfi [string index [<a name="::int2bits(5)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> [expr 0x[join [lrange $vlanInfoList [expr $i+4] [expr $i+5]] &#34;&#34;]] 8] 3]&#34;
             set cfi [string index [<a name="::int2bits(6)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> [expr 0x[join [lrange $vlanInfoList [expr $i+4] [expr $i+5]] &#34;&#34;]] 8] 3]
         }
         if {[expr $i+7] &lt;= $udtl} {
             puts &#34;vlanid set vlanId [<a name="::bits2int(1)"><a href="./ePTQinQTx.tcl.html#::bits2int_334">::bits2int</a></a> &#34;[string range [<a name="::int2bits(7)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> [expr 0x[join [lrange $vlanInfoList [expr $i+4] [expr $i+5]] &#34;&#34;]] 8] 4 7][<a name="::int2bits(8)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> [expr 0x[join [lrange $vlanInfoList [expr $i+6] [expr $i+7]] &#34;&#34;]] 8]&#34;]&#34;
             set vlanId [<a name="::bits2int(2)"><a href="./ePTQinQTx.tcl.html#::bits2int_334">::bits2int</a></a> &#34;[string range [<a name="::int2bits(9)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> [expr 0x[join [lrange $vlanInfoList [expr $i+4] [expr $i+5]] &#34;&#34;]] 8] 4 7][<a name="::int2bits(10)"><a href="./spirent.tcl.html#::int2bits_3227">::int2bits</a></a> [expr 0x[join [lrange $vlanInfoList [expr $i+6] [expr $i+7]] &#34;&#34;]] 8]&#34;]
         }
         set vlanHeaderHandle [<a name="::logcmd(240)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Vlan -under $hVlanContainer -pri $vlanPrio -cfi $cfi -id $vlanId -type $vlanTagType]
         if {$tagMode != &#34;vIdle&#34;} {
            set hRangeModifier [<a name="::logcmd(241)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                   -under $stream \
                                   -ModifierMode INCR \
                                   -StepValue &#34;1&#34; \
                                   -Data $vlanId \
                                   -RecycleCount $tagRepeat \
                                   -DataType NATIVE \
                                   -EnableStream false \
                                   -OffsetReference &#34;[<a name="::logcmd(242)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ethobj -name].vlans.[<a name="::logcmd(243)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $vlanHeaderHandle -name].id&#34;]
         }
         incr length 4
      }
   } 
   return $length
}

<strong><a name="::::getPortList_3759">proc <a href="spirent.tcl-annot.html#::::getPortList">::::getPortList</a></a></strong> {} {
   global ahSpirentPort
   set portlist {}
   foreach {item value} [array get ahSpirentPort] {lappend portlist $value}
   return $portlist
}

<strong><a name="::::adjustStcPacketSize_3766">proc <a href="spirent.tcl-annot.html#::::adjustStcPacketSize">::::adjustStcPacketSize</a></a></strong> {len offset} {
   if {[set i [expr $len - $offset]] &lt; 4} {
      return [expr $offset + 4]
   }
   return $len
}

<strong><a name="::::makeRipHeader_3773">proc <a href="spirent.tcl-annot.html#::::makeRipHeader">::::makeRipHeader</a></a></strong> {args} {

   <a name="::parse_args(10)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> makeRipHeader $args {
      ripCommand &#34;ripRequest&#34;
      ripVersion &#34;2&#34;
      ripAuthen &#34;&#34;
      ripAuthenType &#34;2&#34;
      ripNumRoute &#34;1&#34;
      ripRouteFamilyId {2}
      ripRouteIp {0.0.0.0}
      ripRouteTag {00}
      ripRouteMask {0.0.0.0} 
      ripRouteNextHop {0.0.0.0}
      ripRouteMetric {16}
      destPort 520
      sourcePort 520
      checksum 0
      length 0
   }

   <span class="comment-line"># handle errors in test case</span>


   set hexstring {}

   <span class="comment-line"># make UDP</span>
   append hexstring [format %04x $sourcePort]
   append hexstring [format %04x $destPort]
   append hexstring [format %04x [expr 8+4+($ripNumRoute*20)]]
   append hexstring 0000
   
   switch $ripCommand {
      ripRequest { append hexstring 01 }
      ripResponse { append hexstring 02 }
      default { append hexstring [format %02x $ripCommand]}
   }
   append hexstring [format %02x $ripVersion]
   append hexstring 0000
   for {set index 0} {$index &lt; $ripNumRoute } {incr index} {

      <span class="comment-line"># handle error in test case</span>
      set tag 0x[lindex $ripRouteTag $index] ; if {![string is integer $tag]} {set tag 0}
      set nhop [lindex $ripRouteNextHop $index] ; if {[llength [split $nhop .]] != 4} {set nhop 0.0.0.0}
      
      append hexstring [format %04x [lindex $ripRouteFamilyId $index]]
      append hexstring [format %04x $tag]
      append hexstring [format %08x [<a name="::ip2int(7)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> [lindex $ripRouteIp $index]]]
      append hexstring [format %08x [<a name="::ip2int(8)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> [lindex $ripRouteMask $index]]]
      append hexstring [format %08x [<a name="::ip2int(9)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> $nhop]]
      append hexstring [format %08x [lindex $ripRouteMetric $index]]
   }
   append hexstring 0000
   return $hexstring
}


<strong><a name="::::modifyOtherIPFields_3829">proc <a href="spirent.tcl-annot.html#::::modifyOtherIPFields">::::modifyOtherIPFields</a></a></strong> {sb ipobject initvalue offset bitcount count} {
   set bitlen [string range $bitcount 1 end]
   set origbitlen $bitlen
   set initvalue [join $initvalue {}]
   set mask [<a name="::makeMask(3)"><a href="./spirent.tcl.html#::makeMask_3290">::makeMask</a></a> [<a name="::getCounterByteLen(4)"><a href="./spirent.tcl.html#::getCounterByteLen_3302">::getCounterByteLen</a></a> $bitlen]]
   while {$bitlen &gt; 0} {
      switch $offset {
         -20 {
            <span class="comment-line"># Version</span>
            set val 0x[string range $initvalue 0 0]
            set fieldcount [expr $count &gt;&gt; ($bitlen-4)]
            if {[string length [string range $mask 1 end]] &gt; 0} {set repeatcount 0x[string range $mask 1 end]} else {set repeatcount 0}
            if {$fieldcount == 0} {
               <span class="comment-line"># no incrementing</span>
               <a name="::logcmd(244)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $ipobject -version $val
            } else {
               <span class="comment-line">#increment the version field</span>
               set hRangeModifer1 [<a name="::logcmd(245)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                      -under $sb \
                                      -ModifierMode INCR \
                                      -Mask 0xF \
                                      -StepValue 1 \
                                      -Data $val \
                                      -RecycleCount $fieldcount \
                                      -RepeatCount $repeatcount \
                                      -DataType NATIVE \
                                      -EnableStream false \
                                      -OffsetReference &#34;[stc::get $ipobject -name].version&#34;]
            }
            
            <span class="comment-line"># IHL</span>
            set val 0x[string range $initvalue 1 1]
            set fieldcount [expr $count &gt;&gt; ($bitlen-8)]
            if {[string length [string range $mask 2 end]] &gt; 0} {set repeatcount 0x[string range $mask 2 end]} else {set repeatcount 0}
            if {$fieldcount == 0} {
               <span class="comment-line"># no incrementing</span>
               <a name="::logcmd(246)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $ipobject -ihl $val
            } else {
               set hRangeModifer1 [<a name="::logcmd(247)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                      -under $sb \
                                      -ModifierMode INCR \
                                      -Mask 0xF \
                                      -StepValue 1 \
                                      -Data $val \
                                      -RecycleCount $fieldcount \
                                      -RepeatCount $repeatcount \
                                      -DataType NATIVE \
                                      -EnableStream false \
                                      -OffsetReference &#34;[stc::get $ipobject -name].ihl&#34;]
            }
            set offset -19
            set initvalue [string range $initvalue 2 end]
            set mask [string range $mask 2 end]
            incr bitlen -8
         }
         -19 {
            <span class="comment-line"># TOS</span>
            set val 0x[string range $initvalue 0 1]
            set fieldcount [expr $count &gt;&gt; ($bitlen-8)]
            if {[string length [string range $mask 2 end]] &gt; 0} {set repeatcount 0x[string range $mask 2 end]} else {set repeatcount 0}
            if {$fieldcount == 0} {
               <span class="comment-line"># no incrementing</span>
               <a name="::logcmd(248)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $ipobject -ihl $val
            } else {
               set hRangeModifer1 [<a name="::logcmd(249)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                      -under $sb \
                                      -ModifierMode INCR \
                                      -Mask 0xFF \
                                      -StepValue 1 \
                                      -Data $val \
                                      -RecycleCount $fieldcount \
                                      -RepeatCount $repeatcount \
                                      -DataType NATIVE \
                                      -EnableStream false \
                                      -OffsetReference &#34;[stc::get $ipobject -name].tosDiffserv.tos&#34;]
            }
            set offset -18
            set initvalue [string range $initvalue 2 end]
            set mask [string range $mask 2 end]
            incr bitlen -8   
         }
         -18 {
            <span class="comment-line"># Total Length</span>
            <span class="comment-line"># handle incr only first byte</span>
            switch $bitlen {
               8  {set val 0x[string range $initvalue 0 end]00; set fieldcount [expr $count &amp;&amp; 0xff]; set step 0x0100}
               default {set val 0x[string range $initvalue 0 3]; set fieldcount [expr $count &gt;&gt; ($bitlen-16)] ; set step 1}
            }
            if {[string length [string range $mask 4 end]] &gt; 0} {set repeatcount 0x[string range $mask 4 end]} else {set repeatcount 0}
            if {$fieldcount == 0} {
               <span class="comment-line"># no incrementing</span>
               <a name="::logcmd(250)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $ipobject -ihl $val
            } else {
               set hRangeModifer1 [<a name="::logcmd(251)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                      -under $sb \
                                      -ModifierMode INCR \
                                      -Mask 0xFFFF \
                                      -StepValue $step \
                                      -Data $val \
                                      -RecycleCount $fieldcount \
                                      -RepeatCount $repeatcount \
                                      -DataType NATIVE \
                                      -EnableStream false \
                                      -OffsetReference &#34;[stc::get $ipobject -name].totalLength&#34;]
            }
            set offset -16
            set initvalue [string range $initvalue 4 end]
            set mask [string range $mask 4 end]
            incr bitlen -16   
         }
         -14 {
            <span class="comment-line"># Fragment offset</span>
            set fieldcount [expr $count &amp;&amp; 0x1FFF ]
            set val 0x$initvalue
             if {$fieldcount == 0} {
               <span class="comment-line"># no incrementing</span>
               <a name="::logcmd(252)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $ipobject -fragOffset $val
            } else {
               set hRangeModifer1 [<a name="::logcmd(253)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                      -under $sb \
                                      -ModifierMode INCR \
                                      -Mask 0x1FFF \
                                      -StepValue 1 \
                                      -Data $val \
                                      -RecycleCount $fieldcount \
                                      -RepeatCount 0 \
                                      -DataType NATIVE \
                                      -EnableStream false \
                                      -OffsetReference &#34;[stc::get $ipobject -name].fragOffset&#34;]
            }
            incr bitlen -16              
         }
         default {error &#34;Unsupported offset into IP field $offset&#34;}
      }
   }
}

<strong><a name="::::insertUdfInHeader_3966">proc <a href="spirent.tcl-annot.html#::::insertUdfInHeader">::::insertUdfInHeader</a></a></strong> { hStreamBlock headerstring udfInitval udfOffset udfCountertype } {
   set udfInitval [join $udfInitval {}]
   set countersize [string range $udfCountertype 1 end]
   foreach {hdr offset} $headerstring {
      puts &#34;$hdr $offset&#34;
      if {$udfOffset &lt; $offset} {
         set loc [expr $offset - $udfOffset]
         puts &#34;The LOC : $loc&#34;
         switch -glob $hdr {
            ???_llc  {
               set iloc 0
               for {set i $countersize} {$i &gt; 0} {incr i -8} { 
                  lappend off_rep_val $loc [expr (1 &lt;&lt; ($i -8)) -1] [string range $udfInitval $iloc [expr $iloc+1]]
                  incr iloc 2 ; incr loc -1
               }
               puts $off_rep_val
               array set llcfield [list 3 dsap 2 ssap 1 control]
               foreach {off rep val} $off_rep_val {
                  if {[info exist llcfield($off)]} {
                     set hRangeModifer1 [<a name="::logcmd(254)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                            -under $hStreamBlock \
                                            -ModifierMode INCR \
                                            -Mask ff \
                                            -StepValue 1 \
                                            -Data $val \
                                            -RecycleCount 0 \
                                            -RepeatCount $rep \
                                            -DataType NATIVE \
                                            -EnableStream false \
                                            -OffsetReference &#34;sb1_eth.llcheader.$llcfield($off)&#34;]                  
                  } else {
                     puts &#34;WARNING, UDF offset went beyond end of LLC&#34;
                  }
               }
            }
            ???_snap {
               switch $loc {
                  2 {
                     set hRangeModifer1 [<a name="::logcmd(255)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                            -under $hStreamBlock \
                                            -ModifierMode INCR \
                                            -Mask ffff \
                                            -StepValue 1 \
                                            -Data $udfInitval \
                                            -RecycleCount 0 \
                                            -RepeatCount 0 \
                                            -DataType NATIVE \
                                            -EnableStream false \
                                            -OffsetReference &#34;sb1_eth.snapheader.EthernetType&#34;]                  
                    

                  }
               }
            }
            default { error &#34;No Match $hdr&#34; }
         }
      } 
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: icetMakeExternalPeer</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:  Setup an external BGP peer on the ixia protocol</span>
<span class="comment-line">#               server. Internal proc not exposed out of lib.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      set returnCode [icetMakeExternalPeer -myIp $myIp -dutIp $dutIp -asNumber $asNum \</span>
<span class="comment-line">#          -ipNetworkList $ipNetworkListValue \</span>
<span class="comment-line">#          -fromPrefixList $fromPrefixListValue -thruPrefixList $thruPrefixListValue -numRoutesList $numRoutesListValue \</span>
<span class="comment-line">#          -txPortId $txPortId -communityList $communityListValue -clusterList $clusterListValue -asTypeList $asTypeListValue \</span>
<span class="comment-line">#          -medList $medListValue -asPathList $asPathListValue -originProtocolList $originProtocolListValue \</span>
<span class="comment-line">#          -localPrefList $localPrefListValue \</span>
<span class="comment-line">#          -routeFlapDropTimeList $routeFlapDropTimeListValue \</span>
<span class="comment-line">#          -routeFlapTimeList $routeFlapTimeListValue -routesToFlapFromList $routesToFlapFromListValue \</span>
<span class="comment-line">#          -routesToFlapToList $routesToFlapToListValue -linkFlapDropTime $linkFlapDropTimeValue \</span>
<span class="comment-line">#          -linkFlapTime $linkFlapTimeValue]</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::icetMakeExternalPeer_4053">proc <a href="spirent.tcl-annot.html#::::icetMakeExternalPeer">::::icetMakeExternalPeer</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;
   <a name="::parse_args(11)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> icetMakeExternalPeer $args {
      deviceHndl &#34;&#34;
      dutIp &#34;1.1.1.1&#34;
      dutAsNumber 1
      myIp &#34;1.1.1.2&#34;
      asNumber &#34;9999&#34;
      ipNetworkList &#34;&#34;
      fromPrefixList &#34;&#34;
      thruPrefixList &#34;&#34;
      localPrefList &#34;&#34;
      numRoutesList &#34;&#34;
      originProtocolList &#34;&#34;
      txPortId  &#34;1&#34;
      communityList &#34;&#34;
      expcomList &#34;&#34;
      clusterList &#34;&#34;
      asTypeList &#34;&#34;
      mode &#34;&#34;
      asPathList &#34;&#34;
      medList &#34;&#34;
      atomicaggregateList &#34;&#34;
      routeFlapDropTimeList &#34;&#34;
      routeFlapTimeList &#34;&#34;
      routesToFlapFromList &#34;&#34;
      routesToFlapToList &#34;&#34;
      linkFlapDropTime &#34;&#34;
      linkFlapTime &#34;&#34;
      extendedcommunity &#34;false&#34;
      extendedcommunityList &#34;&#34;
      graceRestart &#34;&#34;
      graResTime &#34;&#34;
      graStaleTime &#34;&#34;
      4byteAs &#34;false&#34;
      neighborType &#34;external&#34;
      nextHopList &#34;&#34;
      originatorId &#34;&#34;
   }
   
   <a name="::result_debug(50)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;myIp=($myIp) dutIp=($dutIp)&#34;
   
   set index [llength $ipNetworkList]
   <a name="::result_debug(51)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;index = $index&#34;;
   if {[llength $fromPrefixList]!=$index || [llength $thruPrefixList]!=$index || [llength $numRoutesList]!=$index} {
      <a name="::result_debug(52)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in input args:fromPrefixList,thruPrefixList,numRoutesList,ipNetworkList should be same length&#34;
      return -1
   }
<span class="comment-line"># !!!!! no setting for ext/int (maybe inherits from route adv)</span>
<span class="comment-line">#   bgp4Neighbor config  -type  bgp4NeighborExternal</span>
<span class="comment-line">#   bgp4Neighbor config  -enable true</span>
   append bgpAttributes &#34; -BgpSessionIpAddress INTERFACE_IP&#34;
<span class="comment-line">#   bgp4Neighbor config -localIpAddress $myIp</span>
<span class="comment-line">#   bgp4Neighbor config -rangeCount 1</span>
   append bgpAttributes &#34; -DutIpv4Addr $dutIp&#34;
<span class="comment-line">#   bgp4Neighbor config -dutIpAddress $dutIp</span>
   if {![regexp -nocase &#34;false&#34; $4byteAs]} {

      append bgpAttributes &#34; -Enable4ByteAsNum true -AsNum4Byte $asNumber -asNum 23456 -dutasNum 23456 -DutAsNum4Byte $dutAsNumber&#34;
<span class="comment-line">#      catch [bgp4Neighbor config -enable4ByteAsNumber $4byteAs] resultCatch  </span>
<span class="comment-line">#      if  [regexp &#34;type.*enable&#34; $resultCatch] {</span>
<span class="comment-line">#         return -1</span>
<span class="comment-line">#      }</span>
   } else {
      append bgpAttributes &#34; -AsNum $asNumber -DutAsNum $dutAsNumber&#34;
<span class="comment-line">#      bgp4Neighbor config -localAsNumber $asNumber</span>
   }
   <span class="comment-line"># add link flap</span>
   if {$linkFlapDropTime!=&#34;&#34;} {
      puts &#34;NEED to add Link Flapping&#34;
<span class="comment-line">#      bgp4Neighbor config -enableLinkFlap true</span>
<span class="comment-line">#      bgp4Neighbor config -linkFlapDropTime $linkFlapDropTime</span>
<span class="comment-line">#      bgp4Neighbor config -linkFlapTime $linkFlapTime</span>
   } else {
<span class="comment-line">#      bgp4Neighbor config -enableLinkFlap false</span>
   }
   if {$graceRestart !=&#34;&#34;} {
      append bgpAttributes &#34; -GracefulRestart true -RestartDelay $graStaleTime -RestartTime $graResTime&#34;
<span class="comment-line">#      bgp4Neighbor config -enableGracefulRestart  true</span>
<span class="comment-line">#      bgp4Neighbor config -restartTime $graResTime</span>
<span class="comment-line">#      bgp4Neighbor config -staleTime   $graStaleTime</span>
   }
   set bgpRouterConfigHndl [eval &#34;logcmd stc::create BgpRouterConfig -under $deviceHndl [subst $bgpAttributes]&#34;] 
   for {set i 0} {$i&lt;$index} {incr i} {
      set ipNetwork [lindex $ipNetworkList $i]
      set fromPrefix [lindex $fromPrefixList $i]
      set thruPrefix [lindex $thruPrefixList $i]
      set numRoutes [lindex $numRoutesList $i]
      set nextHop [lindex $nextHopList $i]
      set origId [lindex $originatorId $i]
      <span class="comment-line">#set ecom [lindex $extendedcommunity $i]</span>
      set ecom $extendedcommunity
      if {[regexp -nocase $ecom &#34;true&#34;]} {
         set extcom [lindex $extendedcommunityList $i]
      } else {
         set extcom &#34;&#34;
      }
      <a name="::result_debug(53)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ipNetwork $ipNetwork&#34;
      <a name="::result_debug(54)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;fromPrefix $fromPrefix&#34;
      <a name="::result_debug(55)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;thruPrefix $thruPrefix&#34;
      <a name="::result_debug(56)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numRoutes $numRoutes&#34;
      <a name="::result_debug(57)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ecom $ecom&#34;
      <a name="::result_debug(58)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;extcom $extcom&#34;
      

<span class="comment-line">#      bgp4RouteItem config -networkAddress $ipNetwork</span>
<span class="comment-line">#      bgp4RouteItem config -fromPrefix $fromPrefix</span>
<span class="comment-line">#      bgp4RouteItem config -thruPrefix $thruPrefix</span>
<span class="comment-line">#      bgp4RouteItem config -numRoutes $numRoutes</span>
      if {[llength $localPrefList]!=0} {
         set localPref [lindex $localPrefList $i]
         if {$localPref!=&#34;&#34; || $neighborType == &#34;internal&#34;} {
            if {$localPref == &#34;&#34;} {set localPref 1}
            <a name="::result_debug(59)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;localPref $localPref&#34;
<span class="comment-line">#!!!!  no option i can find to enable</span>
<span class="comment-line">#            bgp4RouteItem config -enableLocalPref 1</span>
<span class="comment-line">#            bgp4RouteItem config -localPref $localPref</span>
            append ipv4RouteAttrs &#34; -LocalPreference $localPref&#34;						
         }
      }
      
      <span class="comment-line">#---newely added for mode</span>
      
      if {$mode != &#34;&#34;} {
         set modeType [lindex $mode $i]
         if {$modeType == {}} {set modeType [lindex $mode 0]}
         <a name="::result_debug(60)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;modeType $modeType&#34;
         append ipv4RouteAttrs &#34; -RouteSubAfi $modeType&#34;						
<span class="comment-line">#          if {$modeType == &#34;unicast&#34;} {</span>
<span class="comment-line">#             bgp4RouteItem config -enableIncludeMulticast false</span>
<span class="comment-line">#             bgp4RouteItem config -enableProperSafi false</span>
<span class="comment-line">#             bgp4RouteItem config -enableTraditionalNlriUpdate true</span>
<span class="comment-line">#          } else {</span>
<span class="comment-line">#             bgp4RouteItem config -enableIncludeMulticast true</span>
<span class="comment-line">#             bgp4RouteItem config -enableProperSafi true</span>
<span class="comment-line">#             bgp4RouteItem config -enableTraditionalNlriUpdate false</span>
<span class="comment-line">#          }</span>
      }
      
      if {$nextHop!=&#34;&#34;} {
         <a name="::result_debug(61)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the nexthop $nextHop&#34;
         append ipv4RouteAttrs &#34; -NextHop $nextHop&#34;						
<span class="comment-line">#           bgp4RouteItem config -nextHopIpAddress $nextHop</span>
<span class="comment-line">#           bgp4RouteItem config -nextHopMode 1</span>
<span class="comment-line">#           bgp4RouteItem config -nextHopSetMode bgpRouteNextHopSetManually</span>
      } else {
         append ipv4RouteAttrs &#34; -NextHop $myIp&#34;						
<span class="comment-line">#          bgp4RouteItem config -nextHopIpAddress $myIp</span>
      }
<span class="comment-line">#       bgp4RouteItem config -enableNextHop 1</span>
<span class="comment-line">#       bgp4RouteItem config -nextHopIpAddress $myIp</span>
      if {$origId !=&#34;&#34;} {
         append ipv4RouteAttrs &#34; -OriginatorId $origId&#34;						
<span class="comment-line">#          bgp4RouteItem config -enableOriginatorId true</span>
<span class="comment-line">#          bgp4RouteItem config -originatorId $origId</span>
      } else {
         append ipv4RouteAttrs &#34; -origin EGP&#34;
      }
<span class="comment-line">#!!!! not sure what this is</span>
<span class="comment-line">#      append ipv4RouteAttrs &#34; -OriginatorId [lindex $originProtocolList $i]&#34;</span>
      
<span class="comment-line">#      bgp4RouteItem config -originProtocol [lindex $originProtocolList $i]</span>
<span class="comment-line">#      bgp4RouteItem config -enableRouteRange true</span>
      if {[llength $communityList] != 0} {
         <span class="comment-line"># --- 65535:65281 = NO_EXPORT</span>
         set community1 [lindex $communityList $i]
         if {[llength $expcomList] != 0} {
            set expcom [lindex $expcomList $i]
         } else {
            set expcom &#34;null&#34;
         }
         
         if {($community1 != &#34;null&#34;) &amp;&amp; ($expcom == &#34;null&#34;)} {
            <a name="::result_debug(62)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;community1 $asNumber$community1&#34;
            set coms {}
            foreach com $community1 {lappend coms [<a name="::formatBgpCommunity(1)"><a href="./spirent.tcl.html#::formatBgpCommunity_5597">::formatBgpCommunity</a></a> $community1]}
            set coms [join $coms ,]
           <span class="comment-line">#  append ipv4RouteAttrs &#34; -Community $asNumber:$community1&#34;						</span>
            append ipv4RouteAttrs &#34; -Community $coms&#34;						
<span class="comment-line">#            bgp4RouteItem config -enableCommunity  1</span>
<span class="comment-line">#            bgp4RouteItem config -communityList $community1</span>
         } elseif {($community1 != &#34;null&#34;) &amp;&amp; ($expcom != &#34;null&#34;) } {
            <a name="::result_debug(63)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;community1 $community1&#34;
            <a name="::result_debug(64)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;expcom $expcom&#34;
            <span class="comment-line">#expcom = 1 (NO_EXPORT)</span>
            <span class="comment-line">#expcom = 2 (NO_ADVERTISE)</span>
            <span class="comment-line">#expcom = 3 (NO_EXPORT_SUBCONFED)</span>
            if {$expcom ==1} {
<span class="comment-line">#               bgp4RouteItem config -enableCommunity  1</span>
               append ipv4RouteAttrs &#34; -Community {[<a name="::formatBgpCommunity(2)"><a href="./spirent.tcl.html#::formatBgpCommunity_5597">::formatBgpCommunity</a></a> $community1],65535:65281}&#34;
<span class="comment-line">#               bgp4RouteItem config -communityList &#34;$community1 65535:65281&#34;</span>
            } elseif {$expcom ==2} {
<span class="comment-line">#               bgp4RouteItem config -enableCommunity  1</span>
               append ipv4RouteAttrs &#34; -Community {[<a name="::formatBgpCommunity(3)"><a href="./spirent.tcl.html#::formatBgpCommunity_5597">::formatBgpCommunity</a></a> $community1],65535:65282}&#34;
<span class="comment-line">#               bgp4RouteItem config -communityList &#34;$community1 65535:65282&#34;</span>
            } else {
<span class="comment-line">#               bgp4RouteItem config -enableCommunity  1</span>
               append ipv4RouteAttrs &#34; -Community {[<a name="::formatBgpCommunity(4)"><a href="./spirent.tcl.html#::formatBgpCommunity_5597">::formatBgpCommunity</a></a> $community1],65535:65283}&#34;
<span class="comment-line">#               bgp4RouteItem config -communityList &#34;$community1 65535:65283&#34;</span>
            }
         }
      }
      if {[llength $clusterList] != 0} {
         set cluster1 [lindex $clusterList $i]
         if {$cluster1 != &#34;null&#34;} {
            <a name="::result_debug(65)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cluster1 $cluster1&#34;
<span class="comment-line">#            bgp4RouteItem config -enableCluster 1</span>
<span class="comment-line">#            bgp4RouteItem config -clusterList $cluster1</span>
            append ipv4RouteAttrs &#34; -clusterIdList [<a name="::int2ip(8)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> $cluster1]&#34;
         }
      }
<span class="comment-line">#      bgp4RouteItem config -enableASPath  1</span>
<span class="comment-line">#      bgp4AsPathItem setDefault</span>
      if {[llength $asPathList]!=0} {
         set aslist [lindex $asPathList $i]
         set asSegmentTypes [lindex $asTypeList $i]
         if {$aslist!=&#34;&#34;} {
            append ipv4RouteAttrs &#34; -AsPathSegmentType {$asSegmentTypes}&#34;
            append ipv4RouteAttrs &#34; -AsPath {$aslist}&#34;
<span class="comment-line">#             set indice 0</span>
<span class="comment-line"># #            bgp4RouteItem clearASPathList</span>
<span class="comment-line">#             foreach asType $asSegmentTypes {</span>
<span class="comment-line">#                bgp4AsPathItem config -enableAsSegment true</span>
<span class="comment-line">#                bgp4AsPathItem config -asSegmentType $asType</span>
<span class="comment-line">#                if {[llength $asSegmentTypes]&gt;1} {</span>
<span class="comment-line">#                   bgp4AsPathItem config -asList [lindex $aslist $indice]</span>
<span class="comment-line">#                } else {</span>
<span class="comment-line">#                   bgp4AsPathItem config -asList $aslist</span>
<span class="comment-line">#                }</span>
<span class="comment-line">#                incr indice</span>
<span class="comment-line">#                if {[bgp4RouteItem addASPathItem]} {</span>
<span class="comment-line">#                   result_debug &#34;Error Adding AS_PATH item&#34;</span>
<span class="comment-line">#                }</span>
<span class="comment-line">#             }</span>
         } else {
            append ipv4RouteAttrs &#34; -AsPath [concat $aslist 257 ]&#34;
<span class="comment-line">#             bgp4AsPathItem config -enableAsSegment false</span>
<span class="comment-line">#             bgp4AsPathItem config -asPathSeqList [list $asNumber 257 ]</span>
<span class="comment-line">#             bgp4RouteItem clearASPathList    ;# for ixia 3.5 version and above</span>
         }
      } else {
         append ipv4RouteAttrs &#34; -AsPath $asNumber&#34;
<span class="comment-line">#         bgp4AsPathItem config -enableAsSegment false</span>
<span class="comment-line">#         bgp4RouteItem clearASPathList    ;# for ixia 3.5 version and above</span>
      }
      if {[llength $medList]!=0} {
         set med [lindex $medList $i]
         if {$med!=&#34;&#34;} {
            <a name="::result_debug(66)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;med $med&#34;
            append ipv4RouteAttrs &#34; -Med $med&#34;
<span class="comment-line">#             bgp4RouteItem config -enableMED 1</span>
<span class="comment-line">#             bgp4RouteItem config -med $med</span>
         }
      }
      <span class="comment-line"># add ATomic aggregate</span>
      if {[llength $atomicaggregateList]!=0} {
         set aggregate [lindex $atomicaggregateList $i]
         if {$aggregate == 1} {
<span class="comment-line">#            bgp4RouteItem config -enableAtomicAggregate true</span>
            append ipv4RouteAttrs &#34; -AtomicAggregatePresent true&#34;
         } else {
<span class="comment-line">#            bgp4RouteItem config -enableAtomicAggregate false</span>
            append ipv4RouteAttrs &#34; -AtomicAggregatePresent false&#34;
         }
      }
      <span class="comment-line"># add route flap</span>
      set routeFlapDropTime [lindex $routeFlapDropTimeList $i]
      if {($routeFlapDropTime!=&#34;&#34;) &amp;&amp; ($routeFlapDropTime!=&#34;null&#34;)} {
         <a name="::result_debug(67)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;-Do route Flap&#34;
         set routeFlapTime [lindex $routeFlapTimeList $i]
         set routesToFlapFrom [lindex $routesToFlapFromList $i]
         set routesToFlapTo [lindex $routesToFlapToList $i]
         puts &#34;NEED to add route Flapping here&#34;
<span class="comment-line">#          bgp4RouteItem config -enableRouteFlap 1</span>
<span class="comment-line">#          bgp4RouteItem config -routeFlapDropTime $routeFlapDropTime</span>
<span class="comment-line">#          bgp4RouteItem config -routeFlapTime $routeFlapTime</span>
<span class="comment-line">#          bgp4RouteItem config -routesToFlapFrom $routesToFlapFrom</span>
<span class="comment-line">#          bgp4RouteItem config -routesToFlapTo $routesToFlapTo</span>
      } else {
<span class="comment-line">#         bgp4RouteItem config -enableRouteFlap 0</span>
      }
<span class="comment-line">#       set rr [expr $i +1]</span>
<span class="comment-line">#       if {[bgp4Neighbor addRouteRange routeRange$rr]} {</span>
<span class="comment-line">#          result_debug &#34;Error Adding Route item&#34;</span>
<span class="comment-line">#       }</span>

      <span class="comment-line">#---newely added for extended community</span>
<span class="comment-line">#       set param &#34;&#34;</span>
<span class="comment-line">#       set valueLst &#34;&#34;</span>
<span class="comment-line">#       set extcommunity &#34;&#34;</span>
<span class="comment-line">#       set ipv4RouteAttrs {}</span>
      if {($ecom == &#34;true&#34;) &amp;&amp; ($extcom != &#34;null&#34;)} {
         <span class="comment-line"># clear routes from device not needed because device is new</span>
         set ex {}
         foreach extcommunity $extcom {

            set param    [split $extcommunity :]
            set subType  [string toupper [lindex $param 0]]
            set value    [join [lrange $param 1 end] :]
            

<span class="comment-line">#             set param &#34;&#34;</span>
<span class="comment-line">#             set valueLst &#34;&#34;</span>
<span class="comment-line">#             set param [split $extcommunity :]</span>
<span class="comment-line">#             if {[lindex $param 0] == &#34;rt&#34;} {</span>
<span class="comment-line">#                bgp4ExtendedCommunity config -subType 2</span>
<span class="comment-line">#             } else {</span>
<span class="comment-line">#                bgp4ExtendedCommunity config -subType 3</span>
<span class="comment-line">#             }</span>
             if {[regexp {[0-9]+\.} [lindex $param 1]]} {
                set type 0x01
<span class="comment-line">#                 bgp4ExtendedCommunity config -type 1</span>
<span class="comment-line">#                 set ipLst [split [lindex $param 1] &#34;.&#34;]</span>
<span class="comment-line">#                 foreach ip $ipLst {</span>
<span class="comment-line">#                    set value1 [dectohex $ip]</span>
<span class="comment-line">#                    if {[string length $value1] == 1} {</span>
<span class="comment-line">#                       lappend valueLst &#34;0$value1&#34;</span>
<span class="comment-line">#                    } elseif {[string length $value1] == 2} {</span>
<span class="comment-line">#                       lappend valueLst &#34;$value1&#34;</span>
<span class="comment-line">#                    }</span>
<span class="comment-line">#                 }</span>
<span class="comment-line">#                 set value2 [dectohex [lindex $param 2]]</span>
<span class="comment-line">#                 lappend valueLst [conVal2Byte 2 $value2]</span>
             } else {
                regexp {[0-9]+} [lindex $param 1] val
                set value1 [<a name="::dectohex(1)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> $val]
                set value2 [<a name="::dectohex(2)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> [lindex $param 2]]
                if [regexp -nocase &#34;L&#34; [lindex $param 1]] {
                   set type 0x02
<span class="comment-line">#                    bgp4ExtendedCommunity config -type 2</span>
<span class="comment-line">#                    lappend valueLst [conVal2Byte 4 $value1]</span>
<span class="comment-line">#                    lappend valueLst [conVal2Byte 2 $value2]</span>
                } else {
                   set type 0x00
<span class="comment-line">#                    bgp4ExtendedCommunity config -type 0</span>
<span class="comment-line">#                    lappend valueLst [conVal2Byte 2 $value1]</span>
<span class="comment-line">#                    lappend valueLst [conVal2Byte 4 $value2]</span>
                }
             }
            
            lappend ex $type:$subType:$value
         }
         append ipv4RouteAttrs &#34; -ExtendedCommunity {[join $ex ,]}&#34;
      }

      set hBgpIpv4Route [eval &#34;logcmd stc::create BgpIpv4RouteConfig  -under $bgpRouterConfigHndl \
                               [subst $ipv4RouteAttrs]&#34;]

      <a name="::logcmd(256)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(257)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hBgpIpv4Route -children-Ipv4NetworkBlock] \
         -NetworkCount $numRoutes -StartIpList $ipNetwork -PrefixLength $fromPrefix
   }
   <a name="::logcmd(258)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
   return 0
}

<strong><a name="::::icetMakeInternalPeer_4408">proc <a href="spirent.tcl-annot.html#::::icetMakeInternalPeer">::::icetMakeInternalPeer</a></a></strong> {args} {
   append args &#34; -neighborType internal&#34;
   return [eval icetMakeExternalPeer $args]
}


<strong><a name="::::icetMakeInternalPeerx_4414">proc <a href="spirent.tcl-annot.html#::::icetMakeInternalPeerx">::::icetMakeInternalPeerx</a></a></strong> {args} {
   <a name="::parse_args(12)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> icetMakeInternalPeer $args {
     myIp &#34;1.1.1.2&#34;
     dutIp &#34;1.1.1.1&#34;
     asNumber &#34;9999&#34;
     ipNetworkList &#34;&#34;
     fromPrefixList &#34;&#34;
     thruPrefixList &#34;&#34;
     numRoutesList &#34;&#34;
     originProtocolList &#34;&#34;
     txPortId  &#34;1&#34;
     localPrefList &#34;&#34;
     communityList &#34;&#34;
     expcomList &#34;&#34;
     clusterList &#34;&#34;
     asTypeList &#34;&#34;
     mode &#34;&#34;
     asPathList &#34;&#34;
     medList &#34;&#34;
     nextHopList &#34;&#34;
     routeFlapDropTimeList &#34;&#34;
     routeFlapTimeList &#34;&#34;
     routesToFlapFromList &#34;&#34;
     routesToFlapToList &#34;&#34;
     linkFlapDropTime &#34;&#34;
     linkFlapTime &#34;&#34;
     originatorId &#34;&#34;
     extendedcommunity &#34;false&#34;
     extendedcommunityList &#34;&#34;
     4byteAs &#34;false&#34;
   }

   set index [llength $ipNetworkList]
   puts &#34;index = $index&#34;;
   if {[llength $fromPrefixList]!=$index || [llength $thruPrefixList]!=$index || [llength $numRoutesList]!=$index} {
      <a name="::result_debug(68)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in input args:fromPrefixList,thruPrefixList,numRoutesList,ipNetworkList should be same length&#34;
      return -1
   }

   for {set i 0} {$i &lt; $index} {incr i} {
<span class="comment-line">#        set ipNetwork [lindex $ipNetworkList $i]</span>
<span class="comment-line">#        set fromPrefix [lindex $fromPrefixList $i]</span>
<span class="comment-line">#        set thruPrefix [lindex $thruPrefixList $i]</span>
<span class="comment-line">#        set numRoutes [lindex $numRoutesList $i]</span>
<span class="comment-line">#        set nextHop [lindex $nextHopList $i]</span>
<span class="comment-line">#        set origId [lindex $originatorId $i]</span>
<span class="comment-line">#        #set ecom [lindex $extendedcommunity $i]</span>
<span class="comment-line">#        set ecom $extendedcommunity</span>
<span class="comment-line">#        if {[regexp -nocase $ecom &#34;true&#34;]} {</span>
<span class="comment-line">#          set extcom [lindex $extendedcommunityList $i]</span>
<span class="comment-line">#        } else {</span>
<span class="comment-line">#          set extcom &#34;&#34;</span>
<span class="comment-line">#        }</span>
<span class="comment-line">#        result_debug &#34;ipNetwork $ipNetwork&#34;</span>
<span class="comment-line">#        result_debug &#34;fromPrefix $fromPrefix&#34;</span>
<span class="comment-line">#        result_debug &#34;thruPrefix $thruPrefix&#34;</span>
<span class="comment-line">#        result_debug &#34;numRoutes $numRoutes&#34;</span>
<span class="comment-line">#        result_debug &#34;ecom $ecom&#34;</span>
<span class="comment-line">#        result_debug &#34;extcom $extcom&#34;</span>

 <span class="comment-line">#---newely added for extended community</span>
      set param &#34;&#34;
      set valueLst &#34;&#34;
      set extcommunity &#34;&#34;
<span class="comment-line">#       if {($ecom == &#34;true&#34;) &amp;&amp; ($extcom != &#34;null&#34;)} {</span>
<span class="comment-line">#          puts &#34;#############*********** coming here ########*********&#34;</span>
<span class="comment-line">#          bgp4RouteItem clearExtendedCommunityList</span>
<span class="comment-line">#          bgp4ExtendedCommunity setDefault</span>
<span class="comment-line">#          foreach extcommunity $extcom {</span>
<span class="comment-line">#             set param &#34;&#34;</span>
<span class="comment-line">#             set valueLst &#34;&#34;</span>
<span class="comment-line">#             set param [split $extcommunity :]</span>
<span class="comment-line">#             if {[lindex $param 0] == &#34;rt&#34;} {</span>
<span class="comment-line">#                bgp4ExtendedCommunity config -subType 2</span>
<span class="comment-line">#             } else {</span>
<span class="comment-line">#                bgp4ExtendedCommunity config -subType 3</span>
<span class="comment-line">#             }</span>
<span class="comment-line">#             if {[regexp {[0-9]+\.} [lindex $param 1]]} {</span>
<span class="comment-line">#                bgp4ExtendedCommunity config -type 1</span>
<span class="comment-line">#                set ipLst [split [lindex $param 1] &#34;.&#34;]</span>
<span class="comment-line">#                foreach ip $ipLst {</span>
<span class="comment-line">#                   set value1 [dectohex $ip]</span>
<span class="comment-line">#                   if {[string length $value1] == 1} {</span>
<span class="comment-line">#                      lappend valueLst &#34;0$value1&#34;</span>
<span class="comment-line">#                   } elseif {[string length $value1] == 2} {</span>
<span class="comment-line">#                      lappend valueLst &#34;$value1&#34;</span>
<span class="comment-line">#                   }</span>
<span class="comment-line">#                }</span>
<span class="comment-line">#                set value2 [dectohex [lindex $param 2]]</span>
<span class="comment-line">#                lappend valueLst [conVal2Byte 2 $value2]</span>
<span class="comment-line">#             } else {</span>
<span class="comment-line">#                regexp {[0-9]+} [lindex $param 1] val</span>
<span class="comment-line">#                set value1 [dectohex $val]</span>
<span class="comment-line">#                set value2 [dectohex [lindex $param 2]]</span>
<span class="comment-line">#                if [regexp -nocase &#34;L&#34; [lindex $param 1]] {</span>
<span class="comment-line">#                   bgp4ExtendedCommunity config -type 2</span>
<span class="comment-line">#                   lappend valueLst [conVal2Byte 4 $value1]</span>
<span class="comment-line">#                   lappend valueLst [conVal2Byte 2 $value2]</span>
<span class="comment-line">#                } else {</span>
<span class="comment-line">#                   bgp4ExtendedCommunity config -type 0</span>
<span class="comment-line">#                   lappend valueLst [conVal2Byte 2 $value1]</span>
<span class="comment-line">#                   lappend valueLst [conVal2Byte 4 $value2]</span>
<span class="comment-line">#                }</span>
<span class="comment-line">#             }</span>
            
<span class="comment-line">#             set valueLst [join $valueLst]</span>
<span class="comment-line">#             result_debug &#34;value list is $valueLst&#34;</span>
<span class="comment-line">#             bgp4ExtendedCommunity config -value  &#34;$valueLst&#34;</span>
<span class="comment-line">#             bgp4RouteItem addExtendedCommunity</span>
<span class="comment-line">#          }</span>
<span class="comment-line">#       }</span>
<span class="comment-line">#        bgp4RouteItem setDefault</span>
<span class="comment-line">#        bgp4RouteItem config -asPathSetMode bgpRouteAsPathNoInclude</span>
<span class="comment-line">#        bgp4RouteItem config -networkAddress $ipNetwork</span>
<span class="comment-line">#        bgp4RouteItem config -fromPrefix $fromPrefix</span>
<span class="comment-line">#        bgp4RouteItem config -thruPrefix $thruPrefix</span>
<span class="comment-line">#        bgp4RouteItem config -numRoutes $numRoutes</span>
<span class="comment-line">#---newely added for mode</span>

<span class="comment-line">#       if {$mode != &#34;&#34;} {</span>
<span class="comment-line">#        set modeType [lindex $mode $i]</span>
<span class="comment-line">#        result_debug &#34;modeType $modeType&#34;</span>
<span class="comment-line">#        if {$modeType == &#34;unicast&#34;} {</span>
<span class="comment-line">#            bgp4RouteItem config -enableIncludeMulticast false</span>
<span class="comment-line">#            bgp4RouteItem config -enableProperSafi false</span>
<span class="comment-line">#            bgp4RouteItem config -enableTraditionalNlriUpdate true</span>
<span class="comment-line">#           } else {</span>
<span class="comment-line">#            bgp4RouteItem config -enableIncludeMulticast true</span>
<span class="comment-line">#            bgp4RouteItem config -enableProperSafi true</span>
<span class="comment-line">#            bgp4RouteItem config -enableTraditionalNlriUpdate false</span>
<span class="comment-line">#       }</span>
<span class="comment-line">#       }</span>

<span class="comment-line">#       bgp4RouteItem config -enableNextHop 1</span>
<span class="comment-line">#        if {$nextHop!=&#34;&#34;} {</span>
<span class="comment-line">#           result_debug &#34;the nexthop $nextHop&#34;</span>
<span class="comment-line">#           bgp4RouteItem config -nextHopIpAddress $nextHop</span>
<span class="comment-line">#           bgp4RouteItem config -nextHopMode 1</span>
<span class="comment-line">#           bgp4RouteItem config -nextHopSetMode bgpRouteNextHopSetManually</span>
<span class="comment-line">#        } else {</span>
<span class="comment-line">#           bgp4RouteItem config -nextHopIpAddress $myIp</span>
<span class="comment-line">#        }</span>
<span class="comment-line">#        if {$origId !=&#34;&#34;} {</span>
<span class="comment-line">#           bgp4RouteItem config -enableOriginatorId true</span>
<span class="comment-line">#           bgp4RouteItem config -originatorId $origId</span>
<span class="comment-line">#        }</span>
<span class="comment-line">#        set localPref [lindex $localPrefList $i]</span>
<span class="comment-line">#        if {$localPref==&#34;&#34;} {</span>
<span class="comment-line">#           set $localPref 0</span>
<span class="comment-line">#        }</span>
<span class="comment-line">#        result_debug &#34;localPref $localPref&#34;</span>
<span class="comment-line">#        bgp4RouteItem config -enableLocalPref 1</span>
<span class="comment-line">#        bgp4RouteItem config -localPref $localPref</span>
<span class="comment-line">#        bgp4RouteItem config -originProtocol [lindex $originProtocolList $i]</span>
<span class="comment-line">#        bgp4RouteItem config -enableRouteRange true</span>
<span class="comment-line">#        if {[llength $communityList] != 0} {</span>
<span class="comment-line">#            # --- 65535:65281 = NO_EXPORT</span>
<span class="comment-line">#            set community1 [lindex $communityList $i]</span>
<span class="comment-line">#            if {[llength $expcomList] != 0} {</span>
<span class="comment-line">#            set expcom [lindex $expcomList $i]</span>
<span class="comment-line">#            } else {</span>
<span class="comment-line">#            set expcom &#34;null&#34;</span>
<span class="comment-line">#           }</span>

<span class="comment-line">#            if {($community1 != &#34;null&#34;) &amp;&amp; ($expcom == &#34;null&#34;)} {</span>
<span class="comment-line">#                result_debug &#34;community1 $community1&#34;</span>
<span class="comment-line">#                bgp4RouteItem config -enableCommunity  1</span>
<span class="comment-line">#                bgp4RouteItem config -communityList $community1</span>
<span class="comment-line">#            } elseif {($community1 != &#34;null&#34;) &amp;&amp; ($expcom != &#34;null&#34;) } {</span>
<span class="comment-line">#             result_debug &#34;community1 $community1&#34;</span>
<span class="comment-line">#             result_debug &#34;expcom $expcom&#34;</span>
<span class="comment-line">#             #expcom = 1 (NO_EXPORT)</span>
<span class="comment-line">#             #expcom = 2 (NO_ADVERTISE)</span>
<span class="comment-line">#             #expcom = 3 (NO_EXPORT_SUBCONFED)</span>
<span class="comment-line">#               if {$expcom ==1} {</span>
<span class="comment-line">#                bgp4RouteItem config -enableCommunity  1</span>
<span class="comment-line">#                bgp4RouteItem config -communityList &#34;$community1 65535:65281&#34;</span>
<span class="comment-line">#                } elseif {$expcom ==2} {</span>
<span class="comment-line">#                bgp4RouteItem config -enableCommunity  1</span>
<span class="comment-line">#                bgp4RouteItem config -communityList &#34;$community1 65535:65282&#34;</span>
<span class="comment-line">#               } else {</span>
<span class="comment-line">#                bgp4RouteItem config -enableCommunity  1</span>
<span class="comment-line">#                bgp4RouteItem config -communityList &#34;$community1 65535:65283&#34;</span>
<span class="comment-line">#             }</span>
<span class="comment-line">#          }</span>
<span class="comment-line">#        }</span>
<span class="comment-line">#        if {[llength $clusterList] != 0} {</span>
<span class="comment-line">#            set cluster1 [lindex $clusterList $i]</span>
<span class="comment-line">#            if {$cluster1 != &#34;null&#34;} {</span>
<span class="comment-line">#                result_debug &#34;cluster1 $cluster1&#34;</span>
<span class="comment-line">#                bgp4RouteItem config -enableCluster 1</span>
<span class="comment-line">#                bgp4RouteItem config -clusterList $cluster1</span>
<span class="comment-line">#            }</span>
<span class="comment-line">#        }</span>

       bgp4RouteItem config -enableASPath  1
       bgp4AsPathItem setDefault
       if {[llength $asPathList]!=0} {
          set aslist [lindex $asPathList $i]
          set asSegmentTypes [lindex $asTypeList $i]
          if {$aslist!=&#34;&#34;} {
             set indice 0
             bgp4RouteItem clearASPathList
             foreach asType $asSegmentTypes {
                <a name="::result_debug(69)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the asType $asType and asList $aslist&#34;
                bgp4AsPathItem config -enableAsSegment true
                bgp4AsPathItem config -asSegmentType $asType
                if {[llength $asSegmentTypes]&gt;1} {
                   bgp4AsPathItem config -asList [lindex $aslist $indice]
                } else {
                   bgp4AsPathItem config -asList $aslist
                }
                incr indice
                if {[bgp4RouteItem addASPathItem]} {
                   <a name="::result_debug(70)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Adding AS_PATH item&#34;
                }
             }
          } else {
             bgp4AsPathItem config -enableAsSegment false
              bgp4AsPathItem config -asPathSeqList [list $asNumber 257 ]
<span class="comment-line">#              if {[bgp4RouteItem addASPathItem]} {</span>
<span class="comment-line">#                 result_debug &#34;Error Adding AS_PATH item&#34;</span>
<span class="comment-line">#              }</span>
             bgp4RouteItem clearASPathList    ;<span class="comment-line"># for ixia 3.5 version and above</span>
          }
          <span class="comment-line">#result_debug &#34;AS_PATH ($aslist)&#34;</span>
       } else {
             bgp4AsPathItem config -enableAsSegment false
          bgp4AsPathItem config -asPathSeqList [list $asNumber 257 ]
<span class="comment-line">#          if {[bgp4RouteItem addASPathItem]} {</span>
<span class="comment-line">#             result_debug &#34;Error Adding AS_PATH item&#34;</span>
<span class="comment-line">#          }</span>
         bgp4RouteItem                clearASPathList    ;<span class="comment-line"># for ixia 3.5 version and above</span>
       }

<span class="comment-line">#        if {[llength $medList]!=0} {</span>
<span class="comment-line">#            set med [lindex $medList $i]</span>
<span class="comment-line">#            if {$med!=&#34;&#34;} {</span>
<span class="comment-line">#                result_debug &#34;med $med&#34;</span>
<span class="comment-line">#                bgp4RouteItem config -enableMED 1</span>
<span class="comment-line">#                bgp4RouteItem config -med $med</span>
<span class="comment-line">#            }</span>
<span class="comment-line">#        }</span>
       <span class="comment-line"># add route flap</span>
<span class="comment-line">#        set routeFlapDropTime [lindex $routeFlapDropTimeList $i]</span>
<span class="comment-line">#        if {($routeFlapDropTime!=&#34;&#34;) &amp;&amp; ($routeFlapDropTime != &#34;null&#34;)} {</span>
<span class="comment-line">#            result_debug &#34;-Do route Flap&#34;</span>
<span class="comment-line">#            set routeFlapTime [lindex $routeFlapTimeList $i]</span>
<span class="comment-line">#            set routesToFlapFrom [lindex $routesToFlapFromList $i]</span>
<span class="comment-line">#            set routesToFlapTo [lindex $routesToFlapToList $i]</span>
<span class="comment-line">#            bgp4RouteItem config -enableRouteFlap 1</span>
<span class="comment-line">#            bgp4RouteItem config -routeFlapDropTime $routeFlapDropTime</span>
<span class="comment-line">#            bgp4RouteItem config -routeFlapTime $routeFlapTime</span>
<span class="comment-line">#            bgp4RouteItem config -routesToFlapFrom $routesToFlapFrom</span>
<span class="comment-line">#            bgp4RouteItem config -routesToFlapTo $routesToFlapTo</span>
<span class="comment-line">#        } else {</span>
<span class="comment-line">#            bgp4RouteItem config -enableRouteFlap 0</span>
<span class="comment-line">#        }</span>
<span class="comment-line">#        set rr [expr $i +1]</span>
<span class="comment-line">#        if {[bgp4Neighbor addRouteRange routeRange$rr]} {</span>
<span class="comment-line">#            result_debug &#34;Error Adding Route item&#34;</span>
<span class="comment-line">#        }</span>
<span class="comment-line"># </span>}
<span class="comment-line">#    bgp4Neighbor config  -type  bgp4NeighborInternal</span>
<span class="comment-line">#    bgp4Neighbor config  -enable true</span>
<span class="comment-line">#    if {![regexp -nocase &#34;false&#34; $4byteAs]} {</span>
<span class="comment-line">#       bgp4Neighbor config -enable4ByteAsNumber $4byteAs</span>
<span class="comment-line">#    }</span>
<span class="comment-line">#    bgp4Neighbor config -localIpAddress $myIp</span>
<span class="comment-line">#    bgp4Neighbor config -rangeCount 1</span>
<span class="comment-line">#    bgp4Neighbor config -dutIpAddress $dutIp</span>

   <span class="comment-line"># add link flap</span>
<span class="comment-line">#    if {$linkFlapDropTime!=&#34;&#34;} {</span>
<span class="comment-line">#        bgp4Neighbor config -enableLinkFlap true</span>
<span class="comment-line">#        bgp4Neighbor config -linkFlapDropTime $linkFlapDropTime</span>
<span class="comment-line">#        bgp4Neighbor config -linkFlapTime $linkFlapTime</span>
<span class="comment-line">#    } else {</span>
<span class="comment-line">#        bgp4Neighbor config -enableLinkFlap false</span>
<span class="comment-line">#    }</span>

}
<strong><a name="::::extrMakeIsisRouter_4696">proc <a href="spirent.tcl-annot.html#::::extrMakeIsisRouter">::::extrMakeIsisRouter</a></a></strong> {args} {
   <a name="::parse_args(13)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> extrMakeIsisRouter $args {
      interfaceId &#34;&#34;
      interfaceIp &#34;&#34;
      ipMask &#34;&#34;
      areaId &#34;&#34;
      level &#34;isisLevel2&#34;
      helloIntervalL1 10
      deadIntervalL1 30
      helloIntervalL2 10
      deadIntervalL2 30
      networkType &#34;isisBroadcast&#34;
      metric 10
      routeMetric 10
      routeOrigin &#34;&#34;
      numNetworks 0
      prefix &#34;&#34;
      networkIp &#34;&#34;
      routerId &#34;&#34;
      routerLocalId &#34;1&#34;
      txPortId  &#34;1&#34;
      dutIp &#34;&#34;
   }
   

   <a name="::result_debug(71)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;inside extrMakeIsisRouter&#34;
   <a name="::result_debug(72)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;interfaceId: $interfaceId&#34;
   <a name="::result_debug(73)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;interfaceIp: $interfaceIp&#34;
   <a name="::result_debug(74)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ipMask: $ipMask&#34;
   <a name="::result_debug(75)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;areaId: $areaId&#34;
   <a name="::result_debug(76)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;level: $level&#34;
   <a name="::result_debug(77)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;prefix: $prefix&#34;
   <a name="::result_debug(78)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;networkIp: $networkIp&#34;
   <a name="::result_debug(79)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;routerId: $routerId&#34;
   <a name="::result_debug(80)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;routeOrigin: $routeOrigin&#34;
   
   set txPortId [<a name="::hMapPortIdToSpirentPort(24)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
   <a name="::logcmd(259)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform SetupPortsCommand -PortList $txPortId -Mtu 1492
   array set cmdResults [<a name="::logcmd(260)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(261)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] \
                            -port $txPortId -IfStack &#34;Ipv4If EthIIIf&#34; -IfCount &#34;1 1&#34;]
   set deviceHndl $cmdResults(-ReturnList)
   <a name="::logcmd(262)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $deviceHndl -RouterId [<a name="::makeRouterId(1)"><a href="./spirent.tcl.html#::makeRouterId_4868">::makeRouterId</a></a> $routerId]
   <a name="::logcmd(263)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(264)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If]  -Address $interfaceIp -Gateway $dutIp -PrefixLength 24 
   <a name="::logcmd(265)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(266)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] -SourceMac [join $routerId :]

   <span class="comment-line"># not setting area id, causes test case 5.7.3 to fail, removed  &#34;-Area1 $areaId -Area2 {} -Area3 {}&#34;</span>
   set isisAttributes &#34;-under $deviceHndl -IpVersion IPv4&#34;

<span class="comment-line">#    isisRouter config -enable true</span>
<span class="comment-line">#    isisRouter config -routerId $routerId</span>
   append isisAttributes &#34; -SystemId [join $routerId :]&#34;
<span class="comment-line">#    isisRouter config -areaAddressList $areaId</span>
<span class="comment-line">#    isisInterface setDefault</span>
<span class="comment-line">#    isisInterface config -enable true</span>
<span class="comment-line">#    isisInterface config -connectToDut true</span>
<span class="comment-line">#    isisInterface config -ipAddress $interfaceIp</span>
<span class="comment-line">#    isisInterface config -ipMask $ipMask</span>
<span class="comment-line">#   isisInterface config -metric $metric</span>
<span class="comment-line">#   isisInterface config -interfaceId $interfaceId</span>
<span class="comment-line">#   append isisAttributes &#34; -CircuitId [join $interfaceId :]&#34;</span>
<span class="comment-line">#   isisInterface config -networkType $networkType</span>
   switch -glob [string tolower $networkType] {
      *broadcast {
         append isisAttributes &#34; -NetworkType BROADCAST&#34;
      }
      *p* {
         append isisAttributes &#34; -NetworkType P2P&#34;
      }
      default { error &#34;Unsupported ISIS network type $networkType&#34; }
   }
<span class="comment-line">#   isisInterface config -level $level</span>
<span class="comment-line">##   isisInterface config -enableTrafficEngineering false</span>
<span class="comment-line">#   append isisAttributes &#34; -&#34;</span>
<span class="comment-line">##   isisInterface config -trafficEngineeringMetric2 10</span>
<span class="comment-line">#   append isisAttributes &#34; -TeRouterId &#34;</span>
<span class="comment-line">#   isisInterface config -administrativeGroup {0.0.0.0}</span>
<span class="comment-line">#    append isisAttributes &#34; -MtId 0.0.0.0&#34;</span>
<span class="comment-line">#    isisInterface config -maxBandwidth 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#    isisInterface config -maxReservableBandwidth 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#    isisInterface config -unreservedBandwidthPriority0 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#    isisInterface config -unreservedBandwidthPriority1 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#    isisInterface config -unreservedBandwidthPriority2 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#    isisInterface config -unreservedBandwidthPriority3 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#    isisInterface config -unreservedBandwidthPriority4 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#    isisInterface config -unreservedBandwidthPriority5 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#    isisInterface config -unreservedBandwidthPriority6 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#    isisInterface config -unreservedBandwidthPriority7 0.0</span>
<span class="comment-line">#    append isisAttributes &#34; -&#34;</span>
   switch $level {
      isisLevel1 {
         append isisAttributes &#34; -Level LEVEL1&#34;
         append isisAttributes &#34; -L1Metric 10 -L1WideMetric 10&#34;
         append isisAttributes &#34; -HelloInterval $helloIntervalL1&#34;
         set level LEVEL1
      }
      isisLevel2 {
         append isisAttributes &#34; -Level LEVEL2&#34;
         append isisAttributes &#34; -L2Metric 10 -L2WideMetric 10&#34;
         append isisAttributes &#34; -HelloInterval $helloIntervalL2&#34;
         set level LEVEL2
      }
      default { error &#34;Unsupported ISIS Level Type $level&#34;}
   }
   append isisAttributes &#34; -MetricMode NARROW_AND_WIDE&#34;
   
<span class="comment-line">#   isisInterface config -priorityLevel1 0</span>
<span class="comment-line">#   append isisAttributes &#34; -L1Metric 0 -L1WideMetric 0&#34;</span>
<span class="comment-line">#   isisInterface config -helloIntervalLevel1 $helloIntervalL1</span>
<span class="comment-line">#   append isisAttributes &#34; -HelloInterval $helloIntervalL1&#34;</span>
<span class="comment-line">#   isisInterface config -deadIntervalLevel1 $deadIntervalL1</span>
<span class="comment-line">#   append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#   isisInterface config -extendedDefaultMetric1 10</span>
<span class="comment-line">#   append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#   isisInterface config -trafficEngineeringMetric1 10</span>
<span class="comment-line">#   append isisAttributes &#34; -&#34;</span>
<span class="comment-line">#   isisInterface config -priorityLevel2 0</span>
   append isisAttributes &#34; -RouterPriority 0&#34;
<span class="comment-line">#   isisInterface config -helloIntervalLevel2 $helloIntervalL2</span>
<span class="comment-line">#   isisInterface config -deadIntervalLevel2 $deadIntervalL2</span>
<span class="comment-line">#   isisInterface config -extendedDefaultMetric2 10</span>

   set isisRouterConfig [eval &#34;logcmd stc::create IsisRouterConfig [subst $isisAttributes]&#34;]
   set idx 0
   set isisLsp   [<a name="::logcmd(267)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create IsisLspConfig -under $isisRouterConfig -level $level -SystemId [join $routerId :]]
   while {[llength $networkIp] &gt; $idx} {
      set myIp [lindex $networkIp $idx]
      set rMetric [lindex $routeMetric $idx]
      set prefx [lindex $prefix $idx]
      set routeOrg [lindex $routeOrigin $idx]
      set noOfNetworks [lindex $numNetworks $idx]
      switch -glob [string tolower $routeOrg] {
         *internal {set routeOrg internal}
         *external {set routeOrg external}
         default   {set routeOrg internal}
      }
      if {$rMetric == {}} {set rMetric 1}

<span class="comment-line">#       isisRouteRange config -enable true</span>
<span class="comment-line">#       isisRouteRange config -routeOrigin $routeOrg</span>
<span class="comment-line">#       isisRouteRange config -metric $rMetric</span>
<span class="comment-line">#       isisRouteRange config -numberOfNetworks $noOfNetworks</span>
<span class="comment-line">#       isisRouteRange config -prefix $prefx</span>
<span class="comment-line">#       isisRouteRange config -networkIpAddress $myIp</span>
<span class="comment-line">#       isisRouter addRouteRange [format &#34;routeRange%02d&#34; $rangeId]</span>
<span class="comment-line">#       isisRouteRange setDefault</span>
<span class="comment-line">#       incr rangeId</span>
      set isisRoute [<a name="::logcmd(268)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv4IsisRoutesConfig -under $isisLsp -RouteType $routeOrg -Metric $rMetric -MetricType $routeOrg]
      <a name="::logcmd(269)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(270)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $isisRoute -children-Ipv4NetworkBlock] -NetworkCount $noOfNetworks -StartIpList [<a name="::cleanRoute(1)"><a href="./spirent.tcl.html#::cleanRoute_3436">::cleanRoute</a></a> $myIp $prefx] -PrefixLength $prefx
      set routerId [split [<a name="::incrMac(1)"><a href="./spirent.tcl.html#::incrMac_4879">::incrMac</a></a> [join $routerId :]] :]
      incr idx
   }
   <span class="comment-line"># Add route for router IP</span>
<span class="comment-line">#   set isisRoute [logcmd stc::create Ipv4IsisRoutesConfig -under $isisLsp -RouteType $routeOrg -Metric $rMetric -MetricType $routeOrg]</span>
<span class="comment-line">#   logcmd stc::config [logcmd stc::get $isisRoute -children-Ipv4NetworkBlock] -NetworkCount 1 -StartIpList $interfaceIp -PrefixLength 32</span>
   
   <a name="::logcmd(271)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
}

<strong><a name="::::uniqMac_4863">proc <a href="spirent.tcl-annot.html#::::uniqMac">::::uniqMac</a></a></strong> {chas card port} {
   puts &#34;$chas $card $port&#34;
   return [format &#34;00 10 49 %02x %02x %02x&#34; [lindex [split $chas .] end] $card [string range $port 4 end]]
}

<strong><a name="::::makeRouterId_4868">proc <a href="spirent.tcl-annot.html#::::makeRouterId">::::makeRouterId</a></a></strong> {id} {

   if {[llength [split [join $id :] .:]] != 4} {
      set idlist [split [join $id :] .:]
      for {set i 2} {$i &lt;= 5} {incr i} {lappend ilist [expr 0+0x[lindex $idlist $i]]}
      return [join $ilist .]
   } else {
      return $id
   }
}

<strong><a name="::::incrMac_4879">proc <a href="spirent.tcl-annot.html#::::incrMac">::::incrMac</a></a></strong> { macaddr {val 00:00:00:00:00:01} } {
  set x [split $macaddr :.]
  set y [split $val :.]
  set c 0
  for { set i 5 } { $i &gt;= 0 } { incr i -1 } {
     set z($i) [ expr 0x[lindex $x $i] + 0x[lindex $y $i] + $c ]
     if { $z($i) &gt; 255 } {
        set c 1
        set z($i) [ expr ($z($i) &amp; 0xff) ]
     } else {
        set c 0
     }
  }
  return [format &#34;%02x.%02x.%02x.%02x.%02x.%02x&#34; $z(0) $z(1) $z(2) $z(3) $z(4) $z(5)]
}

<strong><a name="::::EnableIsisFilterOutHello_4895">proc <a href="spirent.tcl-annot.html#::::EnableIsisFilterOutHello">::::EnableIsisFilterOutHello</a></a></strong> {portIdList} {
   <a name="::result_debug(81)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;STC NOT filtering ISIS hello packets&#34;
   return
}
<strong><a name="::::DisableIsisFilterOutHello_4899">proc <a href="spirent.tcl-annot.html#::::DisableIsisFilterOutHello">::::DisableIsisFilterOutHello</a></a></strong> {portIdList} {
   <a name="::result_debug(82)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;STC NOT Disable ISIS route range&#34;
   return
}
<strong><a name="::::disIsisRouteRange_4903">proc <a href="spirent.tcl-annot.html#::::disIsisRouteRange">::::disIsisRouteRange</a></a></strong> {portId RouteRangeNo} {
   <a name="::result_debug(83)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;STC NOT Disable ISIS route range&#34;
   return
}
<strong><a name="::::enableIsisRouteRange_4907">proc <a href="spirent.tcl-annot.html#::::enableIsisRouteRange">::::enableIsisRouteRange</a></a></strong> {portId RouteRangeNo} {
   <a name="::result_debug(84)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;STC NOT Disable ISIS route range&#34;
   return
}
<strong><a name="::::disIsisAttach_4911">proc <a href="spirent.tcl-annot.html#::::disIsisAttach">::::disIsisAttach</a></a></strong> {portId} {
   <a name="::result_debug(85)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;STC NOT Disable ISIS attach&#34;
   return
}
<strong><a name="::::startIsis_4915">proc <a href="spirent.tcl-annot.html#::::startIsis">::::startIsis</a></a></strong> {txPortIdList} {
   <a name="::startBgp(1)"><a href="./bgp.tcl.html#::startBgp_54">::startBgp</a></a> $txPortIdList
}
<strong><a name="::::stopIsis_4918">proc <a href="spirent.tcl-annot.html#::::stopIsis">::::stopIsis</a></a></strong> {txPortIdList} {
   <a name="::stopBgp(1)"><a href="./bgp.tcl.html#::stopBgp_107">::stopBgp</a></a> $txPortIdList
}
<strong><a name="::::cleanupIsis_4921">proc <a href="spirent.tcl-annot.html#::::cleanupIsis">::::cleanupIsis</a></a></strong>  {txPortIdList} {
   <a name="::cleanupBgp(2)"><a href="./spirent.tcl.html#::cleanupBgp_4924">::cleanupBgp</a></a> $txPortIdList
}
<strong><a name="::::cleanupBgp_4924">proc <a href="spirent.tcl-annot.html#::::cleanupBgp">::::cleanupBgp</a></a></strong> {txPortIdList} {
   foreach txPortId $txPortIdList {
      set txPortId [<a name="::hMapPortIdToSpirentPort(25)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
      foreach emulatedDevice [<a name="::logcmd(272)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources] {
         <a name="::logcmd(273)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $emulatedDevice							
      }
   }
}

<strong><a name="::::setupOSPFIntraRouter_4933">proc <a href="spirent.tcl-annot.html#::::setupOSPFIntraRouter">::::setupOSPFIntraRouter</a></a></strong> {args} {
   return [eval setupOSPFRouter $args]
}

<strong><a name="::::overWriteProcs.x_4937">proc <a href="spirent.tcl-annot.html#::::overWriteProcs.x">::::overWriteProcs.x</a></a></strong> {libdir overwritedir} {

   <span class="comment-line"># save cur dir</span>
   set retdir [pwd]

   <span class="comment-line"># remove libdir from autopath</span>
   set loc [lsearch $::auto_path $libdir]
   if {$loc &gt;= 0} {
      set ::auto_path [lreplace $::auto_path $loc $loc]
   } else {
      error &#34;Could not remove lib dir from auto_path : $libdir&#34;
   }

   <span class="comment-line"># go to spirent dir and create index (just as a means to discover all procs)</span>
   cd $overwritedir
   auto_mkindex .
   set dir spirent
   source tclIndex
   set proclist [array names auto_index]
   set f [open [file join $libdir tclIndex] r]

   puts &#34;The following procedures will be sourced from the spirent library:&#34;
   foreach p $proclist { puts &#34;  $p&#34; }
   set filestoremove {}
   set ff [open tclIndex a]
   while {![eof $f]} {
      set line [gets $f]
      if {[lindex $line 0] == &#34;set&#34;} {
         unset auto_index
         eval $line
         set tofind [array names auto_index]
         if {[set loc [lsearch $proclist $tofind]] &lt; 0} {
            puts $ff [linsert $line [lsearch $line {$dir}] &#34;..&#34;]
         }
      }
   }
   close $ff
   close $f
   exit
}

<strong><a name="::::uniq_4978">proc <a href="spirent.tcl-annot.html#::::uniq">::::uniq</a></a></strong> {{val 0}} {
   incr val;
   <strong><a name="::::uniq_4980">proc <a href="spirent.tcl-annot.html#::::uniq">::::uniq</a></a></strong> &#34;{val $val}&#34; [info body uniq]
   return $val
}

<strong><a name="::::checkIxiaCardAndExecTest_4984">proc <a href="spirent.tcl-annot.html#::::checkIxiaCardAndExecTest">::::checkIxiaCardAndExecTest</a></a></strong> {testNo time1 {ixiaport &#34;1&#34;}} {
   return
}

<strong><a name="::::makeIpv6Gateway_4988">proc <a href="spirent.tcl-annot.html#::::makeIpv6Gateway">::::makeIpv6Gateway</a></a></strong> {addr} {

   return [join [lreplace [split $addr :] end end 1] :]

}

<strong><a name="::::setupLDPInterface_4994">proc <a href="spirent.tcl-annot.html#::::setupLDPInterface">::::setupLDPInterface</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;
   <a name="::parse_args(14)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupLDPInterface $args {
      dutIp &#34;&#34;
      interfaceIp &#34;&#34;
      interfaceMask &#34;24&#34;
      routerId &#34;&#34;
      discoveryMode &#34;ldpInterfaceBasic&#34;
      advMode &#34;ldpInterfaceDownstreamUnsolicited&#34;
      numNetworks &#34;0&#34;
      networkIp   &#34;0.0.0.0&#34;
      networkMask &#34;24&#34;
      networkIncrement &#34;ldpAdvertiseFecRangeIncrement&#34;
      networkLabelstart &#34;16&#34;
      <a name="::protocol(2)"><a href="./spirent.tcl.html#::protocol_1053">::protocol</a></a> &#34;ospf&#34;
      txPortId  &#34;1&#34;
   }

   set txPortId [<a name="::hMapPortIdToSpirentPort(26)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
   cleanupLdp $txPortId
   
   array set cmdResults [<a name="::logcmd(274)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList \
                            [<a name="::logcmd(275)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId \
                            -IfStack &#34;Ipv4If EthIIIf&#34; -IfCount &#34;1 1&#34; -active false]
   set deviceHndl $cmdResults(-ReturnList)
   <a name="::logcmd(276)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(277)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] -Address $interfaceIp \
      -Gateway $dutIp -PrefixLength $interfaceMask
   <a name="::logcmd(278)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $deviceHndl -RouterId $routerId
   
   set ldpAttributes &#34;-under $deviceHndl -dutIp $dutIp -helloInterval 5 -RecoveryTime 120 -DirectedHelloInterval 5 \                      -KeepAliveInterval 10 -LabelMin $networkLabelstart&#34;

   switch $advMode {
      ldpInterfaceDownstreamUnsolicited { append ldpAttributes &#34; -LabelAdvertisementMode DOWNSTREAM_UNSOLICITED&#34; }
      default { append ldpAttributes &#34; -LabelAdvertisementMode DOWNSTREAM_ON_DEMAND&#34; }
   }
   switch $discoveryMode {
      ldpInterfaceBasic { append ldpAttributes &#34; -HelloType LDP_DIRECTED_HELLO&#34; }
      default { append ldpAttributes &#34; -HelloType LDP_TARGETED_HELLO&#34; }
   }
   
   set ldpRouterConfig [eval &#34;logcmd stc::create LdpRouterConfig [subst $ldpAttributes]&#34;]
   set ldpLspR [<a name="::logcmd(279)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4PrefixLsp -under ldpRouterConfig -FecType LDP_FEC_TYPE_HOST_ADDR]
   <a name="::logcmd(280)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(281)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ldpLspR -children-Ipv4NetworkBlock] -NetworkCount 1 \
      -StartIpList $interfaceIp -PrefixLength 32
   
   set ldpLsp [<a name="::logcmd(282)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4PrefixLsp -under ldpRouterConfig -FecType LDP_FEC_TYPE_PREFIX]
   set idx 0
   while {[llength $networkIp] &gt; $idx} {
      set myIp [<a name="::cleanRoute(2)"><a href="./spirent.tcl.html#::cleanRoute_3436">::cleanRoute</a></a> [lindex $networkIp $idx] $prefx]
      set prefx [lindex $prefix $idx]
      set noOfNetworks [lindex $numNetworks $idx]
      <a name="::logcmd(283)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(284)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ldpLsp -children-Ipv4NetworkBlock] -NetworkCount $noOfNetworks \
                  -StartIpList $myIp -PrefixLength $prefx
   }
}


<strong><a name="::::startLdp_5051">proc <a href="spirent.tcl-annot.html#::::startLdp">::::startLdp</a></a></strong> {args} {
   <a name="::parse_args(15)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> startLdp $args {
      txPortIdList &#34;&#34;
      <a name="::protocol(3)"><a href="./spirent.tcl.html#::protocol_1053">::protocol</a></a> &#34;&#34;
   }
   <span class="comment-line"># start everthing</span>
   <a name="::startBgp(2)"><a href="./bgp.tcl.html#::startBgp_54">::startBgp</a></a> $txPortIdList
}

<strong><a name="::::stopLdp_5060">proc <a href="spirent.tcl-annot.html#::::stopLdp">::::stopLdp</a></a></strong> {txPortIdList} {
   <span class="comment-line">#stop everything</span>
   <a name="::stopBgp(2)"><a href="./bgp.tcl.html#::stopBgp_107">::stopBgp</a></a> $txPortIdList

}

<strong><a name="::::setupISISRouterV6_5066">proc  <a href="spirent.tcl-annot.html#::::setupISISRouterV6">::::setupISISRouterV6</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;
   <a name="::parse_args(16)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a>  setupISISRouterV6 $args {
      dutIp &#34;&#34;
      interfaceMacList &#34;&#34;
      interfaceIpList &#34;&#34;
      interfaceIpv6List &#34;&#34;  
      maskIpv6List &#34;64&#34;
      maskList &#34;255.255.255.0&#34;
      areaIdList &#34;0&#34;
      levelList &#34;isisLevel2&#34;
      helloIntervalL1List &#34;10&#34;
      deadIntervalL1List &#34;30&#34;
      helloIntervalL2List &#34;10&#34;
      deadIntervalL2List &#34;30&#34;
      networkTypeList &#34;isisBroadcast&#34;
      metricList &#34;10&#34;
      routeOriginList &#34;&#34;
      numNetworksList &#34;0&#34;
      prefixList &#34;&#34;
      networkIpList &#34;&#34;
      routeMetricList &#34;10&#34;
      routerIdList &#34;&#34;
      txPortId  &#34;1&#34;
      ipType &#34;v4&#34;
   }
   set iTxPortId $txPortId
   set txPortId [<a name="::MapIxiaPortId(1)"><a href="./spirent.tcl.html#::MapIxiaPortId_1064">::MapIxiaPortId</a></a> $txPortId cha car por]

   set netIp [lindex $networkIpList 0]
   
   if {[string tolower $ipType] != &#34;v6&#34;} {
      set interfaceIpList $interfaceIpList
   } else {
      set interfaceIpList $interfaceIpv6List
   }
   if {[llength $interfaceMacList] &gt; 0} {
      set macAddr [lindex $interfaceMacList 0]
      if {$macAddr == &#34;default&#34;} {
         <span class="comment-line">#        set macAddr [port cget -MacAddress]</span>
         set macAddr [<a name="::GetPortIdMac(1)"><a href="./misc.tcl.html#::GetPortIdMac_405">::GetPortIdMac</a></a> $iTxPortId &#34;:&#34;]
      }
   } else {
      set macAddr [<a name="::GetPortIdMac(2)"><a href="./misc.tcl.html#::GetPortIdMac_405">::GetPortIdMac</a></a> $iTxPortId &#34;:&#34;]
   }
   puts &#34;ISISv6 MAC: $macAddr&#34;
   set routerId $macAddr

   for {set i 0} {$i&lt;[set count [llength $interfaceIpList]]} {incr i} {
      set interfaceId $macAddr
      set interfaceIp [lindex $interfaceIpList $i]
      set mask [<a name="::getIndexOrZero(1)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $maskList $i]
      if {$count == 1} { set areaId [join $areaIdList {}]} else { set areaId [join [<a name="::getIndexOrZero(2)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $areaIdList $i] {}] }
      set level [<a name="::getIndexOrZero(3)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $levelList $i]
      set helloIntervalL1 [<a name="::getIndexOrZero(4)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $helloIntervalL1List $i]
      set deadIntervalL1 [<a name="::getIndexOrZero(5)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $deadIntervalL1List $i]
      set helloIntervalL2 [<a name="::getIndexOrZero(6)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $helloIntervalL2List $i]
      set deadIntervalL2 [<a name="::getIndexOrZero(7)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $deadIntervalL2List $i]
      set networkType [<a name="::getIndexOrZero(8)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $networkTypeList $i]
      set metric [<a name="::getIndexOrZero(9)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $metricList $i]
      set numNetworks [<a name="::getIndexOrZero(10)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $numNetworksList $i]
      set prefix [<a name="::getIndexOrZero(11)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $prefixList $i]
      set networkIp [<a name="::getIndexOrZero(12)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $networkIpList $i]
      set routeOrigin [<a name="::getIndexOrZero(13)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $routeOriginList $i]
      set routeMetric [<a name="::getIndexOrZero(14)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $routeMetricList $i]
      set routerId [<a name="::getIndexOrZero(15)"><a href="./spirent.tcl.html#::getIndexOrZero_5222">::getIndexOrZero</a></a> $routerIdList $i]
      if {[string length $routerId] == 0} {
         set routerId $interfaceId
      }
      set routerLocalId [expr ($i + 1)]
      set linkLocalAddr &#34;fe80::[expr 1+$iTxPortId+$i]&#34;
      set isisAttributes {}
      <span class="comment-line"># Create interface</span>
      if {[regexp -nocase &#34;v4&#34; $ipType]} {
         <a name="::logcmd(285)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform SetupPortsCommand -PortList $txPortId -Mtu 1492
         array set cmdResults [<a name="::logcmd(286)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand \
                                  -ParentList [<a name="::logcmd(287)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] \
                                  -port $txPortId -IfStack &#34;Ipv4If EthIIIf&#34; -IfCount &#34;1 1&#34;]
         set deviceHndl $cmdResults(-ReturnList)
         <a name="::logcmd(288)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $deviceHndl -RouterId [<a name="::makeRouterId(2)"><a href="./spirent.tcl.html#::makeRouterId_4868">::makeRouterId</a></a> $routerId]
         <a name="::logcmd(289)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(290)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If]  -Address $interfaceIp \
            -Gateway $dutIp -PrefixLength [getPrefixLen $mask] 
         <a name="::logcmd(291)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(292)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] -SourceMac $macAddr
         lappend isisAttributes -under $deviceHndl -ipVersion IPv4
      } else {
         <a name="::logcmd(293)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform SetupPortsCommand -PortList $txPortId -Mtu 1492         
         array set cmdResults [<a name="::logcmd(294)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand \
                                  -ParentList [<a name="::logcmd(295)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] \
                                  -port $txPortId -IfStack &#34;Ipv6If EthIIIf&#34; -IfCount &#34;1 1&#34;]
         set deviceHndl $cmdResults(-ReturnList)
         <a name="::logcmd(296)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(297)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] -SourceMac $macAddr
         <a name="::logcmd(298)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(299)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv6If] \
            -Address $interfaceIp -PrefixLength 64 -gateway [<a name="::makeIpv6Gateway(1)"><a href="./spirent.tcl.html#::makeIpv6Gateway_4988">::makeIpv6Gateway</a></a> $interfaceIp]
         <a name="::logcmd(300)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6If -under $deviceHndl \
            -stackedonendpoint-Targets [lindex [<a name="::logcmd(301)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] 0] \
            -toplevelif-Sources $deviceHndl -Address $linkLocalAddr
         lappend isisAttributes -under $deviceHndl -ipVersion IPv6
      }
      <span class="comment-line"># get next mac</span>
      set macAddr [<a name="::incrMac(2)"><a href="./spirent.tcl.html#::incrMac_4879">::incrMac</a></a> $macAddr]
<span class="comment-line">#       foreach j {1 2 3} val $areaId {</span>
<span class="comment-line">#          puts &#34;$j : $val&#34;</span>
<span class="comment-line">#          lappend isisAttributes -Area${j} $val</span>
<span class="comment-line">#       }</span>
      lappend isisAttributes -Area1 [join $areaId {}] -Area2 {} -Area3 {}
      lappend isisAttributes -SystemId [join $routerId :]
      switch -glob [string tolower $networkType] {
         *broadcast {
            lappend isisAttributes -NetworkType BROADCAST
         }
         *p* {
            lappend isisAttributes -NetworkType P2P
         }
         default { error &#34;Unsupported ISIS network type $networkType&#34; }
      }
      switch $level {
         isisLevel1 {
            lappend isisAttributes -Level LEVEL1
            lappend isisAttributes -L1Metric $metric -L1WideMetric $metric
            lappend isisAttributes -HelloInterval $helloIntervalL1
            set level LEVEL1
         }
         isisLevel2 {
            lappend isisAttributes -Level LEVEL2
            lappend isisAttributes -L2Metric $metric -L2WideMetric $metric
            lappend isisAttributes -HelloInterval $helloIntervalL2
            set level LEVEL2
         }
         default { error &#34;Unsupported ISIS Level Type $level&#34;}
      }
      lappend isisAttributes -MetricMode NARROW_AND_WIDE
      lappend isisAttributes -RouterPriority 0
      set isisRouterConfig [eval logcmd stc::create IsisRouterConfig $isisAttributes]
      set idx 0
      set isisLsp   [<a name="::logcmd(302)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create IsisLspConfig -under $isisRouterConfig -level $level -SystemId [join $routerId :]]
      while {[llength $networkIp] &gt; $idx} {
         set myIp [lindex $networkIp $idx]
         set rMetric [lindex $routeMetric $idx]
         set prefx [lindex $prefix $idx]
         set routeOrg [lindex $routeOrigin $idx]
         set noOfNetworks [lindex $numNetworks $idx] ; if {$noOfNetworks == {}} {set noOfNetworks 1}
         switch -glob [string tolower $routeOrg] {
            *internal {set routeOrg internal}
            *external {set routeOrg external}
         }
         set isisRoute [<a name="::logcmd(303)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6IsisRoutesConfig -under $isisLsp -RouteType $routeOrg -WideMetric $rMetric]
         <a name="::logcmd(304)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(305)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $isisRoute -children-Ipv6NetworkBlock] -NetworkCount $noOfNetworks -StartIpList $myIp -PrefixLength $prefx
         set routerId [split [<a name="::incrMac(3)"><a href="./spirent.tcl.html#::incrMac_4879">::incrMac</a></a> [join $routerId :]] :]
         incr idx
      }
   }
}




<strong><a name="::::getIndexOrZero_5222">proc <a href="spirent.tcl-annot.html#::::getIndexOrZero">::::getIndexOrZero</a></a></strong> {list idx} {
   if {[llength $list] &gt; 1} { return [lindex $list $idx] } else { return [lindex $list 0] }
}



<strong><a name="::::SendBSRFragment1_5228">proc <a href="spirent.tcl-annot.html#::::SendBSRFragment1">::::SendBSRFragment1</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;

   <a name="::parse_args(17)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendBSRFragment  $args {
      txPortId &#34;1&#34;
      sourceMac &#34;00 15 62 3E 88 C6&#34;
      DestMac  &#34;01 00 5E 00 00 0D&#34;
      sourceIP &#34;127.0.0.1&#34;
      destIP   &#34;224.0.0.13&#34;
      
   }
   set txPort [<a name="::hMapPortIdToSpirentPort(27)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]

   <a name="::logcmd(306)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $txPort
   
   <span class="comment-line"># Delete all streamblocks on tx port</span>
   <a name="::deleteAllStreams(6)"><a href="./spirent.tcl.html#::deleteAllStreams_3469">::deleteAllStreams</a></a> $txPort
   
   <span class="comment-line"># Stream</span>
   set stream_args {-insertSig FALSE -EnableHighSpeedResultAnalysis FALSE}
   lappend stream_args -EnableFcsErrorInsertion false
   lappend stream_args -ConstantFillPattern 0 -frameconfig {}
   lappend stream_args -frameLengthMode AUTO -EqualRxPortDistribution &#34;FALSE&#34;
   set hStreamBlock [eval logcmd stc::create streamBlock -under $txPort $stream_args]
   
   <span class="comment-line"># Ethernet</span>
   set eth_args {}
   lappend eth_args -srcMac [join $sourceMac :]
   lappend eth_args -dstMac [join $DestMac :]
   set hEthernet [eval logcmd stc::create ethernet:EthernetII -under $hStreamBlock \
                     -name sb1_eth $eth_args]
   
   <span class="comment-line">#IPv4</span>
   set hIpv4 [<a name="::logcmd(307)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                 -sourceAddr $sourceIP -destAddr $destIP -ttl 1 -identification 20252\
                 -protocol 103]
<span class="comment-line">#   set hFlangs [logcmd stc::create flags -under $hIpv4 -dfBit 0 -mfBit 1]</span>
   set pattern [join {24 00 93 33 16 32 00 00 01 00 29 01 01 02 01 00 00 20 E1 01 01 01 BB 91 00 00 01 00 06 01 3A 01 00 92 00 00 01 00 06 01 EF 01 00 15 00 00 01 00 06 01 2E 01 00 93 00 00 01 00 06 01 C3 01 00 00 00 00 01 00 06 01 02 01 00 93 00 00 01 00 06 01 49 01 00 56 00 00 01 00 06 01 F0 01 00 57 00 00 01 00 06 01 BD 01 00 00 00 00 01 00 06 01 E4 01 00 57 00 00 01 00 06 01 23 01 00 94 00 00 01 00 06 01 6A 01 00 58 00 00 01 00 06 01 91 01 00 57 00 00 01 00 06 01 D8 01 00 0B 00 00 01 00 06 01 17 01 00 95 00 00 01 00 06 01 5E 01 00 56 00 00 01 00 06 01 85 01 00 55 00 00 01 00 06 01 CC 01 00 06 00 00 01 00 06 01 0B 01 00 93 00 00 01 00 06 01 B2 01 00 58 00 00 01 00 06 01 F9 01 00 1D 00 00 01 00 06 01 38 01 00 93 00 00 01 00 06 01 7F 01 00 59 00 00 01 00 06 01 ED 01 00 15 00 00 01 00 06 01 2C 01 00 94 00 00 01 00 06 01 C1 01 00 03 00 00 01 00 06 01 47 01 00 58 00 00 01 00 06 01 E2 01 00 10 00 00 01 00 06 01 21 01 00 95 00 00 01 00 06 01 68 01 00 59 00 00 01 00 06 01 D6 01 00 0B 00 00 01 00 06 01 15 01 00 93 00 00 01 00 06 01 5C 01 00 57 00 00 01 00 06 01 83 01 00 58 00 00 01 00 06 01 CA 01 00 06 00 00 01 00 06 01 09 01 00 95 00 00 01 00 06 01 B0 01 00 5A 00 00 01 00 06 01 F7 01 00 1A 00 00 01 00 06 01 36 01 00 93 00 00 01 00 06 01 7D 01 00 59 00 00 01 00 06 01 EB 01 00 16 00 00 01 00 06 01 2A 01 00 92 00 00 01 00 06 01 51 01 00 59 00 00 01 00 06 01 DF 01 00 57 00 00 01 00 06 01 1E 01 00 93 00 00 01 00 06 01 45 01 00 94 00 00 01 00 06 01 E0 01 00 0F 00 00 01 00 06 01 3F 01 00 94 00 00 01 00 06 01 66 01 00 57 00 00 01 00 06 01 D4 01 00 08 00 00 01 00 06 01 13 01 00 92 00 00 01 00 06 01 5A 01 00 59 00 00 01 00 06 01 81 01 00 59 00 00 01 00 06 01 C8 01 00 06 00 00 01 00 06 01 07 01 00 91 00 00 01 00 06 01 F5 01 00 18 00 00 01 00 06 01 34 01 00 92 00 00 01 00 06 01 7B 01 00 57 00 00 01 00 06 01 E9 01 00 12 00 00 01 00 06 01 28 01 00 95 00 00 01 00 06 01 DD 01 00 59 00 00 01 00 06 01 1C 01 00 95 00 00 01 00 06 01 43 01 00 94 00 00 01 00 06 01 3D 01 00 91 00 00 01 00 06 01 64 01 00 58 00 00 01 00 06 01 D2 01 00 0B 00 00 01 00 06 01 11 01 00 92 00 00 01 00 06 01 58 01 00 58 00 00 01 00 06 01 9F 01 00 56 00 00 01 00 06 01 C6 01 00 02 00 00 01 00 06 01 05 01 00 94 00 00 01 00 06 01 F3 01 00 19 00 00 01 00 06 01 32 01 00 93 00 00 01 00 06 01 79 01 00 59 00 00 01 00 06 01 E7 01 00 13 00 00 01 00 06 01 26 01 00 95 00 00 01 00 06 01 DB 01 00 57 00 00 01 00 06 01 1A 01 00 91 00 00 01 00 06 01 41 01 00 93 00 00 01 00 06 01 CF 01 00 5A 00 00 01 00 06 01 0E 01 00 91 00 00 01 00 06 01 3B 01 00 94 00 00 01 00 06 01 62 01 00 59 00 00 01 00 06 01 D0 01 00 09 00 00 01 00 06 01 2F 01 00 91 00 00 01 00 06 01 56 01 00 55 00 00 01 00 06 01 9D 01 00 56 00 00 01 00 06 01 C4 01 00 57 00 00 01 00 06 01 03 01 00 94 00 00 01 00 06 01 F1 01 00 19 00 00 01 00 06 01 30 01 00 93 00 00 01 00 06 01 77 01 00 58 00 00 01 00 06 01 BE 01 00 57 00 00 01 00 06 01 E5 01 00 12 00 00 01 00 06 01 24 01 00 95 00 00 01 00 06 01 D9 01 00 59 00 00 01 00 06 01 18 01 00 93 00 00 01 00 06 01 CD 01 00 57 00 00 01 00 06 01 0C 01 00 93 00 00 01 00 06 01 39 01 00 92 00 00 01 00 06 01 60 01 00 58 00 00 01 00 06 01 A7 01 00 59 00 00 01 00 06 01 EE 01 00 5A 00 00 01 00 06 01 2D 01 00 93 00 00 01 00 06 01 54 01 00 58 00 00 01 00 06 01 9B 01 00 56 00 00 01 00 06 01 C2 01 00 58 00 00 01 00 06 01 01 01 00 92 00 00 01 00 06 01 8F 01 00 58 00 00 01 00 06 01 75 01 00 57 00 00 01 00 06 01 BC 01 00 57 00 00 01 00 06 01 E3 01 00 10 00 00 01 00 06 01 22 01 00 93 00 00 01 00 06 01 D7 01 00 58 00 00 01 00 06 01 16 01 00 94 00 00 01 00 06 01 CB 01 00 58 00 00 01 00 06 01 0A 01 00 93 00 00 01 00 06 01 F8 01 00 56 00 00 01 00 06 01 37 01 00 94 00 00 01 00 06 01 A5 01 00 58 00 00 01 00 06 01 EC 01 00 55 00 00 01 00 06 01 2B 01 00 91 00 00 01 00 06 01 99 01 00 57 00 00 01 00 06 01 C0 01 00 58 00 00 01 00 06 01 1F 01 00 92 00 00 01 00 06 01 46 01 00 94 00 00 01 00 06 01 8D 01 00 58 00 00 01 00 06 01 73 01 00 57 00 00 01 00 06 01 BA 01 00 57 00 00 01 00 06 01 E1 01 00 58 00 00 01 00 06 01 20 01 00 94 00 00 01 00 06 01 AE 01 00 59 00 00 01 00 06 01 D5 01 00 56 00 00 01 00 06 01 14 01 00 94 00 00 01 00 06 01 C9 01 00 59 00 00 01 00 06 01 08 01 00 95 00 00 01 00 06 01 4F 01 00 58 00 00 01 00 06 01 F6 01 00 55 00 00 01 00 06 01 35 01 00 93 00 00 01 00 06 01 A3 01 00 59 00 00 01 00 06 01 EA 01 00 58 00 00 01 00 06 01 29 01 00 94 00 00 01 00 06 01 97 01 00 58 00 00 01 00 06 01 DE 01 00 10 00 00 01 00 06 01 1D 01 00 94 00 00 01 00 06 01 44 01 00 92 00 00} {}]
   set custom [<a name="::logcmd(308)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $hStreamBlock -name sb1_custom \
                  -pattern $pattern]
   set gen_args {}
   lappend gen_args -loadunit PERCENT_LINE_RATE -FixedLoad 50
   lappend gen_args -DurationMode BURSTS -BurstSize 1 -duration 1
   set hGeneratorConfig [eval logcmd stc::config $txPort.Generator.GeneratorConfig $gen_args]
   stc::apply
   <a name="::logcmd(309)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList &#34;$txPort&#34;
   <a name="::StartPortsTransmit(10)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $txPort
   
   <a name="::result_debug(86)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;pim frame sent:24 00 93 33 16 32 00 00 01 00 29 01 01 02 01 00 00 20 E1 01 01 01 BB 91 00 00 01 00 06 01 3A 01 00 92 00 00 01 00 06 01 EF 01 00 15 00 00 01 00 06 01 2E 01 00 93 00 00 01 00 06 01 C3 01 00 00 00 00 01 00 06 01 02 01 00 93 00 00 01 00 06 01 49 01 00 56 00 00 01 00 06 01 F0 01 00 57 00 00 01 00 06 01 BD 01 00 00 00 00 01 00 06 01 E4 01 00 57 00 00 01 00 06 01 23 01 00 94 00 00 01 00 06 01 6A 01 00 58 00 00 01 00 06 01 91 01 00 57 00 00 01 00 06 01 D8 01 00 0B 00 00 01 00 06 01 17 01 00 95 00 00 01 00 06 01 5E 01 00 56 00 00 01 00 06 01 85 01 00 55 00 00 01 00 06 01 CC 01 00 06 00 00 01 00 06 01 0B 01 00 93 00 00 01 00 06 01 B2 01 00 58 00 00 01 00 06 01 F9 01 00 1D 00 00 01 00 06 01 38 01 00 93 00 00 01 00 06 01 7F 01 00 59 00 00 01 00 06 01 ED 01 00 15 00 00 01 00 06 01 2C 01 00 94 00 00 01 00 06 01 C1 01 00 03 00 00 01 00 06 01 47 01 00 58 00 00 01 00 06 01 E2 01 00 10 00 00 01 00 06 01 21 01 00 95 00 00 01 00 06 01 68 01 00 59 00 00 01 00 06 01 D6 01 00 0B 00 00 01 00 06 01 15 01 00 93 00 00 01 00 06 01 5C 01 00 57 00 00 01 00 06 01 83 01 00 58 00 00 01 00 06 01 CA 01 00 06 00 00 01 00 06 01 09 01 00 95 00 00 01 00 06 01 B0 01 00 5A 00 00 01 00 06 01 F7 01 00 1A 00 00 01 00 06 01 36 01 00 93 00 00 01 00 06 01 7D 01 00 59 00 00 01 00 06 01 EB 01 00 16 00 00 01 00 06 01 2A 01 00 92 00 00 01 00 06 01 51 01 00 59 00 00 01 00 06 01 DF 01 00 57 00 00 01 00 06 01 1E 01 00 93 00 00 01 00 06 01 45 01 00 94 00 00 01 00 06 01 E0 01 00 0F 00 00 01 00 06 01 3F 01 00 94 00 00 01 00 06 01 66 01 00 57 00 00 01 00 06 01 D4 01 00 08 00 00 01 00 06 01 13 01 00 92 00 00 01 00 06 01 5A 01 00 59 00 00 01 00 06 01 81 01 00 59 00 00 01 00 06 01 C8 01 00 06 00 00 01 00 06 01 07 01 00 91 00 00 01 00 06 01 F5 01 00 18 00 00 01 00 06 01 34 01 00 92 00 00 01 00 06 01 7B 01 00 57 00 00 01 00 06 01 E9 01 00 12 00 00 01 00 06 01 28 01 00 95 00 00 01 00 06 01 DD 01 00 59 00 00 01 00 06 01 1C 01 00 95 00 00 01 00 06 01 43 01 00 94 00 00 01 00 06 01 3D 01 00 91 00 00 01 00 06 01 64 01 00 58 00 00 01 00 06 01 D2 01 00 0B 00 00 01 00 06 01 11 01 00 92 00 00 01 00 06 01 58 01 00 58 00 00 01 00 06 01 9F 01 00 56 00 00 01 00 06 01 C6 01 00 02 00 00 01 00 06 01 05 01 00 94 00 00 01 00 06 01 F3 01 00 19 00 00 01 00 06 01 32 01 00 93 00 00 01 00 06 01 79 01 00 59 00 00 01 00 06 01 E7 01 00 13 00 00 01 00 06 01 26 01 00 95 00 00 01 00 06 01 DB 01 00 57 00 00 01 00 06 01 1A 01 00 91 00 00 01 00 06 01 41 01 00 93 00 00 01 00 06 01 CF 01 00 5A 00 00 01 00 06 01 0E 01 00 91 00 00 01 00 06 01 3B 01 00 94 00 00 01 00 06 01 62 01 00 59 00 00 01 00 06 01 D0 01 00 09 00 00 01 00 06 01 2F 01 00 91 00 00 01 00 06 01 56 01 00 55 00 00 01 00 06 01 9D 01 00 56 00 00 01 00 06 01 C4 01 00 57 00 00 01 00 06 01 03 01 00 94 00 00 01 00 06 01 F1 01 00 19 00 00 01 00 06 01 30 01 00 93 00 00 01 00 06 01 77 01 00 58 00 00 01 00 06 01 BE 01 00 57 00 00 01 00 06 01 E5 01 00 12 00 00 01 00 06 01 24 01 00 95 00 00 01 00 06 01 D9 01 00 59 00 00 01 00 06 01 18 01 00 93 00 00 01 00 06 01 CD 01 00 57 00 00 01 00 06 01 0C 01 00 93 00 00 01 00 06 01 39 01 00 92 00 00 01 00 06 01 60 01 00 58 00 00 01 00 06 01 A7 01 00 59 00 00 01 00 06 01 EE 01 00 5A 00 00 01 00 06 01 2D 01 00 93 00 00 01 00 06 01 54 01 00 58 00 00 01 00 06 01 9B 01 00 56 00 00 01 00 06 01 C2 01 00 58 00 00 01 00 06 01 01 01 00 92 00 00 01 00 06 01 8F 01 00 58 00 00 01 00 06 01 75 01 00 57 00 00 01 00 06 01 BC 01 00 57 00 00 01 00 06 01 E3 01 00 10 00 00 01 00 06 01 22 01 00 93 00 00 01 00 06 01 D7 01 00 58 00 00 01 00 06 01 16 01 00 94 00 00 01 00 06 01 CB 01 00 58 00 00 01 00 06 01 0A 01 00 93 00 00 01 00 06 01 F8 01 00 56 00 00 01 00 06 01 37 01 00 94 00 00 01 00 06 01 A5 01 00 58 00 00 01 00 06 01 EC 01 00 55 00 00 01 00 06 01 2B 01 00 91 00 00 01 00 06 01 99 01 00 57 00 00 01 00 06 01 C0 01 00 58 00 00 01 00 06 01 1F 01 00 92 00 00 01 00 06 01 46 01 00 94 00 00 01 00 06 01 8D 01 00 58 00 00 01 00 06 01 73 01 00 57 00 00 01 00 06 01 BA 01 00 57 00 00 01 00 06 01 E1 01 00 58 00 00 01 00 06 01 20 01 00 94 00 00 01 00 06 01 AE 01 00 59 00 00 01 00 06 01 D5 01 00 56 00 00 01 00 06 01 14 01 00 94 00 00 01 00 06 01 C9 01 00 59 00 00 01 00 06 01 08 01 00 95 00 00 01 00 06 01 4F 01 00 58 00 00 01 00 06 01 F6 01 00 55 00 00 01 00 06 01 35 01 00 93 00 00 01 00 06 01 A3 01 00 59 00 00 01 00 06 01 EA 01 00 58 00 00 01 00 06 01 29 01 00 94 00 00 01 00 06 01 97 01 00 58 00 00 01 00 06 01 DE 01 00 10 00 00 01 00 06 01 1D 01 00 94 00 00 01 00 06 01 44 01 00 92 00 00&#34;
   
   
   <a name="::result_debug(87)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Source IP:$sourceIP  Destination IP:$destIP&#34;
   
   
}

<strong><a name="::::SendBSRFragment2_5284">proc <a href="spirent.tcl-annot.html#::::SendBSRFragment2">::::SendBSRFragment2</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;

   <a name="::parse_args(18)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendBSRFragment  $args {
      txPortId &#34;1&#34;
      sourceMac &#34;00 15 62 3E 88 C6&#34;
      DestMac  &#34;01 00 5E 00 00 0D&#34;
      sourceIP &#34;127.0.0.1&#34;
      destIP   &#34;224.0.0.13&#34;
      
   }
   set txPort [<a name="::hMapPortIdToSpirentPort(28)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
   
   <a name="::logcmd(310)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $txPort
   
   <span class="comment-line"># Delete all streamblocks on tx port</span>
   <a name="::deleteAllStreams(7)"><a href="./spirent.tcl.html#::deleteAllStreams_3469">::deleteAllStreams</a></a> $txPort

   <span class="comment-line"># Stream</span>
   set stream_args {-insertSig FALSE -EnableHighSpeedResultAnalysis FALSE}
   lappend stream_args -EnableFcsErrorInsertion false
   lappend stream_args -ConstantFillPattern 0 -frameconfig {}
   lappend stream_args -frameLengthMode AUTO -EqualRxPortDistribution &#34;FALSE&#34;
   set hStreamBlock [eval logcmd stc::create streamBlock -under $txPort $stream_args]
   <span class="comment-line"># Ethernet</span>
   set eth_args {}
   lappend eth_args -srcMac [join $sourceMac :]
   lappend eth_args -dstMac [join $DestMac :]
   set hEthernet [eval logcmd stc::create ethernet:EthernetII -under $hStreamBlock \
                     -name sb1_eth $eth_args]
   
   <span class="comment-line">#IPv4</span>
   set hIpv4 [<a name="::logcmd(311)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                 -sourceAddr $sourceIP -destAddr $destIP -ttl 1 -identification 20254\
                 -protocol 103]
<span class="comment-line">#   set hFlangs [logcmd stc::create flags -under $hIpv4 -dfBit 0 -mfBit ]</span>
   set custom [<a name="::logcmd(312)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $hStreamBlock -name sb1_custom \
                  -pattern [join [list 24 00 01 35 16 32 00 00 01 00 29 01 01 02 01 00 00 20 E1 01 01 01 BB 2A 00 00 01 00 06 01 71 01 00 56 00 00 01 00 06 01 B8 01 00 59 00 00 01 00 06 01 3E 01 00 94 00 00 01 00 06 01 AC 01 00 56 00 00 01 00 06 01 D3 01 00 57 00 00 01 00 06 01 12 01 00 94 00 00 01 00 06 01 C7 01 00 59 00 00 01 00 06 01 06 01 00 95 00 00 01 00 06 01 4D 01 00 58 00 00 01 00 06 01 F4 01 00 55 00 00 01 00 06 01 33 01 00 95 00 00 01 00 06 01 A1 01 00 57 00 00 01 00 06 01 E8 01 00 59 00 00 01 00 06 01 27 01 00 94 00 00 01 00 06 01 6E 01 00 58 00 00 01 00 06 01 95 01 00 59 00 00 01 00 06 01 DC 01 00 0E 00 00 01 00 06 01 1B 01 00 93 00 00 01 00 06 01 42 01 00 93 00 00 01 00 06 01 89 01 00 56 00 00 01 00 06 01 0F 01 00 93 00 00 01 00 06 01 B6 01 00 56 00 00 01 00 06 01 3C 01 00 92 00 00 01 00 06 01 AA 01 00 59 00 00 01 00 06 01 D1 01 00 56 00 00 01 00 06 01 10 01 00 92 00 00 01 00 06 01 C5 01 00 02 00 00 01 00 06 01 04 01 00 94 00 00 01 00 06 01 4B 01 00 58 00 00 01 00 06 01 F2 01 00 58 00 00 01 00 06 01 31 01 00 94 00 00 01 00 06 01 E6 01 00 57 00 00 01 00 06 01 25 01 00 95 00 00 01 00 06 01 6C 01 00 59 00 00 01 00 06 01 93 01 00 57 00 00 01 00 06 01 DA 01 00 0B 00 00 01 00 06 01 19 01 00 93 00 00 01 00 06 01 40 01 00 92 00 00 01 00 06 01 87 01 00 56 00 00 01 00 06 01 CE 01 00 07 00 00 01 00 06 01 0D 01 00 93 00 00 01 00 06 01 B4 01 00 5A 00 00] {}]]
   
   
   set gen_args {}
   lappend gen_args -loadunit PERCENT_LINE_RATE -FixedLoad 50
   lappend gen_args -DurationMode BURSTS -BurstSize 1 -duration 1
   set hGeneratorConfig [eval logcmd stc::config $txPort.Generator.GeneratorConfig $gen_args]
   stc::apply
   <a name="::logcmd(313)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList &#34;$txPort&#34;
   <a name="::StartPortsTransmit(11)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $txPort
   
   
   <a name="::result_debug(88)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sent pim Frame:24 00 01 35 16 32 00 00 01 00 29 01 01 02 01 00 00 20 E1 01 01 01 BB 2A 00 00 01 00 06 01 71 01 00 56 00 00 01 00 06 01 B8 01 00 59 00 00 01 00 06 01 3E 01 00 94 00 00 01 00 06 01 AC 01 00 56 00 00 01 00 06 01 D3 01 00 57 00 00 01 00 06 01 12 01 00 94 00 00 01 00 06 01 C7 01 00 59 00 00 01 00 06 01 06 01 00 95 00 00 01 00 06 01 4D 01 00 58 00 00 01 00 06 01 F4 01 00 55 00 00 01 00 06 01 33 01 00 95 00 00 01 00 06 01 A1 01 00 57 00 00 01 00 06 01 E8 01 00 59 00 00 01 00 06 01 27 01 00 94 00 00 01 00 06 01 6E 01 00 58 00 00 01 00 06 01 95 01 00 59 00 00 01 00 06 01 DC 01 00 0E 00 00 01 00 06 01 1B 01 00 93 00 00 01 00 06 01 42 01 00 93 00 00 01 00 06 01 89 01 00 56 00 00 01 00 06 01 0F 01 00 93 00 00 01 00 06 01 B6 01 00 56 00 00 01 00 06 01 3C 01 00 92 00 00 01 00 06 01 AA 01 00 59 00 00 01 00 06 01 D1 01 00 56 00 00 01 00 06 01 10 01 00 92 00 00 01 00 06 01 C5 01 00 02 00 00 01 00 06 01 04 01 00 94 00 00 01 00 06 01 4B 01 00 58 00 00 01 00 06 01 F2 01 00 58 00 00 01 00 06 01 31 01 00 94 00 00 01 00 06 01 E6 01 00 57 00 00 01 00 06 01 25 01 00 95 00 00 01 00 06 01 6C 01 00 59 00 00 01 00 06 01 93 01 00 57 00 00 01 00 06 01 DA 01 00 0B 00 00 01 00 06 01 19 01 00 93 00 00 01 00 06 01 40 01 00 92 00 00 01 00 06 01 87 01 00 56 00 00 01 00 06 01 CE 01 00 07 00 00 01 00 06 01 0D 01 00 93 00 00 01 00 06 01 B4 01 00 5A 00 00&#34;
   <a name="::result_debug(89)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Source IP:$sourceIP  Destination IP:$destIP&#34;
   
   
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: nl_ixCreatePortIfs</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Configure port interfaces.  Each interface (or supplicant)</span>
<span class="comment-line">#              has a MAC and IP address. Before you can configure supplicants</span>
<span class="comment-line">#              and supTable, you need to create the &#34;virtual&#34; interfaces</span>
<span class="comment-line">#              representing these supplicants.</span>
<span class="comment-line"># </span>
<span class="comment-line"># Input args: -portInfoList: List of ports to create interfaces on</span>
<span class="comment-line">#                 &lt;portId&gt; &lt;startIp&gt; &lt;gw&gt; &lt;numSupplicants&gt; &lt;vlanId*&gt;</span>
<span class="comment-line">#                    *vlanId is optional </span>
<span class="comment-line">#             -startMacAddr: First 3 octets of MAC.  Last three are </span>
<span class="comment-line">#                            generated as card:port:count  </span>
<span class="comment-line">#               *If 6 octets are given, we just increment starting from there</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Typical Usage:</span>
<span class="comment-line">#    lappend portInfoList &#34;1 10.1.1.1 10.1.1.254 8&#34;</span>
<span class="comment-line">#    lappend portInfoList &#34;2 10.1.1.1 10.1.1.254 1&#34;</span>
<span class="comment-line">#    nl_ixCreatePortIfs -portInfoList $portInfoList -startMacAddr &#34;00 00 01&#34;</span>
<span class="comment-line">#    nl_ixCreatePortIfs -portInfoList $portInfoList -startMacAddr &#34;00 00 01 11 22 33&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::nl_ixDestroyPortIfs_5364">proc <a href="spirent.tcl-annot.html#::::nl_ixDestroyPortIfs">::::nl_ixDestroyPortIfs</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;
   <a name="::parse_args(19)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> nl_setupPortInterfaces $args {
      portInfoList &#34;1&#34;
   }
   set portlist {} 
   foreach i $portInfoList { lappend portlist [lindex $i 0] }
   <a name="::cleanupBgp(3)"><a href="./spirent.tcl.html#::cleanupBgp_4924">::cleanupBgp</a></a> $portlist
}

<strong><a name="::::nl_ixCreatePortIfs_5374">proc <a href="spirent.tcl-annot.html#::::nl_ixCreatePortIfs">::::nl_ixCreatePortIfs</a></a></strong> {args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;
   <a name="::parse_args(20)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> nl_setupPortInterfaces $args {
      portInfoList &#34;1  10.1.1.1  10.1.1.254  1&#34;
      startMacAddr &#34;00 00 01&#34;    ;<span class="comment-line"># Last 3 octets are CARD:PORT:COUNT </span>
      protocolServer &#34;disable&#34;
   }
   
   set portList [list]
   
   ;<span class="comment-line"># List of port intf {{&lt;port&gt; &lt;IP&gt; &lt;MAC&gt;} ... }</span>
   set ifInfoList [list]
   
   ;<span class="comment-line"># Configure interfaces for each port</span>
   foreach port $portInfoList {
      
      set portId [lindex $port 0]
      set txPort [<a name="::hMapPortIdToSpirentPort(29)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]

      puts &#34;TX Port $txPort   Port ID $portId&#34;
      
      set portStartIpAddr [lindex $port 1]
      set portGwIpAddr [lindex $port 2]
      set numSupplicants [lindex $port 3]
      set vlanId [lindex $port 4]
      
      <a name="::result_debug(90)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;portStartIpAddr:$portStartIpAddr  \
		portGwIpAddr:$portGwIpAddr numSupplicants:$numSupplicants&#34; 
      
      
      set incrOctet 4
       
      <span class="comment-line"># cleanup all devices on port</span>
      <a name="::cleanupBgp(4)"><a href="./spirent.tcl.html#::cleanupBgp_4924">::cleanupBgp</a></a> $txPort
     
      set ipAddressForThisInterface $portStartIpAddr
      
      set gCount 1
      for {set count 1} {$count &lt;= $numSupplicants} {incr count} {
         
         if {[string length $startMacAddr] == 8} {
            ;<span class="comment-line"># Normal case</span>
            set curMac &#34;$startMacAddr [format &#34;%02x %02x %02x&#34; $ca $po $gCount]&#34;
         } else {
            set curMac [<a name="::IncMacByOne(1)"><a href="./misc.tcl.html#::IncMacByOne_2383">::IncMacByOne</a></a> $startMacAddr &#34; &#34;]
            set startMacAddr $curMac
         }
         set ifInfoEntry [list $portId $ipAddressForThisInterface $curMac]
         lappend ifInfoList $ifInfoEntry
         
         <a name="::result_debug(91)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ipAddressForThisInterface: $ipAddressForThisInterface MAC: $curMac&#34;
 
         <span class="comment-line"># create device</span>
         if {$vlanId == &#34;&#34;} {
            array set cmdResults [<a name="::logcmd(314)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(315)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project]\
                                     -port $txPort -IfStack &#34;Ipv4If EthIIIf&#34; -IfCount &#34;1 1&#34;]
            set deviceHndl $cmdResults(-ReturnList)
         } else {
            array set cmdResults [<a name="::logcmd(316)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(317)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project]\
                                     -port $txPort -IfStack &#34;Ipv4If VlanIf EthIIIf&#34; -IfCount &#34;1 1 1&#34;]
            set deviceHndl $cmdResults(-ReturnList)
            <a name="::logcmd(318)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(319)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] -VlanId $vlanId
         }
         <a name="::logcmd(320)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(321)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] -Address $ipAddressForThisInterface -Gateway $portGwIpAddr -prefixLength 24
         <a name="::logcmd(322)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(323)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] -SourceMac [join $curMac :]

         if {$protocolServer == &#34;enable&#34;} {
            <a name="::logcmd(324)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $deviceHndl -EnablePingResponse TRUE 
         }
         set ipAddressForThisInterface [<a name="::incrIpField(1)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $ipAddressForThisInterface $incrOctet]
         incr gCount
      }
   }
   <a name="::result_debug(92)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Writing portList $portList to hardware.&#34;
   
   
   ;<span class="comment-line"># Dump some info for debugging.</span>
   ;<span class="comment-line"># nl_ixDumpInterfaceInfo</span>
   
   return $ifInfoList
}

<strong><a name="::::EnableProtocolServerV6_5456">proc <a href="spirent.tcl-annot.html#::::EnableProtocolServerV6">::::EnableProtocolServerV6</a></a></strong> {portIdList ipAddressList {tag &#34;none&#34;} {pingEnable &#34;false&#34;} {gwIpList &#34;0::0&#34;}} {

   for {set i 0} {$i &lt; [llength $portIdList]} {incr i} {
      set iPortId [lindex $portIdList $i]
      set portId [<a name="::hMapPortIdToSpirentPort(30)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $iPortId]
      set ipAddress [lindex $ipAddressList $i]
      set gwIp [lindex $gwIpList $i]
      if {$gwIp == &#34;&#34;} {set gwIp &#34;0.0.0.0&#34;} 
      set linkLocalAddr &#34;fe80::[expr 1+$iPortId+$i]&#34;
      if {$tag == &#34;none&#34;} {
         array set cmdResults [<a name="::logcmd(325)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand \
                                  -ParentList [<a name="::logcmd(326)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] \
                                  -port $portId -IfStack &#34;Ipv6If EthIIIf&#34; -IfCount &#34;1 1&#34;]
         set deviceHndl $cmdResults(-ReturnList)
      } else {
         array set cmdResults [<a name="::logcmd(327)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand \
                                  -ParentList [<a name="::logcmd(328)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] \
                                  -port $portId -IfStack &#34;Ipv6If VlanIf EthIIIf&#34; -IfCount &#34;1 1 1&#34;]
         set deviceHndl $cmdResults(-ReturnList)
         <a name="::logcmd(329)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(330)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] -VlanId $tag
      }
      <a name="::logcmd(331)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(332)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] -SourceMac [<a name="::GetDefaultPortIdMAC(10)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $portId]
      <a name="::logcmd(333)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(334)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv6If] \
         -Address $ipAddress -PrefixLength 64 -gateway [<a name="::makeIpv6Gateway(2)"><a href="./spirent.tcl.html#::makeIpv6Gateway_4988">::makeIpv6Gateway</a></a> $ipAddress]
      <a name="::logcmd(335)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6If -under $deviceHndl \
         -stackedonendpoint-Targets [lindex [<a name="::logcmd(336)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] 0] \
         -toplevelif-Sources $deviceHndl -Address $linkLocalAddr
      <a name="::logcmd(337)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $deviceHndl -EnablePingResponse $pingEnable
   }
}

<strong><a name="::::EnableProtocolServerMultipleV6_5487">proc <a href="spirent.tcl-annot.html#::::EnableProtocolServerMultipleV6">::::EnableProtocolServerMultipleV6</a></a></strong> {portIdList ipAddressList {tagList &#34;none&#34;} {pingEnable &#34;false&#34;} {gwIpList &#34;0::0&#34;}} {

   <a name="::EnableProtocolServerV6(1)"><a href="./spirent.tcl.html#::EnableProtocolServerV6_5456">::EnableProtocolServerV6</a></a> $portIdList $ipAddressList $tagList $pingEnable $gwIpList

}

<strong><a name="::::DisableProtocolServerMultipleV6_5493">proc <a href="spirent.tcl-annot.html#::::DisableProtocolServerMultipleV6">::::DisableProtocolServerMultipleV6</a></a></strong> {portId ipAddressList} {

   if {[llength $ipAddressList] &gt; 0} {
      <a name="::DisableProtocolServer(1)"><a href="./spirent.tcl.html#::DisableProtocolServer_497">::DisableProtocolServer</a></a> $portId $ipAddressList
   } else {
      <a name="::result_debug(93)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ipaddress list is empty&#34;
      return 0
   }
   return 1
}


<strong><a name="::::getPortsFromChassCardPortList_5505">proc <a href="spirent.tcl-annot.html#::::getPortsFromChassCardPortList">::::getPortsFromChassCardPortList</a></a></strong> { list } {
   set newlist {}
   foreach itms $list {
      foreach chass card port [split $itms ,] {}
      lappend newlist $port
   }
   return $newlist
}

<strong><a name="::::SetPortFilter_5514">proc <a href="spirent.tcl-annot.html#::::SetPortFilter">::::SetPortFilter</a></a></strong> {portId filter offset} {
<span class="comment-line">#grant</span>
   global STCMAIN
   puts &#34;[lindex [info level 0] 0] : Port=$portId Filter=$filter Offset=$offset&#34;
   if {[string is integer $portId]} {set portId [<a name="::hMapPortIdToSpirentPort(31)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]}
   set hAnalyzer [<a name="::logcmd(338)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $portId -children-Analyzer]
   set hFilter [<a name="::logcmd(339)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hAnalyzer -children-Analyzer32BitFilter]
   if {$hFilter == {}} {
      set hFilter [<a name="::logcmd(340)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Analyzer32BitFilter -under $hAnalyzer]
   }
   set mask {} ; set filt {}
   foreach num [split [join $filter {}] {}] zero [split 00000000 {}] {
      if {$num == {}} {
         append mask $zero
         append filt $zero
      } else {
         append mask f
         append filt $num
      }
   }
   <a name="::logcmd(341)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform AnalyzerStopCommand -AnalyzerList $hAnalyzer
puts &#34;Filter in $filter rebuilt - $filt&#34;
   <a name="::logcmd(342)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hFilter -LocationType START_OF_FRAME -Offset $offset -Mask 0x$mask \
      -StartOfRange 0x$filt -EndOfRange 0x$filt

<span class="comment-line">#   set STCMAIN(filter) [logcmd stc::subscribe -Parent $STCMAIN(project) \</span>
<span class="comment-line">#        -resultParent $portId \</span>
<span class="comment-line">#        -configType analyzer \</span>
<span class="comment-line">#        -resultType FilteredStreamResults]</span>

   <a name="::logcmd(343)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
   <a name="::logcmd(344)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform AnalyzerStartCommand -AnalyzerList $hAnalyzer

   return
}
<strong><a name="::::GetNumFilteredFramesReceived_5549">proc <a href="spirent.tcl-annot.html#::::GetNumFilteredFramesReceived">::::GetNumFilteredFramesReceived</a></a></strong> {portId} {
    global STCMAIN
    set fCount 0
    if {[string is integer $portId]} {set portId [<a name="::hMapPortIdToSpirentPort(32)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]}
<span class="comment-line">#    set hAnalyzer [logcmd stc::get $portId -children-Analyzer]</span>
<span class="comment-line">#    puts &#34;Children of project port then analyzer&#34;</span>

<span class="comment-line">#    puts [logcmd stc::get $STCMAIN(project) -children]</span>
<span class="comment-line">#    puts [logcmd stc::get $portId -children]</span>
<span class="comment-line">#    puts [logcmd stc::get $hAnalyzer -children]</span>

<span class="comment-line">#    set fobj [logcmd stc::get $hAnalyzer -children-AnalyzerPortResults]</span>
<span class="comment-line">#    if {$fobj!={}} {</span>
<span class="comment-line">#        puts &#34;Frame count filter [logcmd stc::get $fobj -UserDefinedFrameCount1]&#34;</span>
<span class="comment-line">#        return [logcmd stc::get $fobj -UserDefinedFrameCount1]</span>
<span class="comment-line">#    }</span>
    set c [<a name="::logcmd(345)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $portId.Analyzer.AnalyzerPortResults -TotalFrameCount]
    if {$c&gt;0} {
        puts &#34;Found count $c&#34;
        return $c
    }
    puts &#34;Could not locate filter obj&#34;
    return 0
}

<strong><a name="::::DisablePortFilter_5574">proc <a href="spirent.tcl-annot.html#::::DisablePortFilter">::::DisablePortFilter</a></a></strong> {portIds} {
   foreach portId $portIds {
   if {[string is integer $portId]} {set portId [<a name="::hMapPortIdToSpirentPort(33)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]}
   set hAnalyzer [<a name="::logcmd(346)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $portId -children-Analyzer]
   <a name="::logcmd(347)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform AnalyzerStopCommand -AnalyzerList $hAnalyzer
   set hFilter [<a name="::logcmd(348)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hAnalyzer -children-Analyzer32BitFilter]
   if {$hFilter != {}} {
      <a name="::logcmd(349)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $hFilter
   }
<span class="comment-line">#   logcmd stc::config $hFilter -LocationType START_OF_FRAME -Offset 0 -Mask -0xFFFFFFFF \</span>
<span class="comment-line">#      -StartOfRange 0 -EndOfRange 0xFFFFFFFF</span>
   <a name="::logcmd(350)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
   <a name="::logcmd(351)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform AnalyzerStartCommand -AnalyzerList $hAnalyzer
   }
   return
}


<strong><a name="::::GetCapturedFrms_5592">proc <a href="spirent.tcl-annot.html#::::GetCapturedFrms">::::GetCapturedFrms</a></a></strong> {portId maxPkts {verb &#34;yes&#34;}} {
   if {[string is integer $portId]} {set portId [<a name="::hMapPortIdToSpirentPort(34)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]}
   return [<a name="::GetCapturedFrames(1)"><a href="./spirent.tcl.html#::GetCapturedFrames_843">::GetCapturedFrames</a></a> $portId NULL 200 $maxPkts]
}

<strong><a name="::::formatBgpCommunity_5597">proc <a href="spirent.tcl-annot.html#::::formatBgpCommunity">::::formatBgpCommunity</a></a></strong> {i} {
   if {[llength [split $i :]] &gt; 1} { return $i }
   set val0 [expr $i &amp; 0xffff]
   set val1 [expr ($i &amp; 0xffff0000) &gt;&gt; 16]
   return $val1:$val0
}

<strong><a name="::::setupRipngPeer_5604">proc <a href="spirent.tcl-annot.html#::::setupRipngPeer">::::setupRipngPeer</a></a></strong> {args} {
   <a name="::result_debug(94)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a>  &#34;[lindex [info level 0] 0] : $args&#34;
   global TrafficGen
   <a name="::parse_args(21)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupRipngPeer $args {
      routerIp &#34;3333::24&#34;
      mask &#34;64&#34;
      sourceMac &#34;none&#34;
      vlanId &#34;0&#34;
      txPortId 1
      updateInterval 30
      updateIntervalOffset 5
      enableInterfaceMetric &#34;false&#34;
      response &#34;0&#34;
      rangeIpList &#34;&#34;
      metricList &#34;&#34;
      prefixList &#34;&#34;
      nexthopList &#34;&#34;
      tagList &#34;&#34;
      numRouteList &#34;&#34;
   }

   <a name="::cleanupRipng(1)"><a href="./spirent.tcl.html#::cleanupRipng_5730">::cleanupRipng</a></a> $txPortId *	
   set txPortIndex $txPortId
   set txPortId [<a name="::hMapPortIdToSpirentPort(35)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
   array set cmdResults [<a name="::logcmd(352)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(353)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv6If EthIIIf&#34; -IfCount &#34;1 1&#34;]
   set linkLocalAddr &#34;fe80::[expr 1+$txPortIndex]&#34;
   
   <span class="comment-line"># Get DUT IPv6 address corresponding to the Tester IPv6 address</span>
   set paramList &#34;&#34;
   set dutPrefixList [lrange [split $routerIp :] 0 end-1]
   for {set i [expr [llength $dutPrefixList]-1]} {$i &gt; 0} {incr i -1} {
      if {([lindex $dutPrefixList $i] != &#34;0&#34;) &amp;&amp; ([lindex $dutPrefixList $i] != &#34;00&#34;) &amp;&amp; ([lindex $dutPrefixList $i] != &#34;000&#34;) &amp;&amp; ([lindex $dutPrefixList $i] != &#34;0000&#34;) &amp;&amp; ([lindex $dutPrefixList $i] != &#34;&#34;)} {
         break;
      }
   }
   set dutPrefix [join  [lrange $dutPrefixList 0 $i] :]
   lappend paramList &#34;\{$dutPrefix\} 0&#34;
   set ipAddr1 [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show conf&#34; $paramList]
   set paramList &#34;&#34;
   lappend paramList &#34;\{$dutPrefix\} 1&#34;
   set ipv6Address [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show conf&#34; $paramList]
   set ipAddr2 [lindex [split  $ipv6Address /] 0]
   set prefixLength [lindex [split $ipv6Address /] 1] 
   set gatewayIpv6Addr &#34;$ipAddr1$ipAddr2&#34;
   set deviceHndl $cmdResults(-ReturnList)
   if {$prefixLength == &#34;&#34;} { set prefixLength 64 }
   <a name="::logcmd(354)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(355)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv6If] -Address $routerIp \
      -prefixLength $prefixLength -Gateway [<a name="::makeIpv6Gateway(3)"><a href="./spirent.tcl.html#::makeIpv6Gateway_4988">::makeIpv6Gateway</a></a> $routerIp]
   <a name="::logcmd(356)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv6If -under $deviceHndl \
      -stackedonendpoint-Targets [lindex [<a name="::logcmd(357)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] 0]\
      -toplevelif-Sources $deviceHndl -Address $linkLocalAddr
   stc::apply
   set ripRouterAttrs &#34;-under $deviceHndl -RipVersion NG -DutIpv6Addr ff02::9&#34;
   if {$updateInterval != &#34;&#34;} {
      append ripRouterAttrs  &#34; -UpdateInterval $updateInterval&#34;
   }
   if {$updateIntervalOffset != &#34;&#34;} {
      append ripRouterAttrs  &#34; -UpdateJitter $updateIntervalOffset&#34;
   }
   set ripRouterConfig [eval &#34;logcmd stc::create RipRouterConfig [subst $ripRouterAttrs]&#34;] 
   <a name="::logcmd(358)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
   set idx 0 
   while {[llength $rangeIpList] &gt; $idx} {    
      <span class="comment-line"># Extract the information from the table and set the route ranges </span>
      set myIp [lindex $rangeIpList $idx]
      set prefix [lindex $prefixList $idx]
      set numRoutes [lindex $numRouteList $idx]
      set metric [lindex $metricList $idx]
      set nextHop [lindex $nexthopList $idx]
      set routeTag [lindex $tagList $idx]
      incr idx
      set ipv6RouteAttrs &#34;-under $ripRouterConfig&#34;
      if {$metric != &#34;&#34;} {
         append ipv6RouteAttrs  &#34; -Metric $metric&#34;
      }
      if {($nextHop != &#34;&#34;) &amp;&amp; ($nextHop != &#34;::&#34;) &amp;&amp; ($nextHop != &#34;0:0:0:0:0:0:0:0&#34;)} {
         <span class="comment-line">#	append ipv6RouteAttrs  &#34; -NextHop $nextHop&#34;</span>
      }
      if {$routeTag != &#34;&#34;} {
         append ipv6RouteAttrs  &#34; -RouteTag $routeTag&#34;
      }
      
      set ripv6Route [eval &#34;logcmd stc::create RipngRouteParams [subst $ipv6RouteAttrs]&#34;]
      set ipv6BlockAttrs &#34;-StartIpList $myIp&#34;
      if {$prefix != &#34;&#34;} {
         append ipv6BlockAttrs  &#34; -PrefixLength $prefix&#34;
      }
      if {$numRoutes != &#34;&#34;} {
         append ipv6BlockAttrs  &#34; -NetworkCount $numRoutes&#34;
      }
      eval &#34;logcmd stc::config [lindex [<a name="::logcmd(359)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ripv6Route -children-Ipv6NetworkBlock] 0] [subst $ipv6BlockAttrs]&#34;
      <a name="::logcmd(360)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
   }									
   <a name="::logcmd(361)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
}

<strong><a name="::::startRipng_5700">proc <a href="spirent.tcl-annot.html#::::startRipng">::::startRipng</a></a></strong> {txPortIdList} {
   
   set pList &#34;&#34;;
   set globalDeviceList &#34;&#34;
   foreach txPortId $txPortIdList {
      set txPortId [<a name="::hMapPortIdToSpirentPort(36)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
      set deviceList [<a name="::logcmd(362)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
      <a name="::result_debug(95)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startRipng: Device List - $deviceList&#34;
      set globalDeviceList [concat $globalDeviceList $deviceList]				
   }
   
   <a name="::logcmd(363)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStartCommand -DeviceList $globalDeviceList
}

<strong><a name="::::stopRipng_5714">proc <a href="spirent.tcl-annot.html#::::stopRipng">::::stopRipng</a></a></strong> {txPortIdList} {
   
   set pList &#34;&#34;;
   set globalDeviceList &#34;&#34;
   foreach txPortId $txPortIdList {
      set txPortId [<a name="::hMapPortIdToSpirentPort(37)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
      set deviceList [<a name="::logcmd(364)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
      <a name="::result_debug(96)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopRipng: Device List - $deviceList&#34;
      set globalDeviceList [concat $globalDeviceList $deviceList]				
   }
   
   if {[catch {<a name="::logcmd(365)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStopCommand -DeviceList $globalDeviceList} retCode]} {
      error &#34;stopRipng: Spirent device start failed.&#34;
   } 
}

<strong><a name="::::cleanupRipng_5730">proc <a href="spirent.tcl-annot.html#::::cleanupRipng">::::cleanupRipng</a></a></strong> {txPortIdList routerIp} {
   foreach txPortId $txPortIdList {
      set txPortId [<a name="::hMapPortIdToSpirentPort(38)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
      foreach emulatedDevice [<a name="::logcmd(366)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources] {
         set ipv6IfList [<a name="::logcmd(367)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-Ipv6If]
         foreach ipv6If $ipv6IfList {
            if {$ipv6If != &#34;&#34;} {
               if {[<a name="::logcmd(368)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ipv6If -Address] ==  $routerIp | $routerIp == &#34;*&#34;} {
                  <a name="::logcmd(369)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $emulatedDevice
                  break
               }
            }
         }
      }									
      
   }			
}

<strong><a name="::::getPhyObject_5748">proc <a href="spirent.tcl-annot.html#::::getPhyObject">::::getPhyObject</a></a></strong> {portId} {
   if {[set obj [<a name="::logcmd(370)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $portId -children-EthernetFiber]] == {}} {
      set obj [<a name="::logcmd(371)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $portId -children-ethernetcopper]
   }
   return $obj
}

<strong><a name="::::EnableFlowControl_5755">proc <a href="spirent.tcl-annot.html#::::EnableFlowControl">::::EnableFlowControl</a></a></strong> {portIdList mode {maxWait 15}} {

   puts &#34; Setting ports - $portIdList to flow control mode : $mode&#34;
   foreach portId [<a name="::hMapPortIdToSpirentPort(39)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portIdList] {
      set phyObj [<a name="::getPhyObject(4)"><a href="./spirent.tcl.html#::getPhyObject_5748">::getPhyObject</a></a> $portId]
      set attrib &#34;-Duplex Full -AlternateSpeeds SPEED_1G&#34;
      switch [string tolower $mode] {
         asymmetric {
            append attrib &#34; -FlowControl false&#34;
            append attrib &#34; -AutoNegotiationMasterSlaveEnable false&#34;
            append attrib &#34; -PortSetupMode PORTCONFIG_ONLY&#34;
         }
         symmetric  {
            append attrib &#34; -FlowControl false&#34;
            append attrib &#34; -AutoNegotiationMasterSlaveEnable true&#34;
            append attrib &#34; -PortSetupMode REGISTERS_ONLY&#34;
         }
         none       {
            append attrib &#34; -FlowControl false&#34;
            append attrib &#34; -AutoNegotiationMasterSlaveEnable false&#34;
            append attrib &#34; -PortSetupMode PORTCONFIG_ONLY&#34;
         }
         both       {
            append attrib &#34; -FlowControl true&#34;
            append attrib &#34; -AutoNegotiationMasterSlaveEnable true&#34;
            append attrib &#34; -PortSetupMode REGISTERS_ONLY&#34;
         }
      }
      eval logcmd stc::config $phyObj $attrib
      stc::apply
      if {$maxWait == 0} {
         continue
      }
      set maxWaitCounter $maxWait
      
      while { $maxWaitCounter } {
         set state [string tolower [<a name="::logcmd(372)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::getPhyObject(5)"><a href="./spirent.tcl.html#::getPhyObject_5748">::getPhyObject</a></a> $portId] -LinkStatus]]
         if {$state == &#34;up&#34;} {
            <a name="::result_debug(97)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FOUND LINK UP for portId:$portId!&#34;
            break
         } else {
            <a name="::result_debug(98)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Waiting for portId:$portId linkUp..&#34;
            sleep 1
            incr maxWaitCounter -1
         }
      }
      
      if {$maxWaitCounter == 0} {
         <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;WARNING: No linkUp for Spirent portId:$portId&#34;
      }
   }
}

<strong><a name="::::ixiaUserDefinedStat1_5808">proc <a href="spirent.tcl-annot.html#::::ixiaUserDefinedStat1">::::ixiaUserDefinedStat1</a></a></strong> {{portId 1} {fd_res &#34;NULL&#34;} {fd_in &#34;NULL&#34;}} {
   
   global spawn_id
   
   after 1000
   <a name="::MapIxiaPortId(2)"><a href="./spirent.tcl.html#::MapIxiaPortId_1064">::MapIxiaPortId</a></a> $portId ch cd pt
   set portId [<a name="::hMapPortIdToSpirentPort(40)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]
   
   if {$fd_res != &#34;NULL&#34;} {puts $fd_res &#34;--- ($ch $cd $pt)&#34;}
   if { $fd_in != &#34;NULL&#34; } { puts $fd_in &#34;^ ($ch $cd $pt)&#34; }
   
   <a name="::StopPortsCapture(5)"><a href="./spirent.tcl.html#::StopPortsCapture_828">::StopPortsCapture</a></a> $portId
   <a name="::stat(1)"><a href="./spirent.tcl.html#::stat_967">::stat</a></a> get statAllStats $ch $cd $pt
   set frReceived [<a name="::stat(2)"><a href="./spirent.tcl.html#::stat_967">::stat</a></a> cget -userDefinedStat1]
   set frSent [<a name="::stat(3)"><a href="./spirent.tcl.html#::stat_967">::stat</a></a> cget -framesSent]
   puts &#34;Frames sent = $frSent&#34;
   if {$fd_res!=&#34;NULL&#34;} {puts $fd_res &#34;Frames sent = $frSent&#34;}
   puts &#34;Total frames received = [<a name="::stat(4)"><a href="./spirent.tcl.html#::stat_967">::stat</a></a> cget -framesReceived] (not used)&#34;
   puts &#34;Filtered frames UDS1 received = $frReceived&#34;
   if {$fd_res!=&#34;NULL&#34;} {puts $fd_res &#34;Filtered frames UDS1 received = $frReceived&#34;}
   if { $fd_in != &#34;NULL&#34; } {
      puts $fd_in &#34;$frSent&#34;
      puts $fd_in &#34;$frReceived&#34;
   } else {
      set SentReceivedPackets &#34;$frSent $frReceived&#34;
      return $SentReceivedPackets
   }
}

<strong><a name="::::sendIgmpv3BadReport_5837">proc <a href="spirent.tcl-annot.html#::::sendIgmpv3BadReport">::::sendIgmpv3BadReport</a></a></strong> {args} {
   <a name="::parse_args(22)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> sendIgmpv3BadReport $args {
      igmpMsgType &#34;34&#34;
      reportType &#34;1&#34;
      hostIp &#34;137.1.1.1&#34;
      srcIpAddr &#34;137.1.1.1&#34;
      groupAddr &#34;232.1.1.1&#34;
      txPortId  &#34;1&#34;
      numSource &#34;1&#34;
      numGroup &#34;1&#34;
      streamType &#34;stopStream&#34;
   }

   set txPort [<a name="::hMapPortIdToSpirentPort(41)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
   <span class="comment-line">#Stop generator before making changes.</span>
   <a name="::logcmd(373)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $txPort
   
   <span class="comment-line"># Delete all streamblocks on tx port</span>
   <a name="::deleteAllStreams(8)"><a href="./spirent.tcl.html#::deleteAllStreams_3469">::deleteAllStreams</a></a> $txPort
   
   
   <span class="comment-line"># initialize streamblock arguments</span>
   set stream_args {-insertSig FALSE -EqualRxPortDistribution FALSE -EnableHighSpeedResultAnalysis FALSE}
   lappend stream_args -ConstantFillPattern 0 -frameconfig {}
   <span class="comment-line"># Create basic stream</span>
   set hStreamBlock [eval logcmd stc::create streamBlock -under $txPort $stream_args]
   set sMacAddr [<a name="::GetDefaultPortIdMAC(11)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $txPort]
   lappend eth_args -srcMac [join $sMacAddr :]

   set destMacMulticast [<a name="::GetMulticastMac(1)"><a href="./misc.tcl.html#::GetMulticastMac_605">::GetMulticastMac</a></a> $groupAddr]
   lappend eth_args -dstMac [join $destMacMulticast :]

   set hEthernet [eval logcmd stc::create ethernet:EthernetII -under $hStreamBlock \
                     -name sb1_eth $eth_args]
   incr dataoffset 14
   set ipoffset 14
   set hIpv4 [<a name="::logcmd(374)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                 -sourceAddr $hostIp -destAddr $groupAddr -ttl 64 -identification 0 -protocol 2]
   incr dataoffset 20
   set hRangeModifier [<a name="::logcmd(375)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                          -under $hStreamBlock \
                          -ModifierMode INCR \
                          -Mask 65535 \
                          -StepValue &#34;1&#34; \
                          -Data 0 \
                          -RecycleCount 65535 \
                          -DataType NATIVE \
                          -EnableStream false \
                          -RepeatCount 0 \
                          -OffsetReference &#34;sb1_ip.identification&#34;]
   set hIgmp [<a name="::logcmd(376)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create igmp:Igmpv3Report -under $hStreamBlock \
                 -numGrpRecords $numGroup -type [format %02x $igmpMsgType] -name sb_igmp]
   set grpRecordsObj [<a name="::logcmd(377)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create grpRecords -under $hIgmp]
   set grpRecord [<a name="::logcmd(378)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create GroupRecord -under $grpRecordsObj -mcastAddr $groupAddr -recordType $reportType]
   incr dataoffset 16
   set srcListGroup [<a name="::logcmd(379)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create addrList -under $grpRecord -name sourceList]
   set srcIpAddr1 [lindex $srcIpAddr 0]
   set srcIpAddr2 [lindex $srcIpAddr 1] 
   if {$numSource != 0 } {
      incr dataoffset 4
      set src(1) [<a name="::logcmd(380)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv4Addr -under $srcListGroup -name addr1 -value $srcIpAddr1]
      if {$srcIpAddr2 != {} } {
         set src(2) [<a name="::logcmd(381)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv4Addr -under $srcListGroup -name addr1 -value $srcIpAddr2]
         incr dataoffset 4
      }
   }
   set framesize [expr $dataoffset + 4]
<span class="comment-line">#   if {$dataoffset &gt; 64} {set framesize $dataoffset}</span>
   set stream_args [list -frameLengthMode FIXED -FixedFrameLength $framesize]
   eval logcmd stc::config $hStreamBlock $stream_args
   <a name="::result_debug(99)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Send an IGMPv3 report of type $igmpMsgType for source $srcIpAddr and \
              group $groupAddr&#34;
   <span class="comment-line"># configure generator</span>
   <a name="::configGen(4)"><a href="./spirent.tcl.html#::configGen_3141">::configGen</a></a> $txPort stopStream $framesize 1 1 1000 1
   stc::apply
   <a name="::logcmd(382)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList &#34;$txPort&#34;
   <a name="::StartPortsTransmit(12)"><a href="./spirent.tcl.html#::StartPortsTransmit_886">::StartPortsTransmit</a></a> $txPort
   <a name="::stcCheckTxDone(7)"><a href="./spirent.tcl.html#::stcCheckTxDone_348">::stcCheckTxDone</a></a> -txPortId $txPort
   return [<a name="::getFrameContents(7)"><a href="./spirent.tcl.html#::getFrameContents_3204">::getFrameContents</a></a> $hStreamBlock 2 $ipoffset]
  
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
