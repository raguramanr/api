<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ePTSystemSetup.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ePTSystemSetup.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ePTSystemSetup.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ePTSystemSetup.tcl-annot.html">annotations</a> | <a href="ePTSystemSetup.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">##################################################################</span>
<span class="comment-line"># $RCSfile: SystemSetup.tcl,v $ - </span>
<span class="comment-line">#</span>
<span class="comment-line"># Copyright (c) 2000 by Extreme Networks Inc.</span>
<span class="comment-line"># </span>
<span class="comment-line"># Revision control history</span>
<span class="comment-line"># ------------------------</span>
<span class="comment-line"># $Header: /export/cvsroot/automation/Lib/SystemSetup.tcl,v 2.37.2.3.4.95 2010/08/24 01:39:50 ghundertmark Exp $</span>
<span class="comment-line">#</span>
<span class="comment-line"># Extreme Networks modification history</span>
<span class="comment-line"># -------------------------------------</span>
<span class="comment-line"># $Log: SystemSetup.tcl,v $</span>
<span class="comment-line"># Revision 2.37.2.3.4.95  2010/08/24 01:39:50  ghundertmark</span>
<span class="comment-line"># Merge branch 12_4 to trunk</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.95  2010/08/24 01:39:50  ghundertmark</span>
<span class="comment-line"># Merge branch 12_4 to trunk</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.94  2010/04/29 00:17:52  ghundertmark</span>
<span class="comment-line"># Add skip license check</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.93  2010/03/23 19:45:30  ghundertmark</span>
<span class="comment-line"># local changes on regserver, verify duts_info memcard exits, unrem conf def del po all</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.92  2010/03/22 16:38:10  ghundertmark</span>
<span class="comment-line"># Local rtpreg changes</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.91  2010/02/23 00:41:50  ghundertmark</span>
<span class="comment-line"># Add sysType to isExosPlat proc</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.90  2009/09/24 18:43:39  ghundertmark</span>
<span class="comment-line"># Merge from branch</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.89  2009/08/27 19:03:21  lagrawal</span>
<span class="comment-line"># merge from dev branch</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.88  2009/08/26 03:43:07  ghundertmark</span>
<span class="comment-line"># merge from branch-dev_v12-4-rel1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.14  2010/04/22 11:27:16  nellinivasu</span>
<span class="comment-line"># Added to skip license check, if defined in the cfg file.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.13  2010/02/22 23:30:04  ghundertmark</span>
<span class="comment-line"># Add sysType check to isExosPlatform</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.12  2009/10/19 16:18:38  autotest-sc</span>
<span class="comment-line"># added time configuration at the beginning of a feature test</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.11  2009/10/08 13:48:01  ghundertmark</span>
<span class="comment-line"># Remove save option from GetPortIDInfo</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.10  2009/09/24 18:40:50  ghundertmark</span>
<span class="comment-line"># Move GetPortInfo to AddTestbedInfoToDUTs_info</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.9  2009/08/27 18:34:25  lagrawal</span>
<span class="comment-line"># change ixia traffic from line rate to lower number as this was cuasing hub edp check failure in cfg files using port 9 in ixia port mapping list as well as trunk connection</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.8  2009/08/26 20:25:51  lagrawal</span>
<span class="comment-line"># reduce edp advertisement-interval to 15 seconds to avoid some check connection failure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.7  2009/08/26 03:35:48  ghundertmark</span>
<span class="comment-line"># Fix case where duts_info current_module is not defined in trace utility - Missed one</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.6  2009/08/26 03:32:39  ghundertmark</span>
<span class="comment-line"># Fix case where duts_info current_module is not defined in trace utility</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.5  2009/08/25 20:57:39  lagrawal</span>
<span class="comment-line"># fixed core/trace file rename proc to handle the case where currentTestNumber is not defined</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.4  2009/08/16 12:24:16  lagrawal</span>
<span class="comment-line"># change ixia traffic to continuous non stop traffic till ixia connection are verified fro check connection</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.3  2009/08/13 09:35:42  lagrawal</span>
<span class="comment-line"># 'Configure vlan default del po  all' addded before creating ixiaVlan.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.2  2009/07/28 01:53:18  lagrawal</span>
<span class="comment-line"># added proc to verify CF state before regression</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85.2.1  2009/07/07 21:56:59  dsuk</span>
<span class="comment-line"># added tftp connectivity test in SystemSetup</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.85  2009/07/01 10:55:48  nellinivasu</span>
<span class="comment-line"># Merged From Branch 'branch-dev_v12-1-rel4'</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.84  2009/05/01 18:07:26  lagrawal</span>
<span class="comment-line"># merge from dev</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.83  2009/04/08 20:14:28  jramarao</span>
<span class="comment-line"># commit from branch-dev_v12-1-rel4</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.82  2009/03/18 21:48:26  jramarao</span>
<span class="comment-line"># From branch-dev_v12-1-rel4</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.81  2009/01/15 21:17:41  eyoung</span>
<span class="comment-line"># Fixed regexp pattern from revision 2.37.2.3.4.80.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.80  2009/01/15 20:18:32  eyoung</span>
<span class="comment-line"># Fixes to accomodate new &#34;h&#34; flag for Manhattan hardware in &#34;show fdb&#34; output.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.10  2009/04/08 20:49:05  jramarao</span>
<span class="comment-line"># EnableBGPServiceProviderEdgeLicence corrected to show error</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.79  2008/10/30 03:48:31  ghundertmark</span>
<span class="comment-line"># Add license for pioneer</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.6  2009/03/13 15:02:17  nellinivasu</span>
<span class="comment-line"># Added workaround if tag used in checkconnection matches existing vlan on DUT.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.5  2009/03/12 19:07:09  lagrawal</span>
<span class="comment-line"># Check Connection optimization</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.4  2009/02/24 02:57:51  lagrawal</span>
<span class="comment-line"># fixed proc ChangeTraceFile and ChangeCoreFile</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.3  2009/01/30 15:11:57  autotest-sc</span>
<span class="comment-line"># merge from branch-pioneer2_dev-v12-1-rel4</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.2.4.4  2008/12/30 02:02:48  autotest-sc</span>
<span class="comment-line"># Show fdb delayed from 5 to 20 secs for voyager testbeds----PD4-512754823</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.2.4.3  2008/12/11 01:25:33  jramarao</span>
<span class="comment-line"># Sleep added</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.2.4.2  2008/12/03 01:22:20  autotest-sc</span>
<span class="comment-line"># to avoid show fdb failure on voyager platforms change the d .*m flag to d.*m</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.2.4.1  2008/11/28 05:10:33  jramarao</span>
<span class="comment-line"># merge from branch-pioneer_dev-v12-1-rel4</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.2  2008/10/27 22:49:53  jramarao</span>
<span class="comment-line"># show log added at the time of core file</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78.2.1  2008/09/24 01:43:10  autotest-sc</span>
<span class="comment-line"># Fixed merged issue</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.78  2008/09/20 07:30:02  jramarao</span>
<span class="comment-line"># Merge from branch-fixes_v12-1-rel0</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.77  2008/08/05 03:44:06  lagrawal</span>
<span class="comment-line"># merge from branch-fixes_v12-1-rel0</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.14  2008/08/02 01:01:49  lagrawal</span>
<span class="comment-line"># commented hub connection check faling badly in regression</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.13  2008/08/02 00:18:08  lagrawal</span>
<span class="comment-line"># Send traffic for some more time for hub connections</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.12  2008/07/30 23:20:21  lagrawal</span>
<span class="comment-line"># fix script issue</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.11  2008/07/30 22:52:00  lagrawal</span>
<span class="comment-line"># added code to check connetion from ixia to DUT though hub</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.10  2008/07/25 23:01:59  lagrawal</span>
<span class="comment-line"># merged changes from branch-dev_v12-1-rel2 and trunk-exos. cmd cvs update -dj branch-dev_v12-1-rel2 automation</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.4.2.1  2008/07/02 17:36:30  msubramanian</span>
<span class="comment-line"># Change for option to not reset ixia by setting ixiaNoReset in .cfg file.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.4  2008/06/23 11:12:47  pmanda</span>
<span class="comment-line"># DisableDebugMode added</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.3  2008/06/23 09:34:37  pmanda</span>
<span class="comment-line"># Clearing Trial License if any</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.2  2008/06/12 15:49:07  ghundertmark</span>
<span class="comment-line"># Remove limitation to setup broadcom global variables only on std testbeds</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.4.1  2008/06/07 01:33:18  lagrawal</span>
<span class="comment-line"># murge from branch-dev_v12-1-rel0</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76.2.1  2008/06/06 22:09:24  autotest-sc</span>
<span class="comment-line"># Murged from exos_br_12_1 to branch-dev_v12-1-rel0</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.76  2008/04/15 05:09:54  djain</span>
<span class="comment-line"># code added for core with test case number</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.75  2008/04/11 20:49:31  djain</span>
<span class="comment-line"># Moved report_end_test</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.74  2008/02/20 01:36:15  djain</span>
<span class="comment-line"># Remove while spaces from the test number</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.73  2008/01/17 23:07:40  dsuk</span>
<span class="comment-line"># efence modifications</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.71  2008/01/11 21:16:30  dsuk</span>
<span class="comment-line"># using SendACmd for efence</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.70  2008/01/11 11:12:15  nellinivasu</span>
<span class="comment-line"># Modified CheckCmdLegal to SendACmd in code to enable Ctrl+v+x+b reboot.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.69  2008/01/09 13:57:33  skumar</span>
<span class="comment-line"># Info exists efence</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.68  2008/01/09 00:18:42  ghundertmark</span>
<span class="comment-line"># exSleep after stoptransmit to recover from contPacket</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.67  2008/01/08 23:32:11  dsuk</span>
<span class="comment-line"># corrected handling of efence parameter</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.66  2008/01/08 21:52:29  dsuk</span>
<span class="comment-line"># added support for ELECTRONIC FENCE</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.65  2008/01/03 23:27:39  djain</span>
<span class="comment-line"># Added proc ChangeTraceFileName for check point</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.64  2007/12/07 22:40:37  ghundertmark</span>
<span class="comment-line"># Add case for system setup failure for GetBcmInfoStd</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.63  2007/12/04 18:06:18  ghundertmark</span>
<span class="comment-line"># Add condition to skip port info init for rtr testbeds</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.62  2007/12/04 15:58:00  ghundertmark</span>
<span class="comment-line"># Add code to save bcom globals to fast</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.61  2007/11/09 21:08:57  jramarao</span>
<span class="comment-line"># added support for ewar duts and continuous packet on ixia</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.60  2007/10/09 17:27:38  jramarao</span>
<span class="comment-line"># Script error from the branch corrected</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.59  2007/10/04 22:06:05  jramarao</span>
<span class="comment-line"># Merged from br 12-1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.58  2007/08/03 21:39:07  djain</span>
<span class="comment-line"># Added check for core on msm-a and msm-b</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.57  2007/07/26 00:19:02  djain</span>
<span class="comment-line"># Renaming core file on msm-b</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.56  2007/06/27 19:46:57  igokhale</span>
<span class="comment-line"># removed logout/login again for _verifyCFCorruptionStatusOnLogin</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.55  2007/06/26 04:02:03  pananthasubramanian</span>
<span class="comment-line"># updated proc SystemSetup, SetupIxiaConnections to support generic DUT topology</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.54.2.1  2007/08/20 22:57:53  djain</span>
<span class="comment-line"># Merged changes from trunk-exos Lib and added changes manually</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.58  2007/08/03 21:39:07  djain</span>
<span class="comment-line"># Added check for core on msm-a and msm-b</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.57  2007/07/26 00:19:02  djain</span>
<span class="comment-line"># Renaming core file on msm-b</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.56  2007/06/27 19:46:57  igokhale</span>
<span class="comment-line"># removed logout/login again for _verifyCFCorruptionStatusOnLogin</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.55  2007/06/26 04:02:03  pananthasubramanian</span>
<span class="comment-line"># updated proc SystemSetup, SetupIxiaConnections to support generic DUT topology</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.54.2.2  2007/10/26 12:19:48  pananthasubramanian</span>
<span class="comment-line"># update SystemSetup proc and isEdpWorking proc to support eware duts</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.54.2.1  2007/08/20 22:57:53  djain</span>
<span class="comment-line"># Merged changes from trunk-exos Lib and added changes manually</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.58  2007/08/03 21:39:07  djain</span>
<span class="comment-line"># Added check for core on msm-a and msm-b</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.57  2007/07/26 00:19:02  djain</span>
<span class="comment-line"># Renaming core file on msm-b</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.56  2007/06/27 19:46:57  igokhale</span>
<span class="comment-line"># removed logout/login again for _verifyCFCorruptionStatusOnLogin</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.55  2007/06/26 04:02:03  pananthasubramanian</span>
<span class="comment-line"># updated proc SystemSetup, SetupIxiaConnections to support generic DUT topology</span>
<span class="comment-line">#</span>
<span class="comment-line"># Changed license check to look for L2 license for Lynx platform.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.53  2007/05/02 16:34:03  igokhale</span>
<span class="comment-line"># added a &#34;logout&#34; before start of check connection, to let cf corruption command execute</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.52  2007/04/05 00:15:03  igokhale</span>
<span class="comment-line"># *** empty log message ***</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.51  2007/03/07 22:59:01  achilukuri</span>
<span class="comment-line"># Checking bad connection with just one show edp port all</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.50  2007/03/03 03:30:24  achilukuri</span>
<span class="comment-line"># Added code to detect if there are any bad connections betwwen DUT and Hub</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.49  2007/01/04 19:15:48  jramarao</span>
<span class="comment-line"># License failure correction</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.48  2006/12/21 17:49:25  skumar</span>
<span class="comment-line"># Added send another frame for portId learning</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.47  2006/12/07 14:14:06  skumar</span>
<span class="comment-line"># Clean tmpedp file, clear fdb removed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.46  2006/10/25 00:10:27  smohanty</span>
<span class="comment-line"># Merged from exos-br-11_5</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.45  2006/10/04 00:24:02  jramarao</span>
<span class="comment-line"># changed for checkconnection</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.44.2.1  2006/10/25 00:07:29  smohanty</span>
<span class="comment-line"># Added code to populate ixiaPortMappingArray for portId 9. This problem was</span>
<span class="comment-line"># introduced as the DUT port mapping was removed from cfg files for ixia port</span>
<span class="comment-line"># id 9</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.44  2006/08/03 13:00:23  nellinivasu</span>
<span class="comment-line"># Added bcmPlatform check for cli 'clear platform system-dump'</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.43  2006/08/01 11:45:23  nellinivasu</span>
<span class="comment-line"># Added 'clear platform system-dump' to proc SystemSetup</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.42  2006/05/19 20:26:29  ghundertmark</span>
<span class="comment-line"># Add CheckForPreviousCore functionality</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.41  2006/05/03 03:31:27  igokhale</span>
<span class="comment-line"># corrected spacing</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.40  2006/03/31 02:47:59  igokhale</span>
<span class="comment-line"># Q3FY06 Rel commit</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.39  2006/03/16 19:57:32  igokhale</span>
<span class="comment-line"># merged from branch12</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.38  2006/03/16 19:33:16  igokhale</span>
<span class="comment-line"># merged from branch12</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.37.2.1  2006/03/16 19:32:28  igokhale</span>
<span class="comment-line"># added code to allow for startcardnum:startportnum format in cfg file</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.37.2.2  2006/03/16 19:54:58  igokhale</span>
<span class="comment-line"># undid last change</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.37.2.1  2006/03/16 19:32:28  igokhale</span>
<span class="comment-line"># added code to allow for startcardnum:startportnum format in cfg file</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.37  2005/10/18 00:47:47  skumar</span>
<span class="comment-line"># Put core file internal if no external card</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.36  2005/09/16 02:05:49  skumar</span>
<span class="comment-line"># Committed topology optimization code for 8 port support</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.35  2005/09/10 01:32:29  igokhale</span>
<span class="comment-line"># Changed delay after config vlan in checkConnection to 5 seconds to allow for 10gig</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.34  2005/06/28 01:23:49  igokhale</span>
<span class="comment-line"># Added delay of 1 second before FDB learning to accomodate 10gig Aspen setup</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.33  2005/06/16 01:40:03  skumar</span>
<span class="comment-line"># New product defs at Rel10</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.32  2005/05/04 19:17:05  skumar</span>
<span class="comment-line"># Check license at least core</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.31  2005/05/02 20:07:36  alim</span>
<span class="comment-line"># Login changes</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.30  2005/04/13 01:00:58  skumar</span>
<span class="comment-line"># Add back clear log st as uncon sw all does not clear log</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.29  2005/03/14 16:59:03  skumar</span>
<span class="comment-line"># Reduced edp interval, reset edp after CheckConnection</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.27  2005/02/19 00:11:25  cshaw</span>
<span class="comment-line"># dumpAllSwitchInfo when connectionBad</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.26  2005/01/07 23:46:02  skumar</span>
<span class="comment-line"># Added sleep 5 for edp delay, fix for loop for correct trunkports</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.25  2004/12/18 01:57:59  dchan</span>
<span class="comment-line"># commit for release 8</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.24  2004/12/10 00:06:09  skumar</span>
<span class="comment-line"># Check for summit for SummitX450 for memoryCard</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.23  2004/12/07 18:49:17  skumar</span>
<span class="comment-line"># Fix the fdb learning reports specific to DUT</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.22  2004/11/18 20:43:31  skumar</span>
<span class="comment-line"># Fix bug w.r.t. card get ixia routine for 10G blades</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.21  2004/11/17 19:11:30  skumar</span>
<span class="comment-line"># Fix erronous return value from IsEDPWorking</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.20  2004/11/13 00:35:24  skumar</span>
<span class="comment-line"># Redo edp routines, isExosPlatform, isEDPWorking</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.19  2004/11/11 18:33:28  mverma</span>
<span class="comment-line"># Reverting back the accidental change to useNewMethod variable.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.18  2004/11/09 22:55:49  mverma</span>
<span class="comment-line"># Adding snmp library files to support STP</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.17  2004/11/03 12:44:20  skumar</span>
<span class="comment-line"># Do not use regexp instead use string match</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.16  2004/11/03 12:12:31  skumar</span>
<span class="comment-line"># Avoid regex issue in older redhat versions</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.15  2004/10/20 19:21:01  skumar</span>
<span class="comment-line"># Disable edp for Aspen until fixed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.14  2004/10/19 20:15:32  mverma</span>
<span class="comment-line"># Added the support to use the old method for trunk port validation.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.13  2004/10/15 18:32:12  skumar</span>
<span class="comment-line"># Put non-default vlan code for checkConnection</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.12  2004/10/15 02:33:43  skumar</span>
<span class="comment-line"># Core file capture, ixiaVlan in checkConnection</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.11  2004/10/12 22:07:20  mverma</span>
<span class="comment-line"># Using &#34;show edp&#34; for trunk-port connection validation, during check connection.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.10.2.1  2004/10/15 00:54:43  skumar</span>
<span class="comment-line"># coredump on memorycard starting 11.1.0.21</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.10  2004/09/30 00:59:25  mverma</span>
<span class="comment-line"># Exos Rel7 check in.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.9  2004/08/03 16:10:19  rmendis</span>
<span class="comment-line"># Put delay to sync vlan table</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.8.2.1  2004/08/20 20:26:12  alim</span>
<span class="comment-line"># Add support for startPortNum</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.8  2004/07/28 18:39:11  skumar</span>
<span class="comment-line"># Added Aspen support</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.7  2004/07/09 01:15:15  alim</span>
<span class="comment-line"># Remove references to exos variable</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.6  2004/06/04 02:54:50  skumar</span>
<span class="comment-line"># Moved SetupIxiaConnections before skip ixia for checkConnection NO_IXIA</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.5  2004/04/01 21:57:03  skumar</span>
<span class="comment-line"># Commit as part of release5</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.4  2003/12/03 03:44:34  skumar</span>
<span class="comment-line"># Enable &#34;dis idletime&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.3  2003/11/24 06:02:13  dchan</span>
<span class="comment-line"># trunk-exos release 3</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.2.2.2  2003/11/10 19:57:21  skumar</span>
<span class="comment-line"># Avoid package req twice</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.2.2.1  2003/10/28 17:59:35  skumar</span>
<span class="comment-line"># Fixes for no-l3 license, isExosPlatform added.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.2.4.2  2003/10/11 03:17:12  tnguyen</span>
<span class="comment-line"># BD-Mariner changed to BD-10808</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.2.4.1  2003/10/08 19:35:29  tnguyen</span>
<span class="comment-line"># Support downloading image for Mariner and PC</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.2  2003/10/06 17:16:20  dchan</span>
<span class="comment-line"># trunk-exos release 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.1.2.2  2003/09/26 19:41:36  cshaw</span>
<span class="comment-line"># seet RELEASE_MASTER from env(EXOS_RELEASE_MASTER)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.4.1.2.1  2003/09/24 18:37:19  skumar</span>
<span class="comment-line"># EXOS specific fixes/changes.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3.2.1  2003/06/23 21:28:45  cshaw</span>
<span class="comment-line"># Merged in EW trunk</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.3  2003/06/10 23:50:47  tnguyen</span>
<span class="comment-line"># Changes for mariner support</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.2  2003/03/22 01:03:47  avillait</span>
<span class="comment-line"># Chassis and stackable support</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37.2.1  2003/03/06 22:17:48  tnguyen</span>
<span class="comment-line"># Skipping checking release version for exos platform</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.47  2003/04/18 19:31:46  autotest</span>
<span class="comment-line"># Change as taken from br-1-3.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.46.8.1  2003/04/14 19:40:38  autotest</span>
<span class="comment-line"># Fix check for Release master</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.46  2002/12/10 22:49:45  skumar</span>
<span class="comment-line"># Merged from br-1-0.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.45.2.2  2002/12/10 21:09:38  skumar</span>
<span class="comment-line"># Put comments, proc headers.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.45.2.1  2002/12/05 00:38:45  skumar</span>
<span class="comment-line"># Minor change to writing to fast init file.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.45  2002/10/30 19:46:29  eyoung</span>
<span class="comment-line"># Moved setup of numIxiaCd variable after call to SetupIxiaConnections.  This fixes a problem when running tests without an IXIA.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.44  2002/10/29 23:57:04  skumar</span>
<span class="comment-line"># Grant's support for non-ethernet wans.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.42  2002/09/23 19:15:12  skumar</span>
<span class="comment-line"># Add config reboot-loop-prote threshold at systemSetup.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.41  2002/09/16 20:47:27  skumar</span>
<span class="comment-line"># Move cl lo st, cl fd, dis clipa etc outta CheckConnection.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.40  2002/08/26 23:30:53  skumar</span>
<span class="comment-line"># Add dis idletime.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.39  2002/08/08 20:56:45  skumar</span>
<span class="comment-line"># Change call to CheckKeyValue.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.38  2002/07/30 21:36:52  aleu</span>
<span class="comment-line"># add description header for each proc</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.37  2002/07/11 20:45:06  rsrinivasan</span>
<span class="comment-line"># 1] Added support to configure Summit 24e3 Advanced-edge license.</span>
<span class="comment-line"># 2] Added support to verify build info other than Release_Master</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.36  2002/05/06 21:44:07  aleu</span>
<span class="comment-line"># remove usage of all cardSpeed global var</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.35  2002/04/24 21:34:38  aleu</span>
<span class="comment-line"># modify GetNumIxiaCd{} to be based on ports no. card by card (10/100 card type may vary due to TXS8 addition)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.34  2002/04/02 23:07:07  aleu</span>
<span class="comment-line"># give the DUT # in GetDUTPort{}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.33  2002/03/30 02:47:05  skumar</span>
<span class="comment-line"># Put portMappingList in fast file with {}.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.32  2002/03/28 22:40:02  skumar</span>
<span class="comment-line"># Add bladeType into fastInit file in DUTs_info, portMappingList too.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.31  2002/03/28 18:19:42  skumar</span>
<span class="comment-line"># Remove EXTREME_PLATFORM, add fast global var.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.30  2002/01/12 04:04:11  tquach</span>
<span class="comment-line"># Take out xmk</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.29  2001/12/13 01:50:08  eyoung</span>
<span class="comment-line"># Removed extraneous result_debug statement and comments.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.28  2001/12/10 20:40:09  ghundertmark</span>
<span class="comment-line"># Uncomment CheckXMKStatus $DUT to correct errant commit</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.27  2001/12/10 16:38:09  eyoung</span>
<span class="comment-line"># Erase ATMSystemSetup</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.26  2001/11/08 01:24:17  aleu</span>
<span class="comment-line"># add &#34;package require Mpexpr&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.25  2001/04/18 01:10:31  Autotest</span>
<span class="comment-line"># Add godzillla platform</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.24  2001/04/17 23:22:42  skumar</span>
<span class="comment-line"># Disable network port in systemsetup.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.24  2001/04/17 23:22:42  skumar</span>
<span class="comment-line"># Disable network port in systemsetup.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.24  2001/04/17 23:22:42  skumar</span>
<span class="comment-line"># Disable network port in systemsetup.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.23  2001/03/05 22:06:06  skumar</span>
<span class="comment-line"># Add a if construct to avoid tcl break because of undefined</span>
<span class="comment-line"># Variable detectMACList.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.22  2001/03/03 20:09:29  skumar</span>
<span class="comment-line"># Send All arps and then check fdb in &#34;AutoDetect&#34; option in</span>
<span class="comment-line"># PortMappingList.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.21  2001/02/16 16:50:06  skumar</span>
<span class="comment-line"># Put cli to enable full l3 license.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.20  2001/02/12 21:20:46  skumar</span>
<span class="comment-line"># Return valid portId for MapDUTPortId.</span>
<span class="comment-line"># Use GetDUTPort for any other purpose.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.19  2001/01/12 00:37:51  tnguyen</span>
<span class="comment-line"># Add xmk (2nd OS) status check</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.18  2001/01/02 19:47:52  tnguyen</span>
<span class="comment-line"># Add command to clear DUTs log,</span>
<span class="comment-line"># so the logs can be saved in each regression run</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.17  2000/12/15 20:41:40  tnguyen</span>
<span class="comment-line"># Add automatic DUT ports detection</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.16  2000/11/03 23:15:18  tnguyen</span>
<span class="comment-line"># Add feature to detect ports and support different kinds of ixia cards</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.15  2000/10/18 00:56:41  skumar</span>
<span class="comment-line"># Added check for build owner to be &#34;Relase_Master&#34;.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.14  2000/10/12 21:23:08  skumar</span>
<span class="comment-line"># Added &#34;disable clipaging&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.13  2000/09/25 18:17:27  tnguyen</span>
<span class="comment-line"># Add logic to bypass ixia initialization</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.12  2000/09/12 22:52:00  tnguyen</span>
<span class="comment-line"># Add option not to initialize ixia and check connection</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.11  2000/08/10 22:08:13  tnguyen</span>
<span class="comment-line"># Add checking trunking pair on different ports correctly</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.10  2000/08/07 20:43:17  tnguyen</span>
<span class="comment-line"># Change getATrunkPort to GetATrunkPort</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.9  2000/08/04 22:25:33  tnguyen</span>
<span class="comment-line"># Global change of commonly used funtions to conform with new conventions</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.8  2000/08/04 18:16:05  skumar</span>
<span class="comment-line"># Logic change in Trunk check.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.7  2000/08/04 01:14:32  skumar</span>
<span class="comment-line"># Removed erronous &#34;!&#34; in trunkPortList.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.6  2000/08/04 00:58:33  tnguyen</span>
<span class="comment-line"># Not crash if trunkPortList not exist</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.5  2000/08/02 18:08:40  tnguyen</span>
<span class="comment-line"># Fix portMapping for Trunking Port, no need to map</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.4  2000/08/02 17:27:43  tnguyen</span>
<span class="comment-line"># Modify so that TrunkingList should specify blade id also for BD</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.3  2000/07/27 20:59:22  skumar</span>
<span class="comment-line"># Set the default port number to be totalPorts in GetNumIxiaCd.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.2  2000/07/27 19:19:07  tnguyen</span>
<span class="comment-line"># Temporary fix for check trunking problem</span>
<span class="comment-line">#</span>
<span class="comment-line"># Revision 2.1  2000/07/27 01:54:46  tnguyen</span>
<span class="comment-line"># Function to do initialization and check connection setup</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: SystemSetup</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Do ixia initialization, build portMapping, and optionally </span>
<span class="comment-line">#	check connections setup.</span>
<span class="comment-line">#       Performs CheckConnection if CheckConnection is set</span>
<span class="comment-line">#       otherwise basic cli setup on DUTs</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Return value: ConnectionOkay or Connectionbad</span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 SystemSetup</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SystemSetup_651">proc <a href="ePTSystemSetup.tcl-annot.html#::::SystemSetup">::::SystemSetup</a></a></strong> {} {

    <span class="comment-line">################################################################</span>
    set testNo &#34;System Setup&#34;
    set title $testNo
    <span class="comment-line">################################################################</span>

    <span class="comment-line"># ----- Environment variables setup</span>
    global ixiaCh1
    global startCardNum
    global portMappingList
    global trunkPortList
    global checkConnection
    global switchPort2DefaultRouter
    global ixiaPortMappingArray
    global fast
    global RELEASE_MASTER
    global DUTs_info
    global exos
    global DUT
    global env
    global whichDutNow
    <span class="comment-line"># EY-06-08-2007: Added bcmLynx global variable.</span>
    global bcmPlatform bcmLynx;
    global lastDUT
    global numDUT 
    global pioneerPlatform 
    set useNewMethod 1
    
    if ![info exist RELEASE_MASTER] {
	set RELEASE_MASTER Release_Master
    }  
    set fd_res [<a name="::open_result_file(1)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;$testNo&#34;]
    set time1 [clock seconds]
    
    result_h1 &#34;$title&#34;
    <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$title&#34;
    
    <span class="comment-line">#generate mapping info for physical portId connected between DUT</span>
    set portDutListUsed [<a name="::::SetupDUTConnections(1)"><a href="./SystemSetup.tcl.html#::::SetupDUTConnections_780">::::SetupDUTConnections</a></a>]
    
    set firstSubStr &#34;DUT&#34;
    set lastSubStr &#34;_CONNECT&#34;
    for {set i 1} {$i &lt;=$numDUT} {incr i 1} {
	global $firstSubStr$i$lastSubStr
	global $firstSubStr$i${lastSubStr}B ;<span class="comment-line">#global variable for msm-b</span>
	if [info exists $firstSubStr$i$lastSubStr] {
	    lappend DUTList $i
	}
    }
    
    foreach testDUT $DUTList {

    <span class="comment-line">#------ adding this part of script to support eware duts</span>
       global eware_dut
       if {[info exists eware_dut]} {
         if {[lsearch $eware_dut $testDUT] == -1 } {
            set loopVar 1
         } else {
            set loopVar 0
         }
       } else {
         set loopVar 1
       }

      <span class="comment-line">#---- adding the loop for  exos duts</span>
      if {$loopVar} {

	<span class="comment-line"># ----- Switch config </span>
	<a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
        
        <span class="comment-line"># testing tftp connectivity</span>
        set returnFlagTftp [<a name="::tftpTest(1)"><a href="./misc.tcl.html#::tftpTest_4595">::tftpTest</a></a>]
        if {$returnFlagTftp == &#34;ok&#34;} {
          <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;tftp server connectivity test passed&#34;
        } else {
          <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;tftp server connectivity test failed&#34;
        }

	<a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
        
        <span class="comment-line"># Code Added to enable Ctrl+v+x+b reboot</span>
        <a name="::EnableDebugMode(1)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
        <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal configure sysrq 1&#34;
        <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
        <a name="::DisableDebugMode(1)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>

        <span class="comment-line"># set regresession server time</span>
        set tm [exec date &#34;+%m %d %Y %H %M %S&#34;]
        set timeCmd &#34;configure time &#34;
        append timeCmd $tm
        <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> $timeCmd

         <span class="comment-line">#------ check added to skip license if not needed</span>
         set skipLicVar 1
         global skipLicenceCheck
         if [info exists skipLicenceCheck] {
            if {$skipLicenceCheck} {
            set skipLicVar 0
            }
          }
        if $skipLicVar {

        set parameterList &#34;&#34;
        lappend parameterList &#34;{30 days Trial} exist&#34;
        set result [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show license&#34; $parameterList -reportResults 0]
        if {$result == &#34;ok&#34;} {
           <a name="::EnableDebugMode(2)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
           <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug epm clear trial-license&#34;
           <a name="::CheckReboot(1)"><a href="./SendSwCmd.tcl.html#::CheckReboot_1202">::CheckReboot</a></a>
        }
        <a name="::DisableDebugMode(2)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>

	set parameterList &#34;&#34;
        <span class="comment-line"># EY-06-08-2007: Check for L2(edge) license for Lynx platform.</span>
        if {[regexp $bcmLynx $DUTs_info(DUT$testDUT,platform)]} {
            lappend parameterList &#34;L2.* exist&#34;;
        } else {
            lappend parameterList &#34;{core} exist&#34;;
        }
	if {[<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show license&#34; $parameterList]!=&#34;ok&#34;} {
         if {$testDUT == 1} {
            set parameterList &#34;&#34;
            lappend parameterList &#34;{Enabled License Level:} 0 1&#34;
            lappend parameterList &#34;{Enabled License Level:} 1 1&#34;
            set getLicense [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show license&#34; $parameterList]
            if {[lindex [lindex $getLicense 0] 1] != &#34;&#34;} {
              set temp [split [lindex $getLicense 0] &#34; &#34;]
              set currentLicense [concat [lindex $temp 0][lindex $temp 1]]
            } else {
              set temp [split [lindex $getLicense 0] &#34; &#34;]
              set currentLicense [lindex $temp 0]
            }
            if {[<a name="::EnableLicense(1)"><a href="./LicenseMgr.tcl.html#::EnableLicense_23">::EnableLicense</a></a> \
                 [string tolower $currentLicense] core] == &#34;error&#34;} {
	         if {![regexp $pioneerPlatform $DUTs_info(DUT$testDUT,platform)]} {
                     return error
	         }    
            }
           } else {
                if {![regexp $pioneerPlatform $DUTs_info(DUT$testDUT,platform)]} { 
                    return error
                }    
          }
        }
       


	unset parameterList
        }
	
	<a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
	<a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
	<a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable idletime&#34;
	<a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable edp ports all&#34;
	<a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con edp advertisement-interval 15 holddown-interval 60&#34;
         <a name="::EnableDebugMode(3)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
         <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!echo dump_stack &gt; /sys/module/watchdog/parameters/watchdog_warn_behavior&#34;
        if {[regexp -nocase $bcmPlatform $DUTs_info(DUT$testDUT,platform)]} {
           <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear platform system-dump&#34;
        }

	global stackable
	if {[string match &#34;present&#34; $DUTs_info(DUT${testDUT},memoryCard)] &amp;&amp; \
		![regexp -nocase $stackable $DUTs_info(DUT$testDUT,platform)] &amp;&amp; \
		[<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${testDUT}] 11.1.0.21]&gt;=0} {
	    <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure debug core-dumps memorycard&#34;
	} elseif {[<a name="::CompareRelease(2)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${testDUT}] 11.1.0.21]&gt;=0} {
	    <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure debug core-dumps internal-memory&#34;
	}
        if {[info exists DUTs_info(current_module)]} {
	    <a name="::::CheckForPreviousCore(1)"><a href="./SystemSetup.tcl.html#::::CheckForPreviousCore_1127">::::CheckForPreviousCore</a></a> $testDUT
            if {[info exists $firstSubStr$testDUT${lastSubStr}B]} {
               <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Renaming core on msm-b if any&#34;
               <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT${lastSubStr}B] -masterCheck 0 -CheckOperational 0
	       <a name="::::CheckForPreviousCore(2)"><a href="./SystemSetup.tcl.html#::::CheckForPreviousCore_1127">::::CheckForPreviousCore</a></a> $testDUT backup
               <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT${lastSubStr}] -masterCheck 0 -CheckOperational 0
            }
        }
    }
	<span class="comment-line">#Don't check for mariner now </span>
        if { [<a name="::::isExosPlatform(1)"><a href="./SystemSetup.tcl.html#::::isExosPlatform_970">::::isExosPlatform</a></a> &#34;DUT$testDUT&#34;] != 1 } {
           <span class="comment-line"># ----- Switch config</span>
           <a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
           <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
           <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear fdb&#34;
           <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
           <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable idletime&#34;
           <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure reboot-loop-protection threshold 10 3&#34;
           <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable edp ports all&#34;
         <a name="::EnableDebugMode(4)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
         <a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!echo dump_stack &gt; /sys/module/watchdog/parameters/watchdog_warn_behavior&#34;

            <span class="comment-line">#    SendACmd &#34;configure reboot-loop-protection threshold 10 3&#34;</span>

            lappend parameterList &#34;{Image *:.*by} $RELEASE_MASTER&#34;
            <a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show version&#34; $parameterList -comment &#34;- Show $RELEASE_MASTER&#34;
            unset parameterList

            set version [<a name="::GetVersion(3)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> &#34;DUT$testDUT&#34; &#34;2&#34;]
            puts &#34;DUT$testDUT version: $version&#34;
            if {($version &gt;= 6.2) &amp;&amp; ([regexp -nocase &#34;godzilla&#34; [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>]] != 1) } {
                <span class="comment-line">##  CheckXMKStatus $testDUT</span>
            }

            lappend licenseKey &#34;{License:} 1&#34;
            set licenseVal [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show sw&#34; $licenseKey]
            if [regexp -nocase &#34;summit24e3&#34; $DUTs_info(DUT${testDUT},platform)] {
                if ![regexp -nocase &#34;advanced edge&#34; $licenseVal] {
                    <a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license advanced-edge 7656871&#34;
                }
            } elseif ![regexp -nocase &#34;full l3&#34; $licenseVal] {
                <span class="comment-line"># Enable full l3 license</span>
                <a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license fullL3 7656871&#34;
            }

            unset licenseKey
            unset licenseVal

    }

}
<span class="comment-line">#   puts &#34;----------------------- 10 -------------------------&#34; </span>
    <span class="comment-line">#Connect to ixia and setup connections</span>
    if { [<a name="::::SetupIxiaConnections(1)"><a href="./SystemSetup.tcl.html#::::SetupIxiaConnections_663">::::SetupIxiaConnections</a></a>] == &#34;connectionBad&#34; } {
<span class="comment-line">#   puts &#34;----------------------- 11 -------------------------&#34; </span>
	return connectionBad
    }
<span class="comment-line">#   puts &#34;----------------------- 12 -------------------------&#34; </span>
    
    <span class="comment-line"># Not initializing ixia or check connection</span>
    if {([info exists checkConnection] == 1) &amp;&amp; $checkConnection == &#34;NO_IXIA&#34; } {
	
	<a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Skipping ixia initialization and check connection&#34;
	
	<span class="comment-line">################################################</span>
	<span class="comment-line"># Clean up</span>
	<span class="comment-line">################################################</span>
	set time2 [clock seconds]
	result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
	<a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
	<a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
	return &#34;connectionOkay&#34;
    }
    
    
    <span class="comment-line"># ----- Test variables setup</span>
    set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a>]
    if {$numIxiaCd == 0} {
	<a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No ixia card found to be initialized&#34;
	return &#34;connectionBad&#34;
    }
    
    <span class="comment-line"># Check if desired to proceed</span>
    if {([info exists checkConnection] == 1) &amp;&amp; $checkConnection == 0} {
	foreach dut $DUTList {
	    <span class="comment-line"># ----- Switch config </span>
	    <a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$dut$lastSubStr]
	    <a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
	    <a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
         <a name="::EnableDebugMode(5)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
         <a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!echo dump_stack &gt; /sys/module/watchdog/parameters/watchdog_warn_behavior&#34;
            if {[regexp -nocase $bcmPlatform $DUTs_info(DUT$dut,platform)]} {
               <a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear platform system-dump&#34;
            }

        }
	<span class="comment-line">################################################</span>
	<span class="comment-line"># Clean up</span>
	<span class="comment-line">################################################</span>
	set time2 [clock seconds]
	result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
	<a name="::close_result_file(2)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
	<a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
	return &#34;connectionOkay&#34;
    }
    
    set returnVal &#34;connectionOkay&#34;
    set lastDUT 0
    foreach testDUT $DUTList {
	
	set thisDutPorts &#34;&#34;
	foreach portDutPair $portDutListUsed {
	    if {[lindex $portDutPair 1] == $testDUT} {
		lappend thisDutPorts [lindex $portDutPair 0]
	    }
	}
	
	<a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
        <span class="comment-line"># Added By nellinivasu; to overcome ports still part of default vlan.</span>
        <a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan default delete ports all&#34;
	<span class="comment-line"># Next two lines required temporarily for &#34;debug hal show compact-flash&#34;</span>
	<span class="comment-line">#logout</span>
	<span class="comment-line">#Login  [expr $$firstSubStr$testDUT$lastSubStr]</span>
	set tagId [<a name="::random(1)"><a href="./mysqlLib.tcl.html#::random_1092">::random</a></a> 4094]
	if {$tagId==1||$tagId==0} {set tagId 2}
	<a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan ixiaVlan&#34;
        set output  [<a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;]          
        <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;output :: $output&#34;
        if {[regexp -nocase &#34;Error&#34; $output]} {                
           set tagId 3
           <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;
        }

	<a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port all tag&#34;
	
	<a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5

	<span class="comment-line">#result_debug &#34;Ports checked for $testDUT DUT are $thisDutPorts&#34;</span>
	foreach portId $thisDutPorts {
	    set frameSent [<a name="::SendFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $portId -tag $tagId -frameSize 68 -frameRate 100 -streamType &#34;contPacket&#34;]
<span class="comment-line">#	    set frameSent [SendFrame -txPortId $portId -tag $tagId -frameSize 68]</span>
<span class="comment-line">#puts &#34;------------------------c-1 ----- frameSent -- $frameSent&#34; </span>
	    set sourceMac [<a name="::GetSourceMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameSent]
<span class="comment-line">#puts &#34; ------------ c-2 ---- sourceMac -------- $sourceMac&#34;</span>
	    set sourceMacFdb($portId) [<a name="::IxiaMacFormat2FdbFormat(1)"><a href="./misc.tcl.html#::IxiaMacFormat2FdbFormat_92">::IxiaMacFormat2FdbFormat</a></a> $sourceMac]
	    <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FdbMac for port $portId: Source:|$sourceMacFdb($portId)| Dest:|[<a name="::GetDestMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetDestMacAddress_19">::GetDestMacAddress</a></a> $frameSent]|&#34;
            <span class="comment-line">#LK commented below 2 second sleeep and StopPortsTransmit will be done after checkConnection is verified</span>
            <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
           <a name="::StopPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $portId
	}
        <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 20
	foreach portId $thisDutPorts {
	    if { [regexp -nocase &#34;a&#34; [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $testDUT] ] } {
		lappend detectMACList &#34;{$sourceMacFdb($portId) .*ixiaVlan.* d.*m} 1&#34;
	    } else {
		lappend checkMACList &#34;$sourceMacFdb($portId) ixiaVlan [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $testDUT] exist&#34;
	    }
	}
<span class="comment-line">#puts &#34;----------------- c0 ---- detectMACList ---- $detectMACList&#34;</span>
	if {[info exists detectMACList]} {
	    set DUTPortList [<a name="::GetKeyValue(3)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show fdb&#34; $detectMACList]
	}
	
	foreach portId $thisDutPorts {
	    if { [regexp -nocase &#34;a&#34; [<a name="::MapDUTPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $testDUT] ] } {
		set portIndex [lsearch -regexp $detectMACList &#34;$sourceMacFdb($portId) .*ixiaVlan.* d.*m&#34;]
		<span class="comment-line">#result_debug &#34;Auto detecting portId: $portId DUTPort: [lindex $DUTPortList $portIndex]&#34;</span>
		set replaceIndex [lsearch -regexp $portMappingList &#34;$portId *A * $testDUT&#34;]

<span class="comment-line">#puts &#34;------------------- c1 replaceIndex --- $replaceIndex&#34;</span>
		if {$replaceIndex != -1} {
<span class="comment-line">#puts &#34; ------- c2 portMappingList --------- $portMappingList&#34;</span>
<span class="comment-line">#puts &#34; -------- c3 portId  ---- $portId&#34;</span>
<span class="comment-line">#puts &#34;---------- c4 DUTPortList ---- $DUTPortList&#34;</span>
<span class="comment-line">#puts &#34;-------- c5 portIndex -------- $portIndex&#34;</span>
<span class="comment-line">#puts &#34;---------- c6 testDUT --------- $testDUT&#34;</span>
		    set portMappingList [lreplace $portMappingList $replaceIndex $replaceIndex &#34;$portId [lindex $DUTPortList $portIndex] $testDUT&#34;]
		}
	    }
	}
	<a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;portMappingList: $portMappingList&#34;
	
	if {([info exists checkMACList] == 1)} {
	    <span class="comment-line">################################################</span>
	    set subTest &#34;Checking DUT$testDUT Connections via MAC fdb Learning&#34;
	    <span class="comment-line">################################################</span>
	    result_h2 &#34;$subTest&#34;
	    <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
	    set returnFlag [<a name="::CheckFdb(1)"><a href="./fdb.tcl.html#::CheckFdb_690">::CheckFdb</a></a> $checkMACList $fd_res $testNo]
	    unset checkMACList
	    <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
	} else {
	    set returnFlag &#34;ok&#34;
	}
	
	<span class="comment-line">################################################</span>
	set subTest &#34;Detecting DUT$testDUT Connections via MAC fdb Learning&#34;
	<span class="comment-line">################################################</span>
	result_h2 &#34;$subTest&#34;
	<a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
	<a name="::::SetupDUTConnections(2)"><a href="./SystemSetup.tcl.html#::::SetupDUTConnections_780">::::SetupDUTConnections</a></a>
	set dutSpecificPortMappingList &#34;&#34;
	foreach el $portMappingList {
	    if {[lindex $el 2]==$testDUT} {
		lappend dutSpecificPortMappingList $el
	    }
	}
	if {[regexp &#34;NOT&#34; $dutSpecificPortMappingList] } {
	    set returnFlag &#34;error&#34;
	    <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Unable to detect one or more connections on DUT$testDUT&#34;
	    <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Please recheck all links&#34;
	}
<span class="comment-line">#	foreach portId $thisDutPorts {</span>
<span class="comment-line">#            StopPortsTransmit $portId</span>
<span class="comment-line">#	}</span>
	<a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan ixiaVlan&#34;
	<a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

	<span class="comment-line">#EDP check whether it's working or not</span>
	set dut [expr $$firstSubStr$testDUT$lastSubStr]
	if {$useNewMethod==1} {
	    set dutEdpInfo($dut) [<a name="::::isEdpWorking(1)"><a href="./SystemSetup.tcl.html#::::isEdpWorking_986">::::isEdpWorking</a></a> $dut $DUTList]
	   	
	    if {$dutEdpInfo($dut)==0} {
		set returnVal &#34;connectionBad&#34;
	    } elseif {$dutEdpInfo($dut)==-1} {
		set useNewMethod 0
	    } 
}
	
        if { ($returnFlag != &#34;ok&#34;) || ($returnFlagTftp != &#34;ok&#34;) } {
	    set returnVal &#34;connectionBad&#34;
	}
    }
    if {[info exist fast] &amp;&amp; ($fast != &#34;NULL&#34;)} {
	puts $fast &#34;set portMappingList \{$portMappingList\}&#34;
    }
    
    <span class="comment-line"># In case EDP did not work at all</span>
    if {$useNewMethod==0} {
	<a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Using the old Ixia traffic based trunk port validation...&#34;
	puts &#34;|[llength $DUTList]|[info exists trunkPortList]|&#34;
	if {[llength $DUTList] &gt; 1 &amp;&amp; [info exists trunkPortList]} {
	    foreach trunkPair $trunkPortList {
		set firstDUT [lindex $trunkPair 0]
		set secondDUT [lindex $trunkPair 1]
		<span class="comment-line">#trunk port specification, no need to check</span>
		if {$secondDUT == 0 } { continue }
		set portNumber [lindex $trunkPair 2]
		<a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$firstDUT$lastSubStr]
		<a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan ixiaVlan&#34;
		<a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;
		<a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port $portNumber tag&#34;
		
		<span class="comment-line">#now we have to find the corresponding index</span>
		set secondDUTPort &#34;PORT_NOT_FOUND&#34;
		set index 1
		while { [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $firstDUT $secondDUT $index] != &#34;PORT_NOT_FOUND&#34; } {
		    if { [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $firstDUT $secondDUT $index] == $portNumber} {
			set secondDUTPort [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $secondDUT $firstDUT $index]
			break
			
		    }
		    incr index
		}
		<span class="comment-line"># Add support for non ethernet wans</span>
		<span class="comment-line">#Each port added adds { {1 2 1 6:1 F48T} {fSw sSw index port hdWare} }</span>
		unset   DUT(trunk,usageList)
		lappend DUT(trunk,usageList) &#34;$firstDUT $secondDUT $index $portNumber\
			[<a name="::GetSlotNumType(1)"><a href="./misc.tcl.html#::GetSlotNumType_1810">::GetSlotNumType</a></a> $firstDUT $portNumber]&#34;
		lappend DUT(trunk,usageList) &#34;$secondDUT $firstDUT $index $secondDUTPort\
			[<a name="::GetSlotNumType(2)"><a href="./misc.tcl.html#::GetSlotNumType_1810">::GetSlotNumType</a></a> $secondDUT $secondDUTPort]&#34;
		puts &#34;##########################\r&#34;
		puts &#34;trunk $DUT(trunk,usageList) ##############&#34;
		
		<span class="comment-line">#need to get a portId that belongs to the firstDUT</span>
		set ixiaCdPort [lindex [lindex $portMappingList 0] 0]
		foreach port $portMappingList {
		    if {[lindex $port 2] == $firstDUT } {
			set ixiaCdPort [lindex $port 0]
			break
		    }
		}
		<a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port [<a name="::MapDUTPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $ixiaCdPort $firstDUT] tag&#34;
		
		<a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$secondDUT$lastSubStr]
		<a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan ixiaVlan&#34;
		<a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;
		<a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port $secondDUTPort tag&#34;
		
		set frameSent [<a name="::SendFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $ixiaCdPort -tag $tagId -frameSize 68]
		after 300
		set frameSent [<a name="::SendFrame(3)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $ixiaCdPort -tag $tagId -frameSize 68]
		set sourceMac [<a name="::GetSourceMacAddress(2)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameSent]
		set srcMacFdb [<a name="::IxiaMacFormat2FdbFormat(2)"><a href="./misc.tcl.html#::IxiaMacFormat2FdbFormat_92">::IxiaMacFormat2FdbFormat</a></a> $sourceMac]
		<a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FdbMac for port $ixiaCdPort:|$srcMacFdb|[<a name="::GetDestMacAddress(2)"><a href="./MessageDecoding.tcl.html#::GetDestMacAddress_19">::GetDestMacAddress</a></a> $frameSent]|&#34;
		lappend checkMAC &#34;$srcMacFdb ixiaVlan $secondDUTPort exist&#34;
		
		
		<span class="comment-line">################################################</span>
		set subTest &#34;Checking Trunking #$index between DUT$firstDUT and DUT$secondDUT via MAC fdb Learning&#34;
		<span class="comment-line">################################################</span>
		result_h2 &#34;$subTest&#34;
		<a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
		
		set returnFlag [<a name="::CheckFdb(2)"><a href="./fdb.tcl.html#::CheckFdb_690">::CheckFdb</a></a> $checkMAC $fd_res $testNo]
		unset checkMAC
		<a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
		
		if { $returnFlag != &#34;ok&#34; } {
		    set returnVal &#34;connectionBad&#34;
		}
		<span class="comment-line">#have to remove this trunk port, otherwise might cause flooding if there is a loop</span>
		<a name="::AlienWanClean(1)"><a href="./misc.tcl.html#::AlienWanClean_2047">::AlienWanClean</a></a>
		<a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$firstDUT$lastSubStr]
		<a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ixiaVlan&#34;
		
		<a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$secondDUT$lastSubStr]
		<a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ixiaVlan&#34;
	    }
	    
	}
    }
    
    <span class="comment-line">################################################</span>
    <span class="comment-line"># Clean up</span>
    <span class="comment-line">################################################</span>
    foreach testDUT $DUTList {
	<a name="::Login(12)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
        global eware_dut
            if {[info exists eware_dut]} {
               if {[lsearch $eware_dut $testDUT] == -1 } {
                  <a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp ports all&#34;
                  <a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con edp advertisement-interval 60 holddown-interval 180&#34;
               } else {
                  <a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp ports all&#34;
               }
           } else {
                  <a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp ports all&#34;
                  <a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con edp advertisement-interval 60 holddown-interval 180&#34;
           }
           <span class="comment-line">#_verifyCFCorruptionStatusOnLogin</span>

    }
    <span class="comment-line"># Gather portID info (generation platform speed etc) on a portid basis</span>
    if {$returnFlag == &#34;ok&#34;} {
        <span class="comment-line">#GetPortIdInfoStd 1</span>
    }
set numPortIdNeeded [<a name="::::GetHighestPortId(1)"><a href="./SystemSetup.tcl.html#::::GetHighestPortId_580">::::GetHighestPortId</a></a>]
<span class="comment-line"># adding check for ixia to hub connection</span>
set hubConnectionStatus &#34;ok&#34;
<span class="comment-line">#commenting the code for time beeing need to work on it</span>
if { 0 } {
if {[llength $DUTList] &gt; 1 &amp;&amp; ($numDUT == 5 ) &amp;&amp; [info exists trunkPortList] &amp;&amp; ($numPortIdNeeded &gt;= 11)} {
       set tagId 99
       set portId 9
       foreach testDUT $DUTList {
                <a name="::Login(13)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
	<a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan ixiaVlan&#34;
	<a name="::SendACmd(47)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;
	<a name="::SendACmd(48)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port all tag&#34;
        }
       set frameSent [<a name="::SendFrame(4)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $portId -tag $tagId -frameSize 68 -streamType &#34;contPacket&#34;]
       <a name="::exSleep(5)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5 
       set sourceMac [<a name="::GetSourceMacAddress(3)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameSent]
       set sourceMacFdb($portId) [<a name="::IxiaMacFormat2FdbFormat(3)"><a href="./misc.tcl.html#::IxiaMacFormat2FdbFormat_92">::IxiaMacFormat2FdbFormat</a></a> $sourceMac]
       <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FdbMac for port $portId: Source:|$sourceMacFdb($portId)| Dest:|[<a name="::GetDestMacAddress(3)"><a href="./MessageDecoding.tcl.html#::GetDestMacAddress_19">::GetDestMacAddress</a></a> $frameSent]|&#34;	
       <a name="::StopPortsTransmit(2)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $portId
       <a name="::exSleep(6)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
        foreach testDUT $DUTList {
	    foreach trunkPair $trunkPortList {
		set firstDUT [lindex $trunkPair 0]
		set secondDUT [lindex $trunkPair 1]
		set portNumber [lindex $trunkPair 2]
		if {($secondDUT == 0 ) &amp;&amp; ($firstDUT == $testDUT) } {
                  set detectMACList &#34;&#34; 
	         lappend detectMACList &#34;{$sourceMacFdb($portId) .*ixiaVlan.* d.*m} exist&#34;
                <a name="::Login(14)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
                set returnFlag [<a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show fdb&#34; $detectMACList -time {s: 1 i: 5 d: 20 f: 20 r} -comment &#34;check ixia to DUT connection through hub between Ixia and DUT $testDUT&#34; ]
		<a name="::SendACmd(49)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ixiaVlan&#34;
                if { $returnFlag != &#34;ok&#34; } {
                    set hubConnectionStatus &#34;connectionBad&#34;
                }
                break
               }
             }
          }
    }
}
    

    set time2 [clock seconds]
    result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
    <a name="::close_result_file(3)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
    <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    if {$hubConnectionStatus == &#34;connectionBad&#34;} {
      set returnVal &#34;connectionBad&#34;
    }
    if {$returnVal == &#34;connectionBad&#34;} {
	<a name="::dumpAllSwitchInfo(1)"><a href="./cleanup.tcl.html#::dumpAllSwitchInfo_696">::dumpAllSwitchInfo</a></a>;
    }
    return $returnVal
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetNumIxiaCd</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Get the number of ixia cards in testbed by a given total </span>
<span class="comment-line">#	number of ports</span>
<span class="comment-line"># Input args: {totalPorts} </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: integer</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 set numIxiaCd [GetNumIxiaCd $maxPorts]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetNumIxiaCd_1238">proc <a href="ePTSystemSetup.tcl-annot.html#::::GetNumIxiaCd">::::GetNumIxiaCd</a></a></strong> { {totalPorts 0} } {
    global portMappingList
    global startCardNum
    
    <span class="comment-line"># get the last ixia port number from cfg port list, if no port is specified</span>
    if {$totalPorts == 0 } {
	set totalPorts [lindex [lindex $portMappingList [expr [llength $portMappingList] -1 ]] 0]
    }
    
    set result 1
    set cardNum $startCardNum
    set numPortPerCd [<a name="::findNumPortPerIxiaCard(1)"><a href="./ePTMisc.tcl.html#::findNumPortPerIxiaCard_388">::findNumPortPerIxiaCard</a></a> $cardNum]
    while { $totalPorts &gt; $numPortPerCd } {
	incr result
	set totalPorts [expr $totalPorts - $numPortPerCd]
if {0} {
	if {![<a name="::card(1)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> get 1 [expr $cardNum+1]]} {
	    incr cardNum
	}
}
	set numPortPerCd [<a name="::findNumPortPerIxiaCard(2)"><a href="./ePTMisc.tcl.html#::findNumPortPerIxiaCard_388">::findNumPortPerIxiaCard</a></a> $cardNum]
    }
    return $result
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetHighestPortId</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Get the highest ixia portId based on portMappingList </span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: integer</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 set numPortIdNeeded [GetHighestPortId]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetHighestPortId_1274">proc <a href="ePTSystemSetup.tcl-annot.html#::::GetHighestPortId">::::GetHighestPortId</a></a></strong> { } {
    global portMappingList
    set maxPortId 0
    foreach portList $portMappingList {
	set portId [lindex $portList  0]
	if {$portId &gt; $maxPortId} {set maxPortId $portId}
    }
    return $maxPortId
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetATrunkPort</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Return the index-th port number on firstSw that links to secondSw.</span>
<span class="comment-line"># Input args: firstSw secondSw {index} </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: integer or a : separated integer set</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	  SendACmd  &#34;conf ebgp add port [GetATrunkPort 1 3]&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetATrunkPort_1295">proc <a href="ePTSystemSetup.tcl-annot.html#::::GetATrunkPort">::::GetATrunkPort</a></a></strong> {firstSw secondSw {index 1} } {
    global DUT
    global DUTs_info
    
    set portList [<a name="::::GetTrunkPortList(1)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a> $firstSw $secondSw]
    <span class="comment-line">#use the first switch id to get the default blade</span>
    if {$index &gt; [llength $portList]} { return &#34;PORT_NOT_FOUND&#34; }
    if {$index &lt; 1} { return &#34;PORT_NOT_FOUND&#34; }
    <span class="comment-line"># add support for non ethernet wan ports</span>
    <span class="comment-line">#Each port added adds { {1 2 1 6:1 F48T} {fSw sSw index port hdWare} }</span>
    set tempList [<a name="::::GetTrunkPortList(2)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a> $secondSw $firstSw]
    if {[info exists DUTs_info(debugFlag)]} {
	if {$DUTs_info(debugFlag)==1} {
	    <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT$firstSw [lindex $portList [expr $index -1]] goes to DUT$secondSw [lindex $tempList [expr $index -1]]&#34;
	}
    }
    lappend DUT(trunk,usageList) &#34;$firstSw $secondSw $index [lindex $portList [expr $index -1]] \
	    [<a name="::GetSlotNumType(3)"><a href="./misc.tcl.html#::GetSlotNumType_1810">::GetSlotNumType</a></a> $firstSw [lindex $portList [expr $index -1]]]&#34;
    return [lindex $portList [expr $index -1]]
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetTrunkPortList</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Return the list of all trunk port numbers on firstSw that link to secondSw.</span>
<span class="comment-line"># Input args: firstSw secondSw </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: list of integers or list of : separated integer set</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	  set portList [GetTrunkPortList $firstSw $secondSw]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetTrunkPortList_1327">proc <a href="ePTSystemSetup.tcl-annot.html#::::GetTrunkPortList">::::GetTrunkPortList</a></a></strong> {firstSw secondSw} {
    global trunkPortList
    
    set returnList &#34;&#34;
    if {![info exists trunkPortList]} {
	return $returnList
    }
    
    foreach s2sConnectPair $trunkPortList {
	if {[lindex $s2sConnectPair 0] == $firstSw &amp;&amp; \
		[lindex $s2sConnectPair 1] == $secondSw} {
	    lappend returnList [lindex $s2sConnectPair 2]
	}
    }
    
    return $returnList
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: SetupIxiaConnections</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Check number of ixia ports, build ixiaPortMappingArray, and </span>
<span class="comment-line">#	initialize each port.</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: connectionBad in failure</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 SetupIxiaConnections</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupIxiaConnections_1357">proc <a href="ePTSystemSetup.tcl-annot.html#::::SetupIxiaConnections">::::SetupIxiaConnections</a></a></strong> {} {
    global ixiaCh1
    global startCardNum
    global startPortNum
    global ixiaMappingList
    global ixiaPortMappingArray
    global portMappingList
    global fast
    global ixiaNoReset
    
    if { ![info exist startCardNum] } {
	<a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;startCardNum not defined &#34;
	return -1
    }
    if { [llength [split $startCardNum :]] == 2 }  {
	set startPortNum [lindex [split $startCardNum :] 1]
	set startCardNum [lindex [split $startCardNum :] 0]
	if { ($startPortNum &lt; 1) || ($startCardNum &lt; 1) } {
	    <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;startCardNum not defined properly $startCardNum&#34;
	    return -1
	}
    } elseif { [llength [split $startCardNum :]] == 1 }  {
	if { ![info exist startPortNum] } {
	    <span class="comment-line"># If dot1x is running, this will not be called,</span>
	    <span class="comment-line"># otherwise set default startPortNum to be 1</span>
	    set startPortNum 1
	}
    } else {
	<a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;startCardNum not defined properly $startCardNum&#34;
	return -1
    } 
    
    
    <span class="comment-line"># ----- Ixia initialization</span>
    <span class="comment-line">#package require IxTclHal</span>
    package require Mpexpr
    <span class="comment-line">#clean up any previous mess</span>
    <span class="comment-line">#cleanUp</span>
    <a name="::ixInitialize(1)"><a href="./mapping.tcl.html#::ixInitialize_55">::ixInitialize</a></a> $ixiaCh1
    <span class="comment-line">#set chid1 [getChassisID $ixiaCh1]</span>
    set chid1 1
    set numPortIdNeeded [<a name="::::GetHighestPortId(2)"><a href="./SystemSetup.tcl.html#::::GetHighestPortId_580">::::GetHighestPortId</a></a>]
    set numPortIdFound 0
    set portIdList &#34;&#34;
    foreach item $portMappingList {
	lappend portIdList [lindex $item 0]
        if {($numPortIdNeeded &gt;= 11) &amp;&amp; ([lindex $item 0] == 8)} {
	   lappend portIdList 9
        }
    }
    <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Total ports needed: $numPortIdNeeded&#34;
    if {([info exists ixiaMappingList] == 0) || [regexp -nocase &#34;AUTO&#34; $ixiaMappingList] } {
	<a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Auto detecting connections startCard:$startCardNum startPort:$startPortNum&#34;
	for {set card $startCardNum } {$card &lt;= 16 } {incr card } {
	    <span class="comment-line">#if {[card get 1 $card]!=0} {continue}  ;# only go on if card is correct, 10G fails w/o it</span>
<span class="comment-line">#    set portCount [card cget -portCount]</span>
<span class="comment-line">#           set portCount 26</span>
           set portCount 19
	    <span class="comment-line">#   puts &#34;cardType: [card cget -type]&#34;</span>
	    set skipFlag 0
	    for {set port $startPortNum } {$port &lt;= $portCount} {incr port} {
		incr numPortIdFound
		<span class="comment-line">#      puts &#34;numPortIdFound: $numPortIdFound $card $port&#34;</span>
		if {[lsearch -exact $portIdList $numPortIdFound]!=-1} {
		    set skipFlag 1
		    set ixiaPortMappingArray($numPortIdFound) &#34;1 $card $port&#34;
		    <span class="comment-line">#RTP-SQA added for fast init</span>

		    if {[info exist fast] &amp;&amp; ($fast != &#34;NULL&#34;)} {
			puts $fast &#34;set ixiaPortMappingArray($numPortIdFound) \&#34;1 $card $port\&#34;&#34;
		    }
		} elseif {$numPortIdFound&lt;=$numPortIdNeeded} {
		    set port [expr $port-1]
		}
	    }
	    
	    if {$skipFlag==0} {
		set card [expr $card-1]
	    } else {
		set startPortNum 1
	    }
	    
	    if {$numPortIdFound &gt;= $numPortIdNeeded} { break }
	}
	if {$numPortIdFound &lt; $numPortIdNeeded } {
	    <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Not enough connections detected&#34;
	    <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wanted $numPortIdNeeded but only got $numPortIdFound&#34;
	    return &#34;connectionBad&#34;
	}
    } else {
	<a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Using user-defined connection pattern&#34;
	<a name="::GenerateIxiaPortMapping(1)"><a href="./ePTPortMapping.tcl.html#::GenerateIxiaPortMapping_268">::GenerateIxiaPortMapping</a></a>
    }
    <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;================Ixia port mapping===================&#34;
    <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;            portId       \[ChasisId, Card, Port\]&#34;
    for {set portId 1 } {$portId &lt;= $numPortIdNeeded } { incr portId } {
	if {[lsearch -exact $portIdList $portId]!=-1} {
	    set rxPort [<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port]
	    <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;              $portId      -&gt;            \[$chas, $card, $port\]&#34;
	}
    }
    if {![info exists ixiaNoReset]} {
        <a name="::IxiaPortsInit(1)"><a href="./ePTTx.tcl.html#::IxiaPortsInit_331">::IxiaPortsInit</a></a>
    }
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: SetupDUTConnections</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Generate mapping info for physical portId connection between </span>
<span class="comment-line">#	DUT and Ixia.</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: list of portId-&gt;DUTPort integers</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 SetupDUTConnections</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupDUTConnections_1475">proc <a href="ePTSystemSetup.tcl-annot.html#::::SetupDUTConnections">::::SetupDUTConnections</a></a></strong> {} {
    global portMappingList
    
    <span class="comment-line">#generate mapping info for physical portId connected between DUT and Ixia</span>
    <a name="::GenerateDUTPortMapping(1)"><a href="./ePTPortMapping.tcl.html#::GenerateDUTPortMapping_217">::GenerateDUTPortMapping</a></a>
    <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;================DUT port mapping===================&#34;
    <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;            portId           DUTPort&#34;
    
    foreach port $portMappingList {
	set portNum [lindex $port 0]
	set dutNum [lindex $port 2]
	if {$dutNum == &#34;&#34; } {set dutNum 1}
	lappend portListUsed $portNum
	lappend portDutListUsed &#34;$portNum $dutNum&#34;
	
	set DUTPort [<a name="::MapDUTPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portNum $dutNum]
	<a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;              $portNum      -&gt;        $DUTPort on DUT$dutNum&#34;
    }
    <span class="comment-line">#also need to see how it maps port range</span>
    <span class="comment-line">#result_debug &#34;              1-22,23      -&gt;    [MapDUTPortId 1-22,23]&#34;</span>
    <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;&#34;
    
    return $portDutListUsed
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: CheckXMKStatus</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function checks and reports for 2nd OS running on dual </span>
<span class="comment-line">#	cpu with 256MB or more</span>
<span class="comment-line"># Input args: dut </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: None</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 CheckXMKStatus $dutNo</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckXMKStatus_1512">proc <a href="ePTSystemSetup.tcl-annot.html#::::CheckXMKStatus">::::CheckXMKStatus</a></a></strong> {dut} {

    lappend parameterList &#34;{Total DRAM Size:} 1&#34;
    set memory [<a name="::GetKeyValue(4)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show memory&#34; $parameterList]
    puts &#34;memory: $memory&#34;
    
    <a name="::SendACmd(50)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show switch&#34;
    <a name="::SendACmd(51)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;nofeep&#34;
    
    set flag [<a name="::::CheckXMK(1)"><a href="./SystemSetup.tcl.html#::::CheckXMK_874">::::CheckXMK</a></a>]
    puts &#34;Flag: $flag&#34;
    set dualCPU 1
    switch -- [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> &#34;DUT$dut&#34;] {
	Summit48i -
	Summit24i {
	    set dualCPU &#34;0&#34;     		   
	} 
    }
    if {$dualCPU } {
	<a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking 2nd OS (xmk) status on 2nd CPU&#34;
	if {$memory &gt;= 256 } {
	    if {$flag == &#34;xmk&#34;} {
		<a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;2nd OS is running on 2nd CPU&#34;
	    } else {
		<a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;2nd OS is not running on 2nd CPU&#34;
	    }
	} else {
	    if {$flag == &#34;xmk&#34;} {
		<a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;2nd OS is running on 2nd CPU, but should not&#34;
	    } else {
		<a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;2nd OS is not running on 2nd CPU&#34;
	    }      
	}
	<a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    } else {
	<a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking for no 2nd OS (xmk) on single CPU&#34;
	if {$flag == &#34;xmk&#34;} {
	    <a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;2nd OS is running on, but should not&#34;
	} else {
	    <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;2nd OS is not running&#34;
	}      
	<a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>    
    }
    <a name="::SendACmd(52)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;shswitch&#34;
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: CheckXMK</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function checks if 2nd OS is running on 2nd CPU by nofeep</span>
<span class="comment-line">#	command &#34;xmk&#34;.</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: verybadifgethere if failure</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 set flag [CheckXMK]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckXMK_1570">proc <a href="ePTSystemSetup.tcl-annot.html#::::CheckXMK">::::CheckXMK</a></a></strong> {} {

    send &#34;xmk\r&#34;
    expect {
	timeout {
	    return &#34;TIMEOUT&#34;
	}
	&#34;2\\-&gt; &#34; {
	    send &#34;vx\r&#34;
	    return &#34;xmk&#34;
	}
	&#34;\\-&gt; &#34; {
	    return &#34;noxmk&#34;
	}
    }
    return &#34;verybadifgethere&#34;
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: AddTestbedInfoToDUTs_info</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function appends test bed specific information to DUTs_info array</span>
<span class="comment-line">#        </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 AddTestbedInfoToDUTs_info</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::AddTestbedInfoToDUTs_info_1601">proc <a href="ePTSystemSetup.tcl-annot.html#::::AddTestbedInfoToDUTs_info">::::AddTestbedInfoToDUTs_info</a></a></strong> {} {
   
    global ixiaCh1 defaultRouter tftpServerList startCardNum switchPort2DefaultRouter \
	    POWERCYCLE_IP POWERCYCLE_PORTS tftpShareName portMappingList trunkPortList \
	    checkConnection connectionTimeout
    global numDUT DUTs_info
puts &#34;------------- 4 ---------- numDUT --------------- $numDUT&#34;    
    if {[info exists ixiaCh1]} {
	set DUTs_info(ixiaip) $ixiaCh1   
    }
    if {[info exists tftpServerList]} {
	set DUTs_info(tftpserverlist) $tftpServerList   
    }
    if {[info exists defaultRouter]} {
	set DUTs_info(defaultRouter) $defaultRouter
    }
    if {[info exists POWERCYCLE_IP]} {
	set DUTs_info(powercycle_ip) $POWERCYCLE_IP
    }
    if {[info exists POWERCYCLE_PORTS]} {
	set DUTs_info(powercycle_ports) $POWERCYCLE_PORTS
    }
    if {[info exists tftpShareName]} {
	set DUTs_info(tftpsharename) $tftpShareName
    }
    if {[info exists startCardNum]} {
	set DUTs_info(startcardnum) $startCardNum
    }
    if {[info exists portMappingList]} {
	set DUTs_info(portmappinglist) $portMappingList
    }
    if {[info exists trunkPortList]} {
	set DUTs_info(trunkportlist) $trunkPortList
    }
    if {[info exists switchPort2DefaultRouter]} {
	set DUTs_info(switchport2defaultrouter) $switchPort2DefaultRouter
    }
    if {[info exists checkConnection]} {
	set DUTs_info(checkconnection) $checkConnection
    }
    if {[info exists connectionTimeout]} {
	set DUTs_info(connectiontimeout) $connectionTimeout
    }
    
    for {set i 1} {$i &lt;= $numDUT} {incr i 1} {
	global DUT${i}_CONNECT
	global DUT${i}_IP
	global DUT${i}_DefaultBlade
	global DUT${i}_SETUP
	set DUTs_info(DUT$i,connect) [set DUT${i}_CONNECT]
	set DUTs_info(DUT$i,ip) [set DUT${i}_IP]
	set DUTs_info(DUT$i,defaultblade) [set DUT${i}_DefaultBlade]
	set DUTs_info(DUT$i,setup) [set DUT${i}_SETUP]
    }

puts &#34;---------------  5 ------------------------&#34;
    <span class="comment-line"># Gather information about the slots / platform and assign to portIds</span>
    <span class="comment-line">#   The portId info comes from SystemSetup, so this must be run first</span>
    <a name="::::GetPortIdInfoStd(1)"><a href="./swConf.tcl.html#::::GetPortIdInfoStd_1938">::::GetPortIdInfoStd</a></a> 
puts &#34;---------------  6 ------------------------&#34;
}


<strong><a name="::::isExosPlatform_1664">proc <a href="ePTSystemSetup.tcl-annot.html#::::isExosPlatform">::::isExosPlatform</a></a></strong> { DUT } {
    global DUTs_info
    global supportedPlatform i386Platform
    
    <span class="comment-line">#    if {$DUTs_info($DUT,platform)==&#34;BD-Mariner&#34;||$DUTs_info($DUT,platform)==&#34;BD-10808&#34;||$DUTs_info($DUT,platform)==&#34;BD-PC&#34;||$DUTs_info($DUT,platform)==&#34;Summit-PC&#34;||$DUTs_info($DUT,platform)==&#34;Aspen&#34;} </span>
    <span class="comment-line"># SK: Removed above line as we need liberal regexp than hard equate</span>
    if {[regexp -nocase &#34;$supportedPlatform|$i386Platform&#34; $DUTs_info($DUT,platform)] || \
        [regexp -nocase &#34;$supportedPlatform|$i386Platform&#34; $DUTs_info($DUT,sysType)]} {
        return 1
    } else {
        <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-------------------------\n$DUTs_info($DUT,sysType) OR $DUTs_info($DUT,platform) NOT EXOS platform\n---------
----------------&#34;
        return 0
    }
}

<strong><a name="::::isEdpWorking_1680">proc <a href="ePTSystemSetup.tcl-annot.html#::::isEdpWorking">::::isEdpWorking</a></a></strong> {DUT DUTList} {
    global DUTs_info
    global whichDutNow
    global trunkPortList
    global lastDUT
    global checkHubConnection	

    if {[llength $DUTList] &gt; 1 &amp;&amp; [info exists trunkPortList]} {
	for {set i 0} {$i&lt;[llength $trunkPortList]} {incr i} {
	    set trunkPair [lindex $trunkPortList $i]
	    set localDUT [lindex $trunkPair 0]
	    set remoteDUT [lindex $trunkPair 1]
	    if {$remoteDUT==0} continue;
            global eware_dut
            if {[info exists eware_dut]} {
               if {[lsearch $eware_dut $whichDutNow] == -1 } {
                  set loopVar 1
               } else {
                  set loopVar 0
               }
           } else {
               set loopVar 1
           }

           if {$loopVar} {

	    if {$localDUT==$whichDutNow} {
		if {$localDUT&lt;$remoteDUT} {
		    global stackable i386Stackable ewareStackable
		    if {[regexp -nocase &#34;$stackable|$i386Stackable|$ewareStackable&#34; [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$remoteDUT]]} {
			lappend edpList &#34;{[lindex $trunkPair 2] .* 00:00:$DUTs_info(DUT$remoteDUT,sysMAC) *1:[lindex [lindex $trunkPortList [expr $i+1]] 2]} exist&#34;
		    } else {
			lappend edpList &#34;{[lindex $trunkPair 2] .* 00:00:$DUTs_info(DUT$remoteDUT,sysMAC) *[lindex [lindex $trunkPortList [expr $i+1]] 2]} exist&#34;
		    }
		} else {
		    global stackable i386Stackable ewareStackable
		    if {[regexp -nocase &#34;$stackable|$i386Stackable|$ewareStackable&#34; [<a name="::GetPlatform(4)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$remoteDUT]]} {
			lappend edpList &#34;{[lindex $trunkPair 2] .* 00:00:$DUTs_info(DUT$remoteDUT,sysMAC) *1:[lindex [lindex $trunkPortList [expr $i-1]] 2]} exist&#34;
		    } else {
			lappend edpList &#34;{[lindex $trunkPair 2] .* 00:00:$DUTs_info(DUT$remoteDUT,sysMAC) *[lindex [lindex $trunkPortList [expr $i-1]] 2]} exist&#34;
		    }
		}
	    }
     } else {
            if {$localDUT==$whichDutNow} {
                if {$localDUT&lt;$remoteDUT} {

                    global stackable i386Stackable ewareStackable
                    if {[regexp -nocase &#34;$stackable|$i386Stackable|$ewareStackable&#34; [<a name="::GetPlatform(5)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$remoteDUT]]} {
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {EDP is enabled} inLine&#34;
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-ID\=00:00:$DUTs_info(DUT$remoteDUT,sysMAC)} inLine exist 2&#34;
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-Port\=1:[lindex [lindex $trunkPortList [expr $i+1]] 2]} inLine exist 3&#34;
                    } else {
  lappend edpList &#34;{port.*[lindex $trunkPair 2]} {EDP is enabled} inLine&#34;
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-ID\=00:00:$DUTs_info(DUT$remoteDUT,sysMAC)} inLine exist 2&#34;
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-Port\=[lindex [lindex $trunkPortList [expr $i+1]] 2]} inLine exist 3&#34;

                    }
                } else {
                    global stackable i386Stackable ewareStackable
                    if {[regexp -nocase &#34;$stackable|$i386Stackable|$ewareStackable&#34; [<a name="::GetPlatform(6)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$remoteDUT]]} {

   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {EDP is enabled} inLine&#34;
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-ID\=00:00:$DUTs_info(DUT$remoteDUT,sysMAC)} inLine exist 2&#34;
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-Port\=1:[lindex [lindex $trunkPortList [expr $i-1]] 2]} inLine exist 3&#34;
                    } else {
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {EDP is enabled} inLine&#34;
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-ID\=00:00:$DUTs_info(DUT$remoteDUT,sysMAC)} inLine exist 2&#34;
   lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-Port\=[lindex [lindex $trunkPortList [expr $i-1]] 2]} inLine exist 3&#34;
                       }
                    }
                }
            }

	}
	<a name="::Login(15)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT

	<span class="comment-line">#SK: Doing file based CheckKeyValue to avoid dual edp port all, in case it does not work</span>
	set fd_edp [open &#34;Tmp/tmp_edp[pid]&#34; &#34;w&#34;]
        if {[info exists eware_dut]} {
             if {[lsearch $eware_dut $whichDutNow] == -1 } {
           set output [<a name="::SendACmd(53)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show edp ports all&#34; NULL $fd_edp]

	<span class="comment-line"># Build regular expression pattern for EDP neighbor MAC address.</span>
           set key {^[0-9]+}
        } else {
           set key {[a-z]+}
           set output [<a name="::SendACmd(54)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show edp&#34; NULL $fd_edp]
        }
        } else  {
       <span class="comment-line"># Build regular expression pattern for EDP neighbor MAC address.</span>
            set key {^[0-9]+}
            set output [<a name="::SendACmd(55)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show edp ports all&#34; NULL $fd_edp]
        }

	close $fd_edp

<span class="comment-line"># Check connection of DUT with HUB and if doesn't exist return connectionBad</span>
 if {([info exists checkHubConnection] == 1) &amp;&amp; $checkHubConnection == 0} {
     <span class="comment-line">#do nothing skip the hub connection check</span>
     } else {
	set DUT_Cnt [llength $DUTList]
	set retHubConnVal 0 
        for {set i $lastDUT} {$i&lt;[llength $trunkPortList]} {incr i} {
            set trunkPair [lindex $trunkPortList $i]
            set localDUT [lindex $trunkPair 0]
	    if {$lastDUT==$localDUT} continue;
            set remoteDUT [lindex $trunkPair 1]
            set localDUTPort [lindex $trunkPair 2]
            if {$remoteDUT!=0} continue;
		 for {set j 1} {$j&lt;=$DUT_Cnt} {incr j} {	
			if {$j==$localDUT} continue; 
                  set DUT_HUBPortMap [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $j $remoteDUT] 
		  set DUT_Mac [<a name="::GetDUTMac(1)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> DUT$j]
		global stackable i386Stackable
		if {[regexp -nocase &#34;$stackable|$i386Stackable&#34; [<a name="::GetPlatform(7)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$j]]} {
		lappend edpList &#34;{$localDUTPort .*$DUT_Mac *1:$DUT_HUBPortMap } exist&#34;
                    } else {
		lappend edpList &#34;{$localDUTPort .*$DUT_Mac *$DUT_HUBPortMap } exist&#34;
		}
	}
	set lastDUT $localDUT
	break;	
}
}
	if {[regexp -line $key $output]!=1} {
            <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;EDP not working ...&#34;
            file delete &#34;Tmp/tmp_edp[pid]&#34;
            return -1
	} else {
	    set output [<a name="::CheckKeyValue(5)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;Tmp/tmp_edp[pid]&#34; $edpList  -comment &#34;for file operation: Check edp info&#34;]
	    file delete &#34;Tmp/tmp_edp[pid]&#34;
	    if {$output==&#34;ok&#34;} {
		return 1
	    } else {
		return 0
	    }
	}
    } else {
	return 1
    }
}
<strong><a name="::::CheckForPreviousCore_1822">proc <a href="ePTSystemSetup.tcl-annot.html#::::CheckForPreviousCore">::::CheckForPreviousCore</a></a></strong> {numDUT {msmType &#34;primary&#34;}} {
   global DUTs_info

   set date [clock format [clock seconds] -format &#34;%m%d%I%p&#34;]
   if {[info exists DUTs_info(current_module)]} {
       set modStringList [split $DUTs_info(current_module) &#34;/&#34;]
   } else {
       set modStringList [split [file tail [pwd]] &#34;/&#34;]
   }
   set modListLength [llength $modStringList]
   set mod [lindex $modStringList [expr $modListLength - 1]]

   if {[<a name="::CompareRelease(3)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(4)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.1.0.21]&gt;=0} {
    if { $msmType == &#34;primary&#34; } {
      <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; Memory Card Present : [regexp -nocase \&#34;present\&#34; $DUTs_info(DUT${numDUT},memoryCard)]&#34;
      if {[regexp -- &#34;present&#34; $DUTs_info(DUT${numDUT},memoryCard)]} {
         set coreBuf [<a name="::SendACmd(56)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls memorycard&#34;]
      } else {
         set coreFileList &#34;&#34;
         lappend coreFileList &#34;core\.\[a-z\]+\.\[0-9\]+ 0&#34;
         if {[<a name="::CompareRelease(4)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(5)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.4.0.1]&gt;=0} {
            set coreBuf [<a name="::SendACmd(57)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls internal-memory&#34;]
         } else {
            <a name="::EnableDebugMode(6)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            set coreBuf [<a name="::GetKeyValue(5)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;!ls /scratch&#34; $coreFileList 1]
         }
      }
    } else {
      <a name="::EnableDebugMode(7)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a> ; <span class="comment-line"># Required for executing !mv and !rm command</span>
      <span class="comment-line"># if MSM-A has memeory card, please make sure MSM-B also has memeory card.</span>
      if {[regexp -- &#34;present&#34; $DUTs_info(DUT${numDUT},memoryCard)]} {
         set coreBuf [<a name="::SendACmd(58)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls memorycard&#34;]
      } else {
         set coreFileList &#34;&#34;
         lappend coreFileList &#34;core\.\[a-z\]+\.\[0-9\]+ 0&#34;
         if {[<a name="::CompareRelease(5)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(6)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.4.0.1]&gt;=0} {
            set coreBuf [<a name="::SendACmd(59)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls internal-memory&#34;]
         } else {
            <a name="::EnableDebugMode(8)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            set coreBuf [<a name="::GetKeyValue(6)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;!ls /scratch&#34; $coreFileList 1]
         }
      }
    }


      if {[regexp -nocase &#34;core.*&#34; $coreBuf]} {
         <a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on memoryCard, mv to different name&#34;
         <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found core dump on memoryCard, mv to different name&#34;
         foreach coreFile $coreBuf {
            <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;coreFile:|$coreFile,[regexp -nocase &#34;core&#34; $coreFile]|&#34;
            if {[regexp -nocase &#34;core&#34; $coreFile]} {
               regsub -all {core} $coreFile Kore newCore
               set newCoreFile ${mod}_${date}_$newCore
               set newProcFile ${mod}_${date}_process_traces.tgz
               
              if { $msmType == &#34;primary&#34; } { 
               if {[regexp -- &#34;present&#34; $DUTs_info(DUT${numDUT},memoryCard)]} {
                  <a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on memoryCard, mv to different name&#34;
                  <a name="::SendACmd(60)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log&#34; 
                  <a name="::SendACmd(61)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv memorycard $coreFile memorycard $newCoreFile&#34;
                  <a name="::report_start_test(9)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                  <a name="::SendACmd(62)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv memorycard process_traces.tgz memorycard $newProcFile&#34;
                  <a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  <a name="::report_end_test(10)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               } else {
                  if {[<a name="::CompareRelease(6)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(7)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.4.0.1]&gt;=0} {
                     <a name="::report_start_test(10)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on internal, mv to different name&#34;
                     <a name="::SendACmd(63)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv internal-memory $coreFile internal-memory $newCoreFile&#34;
                     <a name="::report_start_test(11)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                     <a name="::SendACmd(64)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv internal-memory process_traces.tgz internal-memory $newProcFile&#34;
                     <a name="::report_end_test(11)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                     <a name="::report_end_test(12)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  } else {
                     <a name="::report_start_test(12)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on scratch, mv to different name&#34;
                     <a name="::SendACmd(65)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/$coreFile /scratch/$newCoreFile&#34;
                     <a name="::report_start_test(13)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                     <a name="::SendACmd(66)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/process_traces.tgz /scratch/$newProcFile&#34;
                     <a name="::report_end_test(13)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                     <a name="::report_end_test(14)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  }
               }
              } else {
               <span class="comment-line"># if MSM-A has memeory card, please make sure MSM-B also has memeory card.</span>
               if {[regexp -- &#34;present&#34; $DUTs_info(DUT${numDUT},memoryCard)]} {
                  <a name="::report_start_test(14)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on memoryCard, mv to different name&#34;
                  <a name="::SendACmd(67)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /mnt/a/$coreFile /mnt/a/$newCoreFile&#34;
                  <a name="::report_start_test(15)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                  <a name="::SendACmd(68)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /mnt/a/process_traces.tgz /mnt/a/$newProcFile&#34;
                  <a name="::report_end_test(15)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  <a name="::report_end_test(16)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               } else {
                  if {[<a name="::CompareRelease(7)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(8)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.4.0.1]&gt;=0} {
                     <a name="::report_start_test(16)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on internal, mv to different name&#34;
                     <a name="::SendACmd(69)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/intern/$coreFile /scratch/intern/$newCoreFile&#34;
                     <a name="::report_start_test(17)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                     <a name="::SendACmd(70)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/intern/process_traces.tgz /scratch/intern/$newProcFile&#34;
                     <a name="::report_end_test(17)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                     <a name="::report_end_test(18)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  } else {
                     <a name="::report_start_test(18)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on scratch, mv to different name&#34;
                     <a name="::SendACmd(71)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/$coreFile /scratch/$newCoreFile&#34;
                     <a name="::report_start_test(19)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                     <a name="::SendACmd(72)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/process_traces.tgz /scratch/$newProcFile&#34;
                     <a name="::report_end_test(19)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                     <a name="::report_end_test(20)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  }
               }
              }
            }
         }
      }
   }
}


<strong><a name="::::ChangeTraceFileName_1937">proc <a href="ePTSystemSetup.tcl-annot.html#::::ChangeTraceFileName">::::ChangeTraceFileName</a></a></strong> {} {
   global DUTs_info
   global whichDutNow
   global currentTestNumber

   if { ![info exists currentTestNumber] } {
        set tempCurrentTestNumber &#34;main&#34;
   } else {
        set currentTestNumber [string trim $currentTestNumber]
        if {[regexp {(.*) *;.*} $currentTestNumber match match1]} {
           set tempCurrentTestNumber $match1
        } else {
           set tempCurrentTestNumber $currentTestNumber
        }
        set tempCurrentTestNumber [string trim $tempCurrentTestNumber]
   }


   set date [clock format [clock seconds] -format &#34;%m%d%I%p&#34;]
   if {[info exists DUTs_info(current_module)]} {
       set modStringList [split $DUTs_info(current_module) &#34;/&#34;]
   } else {
       set modStringList [split [file tail [pwd]] &#34;/&#34;]
   }
   set modListLength [llength $modStringList]
   set mod [lindex $modStringList [expr $modListLength - 1]]

   <a name="::EnableDebugMode(9)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a> ; <span class="comment-line"># Required for executing !mv and !rm command</span>

   if {([info exist DUTs_info(DUT${whichDutNow},memoryCard)]) &amp;&amp; ([regexp -- &#34;present&#34; $DUTs_info(DUT${whichDutNow},memoryCard)])} {
      set traceBuf [<a name="::SendACmd(73)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls memorycard&#34;]
   } else {
      if {[<a name="::CompareRelease(8)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(9)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.4.0.1]&gt;=0} {
         set traceBuf [<a name="::SendACmd(74)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls internal-memory&#34;]
      } else {
         set traceBuf [<a name="::GetKeyValue(7)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;!ls /scratch&#34; $coreFileList 1]
      }
   }

   if {[regexp -nocase &#34;trace.*&#34; $traceBuf]} {
      <a name="::report_start_test(20)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found traces, mv to different name&#34;
      foreach traceFile $traceBuf {
         <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;traceFile:|$traceFile,[regexp -nocase trace $traceFile]|&#34;
         if {[regexp -nocase &#34;trace&#34; $traceFile]} {
            <span class="comment-line">#regsub -all {trace} $traceFile grace newTrace</span>
            <span class="comment-line">#set newTraceFile ${newTrace}_${mod}_${date}</span>
            <span class="comment-line">#set newTraceFile ${newTrace}_${mod}_${tempCurrentTestNumber}</span>
            set newTraceFile ${traceFile}_${mod}_${tempCurrentTestNumber}

            if {([info exist DUTs_info(DUT${whichDutNow},memoryCard)]) &amp;&amp; ( [regexp -- &#34;present&#34; $DUTs_info(DUT${whichDutNow},memoryCard)])} {
               <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found traces on memoryCard, mv to different name&#34;
               <a name="::report_start_test(21)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving traces&#34;
               <a name="::SendACmd(75)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv memorycard $traceFile memorycard $newTraceFile&#34;
               <a name="::report_end_test(21)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
            } else {
               if {[<a name="::CompareRelease(9)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(10)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.4.0.1]&gt;=0} {
                  <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found traces on internal-memory, mv to different name&#34;
                  <a name="::report_start_test(22)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                  <a name="::SendACmd(76)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv internal-memory $traceFile internal-memory $newTraceFile&#34;
                  <a name="::report_end_test(22)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               } else {
                  <a name="::report_start_test(23)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving traces&#34;
                  <a name="::SendACmd(77)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/$traceFile /scratch/$newTraceFile&#34;
                  <a name="::report_end_test(23)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               }
            }
         }
      }
      <a name="::report_end_test(24)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
   }
}

<strong><a name="::::ChangeCoreFileName_2009">proc <a href="ePTSystemSetup.tcl-annot.html#::::ChangeCoreFileName">::::ChangeCoreFileName</a></a></strong> {} {
   global DUTs_info
   global whichDutNow
   global currentTestNumber
   global numDUT
   global spawn_id
   global spawn_ids
   global enableAbortTestCondition

   for {set i 1} {$i &lt;= $numDUT} {incr i} {
        global DUT${i}_CONNECT DUT${i}_CONNECTB
   }

   <span class="comment-line">#find out the ipAddr of this session if it is MSM-A or MSM-B</span>
   global hostname
   foreach name $hostname {
      if { $spawn_id == $spawn_ids($name) } {
           set ipAddr $name
      }
   }
   <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;hostname : $hostname , ipAddr : $ipAddr&#34;
   <a name="::exSleep(7)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 60 ; <span class="comment-line"># Delay after process died as DUT takes some time to reboot</span>

   <span class="comment-line"># Verifying whether process died on master/backup.</span>
   if { [info exists DUT${whichDutNow}_CONNECTB] } {
      if { $ipAddr == [set DUT${whichDutNow}_CONNECTB] } {
          <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Backup ip address : [set DUT${whichDutNow}_CONNECTB] , ipAddr : $ipAddr&#34;
          <a name="::Login(16)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECT] -masterCheck 0 -CheckOperational 0
          set showSwitchOutput &#34;&#34;
          lappend showSwitchOutput &#34;{Current State:} {In *Sync} inLine exists&#34;
          <a name="::CheckKeyValue(6)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $showSwitchOutput -time {s: 1 i: 5 d: 150 f: 150 r} -comment &#34;check both MSMs up in sh switch output&#34;

         <a name="::SendACmd(78)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log warning&#34;
         <a name="::SendACmd(79)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log&#34;
         lappend getKey &#34;{Current State:} 1&#34;
         set stateA [<a name="::GetKeyValue(8)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show switch&#34; $getKey]
         <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stateA : $stateA&#34;
         if {[string tolower $stateA] == &#34;master&#34;} {
             <span class="comment-line"># Calling run msm-failover as reboot happened due to process died. </span>
             <span class="comment-line"># can not use MakeMSMBMaster.</span>
             <a name="::SendACmd(80)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;run msm-failover&#34;
             <a name="::exSleep(8)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 90
             <a name="::Login(17)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECTB] 
             <a name="::CheckOperational(1)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
         } else {
             <a name="::Login(18)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECTB] 
             <a name="::CheckOperational(2)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
         }
      } else {
          <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Master ip address : [set DUT${whichDutNow}_CONNECT] , ipAddr : $ipAddr&#34;
          <a name="::Login(19)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECTB] -masterCheck 0 -CheckOperational 0
          set showSwitchOutput &#34;&#34;
          lappend showSwitchOutput &#34;{Current State:} {In *Sync} inLine exists&#34;
          <a name="::CheckKeyValue(7)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $showSwitchOutput -time {s: 1 i: 5 d: 150 f: 150 r} -comment &#34;check both MSMs up in sh switch output&#34;

         <a name="::SendACmd(81)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log warning&#34;
         <a name="::SendACmd(82)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log&#34;
         lappend getKey &#34;{Current State:} 1&#34;
         set stateA [<a name="::GetKeyValue(9)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show switch&#34; $getKey]
         <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stateA : $stateA&#34;
         if {[string tolower $stateA] == &#34;backup&#34;} {
             <span class="comment-line"># Calling run msm-failover as reboot happened due to process died. </span>
             <span class="comment-line"># can not use MakeMSMAMaster.</span>
             <a name="::SendACmd(83)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;run msm-failover&#34;
             <a name="::exSleep(9)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 90
             <a name="::Login(20)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECT]
             <a name="::CheckOperational(3)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
         } else {
             <a name="::Login(21)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECT]
             <a name="::CheckOperational(4)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
         }
      }
   } else {
          <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Backup not exist. Dut ip address : [set DUT${whichDutNow}_CONNECT] , ipAddr : $ipAddr&#34;
          <a name="::Login(22)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECT]
   }

   <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Processing core files&#34; 
   if { ![info exists currentTestNumber] } {
       set tempCurrentTestNumber &#34;main&#34;
   } else {
         set currentTestNumber [string trim $currentTestNumber]
         set tempCurrentTestNumber $currentTestNumber
         if {[regexp {(.*) *;.*} $currentTestNumber match match1]} {
           set tempCurrentTestNumber $match1
         } else {
           set tempCurrentTestNumber $currentTestNumber
         }
   }
   set date [clock format [clock seconds] -format &#34;%m%d%I%p&#34;]
   if {[info exists DUTs_info(current_module)]} {
       set modStringList [split $DUTs_info(current_module) &#34;/&#34;]
   } else {
       set modStringList [split [file tail [pwd]] &#34;/&#34;]
   }
   set modListLength [llength $modStringList]
   set mod [lindex $modStringList [expr $modListLength - 1]]

   <span class="comment-line">#Login $DUTs_info(DUT$whichDutNow,connect) -masterCheck 1</span>
   <a name="::EnableDebugMode(10)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a> ; <span class="comment-line"># Required for executing !mv and !rm command</span>
   <a name="::SendACmd(84)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log warning&#34;
   <a name="::SendACmd(85)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log&#34;

   if {([info exist DUTs_info(DUT${whichDutNow},memoryCard)]) &amp;&amp; ([regexp -- &#34;present&#34; $DUTs_info(DUT${whichDutNow},memoryCard)])} {
      set coreBuf [<a name="::SendACmd(86)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls memorycard&#34;]
   } else {
      if {[<a name="::CompareRelease(10)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(11)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.4.0.1]&gt;=0} {
         set coreBuf [<a name="::SendACmd(87)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls internal-memory&#34;]
      } else {
         set coreFileList &#34;&#34;
         lappend coreFileList &#34;core\.\[a-z\]+\.\[0-9\]+ 0&#34;
         set coreBuf [<a name="::GetKeyValue(10)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;!ls /scratch&#34; $coreFileList 1]
      }
   }

   if {[regexp -nocase &#34;core.*&#34; $coreBuf]} {
      <a name="::report_start_test(24)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core, mv to different name&#34;
      foreach coreFile $coreBuf {
         <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;coreFile:|$coreFile,[regexp -nocase core $coreFile]|&#34;
         if {([regexp -nocase &#34;core&#34; $coreFile]) &amp;&amp; (![regexp -nocase &#34;core.*\.gz_&#34; $coreFile]) &amp;&amp; (![regexp -nocase &#34;core\.nvram.*_&#34; $coreFile])} {
            set newCoreFile ${coreFile}_${mod}_${tempCurrentTestNumber}

            if {([info exist DUTs_info(DUT${whichDutNow},memoryCard)]) &amp;&amp; ( [regexp -- &#34;present&#34; $DUTs_info(DUT${whichDutNow},memoryCard)])} {
               <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found core on memoryCard, mv to different name&#34;
               <a name="::report_start_test(25)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving core&#34;
               <a name="::SendACmd(88)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv memorycard $coreFile memorycard $newCoreFile&#34;
               <a name="::report_end_test(25)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
            } else {
               if {[<a name="::CompareRelease(11)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(12)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.4.0.1]&gt;=0} {
                  <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found core on internal-memory, mv to different name&#34;
                  <a name="::report_start_test(26)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving core&#34;
                  <a name="::SendACmd(89)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv internal-memory $coreFile internal-memory $newCoreFile&#34;
                  <a name="::report_end_test(26)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               } else {
                  <a name="::report_start_test(27)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving core&#34;
                  <a name="::SendACmd(90)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/$coreFile /scratch/$newCoreFile&#34;
                  <a name="::report_end_test(27)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               }
            }
         }
      }
      <a name="::report_end_test(28)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
   }
  if { ([info exists enableAbortTestCondition] ) &amp;&amp; ($enableAbortTestCondition ==&#34;coreDump&#34;) } {
    exit
  }
}
<strong><a name="::::EnableBGPServiceProviderEdgeLicence_2156">proc <a href="ePTSystemSetup.tcl-annot.html#::::EnableBGPServiceProviderEdgeLicence">::::EnableBGPServiceProviderEdgeLicence</a></a></strong> { {duts &#34;&#34;} } {
   global DUTs_info

   if {$duts==&#34;&#34;} {
      set duts 1 
   }
   set dutList [split $duts ,]
   foreach dut $dutList {
      set DUTName [format %s%d DUT $dut]
      global ${DUTName}_CONNECT
      <a name="::Login(23)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT]

   if { [<a name="::CompareRelease(12)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(13)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${dut}] 12.1] &gt;=0 &amp;&amp; \
        [regexp -nocase &#34;X450e|X250e&#34; $DUTs_info(DUT${dut},platform)] } {
      set licenseInfo [<a name="::SendACmd(91)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show licenses&#34;]
     if {[regexp -nocase &#34;ServiceProviderEdge&#34; $licenseInfo] !=1} {
         <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Platform is not enabled with ServiceProviderEdge license&#34;
            if { [info exist DUTs_info(DUT${dut},bgp)] } {
                 <a name="::SendACmd(92)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${dut},bgp)&#34;
                 set licenseInfo [<a name="::SendACmd(93)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show licenses&#34;]
                 if {[regexp -nocase &#34;ServiceProviderEdge&#34; $licenseInfo] !=1} {
                     <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Platform is not enabled with BGP ServiceProviderEdge license.&#34;
	             <a name="::close_result_file(4)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
	             <a name="::report_end_test(29)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
                     return -code return testSkipped
                  }
             } else {
                    <a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ServiceProviderEdge licence key for bgp does not exist in cfg file. Please add the same and restart regression&#34;
	             <a name="::close_result_file(5)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
	             <a name="::report_end_test(30)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
                     return -code return testSkipped
             }
      } else {
         <a name="::result_debug(42)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$DUTName is enabled with ServiceProviderEdge license&#34;
      }
    } else {
         <a name="::result_debug(43)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$DUTName is not X450e|X250e or release &lt;12.1 does not require ServiceProviderEdge license&#34;
   }
   }

}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
