<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>UPM.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#UPM.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>UPM.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="UPM.tcl-annot.html">annotations</a> | <a href="UPM.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::CreateUpmProfile_2">proc <a href="UPM.tcl-annot.html#::::CreateUpmProfile">::::CreateUpmProfile</a></a></strong><a name="::::CreateUpmProfile"></a> {args} {

<a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CreateUpmProfile  $args {
profileName &#34;&#34;
profile &#34;&#34;
}

set cmd &#34;create upm profile $profileName&#34;
set rtValue 0
<a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- Send $cmd&#34;
send &#34;$cmd\r&#34;

expect {
    -re &#34;Name cannot be a reserved keyword&#34; {
     <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Profile Name cannot be a reserved keyword&#34;
     set rtValue 5
     }  	
     -re &#34;Name cannot exceed 32 characters&#34; {
      <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Profile Name \&#34;$profileName\&#34; exceed 32 characters&#34;
     set rtValue 4
     }
     -re &#34;already in use&#34; {
     set rtValue 3
     }
     -re &#34;Name must start with an alphabetical character&#34; {
     <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Profile Name must start with an alphabetical character&#34;
     set rtValue 2
     }

    -re &#34;block mode capability&#34; {
     if {$profile != &#34;&#34;} {
     <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- Send data for the upm profile $profileName&#34;
     send &#34;$profile\r&#34;
      }
         exp_send &#34;.\r&#34;	
	 expect {
	    -re &#34;Reached system limit of 128 profiles&#34; {
	        set rtValue 7
                <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Reached system limit of 128 profiles&#34;
		         }

	    -re &#34;.*\[#&gt;]&#34; {
	       set profileStatus 1
               set rtValue 1
               <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;succesfully created upm profile&#34;
                          }
                          

               }
     }         
}
if {$rtValue == 1} {
<a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Successfully created UPM profile \&#34;$profileName\&#34; &#34;
} else {
<a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;UPM profile  \&#34;$profileName\&#34; not created Successfully&#34;
}
return $rtValue
}
    	
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckCreateUpmProfileIllegal</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Sets result ok if create upm profile failed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               -profileName  name of the profile</span>
<span class="comment-line">#               -profile      the profile</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#               None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::CheckCreateUpmProfileIllegal_75">proc <a href="UPM.tcl-annot.html#::::CheckCreateUpmProfileIllegal">::::CheckCreateUpmProfileIllegal</a></a></strong><a name="::::CheckCreateUpmProfileIllegal"></a> {args} {

<a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckCreateUpmProfileIllegal  $args {
profileName &#34;&#34;
profile
}

set profileStatus &#34;&#34;
set profileStatus [<a name="::::CreateUpmProfile(1)"><a href="./UPM.tcl.html#::::CreateUpmProfile_2">::::CreateUpmProfile</a></a> -profileName $profileName -profile $profile]

<a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;UPM profile creation should fail&#34;
if {$profileStatus != 1} {
   <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Create upm profile failed&#34;
} else {
   <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Create upm profile should fail but passed&#34;
}
<a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckCreateUpmProfileLegal</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Sets result ok if create upm profile passed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               -profileName  name of the profile</span>
<span class="comment-line">#               -profile      the profile</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#               None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckCreateUpmProfileLegal_107">proc <a href="UPM.tcl-annot.html#::::CheckCreateUpmProfileLegal">::::CheckCreateUpmProfileLegal</a></a></strong><a name="::::CheckCreateUpmProfileLegal"></a> {args} {

<a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckCreateUpmProfileLegal  $args {
profileName &#34;&#34;
profile
}

set profileStatus &#34;&#34;
set profileStatus [<a name="::::CreateUpmProfile(2)"><a href="./UPM.tcl.html#::::CreateUpmProfile_2">::::CreateUpmProfile</a></a> -profileName $profileName -profile $profile]

<a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;UPM profile creation should pass&#34;
if {$profileStatus == 1} {
   <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Create upm profile passed&#34;
} else {
   <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Create upm profile should pass but failed&#34;
}
<a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: SetupIpPhone</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc configures the LLDP profile for connected avaya phone</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               None</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#               None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:SetupIpPhone</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupIpPhone_137">proc <a href="UPM.tcl-annot.html#::::SetupIpPhone">::::SetupIpPhone</a></a></strong><a name="::::SetupIpPhone"></a> {} {
global DUT1_CONNECT
global DUT1_IP
global defaultRouter

global IpPhonePort
global CallServer
global FileServer
global VoiceVlan
global VoiceVlanPort
global DataVlan
global DataVlanPort
global VoiceVlanTag
global IpPhoneMac


<a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Setting up LLDP for IP Phone&#34;


<a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<a name="::ConfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::ConfigGatewayNetwork_2110">::ConfigGatewayNetwork</a></a>
<a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $VoiceVlan&#34;
<a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure $VoiceVlan tag 50&#34;
<a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure $VoiceVlan add ports $IpPhonePort tagged&#34;
<a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure $VoiceVlan add ports $VoiceVlanPort&#34;
<a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $DataVlan&#34;
<a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure $DataVlan add ports $DataVlanPort&#34;

<a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp transmit-interval 10&#34;
<a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp transmit-hold 2&#34;
<a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable lldp ports $IpPhonePort&#34;
<a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific dot1 port-vlan-id&#34;
<a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific dot1 port-protocol-vlan-id&#34;
<a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific dot3 mac-phy&#34;
<a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific dot3 power-via-mdi&#34;
<a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific dot3 link-aggregation&#34;
<a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific dot3 max-frame-size&#34;
<a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific avaya-extreme poe-conservation-request&#34;
<a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific avaya-extreme call-server $CallServer&#34;
<a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific avaya-extreme file-server $FileServer&#34;
<a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp port $IpPhonePort advertise vendor-specific avaya-extreme dot1q-framing auto&#34;

<a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable inline-power&#34;

lappend parameterList &#34;{$IpPhonePort.*$IpPhoneMac.*} exist&#34;
<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show lldp neighbors&#34; $parameterList \
 -time {s: 10 i: 10 d: 120 f: 120 r} -comment &#34;Checking VOIP phone detection using LLDP&#34;
unset parameterList


<a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: DeleteIpPhone</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc unconfigures the LLDP profile</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               None</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#               None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:SetupIpPhone</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::DeleteIpPhone_201">proc <a href="UPM.tcl-annot.html#::::DeleteIpPhone">::::DeleteIpPhone</a></a></strong><a name="::::DeleteIpPhone"></a> {} {
global DUT1_CONNECT
global DUT1_IP
global defaultRouter

global IpPhonePort
global CallServer
global FileServer
global VoiceVlan
global DataVlan
global IpPhoneMac

<a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Deleting the LLDP setup for IP Phone&#34;



<a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable inline-power&#34;
<a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10


<a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp transmit-interval 30&#34;
<a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp transmit-hold 4&#34;
<a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable lldp ports $IpPhonePort&#34;
<a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfigure lldp port $IpPhonePort&#34;
<a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $VoiceVlan&#34;
<a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $DataVlan&#34;

lappend parameterList &#34;{$IpPhonePort.*$IpPhoneMac.*} notExist&#34;
<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show lldp neighbors&#34; $parameterList \
 -time {s: 10 i: 10 d: 120 f: 120 r} -comment &#34;Checking VOIP phone is un-detected&#34;
unset parameterList

<a name="::UnconfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::UnconfigGatewayNetwork_2356">::UnconfigGatewayNetwork</a></a>



<a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}


 
 


</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
