<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>BgpSetup.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#BgpSetup.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>BgpSetup.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="BgpSetup.tcl-annot.html">annotations</a> | <a href="BgpSetup.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupBGPInternetFeed</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  set up the first BGP AS to the outside world</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupBGPInternetFeed_19">proc <a href="BgpSetup.tcl-annot.html#::::SetupBGPInternetFeed">::::SetupBGPInternetFeed</a></a></strong> {} {

<span class="comment-line">#    SendACmd  &#34;conf default del po all&#34;;</span>
<span class="comment-line">#    SendACmd  &#34;create vlan bgpvlan&#34;;</span>
<span class="comment-line">#    SendACmd  &#34;conf bgpvlan add port 2:24&#34;;</span>
<span class="comment-line">#    SendACmd  &#34;conf bgpvlan ipa 10.201.25.6/24&#34;;</span>
<span class="comment-line">#    SendACmd  &#34;conf ipr add default 10.201.25.1&#34;;</span>
    <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp as-number 65533&#34;;
    <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp router 10.201.25.6&#34;;
    <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create bgp neighbor 10.201.15.211 remote 14490 multiple&#34;;
    <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create route-map NOTHING&#34;;
    <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config NOTHING add 100 deny match-all&#34;;
    <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp neigh 10.201.15.211 route-map out NOTHING&#34;;
    <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable ipforwarding&#34;;
    <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp neighbor 10.201.15.211&#34;;      
    <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp&#34;;
    <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config ipro add 10.201.15.211/32 10.201.25.1&#34;; 
    <span class="comment-line">#create access-profile iplist type ipaddress</span>
    <span class="comment-line">#conf iplist add ipaddress 192.0.0.0/8</span>
    <span class="comment-line">#conf bgp nei 10.201.15.211 nlri-filter in iplist         </span>
    <span class="comment-line">#SendACmd  &#34;dis clipaging&#34;;</span>
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupBGPInternetFeed</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Turn the BGP router off</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupBGPInternetFeed_59">proc <a href="BgpSetup.tcl-annot.html#::::CleanupBGPInternetFeed">::::CleanupBGPInternetFeed</a></a></strong> {} {
    <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable bgp neighbor all&#34;;
    <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable bgp&#34;; 
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetSummaryPage</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  </span>
<span class="comment-line"># Use when the table is too long. Just try to get the summary page.               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: command ipAddr fd_res testNo</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#        lappend parameterList {sh ipr origin bgp sorted}</span>
<span class="comment-line">#        GetSummaryPage $parameterList $ipAddr $fd_res $testNo     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: GetSwitchInfo</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetSummaryPage_82">proc <a href="BgpSetup.tcl-annot.html#::::GetSummaryPage">::::GetSummaryPage</a></a></strong> { command ipAddr fd_res testNo} {
 
    log_user 2;
    <span class="comment-line">#exp_internal 1;     </span>
    set fd_input [open &#34;Tmp/tmp_$testNo&#34; &#34;w&#34;];
    if [catch &#34;spawn telnet $ipAddr&#34; reason] {
       <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;failed to spawn program: $reason\n&#34;;
       error &#34;failed to spawn program: $reason\n&#34;;
       return;
    }
    expect &#34;login: &#34; { send &#34;admin\r&#34; };                         
    expect &#34;pass*&#34; { send &#34;\r&#34; };    
    foreach cmd $command {                   

        expect &#34;*#*&#34; { send &#34;$cmd\r&#34; };
        set exp_out_buf &#34;&#34;;
        regsub -all &#34;\n\r&#34; $expect_out(buffer) &#34;\n&#34; exp_out_buf;
        if {$fd_input != &#34;NULL&#34; } { 
            puts $fd_input $exp_out_buf; 
            puts $fd_res $exp_out_buf; 
        }
        expect &#34;*quit&#34; { send &#34;Q&#34; };
        set exp_out_buf &#34;&#34;;
        regsub -all &#34;\n\r&#34; $expect_out(buffer) &#34;\n&#34; exp_out_buf;
        if {$fd_input != &#34;NULL&#34; } { 
            puts $fd_input $exp_out_buf; 
            puts $fd_res $exp_out_buf;
        }
        expect &#34;*quit&#34; { send &#34;Q&#34; };   
        set exp_out_buf &#34;&#34;;
        regsub -all &#34;\n\r&#34; $expect_out(buffer) &#34;\n&#34; exp_out_buf;
        if {$fd_input != &#34;NULL&#34; } { 
            puts $fd_input $exp_out_buf; 
            puts $fd_res $exp_out_buf;
        }
        expect &#34;*#*&#34; { send &#34;\r\r&#34; };
        set exp_out_buf &#34;&#34;;
        regsub -all &#34;\n\r&#34; $expect_out(buffer) &#34;\n&#34; exp_out_buf;
        if {$fd_input != &#34;NULL&#34; } { 
            puts $fd_input $exp_out_buf; 
            puts $fd_res $exp_out_buf;
        }
    }    
    close $fd_input;
    log_user 0;
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetTotalKeyValue</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  </span>
<span class="comment-line">#  Execute a CLI command. The function will return total key value</span>
<span class="comment-line">#  found in the output.               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################   </span>
<strong><a name="::::GetTotalKeyValue_147">proc <a href="BgpSetup.tcl-annot.html#::::GetTotalKeyValue">::::GetTotalKeyValue</a></a></strong> {command parameterList} {

   global spawn_id;
   set totalkey 0;
   
   if {[regexp -- {} $command]} {
      <span class="comment-line"># Command is passed as a file, read the file instead</span>
      <span class="comment-line"># of running the command</span>
      set fd_in [open &#34;$command&#34; &#34;r&#34;]
   } else {
      set fd_in [open &#34;Tmp/tmp_TotalBGPRoute&#34; &#34;w&#34;]
      <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$command&#34; NULL $fd_in
      close $fd_in
      set fd_in [open &#34;Tmp/tmp_TotalBGPRoute&#34; &#34;r&#34;]        
   }

   while {[gets $fd_in line] != -1} {
   <span class="comment-line">#result_debug &#34;----- Line=|$line|&#34;</span>
      foreach itemList $parameterList {
         <span class="comment-line">#puts &#34;itemList ==&gt; $itemList&#34;;</span>
         set key [lindex $itemList 0]
         
         if {[regexp -nocase -indices $key $line matchedRange] == 1} {
            <span class="comment-line">#found the key</span>
            <span class="comment-line">#result_debug &#34;Key: |$key| line: |$line| totalkey: |$totalkey|&#34;;</span>
            puts &#34;Key: |$key| line: |$line| totalkey: |$totalkey|&#34;;          
            set totalkey [expr $totalkey + 1];           
        } 
     }      
   }   
   close $fd_in
   
   if {$totalkey != 0 } { return $totalkey } else { return &#34;KEY_NOT_FOUND&#34; }
   
   catch {file delete &#34;Tmp/tmp_TotalBGPRoute&#34;}
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IsKeyValueSorted</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  </span>
<span class="comment-line">#  Execute a CLI command. The function will return &#34;Sorted&#34; or &#34;NotSorted&#34; </span>
<span class="comment-line">#  key value found in the output.               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: command parameterList</span>
<span class="comment-line"># Output args: sorted/unsorted</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::IsKeyValueSorted_202">proc <a href="BgpSetup.tcl-annot.html#::::IsKeyValueSorted">::::IsKeyValueSorted</a></a></strong> {command parameterList} {

   global spawn_id;
   set firstIP 0;
   set secondIP 0;
   
   if {[regexp -- {[\/]} $command]} {
      <span class="comment-line"># Command is passed as a file, read the file instead</span>
      <span class="comment-line"># of running the command</span>
      set fd_in [open &#34;$command&#34; &#34;r&#34;]
   } else {
      set fd_in [open &#34;Tmp/tmp_TotalBGPRoute&#34; &#34;w&#34;]
      <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$command&#34; NULL $fd_in
      close $fd_in
      set fd_in [open &#34;Tmp/tmp_TotalBGPRoute&#34; &#34;r&#34;]        
   }
  
   while {[gets $fd_in line] != -1} {
   <span class="comment-line">#result_debug &#34;----- Line=|$line|&#34;</span>
      foreach itemList $parameterList {
         <span class="comment-line">#puts &#34;itemList ==&gt; $itemList&#34;;</span>
         set key [lindex $itemList 0]         
         if {[regexp -nocase -indices $key $line matchedRange] == 1} {
            <span class="comment-line">#found the key</span>
            <span class="comment-line">#result_debug &#34;Key: |$key| line: |$line| matchedRange: |$matchedRange|&#34; </span>
            set searchOption [lindex $itemList 2]
            if {$searchOption &gt; 0 } {
               <span class="comment-line">#get the value on some line after the line where the key is found</span>
               <span class="comment-line">#puts &#34; searchOption = $searchOption&#34;;</span>
               for { set i 0 } { $i &lt; $searchOption } { incr i } {
                  gets $fd_in lineAfterKey
               }
               <span class="comment-line">#result_debug &#34;Wanted ${searchOption}th line after key: |$lineAfterKey|&#34; </span>
               set indexWanted [expr [lindex $itemList 1]]
            } else {
               if {[lindex $itemList 1] &gt; 0} {
                  set keyEnd [expr [lindex $matchedRange 1] + 1]
                  set line2bSearched [string range $line $keyEnd end]
                  set indexWanted [expr [lindex $itemList 1] - 1]
               } elseif {[lindex $itemList 1] &lt; 0} {
                  set keyStart [expr [lindex $matchedRange 0] -1]
                  set line2bSearched [string range $line 0 $keyStart]
                  set indexWanted [expr [llength $line2bSearched] + [lindex $itemList 1]]
               } else {
                  set keyStart [lindex $matchedRange 0]
                  set keyEnd [lindex $matchedRange 1]
                  set line2bSearched [string range $line $keyStart $keyEnd]
                  set indexWanted 0
               }
            }
            <span class="comment-line">#result_debug &#34;line2bSearched: |$line2bSearched|&#34;</span>
            set valueFound [lindex $line2bSearched $indexWanted]
            <span class="comment-line">#result_debug &#34;Key: |$key| valueFound: |$valueFound|&#34;</span>
            set secondIP [string first . $valueFound];   
            if {$firstIP &gt; $secondIP} {
                return &#34;NotSorted&#34;;    
            } else {
                set firstIP $secondIP;
            }                        
         } 
      }      
   }   
   close $fd_in   
   return &#34;Sorted&#34;;

   catch {file delete &#34;Tmp/tmp_TotalBGPRoute&#34;} 
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupDUTAsIBGP</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: set up DUT1 as IBGP peer </span>
<span class="comment-line"># Assumes the peer is another DU2, strictly works for DUT1&lt;-&gt;DUT2 not for test equiment</span>
<span class="comment-line">#</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupDUTAsIBGP_288">proc <a href="BgpSetup.tcl-annot.html#::::SetupDUTAsIBGP">::::SetupDUTAsIBGP</a></a></strong> {} {
    <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create vlan vibgp&#34;;
    <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vibgp add port [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1]&#34;;
    <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vibgp ipaddress 10.10.10.2/24&#34;;
    <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config iproute add default 10.10.10.1&#34;;
    <a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp as-number 100&#34;;
    <a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp routerid 10.10.10.2&#34;;
    <a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create bgp neighbor 10.10.10.1 remote 100&#34;;
    <a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable ipforwarding&#34;;
<span class="comment-line">#    SendACmd  &#34;dis bgp sync&#34;;  </span>
    <a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp&#34;;       
    <a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp neighbor all&#34;;      
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupDUTAsIBGP</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Cleans up DUT1 as IBGP peer with DUT2 </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupDUTAsIBGP_317">proc <a href="BgpSetup.tcl-annot.html#::::CleanupDUTAsIBGP">::::CleanupDUTAsIBGP</a></a></strong> {} {
    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CleanupDUTAsIBGP&#34;
    <a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config iproute delete default 10.10.10.1&#34;; 
    <a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable ipforwarding&#34;;
<span class="comment-line">#    SendACmd  &#34;en bgp sync&#34;;</span>
    <a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable bgp&#34;;
    <a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete bgp neighbor all&#34;;
    <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete vibgp&#34;;
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupDUTAsEBGP</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  set up DUT3 as EBGP with DUT1.</span>
<span class="comment-line">#     Assumes dUT1 sets up DUT3 as EBGP peer as well. Strictly meant for DUT3&lt;-&gt;DUT1</span>
<span class="comment-line">#     would not work for test equiment</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupDUTAsEBGP_346">proc <a href="BgpSetup.tcl-annot.html#::::SetupDUTAsEBGP">::::SetupDUTAsEBGP</a></a></strong> {} {

    <a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create vlan vebgp&#34;;
    <a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vebgp add port [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 1]&#34;;
    <a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vebgp ipaddress 20.10.10.2/24&#34;;
    <a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config iproute add default 20.10.10.1&#34;; 
    <a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp as-number 200&#34;;
    <a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config bgp routerid 20.10.10.2&#34;;
    <a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create bgp neighbor 20.10.10.1 remote 100&#34;;
    <a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable ipforwarding&#34;;  
<span class="comment-line">#    SendACmd  &#34;dis bgp sync&#34;; </span>
    <a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp&#34;;        
    <a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp neighbor all&#34;;      
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupDUTAsEBGP</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Cleanup DUT EBGP info</span>
<span class="comment-line">#               Assumes DUT was configured using SetupDUTAsEBGP</span>
<span class="comment-line">#</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupDUTAsEBGP_377">proc <a href="BgpSetup.tcl-annot.html#::::CleanupDUTAsEBGP">::::CleanupDUTAsEBGP</a></a></strong> {} {
    <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CleanupDUTAsEBGP&#34;
    <a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config iproute delete default 20.10.10.1&#34;; 
    <a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable ipforwarding&#34;;
<span class="comment-line">#    SendACmd  &#34;en bgp sync&#34;; </span>
    <a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable bgp&#34;;       
    <a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete bgp neighbor all&#34;;
    <a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete vebgp&#34;;    
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupDUT1</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  sets up DUT1 with IBGP peer to DUT2 and EBGP peer with DUT3</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupDUT1_403">proc <a href="BgpSetup.tcl-annot.html#::::SetupDUT1">::::SetupDUT1</a></a></strong> {} {
    <a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create vlan vibgp&#34;;
    <a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vibgp add port [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2]&#34;;
    <a name="::SendACmd(47)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vibgp ipaddress 10.10.10.1/24&#34;;

    <a name="::SendACmd(48)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create vlan vebgp&#34;;
    <a name="::SendACmd(49)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vebgp add port [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 3]&#34;;
    <a name="::SendACmd(50)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config vebgp ipaddress 20.10.10.1/24&#34;;

    <a name="::SendACmd(51)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf bgp as-number 100&#34;;
    <a name="::SendACmd(52)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;conf bgp routerid 20.10.10.1&#34;;
    <a name="::SendACmd(53)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create bgp neighbor 10.10.10.2 remote 100&#34;;
    <a name="::SendACmd(54)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;create bgp neighbor 20.10.10.2 remote 200&#34;
    <a name="::SendACmd(55)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable ipforwarding&#34;;
<span class="comment-line">#    SendACmd  &#34;dis bgp sync&#34;;</span>
    <a name="::SendACmd(56)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp&#34;;
    <a name="::SendACmd(57)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable bgp neighbor all&#34;;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupDUT1</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  cleans up DUT with bgp information.</span>
<span class="comment-line">#  mainly called to cleanup config from SetupDUT1</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupDUT1_439">proc <a href="BgpSetup.tcl-annot.html#::::CleanupDUT1">::::CleanupDUT1</a></a></strong> {} {
    <a name="::SendACmd(58)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable ipforwarding&#34;; 
<span class="comment-line">#    SendACmd  &#34;en bgp sync&#34;; </span>
    <a name="::SendACmd(59)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;disable bgp&#34;;      
    <a name="::SendACmd(60)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete bgp neighbor all&#34;;
    <a name="::SendACmd(61)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;delete vebgp&#34;;
    <a name="::SendACmd(62)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vibgp&#34;
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name:VerifyNotABGPNeighbor</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to verify a given bgp neighbor does not exist</span>
<span class="comment-line">#     by using sh bgp neigh and sh bgp             </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: IPAddress, asNum, IOrE</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#         VerifyNotABGPNeighbor $ipAddress $asNum $IOrE</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyNotABGPNeighbor_466">proc <a href="BgpSetup.tcl-annot.html#::::VerifyNotABGPNeighbor">::::VerifyNotABGPNeighbor</a></a></strong> {ipAddress asNum IOrE} {

    set e e

   <span class="comment-line">################################################</span>
   set subTest &#34;Verify that neighbor $ipAddress does not exist&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   lappend parameterList &#34;{$IOrE$e.* $ipAddress *$asNum .* ESTABLISHED} notExist&#34;;
   <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp neighbor&#34; $parameterList -comment &#34;BGP neighbor not established&#34; -time {s: 0 i: 4 d: 60 f: 60 r};
   unset parameterList;
   <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyCorrectBGPNeighbor</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to verify a given bgp neighbor exists with right i or e</span>
<span class="comment-line">#     neighbor flag. It also checks the correct number of i or e routes learned.  </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: IPAddress, asNum, numRoutes, IOrE</span>
<span class="comment-line"># Output args: ok/error</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#        VerifyNotABGPNeighbor $ipAddress, asNum, $numRoutes, $I</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyCorrectBGPNeighbor_499">proc <a href="BgpSetup.tcl-annot.html#::::VerifyCorrectBGPNeighbor">::::VerifyCorrectBGPNeighbor</a></a></strong> {ipAddress asNum numRoutes IOrE} {

    set e e

   <span class="comment-line">################################################</span>
   set subTest &#34;Verify that neighbor $ipAddress ESTABLISHED&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   lappend parameterList &#34;{$IOrE$e.* $ipAddress *$asNum .* ESTABLISHED} exist&#34;;
   if {[regexp -nocase [<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp neighbor&#34; $parameterList -comment &#34;BGP neighbor established&#34; -time {s: 1 i: 4 d: 60 f: 60 r}] &#34;error&#34;]} {
   return &#34;error&#34;
   }
   unset parameterList;
   <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
 
   if {[regexp -nocase $IOrE &#34;i&#34;]} {
      lappend parameterList &#34;{Routes from IBGP *: $numRoutes} exist&#34;;
      return [<a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp&#34; $parameterList -comment &#34;Verify numRoutes learned from internal neighbor&#34; -time {s: 0 i: 4 d: 60 f: 60 r}]
      <span class="comment-line">#unset parameterList;</span>
   } elseif {[regexp -nocase $IOrE &#34;e&#34;]} {
      lappend parameterList &#34;{Routes from EBGP *: *$numRoutes} exist&#34;;
      return [<a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp&#34; $parameterList -comment &#34;Verify numRoutes learned from external neighbor&#34; -time {s: 0 i: 4 d: 60 f: 60 r}];
      <span class="comment-line">#unset parameterList;</span>
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyCorrectBGPNeighborList</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to verify a given list of bgp neighbor exists with right i or e</span>
<span class="comment-line">#     neighbor flag. </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: peerIp - list of nbr ip address, peerAsNum - List of peer's </span>
<span class="comment-line">#                      AS Number, peerType - List of peer's type. </span>
<span class="comment-line">#                      List order should be the same for all the lists</span>
<span class="comment-line">#                      mentioned above</span>
<span class="comment-line"># Output args: ok/error</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#        VerifyNotABGPNeighbor $ipAddress, asNum, $numRoutes, $I</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyCorrectBGPNeighborList_547">proc <a href="BgpSetup.tcl-annot.html#::::VerifyCorrectBGPNeighborList">::::VerifyCorrectBGPNeighborList</a></a></strong> {args} {

    set e e

   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyCorrectBGPRoutesLearned $args {
      peerIp &#34;&#34; 
      peerAsNum &#34;&#34;
      peerType &#34;&#34;
   }

for {set index 0} {$index&lt;[llength $peerIp]} {incr index} {
   set peerIpValue [lindex $peerIp $index]
   set peerAsNum [lindex $peerAsNum $index]
   set peerTypeValue [lindex $peerType $index]

   lappend parameterList &#34;{$peerTypeValue$e.* $peerIpValue *$peerAsNum .* ESTABLISHED} exist&#34;;
}
   return [<a name="::CheckKeyValue(5)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp neighbor&#34; $parameterList -comment &#34;BGP neighbor established&#34; -time {s: 1 i: 4 d: 60 f: 60 r}];
   <span class="comment-line">#unset parameterList;</span>
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyCorrectBGPRoutesLearned</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Verify that specific BGP routes are learned on the</span>
<span class="comment-line">#               switch.</span>
<span class="comment-line">#               It uses route attributes in a list along with network ip</span>
<span class="comment-line">#               to verify the learning</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyCorrectBGPRoutesLearned_586">proc <a href="BgpSetup.tcl-annot.html#::::VerifyCorrectBGPRoutesLearned">::::VerifyCorrectBGPRoutesLearned</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyCorrectBGPRoutesLearned $args {
      peerIp &#34;&#34; 
      peerAsPath &#34;&#34;
      ipNwList &#34;&#34;
      originList &#34;0&#34;
      routesList &#34;&#34;
      nextHopList &#34;&#34;
      fromPrefixList &#34;&#34;
      bestRouteList &#34;&#34;
      fromPrefixList &#34;&#34;
      thruPrefixList &#34;&#34;
      localPrefList &#34;&#34;
      asTypeList &#34;&#34;
      asPathList &#34;&#34;
      medList &#34;&#34;
      peerType &#34;&#34;
   }

for {set index 0} {$index&lt;[llength $peerIp]} {incr index} {
   set peerIpValue [lindex $peerIp $index]
   set peerAsPathVal [lindex $peerAsPath $index]
   set ipNwListValue [lindex $ipNwList $index]
   set fromPrefixListValue [lindex $fromPrefixList $index]
   set thruPrefixListValue [lindex $thruPrefixList $index]
   set originListValue [lindex $originList $index]
   set nextHopListValue [lindex $nextHopList $index]
   set routesListValue [lindex $routesList $index]
   set medListValue [lindex $medList $index]
   set asPathListValue [lindex $asPathList $index]
   set asTypeListValue [lindex $asTypeList $index]
   set localPrefListValue [lindex $localPrefList $index]
   set bestRouteListValue [lindex $bestRouteList $index]
   set peerTypeValue [lindex $peerType $index]
   set length [llength $ipNwListValue]
   set incompleteRoutesList &#34;&#34;
   set incompleteRoutesList1 &#34;&#34;
   <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;length=$length and asPathListValue $asPathListValue&#34;;

   <span class="comment-line">################################################</span>
   set subTest &#34;Verify correct routes learned from peer $peerIpValue&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   
   if {[llength $fromPrefixListValue]!=$length || [llength $thruPrefixListValue]!=$length || [llength $routesListValue]!=$length || \
       [llength $nextHopListValue]!=$length} {
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error in input args:fromPrefixList,thruPrefixList,routesList,ipNwList,nextHopList should be same length&#34;
      <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return -1
   }
   
   for {set i 0} {$i&lt;$length} {incr i} {
      set ipNetwork [lindex $ipNwListValue $i]
      set fromPrefix [lindex $fromPrefixListValue $i]
      set thruPrefix [lindex $thruPrefixListValue $i]
      set originType [lindex $originListValue $i]
      set nextHop [lindex $nextHopListValue $i]
      set localPref [lindex $localPrefListValue $i]
      set numRoutes [lindex $routesListValue $i]
      set med [lindex $medListValue $i]
      set bestRoute [lindex $bestRouteListValue $i]
      set peerTypeVal [lindex $peerTypeValue $i]

      switch -- $originType \
         &#34;1&#34; {
             set originCode EGP
         } &#34;0&#34; {
             set originCode IGP
         } &#34;2&#34; {
             set originCode Incomplete
         } default {
             set originCode IGP
         }
      
      if {$peerTypeVal==&#34;i&#34;} {
         set peerAsPathList &#34;&#34;
      } else {
         set peerAsPathList $peerAsPathVal
      }
      if {[llength $asPathListValue]!=0} {
         set aslist [lindex $asPathListValue $i]
         set asSegmentTypes [lindex $asTypeListValue $i]
         if {$aslist!=&#34;&#34;} {
            set indice 0
            foreach asType $asSegmentTypes {
               if {[llength $asSegmentTypes]&gt;1} {             
                  lappend peerAsPathList [lindex $aslist $indice]
               } else {
                  if {$asType==1} {
                     set aslist [list $aslist]   ;<span class="comment-line"># in order to properly check the set of AS_SET</span>
                  }
                  foreach asl $aslist {
                     lappend peerAsPathList $asl
                  }
               }
               incr indice
            }
         }
      }
      for {set j 0} {$j&lt;$numRoutes} {incr j} {
         set myIP [<a name="::incrIpField(1)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $ipNetwork 3 $j]
         scan $myIP %d.%d.%d.%d a b c d
         set myIP [format %d.%d.%d.%d $a $b $c 0]
         if {$localPref!=&#34;&#34;} {
            if {$med!=&#34;&#34;} {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop, LPref $localPref, MED $med} inLine exist 1&#34;
            } else {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop, LPref $localPref} inLine exist 1&#34;
            }
         } else {
            if {$med!=&#34;&#34;} {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop.* MED $med} inLine exist 1&#34;
            } else {
<span class="comment-line">#               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop.*} inLine exist 1&#34;</span>
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop} inLine exist 1&#34;
            }
         }
         if {$bestRoute==1} {
            lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix, *Peer $peerIpValue, *BEST} {AS-PATH: $peerAsPathList} inLine exist 2&#34;
         } else {
            lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix, *Peer $peerIpValue} {AS-PATH: $peerAsPathList} inLine exist 2&#34;
         }
      }
   }
<span class="comment-line">#   result_debug &#34;the constructed incompleteRoutesList $incompleteRoutesList&#34;</span>
<span class="comment-line">#   result_debug &#34;the constructed incompleteRoutesList1 $incompleteRoutesList1&#34;</span>
   
   <a name="::CheckKeyValue(6)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp neighbor $peerIpValue received-routes detail all&#34; $incompleteRoutesList -comment &#34;BGP neighbor incomplete routes&#34;  -time {s: 0 i: 5 d: 60 f: 60 r};
   <span class="comment-line">#CheckKeyValue &#34;show bgp neighbor $peerIpValue received-routes detail all&#34; $incompleteRoutesList1 -comment &#34;BGP neighbor incomplete routes correct AS-PATH&#34;;</span>
   unset incompleteRoutesList
   <span class="comment-line">#unset incompleteRoutesList1</span>
   
   <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyCorrectBGPRoutesLearned_12_5</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Verify that specific BGP routes are learned on the</span>
<span class="comment-line">#               switch.</span>
<span class="comment-line">#               It uses route attributes in a list along with network ip</span>
<span class="comment-line">#               to verify the learning</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyCorrectBGPRoutesLearned_12_5_740">proc <a href="BgpSetup.tcl-annot.html#::::VerifyCorrectBGPRoutesLearned_12_5">::::VerifyCorrectBGPRoutesLearned_12_5</a></a></strong> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyCorrectBGPRoutesLearned_12_5 $args {
      peerIp &#34;&#34; 
      peerAsPath &#34;&#34;
      ipNwList &#34;&#34;
      originList &#34;0&#34;
      routesList &#34;&#34;
      nextHopList &#34;&#34;
      fromPrefixList &#34;&#34;
      bestRouteList &#34;&#34;
      fromPrefixList &#34;&#34;
      thruPrefixList &#34;&#34;
      localPrefList &#34;&#34;
      asTypeList &#34;&#34;
      asPathList &#34;&#34;
      medList &#34;&#34;
      peerType &#34;&#34;
   }

for {set index 0} {$index&lt;[llength $peerIp]} {incr index} {
   set peerIpValue [lindex $peerIp $index]
   set peerAsPathVal [lindex $peerAsPath $index]
   set ipNwListValue [lindex $ipNwList $index]
   set fromPrefixListValue [lindex $fromPrefixList $index]
   set thruPrefixListValue [lindex $thruPrefixList $index]
   set originListValue [lindex $originList $index]
   set nextHopListValue [lindex $nextHopList $index]
   set routesListValue [lindex $routesList $index]
   set medListValue [lindex $medList $index]
   set asPathListValue [lindex $asPathList $index]
   set asTypeListValue [lindex $asTypeList $index]
   set localPrefListValue [lindex $localPrefList $index]
   set bestRouteListValue [lindex $bestRouteList $index]
   set peerTypeValue [lindex $peerType $index]
   set length [llength $ipNwListValue]
   set incompleteRoutesList &#34;&#34;
   set incompleteRoutesList1 &#34;&#34;
   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;length=$length and asPathListValue $asPathListValue&#34;;

   <span class="comment-line">################################################</span>
   set subTest &#34;Verify correct routes learned from peer $peerIpValue&#34;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;
   <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   
   if {[llength $fromPrefixListValue]!=$length || [llength $thruPrefixListValue]!=$length || [llength $routesListValue]!=$length || \
       [llength $nextHopListValue]!=$length} {
      <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error in input args:fromPrefixList,thruPrefixList,routesList,ipNwList,nextHopList should be same length&#34;
      <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return -1
   }
   
   for {set i 0} {$i&lt;$length} {incr i} {
      set ipNetwork [lindex $ipNwListValue $i]
      set fromPrefix [lindex $fromPrefixListValue $i]
      set thruPrefix [lindex $thruPrefixListValue $i]
      set originType [lindex $originListValue $i]
      set nextHop [lindex $nextHopListValue $i]
      set localPref [lindex $localPrefListValue $i]
      set numRoutes [lindex $routesListValue $i]
      set med [lindex $medListValue $i]
      set bestRoute [lindex $bestRouteListValue $i]
      set peerTypeVal [lindex $peerTypeValue $i]

      switch -- $originType \
         &#34;1&#34; {
             set originCode EGP
         } &#34;0&#34; {
             set originCode IGP
         } &#34;2&#34; {
             set originCode Incomplete
         } default {
             set originCode IGP
         }
      
      if {$peerTypeVal==&#34;i&#34;} {
         set peerAsPathList &#34;&#34;
      } else {
         set peerAsPathList $peerAsPathVal
      }
      if {[llength $asPathListValue]!=0} {
         set aslist [lindex $asPathListValue $i]
         set asSegmentTypes [lindex $asTypeListValue $i]
         if {$aslist!=&#34;&#34;} {
            set indice 0
            foreach asType $asSegmentTypes {
               if {[llength $asSegmentTypes]&gt;1} {             
                  lappend peerAsPathList [lindex $aslist $indice]
               } else {
                  if {$asType==1} {
                     set aslist [list $aslist]   ;<span class="comment-line"># in order to properly check the set of AS_SET</span>
                  }
                  foreach asl $aslist {
                     lappend peerAsPathList $asl
                  }
               }
               incr indice
            }
         }
      }
      for {set j 0} {$j&lt;$numRoutes} {incr j} {
         set myIP [<a name="::incrIpField(2)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $ipNetwork 3 $j]
         scan $myIP %d.%d.%d.%d a b c d
         set myIP [format %d.%d.%d.%d $a $b $c 0]
         if {$localPref!=&#34;&#34;} {
            if {$med!=&#34;&#34;} {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop, LPref $localPref, MED $med} inLine exist 1&#34;
            } else {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop, LPref $localPref} inLine exist 1&#34;
            }
         } else {
            if {$med!=&#34;&#34;} {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop.* MED $med} inLine exist 1&#34;
            } else {
               lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix} {Origin $originCode, Next-Hop $nextHop} inLine exist 1&#34;
            }
         }
         if {$bestRoute==1} {
            lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix, *Peer $peerIpValue, *BEST} {AS-PATH: $peerAsPathList} inLine exist 3&#34;
         } else {
            lappend incompleteRoutesList &#34;{Route: $myIP/$fromPrefix, *Peer $peerIpValue} {AS-PATH: $peerAsPathList} inLine exist 3&#34;
         }
      }
   }
   
   <a name="::CheckKeyValue(7)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show bgp neighbor $peerIpValue received-routes detail all&#34; $incompleteRoutesList -comment &#34;BGP neighbor incomplete routes&#34;  -time {s: 0 i: 5 d: 60 f: 60 r};
   unset incompleteRoutesList
   
   <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
