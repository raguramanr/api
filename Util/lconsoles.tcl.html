<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>lconsoles.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#lconsoles.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>lconsoles.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="lconsoles.tcl-annot.html">annotations</a> | <a href="lconsoles.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>

<strong><a name="::result_debug_3">proc <a href="lconsoles.tcl-annot.html#::result_debug">::result_debug</a></a></strong><a name="::result_debug"></a> {out} {
    puts &#34;$out&#34;
}
<strong><a name="::result_error_6">proc <a href="lconsoles.tcl-annot.html#::result_error">::result_error</a></a></strong><a name="::result_error"></a> {out} {
    puts &#34;$out&#34;
}
<strong><a name="::result_ok_9">proc <a href="lconsoles.tcl-annot.html#::result_ok">::result_ok</a></a></strong><a name="::result_ok"></a> {out} {
    puts &#34;$out&#34;
}
global curAutoRoot
global DUTs_info

source ../Lib/mainLib.tcl
package require Tclx

load [lindex [glob &#34;/usr/lib/libexpect*so*&#34;] 0]

set curLocation [pwd]
set curDirList [split [string trim [string trim $curLocation &#34;..&#34;] &#34;/&#34;] &#34;/&#34;]
set v 0;
set pathList &#34;&#34;
set curAutoRoot &#34;&#34;
set skipCC 0
foreach cd $curDirList {
    if {$cd == &#34;main&#34; || $cd == &#34;Lib&#34; || $cd == &#34;Util&#34;} {
        for {set x 0} {$x&lt;$v} {incr x} {
            lappend pathList [lindex $curDirList $x]
        }
        set curAutoRoot &#34;/[join $pathList &#34;/&#34;]&#34;
    } else {
        incr v;
    }
}
puts &#34;CURRENT PATH: $curAutoRoot&#34;
set cDir [file tail [pwd]]
set LIB_PATH &#34;./../Lib&#34;
lappend auto_path $LIB_PATH
puts &#34;DEBUG: Appending $LIB_PATH to autopath:$auto_path&#34;

<a name="::gen_index(1)"><a href="./summarize.tcl.html#::gen_index_76">::gen_index</a></a> &#34;./../Lib&#34;


<strong><a name="::print_usage_45">proc <a href="lconsoles.tcl-annot.html#::print_usage">::print_usage</a></a></strong><a name="::print_usage"></a> {} {
    puts &#34;\r&#34;
    puts {Usage: lconsoles.tcl -cfg &lt;config file&gt; }
    puts {   &lt;cfg&gt;: Path of the config file name }
    puts {   &lt;power|p&gt;: 1|0|2 1=poweron 2=poweroff-poweron}
    puts {   &lt;clear|c&gt;: 1|0 Clear the consoles if locked}
    puts &#34;\r&#34;
}

<span class="comment-line"># checking command parameters</span>
if {$argc&lt;1} {
      puts &#34;Not enough parameters&#34;
      <a name="::print_usage(1)"><a href="./lconsoles.tcl.html#::print_usage_45">::print_usage</a></a>
      return
}

parse_args lconsoles $argv {
    cfg    &#34;null&#34;
    power 0
    clear 0
    p 0
    c 0
}
if {$p == 0} {
   set power 0
} elseif {$p == 1} {
   set power 1
} elseif {$p == 2} {
   set power 2
} else {
   set power 0
}
if {$c!=0} {
   set clear 1
}

set cfgFile &#34;&#34;

if {$cfg != &#34;null&#34;} {
    if {[regexp -nocase &#34;^\\.\\.&#34; $cfg] } {
        set cfgFile $cfg
        puts &#34;matched ..&#34;
    } elseif {[regexp -nocase &#34;^cfg&#34; $cfg] } {
        puts &#34;matched start with cfg&#34;
        set cfgFile [format %s/%s cfg $cfg]
        set cfgFile [string trim $cfgFile];
    } elseif {$cDir == &#34;Util&#34; || $cDir == &#34;main&#34;} {
        puts &#34;matched start Util Main&#34;
        set cfgFile [format %s/%s ../main/cfg $cfg]
        set cfgFile [string trim $cfgFile];
    } else {
        puts &#34;matched catch all&#34;
        set cfgFile $cfg
    }
}

puts &#34;Using config file: ($cfgFile)&#34;

if {[file exists $cfgFile] == 0} {
    puts &#34;Cannot find config file: $cfgFile\n&#34;
    puts stderr &#34;Cannot find config file: $cfgFile&#34;
    return
}

puts &#34;************** ABOUT TO source $cfgFile *****************&#34;
catch {source $cfgFile } reason

if {$power==1} {
    for {set i 1} {$i&lt;11} {incr i} {
        if {[info exists POWERCYCLE_DUT($i)]} {
            puts &#34;Powering on DUT DUT$i&#34;
            PowerOffDUT $i &#34;on&#34;
        }
    }
}
if {$power==2} {
    for {set i 1} {$i&lt;11} {incr i} {
        if {[info exists POWERCYCLE_DUT($i)]} {
            puts &#34;Powering off DUT DUT$i&#34;
            PowerOffDUT $i &#34;off&#34;
        }
    }
    exSleep 10
    for {set i 1} {$i&lt;11} {incr i} {
        if {[info exists POWERCYCLE_DUT($i)]} {
            puts &#34;Powering on DUT DUT$i&#34;
            PowerOffDUT $i &#34;on&#34;
        }
    }
}

if {$clear} {
    for {set i 1} {$i&lt;11} {incr i} {
        if {[info exists DUT${i}_CONNECT]} {
            ClearConsoleDUT &#34;[set DUT${i}_CONNECT]&#34;
        }
    }
}
for {set i 1} {$i&lt;11} {incr i} {
    if {[info exists DUT${i}_CONNECT]} {
        puts &#34;Sending /usr/kerberos/bin/telnet \&#34;[set DUT${i}_CONNECT]\&#34;&#34;
        if {[catch {exec /usr/bin/xterm -e \
                 &#34;./bash_lc ${cfgFile}_DUT$i \&#34;[set DUT${i}_CONNECT]\&#34;&#34; &amp;} reason]} {
            puts &#34;OOOPPPSSSSS&#34;
        }
    }
    if {[info exists DUT${i}_CONNECTB]} {
        puts &#34;Sending /usr/kerberos/bin/telnet \&#34;[set DUT${i}_CONNECTB]\&#34;&#34;
        if {[catch {exec /usr/bin/xterm -e \
                 &#34;./bash_lc ${cfgFile}_DUT${i}B \&#34;[set DUT${i}_CONNECTB]\&#34;&#34; &amp;} reason]} {
            puts &#34;OOOPPPSSSSS&#34;
        }
    }
    if {[info exists DUT${i}_CONNECTC]} {
        puts &#34;Sending /usr/kerberos/bin/telnet \&#34;[set DUT${i}_CONNECTC]\&#34;&#34;
        if {[catch {exec /usr/bin/xterm -e \
                 &#34;./bash_lc ${cfgFile}_DUT${i}C \&#34;[set DUT${i}_CONNECTC]\&#34;&#34; &amp;} reason]} {
            puts &#34;OOOPPPSSSSS&#34;
        }
    }
    if {[info exists DUT${i}_CONNECTD]} {
        puts &#34;Sending /usr/kerberos/bin/telnet \&#34;[set DUT${i}_CONNECTD]\&#34;&#34;
        if {[catch {exec /usr/bin/xterm -e \
                 &#34;./bash_lc ${cfgFile}_DUT${i}D \&#34;[set DUT${i}_CONNECTD]\&#34;&#34; &amp;} reason]} {
            puts &#34;OOOPPPSSSSS&#34;
        }
    }
}
exit;
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:00.</cite>
</div>

</body>
</html>
