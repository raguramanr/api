<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>CleanDBJobs.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#CleanDBJobs.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>CleanDBJobs.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="CleanDBJobs.tcl-annot.html">annotations</a> | <a href="CleanDBJobs.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>
source /auto/automation/Util/runReg.cfg   ;<span class="comment-line"># need to change it when run from elsewhere</span>
set autoPath &#34;/auto/automation/&#34;
set qs [getFromRegRunWhere id_label &#34;status = 'Running' OR status = 'Queued'&#34;]

<span class="comment-line"># Decide which queue_ids will be store on the local server</span>
set DEVREG(server,HOST)              [exec hostname -s]

if {[regexp -nocase &#34;devreg|rdu&#34; $DEVREG(server,HOST)]} {
    <span class="comment-line"># rdu case -</span>
    set match RTP
} elseif {[regexp -nocase &#34;sal&#34; $DEVREG(server,HOST)]} {
    set match SALEM
} else {
    <span class="comment-line">#SC case.. set all of these to Complete</span>
    set match SC
}

<span class="comment-line"># set current time</span>
set cNum [format %s [clock format [clock seconds] -format %y%m%d]]
puts &#34;The Number $cNum&#34;
set krList &#34;&#34;
foreach q $qs {
    if {[regexp -nocase &#34;$match&#34; $q]} {
        set qList [split $q &#34;_&#34;]
        set qNums [lindex $qList 1] 
        <span class="comment-line"># rdu</span>
        if {![file isdirectory $DEVREG(server,imagesQueuedDir)/$q] &amp;&amp; ![file isdirectory $DEVREG(server,imagesRunningDir)/$q]} {
            puts &#34;$q (DB Running or Queued) doesn't exist in either Q = $DEVREG(server,imagesQueuedDir)/$q R = $DEVREG(server,imagesRunningDir)/$q&#34;
            if {1} {
                puts &#34;KillReg in the DB as running and queue files do not exist&#34;
                dbKillReg $q
                <span class="comment-line">#if {[catch {updateRegIdStatus -status &#34;Complete&#34; -id_label &#34;$q&#34;} reason]} {</span>
                <span class="comment-line">#    puts &#34;Update label $q to Complete failed: $reason&#34;</span>
                <span class="comment-line">#} else {</span>
                <span class="comment-line">#    puts &#34;Update successfully $q to Complete&#34;</span>
                <span class="comment-line">#}</span>
            }
        } elseif {[expr $cNum - $qNums] &gt; 14} {
            puts &#34;KillReg in the DB Says Running or Queued but queueID running or queue files Exist&#34;
            dbKillReg $q
            lappend krList $q
        } else {
            puts &#34;$q seems to be running get modules&#34;
            set rId [getRegIdFromQId $q]
            <span class="comment-line">#set plats [getFromRegRunWhere &#34;platform&#34; &#34;(status = 'Queued' OR status = 'Running') AND type = 'Private' AND id_label = '$q'&#34;]</span>
            <span class="comment-line">#foreach p $plats {</span>
            <span class="comment-line">#    puts &#34;$q !!!!!!!!!!!!!!!!!!!!!!!!!! found plats $p&#34;</span>
            <span class="comment-line">#}</span>
        }
        <span class="comment-line">#$DEVREG(server,imagesQueuedDir)</span>
        <span class="comment-line">#$DEVREG(server,imagesFinishedDir) </span>
        <span class="comment-line">#$DEVREG(server,imagesKilledDir)  </span>
        <span class="comment-line">#$DEVREG(server,imagesRunningDir) </span>
    }
}
foreach kill $krList {
puts &#34;$kill&#34;
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:00.</cite>
</div>

</body>
</html>
