<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>report.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#report.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>report.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="report.tcl-annot.html">annotations</a> | <a href="report.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line"># Utilities for report generation</span>

<span class="comment-line"># External API:</span>

set EX_REPORT_DATA &#34;&#34;
set EX_REPORT_DATA_1 &#34;&#34;
set EX_REPORT_LEVEL 0
set EX_REPORT_STATUS &#34;&#34;
set EX_REPORT_PERF 0


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: report_fail</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Called when a test fails. (Used internally)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  none</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              report_fail</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::report_fail_27">proc <a href="report.tcl-annot.html#::::report_fail">::::report_fail</a></a></strong> {} {
	global EX_REPORT_STATUS
	set EX_REPORT_STATUS 0
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: report_skip</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Called when a test is skipped. (Used internally)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              report_skip</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::report_skip_45">proc <a href="report.tcl-annot.html#::::report_skip">::::report_skip</a></a></strong> {} {
        global EX_REPORT_STATUS
        set EX_REPORT_STATUS skip
}

set offset -2
<strong><a name="::::perf_data_51">proc <a href="report.tcl-annot.html#::::perf_data">::::perf_data</a></a></strong> {data} {
global offset
   global EX_REPORT_PERF
   if {($data != 1) &amp;&amp; ($data != 0)} {
	  set EX_REPORT_PERF $data
   } else {
	  set EX_REPORT_PERF  [incr data $offset]
   }
}

<strong><a name="::::log_msg_61">proc <a href="report.tcl-annot.html#::::log_msg">::::log_msg</a></a></strong> {logMsg} {
   puts &#34;\[Han_log\] $logMsg&#34;
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: report_start_test</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Called when starting a new test</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              test - test name</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              report_start_test &#34;$title&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::report_start_test_79">proc <a href="report.tcl-annot.html#::::report_start_test">::::report_start_test</a></a></strong> {test} {
    global EX_REPORT_DATA EX_REPORT_LEVEL EX_REPORT_STATUS EX_REPORT_PERF EX_REPORT_DATA_1 REPORTSTARTTESTCASE
    global REPORTSTARTTESTCASELEVEL MAIN
    <span class="comment-line">#puts &#34;@@@@@ report_start_test, EX_REPORT_STATUS=$EX_REPORT_STATUS&#34;</span>
    <span class="comment-line"># -- build a internal list to store test result information</span>
    set result1 [regexp -all {([a-zA-Z0-9]+\.)+((\.)?(\-)?(_)?[a-zA-Z0-9]+(\.)?(\-)?(_)?)+[a-zA-Z0-9]+} \
                      $test REPORTSTARTTESTCASE]
    if {![info exists REPORTSTARTTESTCASE]} {
        set REPORTSTARTTESTCASE &#34;&#34;
    }
    set REPORTSTARTTESTCASELEVEL($REPORTSTARTTESTCASE) $EX_REPORT_LEVEL
    <span class="comment-line">#</span>
    <span class="comment-line"># Currently set test</span>
    <span class="comment-line">#</span>
    set MAIN(report_start_test) $test
    <span class="comment-line">#</span>
    <span class="comment-line"># failure_analysis code to change the color of the FA tests in the report.txt</span>
    <span class="comment-line">#</span>
    if {[info exists MAIN(FA_REPORT_COLOR_ASCII)] &amp;&amp; [string trim $MAIN(FA_REPORT_COLOR_ASCII)] != &#34;&#34;} {
        set test &#34;$MAIN(FA_REPORT_COLOR_ASCII)$test&#34;
    }

    set EX_REPORT_STATUS &#34;&#34;
    set EX_REPORT_PERF 0
    append EX_REPORT_DATA &#34;\{&#34; $test &#34;\} \{\n&#34;
    append EX_REPORT_DATA_1 &#34;\{&#34; $test &#34;\} \{\n&#34;
    incr EX_REPORT_LEVEL
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: report_end_test</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Called when a test completes</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              report_end_test </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::report_end_test_122">proc <a href="report.tcl-annot.html#::::report_end_test">::::report_end_test</a></a></strong> {{result 1}} {
    global EX_REPORT_DATA EX_REPORT_LEVEL EX_REPORT_STATUS EX_REPORT_PERF EX_REPORT_DATA_1
    global REPORTSTARTTESTCASE TPBRESULTCASES TPBRESULTVALUES
    global passCount
    global failCount
    global skipCount
    global enableAbortTestCondition
    global currentTestNumber
    global passSubTestsArr
    global failSubTestsArr
    global skipSubTestsArr
    global harness
    global REPORTSTARTTESTCASELEVEL

    if {![info exists harness]} {
        set harness &#34;tcl&#34;
        puts &#34;###\n###\nHARNESS IS NOT SET\n###\n###&#34;
    }    
    if {![info exists REPORTSTARTTESTCASE]} {
        set REPORTSTARTTESTCASE &#34;&#34;
    }
if {[info exists REPORTSTARTTESTCASELEVEL($REPORTSTARTTESTCASE)]} {
    set myLevel $REPORTSTARTTESTCASELEVEL($REPORTSTARTTESTCASE)
} else {
    set myLevel -1
}
<span class="comment-line">#puts &#34;\n###\n###\nIN report_end_test&#34;</span>
<span class="comment-line">#puts &#34;Case $REPORTSTARTTESTCASE&#34;</span>
<span class="comment-line">#puts &#34;Case Level $myLevel&#34;</span>
<span class="comment-line">#puts &#34;Proc - [GetCurrentProcName]&#34;</span>
<span class="comment-line">#puts &#34;PreProc - [PreProcName]&#34;</span>
<span class="comment-line">#puts &#34;Current Level $EX_REPORT_LEVEL\n###\n###&#34;</span>
<span class="comment-line">#puts &#34;Proc List: [ProcEvalTree]&#34;</span>

    <span class="comment-line"># TPB when to print sub cases</span>
    if {[<a name="::::PreProcName(1)"><a href="./tpbMainLib.tcl.html#::::PreProcName_287">::::PreProcName</a></a>] == [lindex [<a name="::::ProcEvalTree(1)"><a href="./tpbMainLib.tcl.html#::::ProcEvalTree_295">::::ProcEvalTree</a></a>] 1]} {
        <span class="comment-line"># If the previous proc cases (main test case) = the case being called by TPB</span>
        set print 0 ;<span class="comment-line"># Change to 0 9/3/17 turn off tpb printing sub cases</span>
    } else {
        set print 0
    }

    set testskipped 0;

    <span class="comment-line"># -- make sure it end correctly</span>
    if {$EX_REPORT_LEVEL == 0} {
        error &#34;Cannot end a report beyond level 0&#34;
    }

    <span class="comment-line"># -- convert to 0 and 1 format</span>
    switch -glob -- [string tolower $result] {
		&#34;ok&#34; {set result 1}
		&#34;good&#34; {set result 1}
		&#34;success*&#34; {set result 1}
                &#34;skip*&#34; {set result 1; set testskipped 1}
		&#34;bad&#34; {set result 0}
		&#34;er*&#34; {set result 0}
		&#34;fail*&#34; {set result 0}
		&#34;unsuccess*&#34; {set result 0}
		default {set result 1}
    }

    if {$harness == &#34;tpb&#34;} {
        if {![info exists TPBRESULTCASES]} {
            set TPBRESULTVALUES &#34;&#34;
            set TPBRESULTLIST &#34;&#34;
        }
        if {[info exists REPORTSTARTTESTCASE]} {
            set subcase $REPORTSTARTTESTCASE
        } else {
            set subcase &#34;NULL&#34;
        }
    } else {
    }
    if {$EX_REPORT_STATUS != &#34;&#34;} {
        if {($EX_REPORT_STATUS == &#34;skip&#34;)&amp;&amp;($result == 1)} {
            set result 1
            set testskipped 1;
            if {$harness == &#34;tpb&#34; &amp;&amp; $print} {
                lappend TPBRESULTLIST $subcase
                lappend TPBRESULTVALUES &#34;SKIPPED&#34;
                puts &#34;TPB RESULT - Test Case $subcase SKIPPED&#34;
            }
            
        } elseif {($EX_REPORT_STATUS)&amp;&amp;($result == 1)} {
            set result 1
            if {$harness == &#34;tpb&#34; &amp;&amp; $print} {
                puts &#34;TPB RESULT - Test Case $subcase PASSED&#34;
                lappend TPBRESULTLIST $subcase
                lappend TPBRESULTVALUES &#34;PASSED&#34;
            }
        } else {
            set result 0
            if {$harness == &#34;tpb&#34; &amp;&amp; $print} {
                puts &#34;TPB RESULT - Test Case $subcase FAILED&#34;
                lappend TPBRESULTLIST $subcase
                lappend TPBRESULTVALUES &#34;FAILED&#34;
            }
        }
    }
    <span class="comment-line">################################################</span>
    <span class="comment-line"># This is a hack for performace data           #</span>
    <span class="comment-line">################################################</span>
    
    set length [string length $EX_REPORT_DATA]
    if {$EX_REPORT_PERF != 0} {
        set result $EX_REPORT_PERF
    }
    <span class="comment-line">################################################</span>
    
    set trimCurrentTestNumber &#34;&#34;
    if  {[info exist currentTestNumber]} {
        set result1 [regexp {\.*([a-zA-Z0-9_\.-]+)\ *} $currentTestNumber ignore trimCurrentTestNumber]
    }
    
    set tmp1 [expr $length - 4]
    set tmp2 [expr $length - 2]
    set tail [string range $EX_REPORT_DATA $tmp1 $tmp2]
    if { ($tail != &#34;\} 1&#34;) &amp;&amp; ($tail != &#34;\} 0&#34;) } { 
        if { $result == 1 } { 
            incr passCount 1
            if {$harness == &#34;tpb&#34; &amp;&amp; $print} {
                <span class="comment-line">#puts &#34;\n***\n***\nTPB RESULT - Test Case $subcase PASSED\n***\n***&#34;</span>
                lappend TPBRESULTLIST $subcase
                lappend TPBRESULTVALUES &#34;PASSED&#34;
            }
            if {[info exist passSubTestsArr($trimCurrentTestNumber) ]} {
                set passSubTestsArr($trimCurrentTestNumber) [expr $passSubTestsArr($trimCurrentTestNumber) + 1]
            } else {
                set passSubTestsArr($trimCurrentTestNumber) 1
            }
        } else { 
            incr failCount 1
            if {$harness == &#34;tpb&#34; &amp;&amp; $print} {
                puts &#34;TPB RESULT - Test Case $subcase FAILED&#34;
                lappend TPBRESULTLIST $subcase
                lappend TPBRESULTVALUES &#34;FAILED&#34;
            }
            if {[info exist failSubTestsArr($trimCurrentTestNumber) ]} {
                set failSubTestsArr($trimCurrentTestNumber) [expr $failSubTestsArr($trimCurrentTestNumber) + 1]
            } else {
                set failSubTestsArr($trimCurrentTestNumber) 1
            }
            if { ([info exists enableAbortTestCondition] ) &amp;&amp; \
                 ($enableAbortTestCondition ==&#34;anyFailure&#34;) } {
                exit
            }
        }
        if {$testskipped} {
            incr skipCount 1
            if {$harness == &#34;tpb&#34; &amp;&amp; $print} {
                puts &#34;TPB RESULT - Test Case $subcase SKIPPED&#34;
                lappend TPBRESULTLIST $subcase
                lappend TPBRESULTVALUES &#34;SKIPPED&#34;
            }
            if {[info exist skipSubTestsArr($trimCurrentTestNumber) ]} {
                set skipSubTestsArr($trimCurrentTestNumber) [expr $skipSubTestsArr($trimCurrentTestNumber) + 1]
            } else {
                set skipSubTestsArr($trimCurrentTestNumber) 1
            }
        }
    }
    if {$testskipped} {
        set result skip
    }
    append EX_REPORT_DATA &#34;\} &#34; $result &#34;\n&#34;
    append EX_REPORT_DATA_1 &#34;\} &#34; $result &#34;\n&#34;
    incr EX_REPORT_LEVEL -1
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: fix_report_level</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: fix report level (internal)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  none</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              fix_report_level</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::fix_report_level_306">proc <a href="report.tcl-annot.html#::::fix_report_level">::::fix_report_level</a></a></strong> {} {
	global EX_REPORT_LEVEL

	while {$EX_REPORT_LEVEL &gt; 0} {
		<a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a> 1
	}
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: save_test_report</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Saves the current state of the test report to the file report.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: </span>
<span class="comment-line">#              report - file name</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              save_test_report &#34;[get_result_dir]/report.exr&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::save_test_report_329">proc <a href="report.tcl-annot.html#::::save_test_report">::::save_test_report</a></a></strong> {report} {
	global EX_REPORT_DATA EX_REPORT_DATA_1 

	<a name="::fix_report_level(1)"><a href="./report.tcl.html#::fix_report_level_306">::fix_report_level</a></a>
	set fid [open $report &#34;w&#34;]
	puts -nonewline $fid $EX_REPORT_DATA
	close $fid

}

<span class="comment-line">#####################################################################</span>
<span class="comment-line"># Procedure Name: Statustestcase</span>
<span class="comment-line"># Description: Prints the testcase report in TestcaseStatusList.txt.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#	Testcase</span>
<span class="comment-line">#	TestcaseReport</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	Statustestcase $casereport $tc</span>
<span class="comment-line">#</span>
<span class="comment-line">#####################################################################</span>

<strong><a name="::::Statustestcase_357">proc <a href="report.tcl-annot.html#::::Statustestcase">::::Statustestcase</a></a></strong> {casereport tc} {

global ezinfofile
global duration FEATMAIN

if {$tc != &#34;&#34;} {
set tcStatFile  [open &#34;[<a name="::get_result_dir(1)"><a href="./result.tcl.html#::get_result_dir_189">::get_result_dir</a></a>]/TCLStatusVars.txt&#34; &#34;a&#34;]
set tcStatFile2 [open &#34;[<a name="::get_result_dir(2)"><a href="./result.tcl.html#::get_result_dir_189">::get_result_dir</a></a>]/PHPStatusVars.txt&#34; &#34;a&#34;]
set testcasestatusfile [open &#34;[<a name="::get_result_dir(3)"><a href="./result.tcl.html#::get_result_dir_189">::get_result_dir</a></a>]/TestcaseStatusList.txt&#34; &#34;a&#34;]

	 if {[regexp {\} skip} $casereport]} {

		set testcasestatusresult &#34;$tc\t:\tSKIPPED&#34;
		puts $testcasestatusfile &#34;$testcasestatusresult&#34;
		set status &#34;SKIPPED&#34;
	} elseif {[regexp {\} 0} $casereport]} {
                set testcasestatusresult &#34;$tc\t:\tFAILED&#34;
                puts $testcasestatusfile &#34;$testcasestatusresult&#34;
                set status &#34;FAILED&#34;
	} else {

               set testcasestatusresult &#34;$tc\t:\tPASSED&#34;
                puts $testcasestatusfile &#34;$testcasestatusresult&#34;
                puts  &#34;***************** $testcasestatusresult&#34;
                set status &#34;PASSED&#34;

	}

    if {![info exists duration]} {
        set duration 0
    }
    set  FEATMAIN(TCRESULTS,$tc)  $status
    puts $tcStatFile &#34;lappend ReportCases \&#34;$tc\&#34;&#34; 
    puts $tcStatFile &#34;set RepResArray($tc) \&#34;$status\&#34;&#34;
    puts $tcStatFile &#34;set RepDurArray($tc) \&#34;$duration\&#34;&#34;
    puts $tcStatFile2 &#34;\$RepResArray\[$tc] = \&#34;$status\&#34;&#34;
    puts $tcStatFile2 &#34;\$RepDurArray\[$tc] = \&#34;$duration\&#34;&#34;

if {$ezinfofile != &#34;&#34;} {


	if {[catch {exec &#34;php /var/www/EzTest/php/tcase_update.php $ezinfofile  $tc $status $duration&#34;} err]} {
		<a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$err&#34;
	}	
 
}
close $tcStatFile
close $tcStatFile2
close $testcasestatusfile
}
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: do_text_test</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Prints a test report to screen or file.</span>
<span class="comment-line">#              called by gen_text_report.            </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: </span>
<span class="comment-line">#              file pointer</span>
<span class="comment-line">#              test</span>
<span class="comment-line">#              data</span>
<span class="comment-line">#              pass or fail</span>
<span class="comment-line">#              level</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              do_text_test $fd $t $d $r level</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::do_text_test_430">proc <a href="report.tcl-annot.html#::::do_text_test">::::do_text_test</a></a></strong> {fd test data res l} {


    upvar $l level
    global tcl_platform	EX_REPORT_PERF
	global offset

    <span class="comment-line"># -- make sure there is data </span>
     
    if {[llength $data] &gt; 0} {
 <span class="comment-line">#      puts &#34; data  &gt; 0 ----&gt; $data level = $level&#34;</span>
	set dores 0
    } else {
	set dores 1
<span class="comment-line">#	puts &#34; data &lt;=0 ----&gt; $data level = $level&#34;</span>
    }
    for {set i 0} {$i &lt; $level} {incr i} {
	puts -nonewline $fd &#34;  &#34;
    }
    set pos [expr {$level * 2}]
    
    <span class="comment-line"># -- split the line out to make it more readable</span>
    set splitFlag &#34;false&#34;
    if {$dores} {
      while {[expr [string length $test] + $pos] &gt; 70 } {
      	for {set len 65} {$len &gt; 10} {incr len -1 } {         
            set char [string range $test $len $len]
            if {$char == &#34; &#34;} { break }
         }
         if {$len &lt; 15} {set len 65}
         puts $fd [string range $test 0 $len]
         set test [string range $test [expr $len + 1] end]
         for {set i 0} {$i &lt; $level} {incr i} {
      		puts -nonewline $fd &#34;  &#34;
   	 }
      	 puts -nonewline $fd &#34;    &#34;
   	 set splitFlag &#34;true&#34;
       }
       if {$splitFlag == &#34;true&#34;} {incr pos 4}
    }
   
    puts -nonewline $fd $test
    incr pos [string length $test]

    <span class="comment-line"># -- move to the end of the line	</span>
    set i [expr {78 - $pos - 8}]
    while {$i &gt; 0} {
	puts -nonewline $fd &#34; &#34;
	incr i -1
    }
    
    <span class="comment-line"># -- passed or failed result</span>
    if {$dores} {
	   if { ($fd == &#34;stdout&#34;) &amp;&amp; ($tcl_platform(platform) == &#34;unix&#34;) } {
		 
  		 if {($res != 0) &amp;&amp; ($res != 1)} {
   			if {$res &lt; 0} {
			   set res [expr $res - $offset]
			}
			puts $fd &#34;\[\033\[1;35m  $res  \033\[0m\]&#34;
		 } else {
			if {$res == 1} {
			puts $fd &#34;\[\033\[1;32m  OK  \033\[0m\]&#34;
			} else {
			puts $fd &#34;\[\033\[1;31mFAILED\033\[0m\]&#34;
			}
		 }
	   } else {
		  if {($res != 0) &amp;&amp; ($res != 1)} {
   			if {$res &lt; 0} {
			   set res [expr $res - $offset]
			}
			puts $fd &#34;\[  $res  ]&#34;
		  } else {
		  if {$res} {
		   puts $fd &#34;\[  OK  \]&#34;
		   } else {
		   puts $fd &#34;\[FAILED\]&#34;
		   }
		  }
	   }
    } else {
	puts $fd &#34;&#34;
    }

    incr level 1
    foreach {t d r} $data {
	<a name="::do_text_test(1)"><a href="./report.tcl.html#::do_text_test_430">::do_text_test</a></a> $fd $t $d $r level
    }
    incr level -1

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: gen_subtests_report</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: this function is called at the end of every test case run</span>
<span class="comment-line">#              It updates the subtestscounts.txt file which has the stats for each testcase</span>
<span class="comment-line">#              P stands for passed, F for failed and S for skipped</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: </span>
<span class="comment-line">#              none </span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              gen_subtests_report </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::gen_subtests_report_540">proc <a href="report.tcl-annot.html#::::gen_subtests_report">::::gen_subtests_report</a></a></strong> {} {

  global currentTestNumber
  global passSubTestsArr
  global failSubTestsArr
  global skipSubTestsArr

  set trimCurrentTestNumber &#34;&#34;
  if  {[info exist currentTestNumber]} {
    set result1 [regexp {\.*([a-zA-Z0-9_\.-]+)\ *} $currentTestNumber ignore trimCurrentTestNumber]
  }
  if {$trimCurrentTestNumber != &#34;&#34;} {
  if {[info exist passSubTestsArr($trimCurrentTestNumber)]} {
    set thisPass $passSubTestsArr($trimCurrentTestNumber)
  } else {
    set thisPass 0
  }
  if {[info exist failSubTestsArr($trimCurrentTestNumber)]} {
    set thisFail $failSubTestsArr($trimCurrentTestNumber)
  } else {
    set thisFail 0
  }
  if {[info exist skipSubTestsArr($trimCurrentTestNumber)]} {
    set thisSkip $skipSubTestsArr($trimCurrentTestNumber)
  } else {
    set thisSkip 0
  }
  set substr $trimCurrentTestNumber
  append substr &#34;:P:&#34;
  append substr $thisPass
  append substr &#34;:F:&#34;
  append substr $thisFail
  append substr &#34;:S:&#34;
  append substr $thisSkip
  append substr &#34;:&#34;

  set fd_out1 [open &#34;[<a name="::get_result_dir(4)"><a href="./result.tcl.html#::get_result_dir_189">::get_result_dir</a></a>]/subtestscounts.txt&#34; &#34;a&#34;];
  puts $fd_out1 $substr
  close $fd_out1;
  }

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: gen_text_report</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Reads in report and prints it in human-readable form to output.</span>
<span class="comment-line">#              Generate the report.txt</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: </span>
<span class="comment-line">#              report - file name</span>
<span class="comment-line">#              out - file name</span>
<span class="comment-line">#              layer</span>
<span class="comment-line">#              fname - file name                </span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              gen_text_report &#34;[get_result_dir]/report.exr&#34; &#34;[get_result_dir]/report.txt&#34; &#34;[file tail [pwd]]&#34; $sourceFile</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::gen_text_report_602">proc <a href="report.tcl-annot.html#::::gen_text_report">::::gen_text_report</a></a></strong> {report out layer {fname &#34;template.cfg&#34;} {tc &#34;&#34;}} {

    global numDUT
    global passCount
    global failCount
    global skipCount
    global tStartDate
    global testDuration
    global lst MAIN
    global EX_REPORT_DATA_1
    <span class="comment-line">#puts &#34;@@@@@ gen_text_report @@@@@@&#34;</span>
    <span class="comment-line">#puts &#34;@@@@@ report=$report&#34;</span>
    <span class="comment-line">#puts &#34;@@@@@ out=$out\n&#34;</span>

    <span class="comment-line"># update subtestscounts.txt file</span>
    <a name="::gen_subtests_report(1)"><a href="./report.tcl.html#::gen_subtests_report_540">::gen_subtests_report</a></a>

    if {![info exists skipCount]} {
       set skipCount 0
    }

    <span class="comment-line"># -- open a new file</span>
    set data [<a name="::ex_cat(1)"><a href="./result.tcl.html#::ex_cat_161">::ex_cat</a></a> $report]
    if {$out != &#34;stdout&#34;} {
	set fd [open $out &#34;w&#34;]
    } else {
 	set fd stdout
    }
    <span class="comment-line"># -- build a header</span>
    puts $fd &#34;\n\n***********************************************************&#34;
    puts $fd &#34;***********************************************************&#34;
    puts $fd         &#34;***                                                     ***&#34;
    puts $fd [format &#34;*** %-12s        Automated Regression Test Summary      ***&#34; $layer]
    puts $fd &#34;***    $layer Automated Regression Test Summary      ***&#34;
    puts $fd &#34;***                  Extreme Networks                   ***&#34;
    puts $fd &#34;***                                                     ***&#34;
    puts $fd &#34;***********************************************************&#34;
    puts $fd &#34;***********************************************************\n&#34;

    puts $fd &#34;For individual test case detail, please reference&#34;
    puts $fd &#34;http://autoregweb\n&#34;
    puts $fd &#34;Using config file: $fname&#34;
    if {[info exists lst]} {
       puts $fd &#34;Using lst: $lst\n&#34;
    }
    if {[info exists MAIN(REPO_VERSION)]} {
       puts $fd &#34;Revision Number: $MAIN(REPO_VERSION)&#34;
    }

    <span class="comment-line"># nellinivasu : Commented remark code as it doesn't have any strategic importance</span>

    <span class="comment-line">#for {set i 1} {$i &lt;= $numDUT} {incr i 1} </span>
    <span class="comment-line">#   global DUTs_info</span>
    <span class="comment-line">#   puts $fd &#34;DUT$i Remark: $DUTs_info(DUT$i,remark)&#34;</span>
    <span class="comment-line">#</span>
    puts $fd &#34;\n&#34;
    <span class="comment-line"># -- display the information about test DUTs</span>
    for {set i 1} {$i &lt;= $numDUT} {incr i 1} {
       global DUT${i}_CONNECT
       global DUT${i}_IP
       global DUTs_info
       set IP [set DUT${i}_IP]
       puts $fd &#34;------------------------DUT$i Information-------------------------&#34;
       puts $fd &#34;Platform=$DUTs_info(DUT$i,platform)\tImageVer=$DUTs_info(DUT$i,version)\tBuilt on=$DUTs_info(DUT$i,verTime)&#34;
       puts $fd &#34;Booted=$DUTs_info(DUT$i,imageBooted)\tIP=$IP\tMAC=$DUTs_info(DUT$i,sysMAC)\tBuilt by=$DUTs_info(DUT$i,relMaster)&#34;
       puts $fd &#34;\n&#34;
    }

    puts $fd &#34;\nnumber of sub test cases passed  = $passCount&#34;
    puts $fd &#34;number of sub test cases failed  = $failCount&#34;
    puts $fd &#34;number of sub test cases skipped = $skipCount&#34;
    puts $fd &#34;\nTest starting time = $tStartDate&#34;
    puts $fd &#34;\nTotal test time = $testDuration seconds&#34;
    puts $fd &#34;    ( [formatSeconds $testDuration] )&#34;
    puts $fd &#34;\n***********************************************************\n&#34;

    <span class="comment-line"># -- call do_text_test to build the test cases result</span>
    set level 0

	<a name="::Statustestcase(1)"><a href="./report.tcl.html#::Statustestcase_357">::Statustestcase</a></a> $EX_REPORT_DATA_1 $tc
    foreach {t d r} $data {
        puts $fd &#34;&#34;

	<a name="::do_text_test(2)"><a href="./report.tcl.html#::do_text_test_430">::do_text_test</a></a> $fd $t $d $r level
    }
    <span class="comment-line"># -- done close the file</span>
    if {$out != &#34;stdout&#34;} { close $fd }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: get_report_dir</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Return the report dir for a particular module</span>
<span class="comment-line">#              Called from runall_monitor.tcli when module</span>
<span class="comment-line">#              gets aborted due to some reason.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#        result_dir - result directory of the module</span>
<span class="comment-line">#        testModule - Test module which got aborted</span>
<span class="comment-line">#        regType - Type of regression i.e. Func/Perf/Scal etc.</span>
<span class="comment-line">#        home - home directory of the automation tree</span>
<span class="comment-line">#</span>
<span class="comment-line"># return Value: Returns the full path of report directory.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         set repDir [get_report_dir $result_dir $tModule $rType &#34;&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::get_report_dir_711">proc <a href="report.tcl-annot.html#::::get_report_dir">::::get_report_dir</a></a></strong> { result_dir testModule regType {home &#34;/auto/branch/automation&#34;}} {
   set regDir &#34;&#34;
   set regType [ string tolower $regType ]
   switch  -regexp $regType {
     &#34;func*&#34; { set regDir &#34;$home/Functionaltest&#34; }
     &#34;perf*&#34; { set regDir &#34;$home/PerformanceTest&#34; }
     &#34;scala*&#34; { set regDir &#34;$home/Scalabilitytest&#34; }
     &#34;bench*&#34; { set regDir &#34;$home/Benchmarktest&#34; }
     &#34;cli&#34; { set regDir &#34;$home/CLItest/uploadanddownload&#34; }
     default { set regDir &#34; &#34; }
   }
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Regression dir = $regDir&#34;
   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;result_dir  = $result_dir&#34;
   <span class="comment-line"># lets get the report directory from the result directory file reportdir.txt</span>
   set fd_in [open &#34;$result_dir/reportdir.txt&#34; &#34;r&#34;];
   gets $fd_in report_dir_short
   set report_dir &#34;$regDir/$testModule/$report_dir_short&#34;
   <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;report_dir  = $report_dir&#34;
   close $fd_in;
   return $report_dir
   
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetReportDir (old version)</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Return the report dir for a particular module</span>
<span class="comment-line">#              Called from runall_monitor.tcli when module</span>
<span class="comment-line">#              gets aborted due to some reason.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#        testModule - Test module which got aborted</span>
<span class="comment-line">#        regType - Type of regression i.e. Func/Perf/Scal etc.</span>
<span class="comment-line">#        platform - Platform</span>
<span class="comment-line">#        blade - Blade type</span>
<span class="comment-line">#        imageVer - Image version on the DUT</span>
<span class="comment-line">#</span>
<span class="comment-line"># return Value: Returns the full path of report directory.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         set repDir [GetReportDir $tModule $rType $ptf $bld $img]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetReportDir_755">proc <a href="report.tcl-annot.html#::::GetReportDir">::::GetReportDir</a></a></strong> { testModule regType platform blade imageVer {home &#34;/auto/branch/automation&#34;}} {
   global DUTs_info
   set pwd [pwd]
   set regDir &#34;&#34;
   set regType [ string tolower $regType ]
   switch  -regexp $regType {
     &#34;func*&#34; { set regDir &#34;$home/Functionaltest&#34; }
     &#34;perf*&#34; { set regDir &#34;$home/PerformanceTest&#34; }
     &#34;scala*&#34; { set regDir &#34;$home/Scalabilitytest&#34; }
     &#34;bench*&#34; { set regDir &#34;$home/Benchmarktest&#34; }
     &#34;cli&#34; { set regDir &#34;$home/CLItest/uploadanddownload&#34; }
     default { set regDir &#34; &#34; }
   }
   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Regression dir = $regDir&#34;
   cd $regDir
   set allFiles [glob -- *]
   set regModules &#34;&#34;
   foreach module $allFiles {
       if {[file isdir $module]} {
           lappend regModules $module
        }
   }
   set modulename &#34;&#34;
   foreach regModule $regModules {
       set match &#34;&#34;
       set str &#34;&#34;
       if {[regexp -nocase &#34;(^$testModule.*)&#34; $regModule match str]} {
           set modulename $str
        }
   }
   set tmp &#34;$regDir/$modulename/Report&#34;
   set date  [clock format [clock seconds] -format &#34;%Y-%m-%d&#34;]

   <span class="comment-line"># set index 0</span>
   <span class="comment-line"># set reportDir &#34;$tmp/$date $platform $blade  $imageVer $index&#34;</span>
   <span class="comment-line"># while { [file exists $reportDir] == 1 } {</span>
      <span class="comment-line"># incr index </span>
      <span class="comment-line"># set reportDir &#34;$tmp/$date $platform $blade  $imageVer $index&#34;</span>
   <span class="comment-line"># }</span>

   set index 0
   set goOn 1
   while {$goOn == 1} {
     set reportDirList [glob -nocomplain -- &#34;$tmp/*$platform*$blade*$imageVer $index&#34;]
     if {[llength $reportDirList] &gt; 0} {
       incr index
     } else {
       set goOn 0
     }
   }
   set index [expr $index - 1]
   set reportDir &#34;$tmp/$date $platform $blade  $imageVer $index&#34;


   cd $pwd
   return $reportDir
}
<span class="comment-line">#################################################################################</span>
<span class="comment-line"># Procedure: _get_report_txt_subcounts</span>
<span class="comment-line">#</span>
<span class="comment-line"># Returns the subtest count using grep instead of parsing the report.txt</span>
<span class="comment-line">#</span>
<span class="comment-line">#################################################################################</span>
<strong><a name="::::_get_report_txt_subcounts_818">proc <a href="report.tcl-annot.html#::::_get_report_txt_subcounts">::::_get_report_txt_subcounts</a></a></strong> {args} {
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _get_report_txt_subcounts $args {
       reportFile  &#34;&#34;
       state       &#34;null&#34;
    }

    set gotIt 0
    if {[regexp -nocase &#34;pass&#34; $state]} {
        set find &#34;number of sub test cases passed&#34;
    } elseif {[regexp -nocase &#34;fail&#34; $state]} {
        set find &#34;number of sub test cases failed&#34;
    } elseif {[regexp -nocase &#34;skip&#34; $state]} {
        set find &#34;number of sub test cases skipped&#34;
    }
    if {![catch {exec grep &#34;$find&#34; $reportFile} matchPhrase]} {
        set olist [split $matchPhrase &#34; &#34;]
        set gotIt [lindex $olist [expr [llength $olist] -1]]
        return $gotIt
    } else {
        puts &#34;Could not find the $state sub cases in $reportFile&#34;
    }
    return $gotIt
}
<span class="comment-line">#################################################################################</span>
<span class="comment-line"># Procedure: _get_report_txt_subverion</span>
<span class="comment-line">#</span>
<span class="comment-line"># Returns the subversion rev using grep instead of parsing the report.txt</span>
<span class="comment-line">#</span>
<span class="comment-line">#################################################################################</span>
<strong><a name="::::_get_report_txt_subverion_847">proc <a href="report.tcl-annot.html#::::_get_report_txt_subverion">::::_get_report_txt_subverion</a></a></strong> {args} {
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _get_report_txt_subverion $args {
       reportFile  &#34;&#34;
    }

    set gotIt 0
    set find &#34;Revision Number:&#34;
    if {![catch {exec grep &#34;$find&#34; $reportFile} matchPhrase]} {
        set olist [split $matchPhrase &#34; &#34;]
        set gotIt [lindex $olist [expr [llength $olist] -1]]
        return $gotIt
    } else {
        puts &#34;Could not find subverion rev in $reportFile&#34;
    }
    return $gotIt
}
<span class="comment-line">#################################################################################</span>
<span class="comment-line"># Procedure: _get_report_txt_duration</span>
<span class="comment-line">#</span>
<span class="comment-line"># Returns the feature duration using grep instead of parsing the report.txt</span>
<span class="comment-line">#</span>
<span class="comment-line">#################################################################################</span>
<strong><a name="::::_get_report_txt_duration_869">proc <a href="report.tcl-annot.html#::::_get_report_txt_duration">::::_get_report_txt_duration</a></a></strong> {args} {
    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _get_report_txt_duration $args {
       reportFile  &#34;&#34;
    }

    set gotIt 0
    set find &#34;Total test time &#34;
    if {![catch {exec grep &#34;$find&#34; $reportFile} matchPhrase]} {
        set olist [split $matchPhrase &#34; &#34;]
        set gotIt [lindex $olist [expr [llength $olist] -2]]
        return $gotIt
    } else {
        puts &#34;Could not find Total test time in $reportFile&#34;
    }
    return $gotIt
}

<span class="comment-line">#################################################################################</span>
<span class="comment-line"># Procedure: _get_report_txt_version</span>
<span class="comment-line">#</span>
<span class="comment-line"># Returns the subversion rev using grep instead of parsing the report.txt</span>
<span class="comment-line">#</span>
<span class="comment-line">#################################################################################</span>
<strong><a name="::::_get_report_txt_version_892">proc <a href="report.tcl-annot.html#::::_get_report_txt_version">::::_get_report_txt_version</a></a></strong> {args} {
    <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _get_report_txt_version $args {
       reportFile  &#34;&#34;
    }

    set gotIt &#34;0.0.0.0&#34;
    set find &#34;DUT1 Information&#34;
    if {![catch {exec grep -C 2 &#34;$find&#34; $reportFile} matchPhrase]} {
        regsub -all &#34;\t|\n|\[ ]{3,10}&#34; $matchPhrase &#34;  &#34; matchPhrase
        if {[regexp -nocase &#34;  ImageVer\=(\[0-9a-z\.\-_]+)  &#34; $matchPhrase a me]} {
            set gotIt $me
            return $gotIt
        }
    } else {
        puts &#34;Could not find DUT1 version in $reportFile&#34;
    }
    return $gotIt
}
<span class="comment-line">#################################################################################</span>
<span class="comment-line"># Procedure: _get_report_txt_core_uploaded</span>
<span class="comment-line">#</span>
<span class="comment-line"># Returns true if a test case for uploading a core using grep instead </span>
<span class="comment-line">#            of parsing the report.txt</span>
<span class="comment-line">#</span>
<span class="comment-line">#################################################################################</span>
<strong><a name="::::_get_report_txt_core_uploaded_917">proc <a href="report.tcl-annot.html#::::_get_report_txt_core_uploaded">::::_get_report_txt_core_uploaded</a></a></strong> {args} {
    <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _get_report_txt_core_uploaded $args {
       reportFile  &#34;&#34;
    }

    set out &#34;null&#34;
    set matchPhrase &#34;NULL&#34;
    set find &#34;There is a coredump file on DUT&#34;
    if {![catch {exec grep -C 1 &#34;$find&#34; $reportFile} matchPhrase]} {
        if {$matchPhrase == &#34;NULL&#34; || [string trim $matchPhrase] == &#34;&#34;} {
            <span class="comment-line"># not change</span>
        } elseif {[string length $matchPhrase] &gt; 10} {
            set out &#34;core&#34;;
        }
    }
    set matchPhrase &#34;NULL&#34;
    set find &#34;Moved the code coverage file from DUT&#34;
    if {![catch {exec grep -C 1 &#34;$find&#34; $reportFile} matchPhrase]} {
        if {$matchPhrase == &#34;NULL&#34; || [string trim $matchPhrase] == &#34;&#34;} {
            <span class="comment-line"># not change</span>
        } elseif {[string length $matchPhrase] &gt; 10} {
            if {$out == &#34;core&#34;} {
                set out &#34;both&#34;
            } else {
                set out &#34;ccov&#34;
            }
        }
    }
    return $out
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
