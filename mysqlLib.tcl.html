<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>mysqlLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#mysqlLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>mysqlLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="mysqlLib.tcl-annot.html">annotations</a> | <a href="mysqlLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
catch {package require mysqltcl}
catch {package require ftp};
catch {package require http 1.0};

global this_db
set this_db &#34;&#34;

<strong><a name="::::conn_to_db_8">proc <a href="mysqlLib.tcl-annot.html#::::conn_to_db">::::conn_to_db</a></a></strong> { host db  {user regression_user} {password extreme}} {
  global mysqlstatus mysql_handler this_db MAIN
  set this_db $db

  set connected &#34;no&#34;

  if {0} {
  if {[info exists mysql_handler]} {
    set status [mysqlstate $mysql_handler]
    <span class="comment-line">#puts &#34;status $status&#34;</span>
    if {$status == &#34;IN_USE&#34;} {
      set connected &#34;yes&#34;
    }
  }
  }

  if {[info exists mysql_handler]} {
     catch {mysqlclose $mysql_handler} result
  }
  set mysqlstatus(code) 0
  if {$connected == &#34;no&#34;} {
    catch {mysqlconnect -host $host -user $user -password $password -db $db} mysql_handler
    <span class="comment-line">#puts $mysqlstatus(code);</span>
    if {$mysqlstatus(code) !=0} {
        puts stderr $mysqlstatus(message)
        puts &#34;First attempt to connect failed: $mysqlstatus(message)&#34;
        <span class="comment-line">#mysqlclose $mysql_handler</span>
        catch {mysqlconnect -host $host -user $user -password $password -db $db} mysql_handler
        <span class="comment-line">#puts $mysqlstatus(code);</span>
        if {$mysqlstatus(code) !=0} {
            puts stderr $mysqlstatus(message)
            <span class="comment-line">#mysqlclose $mysql_handler</span>
            return $mysqlstatus(code)
        }
    }
    <span class="comment-line">#mysqlexec  $mysql_handler &#34;SET max_allowed_packet=50000000&#34;</span>
    set MAIN(RESDBHANDLE) $mysql_handler
    return $mysqlstatus(code)
  } else {
    set MAIN(RESDBHANDLE) $mysql_handler
    return $status
  }
}

<span class="comment-line">##########################################################################</span>
<span class="comment-line"># proc disconnect_db</span>
<span class="comment-line">#</span>
<span class="comment-line"># Disconnect from a mysql handle</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical Usage:</span>
<span class="comment-line">#   disconnect_db mysql_handler</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::disconnect_db_61">proc <a href="mysqlLib.tcl-annot.html#::::disconnect_db">::::disconnect_db</a></a></strong> {dbhandle} {

    global $dbhandle
    if {[info exists $dbhandle]} {
        if [catch {mysqlclose [set $dbhandle]} res] {
            puts &#34;Failed to close handle $dbhandle: $res&#34;
        }
    } else {
        puts &#34;Variable $dbhandle does not exist&#34;
    }

}
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Initial use in the queuing system.  This allows for connection to a</span>
<span class="comment-line">#   local db as well as the regserver database for posting directly.</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::conn_to_multi_db_82">proc <a href="mysqlLib.tcl-annot.html#::::conn_to_multi_db">::::conn_to_multi_db</a></a></strong> { host db } {
    global mysqlstatus mysql_handler this_db mysql_pipe
    set this_db $db
    set user regression_user
    set password extreme

    set connected &#34;no&#34;

    if {[info exists mysql_pipe($db)]} {
        set status [mysqlstate $mysql_pipe($db)]
        puts &#34;status $status&#34;
        if {$status == &#34;IN_USE&#34;} {
            set connected &#34;yes&#34;
        } else {
            catch {mysqlclose $mysql_pipe($db)} result
        }
    }

    if {$connected == &#34;no&#34;} {
        catch {mysqlconnect -host $host -user $user -password $password -db $db} mysql_pipe($db)
        <span class="comment-line">#puts $mysqlstatus(code);</span>
        if {$mysqlstatus(code) !=0} {
            puts stderr $mysqlstatus(message)
            <span class="comment-line">#mysqlclose $mysql_handler</span>
            return -1
        }
puts &#34;1 Returning pipe $mysql_pipe($db)&#34;  
        return $mysql_pipe($db)
    } else {
puts &#34;2 Returning pipe $mysql_pipe($db)&#34;
        return $mysql_pipe($db)
    }
}
<span class="comment-line">###########################################################################</span>
<strong><a name="::::conn_to_autoweb_db_116">proc <a href="mysqlLib.tcl-annot.html#::::conn_to_autoweb_db">::::conn_to_autoweb_db</a></a></strong> { host } {
  global mysqlstatus mysql_handler my_db
  set user regression_user
  set password extreme
  catch {mysqlconnect -host $host -user $user -password $password -db $my_db} mysql_handler
  <span class="comment-line">#puts $mysqlstatus(code);</span>
  if {$mysqlstatus(code) !=0} {
      puts stderr $mysqlstatus(message)
      <span class="comment-line">#mysqlclose $mysql_handler</span>
     return $mysqlstatus(code)
  }
  <span class="comment-line">#mysqlexec  $mysql_handler &#34;SET max_allowed_packet=50000000&#34;</span>
  return $mysqlstatus(code)
}

<strong><a name="::::conn_to_devweb_db_131">proc <a href="mysqlLib.tcl-annot.html#::::conn_to_devweb_db">::::conn_to_devweb_db</a></a></strong> { host } {
  global mysqlstatus mysql_handler
  set user regression_user
  set password extreme
  catch {mysqlconnect -host $host -user $user -password $password -db devweb_db} mysql_handler
  <span class="comment-line">#puts $mysqlstatus(code);</span>
  if {$mysqlstatus(code) !=0} {
      puts stderr $mysqlstatus(message)
      <span class="comment-line">#mysqlclose $mysql_handler</span>
     return $mysqlstatus(code)
  }
  <span class="comment-line">#mysqlexec  $mysql_handler &#34;SET max_allowed_packet=50000000&#34;</span>
  return $mysqlstatus(code)
}
<span class="comment-line">##############################################################################</span>
<span class="comment-line"># Connect to a db and return a handle.. no globals.. short and sweet</span>
<span class="comment-line">#</span>
<span class="comment-line">##############################################################################</span>
<strong><a name="::::quick_db_connect_149">proc <a href="mysqlLib.tcl-annot.html#::::quick_db_connect">::::quick_db_connect</a></a></strong> { host db} {
    global mysqlstatus
    set user regression_user
    set password extreme
    if {[catch {mysqlconnect -host $host -user $user -password $password -db $db} handle]} {
        puts &#34;\nFAILED TO Connect to db -host $host -user $user&#34;
        return &#34;fail&#34;
    }
    puts &#34;\nConnect to db -host $host -user $user&#34;
    return $handle
}


<strong><a name="::::InsertIntoBuildTable_162">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoBuildTable">::::InsertIntoBuildTable</a></a></strong> {args} {
  <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoBuildTable $args {
    system_id &#34;2&#34;
    build_major_release &#34;&#34;
    build_minor_release &#34;&#34;
    build_number &#34;&#34;
    build_branch_number &#34;&#34;
    build_by &#34;&#34;
    build_time &#34;&#34;
    host &#34;&#34;
    db_name &#34;&#34;
    target_phase &#34;&#34;
  }

  global mysql_handler
  <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
    <span class="comment-line">#return -1</span>
  <span class="comment-line">#} else {</span>
    <span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
  <span class="comment-line">#}</span>

  set insert_clause [append insert_clause &#34;insert into build_table (system_id, &#34;]
  set insert_clause [append insert_clause &#34;build_major_release, &#34;]
  set insert_clause [append insert_clause &#34;build_minor_release, &#34;]
  set insert_clause [append insert_clause &#34;build_number, &#34;]
  set insert_clause [append insert_clause &#34;build_branch_number, &#34;]
  set insert_clause [append insert_clause &#34;build_by, &#34;]
  set insert_clause [append insert_clause &#34;build_time, &#34;]
  set insert_clause [append insert_clause &#34;db_name, &#34;]
  set insert_clause [append insert_clause &#34;target_phase)&#34;]

  set insert_clause [append insert_clause &#34;values (\&#34;$system_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$build_major_release\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$build_minor_release\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$build_number\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$build_branch_number\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$build_by\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$build_time\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$db_name\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$target_phase\&#34;)&#34;]
  puts &#34;$insert_clause\r&#34;

  mysqlexec  $mysql_handler $insert_clause
  <span class="comment-line">#mysqlclose $mysql_handler</span>
  return 0
}

<strong><a name="::::InsertIntoFeatureTable_209">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoFeatureTable">::::InsertIntoFeatureTable</a></a></strong> {args} {
  <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoFeatureTable $args {
    system_id &#34;2&#34;
    start_release_id &#34;&#34;
    end_release_id &#34;&#34;
    feature_type &#34;&#34;
    feature_sub_type &#34;&#34;
    feature_name &#34;&#34;
    feature_expected_exec_time &#34;&#34;
    feature_rse &#34;&#34;
    feature_rsm &#34;&#34;
    feature_aa &#34;&#34;
    host &#34;&#34;
  }

  global mysql_handler
  <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
    <span class="comment-line">#return -1</span>
  <span class="comment-line">#} else {</span>
    <span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
  <span class="comment-line">#}</span>

  set insert_clause [append insert_clause &#34;insert into feature_table (system_id, &#34;]
  set insert_clause [append insert_clause &#34;start_release_id, &#34;]
  set insert_clause [append insert_clause &#34;end_release_id, &#34;]
  set insert_clause [append insert_clause &#34;feature_type, &#34;]
  set insert_clause [append insert_clause &#34;feature_sub_type, &#34;]
  set insert_clause [append insert_clause &#34;feature_name, &#34;]
  set insert_clause [append insert_clause &#34;feature_expected_exec_time, &#34;]
  set insert_clause [append insert_clause &#34;feature_rse, &#34;]
  set insert_clause [append insert_clause &#34;feature_rsm, &#34;]
  set insert_clause [append insert_clause &#34;feature_aa) &#34;]

  set insert_clause [append insert_clause &#34;values (\&#34;$system_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$start_release_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$end_release_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_type\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_sub_type\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_name\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_expected_exec_time\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_rse\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_rsm\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_aa\&#34;)&#34;]
  <span class="comment-line">#puts &#34;$insert_clause\r&#34;</span>

  mysqlexec  $mysql_handler $insert_clause
  <span class="comment-line">#mysqlclose $mysql_handler</span>
  return 0
}



<strong><a name="::::InsertIntoRegressionTable_261">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoRegressionTable">::::InsertIntoRegressionTable</a></a></strong> {args} {
  <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoRegressionTable $args {
    queue_id &#34;&#34;
    build_id &#34;&#34;
    platform_id &#34;&#34;
    total_number_of_runs &#34;1&#34;
    html_pd &#34;&#34;
    feature_type &#34;&#34;
    feature_sub_type &#34;&#34;
    host &#34;&#34;
  }

  global mysql_handler
  <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
    <span class="comment-line">#return -1</span>
  <span class="comment-line">#} else {</span>
    <span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
  <span class="comment-line">#}</span>

  set insert_clause [append insert_clause &#34;insert into regression_table &#34;]
  set insert_clause [append insert_clause &#34;(queue_id, &#34;]
  set insert_clause [append insert_clause &#34;build_id, &#34;]
  set insert_clause [append insert_clause &#34;platform_id, &#34;]
  set insert_clause [append insert_clause &#34;html_pd, &#34;]
  set insert_clause [append insert_clause &#34;feature_type, &#34;]
  set insert_clause [append insert_clause &#34;feature_sub_type, &#34;]
  set insert_clause [append insert_clause &#34;total_number_of_runs) &#34;]

  set insert_clause [append insert_clause &#34;values (\&#34;$queue_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$build_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$platform_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$html_pd\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_type\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_sub_type\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$total_number_of_runs\&#34;)&#34;]

  <span class="comment-line">#puts &#34;InsertIntoRegressionTable insert_clause: \n$insert_clause&#34;</span>
  set rslt [mysqlexec  $mysql_handler $insert_clause]
  puts &#34;InsertIntoRegressionTable returns: $rslt&#34;
  <span class="comment-line">#mysqlclose $mysql_handler</span>
  return 0
}


<strong><a name="::::IncrNmbrRunsInRegressionTable_305">proc <a href="mysqlLib.tcl-annot.html#::::IncrNmbrRunsInRegressionTable">::::IncrNmbrRunsInRegressionTable</a></a></strong> {args} {
  <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoRegressionTable $args {
    regression_id &#34;1&#34;
    host &#34;&#34;
  }

  global mysql_handler
  <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
    <span class="comment-line">#return -1</span>
  <span class="comment-line">#} else {</span>
    <span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
  <span class="comment-line">#}</span>

  set total_number_of_runs [mysqlsel $mysql_handler &#34;SELECT total_number_of_runs FROM regression_table WHERE regression_id = \&#34;$regression_id\&#34;&#34; -list]
  <span class="comment-line">#puts &#34;total_number_of_runs = $total_number_of_runs&#34;</span>
  incr total_number_of_runs

  set update_clause [append update_clause &#34;update regression_table &#34;]
  set update_clause [append update_clause &#34;set total_number_of_runs=\&#34;$total_number_of_runs\&#34; &#34;]
  set update_clause [append update_clause &#34;where regression_id=\&#34;$regression_id\&#34;&#34;]

  mysqlexec  $mysql_handler $update_clause
  <span class="comment-line">#mysqlclose $mysql_handler</span>
  return 0
}

<strong><a name="::::createFileBlob_331">proc <a href="mysqlLib.tcl-annot.html#::::createFileBlob">::::createFileBlob</a></a></strong> { fileDir fileBlob } {
  upvar $fileBlob fileBlobTmp

  set fList [split $fileDir &#34;.&#34;]
  set isHtml 0
  if {[lindex $fList [expr [llength $fList] -1]] == &#34;html&#34;} {
      set isHtml 1
  }
  set maxSize 6000000
  if {[file exists &#34;$fileDir&#34;] == 0} {
    set fileBlobTmp &#34;\n\n\n $fileDir does not exist\n\n\n&#34;
    return 0
  }

  set fileBlobSize [file size &#34;$fileDir&#34;]
  puts &#34;fileBlobSize $fileBlobSize&#34;

  if {[catch {open &#34;$fileDir&#34; r} fd]} {
    puts &#34; !!!! ERROR : $fd    !!!!&#34;
    return -1
  }

  <span class="comment-line">#puts &#34;$fileBlob opened&#34;</span>

  set fileBlobTmp &#34;&#34;;
  <span class="comment-line"># we limit the uploaded string to 6MB bytes</span>
  if {$fileBlobSize &gt; $maxSize} {
    set fileBlobTmp &#34;File too large - truncated to 6MB\n\n\n&#34;;
    puts &#34;File too large - truncated to 6MB&#34;;
  }
  
  <span class="comment-line"># let's read the file up to size of 6MB</span>
  set totalLength 0;
  set contAppending &#34;yes&#34;;
  set nlSize [string bytelength &#34;\n&#34;];
  while {([gets $fd line] != -1) &amp;&amp; ($contAppending == &#34;yes&#34;)} {
    set lineSize [string bytelength $line]
    set totalLength [expr $totalLength + $lineSize +$nlSize];
    if {$totalLength &gt; $maxSize} {
      set contAppending &#34;no&#34;;
      puts &#34;truncating at size $totalLength&#34;;
    } else {
      set fileBlobTmp [append fileBlobTmp $line];
      set fileBlobTmp [append fileBlobTmp &#34;\n&#34;];
    }
  }
  if {1} {
      set fileBlobTmp [string map {&#34;\x22&#34; &#34;&amp;#34;&#34; &#34;\x3c&#34; &#34;&amp;#60;&#34; &#34;\x3e&#34; &#34;&amp;#62;&#34;} $fileBlobTmp];
  }
  <span class="comment-line"># if this is report.txt clear the extra color info characters</span>
  if { [regexp &#34;report.txt&#34; $fileDir] } {
    set fileBlobTmp [string map {} $fileBlobTmp];
  }
  <span class="comment-line">#set fileBlobTmp [string map {&#34;\x22&#34; &#34;\x27&#34; &#34;\x3c&#34; &#34;\x3c\x20&#34; &#34;\x3e&#34; &#34;\x20\x3e&#34;} $fileBlobTmp]</span>
  <span class="comment-line">#set fileBlobTmp [string map {&#34;\x22&#34; &#34;\x5c\x22&#34;} $fileBlobTmp]</span>
  <span class="comment-line">#puts $fileBlobTmp</span>
  <span class="comment-line">#puts &#34;Blob length: [string bytelength $fileBlobTmp]&#34;</span>

  close $fd
  return 0
}


<strong><a name="::::InsertIntoTestFileTable_394">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoTestFileTable">::::InsertIntoTestFileTable</a></a></strong> {args} {
  <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoTestFileTable $args {
    file_content &#34;&#34;
    host &#34;&#34;
  }

  global mysql_handler
  <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
    <span class="comment-line">#return -1</span>
  <span class="comment-line">#} else {</span>
    <span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
  <span class="comment-line">#}</span>

  set insert_clause [append insert_clause &#34;insert into test_file_table &#34;]
  set insert_clause [append insert_clause &#34;(file_content) &#34;]

  set insert_clause [append insert_clause &#34;values (\&#34;$file_content\&#34;)&#34;]

  mysqlexec  $mysql_handler $insert_clause
  <span class="comment-line">#mysqlclose $mysql_handler</span>
  return 0
}

<span class="comment-line">#####################################################################################</span>
<span class="comment-line"># Procedure: InsertIntoAuxLogTable</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#####################################################################################</span>
<strong><a name="::::InsertIntoAuxLogTable_423">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoAuxLogTable">::::InsertIntoAuxLogTable</a></a></strong> {args} {
    <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoAuxLogTable $args {
        log_id     &#34;&#34;
        fa_cause   &#34;software&#34;
        cr         &#34;&#34;
        cr_status  &#34;&#34;
        handle     &#34;&#34;
    }

    set insert_clause [append insert_clause &#34;insert into aux_log_table &#34;]
    set insert_clause [append insert_clause &#34;(log_id, &#34;]
    set insert_clause [append insert_clause &#34;fa_cause, &#34;]
    set insert_clause [append insert_clause &#34;cr, &#34;]
    set insert_clause [append insert_clause &#34;cr_status) &#34;]

    set insert_clause [append insert_clause &#34;values (\&#34;$log_id\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$fa_cause\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$cr\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$cr_status\&#34;)&#34;]

    mysqlexec  $handler $insert_clause

}
<strong><a name="::::InsertIntoReportTable_446">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoReportTable">::::InsertIntoReportTable</a></a></strong> {args} {
  <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoReportTable $args {
    regression_id &#34;&#34;
    feature_id &#34;&#34;
    build_id &#34;&#34;
    run_number &#34;&#34;
    run_type &#34;regular&#34;
    test_result &#34;&#34;
    test_report_file_content &#34;&#34;
    test_report_date &#34;&#34;
    test_report_duration &#34;&#34;
    test_quick_duration &#34;&#34;
    test_pass_duration &#34;&#34;
    test_all_duration &#34;&#34;
    test_main_file_content &#34;&#34;
    test_dut1_log_file_content &#34;&#34;
    test_dut2_log_file_content &#34;&#34;
    test_dut3_log_file_content &#34;&#34;
    test_dut4_log_file_content &#34;&#34;
    test_dut5_log_file_content &#34;&#34;
    test_system_setup_file_content &#34;&#34;
    test_exec_time_file_content &#34;&#34;
    test_info_file_content &#34;&#34;
    test_topology_file_content &#34;&#34;
    host &#34;&#34;
  }

  global mysql_handler
  <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
    <span class="comment-line">#return -1</span>
  <span class="comment-line">#} else {</span>
    <span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
  <span class="comment-line">#}</span>

  set insert_clause [append insert_clause &#34;insert into report_table &#34;]
  set insert_clause [append insert_clause &#34;(regression_id, &#34;]
  set insert_clause [append insert_clause &#34;feature_id, &#34;]
  set insert_clause [append insert_clause &#34;build_id, &#34;]
  set insert_clause [append insert_clause &#34;run_number, &#34;]
  set insert_clause [append insert_clause &#34;run_type, &#34;]
  set insert_clause [append insert_clause &#34;test_result, &#34;]
  set insert_clause [append insert_clause &#34;test_report_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_report_date, &#34;]
  set insert_clause [append insert_clause &#34;test_report_duration, &#34;]
  set insert_clause [append insert_clause &#34;test_quick_duration, &#34;]
  set insert_clause [append insert_clause &#34;test_pass_duration, &#34;]
  set insert_clause [append insert_clause &#34;test_all_duration, &#34;]
  set insert_clause [append insert_clause &#34;test_main_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_dut1_log_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_dut2_log_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_dut3_log_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_dut4_log_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_dut5_log_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_system_setup_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_exec_time_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_info_file_content, &#34;]
  set insert_clause [append insert_clause &#34;test_topology_file_content) &#34;]

  set insert_clause [append insert_clause &#34;values (\&#34;$regression_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$build_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$run_number\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$run_type\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_result\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_report_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_report_date\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_report_duration\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_quick_duration\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_pass_duration\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_all_duration\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_main_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_dut1_log_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_dut2_log_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_dut3_log_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_dut4_log_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_dut5_log_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_system_setup_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_exec_time_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_info_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$test_topology_file_content\&#34;)&#34;]

  mysqlexec  $mysql_handler $insert_clause
  <span class="comment-line">#mysqlclose $mysql_handler</span>
  return 0
}

<strong><a name="::::InsertAllIntoReportTable_532">proc <a href="mysqlLib.tcl-annot.html#::::InsertAllIntoReportTable">::::InsertAllIntoReportTable</a></a></strong> {args} {
  <a name="::parse_args(8)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertAllIntoReportTable $args {
    regression_id &#34;&#34;
    feature_id &#34;&#34;
    build_id   &#34;&#34;
    run_number &#34;1&#34;
    run_type &#34;regular&#34;
    report_directory &#34;&#34;
    host &#34;&#34;
  }

  global mysql_handler

  set d1 [exec date +%Y-%m-%d]
  set d2 [exec date +%k:%M:%S]
  set d [append d $d1]
  set d [append d &#34; &#34;]
  set d [append d $d2]
  <span class="comment-line">#puts $d</span>

  set regularInsert 1



  if {  $run_type == &#34;results&#34; } {
    <span class="comment-line"># is there a downloadImage entry ? - reuse it</span>
    set report_id_list [mysqlsel $mysql_handler &#34;SELECT report_id  FROM report_table \
                       WHERE regression_id = \&#34;$regression_id\&#34;  \
                       AND   feature_id  = \&#34;$feature_id\&#34; \
                       AND   run_type  = \&#34;downloadImage\&#34; \
                       ORDER BY report_id DESC LIMIT 1 &#34; -list]
    puts &#34;llength of report_id_list: [llength $report_id_list]&#34;
    if {([llength $report_id_list] != 0)} {
      set report_id [lindex $report_id_list 0]
      <span class="comment-line"># reuse this report_id</span>
      <a name="::createFileBlob(1)"><a href="./mysqlLib.tcl.html#::createFileBlob_331">::createFileBlob</a></a> $report_directory/report.txt reportBlob
      set update_clause &#34;UPDATE  report_table SET test_report_file_content = \&#34;$reportBlob\&#34;, \
                         test_report_date = \&#34;$d\&#34;, \
                         run_number = \&#34;$run_number\&#34;, \
                         test_info_file_content = \&#34;$report_directory\&#34;, \
                         run_type = \&#34;$run_type\&#34; \
                         WHERE report_id = \&#34;$report_id\&#34;&#34;
        <span class="comment-line">#puts &#34;InsertAllIntoReportTable: update_clause $update_clause&#34;</span>
	mysqlexec $mysql_handler $update_clause
        set regularInsert 0
    } else {
      set regularInsert 1
    }
  }

  if { $regularInsert == &#34;1&#34; } {
    set prams_clause [append parat_clause &#34;-regression_id \&#34;\$regression_id\&#34; &#34;]
    set prams_clause [append parat_clause &#34;-feature_id \&#34;\$feature_id\&#34; &#34;]
    set prams_clause [append parat_clause &#34;-build_id \&#34;\$build_id\&#34; &#34;]
    set prams_clause [append parat_clause &#34;-run_number \&#34;\$run_number\&#34; &#34;]
    set prams_clause [append parat_clause &#34;-run_type \&#34;\$run_type\&#34; &#34;]
    set prams_clause [append parat_clause &#34;-test_report_date \&#34;$d\&#34; &#34;]
    set prams_clause [append parat_clause &#34;-test_info_file_content \&#34;$report_directory\&#34; &#34;]
  
    if {[<a name="::createFileBlob(2)"><a href="./mysqlLib.tcl.html#::createFileBlob_331">::createFileBlob</a></a> $report_directory/report.txt reportBlob] == 0} {
      set prams_clause [append parat_clause &#34;-test_report_file_content \&#34;\$reportBlob\&#34; &#34;]
    } 
    <span class="comment-line">#puts $prams_clause</span>
    eval InsertIntoReportTable  $prams_clause -host $host
  }



}



<strong><a name="::::InsertIntoLogTable_604">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoLogTable">::::InsertIntoLogTable</a></a></strong> {args} {
    <a name="::parse_args(9)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoLogTable $args {
        report_id &#34;&#34;
        feature_id &#34;&#34;
        build_id &#34;&#34;
        feature_test_script_name &#34;&#34;
        feature_test_file_content &#34;&#34;
        log_file_content &#34;&#34;
        host &#34;&#34;
        status &#34;&#34;
        pd_number &#34;&#34;
        duration  &#34;&#34;
    }

    global mysql_handler MAIN CRINFO

    if {[llength $pd_number] &gt; 1} {
        set pd [lindex $pd_number 0]
    } else {
        set pd $pd_number
    }

    set d1 [exec date +%Y-%m-%d]
    set d2 [exec date +%k:%M:%S]
    set d [append d $d1]
    set d [append d &#34; &#34;]
    set d [append d $d2]

    set insert_clause [append insert_clause &#34;insert into log_table &#34;]
    set insert_clause [append insert_clause &#34;(report_id, &#34;]
    set insert_clause [append insert_clause &#34;feature_id, &#34;]
    set insert_clause [append insert_clause &#34;build_id, &#34;]
    set insert_clause [append insert_clause &#34;feature_test_script_name, &#34;]
    set insert_clause [append insert_clause &#34;feature_test_file_content, &#34;]
    set insert_clause [append insert_clause &#34;status, &#34;]
    set insert_clause [append insert_clause &#34;pd_number, &#34;]
    set insert_clause [append insert_clause &#34;log_duration, &#34;]
    set insert_clause [append insert_clause &#34;log_date, &#34;]
    set insert_clause [append insert_clause &#34;log_file_content) &#34;]

    set insert_clause [append insert_clause &#34;values (\&#34;$report_id\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$feature_id\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$build_id\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$feature_test_script_name\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$feature_test_file_content\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$status\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$pd\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$duration\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$d\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$log_file_content\&#34;) &#34;]

    mysqlexec  $mysql_handler $insert_clause

    if {$pd_number != &#34;&#34; &amp;&amp; $MAIN(USETRACKER)} {
        set setid_clause &#34;select LAST_INSERT_ID()&#34;;
        set lid [mysqlsel  $mysql_handler $setid_clause -flatlist]
        if {$lid &lt; 10} {
            <a name="::_writeMALog(1)"><a href="./mysqlLib.tcl.html#::_writeMALog_843">::_writeMALog</a></a> &#34;--- Use Tracker FAILED FAILED to get the last log_id entered ---&#34;
            puts &#34;log_id $lid is not valid.  Return&#34;
            return 0
        }
        foreach c $pd_number {
            set insert_clause2 &#34;&#34;
            if {[info exists CRINFO($c,globalState)] &amp;&amp; [info exists CRINFO($c,status)]} {
                set crstat &#34;$CRINFO($c,globalState) $CRINFO($c,status)&#34;
            } else {
                set crstat &#34;&#34;
            }
            set insert_clause2 [append insert_clause2 &#34;insert into aux_log_table &#34;]
            set insert_clause2 [append insert_clause2 &#34;(log_id, &#34;]
            set insert_clause2 [append insert_clause2 &#34;fa_cause, &#34;]
            set insert_clause2 [append insert_clause2 &#34;cr, &#34;]
            set insert_clause2 [append insert_clause2 &#34;cr_status) &#34;]

            set insert_clause2 [append insert_clause2 &#34;values (\&#34;$lid\&#34;, &#34;]
            set insert_clause2 [append insert_clause2 &#34;\&#34;software\&#34;, &#34;]
            set insert_clause2 [append insert_clause2 &#34;\&#34;$c\&#34;, &#34;]
            set insert_clause2 [append insert_clause2 &#34;\&#34;$crstat\&#34;)&#34;]

            <a name="::_writeMALog(2)"><a href="./mysqlLib.tcl.html#::_writeMALog_843">::_writeMALog</a></a> &#34;--- Use Tracker aux_log $insert_clause2&#34;
            mysqlexec $mysql_handler $insert_clause2
        }
    }


  return 0
}


<span class="comment-line"># finding a log file by name</span>
<strong><a name="::::FindLogFile_694">proc <a href="mysqlLib.tcl-annot.html#::::FindLogFile">::::FindLogFile</a></a></strong> {startDir} {
    set pwd [pwd]
    global procByLog MAIN TCSTATUSARRAY
    
    <span class="comment-line"># CD to the report directory</span>
    if [catch {cd &#34;$startDir&#34;} err] {
        puts stderr $err
        return {}
    }

    set fList {&#34;quickTestsList.txt&#34; &#34;passTestsList.txt&#34; &#34;allTestsList.txt&#34; &#34;newTestsList.txt&#34; &#34;DebugList.txt&#34;}

    set allTestList &#34;&#34;
    set newLogFile &#34;&#34;
    foreach f $fList {
        if {[file exists $f]} {
            set fp [open &#34;$f&#34; r]
            while {[gets $fp line] != -1} {
                lappend allTestList $line
            }
        }
    }
    set allTestString [join $allTestList &#34; &#34;]
    set allTestList [split $allTestString &#34; &#34;]

    set logFiles {}
    foreach match [glob -nocomplain -- &#34;*\.txt&#34;] {
        set rs [regexp {([0-9]+[-.][0-9a-z_.-]*)([a-zA-Z]+)} $match]
        <span class="comment-line">#puts stdout &#34;match result rs $rs match $match&#34;</span>
        set rs2 [regexp -nocase &#34;skipTestsList2&#34; $match]
        if { ($rs == 1) &amp;&amp; ($rs2 != 1) } {
            set logFiles  [lappend logFiles  $match]
            <span class="comment-line">#puts stdout [file join $startDir $match]</span>
        }
        set rs3 [regexp {^(T[_\-][0-9]+)|^(F[\-_][0-9]+)|^(FIT_[a-zA-Z0-9\._\-])} $match]
        if { ($rs3 == 1) &amp;&amp; ($rs2 != 1) &amp;&amp; [lsearch $logFiles $match] &lt; 0} {
            set logFiles  [lappend logFiles  $match]
            <span class="comment-line">#puts &#34;match result 3 $rs3 2 $rs2 match $match&#34;</span>
        }
    }

    if {[llength $allTestList] &gt; 0} {
        set a 1
        foreach myLog $allTestList {
            if {[regexp &#34;^T|^F&#34; $myLog]} {
                if {[lsearch $logFiles ${myLog}.txt] &gt;= 0 &amp;&amp; [lsearch $newLogFile ${myLog}.txt] &lt; 0} {
                    lappend newLogFile ${myLog}.txt
                } else {
                    foreach dirLog $logFiles {
                        set tmpScr [string trimleft $myLog &#34;T_&#34;]
                        set tmpScr [string trimleft $tmpScr &#34;T-&#34;]
                        set tmpScr [string trimleft $tmpScr &#34;F-&#34;]
                        set tmpScr [string trimleft $tmpScr &#34;F_&#34;]
                        if {[regexp &#34;^F.*$tmpScr\.txt|^T.*$tmpScr\.txt&#34; $dirLog] &amp;&amp; [lsearch $newLogFile $dirLog] &lt; 0} {
                             lappend newLogFile $dirLog
                             set procByLog($dirLog) $myLog
                             <span class="comment-line">#puts &#34;Hit $a  pushing ${myLog}.txt  blob $tmpScr  should it be $dirLog&#34;</span>
                        }
                    }
                }
            } else {
                if {[lsearch $logFiles ${myLog}.txt] &gt;= 0 &amp;&amp; [lsearch $newLogFile ${myLog}.txt] &lt; 0} {
                    lappend newLogFile ${myLog}.txt
                }
            }
            incr a
        }
      
        set logFiles $newLogFile
    }
    set itestList &#34;&#34;
    foreach match [glob -nocomplain -- &#34;*\.html&#34;] {
        set rs [regexp {([0-9]+[-.][0-9a-z_.-]*)([a-zA-Z]+)} $match]
        set rs 1
        <span class="comment-line">#puts stdout &#34;match result rs $rs match $match&#34;</span>
        set rs2 [regexp -nocase &#34;skipTestsList2&#34; $match]
        if { ($rs == 1) &amp;&amp; ($rs2 != 1) } {
            <span class="comment-line">#set logFiles  [lappend logFiles  $match]</span>
            lappend itestList $match
            <span class="comment-line">#puts stdout [file join $startDir $match]</span>
        }
    }
    if {[llength $itestList] &gt; 0} {
        set itestList [lsort $itestList]
        set logFiles [concat $logFiles $itestList];
    }

    <span class="comment-line"># -----  New method for finding log files using testfile_map file -----</span>
    if {[file exists testfile_map.txt]} {
        if {[catch {source testfile_map.txt} why]} {
            puts &#34;sourcing the testfile_map.txt failed&#34;
            <a name="::_writeMALog(3)"><a href="./mysqlLib.tcl.html#::_writeMALog_843">::_writeMALog</a></a> &#34;--- sourcing the testfile_map.txt failed&#34;
        } else {
            if {[info exists procs_executed]} {
                foreach testp $procs_executed {
                    if {[info exists procFile(\&#34;$testp\&#34;)] &amp;&amp; \
                       [file exists $procFile(\&#34;$testp\&#34;)] &amp;&amp; \
                       [lsearch $logFiles $procFile(\&#34;$testp\&#34;)] &lt; 0} {
                        puts &#34;Adding log file using new method. Old on missed&#34;
                        <a name="::_writeMALog(4)"><a href="./mysqlLib.tcl.html#::_writeMALog_843">::_writeMALog</a></a> &#34;--- Adding log file using new method. Old on missed&#34;
                        lappend logFiles $procFile(\&#34;$testp\&#34;)
                    } else {
                        if {[info exists procFile(\&#34;$testp\&#34;)]} {
                            puts &#34;found $procFile(\&#34;$testp\&#34;) in logFiles&#34;
                        }
                    }
                }
            }
        }
    }
    <span class="comment-line"># ----- Since we are in the report directory... lets get the results too.</span>
    if {[file exists TCLStatusVars.txt]} {
        if {[catch {source TCLStatusVars.txt} why]} {
            puts &#34;sourcing the TCLStatusVars.txt failed&#34;
        } else {
            if {[info exists ReportCases]} {
                <a name="::_writeMALog(5)"><a href="./mysqlLib.tcl.html#::_writeMALog_843">::_writeMALog</a></a> &#34;--- TCLStatusVars.txt found $ReportCases&#34;
                foreach testp $ReportCases {
                    if {[info exists RepResArray($testp)]} {
                        if {[regexp -nocase &#34;fail&#34; $RepResArray($testp)]} {
                            set TCSTATUSARRAY($testp,logresult) &#34;failed&#34;
                            set TCSTATUSARRAY($testp,result)    &#34;failed&#34;
                        } elseif {[regexp -nocase &#34;skip&#34; $RepResArray($testp)]} {
                            set TCSTATUSARRAY($testp,logresult) &#34;passed&#34;
                            set TCSTATUSARRAY($testp,result)    &#34;skipped&#34;
                        } else {
                            set TCSTATUSARRAY($testp,logresult) &#34;passed&#34;
                            set TCSTATUSARRAY($testp,result)    &#34;passed&#34;
                        }
                    }
                    if {[info exists RepDurArray($testp)]} {
                        set TCSTATUSARRAY($testp,duration) $RepDurArray($testp)
                    } else {
                        set TCSTATUSARRAY($testp,duration) 0;
                    }
                }
            }
        }
    }
    <span class="comment-line"># CD back to the original directory </span>
    if [catch {cd &#34;$pwd&#34;} err] {
        puts stderr $err
        return {}
    }
    return $logFiles
}
<span class="comment-line">###########################################################################</span>
<span class="comment-line"># Write to mysqlAutomate log</span>
<span class="comment-line">###########################################################################</span>
<strong><a name="::::_writeMALog_843">proc <a href="mysqlLib.tcl-annot.html#::::_writeMALog">::::_writeMALog</a></a></strong> {txt} {
    global logFileId

    if {[info exists logFileId] &amp;&amp; [regexp -nocase &#34;file&#34; $logFileId]} {
        puts $logFileId &#34;$txt&#34;
    }

}
<span class="comment-line">###########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">###########################################################################</span>
<strong><a name="::::InsertAllIntoLogTable_854">proc <a href="mysqlLib.tcl-annot.html#::::InsertAllIntoLogTable">::::InsertAllIntoLogTable</a></a></strong> {args} {
    <a name="::parse_args(10)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertAllIntoLogTable $args {
        report_id &#34;&#34;
        feature_id &#34;&#34;
        build_id &#34;&#34;
        logDir &#34;&#34;
        sourceDir &#34;&#34;
        host &#34;&#34;
    }

    global logFileId procByLog TCSTATUSARRAY MAIN CRINFO

    <span class="comment-line"># --- Get Tracker CRs ---</span>
    set thandle [<a name="::::tracker_db_connect(1)"><a href="./tracker.tcl.html#::::tracker_db_connect_27">::::tracker_db_connect</a></a>]

    set logFiles [<a name="::FindLogFile(1)"><a href="./mysqlLib.tcl.html#::FindLogFile_694">::FindLogFile</a></a> $logDir]
    puts &#34;DANY InsertAllIntoLogTable logFiles: $logFiles&#34;
    puts $logFileId &#34;DANY InsertAllIntoLogTable logFiles: $logFiles&#34;
    foreach logFile $logFiles {
        set crString &#34;&#34;
        set logFileTmp $logFile
        <span class="comment-line"># set featureTestScriptName [string trimright $logFile &#34;.txt&#34;]</span>
        set logFileSplit [split $logFile &#34;.&#34;]
        set suffix [lindex $logFileSplit [expr [llength $logFileSplit] - 1]]
        set logFileSplitSize [expr [llength $logFileSplit] - 2]
        set logFileSplitTrimmed [lrange $logFileSplit 0 $logFileSplitSize]
        set featureTestScriptName [join $logFileSplitTrimmed &#34;.&#34;]

        if {$suffix == &#34;html&#34;} {
            set srcFile [string trimright $logFile html]
        } else {
            set srcFile [string trimright $logFile txt]
        }
        set myProcName [string trimright $srcFile &#34;.&#34;]
        if { [regexp -nocase &#34;clitest&#34; $sourceDir] } {
            set srcFile [append srcFile cli]
            set srcFile [file join $sourceDir $srcFile]
        } elseif {$suffix == &#34;html&#34;} {
            set srcFile [append srcFile fftp]
            set srcFile &#34;$srcFile&#34;
        } else {
            if {[regexp &#34;^F|^T&#34; $srcFile] &amp;&amp; [info exists procByLog($logFile)]} {
                set srcFile $procByLog($logFile).tcl
                set myProcName $procByLog($logFile)
                set srcFile [file join $sourceDir $srcFile]
            } else {
                set srcFile [append srcFile tcl]
                set srcFile [file join $sourceDir $srcFile]
            }
        }
        set logFile [file join $logDir $logFile]
        puts $logFile
        puts $logFileId $logFile
        <a name="::createFileBlob(3)"><a href="./mysqlLib.tcl.html#::createFileBlob_331">::createFileBlob</a></a> $logFile logFileBlob
        puts $srcFile
        puts $logFileId $srcFile
        <span class="comment-line"># no source file for 1.txt</span>
        if {$logFileTmp == &#34;1.txt&#34;} {
            set srcFileBlob &#34;\n\n\nno source file for 1.txt\n\n\n&#34;
        } elseif {$suffix == &#34;html&#34;} {
            <span class="comment-line"># We are assuming that all html files are iTest results</span>
            set srcFileBlob &#34;\n\n\nno source file for $srcFile\n\n\n&#34;
        }  else {
            <a name="::createFileBlob(4)"><a href="./mysqlLib.tcl.html#::createFileBlob_331">::createFileBlob</a></a> $srcFile srcFileBlob
        }
        <span class="comment-line"># ---- Results if they exists ----  TCSTATUSARRAY</span>
        set stat &#34;&#34;
        if {[info exists TCSTATUSARRAY($myProcName,logresult)] &amp;&amp; \
            ($TCSTATUSARRAY($myProcName,logresult) == &#34;passed&#34; || \
             $TCSTATUSARRAY($myProcName,logresult) == &#34;failed&#34;)} {
            set stat $TCSTATUSARRAY($myProcName,logresult)
            if {[info exists MAIN(USETRACKER)] &amp;&amp; $MAIN(USETRACKER) &amp;&amp; $stat == &#34;failed&#34;} {
                set CRS [<a name="::::GetTestCaseCRS(1)"><a href="./tracker.tcl.html#::::GetTestCaseCRS_139">::::GetTestCaseCRS</a></a> -testcase &#34;$myProcName&#34; ]
                set crString &#34;$CRS&#34;
            }
        }
        set dur &#34;&#34;
        if {[info exists TCSTATUSARRAY($myProcName,duration)]} {
            set dur $TCSTATUSARRAY($myProcName,duration);
        }
        <a name="::InsertIntoLogTable(1)"><a href="./mysqlLib.tcl.html#::InsertIntoLogTable_604">::InsertIntoLogTable</a></a> -report_id $report_id -feature_id $feature_id -build_id $build_id \
            -feature_test_script_name $myProcName -status $stat -duration $dur \
            -feature_test_file_content $srcFileBlob -pd_number &#34;$crString&#34; \
            -log_file_content $logFileBlob -host $host 
    }
    <a name="::::close_mysql_handle(1)"><a href="./tracker.tcl.html#::::close_mysql_handle_47">::::close_mysql_handle</a></a> $MAIN(TRACKERHANDLE)
    if {$MAIN(USETRACKER) &amp;&amp; [info exists MAIN(CRLIST)] &amp;&amp; [info exists MAIN(CRTESTCASELIST)]} {
        set crFile [file join $logDir &#34;CR_TestCaseData.txt&#34;]
        set fp [open $crFile &#34;w+&#34;]
        set crc [llength $MAIN(CRLIST)]
        set i 1
        puts $fp &#34;\{&#34;
        puts $fp &#34;\&#34;CR_TestCases\&#34;: \[ \&#34;[join $MAIN(CRTESTCASELIST) &#34;\&#34;,\&#34;&#34;]\&#34; \],&#34;
        puts $fp &#34;\&#34;Tracker\&#34;: \{&#34;
        foreach c $MAIN(CRLIST) {
            <span class="comment-line">#CRINFO($cr,globalState) $gState;</span>
            <span class="comment-line">#CRINFO($cr,status) $status;</span>
            <span class="comment-line">#CRINFO($cr,auto) $auto;</span>
            <span class="comment-line">#CRINFO($cr,testcase)</span>
            if {[info exists CRINFO($c,globalState)] &amp;&amp; [info exists CRINFO($c,status)]} {
                <a name="::_writeMALog(6)"><a href="./mysqlLib.tcl.html#::_writeMALog_843">::_writeMALog</a></a> &#34;---- TRACKER ON Posting $c $CRINFO($c,globalState) $CRINFO($c,status) &#34;
                <span class="comment-line">#set cList [list &#34;CR&#34; &#34;$c&#34; &#34;globalState&#34; &#34;$CRINFO($c,globalState)&#34; \</span>
                <span class="comment-line">#     &#34;status&#34; &#34;$CRINFO($c,status)&#34;]</span>
                <span class="comment-line">#set js &#34;[listToJson -mlist $cList -elem &#34;$CRINFO($c,testcase)&#34;]&#34;</span>
                <span class="comment-line">#puts $fp $js</span>
                if {$i == $crc} {
                    puts $fp &#34;    \&#34;$CRINFO($c,testcase)\&#34;: \{\&#34;CR\&#34;: \&#34;$c\&#34;, \
                       \&#34;globalState\&#34;: \&#34;$CRINFO($c,globalState)\&#34;, \
                       \&#34;status\&#34;: \&#34;$CRINFO($c,status)\&#34;\}&#34;
                } else {
                    puts $fp &#34;    \&#34;$CRINFO($c,testcase)\&#34;: \{\&#34;CR\&#34;: \&#34;$c\&#34;, \
                       \&#34;globalState\&#34;: \&#34;$CRINFO($c,globalState)\&#34;, \
                       \&#34;status\&#34;: \&#34;$CRINFO($c,status)\&#34;\},&#34;
                }
                incr i
            }
        }
        puts $fp &#34;  \}&#34;;<span class="comment-line"># End tracker brace</span>
        puts $fp &#34;\}&#34;;<span class="comment-line"># End file brace</span>
        close $fp
    } else {
        <a name="::_writeMALog(7)"><a href="./mysqlLib.tcl.html#::_writeMALog_843">::_writeMALog</a></a> &#34;---- TRACKER Nothing to Post Status: MAIN(USETRACKER)=[info exists MAIN(USETRACKER)]&#34;
        <a name="::_writeMALog(8)"><a href="./mysqlLib.tcl.html#::_writeMALog_843">::_writeMALog</a></a> &#34;     TRACKER MAIN(CRLIST)=[info exists MAIN(CRLIST)] MAIN(CRTESTCASELIST)=[info exists MAIN(CRTESTCASELIST)]&#34;
    }
} 


<span class="comment-line"># finding Info files</span>
<strong><a name="::::FindInfoFiles_982">proc <a href="mysqlLib.tcl-annot.html#::::FindInfoFiles">::::FindInfoFiles</a></a></strong> {startDir} {
  global MAIN TCSTATUSARRAY
  set pwd [pwd]
  if [catch {cd &#34;$startDir&#34;} err] {
    puts stderr $err
    return {}
  }
  set infoFiles {}
  foreach match [glob -nocomplain -- &#34;*\.txt&#34;] {
    set rs  [regexp {^([0-9]+[-.][0-9a-z_.-]*)([a-zA-Z]+)} $match]
    set rs2 [regexp {^(T[_\-][0-9]+)|^(F[\-_][0-9]+)|^FIT} $match]
    <span class="comment-line">#puts stdout &#34;match result rs $rs match $match&#34;</span>
    if { $rs == 0 &amp;&amp; $rs2 == 0} {
      set infoFiles  [lappend infoFiles  $match]
      <span class="comment-line">#puts stdout [file join $startDir $match]</span>
    }
  }
  <span class="comment-line">#puts stdout $infoFiles</span>
  if [catch {cd &#34;$pwd&#34;} err] {
    puts stderr $err
    return {}
  }
  return $infoFiles
}


<strong><a name="::::InsertIntoXfilexTable_1008">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoXfilexTable">::::InsertIntoXfilexTable</a></a></strong> {args} {
  <a name="::parse_args(11)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoXfilexTable $args {
    xfile_id &#34;&#34;
    report_id &#34;&#34;
    xfile_name &#34;&#34;
    xfile_type &#34;&#34;
    xfile_content &#34;&#34;
    xfile_comment &#34;&#34;
    xfile_status &#34;none&#34;
    xfile_create_date &#34;&#34;
    host &#34;&#34;
  }

  global mysql_handler
  <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
    <span class="comment-line">#return -1</span>
  <span class="comment-line">#} else {</span>
    <span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
  <span class="comment-line">#}</span>
  <span class="comment-line">#puts &#34;InsertIntoXfilexTable entering&#34;</span>

  set d1 [exec date +%Y-%m-%d]
  set d2 [exec date +%k:%M:%S]
  set d [append d $d1]
  set d [append d &#34; &#34;]
  set d [append d $d2]

  set insert_clause [append insert_clause &#34;insert into xfile_table &#34;]
  set insert_clause [append insert_clause &#34;(xfile_id, &#34;]
  set insert_clause [append insert_clause &#34;report_id, &#34;]
  set insert_clause [append insert_clause &#34;xfile_name, &#34;]
  set insert_clause [append insert_clause &#34;xfile_type, &#34;]
  set insert_clause [append insert_clause &#34;xfile_content, &#34;]
  set insert_clause [append insert_clause &#34;xfile_comment, &#34;]
  set insert_clause [append insert_clause &#34;xfile_status, &#34;]
  set insert_clause [append insert_clause &#34;xfile_create_date) &#34;]

  set insert_clause [append insert_clause &#34;values (\&#34;$xfile_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$report_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$xfile_name\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$xfile_type\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$xfile_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$xfile_comment\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$xfile_status\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$d\&#34;) &#34;]

  mysqlexec  $mysql_handler $insert_clause
  <span class="comment-line">#mysqlclose $mysql_handler</span>
  return 0
}


<strong><a name="::::InsertAllInfoFilesIntoXfileTable_1060">proc <a href="mysqlLib.tcl-annot.html#::::InsertAllInfoFilesIntoXfileTable">::::InsertAllInfoFilesIntoXfileTable</a></a></strong> {args} {
  <a name="::parse_args(12)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertAllInfoFilesIntoXfileTable $args {
    report_id &#34;&#34;
    logDir &#34;&#34;
    host &#34;&#34;
  }

  global logFileId

  set infoFiles [<a name="::FindInfoFiles(1)"><a href="./mysqlLib.tcl.html#::FindInfoFiles_982">::FindInfoFiles</a></a> $logDir]
  puts &#34;DANY InsertAllInfoFilesIntoXfileTable infoFiles: $infoFiles&#34;
  puts $logFileId &#34;DANY InsertAllInfoFilesIntoXfileTable infoFiles: $infoFiles&#34;
  foreach infoFile $infoFiles {
    set infoFileTmp $infoFile
    <span class="comment-line"># set infoFileName [string trimright $infoFile &#34;.txt&#34;]</span>

    set infoFileSplit [split  $infoFile &#34;.&#34;]
    set infoFileSplitSize [expr [llength $infoFileSplit] - 2]
    set infoFileSplitTrimmed [lrange $infoFileSplit 0 $infoFileSplitSize]
    set infoFileName [join $infoFileSplitTrimmed &#34;.&#34;]

    set infoFile [file join $logDir $infoFile]
    puts $infoFile
    puts $logFileId $infoFile
    <a name="::createFileBlob(5)"><a href="./mysqlLib.tcl.html#::createFileBlob_331">::createFileBlob</a></a> $infoFile infoFileBlob

    <a name="::InsertIntoXfilexTable(1)"><a href="./mysqlLib.tcl.html#::InsertIntoXfilexTable_1008">::InsertIntoXfilexTable</a></a> -report_id $report_id -xfile_name $infoFileName \
                          -xfile_type &#34;text&#34; -xfile_content $infoFileBlob -host $host

  }
}

<strong><a name="::::random_1092">proc <a href="mysqlLib.tcl-annot.html#::::random">::::random</a></a></strong> {{range 10000}} {
    return [expr {int(rand()*$range)}]
}

<span class="comment-line"># finding Binary files</span>
<strong><a name="::::FindBinaryFiles_1097">proc <a href="mysqlLib.tcl-annot.html#::::FindBinaryFiles">::::FindBinaryFiles</a></a></strong> {startDir} {
  set pwd [pwd]
  if [catch {cd &#34;$startDir&#34;} err] {
    puts stderr $err
    return {}
  }
  set binaryFiles {}
  foreach match [glob -nocomplain -- &#34;*&#34;] {
    set rs [regexp {([[:alnum:]_]*)\.txt} $match]
    <span class="comment-line">#puts stdout &#34;match result rs $rs match $match&#34;</span>
    if { $rs == 0 } {
      set binaryFiles  [lappend binaryFiles  $match]
      <span class="comment-line">#puts stdout [file join $startDir $match]</span>
    }
  }
  <span class="comment-line">#puts stdout $binaryFiles</span>
  if [catch {cd &#34;$pwd&#34;} err] {
    puts stderr $err
    return {}
  }
  return $binaryFiles
}


<strong><a name="::::InsertIntoHostTempDir_1121">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoHostTempDir">::::InsertIntoHostTempDir</a></a></strong> {args} {
  <a name="::parse_args(13)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoHostTempDir $args {
    file_name &#34;&#34;
    pref_file_name &#34;&#34;
    logDir &#34;&#34;
    host &#34;&#34;
  }

  global my_db_server_ftp_login 
  global my_db_server_ftp_password

  set remoteDir &#34;/tmp&#34;

  puts &#34;InsertIntoHostTempDir file_name $file_name&#34;
  puts &#34;InsertIntoHostTempDir pref_file_name $pref_file_name&#34;
  puts &#34;InsertIntoHostTempDir logDir $logDir&#34;
  puts &#34;InsertIntoHostTempDir host $host&#34;


  set ftpHandle [ftp::Open $host $my_db_server_ftp_login $my_db_server_ftp_password]
  if {$ftpHandle &gt;= 0} {
   ftp::Type $ftpHandle binary
   ftp::Cd $ftpHandle $remoteDir
   append logDir &#34;/$file_name&#34;
   ftp::Put $ftpHandle $logDir $pref_file_name
   ftp::Close $ftpHandle
   return 0
  } else {
    <span class="comment-line"># did not work</span>
    return -1
  }
}



<strong><a name="::::InsertAllBinaryFilesIntoXfileTable_1156">proc <a href="mysqlLib.tcl-annot.html#::::InsertAllBinaryFilesIntoXfileTable">::::InsertAllBinaryFilesIntoXfileTable</a></a></strong> {args} {
  <a name="::parse_args(14)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertAllBinaryFilesIntoXfileTable $args {
    report_id &#34;&#34;
    logDir &#34;&#34;
    host &#34;&#34;
  }

  global logFileId this_db

  set binaryFiles [<a name="::FindBinaryFiles(1)"><a href="./mysqlLib.tcl.html#::FindBinaryFiles_1097">::FindBinaryFiles</a></a> $logDir]
  puts &#34;DANY InsertAllBinaryFilesIntoXfileTable binaryFiles: $binaryFiles&#34;
  foreach file_name $binaryFiles {
    <span class="comment-line"># add random prefix</span>
    set randNmbr [<a name="::random(1)"><a href="./mysqlLib.tcl.html#::random_1092">::random</a></a>]
    set pref_file_name &#34;$randNmbr.$file_name&#34;
    puts &#34;pref_file_name $pref_file_name&#34;

    <a name="::InsertIntoHostTempDir(1)"><a href="./mysqlLib.tcl.html#::InsertIntoHostTempDir_1121">::InsertIntoHostTempDir</a></a> -file_name $file_name -pref_file_name $pref_file_name -logDir $logDir -host $host

    set bin_upl_url [http_formatQuery report_id $report_id xfile_name $pref_file_name]
    <span class="comment-line">#set insertBinaryFileURL &#34;http://$host:8080/insertBinaryFile.php&#34;</span>
    if {$this_db == &#34;autoweb_db_6&#34; || $this_db == &#34;autoweb_db_7&#34;} {
      set insertBinaryFileURL &#34;http://$host/phpdb4/insertBinaryFile.php&#34;
    } else {
      set insertBinaryFileURL &#34;http://$host/insertBinaryFile.php&#34;
    }
    set insertBinaryFileURL [append insertBinaryFileURL &#34;?$bin_upl_url&#34;]
    puts &#34;insertBinaryFileURL $insertBinaryFileURL&#34;
    puts $logFileId &#34;insertBinaryFileURL $insertBinaryFileURL&#34;
    set token [http_get $insertBinaryFileURL -timeout 1000000 ]
    upvar #0 $token httpState
    while { [string match eof $httpState(state)] != 1 } {
      puts stderr &#34;$httpState(state) [string match eof $httpState(state)]&#34;
      flush stderr
      after 100
     }
    <span class="comment-line">#puts &#34;DANY 2 $httpState(body)&#34;</span>
  }
}



<strong><a name="::::deleteReport_1198">proc <a href="mysqlLib.tcl-annot.html#::::deleteReport">::::deleteReport</a></a></strong> {report_id} {
  <span class="comment-line"># delete the report with this report_id</span>
  global mysql_handler
  puts &#34;DANY deleteReport  report_id: $report_id&#34;
  mysqlexec $mysql_handler &#34;DELETE FROM report_table WHERE report_id = \&#34;$report_id\&#34;&#34; 
}
<span class="comment-line">##############################################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##############################################################################################</span>
<strong><a name="::::deleteReportDb_1208">proc <a href="mysqlLib.tcl-annot.html#::::deleteReportDb">::::deleteReportDb</a></a></strong> {report_id hdl} {
    <span class="comment-line"># delete the report with this report_id</span>
    mysqlexec $hdl &#34;DELETE FROM report_table WHERE report_id = \&#34;$report_id\&#34;&#34;
}
<span class="comment-line">##############################################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##############################################################################################</span>
<strong><a name="::::deleteLogsReportId_1216">proc <a href="mysqlLib.tcl-annot.html#::::deleteLogsReportId">::::deleteLogsReportId</a></a></strong> {report_id} {
  <span class="comment-line"># delete all the logs with this report_id</span>
  global mysql_handler
  puts &#34;DANY deleteLogsReportId  report_id: $report_id&#34;
  mysqlexec $mysql_handler &#34;DELETE FROM log_table WHERE report_id = \&#34;$report_id\&#34;&#34; 
}
<span class="comment-line">##############################################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##############################################################################################</span>
<strong><a name="::::deleteLogsReportIdDb_1226">proc <a href="mysqlLib.tcl-annot.html#::::deleteLogsReportIdDb">::::deleteLogsReportIdDb</a></a></strong> {report_id hdl} {
    mysqlexec $hdl &#34;DELETE FROM log_table WHERE report_id = \&#34;$report_id\&#34;&#34;
}
<span class="comment-line">##############################################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##############################################################################################</span>
<strong><a name="::::deleteReportsAndLogsDb_1233">proc <a href="mysqlLib.tcl-annot.html#::::deleteReportsAndLogsDb">::::deleteReportsAndLogsDb</a></a></strong> {args} {
    <a name="::parse_args(15)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> deleteReportsAndLogsDb $args {
        regression_id &#34;null&#34;
        feature_id &#34;null&#34;
        feature_directory &#34;null&#34;
        feature_type &#34;functional&#34;
        hdl &#34;&#34;
    }

    if {$feature_directory != &#34;null&#34; &amp;&amp; $feature_id == &#34;null&#34;} {
        set feature_id [<a name="::getFeatureIdByDirectoryDb(1)"><a href="./mysqlLib.tcl.html#::getFeatureIdByDirectoryDb_1884">::getFeatureIdByDirectoryDb</a></a> -feature_directory $feature_directory \
               -hdl $hdl -feature_type $feature_type]
    }
    set report_ids [mysqlsel $hdl \
        &#34;SELECT report_id FROM report_table WHERE regression_id = \&#34;$regression_id\&#34; AND feature_id = \&#34;$feature_id\&#34;&#34; -flatlist]
    foreach report_id $report_ids {
        puts &#34;deleteReporWithLogs  found report_id: $report_id&#34;
        <span class="comment-line"># delete all the logs with this report_id for this feature_id</span>
        <a name="::deleteLogsReportIdDb(1)"><a href="./mysqlLib.tcl.html#::deleteLogsReportIdDb_1226">::deleteLogsReportIdDb</a></a> $report_id $hdl
        <span class="comment-line"># delete the report</span>
        <a name="::deleteReportDb(1)"><a href="./mysqlLib.tcl.html#::deleteReportDb_1208">::deleteReportDb</a></a> $report_id $hdl
    }
}

<strong><a name="::::deleteReporWithLogs_1257">proc <a href="mysqlLib.tcl-annot.html#::::deleteReporWithLogs">::::deleteReporWithLogs</a></a></strong> {args} {
  <a name="::parse_args(16)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> deleteReporWithLogs $args {
    regression_id &#34;&#34;
    run_number &#34;&#34;
    feature_id &#34;&#34;
    host &#34;&#34;
  }
  global mysql_handler
  puts &#34;DANY deleteReporWithLogs  regression_id: $regression_id run_number: $run_number feature_id: $feature_id&#34;
  set report_ids [mysqlsel $mysql_handler &#34;SELECT report_id FROM report_table WHERE regression_id = \&#34;$regression_id\&#34; AND run_number = \&#34;$run_number\&#34; AND feature_id = \&#34;$feature_id\&#34;&#34; -flatlist]
 puts &#34;DANY deleteReporWithLogs report_ids: $report_ids&#34;
 foreach report_id $report_ids {
    puts &#34;DANY deleteReporWithLogs  found report_id: $report_id&#34;
    <span class="comment-line"># delete all the logs with this report_id for this feature_id</span>
    <a name="::deleteLogsReportId(1)"><a href="./mysqlLib.tcl.html#::deleteLogsReportId_1216">::deleteLogsReportId</a></a> $report_id
    <span class="comment-line"># delete the report</span>
    <a name="::deleteReport(1)"><a href="./mysqlLib.tcl.html#::deleteReport_1198">::deleteReport</a></a> $report_id
 }
}
<span class="comment-line">#####################################################################################################</span>
<span class="comment-line"># proc getAllModules</span>
<span class="comment-line">#</span>
<span class="comment-line"># In args: variables to be used in the current scope</span>
<span class="comment-line">#    a = all feature directories in the db</span>
<span class="comment-line">#    b = nodes required for a feature directory 2node or 5node   b(dir) = 2 or 5 or 1</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    set c(dummy) 1</span>
<span class="comment-line">#    conn_to_db $mysqlIP $my_db</span>
<span class="comment-line">#    getAllModules a b</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#    Feature L2 requires a $b(L2) node test bed</span>
<span class="comment-line">#</span>
<span class="comment-line">#####################################################################################################</span>
<strong><a name="::::getAllModules_1291">proc <a href="mysqlLib.tcl-annot.html#::::getAllModules">::::getAllModules</a></a></strong> { moduleDirectories nodeReqByFeature } {
    upvar $moduleDirectories moduleDirectoriesTmp
    upvar $nodeReqByFeature nodeByFeature


    global mysql_handler

    set moduleDirectoriesTmp [mysqlsel $mysql_handler &#34;SELECT feature_directory FROM feature_table WHERE status = 'Active'&#34; -list]
    set qout [mysqlsel $mysql_handler &#34;SELECT feature_directory,feature_sub_type FROM feature_table WHERE status = 'Active'&#34; -list]
    foreach r $qout {
        set d [lindex $r 0]
        set st [lindex $r 1]
        if {$st == &#34;standard&#34;} {
            set n 2
        } elseif {$st == &#34;routing&#34;} {
            set n 5
        } else {
            set n 1
        }
        set nodeByFeature($d) $n
    }
}

<span class="comment-line"># this return list of failing test cases from run 1</span>
<span class="comment-line"># if the list is non emty cleanup is added</span>
<strong><a name="::::GetFailingTestsForModule_1316">proc <a href="mysqlLib.tcl-annot.html#::::GetFailingTestsForModule">::::GetFailingTestsForModule</a></a></strong> {args} {
    <a name="::parse_args(17)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> GetFailingTestsForModule $args {
	    regression_id &#34;&#34;
	    feature_directory &#34;&#34;
        feature_type &#34;&#34;
	    host &#34;&#34;
        skipCRCases &#34;no&#34;
    }

    if {$skipCRCases == &#34;no&#34;} {
        set crpart &#34;&#34;
    } else {
        set crpart &#34; AND pd_number=\&#34;\&#34; &#34;
    }
    
    global mysql_handler
    <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
	<span class="comment-line">#return -1</span>
    <span class="comment-line">#} else {</span>
	<span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
    <span class="comment-line">#}</span>

    set failing_tests_list &#34;&#34;
    <span class="comment-line"># get the feature_id of this feature</span>
    set feature_id [mysqlsel $mysql_handler &#34;SELECT feature_id FROM feature_table WHERE status = 'Active' \
                    AND feature_type = \&#34;$feature_type\&#34; AND feature_directory = \&#34;$feature_directory\&#34;&#34; -list]
    puts &#34;DANY GetFailingTestsForModule feature_id: $feature_id&#34;
    <span class="comment-line"># get the report_id of this feature from the first run</span>
    set res_list [mysqlsel $mysql_handler &#34;SELECT report_id, test_result FROM report_table WHERE regression_id = \&#34;$regression_id\&#34; AND feature_id = \&#34;$feature_id\&#34;  AND run_number = \&#34;1\&#34;&#34; -flatlist]
    set report_id [lindex $res_list 0]
    set test_result [lindex $res_list 1]
    puts &#34;DANY GetFailingTestsForModule report_id: $report_id&#34;
    puts &#34;DANY GetFailingTestsForModule test_result: $test_result&#34;
    if {($test_result == &#34;passed&#34;) || ($test_result == &#34;aborted&#34;)} {
	puts &#34;DANY GetFailingTestsForModule PASSED/ABORTED failing_tests_list: $failing_tests_list&#34;
	return &#34;all&#34;    ;<span class="comment-line"># Actually nothing ... but we're handling keyword &#34;all&#34; differently in mysqlMain and mysqlRunallmonitor</span>
    }
  <span class="comment-line"># get the list of failing tests for this feature if any</span>
  set failing_tests_list [mysqlsel $mysql_handler &#34;SELECT feature_test_script_name FROM log_table WHERE (report_id = \&#34;$report_id\&#34; AND status = \&#34;failed\&#34; $crpart) OR (report_id = \&#34;$report_id\&#34; AND ((feature_test_script_name REGEXP \&#34;init$\&#34;) OR (feature_test_script_name REGEXP \&#34;end$\&#34;))) ORDER BY log_id ASC&#34; -list]
   
  if {$failing_tests_list == &#34;&#34; || $failing_tests_list == &#34;NULL&#34;} {
         set failing_tests_list [mysqlsel $mysql_handler &#34;SELECT feature_test_script_name FROM log_table WHERE (report_id = \&#34;$report_id\&#34; AND status = \&#34;failed\&#34; $crpart ) OR (report_id = \&#34;$report_id\&#34; AND ((feature_test_script_name REGEXP \&#34;init\&#34;) OR (feature_test_script_name REGEXP \&#34;end\&#34;))) ORDER BY log_id ASC&#34; -list]

  }

  if {$failing_tests_list != &#34;NULL&#34; &amp;&amp; $failing_tests_list != &#34;&#34; } {
    <span class="comment-line"># add call to cleanup</span>
    set failing_tests_list [concat $failing_tests_list cleanup]
  }
   if {[llength $failing_tests_list] == 1} {
       if {[lindex $failing_tests_list 0] == &#34;cleanup&#34;} {
              return &#34;all&#34;
       }

  }



  puts &#34;DANY GetFailingTestsForModule failing_tests_list: $failing_tests_list&#34;
    if { $failing_tests_list == &#34;&#34; } {
	return &#34;all&#34;
    } else {
        <span class="comment-line"># filter away CoreDump, Failed and Aborted predefined meta test cases</span>
        set failing_tests_list [<a name="::GetFilteredListCoreDumpFailedAborted(1)"><a href="./mysqlLib.tcl.html#::GetFilteredListCoreDumpFailedAborted_1470">::GetFilteredListCoreDumpFailedAborted</a></a> $failing_tests_list]
	return $failing_tests_list
    }
}

<strong><a name="::::GetFailingTestsForModule_autoreg_1384">proc <a href="mysqlLib.tcl-annot.html#::::GetFailingTestsForModule_autoreg">::::GetFailingTestsForModule_autoreg</a></a></strong> {args} {
    <a name="::parse_args(18)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> GetFailingTestsForModule_autoreg $args {
	regression_id &#34;&#34;
	feature_directory &#34;&#34;
	host &#34;&#34;
    }
    
    global mysql_handler
    <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
	<span class="comment-line">#return -1</span>
    <span class="comment-line">#} else {</span>
	<span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
    <span class="comment-line">#}</span>

    set failing_tests_list &#34;&#34;
    <span class="comment-line"># get the feature_id of this feature</span>
    set feature_id [mysqlsel $mysql_handler &#34;SELECT feature_id FROM feature_table WHERE status = 'Active' AND feature_directory = \&#34;$feature_directory\&#34;&#34; -list]
    puts &#34;DANY GetFailingTestsForModule feature_id: $feature_id&#34;
    <span class="comment-line"># get the report_id of this feature from the first run</span>
    set res_list [mysqlsel $mysql_handler &#34;SELECT report_id, test_result FROM report_table WHERE regression_id = \&#34;$regression_id\&#34; AND feature_id = \&#34;$feature_id\&#34;  AND run_number = \&#34;1\&#34;&#34; -flatlist]
    set report_id [lindex $res_list 0]
    set test_result [lindex $res_list 1]
    puts &#34;DANY GetFailingTestsForModule report_id: $report_id&#34;
    puts &#34;DANY GetFailingTestsForModule test_result: $test_result&#34;
    if {($test_result == &#34;passed&#34;) || ($test_result == &#34;aborted&#34;)} {
	puts &#34;DANY GetFailingTestsForModule PASSED/ABORTED failing_tests_list: $failing_tests_list&#34;
	return &#34;all&#34;    ;<span class="comment-line"># Actually nothing ... but we're handling keyword &#34;all&#34; differently in mysqlMain and mysqlRunallmonitor</span>
    }
  <span class="comment-line"># get the list of failing tests for this feature if any</span>
  set failing_tests_list_with_log_id [mysqlsel $mysql_handler &#34;SELECT log_id,feature_test_script_name FROM log_table WHERE (report_id = \&#34;$report_id\&#34; AND status = \&#34;failed\&#34; AND pd_number=\&#34;\&#34;) OR (report_id = \&#34;$report_id\&#34; AND ((feature_test_script_name REGEXP \&#34;init$\&#34;) OR (feature_test_script_name REGEXP \&#34;end$\&#34;))) ORDER BY log_id ASC&#34; -list]
 
    set failList &#34;&#34;
  foreach ele $failing_tests_list_with_log_id {

       set log_id [lindex $ele 0]
       set fa_cause [mysqlsel $mysql_handler &#34;SELECT fa_cause FROM aux_log_table WHERE log_id = \&#34;$log_id\&#34;&#34; -flatlist]
       set  fa_cause [string  trim $fa_cause &#34;{}&#34;] 
       if {$fa_cause == &#34;&#34;} {
            puts &#34;fa_cause: $fa_cause&#34;

             lappend failList [lindex $ele 1]

        }

  }
    
  set  passList [string trim [mysqlsel $mysql_handler &#34;SELECT xfile_content  from xfile_table WHERE xfile_name='passTestsList' AND report_id = \&#34;$report_id\&#34;&#34; -flatlist] &#34;{}&#34; ]

set  quickList [string trim [mysqlsel $mysql_handler &#34;SELECT xfile_content from xfile_table WHERE xfile_name='quickTestsList' AND report_id = \&#34;$report_id\&#34;&#34; -flatlist] &#34;{}&#34; ]

set  passAndQuickList [concat $quickList $passList]

puts &#34;Grant pass and quick list : $passAndQuickList&#34;
set failListfil &#34;&#34;
foreach elem $failList {

   <span class="comment-line">#if {![regexp {init|end} $elem]} {</span>

          if {[lsearch $passAndQuickList $elem] != -1} {

                  lappend failListfil $elem

           }

   <span class="comment-line">#}</span>

}

  puts &#34;Grant failing_tests_list : $failListfil&#34;
 set failing_tests_list $failListfil

 if {$failing_tests_list != &#34;NULL&#34;} {
    <span class="comment-line"># add call to cleanup</span>
    set failing_tests_list [concat $failing_tests_list cleanup]
  }
  puts &#34;DANY GetFailingTestsForModule failing_tests_list: $failing_tests_list&#34;
    if { $failing_tests_list == &#34;&#34; } {
	return &#34;all&#34;
    } else {
        <span class="comment-line"># filter away CoreDump, Failed and Aborted predefined meta test cases</span>
        set failing_tests_list [<a name="::GetFilteredListCoreDumpFailedAborted(2)"><a href="./mysqlLib.tcl.html#::GetFilteredListCoreDumpFailedAborted_1470">::GetFilteredListCoreDumpFailedAborted</a></a> $failing_tests_list]
	return $failing_tests_list
    }
}


<strong><a name="::::GetFilteredListCoreDumpFailedAborted_1470">proc <a href="mysqlLib.tcl-annot.html#::::GetFilteredListCoreDumpFailedAborted">::::GetFilteredListCoreDumpFailedAborted</a></a></strong> { origList } {

    set keys &#34;CoreDump Failed Aborted&#34;

    foreach key $keys {
        while { [lsearch $origList $key] &gt;= 0 } {
            set origList [<a name="::ldelete(1)"><a href="./misc.tcl.html#::ldelete_3310">::ldelete</a></a> $origList $key]
        }
    }

    return [string trim $origList]

}

<strong><a name="::::DetermineCfgRegTypeSubTypeFromRegId_1484">proc <a href="mysqlLib.tcl-annot.html#::::DetermineCfgRegTypeSubTypeFromRegId">::::DetermineCfgRegTypeSubTypeFromRegId</a></a></strong> { regId } {

    global mysql_handler

    puts &#34;DetermineCfgRegTypeSubTypeFromRegId regId = $regId&#34;
    <a name="::WriteToQueueDebug(1)"><a href="./queueLib.tcl.html#::WriteToQueueDebug_1582">::WriteToQueueDebug</a></a> &#34;DetermineCfgRegTypeSubTypeFromRegId: regTypeList query&#34; &#34;SELECT feature_type, feature_sub_type, platform_id \
            FROM regression_table WHERE regression_id = $regId&#34;
    set regTypeList [mysqlsel $mysql_handler &#34;SELECT feature_type, feature_sub_type, platform_id \
	    FROM regression_table WHERE regression_id = '$regId'&#34; -flatlist]

    puts &#34;DetermineCfgRegTypeSubTypeFromRegId regTypeList = $regTypeList&#34;

    if { $regTypeList == &#34;&#34; } {
	return -1
    }

    set regType     [lindex $regTypeList 0]
    set regSubType  [lindex $regTypeList 1]
    set platformId  [lindex $regTypeList 2]
    puts  &#34;platformId=$platformId&#34;
    set cfg [mysqlsel $mysql_handler &#34;SELECT platform_cfg_file_name FROM platform_table WHERE platform_id='$platformId'&#34; -flatlist]
    <a name="::WriteToQueueDebug(2)"><a href="./queueLib.tcl.html#::WriteToQueueDebug_1582">::WriteToQueueDebug</a></a> &#34;DetermineCfgRegTypeSubTypeFromRegId: cfg query&#34; &#34;SELECT platform_cfg_file_name FROM platform_table WHERE platform_id=$platformId&#34;
    <a name="::WriteToQueueDebug(3)"><a href="./queueLib.tcl.html#::WriteToQueueDebug_1582">::WriteToQueueDebug</a></a> &#34;DetermineCfgRegTypeSubTypeFromRegId: for regId $regId&#34; &#34;RETURNING -- $cfg $regType $regSubType&#34;
    global logFileId
    if {[info exists logFileId] &amp;&amp; $logFileId != &#34;&#34;} {
        puts $logFileId &#34;-------------------------------------------------------&#34;
        puts $logFileId &#34;DetermineCfgRegTypeSubTypeFromRegId: cfg query SELECT platform_cfg_file_name FROM platform_table WHERE platform_id=$platformId&#34;
        puts $logFileId &#34;DetermineCfgRegTypeSubTypeFromRegId: for regId $regId RETURNING -- $cfg $regType $regSubType&#34;
        puts $logFileId &#34;-------------------------------------------------------&#34;
    }
    return &#34;$cfg $regType $regSubType&#34;
}

<strong><a name="::::DetermineBuildNumFromRegId_1517">proc <a href="mysqlLib.tcl-annot.html#::::DetermineBuildNumFromRegId">::::DetermineBuildNumFromRegId</a></a></strong> { regId } {

    global mysql_handler

    set buildId [mysqlsel $mysql_handler &#34;SELECT build_id FROM regression_table WHERE regression_id = '$regId'&#34; -flatlist]

    set buildnumList [mysqlsel $mysql_handler &#34;SELECT build_minor_release,build_number FROM build_table WHERE build_id = '$buildId'&#34; -flatlist]

    set buildNum [join $buildnumList &#34;.&#34;]

    return $buildNum
}

<strong><a name="::::UpdateRegressionTableWithBuildIdPlId_1530">proc <a href="mysqlLib.tcl-annot.html#::::UpdateRegressionTableWithBuildIdPlId">::::UpdateRegressionTableWithBuildIdPlId</a></a></strong> { regression_id build_id platform_id } {
    global mysql_handler

    if { $platform_id != &#34;null&#34;} {
	set update_clause &#34;UPDATE  regression_table SET build_id='$build_id', \
                                                        platform_id='$platform_id', \
                                                        html_pd = 'no module' \
                           WHERE regression_id = '$regression_id'&#34;
    } else {
	set update_clause &#34;UPDATE  regression_table SET build_id='$build_id', \
                                                        html_pd = 'no module'  WHERE \
		regression_id = '$regression_id'&#34;
    }
	mysqlexec $mysql_handler $update_clause
}

<strong><a name="::::GetRegressionIdFromQueueId_1546">proc <a href="mysqlLib.tcl-annot.html#::::GetRegressionIdFromQueueId">::::GetRegressionIdFromQueueId</a></a></strong> { queue_id build platform_id module } {

    global mysql_handler
    
    <span class="comment-line"># try to find the regression id by queue_id and module (for the first run after the image download phase)</span>
    <span class="comment-line"># if this does not work find it by queue_id and platform_id</span>

    set sel_clause &#34;SELECT regression_id FROM regression_table WHERE \
            queue_id = '$queue_id' AND html_pd = '$module'&#34;;
    puts &#34;sel_clause for regression_id_list: $sel_clause&#34;
    set regression_id_list [mysqlsel $mysql_handler $sel_clause -flatlist]
    puts &#34;llength of regression_id_list: [llength $regression_id_list]&#34;
    
    if {([llength $regression_id_list] != 0)} {
      set regression_id [lindex $regression_id_list 0]
      <span class="comment-line"># we have entry in the regression_table</span>
      <span class="comment-line"># update it's build_id if build is not null</span>
      if { $build != &#34;null&#34; } {
        <span class="comment-line"># this will create an entry in build_table if it's not already there</span>
        puts &#34;@@@@\n@@@@\nBuild = $build\n@@@@@\n@@@@@&#34;
        set build_id [<a name="::GetBuildIdFromBuild(1)"><a href="./mysqlLib.tcl.html#::GetBuildIdFromBuild_1684">::GetBuildIdFromBuild</a></a> $build]
        <a name="::UpdateRegressionTableWithBuildIdPlId(1)"><a href="./mysqlLib.tcl.html#::UpdateRegressionTableWithBuildIdPlId_1530">::UpdateRegressionTableWithBuildIdPlId</a></a> $regression_id $build_id $platform_id 
      }
    } else {
        <span class="comment-line"># this is for mysqlAutomate pass</span>
      <span class="comment-line"># try to  find it by queue_id and platform_id</span>
      set sel_clause &#34;SELECT regression_id FROM regression_table WHERE \
              queue_id = '$queue_id' AND platform_id = '$platform_id'&#34;;
      puts &#34;sel_clause for regression_id_list: $sel_clause&#34;
      set regression_id_list [mysqlsel $mysql_handler $sel_clause -flatlist]
      puts &#34;llength of regression_id_list: [llength $regression_id_list]&#34;
    
      if {([llength $regression_id_list] != 0)} {
        set regression_id [lindex $regression_id_list 0]
      } else {
        <span class="comment-line"># this is for mysqlMain pass</span>
        set sel_clause &#34;SELECT regression_table.regression_id \
                        FROM regression_table, report_table, feature_table  \
                        WHERE regression_table.queue_id ='$queue_id' \
                        AND regression_table.regression_id = report_table.regression_id \
                        AND report_table.feature_id = feature_table.feature_id \
                        AND feature_table.feature_directory='$module'&#34;
        puts &#34;sel_clause for regression_id_list: $sel_clause&#34;
        set regression_id_list [mysqlsel $mysql_handler $sel_clause -flatlist]
        puts &#34;llength of regression_id_list: [llength $regression_id_list]&#34;
      
        if {([llength $regression_id_list] != 0)} {
          set regression_id [lindex $regression_id_list 0]
        } else {
          set regression_id &#34;null&#34;
        }
      }
    }


    return $regression_id
}

<strong><a name="::::GetRegressionId_1604">proc <a href="mysqlLib.tcl-annot.html#::::GetRegressionId">::::GetRegressionId</a></a></strong> { args } {

    <a name="::parse_args(19)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> GetRegressionId $args {
	queue_id &#34;NULL&#34;
	build_id &#34;NULL&#34;
	platform_id &#34;NULL&#34;
	feature_type &#34;functional&#34;
	feature_sub_type &#34;standard&#34;
        download_phase_module &#34;NULL&#34;
    }

    global mysql_handler

    puts &#34;we do not have regression_id - let's see if we can get it from the regression_table&#34;
    puts &#34;build_id: $build_id&#34;
    puts &#34;platform_id: $platform_id&#34;


    if { $download_phase_module == &#34;NULL&#34;} {
        puts &#34;not a download image case&#34;

        set sel_clause &#34;SELECT regression_id FROM regression_table WHERE \
	        queue_id = '$queue_id' AND \
	        build_id = '$build_id' AND \
	        platform_id = '$platform_id' AND \
	        feature_type = '$feature_type' AND \
	        feature_sub_type = '$feature_sub_type'&#34;
        puts &#34;sel_clause for regression_id_list: $sel_clause&#34;
        set regression_id [mysqlsel $mysql_handler $sel_clause -flatlist]
        puts &#34;llength of regression_id_list: [llength $regression_id]&#34;
    
        if {([llength $regression_id] != 0)} {
	    puts &#34;we found regression_id: $regression_id - lets set total_number_of_runs to 1&#34;
	    <span class="comment-line"># lets set total_number_of_runs to 1</span>
	    set update_clause &#34;UPDATE  regression_table SET total_number_of_runs='1' WHERE \
		    regression_id = '$regression_id'&#34;
	    mysqlexec $mysql_handler $update_clause
        } else {
	    puts &#34;we did not found regression_id - create entry in the regression table&#34;
	    <span class="comment-line">#set feature_type $regType</span>
	    <a name="::InsertIntoRegressionTable(1)"><a href="./mysqlLib.tcl.html#::InsertIntoRegressionTable_261">::InsertIntoRegressionTable</a></a> -queue_id $queue_id -build_id $build_id -platform_id $platform_id \
		    -feature_type $feature_type -feature_sub_type $feature_sub_type -html_pd $download_phase_module
	    <span class="comment-line"># get the new regression_id</span>
            <span class="comment-line"># unused html_pd fiels is using for detecting the right entry for the first run</span>
            <span class="comment-line"># if there was a image download phase</span>
	    set regression_id [mysqlsel $mysql_handler $sel_clause -flatlist]
	    puts &#34;InsertIntoRegressionTable regression_id $regression_id queue_id $queue_id \
                                  build_id $build_id platform_id $platform_id \
                                  feature_type $feature_type feature_sub_type $feature_sub_type \
                                  html_pd $download_phase_module&#34;
        }


    } else {
        puts &#34;download image case&#34;
	    puts &#34;we did not found regression_id - create entry in the regression table&#34;
	    <span class="comment-line">#set feature_type $regType</span>
	    <a name="::InsertIntoRegressionTable(2)"><a href="./mysqlLib.tcl.html#::InsertIntoRegressionTable_261">::InsertIntoRegressionTable</a></a> -queue_id $queue_id -build_id $build_id -platform_id $platform_id \
		    -feature_type $feature_type -feature_sub_type $feature_sub_type -html_pd $download_phase_module
	    <span class="comment-line"># get the new regression_id</span>
            <span class="comment-line"># unused html_pd fiels is using for detecting the right entry for the first run</span>
            <span class="comment-line"># if there was a image download phase</span>
        set sel_clause &#34;SELECT regression_id FROM regression_table WHERE \
	        queue_id = '$queue_id' AND \
	        build_id = '$build_id' AND \
	        platform_id = '$platform_id' AND \
	        html_pd = '$download_phase_module' AND \
	        feature_type = '$feature_type' AND \
	        feature_sub_type = '$feature_sub_type'&#34;
        puts &#34;sel_clause 2 for regression_id_list: $sel_clause&#34;
	    set regression_id [mysqlsel $mysql_handler $sel_clause -flatlist]
	    puts &#34;InsertIntoRegressionTable regression_id $regression_id queue_id $queue_id \
                                  build_id $build_id platform_id $platform_id \
                                  feature_type $feature_type feature_sub_type $feature_sub_type \
                                  html_pd $download_phase_module&#34;
    }

    return $regression_id
}

<strong><a name="::::GetBuildIdFromBuild_1684">proc <a href="mysqlLib.tcl-annot.html#::::GetBuildIdFromBuild">::::GetBuildIdFromBuild</a></a></strong> { build } {

    global mysql_handler
    set major &#34;&#34;
    set minor &#34;&#34;
    set patch &#34;&#34;
    set buildnumber &#34;&#34;
    regexp {([0-9]+)\.([0-9]+)\.([0-9]+)[\.b]([0-9]+.*)} $build match major minor patch buildnumber
    set minorver $major.$minor.$patch
    set build_list [mysqlsel $mysql_handler &#34;SELECT build_id FROM build_table WHERE build_minor_release='$minorver' AND build_number='$buildnumber'&#34; -flatlist]
    <span class="comment-line">#if we do not have a build_id</span>
    if { [llength $build_list] == 0 } {
	puts &#34;we do not have build_id get one&#34;
	
	if ![regexp {([0-9]+)\.([0-9]+)\.([0-9]+)[\.b]([0-9]+.*)} \
		$build match \
		major minor patch buildnumber] {
	    puts &#34;$build not in good format.&#34;
	    return &#34;error&#34;
	}
	puts &#34;major: $major&#34;
	puts &#34;minor: $minor&#34;
	puts &#34;patch: $patch&#34;
	puts &#34;buildnumber: $buildnumber&#34;
	set build_major_release &#34;$major.$minor&#34;
	puts &#34;build_major_release: $build_major_release&#34;
	set build_minor_release &#34;$major.$minor.$patch&#34;
	puts &#34;build_minor_release: $build_minor_release&#34;
	set build_number &#34;$buildnumber&#34;
	puts &#34;build_number: $build_number&#34;
	set sel_clause &#34;SELECT build_id FROM build_table WHERE \
		build_major_release = '$build_major_release' AND \
		build_minor_release = '$build_minor_release' AND \
		build_number = '$build_number'&#34;
	set build_list [mysqlsel $mysql_handler $sel_clause -flatlist]
	puts &#34;llength of build_list: [llength $build_list]&#34;
	if { [llength $build_list] != 0 } {
	    set build_id [lindex $build_list 0]
	    puts &#34;we found build_id: $build_id&#34;
	} else {
	    puts &#34;we did not found build_id - enter it into the build table&#34;
	    puts &#34;get system_id from the database&#34;
	    set system_id [mysqlsel $mysql_handler &#34;SELECT system_id FROM system_table WHERE system_name = 'exos'&#34; -flatlist]
	    puts &#34;got system_id: $system_id&#34;
	    <a name="::InsertIntoBuildTable(1)"><a href="./mysqlLib.tcl.html#::InsertIntoBuildTable_162">::InsertIntoBuildTable</a></a> -system_id $system_id -build_major_release $build_major_release \
		    -build_minor_release $build_minor_release -build_number $build_number
	    <span class="comment-line"># get the new build_id</span>
	    set build_id [mysqlsel $mysql_handler $sel_clause -flatlist]
	}
    } else {
	set build_id [lindex $build_list 0]
	puts &#34;we found build_id: $build_id&#34;	
    }

    puts &#34;build_id = $build_id&#34;
    return $build_id
}
<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure: get_platform_code</span>
<span class="comment-line">#</span>
<span class="comment-line"># Get the database regression code based on types, blade and platform from main/runReg.cfg</span>
<span class="comment-line">#    The cfg file is also used by runReg to get the code for mysqlAutomate and mysqlMain exec.</span>
<span class="comment-line">#</span>
<span class="comment-line">#############################################################################################</span>
<strong><a name="::::get_platform_code_1748">proc <a href="mysqlLib.tcl-annot.html#::::get_platform_code">::::get_platform_code</a></a></strong> {{regType functional} {regSubType None} {platform None} {blade None}} {
    global regplatform
    global cfg
    global cfgFileTail
    global MAIN

    if {![info exists cfg] || $cfg == &#34;&#34;} {set cfg &#34;NOT SET&#34;}
    if {![info exists cfgFileTail] || $cfgFileTail == &#34;&#34;} {set cfgFileTail &#34;NOT SET&#34;}
    <a name="::WriteToQueueDebug(4)"><a href="./queueLib.tcl.html#::WriteToQueueDebug_1582">::WriteToQueueDebug</a></a> &#34;get_platform_code: top&#34; \
        &#34;platform $platform, regSubType $regSubType, blade $blade, \
        regType $regType ,cfg $cfg , cfgFileTail $cfgFileTail &#34;;
    foreach platform_code_this [array names regplatform] {
        <span class="comment-line">#puts &#34;$platform_code_this == $regplatform($platform_code_this)&#34;</span>
        set platform_code_lst_this $regplatform($platform_code_this)
        set platform_this [lindex $platform_code_lst_this 0]   ;<span class="comment-line"># Summit</span>
        set blade_this [lindex $platform_code_lst_this 1]      ;<span class="comment-line"># X250e-48t p2_x250_ipr.cfg functional ipRoute1</span>
        set cfg_this [lindex $platform_code_lst_this 2]        ;<span class="comment-line"># p2_x250_ipr.cfg functional ipRoute1</span>
        set regType_this [lindex $platform_code_lst_this 3]    ;<span class="comment-line"># functional</span>
        set regSubType_this [lindex $platform_code_lst_this 4] ;<span class="comment-line"># ipRoute1</span>
        if {($cfg_this == $cfgFileTail) &amp;&amp; \
                ($regType_this == $regType) &amp;&amp; \
                ($regSubType_this == $regSubType)} {
            <a name="::WriteToQueueDebug(5)"><a href="./queueLib.tcl.html#::WriteToQueueDebug_1582">::WriteToQueueDebug</a></a> &#34;get_platform_code:  RETURN&#34; \
                &#34;returning $platform_code_this - input args $regType $regSubType \
                $platform_this $blade_this&#34;;
            <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n==================== new new =========================\n\
                get_platform_code RETURN: \n\
                runReg Platform: $platform_code_this \n\
                cfgFile=$cfgFileTail\n\
                regType=$regType_this\n\
                regSubType=$regSubType_this\n\
                blade=$blade_this\n\
                ===================================================== &#34;
            return &#34;$platform_code_this&#34;
        }
        if {[info exists cfgFileTail] &amp;&amp; $cfg_this == $cfgFileTail &amp;&amp; \
                $regType_this == $regType} {
            <a name="::WriteToQueueDebug(6)"><a href="./queueLib.tcl.html#::WriteToQueueDebug_1582">::WriteToQueueDebug</a></a> &#34;get_platform_code: RETURN on cfg only match&#34; \
                &#34;returning $platform_code_this - input args $regType $regSubType \
                $platform_this $blade_this&#34;;
            <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n==================== new new =========================\n\
                get_platform_code RETURN: \n\
                runReg Platform: $platform_code_this \n\
                MATCH USING ONLY -&gt; cfgFile=$cfgFileTail\n\
                regType=$regType_this\n\
                regSubType=$regSubType_this\n\
                blade=$blade_this\n\
                ===================================================== &#34;         
            return &#34;$platform_code_this&#34;
        }
    }
    <a name="::WriteToQueueDebug(7)"><a href="./queueLib.tcl.html#::WriteToQueueDebug_1582">::WriteToQueueDebug</a></a> &#34;get_platform_code: Last Result&#34; &#34;return plat not found&#34;;
    return &#34;not_found&#34;
}


<strong><a name="::::conn_db_1804">proc <a href="mysqlLib.tcl-annot.html#::::conn_db">::::conn_db</a></a></strong> {host db user passwd} {
  global mysqlstatus mysql_handler
  set user regression_user
  set password extreme
  catch {mysqlconnect -host $host -user $user -password $password -db $db} mysql_handler
  <span class="comment-line">#puts $mysqlstatus(code);</span>
  if {$mysqlstatus(code) !=0} {
      puts stderr $mysqlstatus(message)
      <span class="comment-line">#mysqlclose $mysql_handler</span>
     return $mysqlstatus(code)
  }
  <span class="comment-line">#mysqlexec  $mysql_handler &#34;SET max_allowed_packet=50000000&#34;</span>
  return $mysqlstatus(code)
}

<strong><a name="::::getPlatformId_1819">proc <a href="mysqlLib.tcl-annot.html#::::getPlatformId">::::getPlatformId</a></a></strong> {platform} {
  global mysql_handler regplatform

  set platform_code_lst $regplatform($platform)
  set cfg_file [lindex $platform_code_lst 2]

  set sel_clause &#34;SELECT platform_id FROM platform_table WHERE platform_cfg_file_name='$cfg_file'&#34;
  set platform_id_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
  set platform_id [lindex $platform_id_lst 0];<span class="comment-line"># only single result</span>
  return $platform_id
}

<strong><a name="::::getCfgFamilies_1831">proc <a href="mysqlLib.tcl-annot.html#::::getCfgFamilies">::::getCfgFamilies</a></a></strong> {cfg} {
    global mysqlstatus mysqlIP my_db

    set user regression_user
    set password extreme
    if {[catch {mysqlconnect -host $mysqlIP -user $user -password $password -db $my_db} myhandle]} {
        puts &#34;Could not connecto the the database: $myhandle&#34;
        return -1;
    }

    set sel_clause &#34;SELECT target_os, additional_os FROM platform_table WHERE platform_cfg_file_name='$cfg'&#34;
    set qlst [mysqlsel $myhandle $sel_clause -list]
    set targos [lindex $qlst 0]
    set addoslst  [split [lindex $qlst 1] &#34; &#34;]
    lappend flist $targos
    set outList [concat $flist $addoslst]
    catch {close $myhandle} oops
    return $outList
}

<strong><a name="::::getBuidId_1851">proc <a href="mysqlLib.tcl-annot.html#::::getBuidId">::::getBuidId</a></a></strong> {build_major} {
  global mysql_handler

  set sel_clause &#34;SELECT build_id FROM build_table WHERE build_major_release ='$build_major' ORDER BY build_id DESC LIMIT 1&#34;
  set build_id_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
  <span class="comment-line"># only single result</span>
  set build_id [lindex $build_id_lst 0]
  return $build_id
}

<strong><a name="::::getFeatureId_1861">proc <a href="mysqlLib.tcl-annot.html#::::getFeatureId">::::getFeatureId</a></a></strong> {module} {
  global mysql_handler

  set sel_clause &#34;SELECT feature_id FROM feature_table WHERE feature_name ='$module' AND status = 'Active'&#34;
  set feature_id_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
  <span class="comment-line"># only single result</span>
  set feature_id [lindex $feature_id_lst 0]
  return $feature_id
}

<strong><a name="::::getFeatureIdByDirectory_1871">proc <a href="mysqlLib.tcl-annot.html#::::getFeatureIdByDirectory">::::getFeatureIdByDirectory</a></a></strong> {module} {
  global mysql_handler

  set sel_clause &#34;SELECT feature_id FROM feature_table WHERE feature_directory ='$module' AND status = 'Active'&#34;
  set feature_id_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
  <span class="comment-line"># only single result</span>
  set feature_id [lindex $feature_id_lst 0]
  return $feature_id
}
<span class="comment-line">###############################################################################</span>
<span class="comment-line"># Get feature id from specific db handle</span>
<span class="comment-line">#</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::getFeatureIdByDirectoryDb_1884">proc <a href="mysqlLib.tcl-annot.html#::::getFeatureIdByDirectoryDb">::::getFeatureIdByDirectoryDb</a></a></strong> {args} {

    <a name="::parse_args(20)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> getFeatureIdByDirectoryDb $args {
        feature_directory &#34;&#34;
        feature_type &#34;functional&#34;
        hdl &#34;&#34;
    }

    set sel_clause &#34;SELECT feature_id FROM feature_table WHERE feature_directory = '$feature_directory' \
          AND feature_type = '$feature_type' AND status = 'Active'&#34;
    set feature_id_lst [mysqlsel $hdl $sel_clause -flatlist]
    <span class="comment-line"># only single result</span>
    set feature_id [lindex $feature_id_lst 0]
    return $feature_id

}


<strong><a name="::::getRegressionId_1902">proc <a href="mysqlLib.tcl-annot.html#::::getRegressionId">::::getRegressionId</a></a></strong> {build_id platform_id tcList} {
  global mysql_handler

  if {$tcList == &#34;quick&#34;} {
     set test_this_duration test_quick_duration
  } elseif {$tcList == &#34;pass&#34;} {
     set test_this_duration test_pass_duration
  } else {
     set test_this_duration test_all_duration
  }

  set sel_clause &#34;SELECT regression_table.regression_id FROM regression_table, report_table \
                  WHERE regression_table.build_id ='$build_id' \
                  AND regression_table.platform_id ='$platform_id' \
                  AND regression_table.regression_id = report_table.regression_id \
                  AND report_table.$test_this_duration != '0' ORDER BY regression_id DESC LIMIT 1&#34;
  set regression_id_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
  <span class="comment-line"># only single result</span>
  set regression_id [lindex $regression_id_lst 0]
  <span class="comment-line">#puts &#34;getRegressionId sel_clause \n $sel_clause \n&#34;</span>
  <span class="comment-line">#puts &#34;getRegressionId regression_id $regression_id\n&#34;</span>
  return $regression_id
}

<strong><a name="::::getReportId_1926">proc <a href="mysqlLib.tcl-annot.html#::::getReportId">::::getReportId</a></a></strong> {regression_id feature_id} {
  global mysql_handler

  set sel_clause &#34;SELECT report_id FROM report_table WHERE regression_id ='$regression_id' AND feature_id ='$feature_id'&#34;
  set report_id_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
  <span class="comment-line"># only single result</span>
  set report_id [lindex $report_id_lst 0]
  <span class="comment-line">#puts &#34;getReportId sel_clause \n $sel_clause \n&#34;</span>
  <span class="comment-line">#puts &#34;getReportId report_id $report_id\n&#34;</span>
  return $report_id
}
<span class="comment-line">##############################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##############################################################################</span>
<strong><a name="::::getRegressionIdDb_1941">proc <a href="mysqlLib.tcl-annot.html#::::getRegressionIdDb">::::getRegressionIdDb</a></a></strong> {args} {

    <a name="::parse_args(21)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> getRegressionIdDb $args {
        build_id &#34;2&#34;
        platform_id &#34;&#34;
        tcList &#34;&#34;
        queue_id &#34;null&#34;
        hdl &#34;&#34;
    }

    if {$queue_id == &#34;null&#34;} {
        if {$tcList == &#34;quick&#34;} {
            set test_this_duration test_quick_duration
        } elseif {$tcList == &#34;pass&#34;} {
            set test_this_duration test_pass_duration
        } else {
            set test_this_duration test_all_duration
        }

        set sel_clause &#34;SELECT regression_table.regression_id FROM regression_table, report_table \
              WHERE regression_table.build_id ='$build_id' \
              AND regression_table.platform_id ='$platform_id' \
              AND regression_table.regression_id = report_table.regression_id \
              AND report_table.$test_this_duration != '0' ORDER BY regression_id DESC LIMIT 1&#34;
    } else {
        set sel_clause &#34;SELECT regression_id FROM regression_table \
              WHERE queue_id ='$queue_id' ORDER BY regression_id DESC LIMIT 1&#34;
    }
    set regression_id_lst [mysqlsel $hdl $sel_clause -flatlist]
    <span class="comment-line"># only single result</span>
    set regression_id [lindex $regression_id_lst 0]
    <span class="comment-line">#puts &#34;getRegressionId sel_clause \n $sel_clause \n&#34;</span>
    <span class="comment-line">#puts &#34;getRegressionId regression_id $regression_id\n&#34;</span>
    return $regression_id
}

<strong><a name="::::getReportIdDb_1977">proc <a href="mysqlLib.tcl-annot.html#::::getReportIdDb">::::getReportIdDb</a></a></strong> {args} {

    <a name="::parse_args(22)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> getReportIdDb $args {
        regression_id &#34;null&#34;
        feature_id &#34;null&#34;
        hdl &#34;null&#34;
    }

    set sel_clause &#34;SELECT report_id FROM report_table WHERE regression_id ='$regression_id' AND feature_id ='$feature_id'&#34;
    set report_id_lst [mysqlsel $hdl $sel_clause -flatlist]
    <span class="comment-line"># only single result</span>
    set report_id [lindex $report_id_lst 0]
    <span class="comment-line">#puts &#34;getReportId sel_clause \n $sel_clause \n&#34;</span>
    <span class="comment-line">#puts &#34;getReportId report_id $report_id\n&#34;</span>
    return $report_id
}

<strong><a name="::::getExpectedDurationSingleTestCase_1994">proc <a href="mysqlLib.tcl-annot.html#::::getExpectedDurationSingleTestCase">::::getExpectedDurationSingleTestCase</a></a></strong> {feature_id test_case platform_id build_id} {
  global mysql_handler

  set sel_clause &#34;SELECT log_duration FROM report_table, log_table, regression_table \
                  WHERE regression_table.build_id ='$build_id' \
                    AND regression_table.platform_id = '$platform_id' \
                    AND report_table.regression_id = regression_table.regression_id \
                    AND report_table.feature_id = '$feature_id' \
                    AND log_table.report_id = report_table.report_id \
                    AND log_table.feature_test_script_name = '$test_case' \
                    AND log_table.log_duration != '0' ORDER BY log_id DESC LIMIT 1&#34;
  set log_duration_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
  <span class="comment-line">#puts &#34;getExpectedDurationSingleTestCase sel_clause \n  $sel_clause\n&#34;</span>
  <span class="comment-line">#puts &#34;log_duration_lst $log_duration_lst\n&#34;</span>
  <span class="comment-line"># only single result</span>
  set log_duration [lindex $log_duration_lst 0]
  return $log_duration
}

<strong><a name="::::getExpectedDurationFromLog_2013">proc <a href="mysqlLib.tcl-annot.html#::::getExpectedDurationFromLog">::::getExpectedDurationFromLog</a></a></strong> {feature_id platform_id build_id tcList} {

  global mysql_handler

  set total_log_duration 0
puts &#34;feature_id $feature_id, platform_id $platform_id, build_id $build_id, tcList $tcList&#34;
  foreach test_case $tcList {
    set log_duration_this [<a name="::getExpectedDurationSingleTestCase(1)"><a href="./mysqlLib.tcl.html#::getExpectedDurationSingleTestCase_1994">::getExpectedDurationSingleTestCase</a></a> $feature_id $test_case $platform_id $build_id]
    if {($log_duration_this == &#34;0&#34;) || \
        ($log_duration_this == &#34;&#34;) || \
        ($log_duration_this == &#34;null&#34;) || \
        ($log_duration_this == &#34;NULL&#34;)} {
      return &#34;null&#34;;
    } else {
      set total_log_duration [expr $total_log_duration + $log_duration_this]
    }
  }
  return $total_log_duration
}



<strong><a name="::::getExpectedDurationFromReport_2035">proc <a href="mysqlLib.tcl-annot.html#::::getExpectedDurationFromReport">::::getExpectedDurationFromReport</a></a></strong> {report_id tcList} {
  global mysql_handler

  if {$tcList == &#34;quick&#34;} {
     set test_this_duration test_quick_duration
  } elseif {$tcList == &#34;pass&#34;} {
     set test_this_duration test_pass_duration
  } else {
     set test_this_duration test_all_duration
  }
  set sel_clause &#34;SELECT $test_this_duration FROM report_table WHERE report_id ='$report_id'&#34;
  set expected_duration_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
  <span class="comment-line">#puts &#34;getExpectedDurationFromReport sel_clause \n  $sel_clause\n&#34;</span>
  <span class="comment-line">#puts &#34;expected_duration_lst $expected_duration_lst\n&#34;</span>
  <span class="comment-line"># only single result</span>
  set expected_duration [lindex $expected_duration_lst 0]
  return $expected_duration
}


<strong><a name="::::getExpectedDuration_2055">proc <a href="mysqlLib.tcl-annot.html#::::getExpectedDuration">::::getExpectedDuration</a></a></strong> { platform build_major module tcList host db user passwd } {
  global mysql_handler

  <a name="::conn_db(1)"><a href="./mysqlLib.tcl.html#::conn_db_1804">::conn_db</a></a> $host $db $user $passwd
  set expected_duration &#34;null&#34;
  if {($tcList!=&#34;&#34;)&amp;&amp;($tcList!=&#34;null&#34;)&amp;&amp;($tcList!=&#34;NULL&#34;)} {
    set platform_id [<a name="::getPlatformId(1)"><a href="./mysqlLib.tcl.html#::getPlatformId_1819">::getPlatformId</a></a> $platform]
    set build_id [<a name="::getBuidId(1)"><a href="./mysqlLib.tcl.html#::getBuidId_1851">::getBuidId</a></a> $build_major]
    set feature_id [<a name="::getFeatureId(1)"><a href="./mysqlLib.tcl.html#::getFeatureId_1861">::getFeatureId</a></a> $module]
    if {($tcList==&#34;all&#34;)||($tcList==&#34;pass&#34;)||($tcList==&#34;quick&#34;)} {
      set regression_id [<a name="::getRegressionId(1)"><a href="./mysqlLib.tcl.html#::getRegressionId_1902">::getRegressionId</a></a> $build_id $platform_id $tcList]
      set report_id [<a name="::getReportId(1)"><a href="./mysqlLib.tcl.html#::getReportId_1926">::getReportId</a></a> $regression_id $feature_id]
      set expected_duration [<a name="::getExpectedDurationFromReport(1)"><a href="./mysqlLib.tcl.html#::getExpectedDurationFromReport_2035">::getExpectedDurationFromReport</a></a> $report_id $tcList]
    } else {
puts &#34;the test $tcList&#34;
      set expected_duration [<a name="::getExpectedDurationFromLog(1)"><a href="./mysqlLib.tcl.html#::getExpectedDurationFromLog_2013">::getExpectedDurationFromLog</a></a> $feature_id $platform_id $build_id $tcList]
    }
  }
  if {($expected_duration==&#34;&#34;)||($expected_duration==&#34;null&#34;)||($expected_duration==&#34;NULL&#34;)} {
    set expected_duration &#34;null&#34;
  }
  return $expected_duration
}
<strong><a name="::::InsertIntoLimgFileTable_2078">proc <a href="mysqlLib.tcl-annot.html#::::InsertIntoLimgFileTable">::::InsertIntoLimgFileTable</a></a></strong> {args} {
  <a name="::parse_args(23)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertIntoLimgFileTable $args { 
    limg_file_id &#34;&#34;
    report_id &#34;&#34;
    limg_file_name &#34;&#34;
    limg_file_type &#34;&#34;
    limg_file_content &#34;&#34;
    limg_file_comment &#34;&#34;
    limg_file_status &#34;none&#34;
    limg_file_create_date &#34;&#34;
    host &#34;&#34; 
  }

  global mysql_handler
  <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } { </span>
    <span class="comment-line">#return -1</span>
  <span class="comment-line">#} else {</span>
    <span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
  <span class="comment-line">#}</span>
  <span class="comment-line">#puts &#34;InsertIntoLimgFileTable entering&#34;</span>

  set d1 [exec date +%Y-%m-%d]
  set d2 [exec date +%k:%M:%S]
  set d [append d $d1]
  set d [append d &#34; &#34;]
  set d [append d $d2]

  set insert_clause [append insert_clause &#34;insert into limg_file_table &#34;]
  set insert_clause [append insert_clause &#34;(limg_file_id, &#34;]
  set insert_clause [append insert_clause &#34;report_id, &#34;]
  set insert_clause [append insert_clause &#34;limg_file_name, &#34;]
  set insert_clause [append insert_clause &#34;limg_file_type, &#34;]
  set insert_clause [append insert_clause &#34;limg_file_content, &#34;]
  set insert_clause [append insert_clause &#34;limg_file_comment, &#34;]
  set insert_clause [append insert_clause &#34;limg_file_status, &#34;]
  set insert_clause [append insert_clause &#34;limg_file_create_date) &#34;]

  set insert_clause [append insert_clause &#34;values (\&#34;$limg_file_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$report_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$limg_file_name\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$limg_file_type\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$limg_file_content\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$limg_file_comment\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$limg_file_status\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$d\&#34;) &#34;]

  mysqlexec  $mysql_handler $insert_clause
  <span class="comment-line">#mysqlclose $mysql_handler</span>
  return 0
}

<strong><a name="::::InsertAllInfoFilesIntoLimgFileTable_2129">proc <a href="mysqlLib.tcl-annot.html#::::InsertAllInfoFilesIntoLimgFileTable">::::InsertAllInfoFilesIntoLimgFileTable</a></a></strong> {args} {
  <a name="::parse_args(24)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertAllInfoFilesIntoXfileTable $args {
    report_id &#34;&#34;
    logDir &#34;&#34;
    host &#34;&#34;
  }

  set infoFiles [<a name="::FindInfoFiles(2)"><a href="./mysqlLib.tcl.html#::FindInfoFiles_982">::FindInfoFiles</a></a> $logDir]
  puts &#34;DANY InsertAllInfoFilesIntoLimgFileTable infoFiles: $infoFiles&#34;
  foreach infoFile $infoFiles {
    set infoFileTmp $infoFile
    <span class="comment-line"># set infoFileName [string trimright $infoFile &#34;.txt&#34;]</span>

    set infoFileSplit [split  $infoFile &#34;.&#34;]
    set infoFileSplitSize [expr [llength $infoFileSplit] - 2]
    set infoFileSplitTrimmed [lrange $infoFileSplit 0 $infoFileSplitSize]
    set infoFileName [join $infoFileSplitTrimmed &#34;.&#34;]

    set infoFile [file join $logDir $infoFile]
    puts $infoFile
    <a name="::createFileBlob(6)"><a href="./mysqlLib.tcl.html#::createFileBlob_331">::createFileBlob</a></a> $infoFile infoFileBlob

    <a name="::InsertIntoLimgFileTable(1)"><a href="./mysqlLib.tcl.html#::InsertIntoLimgFileTable_2078">::InsertIntoLimgFileTable</a></a> -report_id $report_id -limg_file_name $infoFileName \
                          -limg_file_type &#34;text&#34; -limg_file_content $infoFileBlob -host $host

  }

}

<strong><a name="::::CreateEmailResultLink_2158">proc <a href="mysqlLib.tcl-annot.html#::::CreateEmailResultLink">::::CreateEmailResultLink</a></a></strong> {args} {
  <a name="::parse_args(25)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CreateEmailResultLink $args {
    queue_id &#34;&#34;
    feature_directory &#34;&#34;
    mydb_name &#34;devweb_db&#34;
    host &#34;regserver1&#34;
    mydb_host &#34;regserver1&#34;
  }

  global mysql_handler

  <a name="::conn_to_db(1)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $mydb_host $mydb_name

  set query &#34;SELECT feature_table.feature_id, \
                feature_table.feature_name, \
                regression_table.regression_id, \
                build_table.build_id, \
                build_table.build_minor_release, \
                build_table.build_number, \
                platform_table.platform_name, \
                platform_table.platform_blade, \
                platform_table.number_nodes, \
                aa_table.aa_first_name, \
                aa_table.aa_last_name \
                FROM feature_table, build_table, platform_table, \
                     report_table, regression_table, aa_table \
                WHERE regression_table.queue_id=\&#34;$queue_id\&#34; \
                AND feature_table.feature_directory= \&#34;$feature_directory\&#34; \
                AND report_table.feature_id = feature_table.feature_id \
                AND report_table.regression_id = regression_table.regression_id \
                AND report_table.run_number = '1' \
                AND regression_table.build_id = build_table.build_id \
                AND regression_table.platform_id = platform_table.platform_id \
                AND aa_table.aa_id = feature_table.aa_id&#34;

  set query_result_list [mysqlsel $mysql_handler $query -list]

  set query_result_list [lindex $query_result_list 0]
  set feature_id [lindex $query_result_list 0]
  set feature_name [lindex $query_result_list 1]
  set regression_id [lindex $query_result_list 2]
  set build_id [lindex $query_result_list 3]
  set build_minor_release [lindex $query_result_list 4]
  set build_number [lindex $query_result_list 5]
  set platform_name [lindex $query_result_list 6]
  set platform_blade [lindex $query_result_list 7]
  set number_nodes [lindex $query_result_list 8]
  set aa_first_name [lindex $query_result_list 9]
  set aa_last_name [lindex $query_result_list 10]

  set aa_name &#34;$aa_first_name $aa_last_name&#34;
  set build_name &#34;$build_minor_release.$build_number&#34;

  set href &#34;&lt;http://$host/generateQuingResultsSinglePlatform.php?feature_id=$feature_id&amp;feature_name=$feature_name&amp;build_id=$build_id&amp;build_name=$build_name&amp;platform_name=$platform_name&amp;platform_blade=$platform_blade&amp;number_nodes=$number_nodes&amp;regression_id=$regression_id&amp;queue_id=$queue_id&amp;aa_name=$aa_name&amp;host=$mydb_host&gt;&#34;

  return $href
}

<span class="comment-line"># Takes as input the numNodes and returns all platforms with that many numNodes; used for reordering regression modules</span>
<strong><a name="::::GetAllPlatformIds_2217">proc <a href="mysqlLib.tcl-annot.html#::::GetAllPlatformIds">::::GetAllPlatformIds</a></a></strong> { numNodes } {
    global mysql_handler

    set sel_clause &#34;SELECT platform_id from platform_table where number_nodes='$numNodes'&#34;;
    set platform_id_lst [mysqlsel $mysql_handler $sel_clause -flatlist]

    return $platform_id_lst
}
<span class="comment-line">########################################################################</span>
<span class="comment-line"># Takes as input the numNodes and platform_name and returns all </span>
<span class="comment-line">#       all platforms_ids with that many numNodes of that platform name</span>
<span class="comment-line">#   - Initially used for reordering regression modules</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Usage:</span>
<span class="comment-line">#  set idList [GetPlatformTypeIds 2 ASPEN]</span>
<span class="comment-line">########################################################################</span>
<strong><a name="::::GetPlatformTypeIds_2233">proc <a href="mysqlLib.tcl-annot.html#::::GetPlatformTypeIds">::::GetPlatformTypeIds</a></a></strong> { numNodes platform } {
    global mysql_handler

    set sel_clause &#34;SELECT platform_id from platform_table where number_nodes='$numNodes' AND platform_name='$platform'&#34;;
    set platform_id_lst [mysqlsel $mysql_handler $sel_clause -flatlist]

    return $platform_id_lst
}
<span class="comment-line"># What is the currently running platform ID?</span>
<strong><a name="::::GetCurrentPlatformId_2242">proc <a href="mysqlLib.tcl-annot.html#::::GetCurrentPlatformId">::::GetCurrentPlatformId</a></a></strong> { platform blade numNodes } {
    global mysql_handler

    set sel_clause &#34;SELECT platform_id from platform_table where platform_name='$platform' and platform_blade='$blade' and number_nodes='$numNodes'&#34;;
    set platform_id [mysqlsel $mysql_handler $sel_clause -flatlist]

    return $platform_id
}

<strong><a name="::::getEfenceProcessList_2251">proc <a href="mysqlLib.tcl-annot.html#::::getEfenceProcessList">::::getEfenceProcessList</a></a></strong> {args} {
    <a name="::parse_args(26)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> getEfenceProcessList $args {
      module &#34;&#34;
      cfg &#34;&#34;
      regType &#34;functional&#34;
    }
    global mysql_handler
    puts &#34;getEfenceProcessList module $module cfg $cfg&#34;

    <span class="comment-line"># is this a stackable?</span>
    set sel_clause &#34;SELECT platform_type from platform_table where platform_cfg_file_name='$cfg'&#34;;
    set platform_type [mysqlsel $mysql_handler $sel_clause -flatlist]
    puts &#34;getEfenceProcessList platform_type $platform_type&#34;

    if {$platform_type == &#34;stackable&#34;} {
      set efence_processes &#34;&#34;
    } else {
      set sel_clause &#34;SELECT efence_processes from feature_table where status = 'Active' AND feature_directory='$module' and feature_type='$regType'&#34;;
      set efence_processes [mysqlsel $mysql_handler $sel_clause -flatlist]
      <span class="comment-line">#this is comma separated list with possible spaces</span>
      set efence_processes [join $efence_processes &#34; &#34;]
      set efence_processes [string map {&#34; &#34; &#34;&#34;} $efence_processes]
      set efence_processes [split $efence_processes ,]
    }
    puts &#34;getEfenceProcessList efence_processes $efence_processes&#34;
    return $efence_processes
}



<span class="comment-line"># enter protected region </span>
<strong><a name="::::getLock_2282">proc <a href="mysqlLib.tcl-annot.html#::::getLock">::::getLock</a></a></strong> {name wait_limit} {
  global mysql_handler

  set sel_clause &#34;SELECT GET_LOCK('$name', $wait_limit)&#34;;
  set rslt [mysqlsel $mysql_handler $sel_clause -flatlist]
  return $rslt
}

<span class="comment-line"># leave protected region </span>
<strong><a name="::::releaseLock_2291">proc <a href="mysqlLib.tcl-annot.html#::::releaseLock">::::releaseLock</a></a></strong> {name} {
  global mysql_handler

  set sel_clause &#34;SELECT RELEASE_LOCK('$name')&#34;;
  set rslt [mysqlsel $mysql_handler $sel_clause -flatlist]
  return $rslt
}

<strong><a name="::::DeleteCurrentRunTableEntry_2299">proc <a href="mysqlLib.tcl-annot.html#::::DeleteCurrentRunTableEntry">::::DeleteCurrentRunTableEntry</a></a></strong> {args} {
  <a name="::parse_args(27)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> DeleteCurrentRunTableEntry $args {
    current_run_id &#34;&#34;
    host &#34;&#34;
  }

  global mysql_handler
  mysqlexec $mysql_handler &#34;DELETE FROM current_run_table WHERE current_run_id = \&#34;$current_run_id\&#34;&#34;

}
<span class="comment-line"># --------------------------------------------------------------</span>
<span class="comment-line">#  Return the expected duration of an automated feature based on</span>
<span class="comment-line">#    previous automation runs</span>
<span class="comment-line"># --------------------------------------------------------------</span>
<strong><a name="::::GetExpectedDuration_2313">proc <a href="mysqlLib.tcl-annot.html#::::GetExpectedDuration">::::GetExpectedDuration</a></a></strong> {args} {
    <a name="::parse_args(28)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> GetExpectedDuration $args {
        regression_id &#34;&#34;
        feature_directory &#34;&#34;
        feature_id &#34;&#34;
        platform_id &#34;&#34;
        host &#34;&#34;
    }
    global mysql_handler
    global DebugOn
    global DebugOnHi

    set rslt [catch {
        set d1 [exec date +%Y-%m-%d]
        set d2 [exec date +%k:%M:%S]
        set d [append d $d1]
        set d [append d &#34; &#34;]
        set d [append d $d2]
        <span class="comment-line">#puts $d</span>
        
        set sel_clause2 [append sel_clause2 &#34;SELECT report_table.test_report_duration, \
            report_table.test_quick_duration, \
            report_table.test_pass_duration, \
            report_table.test_all_duration \
            FROM regression_table, report_table &#34;]
        set sel_clause2 [append sel_clause2 &#34;WHERE regression_table.platform_id = '$platform_id' &#34;]
        set sel_clause2 [append sel_clause2 &#34;AND regression_table.regression_id = report_table.regression_id &#34;]
        set sel_clause2 [append sel_clause2 &#34;AND report_table.feature_id = '$feature_id' &#34;]
        set sel_clause2 [append sel_clause2 &#34;AND report_table.run_number = '1' &#34;]
        set sel_clause2 [append sel_clause2 &#34;ORDER BY report_table.report_id DESC LIMIT 5 &#34;]
        set timeInfoList [mysqlsel $mysql_handler $sel_clause2 -list]
        <span class="comment-line">#puts &#34;test_report_duration_lst $test_report_duration_lst\r&#34;</span>
        <span class="comment-line"># find the shortest test_report_duration</span>
        set expected_duration 0
        set e_quick_duration 0
        set e_pass_duration 0
        set e_all_duration 0
        set i 0
        foreach testList $timeInfoList {
            set test_report [lindex $testList 0]
            set test_quick [lindex $testList 1]
            set test_pass [lindex $testList 2]
            set test_all [lindex $testList 3]
            set expected_duration [expr $expected_duration + $test_report]
            set e_quick_duration [expr $e_quick_duration + $test_quick]
            set e_pass_duration [expr $e_pass_duration + $test_pass]
            set e_all_duration [expr $e_all_duration + $test_all]
            incr i
        }
        if {$i&gt;0} {
            set expected_duration [expr $expected_duration / $i]
            set e_quick_duration [expr $e_quick_duration / $i]
            set e_pass_duration [expr $e_pass_duration / $i]
            set e_all_duration [expr $e_all_duration / $i]
        }
        <span class="comment-line"># ------------------------------------------------------</span>
        <span class="comment-line"># If there are less than 5 results set the time 1</span>
        <span class="comment-line">#    This is for cases of first run test cases</span>
        <span class="comment-line">#    and also allows setting real zero time</span>
        <span class="comment-line"># ------------------------------------------------------</span>
        if {[llength $timeInfoList] &lt; 5 &amp;&amp; ($expected_duration == &#34;&#34; || $expected_duration == 0} {
            set expected_duration 1
        }
        <span class="comment-line"># ------------------------------------------------------</span>
        <span class="comment-line"># S K I P   a feature by setting it to 0</span>
        <span class="comment-line">#</span>
        <span class="comment-line"># ------------------------------------------------------</span>
        <span class="comment-line">#if {($e_all_duration == &#34;&#34; ||  $e_all_duration &lt; 10 ) &amp;&amp; \</span>
        <span class="comment-line">#    ($e_pass_duration == &#34;&#34; ||  $e_pass_duration &lt; 10 ) &amp;&amp; \</span>
        <span class="comment-line">#    ($e_quick_duration == &#34;&#34; ||  $e_quick_duration &lt; 10 ) } {</span>
        <span class="comment-line">#    set expected_duration 0</span>
        <span class="comment-line">#}</span>
        if {$DebugOn} {puts &#34;$feature_directory expected_duration $expected_duration&#34;;   flush stdout; after 50;}
    } reason]
    return $expected_duration
}
<span class="comment-line"># --------------------------------------------------------------</span>
<span class="comment-line">#  Populate the array FeatureInfo($featureObj,execTime)</span>
<span class="comment-line">#      - FeatureInfo(ACL,execTime) = 1234</span>
<span class="comment-line">#      - FeatureIdInfo(1,execTime) = 1234</span>
<span class="comment-line"># --------------------------------------------------------------</span>
<strong><a name="::::GetFeatureInfo_2394">proc <a href="mysqlLib.tcl-annot.html#::::GetFeatureInfo">::::GetFeatureInfo</a></a></strong> {args} {
    <a name="::parse_args(29)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> GetFeatureInfo $args {
        regression_id &#34;&#34;
        platform_id &#34;&#34;
        regType &#34;&#34;
        regSubType &#34;&#34;
        build_minor_release &#34;&#34;
    }

    global mysql_handler
    global FeatureInfo
    global FeatureIdInfo
    global DebugOn
    global DebugOnHi
    global ForceTimeUpdate

    if {$DebugOn} {puts &#34;========\nGet ALL POSSIBLE modules to run from the database\n=========&#34;;  flush stdout; after 50;}
    set regSubTypeThis $regSubType
    if {$regSubTypeThis == &#34;ipRoute1&#34;} {
    	set regSubTypeThis &#34;routing&#34;
    }
    set allTypeModules [mysqlsel $mysql_handler &#34;SELECT feature_id, feature_directory, feature_expected_exec_time, \
        feature_type, feature_sub_type \
        FROM feature_table WHERE status = 'Active' AND feature_type = '$regType' AND feature_sub_type = '$regSubType' AND (end_release_id IS NULL OR end_release_id = '' OR end_release_id &gt;= '$build_minor_release') AND (start_release_id = '' OR start_release_id IS NULL OR start_release_id &lt;= '$build_minor_release')&#34; -list]
    if {$allTypeModules == &#34;&#34;} {
    	<a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No modules list for regType:$regType regSubType:$regSubType&#34;
    	return 0
    }
    <span class="comment-line"># -----------------------------------------------------------------</span>
    <span class="comment-line">#  Get the real execution time for this module on this hardware.</span>
    <span class="comment-line"># -----------------------------------------------------------------</span>
    set allTimeFeatures [mysqlsel $mysql_handler &#34;SELECT feature_id, mean_exec_time, last_updated_epoch \
        FROM platform_feature_table WHERE platform_id = '$platform_id'&#34; -list]

    if {$allTimeFeatures == &#34;&#34; &amp;&amp; $platform_id != &#34;&#34;} {
        <span class="comment-line"># If there are no times returned for this platform we need to enter them</span>
        if {$DebugOn} {puts &#34;========\nFOUND No Feature Mean Exec Times.  Populate this platform\n=========&#34;; flush stdout; after 50;}
        foreach fList $allTypeModules {
            set fId   [lindex $fList 0]
            set fName [lindex $fList 1]
            lappend fNames $fName
            set fTime [lindex $fList 2]
            set fType [lindex $fList 3]
            set fSType [lindex $fList 4]
            set insert_clause &#34;&#34;
    
            set newTime [<a name="::GetExpectedDuration(1)"><a href="./mysqlLib.tcl.html#::GetExpectedDuration_2313">::GetExpectedDuration</a></a> -regression_id $regression_id \
                -feature_directory $fName -feature_id $fId \
                -platform_id $platform_id]
            if {$newTime == &#34;&#34; || $newTime == &#34;NULL&#34;} {
                set newTime 0
            }
            if {$DebugOn} {puts &#34;Feature $fName exec time $newTime&#34;; flush stdout; after 50;}
            <span class="comment-line"># Insert new values because this platform has no entries in the table.</span>
            set insert_clause [append insert_clause &#34;insert into platform_feature_table (platform_id, &#34;]
            set insert_clause [append insert_clause &#34;feature_id, &#34;]
            set insert_clause [append insert_clause &#34;mean_exec_time, &#34;]
            set insert_clause [append insert_clause &#34;last_updated_epoch) &#34;]
            
            set insert_clause [append insert_clause &#34;values (\&#34;$platform_id\&#34;, &#34;]
            set insert_clause [append insert_clause &#34;\&#34;$fId\&#34;, &#34;]
            set insert_clause [append insert_clause &#34;\&#34;$newTime\&#34;, &#34;]
            set insert_clause [append insert_clause &#34;\&#34;[clock seconds]\&#34;)&#34;]
            if {$DebugOn} {puts &#34;Insert $insert_clause&#34;; flush stdout; after 50;}
    
            mysqlexec  $mysql_handler $insert_clause

            set FeatureInfo($fName,execTime) $newTime
            set FeatureIdInfo($fId,execTime) $newTime
        }
    } elseif {$ForceTimeUpdate} {
        <span class="comment-line"># ---------------------------------------------------------------</span>
        <span class="comment-line">#  A list of ALL features</span>
        <span class="comment-line"># ---------------------------------------------------------------</span>
        if {$DebugOn} {puts &#34;========\nIn Force update\n=========&#34;; flush stdout; after 50;}
        foreach fList $allTypeModules {
            set insert_clause &#34;&#34;
            set update_clause &#34;&#34;
            set fId   [lindex $fList 0]
            set fName [lindex $fList 1]
            lappend fNames $fName
            set fTime [lindex $fList 2]
            set fType [lindex $fList 3]
            set fSType [lindex $fList 4]
            <span class="comment-line"># -----------------------------------------------------------</span>
            <span class="comment-line"># A list of features for this platform id from the time table</span>
            <span class="comment-line"># -----------------------------------------------------------</span>
            set hitFeature 0
            foreach ftList $allTimeFeatures {
                set insert_clause &#34;&#34;
                set update_clause &#34;&#34;
                set f_Id   [lindex $ftList 0]
                set met [lindex $ftList 1]
                set lue [lindex $ftList 2]

                <span class="comment-line"># -------------------------------------------------------</span>
                <span class="comment-line"># There is a time entry for this feature on this platform</span>
                <span class="comment-line">#   update the entry.</span>
                <span class="comment-line"># -------------------------------------------------------</span>
                if {$f_Id == $fId} {
                    set newTime [<a name="::GetExpectedDuration(2)"><a href="./mysqlLib.tcl.html#::GetExpectedDuration_2313">::GetExpectedDuration</a></a> -regression_id $regression_id \
                    -feature_directory $fName -feature_id $f_Id \
                    -platform_id $platform_id]
                    if {$newTime == &#34;&#34; || $newTime == &#34;NULL&#34;} {
                        set newTime 0
                    }

                    set update_clause &#34;UPDATE  platform_feature_table SET mean_exec_time='$newTime', \
                    last_updated_epoch='[clock seconds]' \
                    WHERE feature_id = '$f_Id' AND platform_id = '$platform_id'&#34;
                    if {$DebugOn} {puts &#34;Update Clause: $update_clause \n&#34;; flush stdout; after 50;}
                    mysqlexec  $mysql_handler $update_clause

                    set FeatureInfo($fName,execTime) $newTime
                    set FeatureIdInfo($fId,execTime) $newTime
                    set FeatureInfo($fName,last_updated_execTime) [clock seconds]
                    set FeatureIdInfo($fId,last_updated_execTime) [clock seconds]

                    set hitFeature 1
                }
            }
            if {!$hitFeature} {
                <span class="comment-line"># --------------------------------------------------------------</span>
                <span class="comment-line"># There is not entry for this in the platform_feature_table.</span>
                <span class="comment-line">#   insert it.</span>
                <span class="comment-line"># --------------------------------------------------------------</span>
                if {$DebugOn} {puts &#34;D I D   N O T   H I T   F E A T U R E&#34;;  flush stdout; after 50;}
                set newTime [<a name="::GetExpectedDuration(3)"><a href="./mysqlLib.tcl.html#::GetExpectedDuration_2313">::GetExpectedDuration</a></a> -regression_id $regression_id \
                -feature_directory $fName -feature_id $fId \
                -platform_id $platform_id]
                if {$newTime == &#34;&#34; || $newTime == &#34;NULL&#34;} {
                    set newTime 0
                }
                <span class="comment-line"># Insert new values because this platform has no entries in the table.</span>
                set insert_clause [append insert_clause &#34;insert into platform_feature_table (platform_id, &#34;]
                set insert_clause [append insert_clause &#34;feature_id, &#34;]
                set insert_clause [append insert_clause &#34;mean_exec_time, &#34;]
                set insert_clause [append insert_clause &#34;last_updated_epoch) &#34;]
                
                set insert_clause [append insert_clause &#34;values (\&#34;$platform_id\&#34;, &#34;]
                set insert_clause [append insert_clause &#34;\&#34;$fId\&#34;, &#34;]
                set insert_clause [append insert_clause &#34;\&#34;$newTime\&#34;, &#34;]
                set insert_clause [append insert_clause &#34;\&#34;[clock seconds]\&#34;)&#34;]
                if {$DebugOn} {puts &#34;Insert Clause: $insert_clause \n&#34;; flush stdout; after 50;}

                mysqlexec  $mysql_handler $insert_clause
    
                set FeatureInfo($fName,execTime) $newTime
                set FeatureIdInfo($fId,execTime) $newTime
                set FeatureInfo($fName,last_updated_execTime) [clock seconds]
                set FeatureIdInfo($fId,last_updated_execTime) [clock seconds]
            }
        }
    } else {
        if {$DebugOn} {puts &#34;FORCE is not enabled and time query is not empty\nVerify existing and get new if necessary&#34;; flush stdout; after 50;}
        foreach ftList $allTimeFeatures {
            set f_Id   [lindex $ftList 0]
            set met [lindex $ftList 1]
            set lue [lindex $ftList 2]
            set FeatureIdInfo($f_Id,execTime) $met
            set FeatureIdInfo($f_Id,last_updated_execTime) $lue
        }
        foreach fList $allTypeModules {
            set insert_clause &#34;&#34;
            set update_clause &#34;&#34;
            set fId   [lindex $fList 0]
            set fName [lindex $fList 1]
            set fTime [lindex $fList 2]
            set fType [lindex $fList 3]
            set fSType [lindex $fList 4]
            if {![info exists FeatureIdInfo($fId,execTime)]} {
                if {$DebugOn} {puts &#34;Feature $fName does not exist.  Insert it&#34;; flush stdout; after 50;}
                <span class="comment-line"># -------------------------------------------------------------------</span>
                <span class="comment-line"># Check to see if been set for this feature above.  If no there is</span>
                <span class="comment-line">#   no entry in the platform_feature_table.  Create it.</span>
                <span class="comment-line"># -------------------------------------------------------------------</span>
                set newTime [<a name="::GetExpectedDuration(4)"><a href="./mysqlLib.tcl.html#::GetExpectedDuration_2313">::GetExpectedDuration</a></a> -regression_id $regression_id \
                    -feature_directory $fName -feature_id $fId \
                    -platform_id $platform_id]
                if {$newTime == &#34;&#34; || $newTime == &#34;NULL&#34;} {
                    set newTime 0
                }
                <span class="comment-line"># Insert new values because this platform has no entries in the table.</span>
                set insert_clause [append insert_clause &#34;insert into platform_feature_table (platform_id, &#34;]
                set insert_clause [append insert_clause &#34;feature_id, &#34;]
                set insert_clause [append insert_clause &#34;mean_exec_time, &#34;]
                set insert_clause [append insert_clause &#34;last_updated_epoch) &#34;]
                
                set insert_clause [append insert_clause &#34;values (\&#34;$platform_id\&#34;, &#34;]
                set insert_clause [append insert_clause &#34;\&#34;$fId\&#34;, &#34;]
                set insert_clause [append insert_clause &#34;\&#34;$newTime\&#34;, &#34;]
                set insert_clause [append insert_clause &#34;\&#34;[clock seconds]\&#34;)&#34;]
                <span class="comment-line">#puts &#34;$insert_clause\r&#34;</span>
                if {$DebugOn} {puts &#34;Insert clause: $insert_clause&#34;; flush stdout; after 50;}
        
                mysqlexec  $mysql_handler $insert_clause
        
                set fMet $newTime
                set fLue [clock seconds]
                set FeatureInfo($fName,execTime) $fMet
                set FeatureInfo($fName,last_updated_execTime) $fLue
                set FeatureIdInfo($fId,execTime) $fMet
                set FeatureIdInfo($fId,last_updated_execTime) $fLue

            } elseif {[info exists FeatureIdInfo($fId,last_updated_execTime)] &amp;&amp; \
                   [expr $FeatureIdInfo($fId,last_updated_execTime) - [clock seconds]] &gt; 5200000} {
                if {$DebugOn} {puts &#34;Time is greater than 2 months update&#34;; flush stdout; after 50;}
                <span class="comment-line"># -------------------------------------------------------------------</span>
                <span class="comment-line"># If the last updated time has be set for this feature above</span>
                <span class="comment-line">#  check to see if the time is older than 2 months.  If so</span>
                <span class="comment-line">#  update</span>
                <span class="comment-line"># -------------------------------------------------------------------</span>
                set newTime [<a name="::GetExpectedDuration(5)"><a href="./mysqlLib.tcl.html#::GetExpectedDuration_2313">::GetExpectedDuration</a></a> -regression_id $regression_id \
                    -feature_directory $fName -feature_id $fId \
                    -platform_id $platform_id]
                if {$newTime == &#34;&#34; || $newTime == &#34;NULL&#34;} {
                    set newTime 0
                }
                set update_clause &#34;UPDATE  platform_feature_table SET mean_exec_time='$newTime', \
                last_updated_epoch='[clock seconds]' \
                WHERE feature_id = '$fId' AND platform_id = '$platform_id'&#34;
        
                if {$DebugOn} {puts &#34;Update clause: $update_clause&#34;; flush stdout; after 50;}
                mysqlexec  $mysql_handler $update_clause
        
                set fMet $newTime
                set fLue [clock seconds]
                set FeatureInfo($fName,execTime) $fMet
                set FeatureInfo($fName,last_updated_execTime) $fLue
                set FeatureIdInfo($fId,execTime) $fMet
                set FeatureIdInfo($fId,last_updated_execTime) $fLue
            } elseif {[info exists FeatureIdInfo($fId,last_updated_execTime)] &amp;&amp; \
                      [info exists FeatureIdInfo($fId,execTime)]} {
                set fMet $FeatureIdInfo($fId,execTime)
                set fLue $FeatureIdInfo($fId,last_updated_execTime)
                set FeatureInfo($fName,execTime) $fMet
                set FeatureInfo($fName,last_updated_execTime) $fLue
                if {$DebugOn} {puts &#34;--- Feature $fName (platform_id $platform_id , feature_id $fId ): Found execTim $fMet\n Lue: $fLue&#34;; flush stdout; after 50;}
            } else {
                puts &#34;Time variables are missing so I had to quit.&#34;
                return 0;
            }
        }
    }
    set q 0
    foreach fList $allTypeModules {
        set insert_clause &#34;&#34;
        set update_clause &#34;&#34;
        set fId   [lindex $fList 0]
        set fName [lindex $fList 1]
        lappend fNames $fName
        set fTime [lindex $fList 2]
        set fType [lindex $fList 3]
        set fSType [lindex $fList 4]
        if {![info exists FeatureIdInfo($fId,execTime)] || ![info exists FeatureIdInfo($fId,last_updated_execTime)]} {
            if {$DebugOn} {puts &#34;Feature $fName does not have variables set&#34;; flush stdout; after 50;}
            return 0;
        } else {
            if {$DebugOn} {puts &#34;Feature $fName times are set&#34;; flush stdout; after 50;}
            set met $FeatureIdInfo($fId,execTime)
            set lue $FeatureIdInfo($fId,last_updated_execTime)
        }
        
        <span class="comment-line"># -----------------------------------------------------------</span>
        <span class="comment-line"># Update or insert if the time is not there</span>
        <span class="comment-line"># -----------------------------------------------------------</span>
        if {$DebugOn} {puts &#34;========\nfId $fId plat_id $platform_id\nfName $fName\nfTime $met\nfType $fType\nfSType $fSType\n=========&#34;; flush stdout; after 50;}

        set FeatureInfo($fName,feature_id) $fId
        set FeatureIdInfo($fId,feature_directory) $fName
        set FeatureIdInfo($fId,feature_name) $fName
        set FeatureInfo($fName,feature_type) $fType
        set FeatureIdInfo($fId,feature_type) $fType
        set FeatureInfo($fName,feature_sub_type) $fSType
        set FeatureIdInfo($fId,feature_sub_type) $fSType
        incr q;
    }
    <span class="comment-line"># -----------------------------------------------------------</span>
    <span class="comment-line"># Update or insert if the time is not there</span>
    <span class="comment-line"># -----------------------------------------------------------</span>
    set fNames &#34;&#34;
    set finalTimeFeatureIDs [mysqlsel $mysql_handler &#34;SELECT feature_id \
        FROM platform_feature_table WHERE platform_id = '$platform_id' ORDER BY mean_exec_time DESC&#34; -flatlist]
    if {$DebugOnHi||$DebugOn} {puts &#34;========\n========\n========\nF I N I S H   G E T   F E A T U R E S\n========\n========\n=========&#34;; flush stdout; after 50;}
    return $finalTimeFeatureIDs
}

<span class="comment-line"># --------------------------------------------------------------</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># --------------------------------------------------------------</span>
<strong><a name="::::CreateCurrentRunTableEntry_2685">proc <a href="mysqlLib.tcl-annot.html#::::CreateCurrentRunTableEntry">::::CreateCurrentRunTableEntry</a></a></strong> {args} {
  <a name="::parse_args(30)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CreateCurrentRunTableEntry $args {
    regression_id &#34;&#34;
    feature_directory &#34;&#34;
    host &#34;&#34;
  }

  global mysql_handler
  <span class="comment-line">#if {[conn_to_autoweb_db $host] !=0 } {</span>
    <span class="comment-line">#return -1</span>
  <span class="comment-line">#} else {</span>
    <span class="comment-line">#mysqluse $mysql_handler autoweb_db_2</span>
  <span class="comment-line">#}</span>

  set rslt [catch {

  set d1 [exec date +%Y-%m-%d]
  set d2 [exec date +%k:%M:%S]
  set d [append d $d1]
  set d [append d &#34; &#34;]
  set d [append d $d2]
  <span class="comment-line">#puts $d</span>

  set feature_id [<a name="::getFeatureIdByDirectory(1)"><a href="./mysqlLib.tcl.html#::getFeatureIdByDirectory_1871">::getFeatureIdByDirectory</a></a> $feature_directory ]

  <span class="comment-line"># find the platform</span>
  set sel_clause &#34;SELECT platform_id from regression_table WHERE regression_id ='$regression_id'&#34; 
  set platform_id_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
  <span class="comment-line"># only single result</span>
  set platform_id [lindex $platform_id_lst 0]

  <span class="comment-line"># delete all the old entries for that platform</span>
  mysqlexec $mysql_handler &#34;DELETE FROM current_run_table WHERE platform_id = \&#34;$platform_id\&#34;&#34;
  
  <span class="comment-line">#get expected_duration</span>
  set sel_clause2 [append sel_clause2 &#34;SELECT report_table.test_report_duration FROM regression_table, report_table &#34;]
  set sel_clause2 [append sel_clause2 &#34;WHERE regression_table.platform_id = '$platform_id' &#34;]
  set sel_clause2 [append sel_clause2 &#34;AND regression_table.regression_id = report_table.regression_id &#34;]
  set sel_clause2 [append sel_clause2 &#34;AND report_table.feature_id = '$feature_id' &#34;]
  set sel_clause2 [append sel_clause2 &#34;AND report_table.run_number = '1' &#34;]
  set sel_clause2 [append sel_clause2 &#34;ORDER BY report_table.report_id DESC LIMIT 5 &#34;]
  puts &#34;sel_clause2 $sel_clause2\r&#34;
  set test_report_duration_lst [mysqlsel $mysql_handler $sel_clause2 -flatlist]
  puts &#34;test_report_duration_lst $test_report_duration_lst\r&#34;
  <span class="comment-line"># find the shortest test_report_duration</span>
  set expected_duration 0
  set i 0
  foreach test_report_duration $test_report_duration_lst {
    if {$i == 0} {
      set expected_duration $test_report_duration
    }
    if {$test_report_duration &lt; $expected_duration} {
      set expected_duration $test_report_duration
    }
    incr i
  }
  puts &#34;expected_duration $expected_duration\r&#34;

  set insert_clause [append insert_clause &#34;insert into current_run_table (regression_id, &#34;]
  set insert_clause [append insert_clause &#34;platform_id, &#34;]
  set insert_clause [append insert_clause &#34;feature_id, &#34;]
  set insert_clause [append insert_clause &#34;expected_duration, &#34;]
  set insert_clause [append insert_clause &#34;feature_start_time) &#34;]

  set insert_clause [append insert_clause &#34;values (\&#34;$regression_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$platform_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$feature_id\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$expected_duration\&#34;, &#34;]
  set insert_clause [append insert_clause &#34;\&#34;$d\&#34;)&#34;]
  puts &#34;insert_clause $insert_clause\r&#34;

  mysqlexec  $mysql_handler $insert_clause
  <span class="comment-line">#mysqlclose $mysql_handler</span>
  
  <span class="comment-line"># get the new current_run_id</span>
  set current_run_id [mysqlinsertid  $mysql_handler]
  puts &#34;current_run_id $current_run_id\r&#34;
  } reason]
  if {$rslt} {
    <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CreateCurrentRunTableEntry failed - reason: $reason&#34;
    puts &#34;CreateCurrentRunTableEntry failed - reason: $reason&#34; 
    return &#34;error&#34;
  } else {
    return $current_run_id
  }
  
}

<strong><a name="::::CheckAndPauseRegression_2773">proc <a href="mysqlLib.tcl-annot.html#::::CheckAndPauseRegression">::::CheckAndPauseRegression</a></a></strong> {args} {
    <a name="::parse_args(31)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckAndPauseRegression $args {
        regression_id     &#34;&#34;
        feature_directory &#34;&#34;
        admin_email       &#34;&#34;
        host              &#34;&#34;
        db                &#34;null&#34;
        pauseType         &#34;user&#34;
        regCfg            &#34;&#34;
    }
    global mysql_handler MAIN
    if {$db != &#34;null&#34;} {
        set conn [<a name="::conn_to_db(2)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db]
    }
    
    <span class="comment-line"># get feature_id</span>
    set feature_id [<a name="::getFeatureIdByDirectory(2)"><a href="./mysqlLib.tcl.html#::getFeatureIdByDirectory_1871">::getFeatureIdByDirectory</a></a> $feature_directory ]
    <span class="comment-line">#puts &#34;feature_id $feature_id&#34;</span>
    
    <span class="comment-line"># get reserved field</span>
    set sel_clause &#34;SELECT current_run_id, reserved, aa_id FROM current_run_table \
                  WHERE regression_id ='$regression_id' AND feature_id ='$feature_id'&#34;
    <span class="comment-line">#puts &#34;sel_clause $sel_clause&#34;</span>
    set rslt_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
    <span class="comment-line">#puts &#34;rslt_lst $rslt_lst&#34;</span>
    <span class="comment-line"># only single result</span>
    set current_run_id [lindex $rslt_lst 0]
    <span class="comment-line">#puts &#34;current_run_id $current_run_id&#34;</span>
    set reserved [lindex $rslt_lst 1]
    <span class="comment-line">#puts &#34;reserved $reserved&#34;</span>
    set aa_id [lindex $rslt_lst 2]
    <span class="comment-line">#puts &#34;aa_id $aa_id&#34;</span>
    <span class="comment-line"># get aa data</span>
    set sel_clause2 &#34;SELECT aa_first_name, aa_last_name, aa_email FROM aa_table \
                  WHERE aa_id ='$aa_id'&#34;
    <span class="comment-line">#puts &#34;sel_clause2 $sel_clause2&#34;</span>
    set rslt_lst2 [mysqlsel $mysql_handler $sel_clause2 -flatlist]
    set aa_first_name [lindex $rslt_lst2 0]
    <span class="comment-line">#puts &#34;aa_first_name $aa_first_name&#34;</span>
    set aa_last_name [lindex $rslt_lst2 1]
    <span class="comment-line">#puts &#34;aa_last_name $aa_last_name&#34;</span>
    set aa_email [lindex $rslt_lst2 2]
    <span class="comment-line">#puts &#34;aa_email $aa_email&#34;</span>

    if {$pauseType == &#34;user&#34;} {
        set msg &#34;Regression: $regression_id, feature: \
            $feature_directory was paused at your request.\n\
            Please resume the regression when you are done.\nAlso \
            please leave the DUTs in the secondary partition and \
            with the original regression builds.&#34;
        set sbj &#34;$regCfg Regression paused&#34;
        set msg3 &#34;Regression: $regression_id was resumed at your request.&#34;
        set sbj3 &#34;$regCfg Regression resumed&#34;
        
        set msg2 &#34;Regression: $regression_id, feature: \
            $feature_directory was paused by $aa_first_name $aa_last_name ($aa_email)&#34;
        set sbj2 &#34;$regCfg Regression paused&#34;
        set msg4 &#34;Regression: $regression_id was resumed by $aa_first_name $aa_last_name ($aa_email)&#34;
        set sbj4 &#34;$regCfg Regression resumed&#34;        
    } else {
        set msg &#34;Regression: $regression_id, feature: \
            $feature_directory has been PAUSED due to FATAL errors.\n\
            Please resume the regression after troubleshooting the system.\nAlso \
            please leave the DUTs in the secondary partition and \
            with the original regression builds.&#34;
        set sbj &#34;$regCfg Regression PAUSED due to FATAL ERRORS&#34;
        set msg3 &#34;Regression: $regression_id has been resumed.&#34;
        set sbj3 &#34;$regCfg Regression resumed after troubleshooting&#34;
        
        set msg2 &#34;Regression: $regression_id, feature: \
            $feature_directory has been PAUSED due to FATAL errors&#34;
        set sbj2 &#34;$regCfg Regression PAUSED by mysqlRunAllMonitor&#34;
        set msg4 &#34;Regression: $regression_id was resumed after troubleshooting&#34;
        set sbj4 &#34;$regCfg Regression resumed&#34;
        <span class="comment-line"># -----------------------------------------------------------</span>
        <span class="comment-line">#  If this proc is called by other than default 'user' value</span>
        <span class="comment-line">#   currently assume it was called from fatal error lock</span>
        <span class="comment-line"># -----------------------------------------------------------</span>
         
        set update_clause &#34;UPDATE  current_run_table SET reserved='paused', aa_id='33' WHERE \
                     current_run_id = '$current_run_id'&#34;
        puts &#34;Grant the mysql_handler is $mysql_handler&#34;
        mysqlexec $mysql_handler $update_clause
        sendMailNotification $admin_email $sbj2 $msg2
        set reserved &#34;locked&#34;;
    }
    set was_paused false
    while {($reserved == &#34;yes&#34;) || ($reserved == &#34;paused&#34;) || ($reserved == &#34;locked&#34;)} {
        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#  Regression table is set to reserved or locked.</span>
        <span class="comment-line">#     - set the record in the db to paused</span>
        <span class="comment-line">#     - loop and continue to check reserved state until</span>
        <span class="comment-line">#          pause is removed.</span>
        <span class="comment-line"># --------------------------------------------------------</span>
        if {$reserved == &#34;yes&#34;} {
            set was_paused true
            puts $msg2
            set update_clause &#34;UPDATE  current_run_table SET reserved='paused' WHERE \
                         current_run_id = '$current_run_id'&#34;
            mysqlexec $mysql_handler $update_clause
            sendMailNotification $aa_email $sbj $msg
            sendMailNotification $admin_email $sbj2 $msg2
        }
        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#  Wait 60 secs before checking state again.</span>
        <span class="comment-line"># --------------------------------------------------------</span>
        sleep 60
        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#  Check the reserved state again</span>
        <span class="comment-line"># --------------------------------------------------------</span>
        set rslt_lst [mysqlsel $mysql_handler $sel_clause -flatlist]
        set reserved [lindex $rslt_lst 1]
    }
    <span class="comment-line"># ------------------------------------------------------------</span>
    <span class="comment-line">#  Send an email if the regression was paused and has been</span>
    <span class="comment-line">#     freed</span>
    <span class="comment-line"># ------------------------------------------------------------</span>
    if {$was_paused} {
        if {$pauseType == &#34;user&#34;} {
            <span class="comment-line"># ------------------------------------------</span>
            <span class="comment-line"># Email test bed was previously paused via the</span>
            <span class="comment-line">#     web interface pause mechanism</span>
            <span class="comment-line"># ------------------------------------------</span>
            sendMailNotification $aa_email $sbj3 $msg3
            sendMailNotification $admin_email $sbj4 $msg4
        } else {
            <span class="comment-line"># ------------------------------------------</span>
            <span class="comment-line"># Email test bed was previously locked due</span>
            <span class="comment-line">#     to fatal errors</span>
            <span class="comment-line"># ------------------------------------------</span>
            sendMailNotification $admin_email $sbj4 $msg4
        }
    }
    set MAIN(was_paused) $was_paused
    if {$db != &#34;null&#34;} {
        <a name="::disconnect_db(1)"><a href="./mysqlLib.tcl.html#::disconnect_db_61">::disconnect_db</a></a> mysql_handler
    }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Go through the 4 phases and return the next modu</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetModulePhased_2918">proc <a href="mysqlLib.tcl-annot.html#::::GetModulePhased">::::GetModulePhased</a></a></strong> {args} {
    <a name="::parse_args(32)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> GetModulePhased $args {
        build_id &#34;&#34;
        regression_id &#34;&#34;
        my_platform_id &#34;&#34;
        regType &#34;&#34;
        regSubType &#34;&#34;
        incrBuilds &#34;&#34;
        build_minor_release &#34;&#34;
    }

    global mysql_handler
    global FeatureInfo
    global FeatureIdInfo
    global PlatformInfo
    global RegressionInfo
    global DebugOn
    global DebugOnHi
    global ForceTimeUpdate
    global exclude
    global UniquePIDList 
    global stopWithPhase

    <span class="comment-line"># ------------------------------------------------------------</span>
    <span class="comment-line">#  Set up local variables</span>
    <span class="comment-line"># ------------------------------------------------------------</span>
    set BCMChassis &#34;ASPEN&#34;
    set SummitStack &#34;OldStack NewStack&#34;
    set SummitStackables  &#34;OldStackables NewStackables&#34;
    set Genesis   &#34;Genesis&#34;
    set Pioneer   &#34;Voyager&#34;

    set myFeaturesIDs [<a name="::GetFeatureInfo(1)"><a href="./mysqlLib.tcl.html#::GetFeatureInfo_2394">::GetFeatureInfo</a></a> -regression_id &#34;$regression_id&#34; -regType $regType \
                    -regSubType $regSubType -platform_id $my_platform_id -build_minor_release $build_minor_release]
    <span class="comment-line"># ------------------------------------------------------------</span>
    <span class="comment-line">#  P L A T F O R M    T A B L E</span>
    <span class="comment-line">#  Get all platform info</span>
    <span class="comment-line">#      - PlatformInfo($pId,platform_name)</span>
    <span class="comment-line">#      - PlatformInfo($pId,number_nodes)</span>
    <span class="comment-line"># ------------------------------------------------------------</span>
    set sel_clause &#34;SELECT platform_id, platform_name, number_nodes FROM platform_table \
                  WHERE platform_id &gt;'0'&#34;
    set rslt_lst [mysqlsel $mysql_handler $sel_clause -list]

    if {[llength $rslt_lst] == 0} {
        puts &#34;Failed to get platform information&#34;
        return 0;
    }

    foreach pInfoList $rslt_lst {
        set pId   [lindex $pInfoList 0]
        set platform_name [lindex $pInfoList 1]
        set number_nodes  [lindex $pInfoList 2]
        set PlatformInfo($pId,platform_name) $platform_name
        set PlatformInfo($pId,number_nodes) $number_nodes
        set PlatformInfo($pId,regplatname) &#34;&#34;
    }
    <span class="comment-line"># ------------------------------------------------------------</span>
    <span class="comment-line"># Get runReg table info</span>
    <span class="comment-line"># ------------------------------------------------------------</span>
    if {[regexp -nocase &#34;rout&#34; $regSubType]} {
        set rr_subType &#34; AND regplatform_subtype = 'ipRoute1'&#34;
    } elseif {[regexp -nocase &#34;stand&#34; $regSubType]} {
        set rr_subType &#34; AND regplatform_subtype = 'standard'&#34;
    } else {
        set rr_subType &#34;&#34;
    }
    set sel_clause &#34;SELECT regplatform_name, regplatform_index, platform_id FROM runreg_table \
                  WHERE regplatform_regtype = '$regType' $rr_subType &#34;
    set rslt_lstx [mysqlsel $mysql_handler $sel_clause -list]

    if {[llength $rslt_lstx] == 0} {
        puts &#34;Failed to get runReg information&#34;
    } else {
        foreach pInfo2List $rslt_lstx {
            set pId   [lindex $pInfo2List 2]
            set regplatname [lindex $pInfo2List 0]
            set regplatindex  [lindex $pInfo2List 1]
            set PlatformInfo($pId,regplatname) $regplatname
            set PlatformInfo($pId,regplatindex) $regplatindex
        }
    }

    if {[info exists PlatformInfo($my_platform_id,platform_name)]} {
        set my_platform_name $PlatformInfo($my_platform_id,platform_name)
        set my_platform_numnodes $PlatformInfo($my_platform_id,number_nodes)
        set my_regplat_name $PlatformInfo($my_platform_id,regplatname)
        puts &#34;\n----\nMy plat ID: $my_platform_id\nMy Platform Name: $my_platform_name\nMy Platform NumNodes: my_platform_numnodes\n----&#34;        
    } else {
        puts &#34;Failed to get platform information&#34;
        return 0;
    }
    puts &#34;Grant my_platform_name : $my_platform_name&#34;
    if [regexp -nocase &#34;$my_platform_name&#34; $BCMChassis] {
        set my_chipset_platforms $BCMChassis
        if {$DebugOn} {puts &#34;========\nmy_chipset_platforms $BCMChassis\n=========&#34;;   flush stdout; after 50;}
    } elseif [regexp -nocase &#34;$my_platform_name&#34; $SummitStack] {
        set my_chipset_platforms $SummitStack
        if {$DebugOn} {puts &#34;========\nmy_chipset_platforms $SummitStack\n=========&#34;;  flush stdout; after 50;}
    } elseif [regexp -nocase &#34;$my_platform_name&#34; $SummitStackables] {
        set my_chipset_platforms $SummitStackables
        if {$DebugOn} {puts &#34;========\nmy_chipset_platforms $SummitStackables\n=========&#34;;  flush stdout; after 50;}
    } elseif [regexp -nocase &#34;$my_platform_name&#34; $Genesis] {
        set my_chipset_platforms $Genesis
        if {$DebugOn} {puts &#34;========\nmy_chipset_platforms $Genesis\n=========&#34;;  flush stdout; after 50;}
    } elseif [regexp -nocase &#34;$my_platform_name&#34; $Pioneer] {
        set my_chipset_platforms $Pioneer
        if {$DebugOn} {puts &#34;========\nmy_chipset_platforms $Pioneer\n=========&#34;;  flush stdout; after 50;}
   
    }  else {
        puts &#34;Failed-- no platform to chipset match&#34;
        return 0;
    }
    puts &#34;S L E E P   2 secs  W H I L E   B I G    Q U E R Y   E N D S&#34;
    sleep 2
    <span class="comment-line"># ------------------------------------------------------------</span>
    <span class="comment-line">#  R E G R E S S I O N     T A B L E</span>
    <span class="comment-line">#  Get all regression ids for this build_id</span>
    <span class="comment-line">#    - PlatformInfo($pId,regression_id)  </span>
    <span class="comment-line">#    - regression_id_list (all regids for this build)</span>
    <span class="comment-line">#</span>
    <span class="comment-line">#  For incremental regression runs, we would like to take</span>
    <span class="comment-line">#   regression id's for previous builds into account.</span>
    <span class="comment-line"># ------------------------------------------------------------</span>
    if {$incrBuilds != &#34;NULL&#34;} {
        <span class="comment-line"># At the bottom we will creating a modified query that</span>
        <span class="comment-line">#    takes all build_ids into account when getting</span>
        <span class="comment-line">#    regression_ids that have run previously</span>
        <span class="comment-line">#</span>
        set incrBuild_Id_List &#34;&#34;
        set incrBuild_Id_QString &#34;&#34;
        <span class="comment-line"># Get the build ids for the incremental builds</span>
        set build_list [split $incrBuilds &#34;_&#34;]

        foreach incrBuild $build_list {
            puts &#34;Get incremental Build ID&#34;
            
            if ![regexp {([0-9]+)\.([0-9]+)\.([0-9]+)[\.b]([0-9]+.*)} \
                $incrBuild  match \
                major minor patch build] {
                    error \
                    &#34;incremental $incrBuild not in good format.&#34;
                    return &#34;error&#34;
            }
            puts &#34;===================================================&#34;
            puts &#34;major: $major&#34;
            puts &#34;minor: $minor&#34;
            puts &#34;patch: $patch&#34;
            puts &#34;build: $build&#34;
            set build_major_release &#34;$major.$minor&#34;
            puts &#34;build_major_release: $build_major_release&#34;
            set build_minor_release &#34;$major.$minor.$patch&#34;
            puts &#34;build_minor_release: $build_minor_release&#34;
            set build_number &#34;$build&#34;
            puts &#34;build_number: $build_number&#34;
            set sel_clause &#34;SELECT build_id FROM build_table WHERE \
            build_major_release = '$build_major_release' AND \
            build_minor_release = '$build_minor_release' AND \
            build_number = '$build_number'&#34;
            set incr_build_id [mysqlsel $mysql_handler $sel_clause -flatlist]
            puts &#34;llength of build_id_list: [llength $build_id]&#34;
            if {([llength $incr_build_id] != 0)} {
                puts &#34;we found incr_build_id: $incr_build_id&#34;
                lappend incrBuild_Id_List &#34;build_id = '$incr_build_id'&#34;
            } else {
                puts &#34;we did not found incremental build_id - enter it into the build table&#34;
            }
        }
        set incrBuild_Id_QString [join $incrBuild_Id_List &#34; OR &#34;]
        puts &#34;SELECT regression_id, platform_id FROM regression_table \
              WHERE build_id ='$build_id' OR $incrBuild_Id_QString &#34;

        set sel_clause &#34;SELECT regression_id, platform_id FROM regression_table \
              WHERE build_id ='$build_id' OR $incrBuild_Id_QString &#34;
    } else {
        puts &#34;SELECT regression_id, platform_id FROM regression_table \
              WHERE build_id ='$build_id' &#34;
        set sel_clause &#34;SELECT regression_id, platform_id FROM regression_table \
              WHERE build_id ='$build_id' &#34;
    }

    set rslt_lst [mysqlsel $mysql_handler $sel_clause -list]    
    set q 0;
    if {[llength $rslt_lst] == 0} {
        puts &#34;Failed to get regression information&#34;
        return 0;
    }
    foreach regInfoList $rslt_lst {
        set regId   [lindex $regInfoList 0]
        set pId     [lindex $regInfoList 1]
        set RegressionInfo($regId,platform_id) $pId
        set PlatformInfo($pId,regression_id) $regId
        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#  Skip regs with platform IDs in certain skip list</span>
        <span class="comment-line"># --------------------------------------------------------</span>
        if {[lsearch -exact $UniquePIDList(golden) $my_platform_id] &gt;= 0} {
            if {$DebugOn} {puts &#34;!!!!!\n!!!!!\nI AM RUNNING ON A GOLDEN ONLY COMPARE TO GOLDEN $UniquePIDList(golden)\n!!!!!\n!!!!!&#34;;  flush stdout; after 50;}
            if {[lsearch -exact $UniquePIDList(golden) $pId]} {
                if {$DebugOn||$DebugOnHi} {puts &#34;REGRESSION RESULTS SKIPPED:  NOT GOLDEN&#34;;  flush stdout; after 50;}
                continue;
            }            
        } elseif {[lsearch -exact $UniquePIDList(panther) $my_platform_id] &gt;= 0} {
            if {$DebugOn} {puts &#34;!!!!!\n!!!!!\nI AM RUNNING ON A PANTHER ONLY COMPARE TO PANTHER\n!!!!!\n!!!!!&#34;;  flush stdout; after 50;}
            if {[lsearch -exact $UniquePIDList(panther) $pId]} {
                if {$DebugOn||$DebugOnHi} {puts &#34;REGRESSION RESULTS SKIPPED:  NOT Panther&#34;;  flush stdout; after 50;}
                continue;
            }            
        } else {
            if {[lsearch -exact $UniquePIDList(panther) $pId] &gt;= 0 || \
                [lsearch -exact $UniquePIDList(golden) $pId] &gt;= 0 } {
                if {$DebugOn||$DebugOnHi} {puts &#34;REGRESSION RESULTS SKIPPED:  \
                        DON'T COMPARE WITH\nGOLDEN RESULTS OR PANTHER RESULTS&#34;;  flush stdout; after 50;}
                continue;
            }
        }
        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#  Skip reg ids for different type/subtype pair ie rtr/std</span>
        <span class="comment-line"># --------------------------------------------------------</span>
        if {![info exists PlatformInfo($pId,number_nodes)]} {
           if {$DebugOn} {puts &#34;Platform id $pId PlatformInfo(\$pId,number_nodes) is not set... CONTINUE&#34;;  flush stdout; after 50;}
           continue; 
        } elseif {$regSubType == &#34;standard&#34; &amp;&amp; $PlatformInfo($pId,number_nodes) &gt; 2 || \
            $regSubType == &#34;standard&#34; &amp;&amp; $PlatformInfo($pId,number_nodes) &lt; 2 } {
            <span class="comment-line"># IF the feature is not of the correct type/subtype bail</span>
            if {$DebugOn} {puts &#34;Platform id $pId is not a standard CONTINUE&#34;;  flush stdout; after 50;}
            continue;
        } elseif {$regSubType == &#34;routing&#34; &amp;&amp; $PlatformInfo($pId,number_nodes) &lt; 5 } {
            if {$DebugOn} {puts &#34;Platform id $pId is not a routing CONTINUE&#34;;  flush stdout; after 50;}
            continue;            
        }
        if {$DebugOn} {puts &#34;#------- NEW Regression ID Entry for \
            platform $PlatformInfo($pId,platform_name)-----------\n\
            regId   [lindex $regInfoList 0] \n\
            pId     [lindex $regInfoList 1] \n\
            PlatformInfo($pId,regression_id) $regId \n\
            \n--------------------------------------------------------------&#34;;
            flush stdout; after 50;
        }
        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#  Get  C U R R E N T L Y    R U N N I N G   table info</span>
        <span class="comment-line">#    </span>
        <span class="comment-line"># --------------------------------------------------------</span>
        set sel_clause2 &#34;SELECT platform_id, feature_id FROM current_run_table \
                      WHERE regression_id ='$regId'&#34;
        set rslt_lst2 [mysqlsel $mysql_handler $sel_clause2 -flatlist]    
        set running_platform_id   [lindex $rslt_lst2 0]
        set running_feature_id [lindex $rslt_lst2 1]
        if {[llength $rslt_lst2] == 0} {
            puts &#34;REGRESSION ID: $regId is not currently running.&#34;;
        } else {
            if {[info exists FeatureIdInfo($running_feature_id,feature_directory)]} {
                set myFName $FeatureIdInfo($running_feature_id,feature_directory)
                if {$DebugOn} {puts &#34;$myFName \
                       is CURRENTLY RUNNING ON $PlatformInfo($running_platform_id,platform_name)&#34;;
                       flush stdout; after 50;
                }
                set FeatureInfo($myFName,CR) 1
                set FeatureIdInfo($running_feature_id,CR) 1
                set PlatformInfo($running_platform_id,CR) 1

                set fId $running_feature_id
                <span class="comment-line"># ----------------------------------------------------</span>
                <span class="comment-line"># General finished flag even though it is </span>
                <span class="comment-line"># ----------------------------------------------------</span>
                lappend Finished($myFName,finished_platform) \
                               $PlatformInfo($running_platform_id,platform_name)
                <span class="comment-line"># ----------------------------------------------------</span>
                <span class="comment-line"># Set up variables for the features that have run. </span>
                <span class="comment-line"># ----------------------------------------------------</span>
                set FeatureInfo($FeatureIdInfo($fId,feature_directory),AlreadyRunPlatform) $PlatformInfo($pId,platform_name)
                set FeatureIdInfo($fId,AlreadyRunPlatform) $PlatformInfo($running_platform_id,platform_name)
                set FeatureInfo($FeatureIdInfo($fId,feature_directory),AlreadyRunRegPlatform) $PlatformInfo($pId,regplatname)
                set FeatureIdInfo($fId,AlreadyRunRegPlatform) $PlatformInfo($running_platform_id,regplatname)
                if {[lsearch $my_chipset_platforms $FeatureIdInfo($fId,AlreadyRunPlatform)] != -1 } {
                    <span class="comment-line"># ------------------------------------------------</span>
                    <span class="comment-line"># If a finished feature/platform pair is in my chipset</span>
                    <span class="comment-line">#   list mark the feature Already Run Chip DoneWithPhase2</span>
                    <span class="comment-line"># ------------------------------------------------</span>
                    set FeatureInfo($FeatureIdInfo($fId,feature_directory),DoneWithPhase2) 1
                    set FeatureIdInfo($fId,DoneWithPhase2) 1
                    if {$DebugOn} {puts &#34;$FeatureIdInfo($fId,feature_directory) DoneWithPhase2&#34;;  flush stdout; after 50;}
                }
                if {$FeatureIdInfo($fId,AlreadyRunPlatform) == &#34;$my_platform_name&#34;} {
                    <span class="comment-line"># my_platform_name</span>
                    <span class="comment-line"># my_platform_numnodes</span>
                    <span class="comment-line"># ------------------------------------------------</span>
                    <span class="comment-line"># If a finished feature/platform pair is my platform</span>
                    <span class="comment-line">#   mark the feature Already Run Family DoneWithPhase3</span>
                    <span class="comment-line"># ------------------------------------------------</span>
                    set FeatureInfo($FeatureIdInfo($fId,feature_directory),DoneWithPhase3) 1
                    set FeatureIdInfo($fId,DoneWithPhase3) 1
                    if {$DebugOn} {puts &#34;$FeatureIdInfo($fId,feature_directory) DoneWithPhase3&#34;;  flush stdout; after 50;}
                } else {
                    <span class="comment-line">#if {$DebugOn||$DebugOnHi} {puts &#34;Missed $FeatureIdInfo($fId,AlreadyRunPlatform) == $my_platform_name&#34;;  flush stdout; after 50;}</span>
                }
                if {$FeatureIdInfo($fId,AlreadyRunRegPlatform) == &#34;$my_regplat_name&#34;} {
                    <span class="comment-line"># ------------------------------------------------</span>
                    <span class="comment-line"># If a finished feature runreg plattype VPE_FUNC_STD pair is my runreg plattype</span>
                    <span class="comment-line">#   mark the feature Already Run Family DoneWithPhase3_5</span>
                    <span class="comment-line"># ------------------------------------------------</span>
                    set FeatureInfo($FeatureIdInfo($fId,feature_directory),DoneWithPhase3_5) 1
                    set FeatureIdInfo($fId,DoneWithPhase3_5) 1
                    if {$DebugOn} {puts &#34;$FeatureIdInfo($fId,feature_directory) DoneWithPhase3_5&#34;;  flush stdout; after 50;}
                }
                if {$pId == $my_platform_id} {
                    <span class="comment-line"># ------------------------------------------------</span>
                    <span class="comment-line"># If a finished platform id is my platform id</span>
                    <span class="comment-line">#   mark the feature Already Run Me ARM</span>
                    <span class="comment-line"># ------------------------------------------------</span>
                    set FeatureInfo($FeatureIdInfo($fId,feature_directory),DoneWithPhase4) 1
                    set FeatureIdInfo($fId,DoneWithPhase4) 1
                    if {$DebugOn} {puts &#34;$FeatureIdInfo($fId,feature_directory) DoneWithPhase4&#34;;  flush stdout; after 50;}
                }
            } else {
                if {$DebugOn} {puts &#34;NO FeatureInfo MATCH FOR feature id $running_feature_id feature_name&#34;;  flush stdout; after 50;}
                continue;
            }
        }


        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#  Get  R E P O R T  table info</span>
        <span class="comment-line">#    </span>
        <span class="comment-line"># --------------------------------------------------------</span>
        set sel_clause3 &#34;SELECT report_id, feature_id FROM report_table \
                      WHERE regression_id = '$regId'&#34;
        set rslt_lst3 [mysqlsel $mysql_handler $sel_clause3 -list]    
        set r 0;
        if {$rslt_lst3 == &#34;&#34;} {
            puts &#34;There are not report table entries for regression ID $regId&#34;
        } else {
            if {$DebugOn} {puts &#34;------------------  There are [llength $rslt_lst3] feature reports for RegId $regId ---------------&#34;;  flush stdout; after 50;}
            foreach reportInfo $rslt_lst3 {
                set finished_report_id   [lindex $reportInfo 0]
                set finished_feature_id  [lindex $reportInfo 1]
                set fId $finished_feature_id
                if {[info exists FeatureIdInfo($fId,feature_directory)]} {
                    set myFName $FeatureIdInfo($fId,feature_directory)
                    <span class="comment-line"># ----------------------------------------------------</span>
                    <span class="comment-line"># General finished flag</span>
                    <span class="comment-line"># ----------------------------------------------------</span>
                    lappend Finished($myFName,finished_platform) \
                            $PlatformInfo($pId,platform_name)
                    <span class="comment-line"># ----------------------------------------------------</span>
                    <span class="comment-line"># Set up variables for the features that have run. </span>
                    <span class="comment-line"># ----------------------------------------------------</span>
                    set FeatureInfo($FeatureIdInfo($fId,feature_directory),AlreadyRunPlatform) $PlatformInfo($pId,platform_name)
                    set FeatureIdInfo($fId,AlreadyRunPlatform) $PlatformInfo($pId,platform_name)
                    set FeatureInfo($FeatureIdInfo($fId,feature_directory),AlreadyRunRegPlatform) $PlatformInfo($pId,regplatname)
                    set FeatureIdInfo($fId,AlreadyRunRegPlatform) $PlatformInfo($pId,regplatname)
                    if {[lsearch $my_chipset_platforms $FeatureIdInfo($fId,AlreadyRunPlatform)] != -1}  {
                        <span class="comment-line"># ------------------------------------------------</span>
                        <span class="comment-line"># If a finished feature/platform pair is in my chipset</span>
                        <span class="comment-line">#   list mark the feature Already Run Chip DoneWithPhase2</span>
                        <span class="comment-line"># ------------------------------------------------</span>
                        set FeatureInfo($FeatureIdInfo($fId,feature_directory),DoneWithPhase2) 1
                        set FeatureIdInfo($fId,DoneWithPhase2) 1
                        if {$DebugOn} {puts &#34;$FeatureIdInfo($fId,feature_directory) DoneWithPhase2&#34;;  flush stdout; after 50;}
                    }
                    if {$FeatureIdInfo($fId,AlreadyRunPlatform) == &#34;$my_platform_name&#34;} {
                        <span class="comment-line"># my_platform_name</span>
                        <span class="comment-line"># my_platform_numnodes</span>
                        <span class="comment-line"># ------------------------------------------------</span>
                        <span class="comment-line"># If a finished feature/platform pair is my platform</span>
                        <span class="comment-line">#   mark the feature Already Run Family DoneWithPhase3</span>
                        <span class="comment-line"># ------------------------------------------------</span>
                        set FeatureInfo($FeatureIdInfo($fId,feature_directory),DoneWithPhase3) 1
                        set FeatureIdInfo($fId,DoneWithPhase3) 1
                        if {$DebugOn} {puts &#34;$FeatureIdInfo($fId,feature_directory) DoneWithPhase3&#34;;  flush stdout; after 50;}
                    } else {
                        <span class="comment-line">#if {$DebugOn||$DebugOnHi} {puts &#34;Missed $FeatureIdInfo($fId,AlreadyRunPlatform) == $my_platform_name&#34;;  flush stdout; after 50;}</span>
                    }
                    if {$FeatureIdInfo($fId,AlreadyRunRegPlatform) == &#34;$my_regplat_name&#34;} {
                        <span class="comment-line"># ------------------------------------------------</span>
                        <span class="comment-line"># If a finished feature runreg plattype VPE_FUNC_STD pair is my runreg plattype</span>
                        <span class="comment-line">#   mark the feature Already Run Family DoneWithPhase3_5</span>
                        <span class="comment-line"># ------------------------------------------------</span>
                        set FeatureInfo($FeatureIdInfo($fId,feature_directory),DoneWithPhase3_5) 1
                        set FeatureIdInfo($fId,DoneWithPhase3_5) 1
                        if {$DebugOn} {puts &#34;$FeatureIdInfo($fId,feature_directory) DoneWithPhase3_5&#34;;  flush stdout; after 50;}
                    }
                    if {$pId == $my_platform_id} {
                        <span class="comment-line"># ------------------------------------------------</span>
                        <span class="comment-line"># If a finished platform id is my platform id</span>
                        <span class="comment-line">#   mark the feature Already Run Me ARM</span>
                        <span class="comment-line"># ------------------------------------------------</span>
                        set FeatureInfo($FeatureIdInfo($fId,feature_directory),DoneWithPhase4) 1
                        set FeatureIdInfo($fId,DoneWithPhase4) 1
                        if {$DebugOn} {puts &#34;$FeatureIdInfo($fId,feature_directory) DoneWithPhase4&#34;;  flush stdout; after 50;}
                    }
                }
                incr r
            }
        }
        incr q
    }
    if {$DebugOn||$DebugOnHi} {puts &#34;=========!!!!!!!!!!!\n========\nFINISHED GATHERING CURRENTLY RUNNING/FINISHED\n=========!!!!!!!!!!!\n=========&#34;;  flush stdout; after 50;}
    <span class="comment-line"># ------------------------------------------------------------</span>
    <span class="comment-line">#  Loop through all of my type features in order to get exact</span>
    <span class="comment-line">#    idea of which phase and what test plan to choose.</span>
    <span class="comment-line">#    </span>
    <span class="comment-line"># ------------------------------------------------------------</span>
    set DoneWithPhase2 1
    set DoneWithPhase3 1
    set DoneWithPhase3_5 1
    set DoneWithPhase4 1
    set NotDoneWithPhase1Mods &#34;&#34;
    set NotDoneWithPhase2Mods &#34;&#34;
    set NotDoneWithPhase3Mods &#34;&#34;
    set NotDoneWithPhase3_5Mods &#34;&#34;
    set NotDoneWithPhase4Mods &#34;&#34;
    set finalFeatures &#34;&#34;
    set alldone 1
    foreach chooseFeatureID $myFeaturesIDs {
        if {[info exists FeatureIdInfo($chooseFeatureID,feature_directory)]} {
            set chooseFeature $FeatureIdInfo($chooseFeatureID,feature_directory)
        } else {
            puts &#34;\nFeature Name is not set for featureId\n!!!!!!  $chooseFeatureID    !!!!!\n&#34;
            set FeatureIdInfo($chooseFeatureID,feature_directory) &#34;BAD&#34;
            <span class="comment-line">#return 0</span>
            continue;
        }
        if {$DebugOn} {
            if {[info exist Finished($chooseFeature,finished_platform)]} {
                if {[llength $Finished($chooseFeature,finished_platform)] &gt; 0} {
                    puts &#34;Finished $chooseFeature on platform/s:&#34;
                    foreach fPlat $Finished($chooseFeature,finished_platform) {
                        puts &#34;- $fPlat&#34;
                    }               
                }
            } else {
                puts &#34;NOT Finished $chooseFeature&#34;
            }
            flush stdout; after 50;
        }
        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#  Skip exclude cases</span>
        <span class="comment-line"># --------------------------------------------------------</span>
        if {[lsearch $exclude $chooseFeature]!= -1}  {
            if {$DebugOn} {puts &#34;E X C L U D E    $chooseFeature &#34;;  flush stdout; after 50;}
            continue;
        }
        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#  Skip no supp test plans removed ... just run them last</span>
        <span class="comment-line"># --------------------------------------------------------</span>
        <span class="comment-line">#if {$FeatureInfo($chooseFeature,execTime) == 0} {</span>
        <span class="comment-line">#    if {$DebugOn} {puts &#34;@!@!@!@!@!\nFeature $chooseFeature SKIPPED no previous exec time\n@!@!@!@!@!&#34;;}</span>
        <span class="comment-line">#    continue;</span>
        <span class="comment-line">#}</span>
        set hitOnce 0
        <span class="comment-line"># FeatureInfo($feature,feature_id)</span>
        <span class="comment-line"># FeatureIdInfo($fId,feature_directory)</span>
        <span class="comment-line"># FeatureInfo($feature,feature_type) </span>
        <span class="comment-line"># FeatureIdInfo($fId,feature_type) </span>
        <span class="comment-line"># FeatureInfo($feature,feature_sub_type) </span>
        <span class="comment-line"># FeatureIdInfo($fId,feature_sub_type) </span>
        if {$regType != $FeatureInfo($chooseFeature,feature_type)  || \
                $regSubType != $FeatureInfo($chooseFeature,feature_sub_type) } {
            <span class="comment-line"># IF the feature is not of the correct type/subtype bail</span>
            if {$DebugOn} {puts &#34;Feature $chooseFeature BAD TYPE OR SUBTYPE   CONTINUE&#34;;  flush stdout; after 50;}
            continue;
        } else {
            lappend finalFeatures $chooseFeature
            if {![info exists FeatureInfo($chooseFeature,DoneWithPhase4)]} {
                set FeatureInfo($chooseFeature,DoneWithPhase4) 0
                set DoneWithPhase4 0
                set alldone 0
                lappend NotDoneWithPhase4Mods $chooseFeature
                if {$DebugOn} {puts &#34;Feature $chooseFeature is NOT DoneWithPhase4&#34;;  flush stdout; after 50;}
            } else {
                set hitOnce 1
            }
            if {![info exists FeatureInfo($chooseFeature,DoneWithPhase3_5)]} {
                set FeatureInfo($chooseFeature,DoneWithPhase3_5) 0
                set DoneWithPhase3_5 0
                set alldone 0
                lappend NotDoneWithPhase3_5Mods $chooseFeature
                if {$DebugOn} {puts &#34;Feature $chooseFeature is NOT DoneWithPhase3_5&#34;;  flush stdout; after 50;}
            } else {
                set hitOnce 1
            }
            if {![info exists FeatureInfo($chooseFeature,DoneWithPhase3)]} {
                set FeatureInfo($chooseFeature,DoneWithPhase3) 0
                set DoneWithPhase3 0
                set alldone 0
                lappend NotDoneWithPhase3Mods $chooseFeature
                if {$DebugOn} {puts &#34;Feature $chooseFeature is NOT DoneWithPhase3&#34;;  flush stdout; after 50;}
            } else {
                set hitOnce 1
            }
            if {![info exists FeatureInfo($chooseFeature,DoneWithPhase2)]} {
                set FeatureInfo($chooseFeature,DoneWithPhase2) 0
                set DoneWithPhase2 0
                set alldone 0
                lappend NotDoneWithPhase2Mods $chooseFeature
                if {$DebugOn} {puts &#34;Feature $chooseFeature is NOT DoneWithPhase2&#34;;  flush stdout; after 50;}
            } else {
                set hitOnce 1
            }
            if {[info exists FeatureInfo($chooseFeature,AlreadyRunPlatform)]} {
                set hitOnce 1
            } else {
                set FeatureInfo($chooseFeature,AlreadyRunPlatform) 0
                set alldone 0
            }
            if {[info exists FeatureInfo($chooseFeature,CR)]} {
                set hitOnce 1
            } else {
                set FeatureInfo($chooseFeature,CR) 0
            }
            if {$hitOnce} {
                set FeatureInfo($chooseFeature,DoneWithPhase1) 1
            } else {
                lappend NotDoneWithPhase1Mods $chooseFeature
                set FeatureInfo($chooseFeature,DoneWithPhase1) 0
                set alldone 0
            }
        }

    }
    set DoneWithPhase1 1
    foreach theFeature $finalFeatures {
        if {![info exists FeatureInfo($theFeature,DoneWithPhase1)] || !$FeatureInfo($theFeature,DoneWithPhase1)} {
            set DoneWithPhase1 0
            set alldone 0
        }
    }
    if {$alldone == 1} {
        return Finished
    }
    <span class="comment-line"># -------------------------------------------------------------------</span>
    <span class="comment-line"># Print out Results</span>
    <span class="comment-line"># -------------------------------------------------------------------</span>
    if {$DoneWithPhase1} {
        if {$DebugOn||$DebugOnHi} {puts &#34;@@@@@@\n@@@@@@\nPlatform $my_platform_name is DoneWithPhase1\n@@@@@@\n@@@@@@&#34;;  flush stdout; after 50;}
        if {$stopWithPhase == &#34;1&#34;} {
             return Finished
        }
    } else {
        if {$DebugOn||$DebugOnHi} {puts &#34;!!!!!!\n!!!!!!\nPlatform $my_platform_name is NOT DoneWithPhase1\n!!!!!!\n!!!!!!&#34;;  flush stdout; after 50;}
    }
    if {$DoneWithPhase2} {
        if {$DebugOn||$DebugOnHi} {puts &#34;@@@@@@\n@@@@@@\nPlatform $my_platform_name is DoneWithPhase2\n@@@@@@\n@@@@@@&#34;;  flush stdout; after 50;}
        if {$stopWithPhase == &#34;2&#34;} {
               return Finished
        }
    } else {
        if {$DebugOn||$DebugOnHi} {puts &#34;!!!!!!\n!!!!!!\nPlatform $my_platform_name is NOT DoneWithPhase2\n$NotDoneWithPhase2Mods\n!!!!!!\n!!!!!!&#34;;  flush stdout; after 50;}
        
    }
    if {$DoneWithPhase3} {
        if {$DebugOn||$DebugOnHi} {puts &#34;@@@@@@\n@@@@@@\nPlatform $my_platform_name is DoneWithPhase3\n@@@@@@\n@@@@@@&#34;;  flush stdout; after 50;}
        if {$stopWithPhase == &#34;3&#34;} {
               return Finished
        }
    } else {
        if {$DebugOn||$DebugOnHi} {puts &#34;!!!!!!\n!!!!!!\nPlatform $my_platform_name is NOT DoneWithPhase3\n$NotDoneWithPhase3Mods\n!!!!!!\n!!!!!!&#34;;  flush stdout; after 50;}
    }
    if {$DoneWithPhase3_5} {
        if {$DebugOn||$DebugOnHi} {puts &#34;@@@@@@\n@@@@@@\nPlatform $my_platform_name is DoneWithPhase3_5\n@@@@@@\n@@@@@@&#34;; flush stdout; after 50;}
        if {$stopWithPhase == &#34;3_5&#34;} {
               return Finished
        }
    } else {
        if {$DebugOn||$DebugOnHi} {puts &#34;!!!!!!\n!!!!!!\nPlatform $my_platform_name is NOT DoneWithPhase3_5\n\
                     $NotDoneWithPhase3_5Mods\n!!!!!!\n!!!!!!&#34;;  flush stdout; after 50;}
    }
    if {$DoneWithPhase4} {
        if {$DebugOn||$DebugOnHi} {puts &#34;@@@@@@\n@@@@@@\nPlatform $my_platform_name is DoneWithPhase4\n@@@@@@\n@@@@@@&#34;;  flush stdout; after 50;}
    } else {
        if {$DebugOn||$DebugOnHi} {puts &#34;!!!!!!\n!!!!!!\nPlatform $my_platform_name is NOT DoneWithPhase4\n$NotDoneWithPhase4Mods\n!!!!!!\n!!!!!!&#34;;  flush stdout; after 50;}
    }
    <span class="comment-line"># --------</span>
    <span class="comment-line"># Note for tomorrow - how to handle skipped -- check Dany table.</span>
    if {$DebugOn||$DebugOnHi} {puts &#34;\n=========\n=========\nF I N I S H E D   D E T E R M I N I N G   P H A S E\n=========\n=========\n&#34;;  flush stdout; after 50;}
    foreach theFeature $finalFeatures {
        if {!$DoneWithPhase1 &amp;&amp; !$FeatureInfo($theFeature,DoneWithPhase1)} {
            if {$DebugOn||$DebugOnHi} {puts &#34;Feature $theFeature returned in Phase1&#34;;  flush stdout; after 50;}
            return $theFeature
        }
        if {$DoneWithPhase1 &amp;&amp; !$DoneWithPhase2 &amp;&amp; !$FeatureInfo($theFeature,DoneWithPhase2)} {
            if {$DebugOn||$DebugOnHi} {puts &#34;Feature $theFeature returned in Phase2&#34;;  flush stdout; after 50;}
            return $theFeature
        }
        if {$DoneWithPhase1 &amp;&amp; $DoneWithPhase2 &amp;&amp; !$DoneWithPhase3 &amp;&amp; \
                   !$FeatureInfo($theFeature,DoneWithPhase3)} {
            if {$DebugOn||$DebugOnHi} {puts &#34;Feature $theFeature returned in Phase3&#34;;  flush stdout; after 50;}
            return $theFeature
        }
        if {$DoneWithPhase1 &amp;&amp; $DoneWithPhase2 &amp;&amp; $DoneWithPhase3 &amp;&amp; !$DoneWithPhase3_5 &amp;&amp; \
                   !$FeatureInfo($theFeature,DoneWithPhase3_5)} {
            if {$DebugOn||$DebugOnHi} {puts &#34;Feature $theFeature returned in Phase3_5&#34;;  flush stdout; after 50;}
            return $theFeature
        }
        if {$DoneWithPhase1 &amp;&amp; $DoneWithPhase2 &amp;&amp; $DoneWithPhase3 &amp;&amp; $DoneWithPhase3_5 &amp;&amp; !$DoneWithPhase4 &amp;&amp; \
                   !$FeatureInfo($theFeature,DoneWithPhase4)} {
            if {$DebugOn||$DebugOnHi} {puts &#34;Feature $theFeature returned in Phase4&#34;;  flush stdout; after 50;}
            return $theFeature
        }
    }
    exit;
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::InsertQueueEntry_3527">proc <a href="mysqlLib.tcl-annot.html#::::InsertQueueEntry">::::InsertQueueEntry</a></a></strong> {args} {
    <a name="::parse_args(33)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertQueueEntry $args {
        id_label &#34;NULL&#34;
        build_id &#34;&#34;
        reg_server &#34;&#34;
        user &#34;&#34;
        platform &#34;&#34;
        type &#34;&#34;
        status &#34;&#34;
        branch &#34;&#34;
        tag &#34;&#34;
        comment &#34;&#34;
        robot_guid  &#34;&#34;
        priority &#34;3&#34;
    }
    
    global DEVREG
    global mysqlstatus mysql_handler

    set centralstatus [<a name="::conn_to_db(3)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler

    set d1 [exec date +%Y-%m-%d]
    set d2 [exec date +%k:%M:%S]
    set d [append d $d1]
    set d [append d &#34; &#34;]
    set d [append d $d2]
    
    set insert_clause [append insert_clause &#34;insert into reg_run (id_label, &#34;]
    set insert_clause [append insert_clause &#34;build_id, &#34;]
    set insert_clause [append insert_clause &#34;reg_server, &#34;]
    set insert_clause [append insert_clause &#34;user, &#34;]
    set insert_clause [append insert_clause &#34;platform, &#34;]
    set insert_clause [append insert_clause &#34;type, &#34;]
    set insert_clause [append insert_clause &#34;status, &#34;]
    set insert_clause [append insert_clause &#34;date_run, &#34;]
    set insert_clause [append insert_clause &#34;tag, &#34;]
    set insert_clause [append insert_clause &#34;comment, &#34;]
    set insert_clause [append insert_clause &#34;robot_guid, &#34;]
    set insert_clause [append insert_clause &#34;priority, &#34;]
    set insert_clause [append insert_clause &#34;branch) &#34;]
    
    set insert_clause [append insert_clause &#34;values (\&#34;$id_label\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$build_id\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$reg_server\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$user\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$platform\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$type\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$status\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$d\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$tag\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$comment\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$robot_guid\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$priority\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$branch\&#34;)&#34;]
    
    if {[catch {mysqlexec  $DEVREG(mysql,centralhandler) $insert_clause} reason]} {
        <span class="comment-line">#puts stderr $mysqlstatus(message)</span>
        puts &#34;!!!!!\nInsert of new regression $id_label failed\nreason: $reason\n!!!!!&#34;
        <span class="comment-line">#set insert_sync [append insert_sync &#34;insert into sync_table (stored_query) &#34;]</span>
        <span class="comment-line">#set insert_sync [append insert_sync &#34;values (\&#34;$insert_clause\&#34;)&#34;]</span>
        <span class="comment-line">#mysqlexec  $DEVREG(mysql,localhandler) $insert_sync</span>
        if {$mysqlstatus(code) !=0} {
            puts stderr $mysqlstatus(message)
            return $mysqlstatus(code)
        }
    }
    return $mysqlstatus(code)
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getRegIdFromQId_3603">proc <a href="mysqlLib.tcl-annot.html#::::getRegIdFromQId">::::getRegIdFromQId</a></a></strong> {id_label} {
    global DEVREG
    global mysqlstatus  mysql_handler

    set reg_id_list &#34;&#34;
    set centralstatus [<a name="::conn_to_db(4)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler
    puts &#34;MYSQL CONNECTION STATUS: centralstatus = $centralstatus&#34;    
    set sel_clause &#34;SELECT reg_id FROM reg_run \
                  WHERE id_label ='$id_label'&#34;
    <span class="comment-line">#</span>
    <span class="comment-line"># EY-03-20-2013: Wrap call to mysqlsel in a catch statement.  This</span>
    <span class="comment-line"># will prevent scripts from aborting due to errors.</span>
    set rc [catch {
        set reg_id_list [mysqlsel $DEVREG(mysql,centralhandler) $sel_clause -flatlist];
    } reason];
    if {$rc != 0} {
        <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;getRegIdFromQId: mysqlsel failed with return code $rc.  Error: $reason&#34;;
    }
    set the_reg_id [lindex $reg_id_list 0]
    <span class="comment-line">#catch {mysqlclose $DEVREG(mysql,centralhandler)} reason</span>
    return $the_reg_id
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::InsertQModuleEntry_3633">proc <a href="mysqlLib.tcl-annot.html#::::InsertQModuleEntry">::::InsertQModuleEntry</a></a></strong> {args} {
    <a name="::parse_args(34)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertQModuleEntry $args {
        reg_id &#34;NULL&#34;
        name &#34;NULL&#34;
        list &#34;&#34;
        status &#34;&#34;
    }
    global DEVREG
    global mysqlstatus mysql_handler
    
    set centralstatus [<a name="::conn_to_db(5)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler
    set insert_clause [append insert_clause &#34;insert into test_module (reg_id, &#34;]
    set insert_clause [append insert_clause &#34;name, &#34;]
    set insert_clause [append insert_clause &#34;status, &#34;]
    set insert_clause [append insert_clause &#34;list) &#34;]
    
    set insert_clause [append insert_clause &#34;values (\&#34;$reg_id\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$name\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$status\&#34;, &#34;]
    set insert_clause [append insert_clause &#34;\&#34;$list\&#34;)&#34;]
    
    catch {mysqlexec  $DEVREG(mysql,centralhandler) $insert_clause} reason
    <span class="comment-line">#catch {mysqlclose $DEVREG(mysql,centralhandler)} reason</span>
    if {0 &amp;&amp; $mysqlstatus(code) !=0} {
        puts stderr $mysqlstatus(message)
        puts &#34;!!!!!\nInsert of new module $name failed\nreason: $reason\n!!!!!&#34;
        set insert_sync [append insert_sync &#34;insert into sync_table (stored_query) &#34;]
        set insert_sync [append insert_sync &#34;values (\&#34;$insert_clause\&#34;)&#34;]
        mysqlexec  $DEVREG(mysql,localhandler) $insert_sync
        if {$mysqlstatus(code) !=0} {
            puts stderr $mysqlstatus(message)
            return $mysqlstatus(code)
        }
    }
    return $mysqlstatus(code)
}

<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::updateRegTestModule_3678">proc <a href="mysqlLib.tcl-annot.html#::::updateRegTestModule">::::updateRegTestModule</a></a></strong> {args} {
    <a name="::parse_args(35)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> updateRegTestModule $args {
        reg_id   &#34;null&#34;
        name     &#34;null&#34;
        pass_cnt &#34;null&#34;
        total_cnt &#34;null&#34;
        status &#34;null&#34;
        testbed &#34;null&#34;
        list &#34;null&#34;
        duration &#34;null&#34;
        pass_cnt_1 &#34;null&#34;
        total_cnt_1 &#34;null&#34;
        start_timestamp &#34;null&#34;
        duration_1 &#34;null&#34;
        sqa_revision &#34;null&#34;
        corefiles &#34;null&#34;
        corefiles_1 &#34;null&#34;
    }
    
    global DEVREG
    global mysqlstatus mysql_handler

    set centralstatus [<a name="::conn_to_db(6)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler

    <span class="comment-line">#if {$reg_id == &#34;null&#34; || $reg_id == &#34;&#34; || $name == &#34;null&#34; || $name == &#34;&#34;} {</span>
    <span class="comment-line">#    return -1</span>
    <span class="comment-line">#}</span>
    set argList &#34;&#34;
    if {$pass_cnt != &#34;null&#34;} {
        lappend argList &#34;pass_cnt&#34;
    }
    if {$total_cnt != &#34;null&#34;} {
        lappend argList &#34;total_cnt&#34;
    }
    if {$status != &#34;null&#34;} {
        lappend argList &#34;status&#34;
    }
    if {$testbed != &#34;null&#34;} {
        lappend argList &#34;testbed&#34;
    }
    if {$list != &#34;null&#34;} {
        lappend argList &#34;list&#34;
    }
    if {$duration != &#34;null&#34;} {
        lappend argList &#34;duration&#34;
    }
    if {$pass_cnt_1 != &#34;null&#34;} {
        lappend argList &#34;pass_cnt_1&#34;
    }
    if {$total_cnt_1 != &#34;null&#34;} {
        lappend argList &#34;total_cnt_1&#34;
    }
    if {$duration_1 != &#34;null&#34;} {
        lappend argList &#34;duration_1&#34;
    }
    if {$start_timestamp != &#34;null&#34;} {
        lappend argList &#34;start_timestamp&#34;
    }
    if {$sqa_revision != &#34;null&#34;} {
        lappend argList &#34;sqa_revision&#34;
    }
    if {$corefiles != &#34;null&#34;} {
        lappend argList &#34;corefiles&#34;
    }
    if {$corefiles_1 != &#34;null&#34;} {
        lappend argList &#34;corefiles_1&#34;
    }
    set argCount [llength $argList]
    set a 0
    set update_clause [append update_clause &#34;update test_module &#34;]
    foreach theArg $argList {
        set aLineNum [expr $a + 1];
        if {$a==0 &amp;&amp; $aLineNum&lt;$argCount} {
            set update_clause [append update_clause &#34;set $theArg=\'[set $theArg]\', &#34;]
            incr a
            continue;
        } elseif {$a==0 &amp;&amp; $aLineNum==$argCount} {
            set update_clause [append update_clause &#34;set $theArg=\'[set $theArg]\' &#34;]
            incr a
            continue;
        }
        if {$aLineNum&lt;$argCount} {
            set update_clause [append update_clause &#34;$theArg=\'[set $theArg]\', &#34;]
        } else {
            set update_clause [append update_clause &#34;$theArg=\'[set $theArg]\' &#34;]
        }
        incr a;
    }
    set update_clause [append update_clause &#34;WHERE reg_id=\'$reg_id\' AND name=\'$name\' &#34;]
    <span class="comment-line">#puts &#34;updateclause: $update_clause&#34;</span>
    if [catch {mysqlexec  $DEVREG(mysql,centralhandler) $update_clause} reason] {
        puts &#34;OOPS $reason&#34;
    }
    <span class="comment-line">#catch {mysqlclose $DEVREG(mysql,centralhandler)} reason</span>
    if {0 &amp;&amp; $mysqlstatus(code) !=0} {
        puts stderr $mysqlstatus(message)
        puts &#34;!!!!!\nUpdate of module $name failed\nreason: $reason\n!!!!!&#34;
        set insert_sync [append insert_sync &#34;insert into sync_table (stored_query) &#34;]
        set insert_sync [append insert_sync &#34;values (\&#34;$update_clause\&#34;)&#34;]
        mysqlexec  $DEVREG(mysql,localhandler) $insert_sync
        if {$mysqlstatus(code) !=0} {
            puts stderr $mysqlstatus(message)
            return $mysqlstatus(code)
        }
    }
    return $mysqlstatus(code)
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::updateRegIdStatus_3793">proc <a href="mysqlLib.tcl-annot.html#::::updateRegIdStatus">::::updateRegIdStatus</a></a></strong> {args} {
    <a name="::parse_args(36)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> updateRegIdStatus $args {
        reg_id   &#34;null&#34;
        status &#34;null&#34;
        id_label &#34;null&#34;
    }
    
    global DEVREG
    global mysqlstatus mysql_handler

    set centralstatus [<a name="::conn_to_db(7)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler
    set ts [clock format [clock seconds] -format &#34;%Y-%m-%d %I:%M:%S&#34;]

    set update_clause [append update_clause &#34;update reg_run &#34;]
    set update_clause [append update_clause &#34;set status=\&#34;$status\&#34; &#34;]
    if {$id_label != &#34;null&#34;} {
        set update_clause [append update_clause &#34;where id_label=\&#34;$id_label\&#34; &#34;]
    } else {
        set update_clause [append update_clause &#34;where reg_id=\&#34;$reg_id\&#34; &#34;]
    }
    <span class="comment-line">#puts &#34;up regid $update_clause&#34;</span>
    catch {mysqlexec  $DEVREG(mysql,centralhandler) $update_clause} reason
    <span class="comment-line">#catch {mysqlclose $DEVREG(mysql,centralhandler)} reason</span>
    if {0 &amp;&amp; $mysqlstatus(code) !=0} {
        puts stderr $mysqlstatus(message)
        puts &#34;!!!!!\nUpdate of reg_id status failed\nreason: $reason\n!!!!!&#34;
        set insert_sync [append insert_sync &#34;insert into sync_table (stored_query) &#34;]
        set insert_sync [append insert_sync &#34;values (\&#34;$update_clause\&#34;)&#34;]
        mysqlexec  $DEVREG(mysql,localhandler) $insert_sync
        if {$mysqlstatus(code) !=0} {
            puts stderr $mysqlstatus(message)
            return $mysqlstatus(code)
        }
    }
    return $mysqlstatus(code)
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::updateRegIdEntry_3834">proc <a href="mysqlLib.tcl-annot.html#::::updateRegIdEntry">::::updateRegIdEntry</a></a></strong> {args} {
    <a name="::parse_args(37)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> updateRegIdStatus $args {
        reg_id   &#34;null&#34;
        id_label &#34;null&#34;
        status   &#34;null&#34;
        start_timestamp &#34;null&#34;
        priority        &#34;null&#34;
        control         &#34;null&#34;
        <a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a>         &#34;null&#34;
    }
    
    global DEVREG
    global mysqlstatus mysql_handler

    set centralstatus [<a name="::conn_to_db(8)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler

    set argList &#34;&#34;
    if {$status != &#34;null&#34;} {
        lappend argList &#34;status&#34;
    }
    if {$start_timestamp != &#34;null&#34;} {
        lappend argList &#34;start_timestamp&#34;
    }
    if {$priority != &#34;null&#34;} {
        lappend argList &#34;priority&#34;
    }
    if {$version != &#34;null&#34;} {
        lappend argList &#34;version&#34;
    }
    if {$control != &#34;null&#34;} {
        lappend argList &#34;control&#34;
    }
    set argCount [llength $argList]
    set a 0
    set update_clause [append update_clause &#34;update reg_run &#34;]
    foreach theArg $argList {
        set aLineNum [expr $a + 1];
        if {$a==0 &amp;&amp; $aLineNum&lt;$argCount} {
            set update_clause [append update_clause &#34;set $theArg=\'[set $theArg]\', &#34;]
            incr a
            continue;
        } elseif {$a==0 &amp;&amp; $aLineNum==$argCount} {
            set update_clause [append update_clause &#34;set $theArg=\'[set $theArg]\' &#34;]
            incr a
            continue;
        }
        if {$aLineNum&lt;$argCount} {
            set update_clause [append update_clause &#34;$theArg=\'[set $theArg]\', &#34;]
        } else {
            set update_clause [append update_clause &#34;$theArg=\'[set $theArg]\' &#34;]
        }
        incr a;
    }

    if {$id_label != &#34;null&#34;} {
        set where_stmt &#34;id_label=\&#34;$id_label\&#34; &#34;
    } else {
        set where_stmt &#34;reg_id=\&#34;$reg_id\&#34; &#34;
    }    

    set update_clause [append update_clause &#34;WHERE $where_stmt &#34;]
    catch {mysqlexec  $DEVREG(mysql,centralhandler) $update_clause} reason
    return $mysqlstatus(code)
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::updateRegTestModuleWhere_3906">proc <a href="mysqlLib.tcl-annot.html#::::updateRegTestModuleWhere">::::updateRegTestModuleWhere</a></a></strong> {args} {
    <a name="::parse_args(38)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> updateRegTestModule $args {
        reg_id   &#34;null&#34;
        name     &#34;null&#34;
        pass_cnt &#34;null&#34;
        total_cnt &#34;null&#34;
        status &#34;null&#34;
        testbed &#34;null&#34;
        list &#34;null&#34;
        duration &#34;null&#34;
        pass_cnt_1 &#34;null&#34;
        total_cnt_1 &#34;null&#34;
        duration_1 &#34;null&#34;
        start_timestamp &#34;null&#34;
        corefiles &#34;null&#34;
        corefiles_1 &#34;null&#34;
        where_stmt &#34;null&#34;
    }
    
    global DEVREG
    global mysqlstatus  mysql_handler


    set centralstatus [<a name="::conn_to_db(9)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler

    <span class="comment-line">#if {$reg_id == &#34;null&#34; || $reg_id == &#34;&#34; || $name == &#34;null&#34; || $name == &#34;&#34;} {</span>
    <span class="comment-line">#    return -1</span>
    <span class="comment-line">#}</span>
    set argList &#34;&#34;
    if {$pass_cnt != &#34;null&#34;} {
        lappend argList &#34;pass_cnt&#34;
    }
    if {$total_cnt != &#34;null&#34;} {
        lappend argList &#34;total_cnt&#34;
    }
    if {$status != &#34;null&#34;} {
        lappend argList &#34;status&#34;
    }
    if {$testbed != &#34;null&#34;} {
        lappend argList &#34;testbed&#34;
    }
    if {$list != &#34;null&#34;} {
        lappend argList &#34;list&#34;
    }
    if {$duration != &#34;null&#34;} {
        lappend argList &#34;duration&#34;
    }
    if {$pass_cnt_1 != &#34;null&#34;} {
        lappend argList &#34;pass_cnt_1&#34;
    }
    if {$total_cnt_1 != &#34;null&#34;} {
        lappend argList &#34;total_cnt_1&#34;
    }
    if {$duration_1 != &#34;null&#34;} {
        lappend argList &#34;duration_1&#34;
    }
    if {$start_timestamp != &#34;null&#34;} {
        lappend argList &#34;start_timestamp&#34;
    }
    if {$corefiles != &#34;null&#34;} {
        lappend argList &#34;corefiles&#34;
    }
    if {$corefiles_1 != &#34;null&#34;} {
        lappend argList &#34;corefiles_1&#34;
    }

    set argCount [llength $argList]
    set a 0
    set update_clause [append update_clause &#34;update test_module &#34;]
    foreach theArg $argList {
        set aLineNum [expr $a + 1];
        if {$a==0 &amp;&amp; $aLineNum&lt;$argCount} {
            set update_clause [append update_clause &#34;set $theArg=\'[set $theArg]\', &#34;]
            incr a
            continue;
        } elseif {$a==0 &amp;&amp; $aLineNum==$argCount} {
            set update_clause [append update_clause &#34;set $theArg=\'[set $theArg]\' &#34;]
            incr a
            continue;
        }
        if {$aLineNum&lt;$argCount} {
            set update_clause [append update_clause &#34;$theArg=\'[set $theArg]\', &#34;]
        } else {
            set update_clause [append update_clause &#34;$theArg=\'[set $theArg]\' &#34;]
        }
        incr a;
    }
    set update_clause [append update_clause &#34;WHERE $where_stmt &#34;]
    <span class="comment-line">#puts &#34;updateclause: $update_clause&#34;</span>
    if {[catch {mysqlexec  $DEVREG(mysql,centralhandler) $update_clause} reason]} {
        puts &#34;query error $update_clause&#34;
    }
    <span class="comment-line">#catch {mysqlclose $DEVREG(mysql,centralhandler)} reason</span>
    if {0 &amp;&amp; $mysqlstatus(code) !=0} {
        puts stderr $mysqlstatus(message)
        puts &#34;!!!!!\nUpdate of module $name failed\nreason: $reason\n!!!!!&#34;
        set insert_sync [append insert_sync &#34;insert into sync_table (stored_query) &#34;]
        set insert_sync [append insert_sync &#34;values (\&#34;$update_clause\&#34;)&#34;]
        mysqlexec  $DEVREG(mysql,localhandler) $insert_sync
        if {$mysqlstatus(code) !=0} {
            puts stderr $mysqlstatus(message)
            return $mysqlstatus(code)
        }
    }
    return $mysqlstatus(code)
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getRegIdModulesWhere_4020">proc <a href="mysqlLib.tcl-annot.html#::::getRegIdModulesWhere">::::getRegIdModulesWhere</a></a></strong> {reg_id where} {
    global DEVREG
    global mysqlstatus mysql_handler

    set centralstatus [<a name="::conn_to_db(10)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler
    
    set sel_clause &#34;SELECT name FROM test_module \
                   WHERE reg_id ='$reg_id' AND $where&#34;
    set mod_list [mysqlsel $DEVREG(mysql,centralhandler) $sel_clause -flatlist]
    <span class="comment-line">#catch {mysqlclose $DEVREG(mysql,centralhandler)} reason</span>
    return $mod_list
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getRunRegTestModuleStatus_4038">proc <a href="mysqlLib.tcl-annot.html#::::getRunRegTestModuleStatus">::::getRunRegTestModuleStatus</a></a></strong> {reg_id  mod} {
    global DEVREG
    global mysqlstatus mysql_handler

    set centralstatus [<a name="::conn_to_db(11)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler

    set sel_clause &#34;SELECT status, pass_cnt, total_cnt, duration FROM test_module \
                   WHERE reg_id ='$reg_id' AND name = '$mod'&#34;
    set mod_list [mysqlsel $DEVREG(mysql,centralhandler) $sel_clause -flatlist]
    <span class="comment-line">#catch {mysqlclose $DEVREG(mysql,centralhandler)} reason</span>
    return $mod_list
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getValueTestModWhere_4058">proc <a href="mysqlLib.tcl-annot.html#::::getValueTestModWhere">::::getValueTestModWhere</a></a></strong> {get where} {
    global DEVREG
    global mysqlstatus mysql_handler

    set centralstatus [<a name="::conn_to_db(12)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler

    set sel_clause &#34;SELECT $get FROM test_module \
                   WHERE $where&#34;
    set mod_list [mysqlsel $DEVREG(mysql,centralhandler) $sel_clause -flatlist]
    <span class="comment-line">#catch {mysqlclose $DEVREG(mysql,centralhandler)} reason</span>
    return $mod_list
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getFromRegRunWhere_4078">proc <a href="mysqlLib.tcl-annot.html#::::getFromRegRunWhere">::::getFromRegRunWhere</a></a></strong> {get where} {
    global DEVREG
    global mysqlstatus mysql_handler

    set centralstatus [<a name="::conn_to_db(13)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]
    set DEVREG(mysql,centralhandler) $mysql_handler

    set sel_clause &#34;SELECT $get FROM reg_run \
                   WHERE $where&#34;
    set out_list [mysqlsel $DEVREG(mysql,centralhandler) $sel_clause -flatlist]
    <span class="comment-line">#catch {mysqlclose $DEVREG(mysql,centralhandler)} reason</span>
    return $out_list
}
<span class="comment-line">##################################################################</span>
<span class="comment-line">## proc updateJenkinsRegIdStatus</span>
<span class="comment-line">#</span>
<span class="comment-line">#  send an http request to a jenkins url</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">###################################################################</span>
<strong><a name="::::updateJenkinsRegIdStatus_4098">proc <a href="mysqlLib.tcl-annot.html#::::updateJenkinsRegIdStatus">::::updateJenkinsRegIdStatus</a></a></strong> {args} {
    <a name="::parse_args(39)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> updateJenkinsRegIdStatus $args {
        reg_id   &#34;null&#34;
        q_id   &#34;null&#34;
        status &#34;null&#34;
        url &#34;null&#34;
    }

    global DEVREG

    catch {
        set j_url [http_formatQuery queue_id $q_id reg_id $reg_id \
                    result $status]
        set out_url [append url &#34;&amp;$j_url&#34;]
        puts &#34;!!\n!!\n!!\nSending $out_url\n!!\n!!\n!!&#34;

        set token [http_get $out_url -timeout 10000 ]
        puts stderr &#34;&#34;

        upvar #0 $token state

        puts &#34;output: $state(body)&#34;
    } httpResult

    if { $httpResult != &#34;&#34; } {
        puts &#34;HTTP CRASH: $httpResult&#34;
    }
    <span class="comment-line">#return $state(body)</span>

}
<span class="comment-line">##################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::dbKillReg_4135">proc <a href="mysqlLib.tcl-annot.html#::::dbKillReg">::::dbKillReg</a></a></strong> {queueId} {
    <span class="comment-line"># -----------------------------------------------------------------------------------------</span>
    <span class="comment-line"># mysql server cfg for posting</span>
    <span class="comment-line"># -----------------------------------------------------------------------------------------</span>
    global autoPath
    source $autoPath/Lib/mysqlLib.tcl
    global DEVREG
    global mysql_handler mysql_handler
    if {[info exists DEVREG(mysql,UseDb)] &amp;&amp; !$DEVREG(mysql,UseDb)} {
        puts &#34;-----\nSkip update database Use DB is set to $DEVREG(mysql,UseDb)\n-----&#34;
        return;
    }
    <span class="comment-line"># connect to local sync database -- queuries are stored on the sync database while updating</span>
    <span class="comment-line">#                                   the central db.  If central is successful that sync query</span>
    <span class="comment-line">#                                   is deleted.  Else it is saved and purged once link is back</span>
    <span class="comment-line">#                                   up.</span>
    <span class="comment-line">#puts &#34;-----\nConnecting to SYNC database $DEVREG(mysql,localdb) at $DEVREG(mysql,localbackup)\n-----&#34;</span>
    <span class="comment-line">#set localstatus [conn_to_db $DEVREG(mysql,localbackup) $DEVREG(mysql,localdb) regression_user extreme]</span>
    <span class="comment-line">#set DEVREG(mysql,localhandler) $mysql_handler</span>
    <span class="comment-line">#puts &#34;-----\nDatabase $DEVREG(mysql,localdb) at $DEVREG(mysql,localbackup) - \</span>
    <span class="comment-line">#            status $localstatus handler $DEVREG(mysql,localhandler)\n-----&#34;</span>
    <span class="comment-line"># </span>
    <span class="comment-line">#puts &#34;-----\nConnecting to CENTRAL database $DEVREG(mysql,centraldb) at $DEVREG(mysql,centralserver)\n-----&#34;</span>
    <span class="comment-line">#set centralstatus [conn_to_db $DEVREG(mysql,centralserver) $DEVREG(mysql,centraldb) regression_user extreme]</span>
    <span class="comment-line">#set DEVREG(mysql,centralhandler) $mysql_handler</span>
    <span class="comment-line">#puts &#34;-----\nDatabase $DEVREG(mysql,centraldb) at $DEVREG(mysql,centralserver) - \</span>
    <span class="comment-line">#            status $centralstatus handler $DEVREG(mysql,centralhandler)\n-----&#34;</span>
    
    set rId [<a name="::getRegIdFromQId(1)"><a href="./mysqlLib.tcl.html#::getRegIdFromQId_3603">::getRegIdFromQId</a></a> $queueId]
    <a name="::updateRegIdStatus(1)"><a href="./mysqlLib.tcl.html#::updateRegIdStatus_3793">::updateRegIdStatus</a></a> -reg_id $rId -status &#34;Killed&#34;
    set activeMods [<a name="::getRegIdModulesWhere(1)"><a href="./mysqlLib.tcl.html#::getRegIdModulesWhere_4020">::getRegIdModulesWhere</a></a> $rId &#34;(status = 'queued ' OR status = 'running' OR status = 'reRun')&#34;]
    set modQ &#34;&#34;
    if {[llength $activeMods] == 0} {
        return;
    }
    foreach aMod $activeMods {
        lappend modQ &#34;name = \'$aMod\'&#34;
    }
    set modQString [join $modQ &#34; OR &#34;]
    set modQString &#34;(${modQString})&#34;
    <a name="::updateRegTestModuleWhere(1)"><a href="./mysqlLib.tcl.html#::updateRegTestModuleWhere_3906">::updateRegTestModuleWhere</a></a> -status &#34;killed&#34; -where_stmt &#34;reg_id = \'$rId\' AND $modQString&#34;
}

<span class="comment-line">#########################################################################################################</span>
<span class="comment-line">#Procedure Name: get_db_name_by_build</span>
<span class="comment-line">#Description : queries build table and gets db_name from build_id</span>
<span class="comment-line">#Input args : build_id</span>
<span class="comment-line">#output args : db_name</span>
<span class="comment-line">#Typical Usage : retval [get_db_name_by_build 12.5.0.30]</span>
<span class="comment-line">#Category: Utility</span>
<span class="comment-line">########################################################################################################</span>
<strong><a name="::::get_db_name_by_build_4186">proc <a href="mysqlLib.tcl-annot.html#::::get_db_name_by_build">::::get_db_name_by_build</a></a></strong> {build} {
    global mysqlIP
    global my_db
    set conn [<a name="::conn_to_db(14)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $mysqlIP $my_db]
    if {$conn != &#34;0&#34;} {
        puts &#34;Unable to connect to $my_db&#34;
        return -1
     }
    global mysql_handler
    set list_out [<a name="::convBuild(1)"><a href="./mysqlLib.tcl.html#::convBuild_4211">::convBuild</a></a> $build]
    set build_minor_release [lindex $list_out 0]
    set build_number [lindex $list_out 1]
    set build_id [string trim [mysqlsel $mysql_handler &#34;SELECT build_id  FROM build_table WHERE build_minor_release = \&#34;$build_minor_release\&#34;  AND build_number = \&#34;$build_number\&#34;&#34; -flatlist] &#34;{}&#34;]
    
    set db [string trim [mysqlsel $mysql_handler &#34;SELECT db_name FROM build_table WHERE build_id = \&#34;$build_id\&#34;&#34; -flatlist] &#34;{}&#34;]
    return $db
}
<span class="comment-line">#################################################################################################3</span>
<span class="comment-line">#Procedure Name : convBuild</span>
<span class="comment-line">#Description : Converts the input build into build number and build minor release</span>
<span class="comment-line">#Input args : build</span>
<span class="comment-line">#output args : output which contains build number and build minor release</span>
<span class="comment-line">#Typical Usage: retval [convBuild 12.5.0.30]</span>
<span class="comment-line">#Category : Utility</span>
<span class="comment-line">######################################################################################################</span>
<strong><a name="::::convBuild_4211">proc <a href="mysqlLib.tcl-annot.html#::::convBuild">::::convBuild</a></a></strong> {build} {
  set output &#34;&#34;
  set build_list [split $build &#34;.&#34;]
  set build_minor_release [lindex $build_list 0].[lindex $build_list 1].[lindex $build_list 2]
  lappend output $build_minor_release
  set build_list [lreplace $build_list 0 2 &#34;&#34;]
  set build_number [string trim [join $build_list &#34;.&#34;] &#34;.&#34;]
  lappend output $build_number
  return $output
 
}

    
<span class="comment-line">###########################################################################################################################</span>
<span class="comment-line">#Procedure Name : mailNewFailures</span>
<span class="comment-line">#Description : Compares the current build results per module with the base line build and mails the new failures  in HTML </span>
<span class="comment-line">#              format.</span>
<span class="comment-line">#Input args : </span>
<span class="comment-line">#           cfg - cfg file name</span>
<span class="comment-line">#           build - current build</span>
<span class="comment-line">#           module - feature_directory name</span>
<span class="comment-line">#           baseLine - List of base builds with which the results have to be compared</span>
<span class="comment-line">#Output args : None</span>
<span class="comment-line">#Category : Utility</span>
<span class="comment-line">####################################################################################################################################</span>

<strong><a name="::::mailNewFailures_4237">proc <a href="mysqlLib.tcl-annot.html#::::mailNewFailures">::::mailNewFailures</a></a></strong> {args} {
  <a name="::parse_args(40)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> mailNewFailures $args {
     cfg &#34;&#34;
     build &#34;&#34;
     module &#34;&#34;
     baseLine &#34;&#34;
  }
  global mysqlIP
  global my_db
   <span class="comment-line">#########select_db_by_build########################</span>
   set orig_build_db [<a name="::get_db_name_by_build(1)"><a href="./mysqlLib.tcl.html#::get_db_name_by_build_4186">::get_db_name_by_build</a></a> $build]
  <span class="comment-line">####connect to Db########################</span>
  set connection [<a name="::conn_to_db(15)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $mysqlIP $orig_build_db]
  if {$connection != &#34;0&#34;} {
      puts &#34;Unable to connect to $orig_build_db&#34;
      return 
  }
  global mysql_handler
  set  platform_id [mysqlsel $mysql_handler &#34;SELECT platform_id FROM platform_table  WHERE platform_cfg_file_name = \&#34;$cfg\&#34;&#34; -flatlist]
  set  feature_id [mysqlsel $mysql_handler &#34;SELECT feature_id FROM feature_table WHERE feature_directory = \&#34;$module\&#34; AND feature_type = 'functional'&#34; -flatlist]


  set build_list [<a name="::convBuild(2)"><a href="./mysqlLib.tcl.html#::convBuild_4211">::convBuild</a></a> $build]
  set build_minor_release [lindex $build_list 0]
  set build_number [lindex $build_list 1]

  set build_id [mysqlsel $mysql_handler &#34;SELECT build_id FROM build_table WHERE build_number = \&#34;$build_number\&#34; AND build_minor_release = \&#34;$build_minor_release\&#34;&#34; -flatlist]
  set regression_id [mysqlsel $mysql_handler &#34;SELECT regression_id FROM regression_table WHERE build_id = \&#34;$build_id\&#34; AND platform_id = \&#34;$platform_id\&#34;&#34; -flatlist]
  set report_id [mysqlsel $mysql_handler &#34;SELECT report_id FROM report_table WHERE regression_id = \&#34;$regression_id\&#34; AND feature_id = \&#34;$feature_id\&#34;&#34; -flatlist]
  set run_number [llength $report_id]
  set report_id [mysqlsel $mysql_handler &#34;SELECT report_id FROM report_table WHERE regression_id = \&#34;$regression_id\&#34; AND feature_id = \&#34;$feature_id\&#34; AND run_number = \&#34;$run_number\&#34;&#34; -flatlist]

  set  result_of_orig_build [mysqlsel $mysql_handler &#34;SELECT feature_test_script_name,log_id,status FROM log_table WHERE report_id = \&#34;$report_id\&#34;&#34; -list]

  <span class="comment-line">#puts &#34;list of original build  : $result_of_orig_build&#34;</span>
  global mysql_handler
  set baseLineList [split $baseLine &#34;,&#34;]
  <span class="comment-line">#puts &#34;$baseLine&#34;</span>
  set finalResult &#34;&#34;
  foreach element $baseLineList {
      set baseLinedb [<a name="::get_db_name_by_build(2)"><a href="./mysqlLib.tcl.html#::get_db_name_by_build_4186">::get_db_name_by_build</a></a> $element]
      set conn [<a name="::conn_to_db(16)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $mysqlIP $baseLinedb]
      if {$conn != &#34;0&#34;} {
          puts &#34;unable to connect to $baseLinedb&#34;
          return
       }
      set baseLineBuild_list [<a name="::convBuild(3)"><a href="./mysqlLib.tcl.html#::convBuild_4211">::convBuild</a></a> $element]
      set baseLineBuild_number [lindex $baseLineBuild_list 1]
      set baseLineBuild_minor_release [lindex $baseLineBuild_list 0]



     set  baseLineBuild_id [mysqlsel $mysql_handler &#34;SELECT build_id FROM build_table WHERE build_number = \&#34;$baseLineBuild_number\&#34; AND build_minor_release = \&#34;$baseLineBuild_minor_release\&#34;&#34; -flatlist]
     <span class="comment-line">#puts &#34;id :  $baseLineBuild_id&#34;</span>

     set  baseLineRegression_id [mysqlsel $mysql_handler &#34;SELECT regression_id FROM regression_table WHERE build_id = \&#34;$baseLineBuild_id\&#34; AND platform_id = \&#34;$platform_id\&#34;&#34; -flatlist]
     <span class="comment-line">#puts &#34;reg :  $baseLineRegression_id&#34;</span>
     if {$baseLineRegression_id == &#34;&#34;} {
         continue;
     }
     set  baseLineReport_id [mysqlsel $mysql_handler &#34;SELECT report_id FROM report_table WHERE regression_id = \&#34;$baseLineRegression_id\&#34; AND feature_id = \&#34;$feature_id\&#34;&#34; -flatlist]
     <span class="comment-line">#puts &#34;repid : $baseLineReport_id&#34;</span>
     if {$baseLineReport_id  == &#34;&#34;} {
          continue;
     }

    set brunNumber [llength $baseLineReport_id]
    set  baseLineReport_id [mysqlsel $mysql_handler &#34;SELECT report_id FROM report_table WHERE regression_id = \&#34;$baseLineRegression_id\&#34; AND feature_id = \&#34;$feature_id\&#34; AND run_number = \&#34;$brunNumber\&#34;&#34; -flatlist]

    set result_of_baseLine_build [mysqlsel $mysql_handler &#34;SELECT feature_test_script_name,log_id,status FROM log_table WHERE report_id = \&#34;$baseLineReport_id\&#34;&#34; -list]


    <span class="comment-line">#puts &#34;list of base line build : $result_of_baseLine_build&#34;</span>

       set connection [<a name="::conn_to_db(17)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $mysqlIP $my_db]
       global mysql_handler
       foreach ele $result_of_orig_build {

         set script_name [lindex $ele 0]
         set log_id [lindex $ele 1]
         set status [lindex $ele 2]
         set notReq &#34;Aborted Failed CoreDump PowerCycled&#34;
         if {[lsearch $notReq $script_name] != -1} {
              continue;
         }

              foreach bele $result_of_baseLine_build {
                 set bscript_name [lindex $bele 0]
                 set blog_id [lindex $bele 1]
                 set bstatus [lindex $bele 2]
      
                 if {[string compare $script_name $bscript_name] == 0 } {
     
                     if {($status == &#34;failed&#34;) &amp;&amp; ($bstatus == &#34;passed&#34;)} {
                          set fa [string trim [mysqlsel $mysql_handler &#34;SELECT fa_cause FROM aux_log_table WHERE log_id = \&#34;$log_id\&#34;&#34; -flatlist] &#34;{}&#34;]
                          set notReqList &#34;script new_script harness&#34;
                          if {[lsearch $notReqList $fa] == -1} {
                                lappend finalResult &#34;$script_name $log_id  $element&#34;
                          }
                     }
                 }

             }

      }


  }
  if {[llength $finalResult] != 0} {
       puts $finalResult
       <a name="::mailHtmlFormat(1)"><a href="./mysqlLib.tcl.html#::mailHtmlFormat_4369">::mailHtmlFormat</a></a> -mailInput $finalResult -regression_id $regression_id -feature_id $feature_id -module $module -build $build -baseLine $baseLine -cfg $cfg       

  } else {
       puts &#34; NO_NEW_FAILURES&#34;
  }

}
<span class="comment-line">##################################################################################################################</span>
<span class="comment-line">#Procedure Name : mailHtmlFormat</span>
<span class="comment-line">#Description : Formats the Input passed by proc mailNewFailures in HTML and sends mail</span>
<span class="comment-line">#Input args:</span>
<span class="comment-line">#     mailInput : input that needs to be formatted</span>
<span class="comment-line">#     regression_id : regression id</span>
<span class="comment-line">#     feature_id : feature_id</span>
<span class="comment-line">#     module : module name</span>
<span class="comment-line">#     build : current build</span>
<span class="comment-line">#     baseLine : base line build</span>
<span class="comment-line">#     cfg : cfg file name</span>
<span class="comment-line">#Output args: None</span>
<span class="comment-line">#Category : Utility</span>
<span class="comment-line">#################################################################################################################</span>

<strong><a name="::::mailHtmlFormat_4369">proc <a href="mysqlLib.tcl-annot.html#::::mailHtmlFormat">::::mailHtmlFormat</a></a></strong> {args} {
     <a name="::parse_args(41)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> mailHtmlFormat $args {
     mailInput &#34;&#34;
     regression_id &#34;&#34;
     feature_id &#34;&#34;
     module &#34;&#34;
     build &#34;&#34;
     baseLine &#34;&#34;
     cfg &#34;&#34;
     }
     global mysqlIP
     global my_db

     set connection [<a name="::conn_to_db(18)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $mysqlIP $my_db]
     global mysql_handler
     set feature_name [mysqlsel $mysql_handler &#34;SELECT feature_name FROM feature_table WHERE feature_id = \&#34;$feature_id\&#34;&#34; -flatlist]
     set aa_id [mysqlsel $mysql_handler &#34;SELECT aa_id FROM feature_table WHERE feature_id = \&#34;$feature_id\&#34;&#34; -flatlist]
     set feature_owner [mysqlsel $mysql_handler &#34;SELECT aa_first_name,aa_last_name FROM aa_table WHERE aa_id = \&#34;$aa_id\&#34;&#34; -flatlist]
     set feature_owner [split $feature_owner &#34;,&#34;]
     set aa_mail [mysqlsel $mysql_handler &#34;SELECT aa_email FROM aa_table WHERE aa_id = \&#34;$aa_id\&#34;&#34; -flatlist]
    
     set fp [open &#34;Tmp/tmpMsgFile_[pid].html&#34; &#34;w+&#34;]
     puts $fp &#34;MIME-Version: 1.0&#34;
     puts $fp &#34;Content-type: text/html; charset=iso-8859-1&#34;
     puts $fp &#34;subject: New failures in Module $module on platform $cfg&#34;
     puts $fp &#34;To : $aa_mail&#34;
     puts $fp &#34;Cc : sqaauto@extremenetworks.com&#34;
     puts $fp &#34;&lt;html&gt;&#34;
     puts $fp &#34;&lt;body&gt;&#34;
     puts $fp &#34;&lt;br&gt;&lt;b&gt;&lt;font size=\&#34;4\&#34; color= \&#34;#000000\&#34;&gt; Module:&lt;/font&gt; &lt;font size =\&#34;4\&#34;color = \&#34;#FF0000\&#34;&gt; ${module}&lt;/font&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;font size=\&#34;4\&#34; color =\&#34;#000000\&#34;&gt; Feature Owner:&lt;/font&gt;&lt;font size = \&#34;4\&#34; color = \&#34;#FF0000\&#34;&gt; [lindex $feature_owner 0] [lindex $feature_owner 1]&lt;/font&gt;&lt;/b&gt;&amp;nbsp;&lt;br/&gt;&#34;
     puts $fp &#34;&lt;br&gt;&lt;b&gt;&lt;font size = \&#34;4\&#34; color = \&#34;#000000\&#34;&gt; cfg:&lt;/font&gt;&lt;font size =\&#34;4\&#34; color = \&#34;#FF0000\&#34;&gt; ${cfg}&lt;/font&gt;&lt;/b&gt;&amp;nbsp;&lt;br/&gt;&#34;
     puts $fp &#34;&lt;br&gt;&lt;b&gt;&lt;font size=\&#34;4\&#34; color= \&#34;#000000\&#34;&gt; Build:&lt;/font&gt; &lt;font size =\&#34;4\&#34;color = \&#34;#FF0000\&#34;&gt; ${build}&lt;/font&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;font size=\&#34;4\&#34; color =\&#34;#000000\&#34;&gt; Base Line Build:&lt;/font&gt;&lt;font size = \&#34;4\&#34; color = \&#34;#FF0000\&#34;&gt; ${baseLine}&lt;/font&gt;&lt;/b&gt;&amp;nbsp;&lt;br/&gt;&#34;
     puts $fp &#34;&amp;nbsp;&lt;br/&gt;&#34;
     puts $fp &#34;&lt;table border=\&#34;3\&#34; bordercolor=\&#34;black\&#34; cellpadding=\&#34;10\&#34; &gt;&#34;
     puts $fp &#34;&lt;tr&gt;&#34;
     puts $fp &#34;&lt;td&gt; &lt;b&gt;&lt;font size = \&#34;4\&#34; color = \&#34;#000000\&#34;&gt;New Failures&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;&#34;
     puts $fp &#34;&lt;td&gt;&lt;b&gt;&lt;font size = \&#34;4\&#34; color = \&#34;#000000\&#34;&gt; Base Line&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;&#34;
     puts $fp &#34;&lt;/tr&gt;&#34;
     foreach ele $mailInput {
         puts $fp &#34;&lt;tr&gt;&#34; 
         puts $fp &#34;&lt;td&gt; &lt;A href=\&#34;http://autowebrdu/phpdb4/displayDoubleLog4.php?regression_id=${regression_id}&amp;feature_id=${feature_id}&amp;feature_test_script_name=[lindex $ele 0]&amp;&amp;log_id_list=[lindex $ele 1]&amp;first_log_id=0&amp;second_log_id=0&amp;feature_name=${feature_name}\&#34;&gt;&lt;b&gt;&lt;font size = \&#34;3\&#34; color = \&#34;#FF0000\&#34;&gt;[lindex $ele 0]&lt;/font&gt;&lt;/b&gt;&lt;/A&gt;&lt;/td&gt;&#34;
         puts $fp &#34;&lt;td&gt;&lt;b&gt;&lt;font size = \&#34;3\&#34; color = \&#34;#000000\&#34;&gt;[lindex $ele 2]&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;&lt;/tr&gt;&#34;
     }

     puts $fp &#34;&lt;/table&gt;&#34;
     puts $fp &#34;&lt;/body&gt;&#34;
     puts $fp &#34;&lt;/html&gt;&#34;
     close $fp
 
     exec cat Tmp/tmpMsgFile_[pid].html | /usr/sbin/sendmail -t
     exec rm -f Tmp/tmpMsgFile_[pid].html

}    
        
<strong><a name="::::validateBaseLine_4423">proc <a href="mysqlLib.tcl-annot.html#::::validateBaseLine">::::validateBaseLine</a></a></strong> {build} {
  global mysqlIP
  global my_db


  set connection [<a name="::conn_to_db(19)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $mysqlIP $my_db]
  if {$connection != 0} {
     puts &#34;unable to connect to DB&#34;
     return -1
  }
  global mysql_handler
  set build_ele [split $build &#34;,&#34;]
  
  set len [llength $build_ele]
  set val &#34;&#34;
  foreach ele $build_ele {
  set build_list [<a name="::convBuild(4)"><a href="./mysqlLib.tcl.html#::convBuild_4211">::convBuild</a></a> $ele]
  set build_minor_release [lindex $build_list 0]
  set build_number [lindex $build_list 1]
  set build_id [mysqlsel $mysql_handler &#34;SELECT build_id FROM build_table WHERE build_minor_release = \&#34;$build_minor_release\&#34; AND build_number = \&#34;$build_number\&#34;&#34; -flatlist]
   if {$build_id != &#34;&#34;} {
       lappend val $build_id
   }
  }
  
  if {[llength $val] != $len} {
      return -1
  } else {
      return 1

  }

}
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::GetNumAvailableIxiaPorts_4460">proc <a href="mysqlLib.tcl-annot.html#::::GetNumAvailableIxiaPorts">::::GetNumAvailableIxiaPorts</a></a></strong> {} {

    set inputargs [http_formatQuery]
    set sdnHostURL &#34;http://otps/sdn/getixiacardcount.php&#34;
    set sdnHostURL [append sdnHostURL &#34;?$inputargs&#34;]
    <span class="comment-line">#puts &#34;sdnHostURL $sdnHostURL&#34;</span>
    set token [http_get $sdnHostURL -timeout 1000000 ]

    puts stderr &#34;&#34;
    upvar #0 $token state
    puts &#34;\nTotal available: $state(body)&#34;;
    return $state(body)
}
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::GetAvailableIxiaPort_4477">proc <a href="mysqlLib.tcl-annot.html#::::GetAvailableIxiaPort">::::GetAvailableIxiaPort</a></a></strong> {available cfg portid} {

    set available 1
    set inputargs [http_formatQuery available $available cfg $cfg portid $portid]
    set sdnHostURL &#34;http://otps/sdn/getixiacard.php&#34;
    set sdnHostURL [append sdnHostURL &#34;?$inputargs&#34;]
    <span class="comment-line">#puts &#34;sdnHostURL $sdnHostURL&#34;</span>
    set token [http_get $sdnHostURL -timeout 1000000 ]

    puts stderr &#34;&#34;
    
    upvar #0 $token state

    puts &#34;\noutput: $state(body)&#34;
    return $state(body)
}
   
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::InsertSDNLink_4498">proc <a href="mysqlLib.tcl-annot.html#::::InsertSDNLink">::::InsertSDNLink</a></a></strong> {ixia_sw_port tor_sw_port vmantag} {

    set inputargs [http_formatQuery ixia_sw_port $ixia_sw_port tor_sw_port $tor_sw_port vmantag $vmantag]
    set sdnHostURL &#34;http://otps/sdn/insert_link.php&#34;
    set sdnHostURL [append sdnHostURL &#34;?$inputargs&#34;]
    <span class="comment-line">#puts &#34;sdnHostURL $sdnHostURL&#34;</span>
    set token [http_get $sdnHostURL -timeout 1000000 ]

    puts stderr &#34;&#34;

    upvar #0 $token state

    puts &#34;output: $state(body)&#34;
    return $state(body)
    <span class="comment-line">#puts &#34;status $state(status)&#34;</span>
}
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::GetAvailableVmans_4518">proc <a href="mysqlLib.tcl-annot.html#::::GetAvailableVmans">::::GetAvailableVmans</a></a></strong> {} {

    set inputargs [http_formatQuery]
    set sdnHostURL &#34;http://otps/sdn/get_vman_port.php&#34;
    set sdnHostURL [append sdnHostURL &#34;?$inputargs&#34;]
    <span class="comment-line">#puts &#34;sdnHostURL $sdnHostURL&#34;</span>
    set token [http_get $sdnHostURL -timeout 1000000 ]

    puts stderr &#34;&#34;

    upvar #0 $token state

    <span class="comment-line">#puts &#34;output: $state(body)&#34;</span>
    return $state(body)
    <span class="comment-line">#puts &#34;status $state(status)&#34;</span>
}
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::SetIxiaPortNotAvailable_4538">proc <a href="mysqlLib.tcl-annot.html#::::SetIxiaPortNotAvailable">::::SetIxiaPortNotAvailable</a></a></strong> {ixia_switch ixia_switch_port cfg} {
    global IxiaDynPortIdSetup
    set inputargs [http_formatQuery ixia_switch $ixia_switch ixia_switch_port $ixia_switch_port cfg $cfg]
    set sdnHostURL &#34;http://otps/sdn/update_ixia_notavailable.php&#34;
    set sdnHostURL [append sdnHostURL &#34;?$inputargs&#34;]
    <span class="comment-line">#puts &#34;sdnHostURL $sdnHostURL&#34;</span>
    set token [http_get $sdnHostURL -timeout 1000000 ]

    puts stderr &#34;&#34;

    upvar #0 $token state

    <span class="comment-line">#puts &#34;output: $state(body)&#34;</span>
    return $state(body)
    <span class="comment-line">#puts &#34;status $state(status)&#34;</span>
}
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::SetIxiaPortAvailable_4558">proc <a href="mysqlLib.tcl-annot.html#::::SetIxiaPortAvailable">::::SetIxiaPortAvailable</a></a></strong> {ixia_switch ixia_switch_port} {

    set inputargs [http_formatQuery ixia_switch $ixia_switch ixia_switch_port $ixia_switch_port]
    set sdnHostURL &#34;http://otps/sdn/update_ixia_available.php&#34;
    set sdnHostURL [append sdnHostURL &#34;?$inputargs&#34;]
    <span class="comment-line">#puts &#34;sdnHostURL $sdnHostURL&#34;</span>
    set token [http_get $sdnHostURL -timeout 1000000 ]

    puts stderr &#34;&#34;

    upvar #0 $token state

    <span class="comment-line">#puts &#34;output: $state(body)&#34;</span>
    return $state(body)
    <span class="comment-line">#puts &#34;status $state(status)&#34;</span>
}
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::TestBedSupportsSDNL1_4578">proc <a href="mysqlLib.tcl-annot.html#::::TestBedSupportsSDNL1">::::TestBedSupportsSDNL1</a></a></strong> {cfg} {
    set inputargs [http_formatQuery cfg $cfg]
    set sdnHostURL &#34;http://otps/sdn/check_cfg_available.php&#34;
    set sdnHostURL [append sdnHostURL &#34;?$inputargs&#34;]
    <span class="comment-line">#puts &#34;sdnHostURL $sdnHostURL&#34;</span>
    set token [http_get $sdnHostURL -timeout 1000000 ]

    puts stderr &#34;&#34;

    upvar #0 $token state

    <span class="comment-line">#puts &#34;output: $state(body)&#34;</span>
    return $state(body)
    <span class="comment-line">#puts &#34;status $state(status)&#34;</span>
}
<span class="comment-line">##########################################################################</span>
<strong><a name="::::VerifyNumIxiaPortsRequiredOK_4594">proc <a href="mysqlLib.tcl-annot.html#::::VerifyNumIxiaPortsRequiredOK">::::VerifyNumIxiaPortsRequiredOK</a></a></strong> {portsNeeded {CHECKLOOPLIMIT 60}} {
    set loop 1
    while {1} {

        set nP [<a name="::GetNumAvailableIxiaPorts(1)"><a href="./mysqlLib.tcl.html#::GetNumAvailableIxiaPorts_4460">::GetNumAvailableIxiaPorts</a></a>]
        if {$nP &gt;= $portsNeeded} {
            <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;We have $portsNeeded ... Continue&#34;
            return $nP
        } else {
            <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Not enough ports: $portsNeeded ... Only $nP&#34;
            <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10
        }
        if {$loop &gt; $CHECKLOOPLIMIT} {
            <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;We Could not get enough ports in $CHECKLOOPLIMIT secs DIE&#34;
            global IxiaDynPortIdSetup
            if {[array exists IxiaDynPortIdSetup]} {
                puts &#34;\n@@@\n@@@\nCleaning up using IxiaDynPortIdSetup()&#34;
                for {set u 1} {$u&lt;=12} {incr u} {
                    if {![info exists IxiaDynPortIdSetup($u)]} {
                        continue
                    }
                    puts &#34;---- Cleaning up using $IxiaDynPortIdSetup($u)&#34;
                    if {[info exists IxiaDynPortIdSetup($u)]} {
                        set listIn [split $IxiaDynPortIdSetup($u) &#34;_&#34;]
                        set tagId  [lindex $listIn 0]
                        set ixa [lindex $listIn 1]
                        set tor [lindex $listIn 2]

                        puts &#34;Time to delete a vman TOR switch&#34;
                        LoginSDNL1 &#34;TOR&#34; 1
                        <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vman vman$tagId&#34;
                        puts &#34;Time to delete a vman IXIA switch&#34;
                        LoginSDNL1 &#34;IXIA&#34; 1
                        <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vman vman$tagId&#34;
                        <a name="::SetIxiaPortAvailable(1)"><a href="./mysqlLib.tcl.html#::SetIxiaPortAvailable_4558">::SetIxiaPortAvailable</a></a> 1 $ixa
                    }
                }
                array unset IxiaDynPortIdSetup
                puts &#34;@@@\n@@@&#34;
            }
            exit;
        }
        incr loop
    }
}
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Perform all actions required to reserve an Ixia port based on portId</span>
<span class="comment-line"># passed in</span>
<span class="comment-line">#</span>
<span class="comment-line"># ReserveSDNL1PortId $portId </span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::ReserveSDNL1PortId_4649">proc <a href="mysqlLib.tcl-annot.html#::::ReserveSDNL1PortId">::::ReserveSDNL1PortId</a></a></strong> {portId} {
   global DUTPortMappingArray
   global ixiaPortMappingArray ixiaCh1
   global IxiaDynPortIdSetup
   global configurationFile
   global L1

   set myCfgList [split $configurationFile &#34;.&#34;]
   set mycfg [lindex $myCfgList 0]
   set newList [split $mycfg &#34;/&#34;]
   set mycfg [lindex $newList 1]
   if {![<a name="::TestBedSupportsSDNL1(1)"><a href="./mysqlLib.tcl.html#::TestBedSupportsSDNL1_4578">::TestBedSupportsSDNL1</a></a> $mycfg]} {
       return
   }
   puts &#34;\nCFG File: $configurationFile  Short = $mycfg&#34;
   if {![info exists IxiaDynPortIdSetup($portId)] &amp;&amp; [array exists ixiaPortMappingArray]} {
       if {![<a name="::acquire_lock(1)"><a href="./autolock.tcl.html#::acquire_lock_109">::acquire_lock</a></a> $L1]} {
           set s [expr 20 + [<a name="::random(2)"><a href="./mysqlLib.tcl.html#::random_1092">::random</a></a> 10]]
           puts &#34;\n!!!\nCould not aquire lock.. Sleeping $s seconds&#34;
           <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $s
       } else {
           puts &#34;\n#!#!\nGOT the LOCK .... Configure vman&#34;
       }
       <a name="::VerifyNumIxiaPortsRequiredOK(1)"><a href="./mysqlLib.tcl.html#::VerifyNumIxiaPortsRequiredOK_4594">::VerifyNumIxiaPortsRequiredOK</a></a> 1 30
       set res1 [<a name="::GetAvailableIxiaPort(1)"><a href="./mysqlLib.tcl.html#::GetAvailableIxiaPort_4477">::GetAvailableIxiaPort</a></a> 1 $mycfg $portId]
       set retList [split $res1 &#34;:&#34;]
       puts &#34;\n@@@\nGive Me Ixia portId $portId \
             (ixiaPortMappingArray($portId) OLD $ixiaPortMappingArray($portId)) \
              NEW [lindex $retList 0]&#34;
       <span class="comment-line">#&#34;$chassis $card ${port}:$ixia_switch_port:$tor_sw_port&#34;;</span>
       puts &#34;Ixia List: [lindex $retList 0]&#34;
       puts &#34;Ixia_SW Port: [lindex $retList 1]&#34;
       puts &#34;TOR_SW Port: [lindex $retList 2]&#34;
       puts &#34;New ixiaCh1: $ixiaCh1 New list: [lindex $retList 0]&#34;
       puts [<a name="::SetIxiaPortNotAvailable(1)"><a href="./mysqlLib.tcl.html#::SetIxiaPortNotAvailable_4538">::SetIxiaPortNotAvailable</a></a> 1 [lindex $retList 1] $mycfg]
       set tagId [<a name="::random(3)"><a href="./mysqlLib.tcl.html#::random_1092">::random</a></a> 4091]
       set IxiaDynPortIdSetup($portId) &#34;${tagId}_[lindex $retList 1]_[lindex $retList 2]&#34;
       puts &#34;HAVE TO SKIP. Setting ixiaPortMappingArray($portId) to \&#34;[lindex $retList 0]\&#34;&#34;
       set ixiaPortMappingArray($portId) &#34;[lindex $retList 0]&#34;

       <span class="comment-line">#Test this out to see how it works</span>
       IxiaOnePortInit $portId
<span class="comment-line">#     set retVal1 [port config -MacAddress [GetPortIdMac $portId]]</span>
<span class="comment-line">#     result_debug &#34;Port Mac address config retVal is $retVal1.&#34;</span>
<span class="comment-line">#     set retVal2 [port set [lindex $retList 0]]</span>
<span class="comment-line">#     result_debug &#34;Port Mac address set retVal is $retVal2.&#34;</span>
<span class="comment-line">#     set retVal3 [port write [lindex $retList 0]]</span>
<span class="comment-line">#     result_debug &#34;Port Mac address write retVal is $retVal3.&#34;</span>
       <span class="comment-line"># End test</span>

       puts &#34;Time to create a vman TOR switch&#34;
       LoginSDNL1 &#34;TOR&#34; 1
       <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vman vman$tagId&#34;
       <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vman vman$tagId tag $tagId&#34;
       <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vman vman$tagId add port [lindex $retList 2] untag&#34;
       <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vman vman$tagId add port 43 tag&#34;
       puts &#34;Time to create a vman IXIA switch&#34;
       LoginSDNL1 &#34;IXIA&#34; 1
       <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vman vman$tagId&#34;
       <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vman vman$tagId tag $tagId&#34;
       <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vman vman$tagId add port [lindex $retList 1] untag&#34;
       <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vman vman$tagId add port 43 tag&#34;
       <span class="comment-line"># Hack to avoid race conditions</span>
       <a name="::release_lock(1)"><a href="./autolock.tcl.html#::release_lock_141">::release_lock</a></a> $L1
       <a name="::verify_release_lock(1)"><a href="./autolock.tcl.html#::verify_release_lock_166">::verify_release_lock</a></a> $L1
       global whichDutNow
       global DUT${whichDutNow}_CONNECT
       <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECT]
       <span class="comment-line">#puts [SetIxiaPortNotAvailable 1 [lindex $retList 1] $mycfg]</span>
       <span class="comment-line">#set IxiaDynPortIdSetup($portId) &#34;${tagId}_[lindex $retList 1]_[lindex $retList 2]&#34;</span>
       <span class="comment-line">#puts &#34;HAVE TO SKIP. Setting ixiaPortMappingArray($portId) to \&#34;[lindex $retList 0]\&#34;&#34;</span>
       <span class="comment-line">#set ixiaPortMappingArray($portId) &#34;[lindex $retList 0]&#34;</span>
     <span class="comment-line">#  puts &#34;@@@\n@@@&#34;</span>
     <span class="comment-line">#  set getLinkUpdateDB [RequestIxiaCard $portId]</span>
     <span class="comment-line">#  if {$getLinkUpdateDB &lt; 0} {</span>
     <span class="comment-line">#      result_debug &#34;\n\nDid not get an ixia port setup.  What to do now?&#34;</span>
     <span class="comment-line">#  }</span>
   } elseif {[array exists ixiaPortMappingArray]} {
       <span class="comment-line">#puts &#34;\n@@@\n@@@\nDon't need a portId... set already&#34;</span>
       <span class="comment-line">#puts &#34;Port is already set for $portId: $IxiaDynPortIdSetup($portId)&#34;</span>
       <span class="comment-line">#puts &#34;@@@\n@@@&#34;</span>
   }
}
<span class="comment-line">##########################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::GetSDNL1Console_4736">proc <a href="mysqlLib.tcl-annot.html#::::GetSDNL1Console">::::GetSDNL1Console</a></a></strong> {type id} {

    set inputargs [http_formatQuery type $type id $id]
    set sdnHostURL &#34;http://otps/sdn/get_console.php&#34;
    set sdnHostURL [append sdnHostURL &#34;?$inputargs&#34;]
    <span class="comment-line">#puts &#34;sdnHostURL $sdnHostURL&#34;</span>
    set token [http_get $sdnHostURL -timeout 1000000 ]

    puts stderr &#34;&#34;

    upvar #0 $token state

    puts &#34;output: $state(body)&#34;
    return $state(body)
    <span class="comment-line">#puts &#34;status $state(status)&#34;</span>
}
<span class="comment-line">############################################################################</span>
<span class="comment-line"># Proc to save runRegAll commands to the database so they can be relaunched</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">############################################################################</span>
<strong><a name="::::InsertCommandLineCalls_4757">proc <a href="mysqlLib.tcl-annot.html#::::InsertCommandLineCalls">::::InsertCommandLineCalls</a></a></strong> {args} {
    <a name="::parse_args(42)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> InsertCommandLineCalls $args {
        script &#34;&#34;
        aVal   &#34;&#34;
    }

    global mysqlIP my_db mysql_handler MAIN
    if {![info exists mysqlIP] || ![info exists my_db] || ![info exists MAIN(STORECMDS)] || !$MAIN(STORECMDS)} {
        return
    }
    if [catch {mysqlconnect -host $mysqlIP -user regression_user -password extreme -db $my_db} myHandle] {
        puts &#34;Could not connect to the db -host $mysqlIP -user regression_user -password extreme -db $my_db&#34;
        return
    }
    puts &#34;Connected to db -host $mysqlIP -user regression_user -password extreme -db $my_db&#34;

    <span class="comment-line"># Replace sql chars with dummies.. can't find tcl add slashes</span>
    set aVal [string map {&#34;\&#34;&#34; &#34;DQDQ&#34;} $aVal]
    set aVal [string map {&#34;'&#34; &#34;SQSQ&#34;} $aVal]
    set aVal [string map {&#34;,&#34; &#34;QCQ&#34;} $aVal]
    <span class="comment-line"># fix on output with later tool</span>
    <span class="comment-line">#set inq [string map {&#34;DQDQ&#34; &#34;\&#34;&#34;} $inq]</span>
    <span class="comment-line">#set inq [string map {&#34;SQSQ&#34; &#34;'&#34;} $inq]</span>
    <span class="comment-line">#set inq [string map {&#34;QCQ&#34;  &#34;,&#34;} $inq]</span>

    set insert_clause [append insert_clause &#34;insert into reg_executions &#34;]
    set insert_clause [append insert_clause &#34;(command) &#34;]

    set insert_clause [append insert_clause &#34;values (\&#34;$script $aVal\&#34;)&#34;]

    puts $insert_clause
    if [catch {mysqlexec  $myHandle $insert_clause} oops] {
        puts &#34;Storage of the kickoff command failed: $oops&#34;
    }
    catch {mysqlclose $myHandle} result
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
