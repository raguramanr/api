<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>spirentStreams.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#spirentStreams.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>spirentStreams.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="spirentStreams.tcl-annot.html">annotations</a> | <a href="spirentStreams.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
global CURRENT_STREAM_ARRAY
global MAX_STREAMS

set MAX_STREAMS 255
set CURRENT_STREAM_ARRAY(1) 1
set CURRENT_STREAM_ARRAY(2) 1
set CURRENT_STREAM_ARRAY(3) 1
set CURRENT_STREAM_ARRAY(4) 1
set CURRENT_STREAM_ARRAY(5) 1
set CURRENT_STREAM_ARRAY(6) 1
set CURRENT_STREAM_ARRAY(7) 1
set CURRENT_STREAM_ARRAY(8) 1


<span class="comment-line">###########################################################################################</span>
<span class="comment-line"># Name : saveExisitingStreams { portlist}</span>
<span class="comment-line"># Description : retrieves the exisiting streams on the port and changes there state to disable</span>
<span class="comment-line">#              portn: on the given port portn, </span>
<span class="comment-line">#              CURRENT_STREAM_ARRAY : global variable which saves current stream for each port</span>
<span class="comment-line">#              The calling proc will add the new stream at CURRENT_STREAM_ARRAY</span>
<span class="comment-line"># return value : -1 there is problems in configuring the stream</span>
<span class="comment-line">#              :  1 the streams are successfully configured</span>
<span class="comment-line"># typical usage: saveExisitingStreams [list &#34;1 2 3&#34;]</span>
<span class="comment-line">###########################################################################################</span>
<strong><a name="::::saveExisitngStreams_25">proc <a href="spirentStreams.tcl-annot.html#::::saveExisitngStreams">::::saveExisitngStreams</a></a></strong> { portlist} {
   foreach port [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portlist] {
      <a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $port
      set ids [<a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get StreamBlock -under $port]
      <a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform StreamBlockActivateCommand -activate FALSE -StreamBlockList $ids
   }
}


<strong><a name="::::createStreams_34">proc <a href="spirentStreams.tcl-annot.html#::::createStreams">::::createStreams</a></a></strong> { args} {
   puts &#34;[lindex [info level 0] 0] : $args&#34;
   global MAX_STREAMS
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> createStreams $args {
      portn &#34;&#34;
      startId &#34;1&#34;
      endId &#34;1&#34;
      name  &#34;TestStream&#34;
      type &#34;&#34;
      writeToHw &#34;1&#34;
   }
   set txPort [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portn]
   for {set i $startId} {$i &lt;= $endId} {incr i} {
      <span class="comment-line"># remove the sb if it already exists</span>
      if {![catch {set sb [<a name="::getStreamBlockFromName(1)"><a href="./spirentStreams.tcl.html#::getStreamBlockFromName_330">::getStreamBlockFromName</a></a> $txPort sb_${txPort}_${i}]}]} {
         <a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $sb
      }
      set stream_args {-frameLengthMode FIXED -FixedFrameLength 128 -filltype Constant\
                          -ConstantFillPattern 0x1234 -frameconfig {} -insertSig FALSE }
      set hStreamBlock [eval logcmd stc::create streamBlock -under $txPort $stream_args -name sb_${txPort}_${i}]
      <span class="comment-line">#set hLoadProfile [getStreamLoadProfile $hStreamBlock]</span>
      <span class="comment-line">#logcmd stc::config $hLoadProfile -loadunit FRAMES_PER_SECOND -Load [getRateFromPct 1]</span>
      set hEthernet [<a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ethernet:EthernetII -under $hStreamBlock -name sb1_eth \
                        -srcMac [<a name="::GetDefaultPortIdMAC(1)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $txPort] \
                        -dstMac 00:DE:BB:00:00:02]
      

      switch -glob -- $type {
         <a name="::vlan(1)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> {
            <a name="::addDefaultPDU(1)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $hStreamBlock vlan
         }
         *_arp {
            <a name="::addDefaultPDU(2)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $hStreamBlock arp
         }
         *_tcp {           
            set hIpv4 [<a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                          -sourceAddr 0.0.0.0 -destAddr 0.0.0.0 -ttl 64 -identification 0 -protocol 6]    
            <a name="::addDefaultPDU(3)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $hStreamBlock tcp
         }
         *_udp {
            set hIpv4 [<a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                          -sourceAddr 0.0.0.0 -destAddr 0.0.0.0 -ttl 64 -identification 0 -protocol 17]
            <a name="::addDefaultPDU(4)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $hStreamBlock udp
         }
         *_icmp {
            set hIpv4 [<a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                          -sourceAddr 0.0.0.0 -destAddr 0.0.0.0 -ttl 64 -identification 0 -protocol 1]
            <a name="::addDefaultPDU(5)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $hStreamBlock icmp
         }
         *_igmp {
            set hIpv4 [<a name="::logcmd(9)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                          -sourceAddr 0.0.0.0 -destAddr 0.0.0.0 -ttl 64 -identification 0 -protocol 2]
            <a name="::addDefaultPDU(6)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $hStreamBlock igmp
            set hIgmp [<a name="::logcmd(10)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create igmp:Igmpv2 -under $hStreamBlock -groupAddress 0.0.0.0 \
                             -maxRespTime 100 -type 0x11 -name sb_igmp]
         }
         *_dhcp {
            set hIpv4 [<a name="::logcmd(11)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                          -sourceAddr 0.0.0.0 -destAddr 0.0.0.0 -ttl 64 -identification 0 -protocol 17]
            set hUdp [<a name="::logcmd(12)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create udp:Udp -under $hStreamBlock -name sb_udp\
                         -destPort 67 -sourcePort 68]
            <a name="::addDefaultPDU(7)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $hStreamBlock dhcp
         }
         *_rip {
            set hIpv4 [<a name="::logcmd(13)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                          -sourceAddr 0.0.0.0 -destAddr 0.0.0.0 -ttl 64 -identification 0 -protocol 2]
            <a name="::logcmd(14)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hIpv4 -protocol 17
            <a name="::addDefaultPDU(8)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $hStreamBlock rip
         }
      }
   }
   <a name="::logcmd(15)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $txPort.Generator.GeneratorConfig -SchedulingMode PORT_BASED -LoadUnit FRAMES_PER_SECOND
   <a name="::logcmd(16)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
}
      
<span class="comment-line">###########################################################################################</span>
<span class="comment-line"># Name : setStreamOptions { portn startId endId optionVal}</span>
<span class="comment-line"># Description : Configures the option of the already configured stream</span>
<span class="comment-line">#              on the given port portn, </span>
<span class="comment-line">#              starting from id=startId to id=endId</span>
<span class="comment-line">#              optionVal : list of option Value pairs to be set on the stream</span>
<span class="comment-line">#              { {name newStream} {dma  advance} {percentPacketRate  23.0} {fpsRate 1488.0952381} ...}</span>
<span class="comment-line">#</span>
<span class="comment-line"># return value : -1 there is problems in configuring the stream</span>
<span class="comment-line">#              :  1 the streams are successfully configured</span>
<span class="comment-line"># typical usage: setStreamOptions -portn 1 -startId 1 -startId 3</span>

<span class="comment-line">###########################################################################################</span>
<strong><a name="::::setStreamOptions_122">proc <a href="spirentStreams.tcl-annot.html#::::setStreamOptions">::::setStreamOptions</a></a></strong> { args} {
<span class="comment-line">#   puts &#34;[lindex [info level 0] 0] : $args&#34;</span>
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setStreamOptions $args {
      portn &#34;&#34;
      startId &#34;1&#34;
      endId &#34;1&#34;
      optionVal {}
      type &#34;stream&#34;
      writeToHw &#34;1&#34;
   }
   set txPort [<a name="::hMapPortIdToSpirentPort(3)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portn]
   
   for {set i $startId} {$i &lt;= $endId} {incr i} {
      set sb [<a name="::getStreamBlockFromName(2)"><a href="./spirentStreams.tcl.html#::getStreamBlockFromName_330">::getStreamBlockFromName</a></a> $txPort sb_${txPort}_${i}]
      foreach optval $optionVal {
         set opt [lindex $optval 0] ; set val [lindex $optval 1]
         <a name="::modifyStream(1)"><a href="./spirentStreams.tcl.html#::modifyStream_144">::modifyStream</a></a> $sb $type $opt $val $txPort
      }
   }
   <a name="::logcmd(17)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
}

<strong><a name="::::modifyStream_144">proc <a href="spirentStreams.tcl-annot.html#::::modifyStream">::::modifyStream</a></a></strong> {sb type arg val port} {
   puts &#34;[lindex [info level 0] 0] : $sb $type $arg $val&#34;
   set blocks [<a name="::logcmd(18)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -children]
   array set x [string tolower [<a name="::getObjToModify(1)"><a href="./spirentStreams.tcl.html#::getObjToModify_220">::getObjToModify</a></a> $type $arg $val $sb]]
   parray x
   switch [string tolower $x(-objtype)] {
      streamblock {
         <a name="::logcmd(19)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $sb -$x(-item) $x(-value)
      }
      generator {
         if {$x(-item) == &#34;load_perc&#34;} {
             set size [<a name="::logcmd(20)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -FixedFrameLength]
             set v [<a name="::getRateFromPct(1)"><a href="./spirentStreams.tcl.html#::getRateFromPct_390">::getRateFromPct</a></a> $x(-value) $size]
             <a name="::setStcGenerator(1)"><a href="./spirentStreams.tcl.html#::setStcGenerator_271">::setStcGenerator</a></a> $port fixedload $v
         } else {
             <a name="::setStcGenerator(2)"><a href="./spirentStreams.tcl.html#::setStcGenerator_271">::setStcGenerator</a></a> $port $x(-item) $x(-value)
         }
      }
      loadprofile {
         if {$x(-item) == &#34;load&#34; &amp;&amp; $arg != &#34;fpsrate&#34;} {
            set size [<a name="::logcmd(21)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -FixedFrameLength]
            <a name="::logcmd(22)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::getStreamLoadProfile(1)"><a href="./spirentStreams.tcl.html#::getStreamLoadProfile_338">::getStreamLoadProfile</a></a> $sb] -$x(-item) [<a name="::getRateFromPct(2)"><a href="./spirentStreams.tcl.html#::getRateFromPct_390">::getRateFromPct</a></a> $x(-value) $size]
            <a name="::logcmd(23)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::getStreamLoadProfile(2)"><a href="./spirentStreams.tcl.html#::getStreamLoadProfile_338">::getStreamLoadProfile</a></a> $sb]
         } else {
            <a name="::logcmd(24)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::getStreamLoadProfile(3)"><a href="./spirentStreams.tcl.html#::getStreamLoadProfile_338">::getStreamLoadProfile</a></a> $sb] -$x(-item) $x(-value)
            <a name="::logcmd(25)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::getStreamLoadProfile(4)"><a href="./spirentStreams.tcl.html#::getStreamLoadProfile_338">::getStreamLoadProfile</a></a> $sb]
         }
      }
      <a name="::vlan(2)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> {
         set ethpdu [lindex [<a name="::logcmd(26)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -children] [lsearch [<a name="::logcmd(27)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -children] *eth*]]
         set vlanpdu [lindex [<a name="::logcmd(28)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::logcmd(29)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ethpdu -children-vlans] -children-vlan] 0]
         switch [string tolower $arg] {
            enable802dot1qtag {
               if {$vlanpdu == {} &amp; $x(-value) == &#34;true&#34; } {
                  <a name="::addDefaultPDU(9)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $sb vlan
               } elseif { $vlanpdu != {} &amp; $x(-value) == &#34;false&#34; } {
                  <a name="::logcmd(30)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $vlanpdu
               }
            }
            default {
               <a name="::logcmd(31)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $vlanpdu -$x(-item) $x(-value)
               <a name="::logcmd(32)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $vlanpdu
            }
         }
      }
      {} { <span class="comment-line"># do nothing if empty string </span>}
      default {
         set pdus [<a name="::logcmd(33)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -children]
         set loc [lsearch $pdus *eth*]
         lappend pdus [<a name="::logcmd(34)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [lindex $pdus $loc] -children-vlans]
         <span class="comment-line"># check to see if the PDU is there if not create it.</span>
         if {[set loc [lsearch -glob [string tolower $pdus] $x(-objtype)*]] &lt; 0} {
            <a name="::addDefaultPDU(10)"><a href="./spirentStreams.tcl.html#::addDefaultPDU_346">::addDefaultPDU</a></a> $sb $x(-objtype)
            set pdus [<a name="::logcmd(35)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -children]
            set loc end
         }
         puts &#34;OBJ  $x(-objtype)&#34; 
         puts &#34;ITEM $x(-item)&#34; 
         puts &#34;VAL  $x(-value)&#34;
         if { $x(-objtype) != {} } {

            <span class="comment-line"># handle special case of ethertype 8100 must be applied to vlan NOT ethernet</span>
            <span class="comment-line">#  the reverse part is handled by the getObjToModify table</span>
            set ethpdu [lindex [<a name="::logcmd(36)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -children] [lsearch [<a name="::logcmd(37)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -children] *eth*]]
            set vlanpdu [lindex [<a name="::logcmd(38)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::logcmd(39)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ethpdu -children-vlans] -children-vlan] 0]
            if {$x(-objtype) == &#34;ethernet:ethernetii&#34; &amp; $x(-item) == &#34;ethertype&#34; &amp; $x(-value) == &#34;8100&#34; &amp; $vlanpdu != {}} {
               stc::config $vlanpdu -type 8100
               return
            }

            <a name="::logcmd(40)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [lindex $pdus $loc] -$x(-item) $x(-value)
         }
      }
   }
}

<strong><a name="::::getObjToModify_220">proc <a href="spirentStreams.tcl-annot.html#::::getObjToModify">::::getObjToModify</a></a></strong> {type arg val sb} {
   <span class="comment-line">#streamRateModeFps</span>
   puts &#34;[lindex [info level 0] 0] : $sb $type $arg $val&#34;
   <span class="comment-line"># Add to this as needed</span>
   <span class="comment-line">#                  type     item                stcObjType            stcObjOption function</span>
   set x  [list \
      [list stream   frametype           ethernet:EthernetII  ethertype       {join $val {}}]\
      [list stream   sa                  ethernet:EthernetII  srcmac          {join $val :}]\
      [list stream   numSA               {}                   {}              {<a name="::modifyMacAddrs(1)"><a href="./spirent.tcl.html#::modifyMacAddrs_3595">::modifyMacAddrs</a></a> -stream $sb -saMode increment -saCount $val -numFrames $val}]\
      [list stream   saRepeatCounter     {}                   {}              {}]\
      [list stream   da                  ethernet:EthernetII  dstmac          {join $val :}]\
      [list stream   numDA               {}                   {}              {<a name="::modifyMacAddrs(2)"><a href="./spirent.tcl.html#::modifyMacAddrs_3595">::modifyMacAddrs</a></a> -stream $sb -daMode increment -daCount $val -numFrames $val}]\
      [list stream   daRepeatCounter     {}                   {}              {}]\
      [list protocol enable802dot1qTag   vlan                 enable          {}]\
      [list vlan     vlanID              vlan                 id              {expr &#34;0x$val&#34; + 0}]\
      [list vlan     protocolTagId       ethernet:EthernetII  ethertype       {join $val {}}]\
      [list stream   enable              streamblock          active          {}]\
      [list stream   percentPacketRate   generator            load_perc       {}]\
      [list stream   rateMode            generator            LoadUnit        {}]\
      [list stream   framesize           streamblock          FixedFrameLength {}]\
      [list stream   frameSizeType       streamblock          FrameLengthMode {<a name="::getStcFrameKey(1)"><a href="./spirentStreams.tcl.html#::getStcFrameKey_311">::getStcFrameKey</a></a> $val}]\
      [list stream   frameSizeMIN        streamblock          MinFrameLength  {}]\
      [list stream   frameSizeMAX        streamblock          MaxFrameLength  {}]\
      [list stream   loopCount           {}                   {}              {}]\
      [list stream   fpsrate             generator            fixedload       {}]\
      [list stream   dma                 generator            durationmode    {}]\
      [list ip       sourceIpAddr        ipv4:ipv4            sourceAddr      {}]\
      [list ip       sourceIpAddrMode    {}                   {}              {}]\
      [list ip       sourceIpAddrRepeatCount {}               {}              {<a name="::modifyIpAddrs(1)"><a href="./spirent.tcl.html#::modifyIpAddrs_3522">::modifyIpAddrs</a></a> -stream $sb -ipSaMode increment -ipSaCount $val}]\
      [list ip       destIpAddr          ipv4:ipv4            destAddr        {}]\
      [list ip       destIpAddrMode      {}                   {}          {}]\
      [list ip       destIpAddrRepeatCount {}                 {}          {<a name="::modifyIpAddrs(2)"><a href="./spirent.tcl.html#::modifyIpAddrs_3522">::modifyIpAddrs</a></a> -stream $sb -ipDaMode increment -ipDaCount $val}]\
      [list stream   numFrames           loadprofile          burstSize   {}]\
      [list arp      sourceProtocolAddr  arp:ARP              senderPAddr {}]\
      [list arp      destProtocolAddr    arp:ARP              targetPAddr {}]\
      [list arp      sourceHardwareAddr  arp:ARP              senderHwAddr {join $val :}]\
      [list arp      destHardwareAddr    arp:ARP              targetHwAddr {join $val :}]\
   ]
   if {[set loc [lsearch [string tolower $x] &#34;[string tolower [list $type $arg]] *&#34;]] &lt; 0} {
      error &#34;STC Stream Modify fail: $type $arg $val&#34;
   }
   set objtype [lindex [lindex $x $loc] 2]
   set item    [lindex [lindex $x $loc] 3]
   set valcalc [lindex [lindex $x $loc] 4]
   
   if {$valcalc != {}} {
      puts &#34;OK DOING THIS : $valcalc&#34;
      set val [eval $valcalc]
   } 
   return &#34;-objtype \{$objtype\} -item \{$item\} -value \{$val\}&#34;
}
<strong><a name="::::setStcGenerator_271">proc <a href="spirentStreams.tcl-annot.html#::::setStcGenerator">::::setStcGenerator</a></a></strong> {txPort opt val} {
    switch [string tolower $opt] {
        &#34;durationmode&#34; {
            switch -glob [string tolower $val] {
                stop* {
                    lappend gen_args -DurationMode BURSTS
                }
                cont*  {
                    lappend gen_args -DurationMode CONTINUOUS -duration 30
                }
                default { error &#34;Unsupported streamType = $streamType&#34; }
            }
        }
        &#34;loadunit&#34; {
            lappend gen_args -LoadUnit [<a name="::getStcRateKey(1)"><a href="./spirentStreams.tcl.html#::getStcRateKey_295">::getStcRateKey</a></a> $val]
        }
        &#34;fixedload&#34; {
            lappend gen_args -FixedLoad $val
        }
    }
    set hGeneratorConfig [eval logcmd stc::config $txPort.Generator.GeneratorConfig $gen_args]
    <span class="comment-line"># Apply changes.</span>
    <a name="::logcmd(41)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
}
<strong><a name="::::getStcRateKey_295">proc <a href="spirentStreams.tcl-annot.html#::::getStcRateKey">::::getStcRateKey</a></a></strong> {val} {
    switch [string tolower $val] {
        -re &#34;fps&#34; {
            return FRAMES_PER_SECOND;
        }
        &#34;streamratemodefps&#34; {
            return FRAMES_PER_SECOND;
        }
        -re &#34;perc&#34; {
            return PERCENT_LINE_RATE;
        }
        default {
            return PERCENT_LINE_RATE;
        }
    }
}
<strong><a name="::::getStcFrameKey_311">proc <a href="spirentStreams.tcl-annot.html#::::getStcFrameKey">::::getStcFrameKey</a></a></strong> {val} {
    switch [string tolower $val] {
        -re &#34;fix&#34; {
            return FIXED;
        }
        -re &#34;rand&#34; {
            return RANDOM;
        }
        -re &#34;inc&#34; {
            return INCR;
        }
        -re &#34;dec&#34; {
            return DECR;
        }
        default {
            return FIXED;
        }
    }
}
<strong><a name="::::getStreamBlockFromName_330">proc <a href="spirentStreams.tcl-annot.html#::::getStreamBlockFromName">::::getStreamBlockFromName</a></a></strong> {<a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> name} {
   set portstreams [<a name="::logcmd(42)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $port -children-Streamblock]
   foreach sb $portstreams {
      if {[<a name="::logcmd(43)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -name] == $name} {return $sb}
   }
   error &#34;Could not find stream name $name on port $port&#34;
}

<strong><a name="::::getStreamLoadProfile_338">proc <a href="spirentStreams.tcl-annot.html#::::getStreamLoadProfile">::::getStreamLoadProfile</a></a></strong> {name} {
   set lps [<a name="::logcmd(44)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get project1 -children-streamblockloadprofile]
   foreach lp $lps {
      if {[lsearch [<a name="::logcmd(45)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $lp -affiliationstreamblockloadprofile-Sources] $name] &gt;= 0} {return $lp}
   }
   error &#34;Could not find loadprofile for stream name $name&#34;
}

<strong><a name="::::addDefaultPDU_346">proc <a href="spirentStreams.tcl-annot.html#::::addDefaultPDU">::::addDefaultPDU</a></a></strong> {sb pdutype} {
   puts &#34;[lindex [info level 0] 0] : $sb $pdutype&#34;
   switch -glob -- [string tolower $pdutype] {         
      *vlan* {
         set hEthernet [lindex [<a name="::logcmd(46)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $sb -children] 0]
         set vlanlen [<a name="::addVlans(1)"><a href="./spirent.tcl.html#::addVlans_3663">::addVlans</a></a> -stream $sb -ethobj $hEthernet -wTag true -tagNo 1234]
      }
      *arp* {
         set hArp [<a name="::logcmd(47)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create arp:ARP -under $sb -name sb1_arp -operation 1 \
                      -senderHwAddr 0:0:0:0:0:0 -targetHwAddr 0:0:0:0:0:0 \
                      -senderPAddr 0.0.0.0 -targetPAddr 0.0.0.0]
      }
      *tcp* {
         set hTcp [eval logcmd stc::create tcp:Tcp -under $sb -name tcp\
                      -destPort 0 -sourcePort 0]
      }
      *udp* {
         set hUdp [<a name="::logcmd(48)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create udp:Udp -under $sb -name sb_udp\
                      -destPort 0 -sourcePort 0 -checksum 0]
      }
      *icmp* {
         set hIcmp [<a name="::logcmd(49)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create icmp:IcmpEchoReply -under $sb -name icmp\
                       -code 0 -type $type -identifier 0 -seqNum 0]
      }
      *igmp* {
         set hIgmp [<a name="::logcmd(50)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create igmp:Igmpv2 -under $sb -groupAddress 0.0.0.0 \
                       -maxRespTime 100 -type 0x11 -name sb_igmp]
      }
      *dhcp* {
         set hDhcp [<a name="::logcmd(51)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create dhcp:Dhcpclientmsg -under $sb -name sb_dhcp\
                       -clientAddr $clientIpAddr -clientMac 00:00:00:00:00:00 \
                       -elapsed 0 -haddrLen 6 -hardwareType 1 \
                       -hops 0 -messageType 1 -xid 0 -yourAddr 0.0.0.0 ]
      }
      *rip* {
         set riphdr [<a name="::logcmd(52)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create custom:Custom -under $sb -name sb_rip \
                        -pattern [set riphex [<a name="::makeRipHeader(1)"><a href="./spirent.tcl.html#::makeRipHeader_3773">::makeRipHeader</a></a> -ripCommand 1 \
                                                 -ripVersion 2 - -destPort 0 \
                                                 -sourcePort 0 -checksum 0xd409]]]
      }
      default { error &#34;Could not create default PDU $pdutype&#34; }
   }
}

<strong><a name="::::getRateFromPct_390">proc <a href="spirentStreams.tcl-annot.html#::::getRateFromPct">::::getRateFromPct</a></a></strong> {pct {size 64} {speed 1000}} {
   if {[lindex [split $pct =] 0] == &#34;rate&#34;} {return [lindex [split $pct =] 1]}
   set speed [expr $speed * 1000000]
   set totalLenBits  [expr ($size+12+8)*8]
   set rate [expr ($speed / $totalLenBits) * ($pct / 100.00)]
   if {$rate &gt; 1488095} {set rate 1488095}
   return [expr round($rate)]
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: decidePercentage</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       Decide the ixia percentage given portSpeed, FrameSize,</span>
<span class="comment-line">#       &amp; frameRate</span>
<span class="comment-line"># Input args: {portSpeed} {frameSize} {frameRate}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         set percentage [decidePercentage $txSpeed $frameSize $frameRate]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::decidePercentage_410">proc <a href="spirentStreams.tcl-annot.html#::::decidePercentage">::::decidePercentage</a></a></strong> {{portSpeed 100}
                       {frameSize 64}
                       {frameRate default}} {
   
   set speed [expr $portSpeed * 1000000.0]
   set totalLenBits  [expr ($frameSize+8+12)*8]
   set pct [expr ($totalLenBits * $frameRate * 100)/$speed]
   if {$pct &lt; .001} { return $frameRate }
   return $pct
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
