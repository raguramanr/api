<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>iMainLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#iMainLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>iMainLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="iMainLib.tcl-annot.html">annotations</a> | <a href="iMainLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">####################################################################</span>
<span class="comment-line"># proc myhist</span>
<span class="comment-line">#</span>
<span class="comment-line"># args: -srch - a string to regexp search on</span>
<span class="comment-line">#       -limit - limit the number of lines printed</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># usage:  myhist source    - dumps all previous history commands</span>
<span class="comment-line">#                            that contained source</span>
<span class="comment-line">#</span>
<span class="comment-line">####################################################################</span>
<strong><a name="::::myhist_12">proc <a href="iMainLib.tcl-annot.html#::::myhist">::::myhist</a></a></strong> {args} {
    global env MAIN

    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> myhist $args {
        srch   &#34;none&#34; 
        s      &#34;null&#34;
        limit  &#34;20&#34;
        l      &#34;null&#34;
    }

    if {$l != &#34;null&#34;} {set limit $l;}
    if {$s != &#34;null&#34;} {set srch $s;}

    
    if {[file exists /tmp/imain/$env(USER)_imain_history.txt]} {
        set lTtoB &#34;&#34;
        set hifile [open &#34;/tmp/imain/$env(USER)_imain_history.txt&#34; &#34;r&#34;]
        set hdata [read $hifile]
        close $hifile
        set lines [split $hdata &#34;\n&#34;]
        if {$srch != &#34;none&#34;} {
            set tmplines &#34;&#34;
            foreach sli $lines {
                if {[regexp -nocase &#34;$srch&#34; $sli]} {
                    lappend tmplines $sli
                }
            }
            set lines $tmplines
        }
        set lc [llength $lines]
        set top [expr $lc - 1]
        set s [expr $lc - $limit]
        if {$s&lt;0} {set s 0};<span class="comment-line"># Just in case limit is longer than history file</span>
        set pit 0
        for {set x $top} {$x &gt;= 0} {incr x -1} {
            if {[string trim [lindex $lines $x]] != &#34;&#34;} {
                puts &#34;[lindex $lines $x]&#34;
                incr pit
                if {$pit &gt;= $limit} {
                    return;
                }
            }
        }
        return;
    } else {
        catch {exec touch /tmp/imain/$env(USER)_imain_history.txt} rea
        return;
    }
}
<span class="comment-line">####################################################################</span>
<span class="comment-line"># proc _writeToIHist</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Write the command to the iHist file</span>
<span class="comment-line">####################################################################</span>
<strong><a name="::::_writeToIHist_66">proc <a href="iMainLib.tcl-annot.html#::::_writeToIHist">::::_writeToIHist</a></a></strong> {txt} {
    global env

    set illegalChars &#34;\{|\}|\[|\]&#34;

    set hfile [open &#34;/tmp/imain/$env(USER)_imain_history.txt&#34; &#34;a+&#34;]
    if {[string trim $txt] != &#34;&#34;} {
        if {![regexp -nocase &#34;$illegalChars&#34; $txt]} {
            puts $hfile &#34;$txt&#34;
        }
    }
    close $hfile

}   
<span class="comment-line">####################################################################</span>
<span class="comment-line"># proc ihelp</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">####################################################################</span>
<strong><a name="::::ihelp_85">proc <a href="iMainLib.tcl-annot.html#::::ihelp">::::ihelp</a></a></strong> {} {

    puts &#34;myhist searchterm 10 - use myhist to show previous commands for easy cut and paste&#34;
    puts &#34;imenu - gives a menu of predefined things to do.  Ask for more...&#34;


}
<span class="comment-line">####################################################################</span>
<span class="comment-line"># proc imain_prompt</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Goes to the imain prompt loop.  Allowing execution</span>
<span class="comment-line">#</span>
<span class="comment-line">####################################################################</span>
<strong><a name="::::imain_prompt_98">proc <a href="iMainLib.tcl-annot.html#::::imain_prompt">::::imain_prompt</a></a></strong> {args} {
    global MAIN env

    <a name="::_globalAll(1)"><a href="./iMainLib.tcl.html#::_globalAll_201">::_globalAll</a></a>

    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> imain_prompt $args {
        id   &#34;none&#34;
    }
    if {![file exists /tmp/imain/$env(USER)_imain_history.txt]} {
        catch {exec touch /tmp/imain/$env(USER)_imain_history.txt} rea
    }
    set myInfoLevel   [info level]
    set fromInfoLevel [expr [info level] - 1]

    fconfigure stdin -blocking 1

    puts &#34;\n@@@@\nEntering imain prompt debug\nType \&#34;END\&#34; to continue with the test\nType EXIT to linux\n@@@@&#34;

    puts &#34;\n$id&#34;

    while {1} {
        puts -nonewline &#34;dev&gt; &#34;
        flush stdout;
        set intC [gets stdin]
        if {$intC == &#34;END&#34;} {
            if {$myInfoLevel == [info level]} {
                return;
            } else {
                return -code return -level $fromInfoLevel
            }
        }
        if {$intC == &#34;EXIT&#34;} {
            exit;
        }
        <a name="::_writeToIHist(1)"><a href="./iMainLib.tcl.html#::_writeToIHist_66">::_writeToIHist</a></a> &#34;$intC&#34;
        set stat [catch {eval $intC} cout]
        if {$stat} {
            puts &#34;There was a tcl error $cout&#34;
            <a name="::_imainErrorHelp(1)"><a href="./iMainLib.tcl.html#::_imainErrorHelp_189">::_imainErrorHelp</a></a> $cout
        } else {
            puts &#34;\n$cout&#34;
        }
    }
}
<span class="comment-line">#####################################################################</span>
<span class="comment-line"># proc: _init_All_DUT_info</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#####################################################################</span>
<strong><a name="::::_init_All_DUTs_info_148">proc <a href="iMainLib.tcl-annot.html#::::_init_All_DUTs_info">::::_init_All_DUTs_info</a></a></strong> {} {
    global whichDutNow

    set initDut $whichDutNow
    for {set nDUT 1; global DUT${nDUT}_CONNECT} { [info exists DUT${nDUT}_CONNECT] } \
                                             {incr nDUT ; global DUT${nDUT}_CONNECT} {

            lappend getInfoList  &#34;_get_HW_DUTs_info -dut $nDUT -checkOperational 0&#34;
    }
    <a name="::_setShowOutput(1)"><a href="./SendSwCmd.tcl.html#::_setShowOutput_3101">::_setShowOutput</a></a> -screen off -log off -res_fmt off
    <a name="::MultiTask(1)"><a href="./multiTask.tcl.html#::MultiTask_39">::MultiTask</a></a> $getInfoList
    <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${initDut}_CONNECT] -masterCheck 0 -CheckOperational 0
    <a name="::_setShowOutput(2)"><a href="./SendSwCmd.tcl.html#::_setShowOutput_3101">::_setShowOutput</a></a> -screen on -log on -res_fmt on
}
<span class="comment-line">#####################################################################</span>
<span class="comment-line"># Procedure: iexit</span>
<span class="comment-line">#</span>
<span class="comment-line"># When running in i_main this cleans up the results to Report</span>
<span class="comment-line">#</span>
<span class="comment-line">#####################################################################</span>
<strong><a name="::::iexit_168">proc <a href="iMainLib.tcl-annot.html#::::iexit">::::iexit</a></a></strong> {} {
    global MAIN

    save_incrementally_run_data
    <a name="::create_report_directory(1)"><a href="./result.tcl.html#::create_report_directory_890">::create_report_directory</a></a> $MAIN(sourceFile) no $MAIN(optionalPath) &#34;&#34; $MAIN(subversion) $MAIN(qId)
    <span class="comment-line"># Cleanup all of the main.tcl harness files..move to report dir</span>
    set returnFlag [<a name="::_cleanAndStoreResults(1)"><a href="./maincleanup.tcl.html#::_cleanAndStoreResults_2">::_cleanAndStoreResults</a></a> -returnFlag testSkipped]
    
    <span class="comment-line"># -----------------------------------------------------------------------------</span>
    <span class="comment-line"># Print to stderr so any tracking wrapper can make decisions</span>
    <span class="comment-line"># -----------------------------------------------------------------------------</span>
    puts stderr $returnFlag
    flush stderr
    return -code return exit
}
<span class="comment-line">######################################################################</span>
<span class="comment-line"># Procedure: _imainErrorHelp $cout</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">######################################################################</span>
<strong><a name="::::_imainErrorHelp_189">proc <a href="iMainLib.tcl-annot.html#::::_imainErrorHelp">::::_imainErrorHelp</a></a></strong> {out} {

    if {[regexp -nocase &#34;card&#34; $out]} {
        puts &#34;Usually \&#34;card\&#34; error means ixia is not itialized. Type imenu . Select \&#34;Init Ixia\&#34;&#34;
    }
}
<span class="comment-line">######################################################################</span>
<span class="comment-line"># Procedure: _globalAll</span>
<span class="comment-line">#</span>
<span class="comment-line">#     Pulls all globals into the interactive main scope</span>
<span class="comment-line">#</span>
<span class="comment-line">######################################################################</span>
<strong><a name="::::_globalAll_201">proc <a href="iMainLib.tcl-annot.html#::::_globalAll">::::_globalAll</a></a></strong> {} {
    set varnames [info globals *]
    if {[llength $varnames] != 0} {
        uplevel 1 global $varnames
    }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
