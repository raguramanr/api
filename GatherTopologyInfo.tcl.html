<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>GatherTopologyInfo.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#GatherTopologyInfo.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>GatherTopologyInfo.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="GatherTopologyInfo.tcl-annot.html">annotations</a> | <a href="GatherTopologyInfo.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::GatherAllInfo_2">proc <a href="GatherTopologyInfo.tcl-annot.html#::::GatherAllInfo">::::GatherAllInfo</a></a></strong> { DUTsUsed logfileStr } {

    set numDUT 0
    foreach item $DUTsUsed {
	if { [regexp -nocase DUT $item] } { incr numDUT }
    }

    set protocolTypes {VLAN LOADSHARE ELSM RIP}

    <span class="comment-line"># This will contain all configuration lines for each DUT</span>
    for {set dut 1} {$dut &lt;= $numDUT} {incr dut 1} {
	set allRelevantDUTLines($dut) [<a name="::GatherAllRelevantDUTLines(1)"><a href="./GatherTopologyInfo.tcl.html#::GatherAllRelevantDUTLines_37">::GatherAllRelevantDUTLines</a></a> $logfileStr $dut]
	if { $allRelevantDUTLines($dut) == &#34;TOPOLOGY_INVALID&#34; } {
	    return &#34;TOPOLOGY_INVALID&#34;
	}
    }

    for {set dut 1} {$dut &lt;= $numDUT} {incr dut 1} {
	foreach prot $protocolTypes {
	    set TopologyInfo(DUT$dut,$prot) [Gather[set prot]TopologyInfo $allRelevantDUTLines($dut)]
	}
    }

    puts &#34;\nnumDUT='$numDUT'&#34;

    for {set dut 1} {$dut &lt;= $numDUT} {incr dut 1} {
	foreach prot $protocolTypes {
	    lappend allList &#34;DUT[set dut]_[set prot] $TopologyInfo(DUT$dut,$prot)&#34;
	}
    }
    puts &#34;\nallList='$allList'&#34;

    return $allList
}

<strong><a name="::::GatherAllRelevantDUTLines_37">proc <a href="GatherTopologyInfo.tcl-annot.html#::::GatherAllRelevantDUTLines">::::GatherAllRelevantDUTLines</a></a></strong> { logfileStr dut } {
    for { set i 0 } { $i &lt;= [llength $logfileStr] } { incr i } {
	set line [lindex $logfileStr $i]
	if { ![regexp &#34;\\\[\\\[\\\[\\\[ Login on device.*DUT$dut.*\\\]\\\]\\\]\\\]&#34; $line] } {
	    continue
	} else {
	    for { set j [expr $i+1] } { $j &lt;= [llength $logfileStr] } { incr j } {
		set line [lindex $logfileStr $j]
		if { ([regexp &#34;\\\[\\\[\\\[\\\[ Login on device.*DUT.*\\\]\\\]\\\]\\\]&#34; $line]) &amp;&amp; \
			(![regexp &#34;\\\[\\\[\\\[\\\[ Login on device.*DUT$dut.*\\\]\\\]\\\]\\\]&#34; $line]) } {
		    break
		} else {
		    lappend allDUTLines $line
		}
	    }
	}
    }
    
    if { [info exists allDUTLines] } {
	return $allDUTLines
    } else {
	return &#34;&#34;
    }
}

<strong><a name="::::GatherVLANTopologyInfo_62">proc <a href="GatherTopologyInfo.tcl-annot.html#::::GatherVLANTopologyInfo">::::GatherVLANTopologyInfo</a></a></strong> { buffer } {

    set vlanNum 0
    set totVlans 0

    foreach line $buffer {

	set line [string trim $line]
	if { [regexp &#34;\\\-\\\-\\\- Send &#34; $line] } {
	    set line [string range $line 9 end]
	}

	<span class="comment-line"># Get Vlan Name</span>
	if { [regexp &#34;cr.* vl.* &#34; $line] } {
	    incr vlanNum
	    incr totVlans
	    <span class="comment-line"># What to do if duplicate vlan name created by mistake?</span>
	    <span class="comment-line"># In that case we need error check and not incr $vlanNum and $totVlans</span>
	    set vlan($vlanNum,name) [lindex $line 2]
	    continue
	}

	for { set i 1 } { $i &lt;= $totVlans } { incr i } {
	    if { [info exists vlan($i,name)] } {

		<span class="comment-line"># Get Vlan Tag</span>
		if { [regexp &#34;co.* vl.* $vlan($i,name) *t&#34; $line] } {
		    set vlan($i,tag) [lindex $line 4]
		} elseif { [regexp &#34;co.* $vlan($i,name) *t&#34; $line] } {
		    set vlan($i,tag) [lindex $line 3]
		}

		<span class="comment-line"># Get Vlan Port Numbers</span>
		if { [regexp &#34;co.* vl.* $vlan($i,name).* ad.* po&#34; $line] } {
		    set portNum [join [split [lrange $line 5 end] &#34;,&#34;]]
		    if { ([regexp -nocase &#34;t$&#34; $portNum]) || ([regexp -nocase &#34;tag$&#34; $portNum]) } {
			lappend vlan($i,ports) &#34;[lrange $portNum 0 end-1]&#34;
		    } else {
			lappend vlan($i,ports) &#34;$portNum&#34;
		    }
		} elseif { [regexp &#34;co.* $vlan($i,name).* ad.* po&#34; $line] } {
		    set portNum [join [split [lrange $line 4 end] &#34;,&#34;]]
		    if { ([regexp -nocase &#34;t$&#34; $portNum]) || ([regexp -nocase &#34;tag$&#34; $portNum]) } {
			lappend vlan($i,ports) &#34;[lrange $portNum 0 end-1]&#34;
		    } else {
			lappend vlan($i,ports) &#34;$portNum&#34;
		    }
		}

		<span class="comment-line"># Get Vlan IPAddress</span>
		if { [regexp &#34;co.* vl.* $vlan($i,name).* ipa&#34; $line] } {
		    set vlan($i,ipaddr) [lrange $line 4 end]
		} elseif { [regexp &#34;co.* $vlan($i,name).* ipa&#34; $line] } {
		    set vlan($i,ipaddr) [lrange $line 3 end]
		}

	    }
	}
    }

    <span class="comment-line">#parray vlan</span>

    for { set i 1 } { $i &lt;= $totVlans } { incr i } {
	lappend vline &#34;Name '$vlan($i,name)'&#34;
	if { [info exists vlan($i,tag)] } {
	    lappend vline &#34;Tag '$vlan($i,tag)'&#34;
	}
	if { [info exists vlan($i,ports)] } {
	    lappend vline &#34;Ports '[join $vlan($i,ports)]'&#34;
	}
	if { [info exists vlan($i,ipaddr)] } {
	    lappend vline &#34;IpAddr '$vlan($i,ipaddr)'&#34;
	}
	lappend VLANTopologyInfoLines &#34;[join $vline]&#34;
	unset vline
    }

    if { [info exists VLANTopologyInfoLines] } {
	puts &#34;\nVLANTopologyInfoLines=$VLANTopologyInfoLines&#34;
	return $VLANTopologyInfoLines
    } else {
	return &#34;NO_VLAN_INFO&#34;
    }
}

<strong><a name="::::GatherLOADSHARETopologyInfo_147">proc <a href="GatherTopologyInfo.tcl-annot.html#::::GatherLOADSHARETopologyInfo">::::GatherLOADSHARETopologyInfo</a></a></strong> { buffer } {

    set LSgroup 0
    set totLS 0

    foreach line $buffer {

	regsub &#34;, *&#34; $line &#34;,&#34; line
	set line [string trim $line]
	if { [regexp &#34;\\\-\\\-\\\- Send &#34; $line] } {
	    set line [string range $line 9 end]
	}

	if { [regexp &#34;^en.* sh.* g&#34; $line] } {
	    incr LSgroup
	    incr totLS
	    set masterPort [lindex $line 2]
	    set groupedPorts [lindex $line 4]
	    set LS($LSgroup,master) $masterPort
	    set LS($LSgroup,grouped) $groupedPorts
	    if { [regexp &#34;en.* sh.* g.* a.* a&#34; $line] } {
		<span class="comment-line"># Address-based sharing</span>
		set LS($LSgroup,algo) &#34;A&#34;
	    } elseif { [regexp &#34;en.* sh.* g.* a.* p&#34; $line] } {
		<span class="comment-line"># Port-based sharing</span>
		set LS($LSgroup,algo) &#34;P&#34;
	    }
	}

	if { [regexp &#34;co.* sh.* a.* p&#34; $line] } {
	    set masterPort [lindex $line 2]
	    set groupedPorts [lindex $line 5]
	    for { set i 1 } { $i &lt;= $totLS } { incr i } {
		if { $LS($i,master) == $masterPort } {
		    lappend LS($i,grouped) &#34;$groupedPorts&#34;
		    break
		}
	    }
	}
    }

    for { set i 1 } { $i &lt;= $totLS } { incr i } {
	set LS($i,grouped) [split [join $LS($i,grouped) &#34;,&#34;] &#34;,&#34;]
    }

    <span class="comment-line">#parray LS</span>

    for { set i 1 } { $i &lt;= $totLS } { incr i } {
	lappend vline &#34;MasPort '$LS($i,master)'&#34;
	if { [info exists LS($i,grouped)] } {
	    lappend vline &#34;GrpPorts '$LS($i,grouped)'&#34;
	}
	if { [info exists LS($i,algo)] } {
	    lappend vline &#34;Algo '$LS($i,algo)'&#34;
	}
	lappend LSTopologyInfoLines &#34;[join $vline]&#34;
	unset vline
    }

    if { [info exists LSTopologyInfoLines] } {
	puts &#34;\nLSTopologyInfoLines=$LSTopologyInfoLines&#34;
	return $LSTopologyInfoLines
    } else {
	return &#34;NO_LOADSHARE_INFO&#34;
    }

}

<strong><a name="::::GatherELSMTopologyInfo_215">proc <a href="GatherTopologyInfo.tcl-annot.html#::::GatherELSMTopologyInfo">::::GatherELSMTopologyInfo</a></a></strong> { buffer } {
    return &#34;NO_ELSM_INFO&#34;

}

<strong><a name="::::GatherRIPTopologyInfo_220">proc <a href="GatherTopologyInfo.tcl-annot.html#::::GatherRIPTopologyInfo">::::GatherRIPTopologyInfo</a></a></strong> { buffer } {

    return &#34;NO_RIP_INFO&#34;
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
