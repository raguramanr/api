<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>tclET_API_Wrapper.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#tclET_API_Wrapper.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>tclET_API_Wrapper.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="tclET_API_Wrapper.tcl-annot.html">annotations</a> | <a href="tclET_API_Wrapper.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##########################################################################</span>
<span class="comment-line">#                                                                        #</span>
<span class="comment-line"># TCL Connect_ET Client API Wrapper                                      #</span>
<span class="comment-line">#                                                                        #</span>
<span class="comment-line">#                                                                        #</span>
<span class="comment-line">#                                                                        #</span>
<span class="comment-line"># There is no need for users of the tcletEnv package                     #</span>
<span class="comment-line">#    to edit this file.                                                  #</span>
<span class="comment-line">#                                                                        #</span>
<span class="comment-line">##########################################################################</span>

<span class="comment-line"># Provides the TCL ET Envelope Package</span>
package provide tcletEnv 0.0

<span class="comment-line"># Create Namespace: tcletEnv</span>
<strong>namespace eval  tcletEnv</strong>  {

<span class="comment-line"># Export the procedure and variable names meant to be used</span>
<span class="comment-line">#    in the user's script.</span>
namespace export port pollWait pollTry \
	loginTime loginDate serverTime serverDate	  	\
        login sockClose newReservation queryReservations  	\
        deleteReservation makeConnection breakConnection  	\
        portStatus getServerTime         			\
        logoutUser getActiveClientList queryAllReservations	\
	getAllConnections chassisStatusList 		  	\
	serverShutdown refreshChassis                     	\
	makeConnectionAgg breakConnectionAgg			\
	getConnectionAttribute getUCList getUCConnectionList	\
	getUCDeviceList getUCPortList				\
        ETlogin2 sendToServer reservationAvailable		\
	getDevicesByAttribute getDeviceMapping getPortMapping	\
	getUcResource getUcForDevice

<span class="comment-line"># If the user whishes to use a different value for the port,</span>
<span class="comment-line">#    pollWait, or pollTry variables then they should write</span>
<span class="comment-line">#    the new &#34;variable&#34; statements in a file called</span>
<span class="comment-line">#    tclET_API_Wrapper_defaults.tcl in the same directory as this script.</span>

<span class="comment-line"># Port that the server is listening on.</span>
variable port 		10000

<span class="comment-line"># Time in miliseconds to wait before polling the server for a response</span>
variable pollWait	100

<span class="comment-line"># Number of times to poll the server for a response before giving up</span>
variable pollTry	900

<span class="comment-line"># Set by the login command to the server's current date (at the</span>
<span class="comment-line">#     time of login)</span>
variable loginDate	&#34;&#34;

<span class="comment-line"># set by the login command to the server's current time (at the</span>
<span class="comment-line">#     time of login)</span>
variable loginTime	&#34;&#34;

<span class="comment-line"># set by the login command to hold the current user name </span>
<span class="comment-line">#     time of login)</span>
variable loginName	&#34;&#34;

<span class="comment-line"># Initialize server time variables incase they are accessed</span>
<span class="comment-line">#   before the first call to getServerTime</span>
variable serverTime	&#34;&#34;
variable serverDate	&#34;&#34;

<span class="comment-line"># Search the auto_path list of directories for the defaults</span>
<span class="comment-line">#    file tclET_API_Wrapper_defaults.tcl.  Stop searching when the</span>
<span class="comment-line">#    first match is found.  </span>
foreach dir $auto_path {
    if {[file exists $dir/tclET_API_Wrapper_defaults.tcl]} {
        source $dir/tclET_API_Wrapper_defaults.tcl
        break
    }
}

<span class="comment-line"># Socket handle first set by ETlogin's return.</span>
<span class="comment-line"># Internal to this file. Should not be accessed by the user's application.</span>
variable Socket -1
 
<span class="comment-line"># Incomming Message Types</span>
<span class="comment-line"># Do not change this table without changing the server's copy of this table.</span>
<span class="comment-line"># Must use capital letters for hex digits.</span>
variable ACK_PACKET 			0x00
variable NAK_PACKET 			0x01
variable CLIENT_CONNECTION_ADD 		0x02
variable CLIENT_CONNECTION_REMOVE 	0x03
variable ACTIVE_CLIENT_LIST 		0x04
variable DB_TRANSACTION 		0x05
variable CONNECTED_SERVER_INFO 		0x07
variable CLIENT_LOGIN_ACCEPTED 		0x08
variable CLIENT_LOGIN_DENIED 		0x09
variable ICON_TRANSFER 			0x0A
variable INTER_CLIENT_MS 		0x0B
variable RESERVE_UC_ACCEPTED 		0x0C
variable RESERVE_UC_DENIED 		0x0D
variable UC_DETAILS 			0x0E
variable RSVN_RESPONSE 			0x0F
variable CONNECTION_CONFIRMATION 	0x10
variable CONNECTION_DENIED 		0x11
variable UC_CONFIG_INFO 		0x12
variable DISCONNECTION_CONFIRMATION 	0x13
variable DISCONNECTION_DENIED 		0x14 
variable PROBE 				0x17
variable CONNECTION_STATUS 		0x18
variable SOCKET_VERIFY_RESPONSE 	0x19
variable CURRENT_CONNECTIONS_RESPONSE	0x1A
variable CHASSIS_STATUS_RESPONSE	0x1B
variable RESOURCE_STATUS_RESPONSE       0x1C
variable SERVER_SHUTDOWN_RESPONSE       0x1D
variable REFRESH_CHASSIS_RESPONSE       0x1E
variable LOGOUT_OTHER_USER_RESPONSE	0x1F
variable FINDUC_RESPONSE		0x20
variable UET_MESSAGE			0x22
variable UC_ACTIVATION_RESPONSE		0x23
variable DEVICE_QUALIFIER_LIST		0x24
variable DEVICE_QUALIFIER_SEARCH_RESULT	0x25
variable DEVICE_LIST			0x26
variable GET_CONNECTON_ATTRIB_RESPONSE  0x27
variable USER_RIGHTS_DEVICE_LIST	0x28
variable DOMAIN_LIST_RESPONSE		0x29
variable ATTRIBUTE_VALUE_RESPONSE	0x30
variable PORT_QUALIFIER_LIST		0x31
variable PORT_LIST			0x32
variable PORT_QUALIFIER_SEARCH_RESULT	0x33
variable PORT_DATA_DISPLAY		0x34
variable DEVICE_NAME_VALUE_RESULT	0x35
variable PORT_NAME_VALUE_RESULT		0x36
variable DEVICE_NAME_VALUE_LIST		0x37
variable DEVICE_NAME_VALUE_SEARCH_LIST	0x38
variable GET_DEVICES_FROM_RSVN_RESP	0x39
variable GET_PORTS_FROM_RSVN_RESP	0x40
variable UCDEVICE_LIST_RESULT		0x41
variable UCDEVICE_PORT_LIST_RESULT	0x42

variable USAGE_CASE_LIST_RESPONSE       0x50
variable DEVICE_PORT_LIST_RESPONSE      0x51
variable UCCONNECTIONS_LIST_RESPONSE    0x52

variable ACTIVE_UC_RESPONSE		0x79
variable GET_DEVICE_RSVN_DATA_RESP	0x80
variable DEVICE_MAPPING_INFO_RESPONSE	0x82
variable UC_RESOURCE_INFO_RESPONSE	0x83
variable GET_UC_FOR_DEVICE_RESPONSE	0x84


<span class="comment-line"># Outbound Message Types</span>
<span class="comment-line"># Do not change this table without changing the server's copy of this table.</span>
<span class="comment-line"># Must use capital letters for hex digits.</span>
variable DATA_ONLY			 0x00 
variable CONNECT_PORTS			 0x01
variable DISCONNECT_PORTS		 0x02
variable CLIENT_CONNECTION_ADD		 0x08
variable CLIENT_CONNECTION_REMOVE	 0x09
variable REQUEST_ACTIVE_CLIENTS_LIST	 0x0A
variable DB_TRANSACTION_REQUEST 	 0x0B
variable CLIENT_LOGIN_REQUEST		 0x0C
variable ICON_TRANSFER_REQUEST		 0x0D
variable INTER_CLIENT_MSG_REQUEST	 0x0E
variable REQUEST_UC_DETAILS		 0x0F
variable RESERVED_UC_ADOPTED		 0x10
variable RESERVATION_REQUEST		 0x11
variable UC_CONFIG_INFO_REQUEST		 0x12
variable USER_PREFERENCES_CHANGE_REQUEST 0x13
variable PROBE_REPLY			 0x14
variable PREVIOUS_SESSIONS_DROP_REQUEST	 0x15
variable CONNECTION_STATUS_REQUEST	 0x16
variable SOCKET_VERIFY_REQUEST           0x17
variable CURRENT_CONNECTIONS_REQUEST     0x18
variable CHASSIS_STATUS_REQUEST          0x19
variable RESOURCE_STATUS_REQUEST         0x1A
variable SERVER_SHUTDOWN_REQUEST         0x1B
variable REFRESH_CHASSIS_REQUEST         0x1C
variable LOGOUT_OTHER_USER_REQUEST       0x1D
variable FIND_USAGECASES		 0x1E
variable UETS_MESSAGE			 0x22      ;<span class="comment-line"># not used</span>
variable UC_ACTIVATION_REQUEST		 0x23
variable DEVICE_QUALIFIER_REQUEST	 0x24
variable DEVICE_QUALIFIER_SEARCH_REQUEST 0x25
variable DEVICE_REQUEST			 0x26 
variable CONN_PROP_REQUEST		 0x27
variable USER_RIGHTS_DEVICE_REQUEST	 0x28
variable DOMAIN_LIST_REQUEST		 0x29
variable RSVN_GET_USED_DEVICE		 0x30		;<span class="comment-line"># Dynamic (1 device)</span>
variable SEARCHED_ATTRIBUTES		 0x31
variable PORT_REQUEST			 0x32
variable PORT_QUALIFIER_REQUEST		 0x33
variable ATTRIBUTE_VALUE_REQUEST	 0x34
variable PORT_QUALIFIER_SEARCH_RESULT	 0x35
variable DEVICE_PORT_NAME_VALUE		 0x36
variable DEVICE_NAME_VALUE_REQUEST	 0x37
variable UCDEVICE_LIST_REQUEST		 0x37
variable UCDEVICE_PORT_LIST_REQUEST	 0x38
variable GET_DEVICES_FROM_RSVN		 0x39		;<span class="comment-line"># Dynamic</span>
variable GET_PORTS_FROM_RSVN		 0x40		;<span class="comment-line"># Dynamic</span>
variable UCDEVICE_LIST_REQUEST		 0x41

variable USAGE_CASE_LIST_REQUEST         0x50
variable DEVICE_PORT_LIST_REQUEST        0x51
variable UCCONNECTIONS_LIST_REQUEST      0x52
variable UCEXPLORER_UPDATE		 0x53

variable LOCK_UCCREATER_INFO		 0x77
variable UPDATE_UCLOCKSTATUS		 0x78
variable ACTIVE_UC_LIST			 0x79
variable GET_DEVICE_RSVN_DATA		 0x80
variable TAP_MONITOR_SESSION_DATA	 0x81
variable DEVICE_MAPPING_INFO_REQUEST	 0x82
variable UC_RESOURCE_INFO_REQUEST	 0x83
variable GET_UC_FOR_DEVICE_REQUEST	 0x84
variable FORCE_CONNECT_PORTS_REQUEST	0x85


<span class="comment-line"># Reservation Request Subtypes</span>
<span class="comment-line"># Do not change this table without changing the server's copy of this table.</span>
variable RSVN_NEW                       0
variable RSVN_CHK_AVAILABILITY          1
variable RSVN_QUERY                     2
variable RSVN_UPDATE                    3
variable RSVN_DELETE                    4
variable RSVN_ADD_ACTIVE                5
variable RSVN_QUERY_ALL                 6
variable RSVN_DELETE_ANY                7
variable RSVN_QUERY_NO_FORM		8
variable RSVN_QUERY_ALL_NO_FORM		9
variable RSVN_NEW_WITH_INFO		10
variable RSVN_CHK_AVAILABILITY_BY_UCNUM 11

<span class="comment-line"># Reservation Subtypes</span>
<span class="comment-line"># Do not change this table without changing the server's copy of this table.</span>
variable RSVN_OK			0
variable RSVN_FAILURE			1
variable RSVN_AVAILABLE			2
variable RSVN_UNAVAILABLE		3
variable RSVN_QUERY_RESP		4
variable RSVN_QUERY_ALL_RESP		5
variable RSVN_UPDATE_OK			6
variable RSVN_UPDATE_FAILURE		7
variable RSVN_DELETE_OK			8
variable RSVN_DELETE_NOT_FOUND		9
variable RSVN_DELETE_USER_NO_MATCH	10
variable RSVN_START_REMINDER		11
variable RSVN_STOP_REMINDER		12
variable RSVN_SESSION_DATA		13
variable RSVN_DELETE_NO_PERMISSION	14
variable RSVN_CONNECT_PORTS_OK		15
variable RSVN_QUERY_NO_FORM_RESP	16
variable RSVN_QUERY_ALL_NO_FORM_RESP	17
variable RSVN_DYNAMIC 18

<span class="comment-line"># Reservation Error Codes</span>
<span class="comment-line"># (changes to this list need to be implemeneted in the newReservation procedure also)</span>
variable RSVN_FAILURE_USER_NOT_FOUND			0
variable RSVN_FAILURE_INVALID_DATE_TIME			1
variable RSVN_FAILURE_USER_NO_PRIVILEGE			2
variable RSVN_FAILURE_USER_NO_DURATION_PRIVILEGE	3
variable RSVN_FAILURE_RESOURCE_IN_USE			4
<span class="comment-line">#variable RSVN_FAILURE_RSVN_NOT_FOUND			5   Not Used</span>
variable RSVN_FAILURE_INVALID_START_TIME		6
variable RSVN_FAILURE_INVALID_END_TIME			7
variable RSVN_FAILURE_DEVICE_UNAVAILABLE_IN_FOLDER	8
variable RSVN_FAILURE_NO_DOMAIN_RIGHTS			9
variable RSVN_FAILURE_RSVN_EXISTS			10
variable RSVN_FAILURE_CANNOT_SUBSTITUTE			11
variable RSVN_FAILURE_NO_FAILURE			12
variable RSVN_FAILURE_INVALID_USAGECASE			13


<span class="comment-line"># Break Connection Subtypes</span>
variable DISCONN_OK				0
variable DISCONN_OK_RES_ENDED			1
variable DISCONN_FAIL_NO_CONN			2
variable DISCONN_FAIL_NO_CONN_RES_ENDED		3

<span class="comment-line"># Character for separating records in a list</span>
variable DELIM_CHAR	\001
variable DELIM_CHAR_2	\002

<span class="comment-line"># Debug Flags</span>
<span class="comment-line"># set tcletEnv::DFlag 0xF  - turns on the debug messages </span>
<span class="comment-line"># 0x1 - Every received msg</span>
<span class="comment-line"># 0x2 - Every received msg after low level reassembly</span>
<span class="comment-line"># 0x4 - Procedure arguments and program flow</span>
<span class="comment-line"># 0x8 - Resource Status Entries</span>
variable DFlag	0x0
variable DFile	&#34;&#34;

<span class="comment-line"># end of name space</span>
}


<span class="comment-line">##########################################################################</span>
<span class="comment-line"># Login into the server.</span>
<span class="comment-line"># Set the Socket variable needed by all subsequent procedures.</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::tcletEnv::login_296">proc <a href="tclET_API_Wrapper.tcl-annot.html#::::tcletEnv::login">::::tcletEnv::login</a></a></strong><a name="::::tcletEnv::login"></a> {user password ip} {
    variable Socket
    variable port
    variable loginDate
    variable loginTime
    variable loginName 
    variable CONNECTED_SERVER_INFO
    variable CLIENT_LOGIN_ACCEPTED
    variable CLIENT_LOGIN_DENIED

    DebugPrint 0x4 &#34;Login: $Socket, $user, $password, $ip&#34;
    if {![string is digit -strict $port]} {
        DebugPrint 0x4 &#34;LOgin: ERROR_INVALID_PORT&#34;
        set loginDate &#34;&#34;
        set loginTime &#34;&#34;
        return ERROR_INVALID_PORT
    }

    set Socket [connectServer $ip $port]
    if {$Socket &lt;= 0} {
        DebugPrint 0x4 &#34;ETlOgin: ERROR_COULD_NOT_CONNECT&#34;
        set Socket -1
        return ERROR_COULD_NOT_CONNECT
    }

    ETlogin2 $user $password $ip $port

    DebugPrint 0x4 &#34;Login: socket number $Socket&#34;
    set resp [WaitForResp $CLIENT_LOGIN_ACCEPTED $CLIENT_LOGIN_DENIED]
    DebugPrint 0x4 &#34;Login: resp $resp&#34;
    if {[string equal &#34;$resp&#34; ERROR_NORESPONSE]} {
        DebugPrint 0x4 &#34;login: ERROR_NORESPONSE 1&#34;
        set loginDate &#34;&#34;
        set loginTime &#34;&#34;
        return ERROR_NORESPONSE
    }
    regexp {^(0x[0-9A-F]+) (.*)} $resp dummy op resp
    if {$op != $CLIENT_LOGIN_ACCEPTED} {
        DebugPrint 0x4 &#34;Login: not authorized $op&#34;
        sockClose
        set loginDate &#34;&#34;
        set loginTime &#34;&#34;
        return ERROR_NOT_AUTHORIZED
    }

    DebugPrint 0x4 &#34;Login: addclient&#34;
    ETaddClient $user
    set resp [WaitForResp $CONNECTED_SERVER_INFO]
    if {[string equal &#34;$resp&#34; ERROR_NORESPONSE]} {
        DebugPrint 0x4 &#34;login: ERROR_NORESPONSE 2&#34;
        set loginDate &#34;&#34;
        set loginTime &#34;&#34;
        return ERROR_NORESPONSE
    }
    regexp {^0x[0-9A-F]+ (.*)} $resp dummy resp

    DebugPrint 0x4 &#34;Login: resp $resp&#34;
    if {[regexp {^[^\^]*\^[^\^]*\^ *(.*)} $resp dummy loginTime]} {
        set loginDate [clock format [clock scan $loginTime] -format %m/%d/%Y]
        set loginTime [clock format [clock scan $loginTime] -format %H:%M:%S]
        DebugPrint 0x4 &#34;Login: date $loginDate time $loginTime&#34;
    } else {
        set loginDate &#34;&#34;
        set loginTime &#34;&#34;
        DebugPrint 0x4 &#34;Login: could not set date and time&#34;
    }
    DebugPrint 0x4 &#34;Login: response $resp&#34;
    set loginName $user
    return $resp
}


<span class="comment-line">##########################################################################</span>
<span class="comment-line"># End the Login Session with the Server.</span>
<span class="comment-line">##########################################################################</span>
<strong><a name="::::tcletEnv::sockClose_371">proc <a href="tclET_API_Wrapper.tcl-annot.html#::::tcletEnv::sockClose">::::tcletEnv::sockClose</a></a></strong><a name="::::tcletEnv::sockClose"></a> {} {
    variable Socket

    if {[string equal $Socket -1]} {
        DebugPrint 0x4 &#34;sockClose: already logged out&#34;
        return
    }

    DebugPrint 0x4 &#34;sockClose: socket# $Socket&#34;
    if {[catch {close $Socket} error]} {
        DebugPrint 0x4 &#34;sockClose: error closing socket: $Socket, $error&#34;
    }
    set Socket -1
    return
}


<span class="comment-line">##########################################################################</span>
<span class="comment-line"># Create a new reservation</span>
<span class="comment-line"># date format: mm/dd/yyyy</span>
<span class="comment-line"># time format: hh:mm</span>
<span class="comment-line"># Putting &#34;9999&#34; in the start dates year field gets a</span>
<span class="comment-line">#   reservation starting at the current time.</span>
<span class="comment-line"># If the start_date and start_time are set to &#34;NOW&#34; </span>
<span class="comment-line">#   then start the reservation at the current time</span>
<span class="comment-line"># Returns the reservation id needed for the tcl_ETDelReservation call.</span>
<span class="comment-line">##########################################################################</span>
