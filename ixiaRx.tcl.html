<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ixiaRx.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ixiaRx.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ixiaRx.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ixiaRx.tcl-annot.html">annotations</a> | <a href="ixiaRx.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

set auto_path [linsert $auto_path 0 . ]

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaCapture</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Start capturing packets for all ports</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#                Chid - chassis id</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      return [ixiaCaptureOnePort $chasis $card $port $fd_res]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::ixiaCapture_22">proc <a href="ixiaRx.tcl-annot.html#::::ixiaCapture">::::ixiaCapture</a></a></strong> {{fd_res &#34;NULL&#34;} \
                  {chid 1}        \
                  {fd_in &#34;NULL&#34;}} {
   global spawn_id
   global one2oneArray

   foreach txMap [lsort [array names one2oneArray]] {
      set rxMap $one2oneArray($txMap)
	  scan $txMap &#34;%d,%d,%d&#34; x y z
      scan [join $rxMap] &#34;%d %d %d&#34; chid c p
      <a name="::capture(1)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> get $chid $c $p
      set numCapFrames [<a name="::capture(2)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> cget -nPackets]
      <a name="::captureBuffer(1)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> get $chid $c $p 1 $numCapFrames

      puts &#34;--- txMap=$txMap rxMap=$rxMap&#34;
      puts $fd_res &#34;--- txMap=$txMap rxMap=$rxMap&#34;
      if { $fd_in != &#34;NULL&#34; } { puts $fd_in &#34;^ $txMap $rxMap&#34; }
      <a name="::stat(1)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chid $c $p
      set uds1 [<a name="::stat(2)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -userDefinedStat1]
      puts &#34;frames sent = [<a name="::stat(3)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
      puts &#34;frames received = [<a name="::stat(4)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
      puts &#34;capture cget -nPackets = $numCapFrames&#34;
      puts $fd_res &#34;frames sent = [<a name="::stat(5)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
      puts $fd_res &#34;frames received = [<a name="::stat(6)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
      puts $fd_res &#34;capture cget -nPackets = $numCapFrames&#34;
      if { $fd_in != &#34;NULL&#34; } { 
         puts $fd_in &#34;[<a name="::stat(7)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
         puts $fd_in &#34;[<a name="::stat(8)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
      }

      for {set i 1} {$i &lt;= $numCapFrames} {incr i} {
         <a name="::captureBuffer(2)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> getframe $i
         puts &#34;captureBuffer cget -frame = [<a name="::captureBuffer(3)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34;
         puts $fd_res &#34;captureBuffer cget -frame = [<a name="::captureBuffer(4)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34;
         if {$fd_in != &#34;NULL&#34;} { puts $fd_in &#34;[<a name="::captureBuffer(5)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34; }
<span class="comment-line">#         puts &#34;captureBuffer cget -timestamp = [captureBuffer cget -timestamp]&#34;</span>
      }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaCaptureOnePort</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Start capturing packets for a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#                Ch - chassis id</span>
<span class="comment-line">#                cd - card id</span>
<span class="comment-line">#                pt - port id  </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#             if file = NULL, it will return a list containing raw captured data</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      return [ixiaCaptureOnePort $chasis $card $port $fd_res]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::ixiaCaptureOnePort_81">proc <a href="ixiaRx.tcl-annot.html#::::ixiaCaptureOnePort">::::ixiaCaptureOnePort</a></a></strong> {{ch 1}          \
                         {cd 1}          \
                         {pt 1}          \
                         {fd_res &#34;NULL&#34;} \
                         {fd_in &#34;NULL&#34;}} {
   set rc [<a name="::capture(3)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> get $ch $cd $pt];
<span class="comment-line">#   puts &#34;capture get returned rc=$rc&#34;;</span>
   set numCapFrames [<a name="::capture(4)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> cget -nPackets];
 <span class="comment-line">#  puts &#34;capture cget -nPackets = $numCapFrames&#34;;</span>
   set rc [<a name="::captureBuffer(6)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> get $ch $cd $pt 1 $numCapFrames];
  <span class="comment-line"># puts &#34;captureBuffer get returned rc=$rc&#34;;</span>
   <span class="comment-line">#puts &#34;--- ($ch $cd $pt)&#34;;</span>
<span class="comment-line">#   if { $fd_res != &#34;NULL&#34; } {</span>
<span class="comment-line">#      puts $fd_res &#34;--- ($ch $cd $pt)&#34;;</span>
<span class="comment-line">#   }</span>
   if { $fd_in != &#34;NULL&#34; } {
    <span class="comment-line">#  puts $fd_in &#34;^ ($ch $cd $pt)&#34;;</span>
   }

   <a name="::stat(9)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $ch $cd $pt;
   set uds1 [<a name="::stat(10)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -userDefinedStat1];
  <span class="comment-line"># puts &#34;frames sent = [stat cget -framesSent]&#34;;</span>
  <span class="comment-line"># puts &#34;frames received = [stat cget -framesReceived]&#34;;</span>
   if { $fd_in != &#34;NULL&#34; } { 
      puts $fd_in &#34;[<a name="::stat(11)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;;
      puts $fd_in &#34;[<a name="::stat(12)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;;
   }

   for {set i 1} {$i &lt;= $numCapFrames} {incr i} {
      set rc [<a name="::captureBuffer(7)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> getframe $i];
    <span class="comment-line">#  puts &#34;captureBuffer getframe returned rc=$rc&#34;;</span>
<span class="comment-line">#      puts &#34;capturebuffer cget -timestamp = [captureBuffer cget -timestamp]&#34;;</span>
     <span class="comment-line"># puts &#34;captureBuffer cget -frame = [captureBuffer cget -frame]&#34;;</span>
      if { $fd_res != &#34;NULL&#34; } {
         puts $fd_res &#34;Traffic on port $pt=[<a name="::captureBuffer(8)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34;;
      }
      if {$fd_in != &#34;NULL&#34;} {
         puts $fd_in &#34;[<a name="::captureBuffer(9)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34;;
      } else {
         lappend rawFrames &#34;[<a name="::captureBuffer(10)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34;;
      }
<span class="comment-line">#      puts &#34;captureBuffer cget -timestamp = [captureBuffer cget -timestamp]&#34;;</span>
   }
   if {$fd_in == &#34;NULL&#34;} {
      if { [ info exists rawFrames ] != &#34;1&#34; } {
         set rawFrames {};
      }
      return $rawFrames;
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaStat</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get Ixia statistics for a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#                Ch - chassis id</span>
<span class="comment-line">#                cd - card id</span>
<span class="comment-line">#                pt - port id  </span>
<span class="comment-line">#                </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#             it will return a list containing statistics for that  port</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      return [ixiaStat $chasis $card $port $fd_res]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::ixiaStat_152">proc <a href="ixiaRx.tcl-annot.html#::::ixiaStat">::::ixiaStat</a></a></strong> {{ch 1}          \
               {cd 1}          \
               {pt 1}          \
               {fd_res &#34;NULL&#34;} \
               {fd_in &#34;NULL&#34;}} {
   global spawn_id

   after 1000
   puts &#34;--- ($ch $cd $pt)&#34;
   puts $fd_res &#34;--- ($ch $cd $pt)&#34;
   if { $fd_in != &#34;NULL&#34; } { puts $fd_in &#34;^ ($ch $cd $pt)&#34; }
   <a name="::capture(5)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> get $ch $cd $pt
   <a name="::stat(13)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $ch $cd $pt
<span class="comment-line">#   set uds1 [stat cget -userDefinedStat1]</span>
   puts &#34;frames sent = [<a name="::stat(14)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
   puts &#34;frames received = [<a name="::stat(15)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
   puts $fd_res &#34;frames sent = [<a name="::stat(16)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
   puts $fd_res &#34;frames received = [<a name="::stat(17)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
   if { $fd_in != &#34;NULL&#34; } { 
      puts $fd_in &#34;[<a name="::stat(18)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
      puts $fd_in &#34;[<a name="::stat(19)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
   }
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaUserDefinedStat1</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Ixia statistics - get a port statistic based on user define stat 1</span>
<span class="comment-line">#     </span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - port id  </span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return $SentReceivedPackets</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [ixiaUserDefinedStat1 $portId $filePt]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::ixiaUserDefinedStat1_195">proc <a href="ixiaRx.tcl-annot.html#::::ixiaUserDefinedStat1">::::ixiaUserDefinedStat1</a></a></strong> {{portId 1}          \
               {fd_res &#34;NULL&#34;} \
               {fd_in &#34;NULL&#34;}} {
   global spawn_id

   after 1000
   <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId ch cd pt
   if {$fd_res != &#34;NULL&#34;} {puts $fd_res &#34;--- ($ch $cd $pt)&#34;}
   if { $fd_in != &#34;NULL&#34; } { puts $fd_in &#34;^ ($ch $cd $pt)&#34; }
   <a name="::capture(6)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> get $ch $cd $pt
   <a name="::stat(20)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $ch $cd $pt
   set frReceived [<a name="::stat(21)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -userDefinedStat1]
   set frSent [<a name="::stat(22)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]
   puts &#34;Frames sent = $frSent&#34;
   if {$fd_res!=&#34;NULL&#34;} {puts $fd_res &#34;Frames sent = $frSent&#34;}
   puts &#34;Total frames received = [<a name="::stat(23)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived] (not used)&#34;
   puts &#34;Filtered frames UDS1 received = $frReceived&#34;
   if {$fd_res!=&#34;NULL&#34;} {puts $fd_res &#34;Filtered frames UDS1 received = $frReceived&#34;}
   if { $fd_in != &#34;NULL&#34; } { 
      puts $fd_in &#34;$frSent&#34;
      puts $fd_in &#34;$frReceived&#34;
   } else {
      set SentReceivedPackets &#34;$frSent $frReceived&#34;
      return $SentReceivedPackets
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaStatFlood</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Ixia statistics - get a port statistics</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#                Ch - chassis id</span>
<span class="comment-line">#                cd - card id</span>
<span class="comment-line">#                pt - port id  </span>
<span class="comment-line">#                fd_res - file pointer</span>
<span class="comment-line">#                fd_in - file pointer</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [ixiaStatFlood $chasis $card $port $fd_res $fd_in]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::ixiaStatFlood_243">proc <a href="ixiaRx.tcl-annot.html#::::ixiaStatFlood">::::ixiaStatFlood</a></a></strong> {{ch 1}          \
                    {cd 1}          \
                    {pt 1}          \
                    {fd_res &#34;NULL&#34;} \
                    {fd_in &#34;NULL&#34;}} {
   global spawn_id

   puts &#34;--- ($ch $cd $pt)&#34;
   puts $fd_res &#34;--- ($ch $cd $pt)&#34;
	if { $fd_in != &#34;NULL&#34; } {
		puts $fd_in &#34;^ ($ch $cd $pt)&#34;
	}
   <a name="::capture(7)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> get $ch $cd $pt
   <a name="::stat(24)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $ch $cd $pt
   puts &#34;frames sent = [<a name="::stat(25)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]\nflooding frames received = [<a name="::stat(26)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -userDefinedStat1]&#34;
   puts $fd_res &#34;frames sent = [<a name="::stat(27)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]\nflooding frames received = [<a name="::stat(28)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -userDefinedStat1]&#34;
   if { $fd_in != &#34;NULL&#34; } { 
      puts $fd_in &#34;[<a name="::stat(29)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
      puts $fd_in &#34;[<a name="::stat(30)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -userDefinedStat1]&#34;
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaPayloadOnePort</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Return statistic on a Ixia's port.</span>
<span class="comment-line">#              It will return the transmit rate or receive rate based on the port </span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#                Ch - chassis id</span>
<span class="comment-line">#                cd - card id</span>
<span class="comment-line">#                pt - port id </span>
<span class="comment-line">#                direction - traffic direction </span>
<span class="comment-line">#                fd_res - file pointer</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              TxRate</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [ixiaPayloadOnePort $chasis $card $port $direction $fd_res]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::ixiaPayloadOnePort_287">proc <a href="ixiaRx.tcl-annot.html#::::ixiaPayloadOnePort">::::ixiaPayloadOnePort</a></a></strong> {{ch 1}            \
                         {cd 1}            \
                         {pt 1}            \
                         {direction &#34;tx&#34;}  \
                         {fd_res &#34;NULL&#34;}} {
   global spawn_id

   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- ($ch $cd $pt)&#34;
<span class="comment-line">#   capture get $ch $cd $pt</span>
   <a name="::stat(31)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $ch $cd $pt
   set txRate [<a name="::stat(32)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]
   set rxRate [<a name="::stat(33)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]

   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;frames sent rate = $txRate\nframes received rate = $rxRate&#34;

   if { $direction == &#34;tx&#34; } {
      return $txRate
   } else {
      return $rxRate
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaCapture_ip</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Capture IP packets for all ports</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#                Chid - chassis id</span>
<span class="comment-line">#                fd_res - file pointer</span>
<span class="comment-line">#                fd_in - file pointer</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#                Return information in a file</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [ixiaCapture_ip $fd_res $chid $fd_in]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::ixiaCapture_ip_328">proc <a href="ixiaRx.tcl-annot.html#::::ixiaCapture_ip">::::ixiaCapture_ip</a></a></strong> {{fd_res &#34;NULL&#34;} \
                     {chid 1}        \
                     {fd_in &#34;NULL&#34;}} {
   global spawn_id
   global one2oneArray

   foreach txMap [lsort [array names one2oneArray]] {
      set rxMap $one2oneArray($txMap)
	  scan $txMap &#34;%d,%d,%d&#34; x y z
      scan [join $rxMap] &#34;%d %d %d&#34; chid c p
      <a name="::capture(8)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> get $chid $c $p
      set numCapFrames [<a name="::capture(9)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> cget -nPackets]
      <a name="::captureBuffer(11)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> get $chid $c $p 1 $numCapFrames

      puts &#34;--- txMap=$txMap rxMap=$rxMap&#34;
      puts $fd_res &#34;--- txMap=$txMap rxMap=$rxMap&#34;
      if { $fd_in != &#34;NULL&#34; } { puts $fd_in &#34;^ $txMap $rxMap&#34; }
      <a name="::stat(34)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chid $c $p
      set uds1 [<a name="::stat(35)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -userDefinedStat1]
      puts &#34;    frames sent = [<a name="::stat(36)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
      puts &#34;    frames received = [<a name="::stat(37)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
      puts &#34;    capture cget -nPackets = $numCapFrames&#34;
      puts $fd_res &#34;    frames sent = [<a name="::stat(38)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
      puts $fd_res &#34;    frames received = [<a name="::stat(39)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
      puts $fd_res &#34;    capture cget -nPackets = $numCapFrames&#34;
      if { $fd_in != &#34;NULL&#34; } { 
         puts $fd_in &#34;[<a name="::stat(40)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
         puts $fd_in &#34;[<a name="::stat(41)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
      }

      for {set i 1} {$i &lt;= $numCapFrames} {incr i} {
         <a name="::captureBuffer(12)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> getframe $i
         puts &#34;    captureBuffer cget -frame = [<a name="::captureBuffer(13)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34;
         puts $fd_res &#34;    captureBuffer cget -frame = [<a name="::captureBuffer(14)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34;
         if {$fd_in != &#34;NULL&#34;} { puts $fd_in &#34;[<a name="::captureBuffer(15)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34; }
      }
      puts &#34;-------------------\n&#34;
      puts $fd_res &#34;-------------------\n&#34;
   }
   puts &#34;\r&#34;
   puts $fd_res &#34;\r&#34;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaCaptureOnePort_ip</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Capture IP packets for a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#                Ch - chassis id</span>
<span class="comment-line">#                cd - card id</span>
<span class="comment-line">#                pt - port id  </span>
<span class="comment-line">#                dList - </span>
<span class="comment-line">#                fd_res - file pointer</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args:  </span>
<span class="comment-line">#                Write information in a file</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [ixiaCaptureOnePort_ip $chasis $card $port $dList $fd_res]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::ixiaCaptureOnePort_ip_392">proc <a href="ixiaRx.tcl-annot.html#::::ixiaCaptureOnePort_ip">::::ixiaCaptureOnePort_ip</a></a></strong> {{ch 1}			 \
                            {cd 1}			 \
                            {pt 1}			 \
		            {dList {}}  	 \
                            {fd_res &#34;NULL&#34;}	 \
						    {fd_in &#34;NULL&#34;}} {
   global spawn_id

   <a name="::capture(10)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> get $ch $cd $pt
   set numCapFrames [<a name="::capture(11)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> cget -nPackets]
   <a name="::captureBuffer(16)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> get $ch $cd $pt 1 $numCapFrames

   puts &#34;--- ($ch $cd $pt)&#34;
   puts $fd_res &#34;--- ($ch $cd $pt)&#34;
   if { $fd_in != &#34;NULL&#34; } { puts $fd_in &#34;^ ($ch $cd $pt)&#34; }

   <a name="::stat(42)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $ch $cd $pt
   set uds1 [<a name="::stat(43)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -userDefinedStat1]
   puts &#34;    frames sent = [<a name="::stat(44)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
   puts &#34;    frames received = [<a name="::stat(45)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
   puts &#34;    capture cget -nPackets = $numCapFrames&#34;
   puts $fd_res &#34;    frames sent = [<a name="::stat(46)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
   puts $fd_res &#34;    frames received = [<a name="::stat(47)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]&#34;
   puts $fd_res &#34;    capture cget -nPackets = $numCapFrames&#34;
   if { $fd_in != &#34;NULL&#34; } { 
      puts $fd_in &#34;[<a name="::stat(48)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]&#34;
      puts $fd_in &#34;[<a name="::capture(12)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> cget -nPackets]&#34;
   }

   for {set i 1} {$i &lt;= $numCapFrames} {incr i} {
      <a name="::captureBuffer(17)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> getframe $i
      puts &#34;    captureBuffer cget -frame = [<a name="::captureBuffer(18)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34;
      puts $fd_res &#34;    captureBuffer cget -frame = [<a name="::captureBuffer(19)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34;
      if {$fd_in != &#34;NULL&#34;} { puts $fd_in &#34;[<a name="::captureBuffer(20)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -frame]&#34; }

      set capframe [<a name="::captureBuffer(21)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> getframe $i]
      <a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> decode $capframe
      foreach item [lsort $dList] {
<a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- item=$item&#34;
		 set value [<a name="::ip(2)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> cget -$item]
         <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;    $item=$value&#34;
         if { $fd_in != &#34;NULL&#34; } { 
            <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;    $item=$value&#34;
		 }
	  }
   }
   puts &#34;\r&#34;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: StartPortsCapture</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Start ports capture</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              none  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [StartPortsCapture $portIdList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::StartPortsCapture_457">proc <a href="ixiaRx.tcl-annot.html#::::StartPortsCapture">::::StartPortsCapture</a></a></strong> {portIdList} {

  <span class="comment-line"># foreach portId $portIdList {</span>
  <span class="comment-line">#    MapIxiaPortId $portId chas card port</span>
  <span class="comment-line">#    ixStartPortCapture  $chas $card $port</span>
  <span class="comment-line">#    puts &#34;ixStartPortCapture  $chas $card $port&#34;      </span>
  <span class="comment-line"># }</span>

  global TrafficGen
  switch -exact -- $TrafficGen {
      agilent {
          ::AgtExtreme::StartPortsCapture -portidlist $portIdList
          return
      }
      stc {
            <span class="comment-line"># Enable capture on each of the ports.</span>
            foreach iPortId $portIdList {
                <span class="comment-line"># Get the capture object. (Automatically created)</span>
                set hCapture [<a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $iPortId] -children-capture]
                
                <span class="comment-line"># Configure capture options.</span>
                <a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hCapture -mode REGULAR_MODE -srcMode TX_RX_MODE  
                
                <span class="comment-line"># Start capturing on the port.</span>
                <a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureStart -captureProxyId $hCapture
            }
            return
      }
      ixia -
      ixvm {
  global portMappingList
  
  <a name="::ClearPortsStats(1)"><a href="./ixiaRx.tcl.html#::ClearPortsStats_696">::ClearPortsStats</a></a> $portIdList

  <a name="::ClearPortsStats(2)"><a href="./ixiaRx.tcl.html#::ClearPortsStats_696">::ClearPortsStats</a></a> $portIdList 

  <span class="comment-line">#foreach p $portIdList {</span>
  <span class="comment-line">#   set portList [lindex $portMappingList [expr $p-1]]</span>
  <span class="comment-line">#   result_debug &#34;INFO: DUT[lindex $portList 2] [lindex $portList 1] egresses to portId [lindex $portList 0]&#34;</span>
  <span class="comment-line">#}</span>
  set delay 0;
  foreach portId $portIdList {
      set speed [<a name="::GetPortIdSpeed(1)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> $portId];
      if {$speed == 40000} {
          set delay 1;
      }
      <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
      lappend plist &#34;$chas $card $port&#34;
  }

  <a name="::ixStartCapture(1)"><a href="./mapping.tcl.html#::ixStartCapture_106">::ixStartCapture</a></a> plist
  if {$delay} {
      <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3;
  }
      }
  }

  

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: StopPortsCapture</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Stop ports capture</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##              [StopPortsCapture $portIdList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::StopPortsCapture_533">proc <a href="ixiaRx.tcl-annot.html#::::StopPortsCapture">::::StopPortsCapture</a></a></strong> {portIdList} {

   <span class="comment-line">#foreach portId $portIdList {</span>
   <span class="comment-line">#   MapIxiaPortId $portId chas card port</span>
   <span class="comment-line">#   ixStopPortCapture  $chas $card $port</span>
   <span class="comment-line">#}</span>

   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           ::AgtExtreme::StopPortsCapture
           return
       }
       stc {
            <span class="comment-line"># Stop capturing on each of the ports.</span>
            foreach iPortId $portIdList {
                <span class="comment-line"># Get the capture object.</span>
                set hCapture [<a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $iPortId] -children-capture]
                
                <span class="comment-line"># Stop capturing on the port.</span>
                <a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureStop -captureProxyId $hCapture
                set TIMESTAMP [clock format [clock seconds] -format %m%d%y%H%M]
                <a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureDataSave -captureProxyId $hCapture -FileName &#34;/tmp/capture-$TIMESTAMP.pcap&#34; -FileNameFormat PCAP
            }
            return
       }
       ixia -
       ixvm {
   foreach portId $portIdList {
     <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
     lappend plist &#34;$chas $card $port&#34;
   }

   <a name="::ixStopCapture(1)"><a href="./mapping.tcl.html#::ixStopCapture_109">::ixStopCapture</a></a> plist
       }
   }

   

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: StopPortsTransmit</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Stop Ports Transmit</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##              [StopPortsCapture $portIdList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::StopPortsTransmit_589">proc <a href="ixiaRx.tcl-annot.html#::::StopPortsTransmit">::::StopPortsTransmit</a></a></strong> {portIdList} {
   <span class="comment-line">#foreach portId $portIdList {</span>
   <span class="comment-line">#   MapIxiaPortId $portId txChas txCard txPort</span>
   <span class="comment-line">#   ixStopPortTransmit  $txChas $txCard $txPort</span>
   <span class="comment-line">#}  </span>
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           ::AgtExtreme::StopPortsTransmit -portidlist $portIdList
           return
       }
       stc {
          set idList {}
          foreach iPortId $portIdList {
             <span class="comment-line"># Retrieve the generator object for the port.</span>
             if {[string is integer $iPortId]} {set iPortId [<a name="::hMapPortIdToSpirentPort(3)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $iPortId]}
             lappend idList [<a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $iPortId -children-Generator]
         }
         <span class="comment-line"># Start the generator.</span>
         <a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStop -GeneratorList $idList
           return
       }
       ixia -
       ixvm {
   foreach portId $portIdList {
     <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
     lappend plist &#34;$chas $card $port&#34;
   }

   <a name="::ixStopTransmit(1)"><a href="./mapping.tcl.html#::ixStopTransmit_100">::ixStopTransmit</a></a> plist
}
   }

   
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: StartPortsTransmit</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Start Ports Transmit</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##             [StartPortsTransmit $portIdList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::StartPortsTransmit_640">proc <a href="ixiaRx.tcl-annot.html#::::StartPortsTransmit">::::StartPortsTransmit</a></a></strong> {portIdList} {
   <span class="comment-line">#foreach portId $portIdList {</span>
   <span class="comment-line">#   MapIxiaPortId $portId txChas txCard txPort</span>
   <span class="comment-line">#   ixStartPortTransmit  $txChas $txCard $txPort</span>
   <span class="comment-line">#}  </span>
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           ::AgtExtreme::StartPortsTransmit -portidlist $portIdList
           return
       }
       stc {
            <span class="comment-line"># Start transmitting on the specified ports.</span>
            foreach iPortId $portIdList {
                <span class="comment-line"># Retrieve the generator object for the port.	</span>
                set hGenerator [<a name="::logcmd(9)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(4)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $iPortId] -children-Generator]
                
                <span class="comment-line"># Start the generator.</span>
                <a name="::logcmd(10)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GeneratorStart -GeneratorList $hGenerator
                
                <span class="comment-line"># Can't use this since rate tests are calculated after this call. There would be no rates </span>
                <span class="comment-line">#	if the traffic had completed.</span>
                <span class="comment-line"># Wait for traffic to stop.  Maximum wait time is 300 seconds.</span>
                <span class="comment-line">#  stc::perform GeneratorWaitForStop -GeneratorList $hGenerator -WaitTimeout 300</span>
            }
            return
       }
       ixia -
       ixvm {
   foreach portId $portIdList {
     <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
     lappend plist &#34;$chas $card $port&#34;
   }

   <a name="::ixStartTransmit(1)"><a href="./mapping.tcl.html#::ixStartTransmit_91">::ixStartTransmit</a></a> plist
}
   }

   
}
       
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ClearPortsStats</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Clear all Ports Stats</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##              [ClearPortsStats $portIdList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################            </span>
<strong><a name="::::ClearPortsStats_696">proc <a href="ixiaRx.tcl-annot.html#::::ClearPortsStats">::::ClearPortsStats</a></a></strong> {portIdList} {
   <span class="comment-line">#foreach portId $portIdList {</span>
   <span class="comment-line">#   MapIxiaPortId $portId txChas txCard txPort</span>
   <span class="comment-line">#   ixClearPortStats $txChas $txCard $txPort</span>
   <span class="comment-line">#}</span>
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           <span class="comment-line"># do nothing, since stats and traffic are tied, so stats</span>
           <span class="comment-line"># get cleared when a test (i.e. traffic) is started</span>
           return
       }
       stc {	
            <span class="comment-line"># Clear all the traffic results for the specified ports.</span>
            <span class="comment-line">#result_debug &#34;\nIn stc ClearPortsStats $portIdList&#34;</span>
            set lstPorts [<a name="::hMapPortIdToSpirentPort(5)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portIdList]
            <a name="::logcmd(11)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform ResultClearAllTraffic -PortList $lstPorts  
            return
       }
       ixia -
       ixvm {
   foreach portId $portIdList {
     <a name="::MapIxiaPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
     lappend plist &#34;$chas $card $port&#34;
   }

   <a name="::ixClearStats(1)"><a href="./mapping.tcl.html#::ixClearStats_124">::ixClearStats</a></a> plist
       }
   }

 

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetCapturedFrames</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the captured frames</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return the captured frames</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetCapturedFrames $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::GetCapturedFrames_746">proc <a href="ixiaRx.tcl-annot.html#::::GetCapturedFrames">::::GetCapturedFrames</a></a></strong> {portId {fd_res &#34;NULL&#34;} {packThreshold 200} } {
<span class="comment-line">#   puts &#34;portId: $portId&#34;</span>
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           <span class="comment-line"># ignore argument 'fd_res', not applicable for Agilent N2X</span>
           return [::AgtExtreme::GetCapturedFrames -portid $portId -threshold $packThreshold]
       }
       stc {
            <span class="comment-line"># Get the capture object.</span>
			
            <a name="::StopPortsCapture(1)"><a href="./ixiaRx.tcl.html#::StopPortsCapture_533">::StopPortsCapture</a></a> $portId
            set hCapture [<a name="::logcmd(12)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(6)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -children-capture]
            set pktCount [<a name="::logcmd(13)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hCapture -PktCount]
			<a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;pktCount $pktCount&#34;
			set packetCaptureData {}
			for {set i 0} {$i &lt; $pktCount} {incr i} {
				array set returnList [<a name="::logcmd(14)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureGetFrameCommand -CaptureProxyId $hCapture -FrameIndex $i]
				set szFrameContents [string range $returnList(-PacketData) 16 end]
				<span class="comment-line">#set szFrameContents [string range $returnList(-PacketData) 0 end]</span>
				set szFrameContents [scan $szFrameContents  [string repeat &#34;%2s&#34; [expr [string length $szFrameContents]/2]]]
				lappend packetCaptureData $szFrameContents
			}
			return $packetCaptureData
			
       }
       ixia -
       ixvm {
       }
   }

   set numRece [<a name="::GetNumFramesReceived(1)"><a href="./ixiaRx.tcl.html#::GetNumFramesReceived_1381">::GetNumFramesReceived</a></a> $portId]
   if {$numRece &gt; $packThreshold} {
      <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;High number of packets ($numRece) captured. \
                    Return without getting any packets&#34;
      return
   }
   <a name="::MapIxiaPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port
      return [<a name="::ixiaCaptureOnePort(1)"><a href="./ixiaRx.tcl.html#::ixiaCaptureOnePort_81">::ixiaCaptureOnePort</a></a> $chasis $card $port $fd_res]
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: DecodeCapturedFrames</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Decode the captured frames using tshark</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port id</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              return the captured frames</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             [GetCapturedFrames $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::DecodeCapturedFrames_802">proc <a href="ixiaRx.tcl-annot.html#::::DecodeCapturedFrames">::::DecodeCapturedFrames</a></a></strong> {portId {packThreshold 200} {<a name="::filter(1)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> &#34;&#34;} } {
   puts &#34;PROC - DecodeCapturedFrames portId: $portId&#34;
   global TrafficGen NTAF_ENABLED

   if {[info exists NTAF_ENABLED] &amp;&amp; $NTAF_ENABLED} {
       <span class="comment-line">#set packThreshold 200</span>
   }
   switch -exact -- $TrafficGen {
       agilent {
           <span class="comment-line"># ignore argument 'fd_res', not applicable for Agilent N2X</span>
           return [::AgtExtreme::GetCapturedFrames -portid $portId -threshold $packThreshold]
       }
       stc {
            <span class="comment-line"># Get the capture object.</span>
            <a name="::StopPortsCapture(2)"><a href="./ixiaRx.tcl.html#::StopPortsCapture_533">::StopPortsCapture</a></a> $portId
            set hCapture [<a name="::logcmd(15)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(7)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -children-capture]
            set pktCount [<a name="::logcmd(16)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hCapture -PktCount]
            <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;pktCount $pktCount&#34;
            set packetCaptureData {}
            for {set i 0} {$i &lt; $pktCount} {incr i} {
                array set returnList [<a name="::logcmd(17)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureGetFrameCommand -CaptureProxyId $hCapture -FrameIndex $i]
                set szFrameContents [string range $returnList(-PacketData) 16 end]
                <span class="comment-line">#set szFrameContents [string range $returnList(-PacketData) 0 end]</span>
                set szFrameContents [scan $szFrameContents  [string repeat &#34;%2s&#34; [expr [string length $szFrameContents]/2]]]
                lappend packetCaptureData $szFrameContents
            }
            set myFrames $packetCaptureData
            set file &#34;/tmp/capture_[pid].txt&#34;
            set pcap &#34;/tmp/capture_[pid].pcap&#34;
            <span class="comment-line">#set lfile &#34;/tmp/capture_list_[pid].txt&#34;</span>
            set fid [open $file w]
            <span class="comment-line">#set lid [open $lfile w]</span>
            <span class="comment-line">#puts $lid &#34;$myFrames\n&#34;;</span>
            <span class="comment-line">#close $lid</span>

            set i 1
            foreach theFrame $myFrames {
                set res {}
                set ctr 0
                while {[string length $theFrame]&gt;48} {
                    set     pos [string wordstart $theFrame 48]
                    lappend res &#34;[format %4.6X $ctr]  [string range $theFrame 0   [expr $pos-1]]&#34;
                    set     theFrame   [string range $theFrame $pos end]
                    incr ctr 16
                }
 
                lappend res &#34;[format %4.6X $ctr]  $theFrame&#34;
                set theFrame [join $res &#34;\n&#34;]
                puts $fid &#34;\n$theFrame &#34;;
                if {$i==$packThreshold} {
                    break
                }
            }
  
            close $fid
            if [catch {exec text2pcap $file $pcap} reason] {
                <span class="comment-line">#puts &#34;Error running text2pcap: $reason&#34;</span>
            }
            if {$filter != &#34;NULL&#34;} {
                set filterString &#34; $filter&#34;
            } else {
                set filterString &#34;&#34;
            }
            if [catch {exec tshark -r $pcap -n -V $filterString} reason] {
                puts &#34;$reason&#34;
            } else {
                puts $reason
            }
            catch {file delete $file} x
            catch {file delete $pcap} y
     ` }
       ixia -
       ixvm {
       }
       ept {
       }
       default {
       }
   }
   set numRece [<a name="::GetNumFramesReceived(2)"><a href="./ixiaRx.tcl.html#::GetNumFramesReceived_1381">::GetNumFramesReceived</a></a> $portId]
   if {$numRece &gt; $packThreshold} {
      <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;High number of packets ($numRece) captured. \

                    Return without getting any packets&#34;
      return
   }
   <a name="::MapIxiaPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port
   if {[info exists NTAF_ENABLED] &amp;&amp; $NTAF_ENABLED} {
       set myFrames [<a name="::ixiaCaptureOnePort(2)"><a href="./ixiaRx.tcl.html#::ixiaCaptureOnePort_81">::ixiaCaptureOnePort</a></a> $chasis $card $port NULL]
       set file &#34;/tmp/capture_[pid].txt&#34;
       set pcap &#34;/tmp/capture_[pid].pcap&#34;
       <span class="comment-line">#set lfile &#34;/tmp/capture_list_[pid].txt&#34;</span>
       set fid [open $file w]
       <span class="comment-line">#set lid [open $lfile w]</span>
       <span class="comment-line">#puts $lid &#34;$myFrames\n&#34;;</span>
       <span class="comment-line">#close $lid</span>
       set i 1
       foreach theFrame $myFrames {
           set res {}
           set ctr 0
           while {[string length $theFrame]&gt;48} {
               set     pos [string wordstart $theFrame 48]
               lappend res &#34;[format %4.6X $ctr]  [string range $theFrame 0   [expr $pos-1]]&#34;
               set     theFrame   [string range $theFrame $pos end]
               incr ctr 16
           }
           
           lappend res &#34;[format %4.6X $ctr]  $theFrame&#34;
           set theFrame [join $res &#34;\n&#34;]
           puts $fid &#34;\n$theFrame &#34;;
           if {$i==$packThreshold} {
               break
           }
           incr i
       }

       close $fid
       if [catch {exec text2pcap $file $pcap} reason] {
           <span class="comment-line">#puts &#34;Error running text2pcap: $reason&#34;</span>
       }
       if {$filter != &#34;NULL&#34;} {
           set filterString &#34; $filter&#34;
       } else {
           set filterString &#34;&#34;
       }
       if [catch {exec tshark -r $pcap -n -V $filterString} reason] {
           puts &#34;$reason&#34;
       } else {
           puts $reason
       }
       catch {file delete $file} x
       catch {file delete $pcap} y
      <span class="comment-line"># return [ixiaCaptureOnePort $chasis $card $port $fd_res]</span>
   } else {
   return [<a name="::ixiaCaptureOnePort(3)"><a href="./ixiaRx.tcl.html#::ixiaCaptureOnePort_81">::ixiaCaptureOnePort</a></a> $chasis $card $port $fd_res]
}
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetCapturedFramesTimeStamp</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the captured frames time stamp</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return the captured frames time stamp</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##             [GetCapturedFramesTimeStamp $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::GetCapturedFramesTimeStamp_955">proc <a href="ixiaRx.tcl-annot.html#::::GetCapturedFramesTimeStamp">::::GetCapturedFramesTimeStamp</a></a></strong> {portId {fd_res &#34;NULL&#34;}} {
<span class="comment-line">#  puts &#34;portId: $portId&#34;</span>
   <a name="::MapIxiaPortId(9)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port
   return [<a name="::ixiaCapturedFramesTimeStamp(1)"><a href="./ixiaRx.tcl.html#::ixiaCapturedFramesTimeStamp_1965">::ixiaCapturedFramesTimeStamp</a></a> $chasis $card $port $fd_res]
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetCapturedFramesTimeStampIndexed</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the captured frames time stamp</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:  indexList - List of index numbers &#34;1 4 9 10&#34;</span>
<span class="comment-line">#              portId - Port id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return a list of captured frames time stamps</span>
<span class="comment-line">#              for the indexes input.  Time is the 6 MSDigits</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##             [GetCapturedFramesTimeStampIndexed $indexList $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetCapturedFramesTimeStampIndexed_979">proc <a href="ixiaRx.tcl-annot.html#::::GetCapturedFramesTimeStampIndexed">::::GetCapturedFramesTimeStampIndexed</a></a></strong> {{indexList &#34;1 2 3&#34;} {portId 1}} {
   set zeroTime 0
   set hitFirst 0
   foreach pCount $indexList {
      set timeString [lindex [<a name="::GetCapturedFramesTimeStamp(1)"><a href="./ixiaRx.tcl.html#::GetCapturedFramesTimeStamp_955">::GetCapturedFramesTimeStamp</a></a> $portId] $pCount]
      set timeLength [string length $timeString]
      switch $timeLength {
         &#34;18&#34; {
            lappend actTimeList [string range $timeString 0 8]
            set currentTime [string range $timeString 0 8]
         }         
         &#34;17&#34; {
            lappend actTimeList [string range $timeString 0 7]
            set currentTime [string range $timeString 0 7]
         }
         &#34;16&#34; {
            lappend actTimeList [string range $timeString 0 6]
            set currentTime [string range $timeString 0 6]
         }
         &#34;15&#34; {
            lappend actTimeList [string range $timeString 0 5]
            set currentTime [string range $timeString 0 5]
         }
         &#34;14&#34; {
            lappend actTimeList [string range $timeString 0 4]
            set currentTime [string range $timeString 0 4]
         }
         &#34;13&#34; {
            lappend actTimeList [string range $timeString 0 3]
            set currentTime [string range $timeString 0 3]
         }
         default {
            <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Illegal time length $timeLength $timeString&#34;
            lappend actTimeList &#34;&#34;
         }
      }
      if {$hitFirst == 0} {
         set hitFirst 1;
         set zeroTime $currentTime
         
      }
      <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Normalized Time: [expr $currentTime - $zeroTime] \
                    TimeStamp: $currentTime&#34;
   }
return $actTimeList
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: EnablePorts</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Turn on loop back on the ixia port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##             [EnablePorts $portIdList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::EnablePorts_1041">proc <a href="ixiaRx.tcl-annot.html#::::EnablePorts">::::EnablePorts</a></a></strong> {portIdList} {
	global TrafficGen
	
	switch -exact -- $TrafficGen {
		stc {
				foreach portId $portIdList {
					set txPortId [<a name="::hMapPortIdToSpirentPort(8)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]
					<a name="::logcmd(18)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform L2TestRestoreLinkCommand -Port $txPortId
				}
			}
		ixia -
                ixvm {
    <a name="::EnableIxiaPorts(1)"><a href="./ixiaRx.tcl.html#::EnableIxiaPorts_1075">::EnableIxiaPorts</a></a> $portIdList;
}
	}
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: EnableIxiaPorts</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Turn on loop back on the ixia port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##             [EnableIxiaPorts $portIdList]</span>
<span class="comment-line">##             [EnableIxiaPorts $portIdList 0]  ;# Do not wait for link</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::EnableIxiaPorts_1075">proc <a href="ixiaRx.tcl-annot.html#::::EnableIxiaPorts">::::EnableIxiaPorts</a></a></strong> {portIdList {maxWait 15}} {

    <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Enabling Ixia ports $portIdList&#34;

    foreach portId $portIdList {
	<a name="::MapIxiaPortId(10)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port
	<span class="comment-line">#SK  Get the port before re-writing to avoid messing up the old port info.</span>
	<a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chasis $card $port
	
        set ixiaCardType [<a name="::getIxiaCardType(1)"><a href="./misc.tcl.html#::getIxiaCardType_3690">::getIxiaCardType</a></a> $portId]
        <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;port $portId IXIA CARD IS $ixiaCardType&#34;

        <span class="comment-line">#GV 05-06-2011:  Added HSE to account for newer Ixia modules</span>
        if {![regexp -nocase &#34;TXS|GBIC|STX|HSE|LSM&#34; $ixiaCardType]} { ;<span class="comment-line"># LM dont have cabledisconnect</span>
           <a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -loopback false
        } else {
           <a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -enableSimulateCableDisconnect false
        }
	
	<span class="comment-line"># add this line for GBIC card</span>
	<a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -rxTxMode gigNormal
	
	<a name="::port(5)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chasis $card $port
	<a name="::port(6)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> write $chasis $card $port
	
<span class="comment-line"># ---   Required for Ixia ports shared across setups by a Extreme</span>
<span class="comment-line">#       Device as L1 Switch</span>
        <a name="::exDevIxiaPortEnable(1)"><a href="./SetupShareLib.tcl.html#::exDevIxiaPortEnable_671">::exDevIxiaPortEnable</a></a> -portId $portId

	if {$maxWait == 0} {
	    continue
	}

	set maxWaitCounter $maxWait
	while { $maxWaitCounter } {
	    <a name="::port(7)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chasis $card $port
	    if {[<a name="::port(8)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -linkState] == 1} {
		<a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FOUND LINK UP for portId:$portId!&#34;
		break
	    } else {
		<a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Waiting for portId:$portId linkUp..&#34;
		sleep 1
		incr maxWaitCounter -1
	    }
	}
	if {$maxWaitCounter == 0} {
	    <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;WARNING: No linkUp for Ixia portId:$portId&#34;
	}
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: DisablePorts</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Turn off loop back on the ixia port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##             [DisablePorts $portIdList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::DisablePorts_1142">proc <a href="ixiaRx.tcl-annot.html#::::DisablePorts">::::DisablePorts</a></a></strong> {portIdList} {
   <a name="::DisableIxiaPorts(1)"><a href="./ixiaRx.tcl.html#::DisableIxiaPorts_1161">::DisableIxiaPorts</a></a> $portIdList;
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: DisableIxiaPorts</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Turn off loop back on the ixia port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">##             [DisableIxiaPorts $portIdList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::DisableIxiaPorts_1161">proc <a href="ixiaRx.tcl-annot.html#::::DisableIxiaPorts">::::DisableIxiaPorts</a></a></strong> {portIdList} {

	global TrafficGen
	
	switch -exact -- $TrafficGen {
		stc {
				foreach portId $portIdList {
					set txPortId [<a name="::hMapPortIdToSpirentPort(9)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]
					<a name="::logcmd(19)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform L2TestBreakLinkCommand -Port $txPortId
				}
			}
		ixia -
                ixvm {
   <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Disabling Ixia ports $portIdList&#34;

   <span class="comment-line">#an indirect way to disable a port</span>
   foreach portId $portIdList {
      <a name="::MapIxiaPortId(11)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port

      <span class="comment-line">#SK  Get the port before re-writing to avoid messing up the old port info.</span>
      <a name="::port(9)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chasis $card $port

      set ixiaCardType [<a name="::getIxiaCardType(2)"><a href="./misc.tcl.html#::getIxiaCardType_3690">::getIxiaCardType</a></a> $portId]
      <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;port $portId IXIA CARD IS $ixiaCardType&#34;

      <span class="comment-line">#SK: Following code needed to clear the buffer on disabled port.</span>
      <span class="comment-line">#SK: Put the port on loopback, start port capture to clear the buffer</span>
      if {![regexp -nocase &#34;TXS|GBIC&#34; $ixiaCardType]} {
         <a name="::port(10)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -loopback true
      } else {
         <a name="::port(11)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -loopback true
         <a name="::port(12)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -rxTxMode gigLoopback
      }
      <a name="::port(13)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chasis $card $port
      <a name="::port(14)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> write $chasis $card $port

      <a name="::StartPortsCapture(1)"><a href="./ixiaRx.tcl.html#::StartPortsCapture_457">::StartPortsCapture</a></a> $portId
      <a name="::StartPortsCapture(2)"><a href="./ixiaRx.tcl.html#::StartPortsCapture_457">::StartPortsCapture</a></a> $portId
      if {![regexp -nocase &#34;TXS|GBIC&#34; $ixiaCardType]} {
         <a name="::port(15)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -loopback false
      } else {
         <a name="::port(16)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -loopback false
	 <a name="::port(17)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -rxTxMode gigNormal
      }

      <span class="comment-line">#GV 05-06-2011:  Separated loopback off and loopback/disconnect on events</span>
      <a name="::port(18)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chasis $card $port
      <a name="::port(19)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> write $chasis $card $port
      
      <span class="comment-line">#SK: Actual disable port</span>
      <span class="comment-line">#GV 05-06-2011:  Added HSE to account for newer Ixia modules</span>
      if {![regexp -nocase &#34;TXS|GBIC|STX|HSE|LSM&#34; $ixiaCardType]} {
         <a name="::port(20)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -loopback true
      } else {
         <a name="::port(21)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -enableSimulateCableDisconnect true
      }

      <a name="::port(22)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chasis $card $port
      <a name="::port(23)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> write $chasis $card $port

<span class="comment-line"># --- Required for Ixia ports shared across setups by a Extreme</span>
<span class="comment-line">#     Device as L1 Switch</span>
      <a name="::exDevIxiaPortDisable(1)"><a href="./SetupShareLib.tcl.html#::exDevIxiaPortDisable_627">::exDevIxiaPortDisable</a></a> -portId $portId
   }
}
	}

  
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetNumBytesSent</span>

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetNumBytesSent</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of bytes sent on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return bytes sent</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetNumBytesSent $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::GetNumBytesSent_1250">proc <a href="ixiaRx.tcl-annot.html#::::GetNumBytesSent">::::GetNumBytesSent</a></a></strong> {portId} {

   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set txBytes [::AgtExtreme::GetNumBytesSent -portid $portId]
           return $txBytes
       }
       stc {
            set txBytes [<a name="::logcmd(20)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(10)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Generator.GeneratorPortResults \
                -GeneratorOctetCount]
            return $txBytes	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }

   <a name="::MapIxiaPortId(12)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(49)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasisId $card $port
   <a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> get
   set ver [<a name="::version(2)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -productVersion]
   set bytesSent [<a name="::stat(50)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesSent]
   <span class="comment-line">#this bytesSent is only half of the actual bytes sent (Ixia bug)</span>
   <a name="::port(24)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chasisId $card $port
   if {([<a name="::port(25)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -speed] == 100) &amp;&amp; ([regexp -nocase &#34;2.1&#34; $ver])} {
      return [expr $bytesSent/2]
   } else { return $bytesSent }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetNumBytesReceived</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of bytes received on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return bytes received</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetNumBytesReceived $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::GetNumBytesReceived_1299">proc <a href="ixiaRx.tcl-annot.html#::::GetNumBytesReceived">::::GetNumBytesReceived</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set rxBytes [::AgtExtreme::GetNumBytesReceived -portid $portId]
           return $rxBytes
       }
       stc {
            set rxBytes [<a name="::logcmd(21)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(11)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Analyzer.AnalyzerPortResults -TotalOctetCount]
            return $rxBytes	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }

   <a name="::MapIxiaPortId(13)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(51)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasisId $card $port
   set bytesRecv [<a name="::stat(52)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesReceived]
   <span class="comment-line">#remove the stupid comma</span>
   regsub -all {,} $bytesRecv {} bytesRecv
   return $bytesRecv
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetNumFramesSent</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of frames sent on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return frames sent</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetNumFramesSent $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetNumFramesSent_1342">proc <a href="ixiaRx.tcl-annot.html#::::GetNumFramesSent">::::GetNumFramesSent</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set txFrames [::AgtExtreme::GetNumFramesSent -portid $portId]
           return $txFrames
       }
       stc {
            set txFrames [<a name="::logcmd(22)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(12)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Generator.GeneratorPortResults -GeneratorFrameCount]
            return $txFrames	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }
   <a name="::MapIxiaPortId(14)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(53)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasisId $card $port
   return [<a name="::stat(54)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetNumFramesReceived</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of frames received on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return frames received</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetNumFramesReceived $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetNumFramesReceived_1381">proc <a href="ixiaRx.tcl-annot.html#::::GetNumFramesReceived">::::GetNumFramesReceived</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set rxFrames [::AgtExtreme::GetNumFramesReceived -portid $portId]
           return $rxFrames
       }
       stc {
            <span class="comment-line"># Retrieve the total number of frames received.</span>
            set rxFrames [<a name="::logcmd(23)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(13)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Analyzer.AnalyzerPortResults -TotalFrameCount]
            return $rxFrames	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }
   <a name="::MapIxiaPortId(15)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(55)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasisId $card $port
   return [<a name="::stat(56)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]
}

<strong><a name="::::GetNumOversizedFramesReceived_1405">proc <a href="ixiaRx.tcl-annot.html#::::GetNumOversizedFramesReceived">::::GetNumOversizedFramesReceived</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set rxLongFrames [::AgtExtreme::GetNumOversizedFramesReceived -portid $portId]
           return $rxLongFrames
       }
       stc {
            <span class="comment-line"># Retrieve the total number of oversized frames received.</span>
            set rxLongFrames [<a name="::logcmd(24)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(14)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Analyzer.AnalyzerPortResults -OversizeFrameCount]
            return $rxLongFrames	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }
   <a name="::MapIxiaPortId(16)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(57)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasisId $card $port
   return [<a name="::stat(58)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -oversize]
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetFrameRateSent</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of frame rate sent on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return frame rate sent</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetFrameRateSent $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetFrameRateSent_1445">proc <a href="ixiaRx.tcl-annot.html#::::GetFrameRateSent">::::GetFrameRateSent</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set txFrameRate [::AgtExtreme::GetFrameRateSent -portid $portId]
           return $txFrameRate
       }
       stc {
            after 2000
            puts &#34;\n\nFrame Rate info+\n\n[<a name="::logcmd(25)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get \
                [<a name="::hMapPortIdToSpirentPort(15)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Generator.GeneratorPortResults]\n\n\n&#34;
            set txFrameRate [<a name="::logcmd(26)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(16)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Generator.GeneratorPortResults \
                -GeneratorFrameRate]
            return $txFrameRate	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }
   <a name="::MapIxiaPortId(17)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(59)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
   return [<a name="::stat(60)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesSent]
}

<strong><a name="::::GetOversizedFrameRateReceived_1472">proc <a href="ixiaRx.tcl-annot.html#::::GetOversizedFrameRateReceived">::::GetOversizedFrameRateReceived</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set rxLongFrameRate [::AgtExtreme::GetOversizedFrameRateReceived -portid $portId]
           return $rxLongFrameRate
       }
       stc {
            set rxLongFrameRate [<a name="::logcmd(27)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(17)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Analyzer.AnalyzerPortResults -OversizeFrameRate]
            return $rxLongFrameRate	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }
   <a name="::MapIxiaPortId(18)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(61)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
   return [<a name="::stat(62)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -oversize]
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetFrameRateReceived</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of frame rate received on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return frame rate received</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetFrameRateReceived $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetFrameRateReceived_1511">proc <a href="ixiaRx.tcl-annot.html#::::GetFrameRateReceived">::::GetFrameRateReceived</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set rxFrameRate [::AgtExtreme::GetFrameRateReceived -portid $portId]
           return $rxFrameRate
       }
       stc {
            <span class="comment-line">#logcmd stc::perform ResultClearAllTraffic -PortList [hMapPortIdToSpirentPort $portId]</span>
            <span class="comment-line">#after 10000</span>
            set rxFrameRate [<a name="::logcmd(28)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(18)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Analyzer.AnalyzerPortResults -TotalFrameRate]
            return $rxFrameRate	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }
   <a name="::MapIxiaPortId(19)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(63)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
   return [<a name="::stat(64)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetTaggedFrameRateReceived</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of tagged frame rate received on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return tagged frame rate received</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetTaggedFrameRateReceived $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetTaggedFrameRateReceived_1552">proc <a href="ixiaRx.tcl-annot.html#::::GetTaggedFrameRateReceived">::::GetTaggedFrameRateReceived</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set rxVlanFrameRate [::AgtExtreme::GetTaggedFrameRateReceived -portid $portId]
           return $rxVlanFrameRate
       }
       stc {
            set rxVlanFrameRate [<a name="::logcmd(29)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(19)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Analyzer.AnalyzerPortResults -VlanFrameRate]
            return $rxVlanFrameRate	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }
   <a name="::MapIxiaPortId(20)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(65)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
   return [<a name="::stat(66)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -vlanTaggedFramesRx]
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetByteRateSent</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of byte rate sent on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return byte rate sent</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetByteRateSent $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetByteRateSent_1591">proc <a href="ixiaRx.tcl-annot.html#::::GetByteRateSent">::::GetByteRateSent</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set txByteRate [::AgtExtreme::GetByteRateSent -portid $portId]
           return $txByteRate
       }
       stc {
            set txByteRate [<a name="::logcmd(30)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(20)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Generator.GeneratorPortResults -GeneratorOctetRate]
            return $txByteRate	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }
   <a name="::MapIxiaPortId(21)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(67)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
   return [<a name="::stat(68)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesSent]
   
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetByteRateReceived</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of byte rate received on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return byte rate received</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetByteRateReceived $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetByteRateReceived_1631">proc <a href="ixiaRx.tcl-annot.html#::::GetByteRateReceived">::::GetByteRateReceived</a></a></strong> {portId} {
   global TrafficGen
   switch -exact -- $TrafficGen {
       agilent {
           set rxByteRate [::AgtExtreme::GetByteRateReceived -portid $portId]
           return $rxByteRate
       }
       stc {
            set rxVlanFrameRate [<a name="::logcmd(31)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(21)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId].Analyzer.AnalyzerPortResults -TotalOctetRate]
            return $rxVlanFrameRate	
       }
       ixia {
       }
       ept {
       }
       default {
       }
   }
   <a name="::MapIxiaPortId(22)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(69)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> getRate statAllStats $chasisId $card $port
   return [<a name="::stat(70)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -bytesReceived]
   
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetRxArpRequest</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the number of ARP request received on a port</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return numer of ARP request received</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [GetRxArpRequest $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetRxArpRequest_1671">proc <a href="ixiaRx.tcl-annot.html#::::GetRxArpRequest">::::GetRxArpRequest</a></a></strong> {{portId &#34;1&#34;}} {
	<a name="::MapIxiaPortId(23)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port
	<a name="::stat(71)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasis $card $port
	return [<a name="::stat(72)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -rxArpRequest]
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description: CheckRates</span>
<span class="comment-line">#     This proc can be used to check the tx and Rx packet rate.</span>
<span class="comment-line">#     It accepts Rx ports' list to check on multiple rx ports.</span>
<span class="comment-line">#     It calls GetFrameRateSent and GetFrameRateReceived.</span>
<span class="comment-line"># Input args: txPortId, rxPortIdList, percent_tolerance</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># CheckRates $txPort $rxPortList</span>
<span class="comment-line">##################################################################    </span>

<strong><a name="::::CheckRates_1688">proc <a href="ixiaRx.tcl-annot.html#::::CheckRates">::::CheckRates</a></a></strong> {txPortId rxPortIdList {comment &#34;&#34;} {percent_tolerance .011} args } {
   global TrafficGen
   set rtValue &#34;ok&#34;
  <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckRates $args {
    reportResults 1
     oversize &#34;false&#34;
     reportResults 1
  }

   if {$TrafficGen == &#34;stc&#34;} {
     set clearlist {}
     foreach i $rxPortIdList { lappend clearlist [lindex $i 0] } 
     <a name="::ClearPortsStats(3)"><a href="./ixiaRx.tcl.html#::ClearPortsStats_696">::ClearPortsStats</a></a> $clearlist 
     after 3000
   }
   
   if {$txPortId &gt; 100 } {
      set txRate $txPortId
   } else { set txRate [<a name="::GetFrameRateSent(1)"><a href="./ixiaRx.tcl.html#::GetFrameRateSent_1445">::GetFrameRateSent</a></a> $txPortId] }

   if {$reportResults} {
      <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking Rates $comment&#34;
   }

   foreach var $rxPortIdList {
  
      set rxPort [lindex $var 0]
      set rxPercent [lindex $var 1]
      set tag [lindex $var 2]
      if {$tag!=&#34;&#34;} {
         set rxRate [<a name="::GetTaggedFrameRateReceived(1)"><a href="./ixiaRx.tcl.html#::GetTaggedFrameRateReceived_1552">::GetTaggedFrameRateReceived</a></a> $rxPort]
      } else {
         set rxRate [<a name="::GetFrameRateReceived(1)"><a href="./ixiaRx.tcl.html#::GetFrameRateReceived_1511">::GetFrameRateReceived</a></a> $rxPort]
      }
      if {$oversize==&#34;true&#34;} {
         set rxRate [<a name="::GetOversizedFrameRateReceived(1)"><a href="./ixiaRx.tcl.html#::GetOversizedFrameRateReceived_1472">::GetOversizedFrameRateReceived</a></a> $rxPort]
      }
   
      if {$reportResults} {
         <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Comparing txRate($txPortId)=$txRate and rxRate($rxPort)=$rxRate&#34;
      }
      <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Comparing txRate($txPortId)=$txRate and rxRate($rxPort)=$rxRate&#34;

      if { $txRate == 0 } {         
         if { $rxRate == 0 } {
            if {$reportResults == 1} {
        	    <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;txRate($txPortId)=rxRate($rxPort)=0&#34;
		} else {
	            <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;txRate($txPortId)=rxRate($rxPort)=0&#34;
		}
	         set rtValue &#34;error&#34;
         } else {
            if {$reportResults == 1} {
	         <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;txRate($txPortId)=0 but rxRate($rxPort)=$rxRate&#34;
		 } else {
	         <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;txRate($txPortId)=0 but rxRate($rxPort)=$rxRate&#34;
		 }
	         set rtValue &#34;error&#34;
         }
      } else {
         set exp_rxRate [expr abs (double($txRate) * $rxPercent/100)]
         if {$rxRate &lt; $exp_rxRate} {
             set diff [expr abs( double($exp_rxRate) - double($rxRate) )]
         } else {
             set diff [expr abs( double($rxRate) - double($exp_rxRate) )]
         }
         <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Rate $exp_rxRate Diff $diff&#34;
         if {$exp_rxRate &lt; 0.0001 } {
            if {($txRate &gt; 1000) &amp;&amp; ($rxRate &lt;= 10)} {
                set pPercent 0;
            } else {
                <span class="comment-line">##set pPercent [expr $diff * $percent_tolerance] ;# not sure this is right</span>
                <span class="comment-line"># nellinivasu : Changed to correctly compute loss percentage</span>
                set pPercent [expr double($diff) / double($txRate) * 100.0]
            }
         } else {
            set pPercent [expr double($diff) / double($exp_rxRate) * 100.0]
         }           
         <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- pPercent=$pPercent&#34;
         if { $pPercent &lt;= $percent_tolerance } {
            <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Passed&#34;
	      set rtValue &#34;ok&#34;
	 } elseif { $diff &lt;= 5 } {
            <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Passed&#34;
	      set rtValue &#34;ok&#34;	         
         } else {
	if {$reportResults == 1} {
            <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Failed. diff percentage:$pPercent exceeds %tolerance:$percent_tolerance&#34;
            <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> [format &#34;Difference (%01.2f%%) exceeds tolerance (%01.2f%%). Tx Rate is $txRate, Rx Rate is $rxRate.\n&#34; $pPercent $percent_tolerance]
	  } else {
	    <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Failed. diff percentage:$pPercent exceeds %tolerance:$percent_tolerance&#34;
            <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> [format &#34;Difference (%01.2f%%) exceeds tolerance (%01.2f%%). Tx Rate is $txRate, Rx Rate is $rxRate.\n&#34; $pPercent $percent_tolerance]
	  }
            set rtValue &#34;error&#34;
         }
      }
      if {$reportResults} {
         <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      }
   }
   if {$reportResults} {
      <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   }
   return $rtValue
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description: CheckRatesTxRx</span>
<span class="comment-line">#     This proc can be used to check the tx and Rx packet rate.</span>
<span class="comment-line">#     It accepts Tx and Rx ports' list to check on multiple rx ports.</span>
<span class="comment-line">#     It calls GetFrameRateSent and GetFrameRateReceived.</span>
<span class="comment-line">#</span>
<span class="comment-line">#     Differs from CheckRates in that specific Tx port %s are matched to</span>
<span class="comment-line">#     specific rx port %s.  negTest is used to verify 0% receives</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: infoList, percent_tolerance</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line">#</span>
<span class="comment-line"># lappend infoList {{1 1} {9 100 1}} :port1 tagged tx to port9 tagged expect 100%</span>
<span class="comment-line"># lappend infoList {{2 1} {10 100 1}}</span>
<span class="comment-line"># lappend infoList {{3} {11 50}} :port3 untag tx to port9 untag expect 50%</span>
<span class="comment-line"># lappend infoList {{4} {12 100}}</span>
<span class="comment-line"># lappend infoList {{negTest} {1 0}} :port1 expects 0%</span>
<span class="comment-line"># lappend infoList {{negTest} {2 0}}</span>
<span class="comment-line"># lappend infoList {{negTest} {3 0}}</span>
<span class="comment-line"># lappend infoList {{negTest} {4 0}}</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># CheckRatesTxRx $infoList</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">##################################################################    </span>

<strong><a name="::::CheckRatesTxRx_1819">proc <a href="ixiaRx.tcl-annot.html#::::CheckRatesTxRx">::::CheckRatesTxRx</a></a></strong> {infoList {comment &#34;&#34;} {percent_tolerance .011} {sumRx &#34;No&#34;} {expectedSum 100}} {
    set rtValue &#34;ok&#34;
    
    <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking Rates $comment&#34;
    set getSumTx 1
    set sumRxList &#34;&#34;
    foreach var $infoList {
        set txInfoList [lindex $var 0]
        set rxInfoList [lindex $var 1]
        <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Transmit Information = $txInfoList&#34;
        <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Receive Information = $rxInfoList&#34;
        <span class="comment-line"># set tx vars</span>
        set txPort [lindex $txInfoList 0]
        set txTag [lindex $txInfoList 1]
        <span class="comment-line">#   set the sumTx for sumRx comparison</span>
        if {$getSumTx &amp;&amp; $txPort != &#34;negTest&#34;} {
           set sumTx [<a name="::GetFrameRateSent(2)"><a href="./ixiaRx.tcl.html#::GetFrameRateSent_1445">::GetFrameRateSent</a></a> $txPort]
           set getSumTx 0
        }
        <span class="comment-line"># set rx vars</span>
        set rxPort [lindex $rxInfoList 0]
        set rxPercent [lindex $rxInfoList 1]
        set rxTag [lindex $rxInfoList 2]
        <span class="comment-line">#######################################################</span>
        <span class="comment-line"># Setup the the RX port rates</span>
        <span class="comment-line">#######################################################</span>
        if {$rxTag!=&#34;&#34;} {
            set rxRate [<a name="::GetTaggedFrameRateReceived(2)"><a href="./ixiaRx.tcl.html#::GetTaggedFrameRateReceived_1552">::GetTaggedFrameRateReceived</a></a> $rxPort]
        } else {
            set rxRate [<a name="::GetFrameRateReceived(2)"><a href="./ixiaRx.tcl.html#::GetFrameRateReceived_1511">::GetFrameRateReceived</a></a> $rxPort]
        }
        lappend sumRxList $rxRate
        <span class="comment-line">#######################################################</span>
        <span class="comment-line"># Setup Negative Test rx Port Verification</span>
        <span class="comment-line">#######################################################</span>
        if {$txPort == &#34;negTest&#34;} {
            <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Negative Test: Expecting 0% on rxRate($rxPort)=$rxRate&#34;
            <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Negative Test: Expecting 0% on rxRate($rxPort)=$rxRate&#34;
            <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- rxPercent=$rxPercent&#34;
            if { $rxRate &lt; [expr [<a name="::GetPortIdSpeed(2)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> $rxPort] * $percent_tolerance] } {
                    <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Negative Test: $rxPort RxRate:$rxRate check Passed&#34;
                    set rtValue &#34;ok&#34;
            } else {
                    set pPercent [expr [<a name="::GetPortIdSpeed(3)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> $rxPort] * $percent_tolerance]
                    <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Negative Test: $rxPort rxRate:$rxRate check Failed. diff percentage:$pPercent exceeds %tolerance:$percent_tolerance&#34;
                    set rtValue &#34;error&#34;
            }

            <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
            continue;

        }
        <span class="comment-line">#######################################################</span>
        <span class="comment-line"># Setup the the TX port rates</span>
        <span class="comment-line">#######################################################</span>
        set txRate [<a name="::GetFrameRateSent(3)"><a href="./ixiaRx.tcl.html#::GetFrameRateSent_1445">::GetFrameRateSent</a></a> $txPort]
        
        <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;tx1 = [<a name="::GetFrameRateReceived(3)"><a href="./ixiaRx.tcl.html#::GetFrameRateReceived_1511">::GetFrameRateReceived</a></a> 1] tx2 = [<a name="::GetFrameRateReceived(4)"><a href="./ixiaRx.tcl.html#::GetFrameRateReceived_1511">::GetFrameRateReceived</a></a> 2] \
                      tx3 = [<a name="::GetFrameRateReceived(5)"><a href="./ixiaRx.tcl.html#::GetFrameRateReceived_1511">::GetFrameRateReceived</a></a> 3] tx4 = [<a name="::GetFrameRateReceived(6)"><a href="./ixiaRx.tcl.html#::GetFrameRateReceived_1511">::GetFrameRateReceived</a></a> 4]&#34;
        <span class="comment-line">#######################################################</span>
        <span class="comment-line"># Start port compare</span>
        <span class="comment-line">#######################################################</span>
        set exp_rxRate [expr abs (double($txRate) * $rxPercent/100)]
        <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;txRate($txPort)=$txRate to rxRate($rxPort)=$rxRate (want $exp_rxRate)&#34;
        <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sending txRate($txPort)=$txRate to rxRate($rxPort)=$rxRate&#34;
        
        if {$rxRate &lt; $exp_rxRate} {
            set diff [expr abs( double($exp_rxRate) - double($rxRate) )]
        } else {
            set diff [expr abs( double($rxRate) - double($exp_rxRate) )]
        }
        <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Expected Rate at rxRate($rxPort) = $exp_rxRate Difference = $diff&#34;
        if {$exp_rxRate &lt; 0.0001 } {
            <span class="comment-line"># If expected rate = 0</span>
            if {$txRate != 0} {
                set pPercent [expr double($diff) / double($txRate)] ;<span class="comment-line"># not sure this is right</span>
        } else {
                set pPercent 0
            }
                         
        } else {
            set pPercent [expr double($diff) / double($exp_rxRate)] ;<span class="comment-line"># perc missed by</span>
        }           
        <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- pPercent=$pPercent&#34;
        if { $pPercent &lt;= $percent_tolerance } {
            <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$txPort TxRate:$txRate, $rxPort RxRate:$rxRate check Passed&#34;
            set rtValue &#34;ok&#34;
        } elseif { $diff &lt;= 5 } {
            <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$txPort TxRate:$txRate, $rxPort rxRate:$rxRate check Passed&#34;
            set rtValue &#34;ok&#34;	         
        } else {
            <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$txPort TxRate:$txRate, $rxPort rxRate:$rxRate check Failed. diff percentage:$pPercent exceeds %tolerance:$percent_tolerance&#34;
            <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> [format &#34;Difference (%01.2f%%) exceeds tolerance (%01.2f%%). Tx Rate is $txRate, Rx Rate is $rxRate.\n&#34; $pPercent $percent_tolerance]
            set rtValue &#34;error&#34;
        }
        <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   }
   if {$sumRx == &#34;SumRx&#34;} {
      <span class="comment-line">#set expectCount [expr double($sumTx) * $rxPercent / 100]</span>
      set expectCount [expr (double($expectedSum) / double(100)) * $sumTx]
      set rSum 0
      foreach sRate $sumRxList {
         set rSum [expr abs( double($rSum) + double($sRate) )]
      }
      set diff [expr abs( double($rSum) - double($expectCount) )]
      if {$expectCount != 0} {
         set pPercent [expr double($diff) / double($expectCount)]
      } else {
         if {$rSum &lt; 100} {
            set pPercent 0.0
         } else {
            set pPercent 0.20
         }
      }
      <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Sum Rx Totals: $rSum (want ${expectCount})&#34;
      if {$pPercent &lt; 0.18} {
         <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Expected Rx Sum: $expectCount  Actual Sum: $rSum  Diff: $diff&#34;
      } else {
         <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Expected Rx Sum: $expectCount  Actual Sum: $rSum  Diff: $diff&#34;
      }
      <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   }
   <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $rtValue
}    


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaCapturedFramesTimeStamp</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Ixia capture frames timestamp</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#                Ch - chassis id</span>
<span class="comment-line">#                cd - card id</span>
<span class="comment-line">#                pt - port id  </span>
<span class="comment-line">#                fd_res - file pointer</span>
<span class="comment-line">#                                            </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return $timeStamps</span>
<span class="comment-line"># </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [ixiaCapturedFramesTimeStamp $chasis $card $port $fd_res]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::ixiaCapturedFramesTimeStamp_1965">proc <a href="ixiaRx.tcl-annot.html#::::ixiaCapturedFramesTimeStamp">::::ixiaCapturedFramesTimeStamp</a></a></strong> {{ch 1}          \
                         {cd 1}          \
                         {pt 1}          \
                         {fd_res &#34;NULL&#34;} \
						 {fd_in &#34;NULL&#34;}} {
   global spawn_id

   <a name="::capture(13)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> get $ch $cd $pt
   set numCapFrames [<a name="::capture(14)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> cget -nPackets]
   <a name="::captureBuffer(22)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> get $ch $cd $pt 1 $numCapFrames


   for {set i 1} {$i &lt;= $numCapFrames} {incr i} {
      <a name="::captureBuffer(23)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> getframe $i
      puts &#34;capturebuffer cget -timestamp = [<a name="::captureBuffer(24)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -timestamp]&#34;
      if { $fd_res != &#34;NULL&#34; } { 
         puts $fd_res &#34;captureBuffer cget -timestamp = [<a name="::captureBuffer(25)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -timestamp]&#34;
      }
      if {$fd_in != &#34;NULL&#34;} { 
         puts $fd_in &#34;[<a name="::captureBuffer(26)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -timestamp]&#34; 
      } else {
         lappend timeStamps &#34;[<a name="::captureBuffer(27)"><a href="./ePTClient.tcl.html#::captureBuffer_1714">::captureBuffer</a></a> cget -timestamp]&#34;
      }
<span class="comment-line">#      puts &#34;captureBuffer cget -timestamp = [captureBuffer cget -timestamp]&#34;</span>
   }
   if {$fd_in == &#34;NULL&#34;} { 
     if { [ info exists timeStamps ] != &#34;1&#34; } { set timeStamps {} }
      return $timeStamps
   }
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc can be used to enable filter on the rx Ports.</span>
<span class="comment-line">#     Each rx port filters and counts the received frames based on UDS1.</span>
<span class="comment-line"># Input args: PortIdList, daMacList, saMacList, daIpList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage example:</span>
<span class="comment-line">#  ixiaPortFilterStat1 &#34;1 2&#34; &#34;$daMAc1 $daMac2&#34; &#34;$saMac1 $saMac2&#34; &#34;$daIpAddress&#34;</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::EnablePortFilter_2005">proc <a href="ixiaRx.tcl-annot.html#::::EnablePortFilter">::::EnablePortFilter</a></a></strong> { portIdList {daMacList &#34;{00 00 00 00 00 00}&#34;} \
			   {saMacList &#34;{00 00 00 00 00 00}&#34;} \
			   {daIpList &#34;&#34;} {patternMask {00 00 00 00}} {pattern1 &#34;&#34;} {patternOffset1 &#34;32&#34;} {saMaskLst &#34;{00 00 00 00 00 00}&#34;} {daMaskLst &#34;{00 00 00 00 00 00}&#34;}} {

   global one2oneArray
   global TrafficGen
   
   switch -exact -- $TrafficGen {
		
		stc {
				for {set i 0} {$i &lt; [llength $portIdList]} {incr i} {
					set portId [lindex $portIdList $i]
					set hPort [<a name="::hMapPortIdToSpirentPort(22)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]
					
					set analyzerFilter [<a name="::logcmd(32)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create AnalyzerFrameConfigFilter -under [<a name="::logcmd(33)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hPort -children-analyzer] -Num16BitFilters 0 -Num32BitFilters 1 -Active true]
					<a name="::logcmd(34)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ethernet:EthernetII -under $analyzerFilter -name af[subst $portId]_eth \
								-srcMac &#34;[lindex $saMacList $i]/FF:FF:FF:FF:FF:FF#[join [lindex $saMaskLst $i] :]&#34;
					if {![regexp &#34;:&#34; [lindex $daIpList $i]]} {
						<a name="::logcmd(35)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $analyzerFilter \
												-name af[subst $portId]_ip \
												-destAddr &#34;[lindex $daIpList $i]/255.255.255.255#[join $patternMask .]&#34;
					} else {
						if {$patternMask == &#34;00 00 00 00&#34;} {
							set patternMask &#34;::&#34;
						}
						<a name="::logcmd(36)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv6:IPv6 -under $analyzerFilter \
												-name af[subst $portId]_ip \
												-destAddr &#34;[lindex $daIpList $i]/::FFFF:FFFF:FFFF:FFFF:FFFF:FFFF#[subst $patternMask]&#34;
					}
					
				}
			
		}
		ixia -
                ixvm {
   
   <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nEnabling filter UDS1 for ports: $portIdList&#34;
   if {[llength $portIdList] &lt; 1} {
     <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;empty port list: can't enable port filter&#34;
     return
   }   
   <a name="::map(1)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> new -type  one2one
   <a name="::map(2)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> config -type  one2one
   set pos 0  
   foreach portId $portIdList {
      set daMac [lindex $daMacList $pos] 
      if {$daMac == &#34;&#34;} {
        set daMac &#34;00 00 00 00 00 00&#34;
      }
      set saMac [lindex $saMacList $pos] 
      if {$saMac == &#34;&#34;} {
        set saMac &#34;00 00 00 00 00 00&#34;
      }
      set daIp [lindex $daIpList $pos]
      <span class="comment-line">#----- addding saMask and daMask for the source and dest mac</span>
      set saMask [lindex $saMaskLst $pos]
      if {$saMask == &#34;&#34;} {
        set saMask &#34;00 00 00 00 00 00&#34;
      }
      set daMask [lindex $daMaskLst $pos]
      if {$daMask == &#34;&#34;} {
        set daMask &#34;00 00 00 00 00 00&#34;
      }
   
      <a name="::MapIxiaPortId(24)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId ch c p
      <a name="::map(3)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> add $ch $c $p $ch $c $p
      <a name="::filter(2)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> setDefault        
      <a name="::filter(3)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Enable  true
      <a name="::filter(4)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable                true
      <a name="::filter(5)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable               true
      if {[regexp -nocase &#34;00 00 00 00 00 00&#34; $saMac]} {
        <a name="::filter(6)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1SA      anyPattern
      } else {
        <a name="::filter(7)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1SA      addr1
      }
      if {[regexp -nocase &#34;00 00 00 00 00 00&#34; $daMac]} {
        <a name="::filter(8)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1DA      anyPattern
      } else {
        <a name="::filter(9)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1DA      addr1
      }

      <a name="::filter(10)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterPattern       anyPattern
      <a name="::filter(11)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerPattern   anyPattern
      <a name="::filter(12)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerDA   anyAddr
      <a name="::filter(13)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterDA    anyAddr


 if {$daIp != &#34;&#34;} {
        <a name="::filter(14)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Pattern    pattern1
      }
if {$pattern1 != &#34;&#34; } {
   <a name="::filter(15)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Pattern    pattern1
}

      <a name="::filter(16)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a>                       set               $ch $c $p
      <a name="::filterPallette(1)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> setDefault
      <a name="::filterPallette(2)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -DA1  $daMac
      <a name="::filterPallette(3)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -SA1  $saMac
      <a name="::filterPallette(4)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -DAMask1 $daMask
      <a name="::filterPallette(5)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -SAMask1 $saMask
 if {$daIp != &#34;&#34;} {
      <a name="::filterPallette(6)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -matchType1   matchIpDAEthernetII
      set fir &#34;&#34;
      set sec &#34;&#34;
      set thi &#34;&#34;
      set fou &#34;&#34;
      scan $daIp %d.%d.%d.%d fir sec thi fou
      if {($fir!=&#34;&#34;)&amp;&amp;($sec!=&#34;&#34;)&amp;&amp;($thi!=&#34;&#34;)&amp;&amp;($fou!=&#34;&#34;)} {
         set pattern1 [string toupper [format &#34;%02x %02x %02x %02x&#34; $fir $sec $thi $fou]]
      } else {

         set pattern1 &#34;&#34;
      }

 <a name="::filterPallette(7)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -pattern1 $pattern1
      <a name="::filterPallette(8)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -patternOffset1 32
}
 if {$patternMask!=&#34;00 00 00 00&#34;} {
         <a name="::filterPallette(9)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -patternMask1 $patternMask
      }
if {$pattern1 != &#34;&#34; } {
<a name="::filterPallette(10)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a>               config            -pattern1           $pattern1 
<a name="::filterPallette(11)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a>               config            -patternOffset1     $patternOffset1              
}

<a name="::filterPallette(12)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a>               set               $ch $c $p
      
      <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;port $portId: DA1=$daMac; SA1=$saMac; pattern1=$pattern1 patternOffset1 $patternOffset1&#34;
      incr pos
   }
   parray one2oneArray
   <a name="::writeConfigToHardware(1)"><a href="./mapping.tcl.html#::writeConfigToHardware_148">::writeConfigToHardware</a></a> one2oneArray
		}
	}

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: DisablePortFilter</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Turn off the ixia ports filter</span>
<span class="comment-line">#               </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - port list</span>
<span class="comment-line">#                                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#              [DisablePortFilter $portIdList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::DisablePortFilter_2158">proc <a href="ixiaRx.tcl-annot.html#::::DisablePortFilter">::::DisablePortFilter</a></a></strong> { portIdList } {
   
   
   global one2oneArray
   global TrafficGen
   
   switch -exact -- $TrafficGen {
		
		stc {
				for {set i 0} {$i &lt; [llength $portIdList]} {incr i} {					
					<a name="::logcmd(37)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete [<a name="::logcmd(38)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::logcmd(39)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(23)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> [lindex $portIdList $i]] -children-analyzer] -children-AnalyzerFrameConfigFilter]							
				}			
		}
		ixia -
                ixvm {
   <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nDisabling filter UDS1 for ports: $portIdList&#34;
   if {[llength $portIdList] &lt; 1} {
     <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;empty port list: can't disable port filter&#34;
     return
   }
   <a name="::map(4)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> new -type  one2one
   <a name="::map(5)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> config -type  one2one
   foreach portId $portIdList {
      <a name="::MapIxiaPortId(25)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId ch c p
      <a name="::map(6)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> add $ch $c $p $ch $c $p
      <a name="::filter(17)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> setDefault
      <a name="::filter(18)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable true ;<span class="comment-line"># needed to capture pkts</span>
      <a name="::filter(19)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable true ;<span class="comment-line"># needed to capture pkts</span>
      <a name="::filter(20)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> set $ch $c $p
      <a name="::filterPallette(13)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> setDefault
      <a name="::filterPallette(14)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set $ch $c $p
   }
   <a name="::writeConfigToHardware(2)"><a href="./mapping.tcl.html#::writeConfigToHardware_148">::writeConfigToHardware</a></a> one2oneArray
}
	}
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckMatchPacketType   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#	check and return the no. of matched packets from the captured frames list on </span>
<span class="comment-line">#	given ixia port no. by comparing the specified packet type (required), source ip,</span>
<span class="comment-line">#	destination ip, source Mac, and destination Mac.  The latter 4 optional parameters</span>
<span class="comment-line">#	can be bypassed with default value &#34;dontcare&#34;.   		     </span>
<span class="comment-line"># Input args: portId pktType args(-scrIp -destIp -srcMac -destMac)</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	set matchCnt [CheckMatchPacketType 1 &#34;ARP_REQUEST&#34; -srcIp &#34;10.10.10.1&#34;]   </span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckMatchPacketType_2208">proc <a href="ixiaRx.tcl-annot.html#::::CheckMatchPacketType">::::CheckMatchPacketType</a></a></strong> {portId pktType args } {
  <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckMatchPacketType $args {
  	srcIp &#34;dontcare&#34;
  	destIp &#34;dontcare&#34;
  	srcMac &#34;dontcare&#34;
  	destMac &#34;dontcare&#34;
  }
  <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CheckMatchPacketType{}: checking $pktType in the captured packets on port $portId&#34;
  set frameList [<a name="::GetCapturedFrames(1)"><a href="./ixiaRx.tcl.html#::GetCapturedFrames_746">::GetCapturedFrames</a></a> $portId]
  set matchCnt 0    
  foreach frame $frameList {
    set sIpMatch 0
    set dIpMatch 0
    set sMacMatch 0
    set dMacMatch 0
    set msgtype [<a name="::GetMessageType(1)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $frame]
    if {$srcIp == &#34;dontcare&#34; || $srcIp == [<a name="::GetSourceIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frame]} {set sIpMatch 1}
    if {$destIp == &#34;dontcare&#34; || $destIp == [<a name="::GetDestIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frame]} {set dIpMatch 1}
    if {$srcMac == &#34;dontcare&#34; || $srcMac == [<a name="::GetSenderMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSenderMacAddress_62">::GetSenderMacAddress</a></a> $frame]} {set sMacMatch 1}
    if {$destMac == &#34;dontcare&#34; || $destMac == [<a name="::GetTargetMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetTargetMacAddress_159">::GetTargetMacAddress</a></a> $frame]} {set dMacMatch 1}   
    if {($msgtype == $pktType) &amp;&amp; $sIpMatch &amp;&amp; $dIpMatch &amp;&amp; $sMacMatch &amp;&amp; $dMacMatch } {
       incr matchCnt
       <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;matched $msgtype packet #$matchCnt:&#34;
       <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frame&#34;       
    }
  }
  <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CheckMatchPacketType{}: total $matchCnt matched $pktType packets identified&#34;
  return $matchCnt
}  
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: getNumOfCapturedPackets   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#	gets the number of packets in a ports capture buffer</span>
<span class="comment-line"># Input args: portid </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	set numCapPackets [getNumOfCapturedPackets ]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getNumOfCapturedPackets_2247">proc <a href="ixiaRx.tcl-annot.html#::::getNumOfCapturedPackets">::::getNumOfCapturedPackets</a></a></strong> {portid } {
      set numCapFrames 0

      global TrafficGen
      switch -exact -- $TrafficGen {
          agilent {
              return [::AgtExtreme::getNumOfCapturedPackets -portid $portid]
          }
          stc {
                return [<a name="::logcmd(40)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(24)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portid].capture -PktCount]
          }
          ixia {
          }
          ept {
          }
          default {
          }
      }

      <a name="::MapIxiaPortId(26)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portid chassis card port
      <a name="::capture(15)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> get $chassis $card $port
      set numCapFrames [<a name="::capture(16)"><a href="./ePTClient.tcl.html#::capture_1672">::capture</a></a> cget -nPackets]

      return $numCapFrames
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: StartPortsTransmitDuration</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Start Ports Transmit for duration</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#              duration   - time in secs</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">##             [StartPortsTransmitDuration $portIdList 210]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::StartPortsTransmitDuration_2288">proc <a href="ixiaRx.tcl-annot.html#::::StartPortsTransmitDuration">::::StartPortsTransmitDuration</a></a></strong> {portIdList duration} {


foreach portId $portIdList {
   <a name="::MapIxiaPortId(27)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
   lappend plist &#34;$chas $card $port&#34;
}

if [ixSetScheduledTransmitTime plist $duration] {
   ixPuts $::ixErrorInfo }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetNumFilteredFramesReceived</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Get the number of Filtered frames received on a port</span>
<span class="comment-line">#              with filter enabled using EnablePortFilter proc</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              return Filtered frames received</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              [GetNumFilteredFramesReceived $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetNumFilteredFramesReceived_2317">proc <a href="ixiaRx.tcl-annot.html#::::GetNumFilteredFramesReceived">::::GetNumFilteredFramesReceived</a></a></strong> {portId} {
   <a name="::MapIxiaPortId(28)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
   <a name="::stat(73)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasisId $card $port
   return [<a name="::stat(74)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -userDefinedStat1]
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc can be used to enable filter on the rx Ports.</span>
<span class="comment-line">#     Each rx port filters and counts the received frames based on UDS1.</span>
<span class="comment-line"># Input args: PortIdList, daMacList, saMacList, daIpList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage example:</span>
<span class="comment-line">#  ixiaPortFilterStat1 &#34;1 2&#34; &#34;$daMAc1 $daMac2&#34; &#34;$saMac1 $saMac2&#34; &#34;$daIpAddress&#34;</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::SetPortFilter_2334">proc <a href="ixiaRx.tcl-annot.html#::::SetPortFilter">::::SetPortFilter</a></a></strong> { portId pattern1 offset1} {

   global one2oneArray
   <a name="::result_debug(42)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nEnabling filter UDS1 for ports: $portId&#34;

   <a name="::map(7)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> new -type  one2one
   <a name="::map(8)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> config -type  one2one

   <a name="::MapIxiaPortId(29)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId ch c p
   <a name="::map(9)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> add $ch $c $p $ch $c $p
   <a name="::filter(21)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> setDefault
   <a name="::filter(22)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable                true
   <a name="::filter(23)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable               true

   <a name="::filter(24)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterPattern       anyPattern
   <a name="::filter(25)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerPattern   anyPattern
   <a name="::filter(26)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerDA   anyAddr
   <a name="::filter(27)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterDA    anyAddr
   <a name="::filter(28)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Enable  true
   <a name="::filter(29)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1SA      anyPattern
   <a name="::filter(30)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1DA      anyPattern
   <a name="::filter(31)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Pattern    pattern1
   <a name="::filter(32)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> set $ch $c $p

   <a name="::filterPallette(15)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> setDefault
   <a name="::filterPallette(16)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -pattern1 $pattern1
   <a name="::filterPallette(17)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -patternOffset1 $offset1
   <a name="::filterPallette(18)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -patternMask1 &#34;00 00 00 00&#34;
   <a name="::filterPallette(19)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set $ch $c $p

   <a name="::result_debug(43)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;port $portId: pattern=$pattern1; offset=$offset1; &#34;
   set portList [list $ch,$c,$p]
    if [ <a name="::ixWriteConfigToHardware(1)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList -noVerbose -noProtocolServer] {
      <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;writeStreams:: Error in writing the Config to hardware $ch $c $p&#34;
      return -1
   }


}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: WireSharkDecodeCapture</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Decode the captured frames using tshark</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port id</span>
<span class="comment-line">#</span>
<span class="comment-line">#              filter - &#34;sflow.sysuptime&gt;1460000 &amp;&amp; sflow.sysuptime&lt;1477440&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              return the captured frames</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             [WireSharkDecodeCapture $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::WireSharkDecodeCapture_2392">proc <a href="ixiaRx.tcl-annot.html#::::WireSharkDecodeCapture">::::WireSharkDecodeCapture</a></a></strong> {args} {
    global TrafficGen NTAF_ENABLED TSHARKVERSION

    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> WireSharkDecodeCapture $args {
        portId &#34;1&#34;
        packThreshold &#34;200&#34;
        condition &#34;null&#34;
        T &#34;fields&#34;
        eList &#34;null&#34;
        V &#34;true&#34;
        count &#34;null&#34;
    }

    puts &#34;PROC - WireSharkDecodeCapture portId: $portId&#34;

    set fStr &#34;&#34;
    if {$V == &#34;true&#34;} {
        append fStr &#34;-V &#34;
    }
    if {$condition != &#34;null&#34;} {
        append fStr &#34;\&#34;$condition\&#34; &#34;
    }
    if {$eList != &#34;null&#34;} {
        append fStr &#34;-T $T &#34;
        foreach e $eList {
            append fStr &#34;-e $e &#34;
        }
    }
    if {$count != &#34;null&#34;} {
        <span class="comment-line">#display the count table for now.</span>
        if {$TSHARKVERSION &lt; &#34;1.3.0&#34;} {
            set fStr &#34;-qz io,stat,0.002,$condition&#34;
        } else {
            set fStr &#34;-qz io,stat,0,$condition&#34;
        }
    }
    set filterString $fStr

    if {[info exists NTAF_ENABLED] &amp;&amp; $NTAF_ENABLED} {
        <span class="comment-line">#set packThreshold 200</span>
    }
    switch -exact -- $TrafficGen {
        stc {
            <span class="comment-line"># Get the capture object.</span>
            <a name="::StopPortsCapture(3)"><a href="./ixiaRx.tcl.html#::StopPortsCapture_533">::StopPortsCapture</a></a> $portId
            set hCapture [<a name="::logcmd(41)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::hMapPortIdToSpirentPort(25)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId] -children-capture]
            set pktCount [<a name="::logcmd(42)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hCapture -PktCount]
            <a name="::result_debug(44)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;pktCount $pktCount&#34;
            set packetCaptureData {}
            for {set i 0} {$i &lt; $pktCount} {incr i} {
                array set returnList [<a name="::logcmd(43)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform CaptureGetFrameCommand -CaptureProxyId $hCapture -FrameIndex $i]
                set szFrameContents [string range $returnList(-PacketData) 16 end]
                <span class="comment-line">#set szFrameContents [string range $returnList(-PacketData) 0 end]</span>
                set szFrameContents [scan $szFrameContents  [string repeat &#34;%2s&#34; [expr [string length $szFrameContents]/2]]]
                lappend packetCaptureData $szFrameContents
            }
            set myFrames $packetCaptureData
            set file &#34;/tmp/capture_[pid].txt&#34;
            set pcap &#34;/tmp/capture_[pid].pcap&#34;
            set fid [open $file w]

            set i 1
            foreach theFrame $myFrames {
                set res {}
                set ctr 0
                while {[string length $theFrame]&gt;48} {
                    set     pos [string wordstart $theFrame 48]
                    lappend res &#34;[format %4.6X $ctr]  [string range $theFrame 0   [expr $pos-1]]&#34;
                    set     theFrame   [string range $theFrame $pos end]
                    incr ctr 16
                }

                lappend res &#34;[format %4.6X $ctr]  $theFrame&#34;
                set theFrame [join $res &#34;\n&#34;]
                puts $fid &#34;\n$theFrame &#34;;
                if {$i==$packThreshold} {
                    break
                }
            }

            close $fid
            if [catch {exec text2pcap $file $pcap} reason] {
                <span class="comment-line">#puts &#34;Error running text2pcap: $reason&#34;</span>
            }
            if [catch {exec tshark -r $pcap -n $filterString } reason] {
                puts &#34;$reason&#34;
            } else {
                puts &#34;All is well&#34;
            }
            catch {file delete $file} x
            catch {file delete $pcap} y
        }
        ixia -
        ixvm {
        }
        default {
        }
    }
    set numRece [<a name="::GetNumFramesReceived(3)"><a href="./ixiaRx.tcl.html#::GetNumFramesReceived_1381">::GetNumFramesReceived</a></a> $portId]
    if {$numRece &gt; $packThreshold} {
        <a name="::result_debug(45)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;High number of packets ($numRece) captured. \
        Return without getting any packets&#34;
        return
    }
    <a name="::MapIxiaPortId(30)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port
    if {1 || [info exists NTAF_ENABLED] &amp;&amp; $NTAF_ENABLED} {
        set myFrames [<a name="::ixiaCaptureOnePort(4)"><a href="./ixiaRx.tcl.html#::ixiaCaptureOnePort_81">::ixiaCaptureOnePort</a></a> $chasis $card $port NULL]
        set file &#34;/tmp/capture_[pid].txt&#34;
        set pcap &#34;/tmp/capture_[pid].pcap&#34;
        set fid [open $file w]
        set i 1
        foreach theFrame $myFrames {
            set res {}
            set ctr 0
            while {[string length $theFrame]&gt;48} {
                set     pos [string wordstart $theFrame 48]
                lappend res &#34;[format %4.6X $ctr]  [string range $theFrame 0   [expr $pos-1]]&#34;
                set     theFrame   [string range $theFrame $pos end]
                incr ctr 16
            }
            lappend res &#34;[format %4.6X $ctr]  $theFrame&#34;
            set theFrame [join $res &#34;\n&#34;]
            puts $fid &#34;\n$theFrame &#34;;
            if {$i==$packThreshold} {
                break
            }
            incr i
        }

        close $fid
        if [catch {exec text2pcap $file $pcap} reason] {
            <span class="comment-line">#puts &#34;Error running text2pcap: $reason&#34;</span>
        }
        if {[file exists $pcap]} {puts &#34;$pcap is there&#34;}
        puts &#34;\n---\n---\nCalling tshark cli: tshark -r $pcap -n $filterString\n---\n---&#34;;
        set cmd &#34;tshark -r $pcap -n $filterString&#34;
        if [catch {exec {*}$cmd} reason] {
            puts &#34;$reason&#34;
        } else {
            puts $reason
        }
        catch {file delete $file} x
        catch {file delete $pcap} y
    } else {
        return [<a name="::ixiaCaptureOnePort(5)"><a href="./ixiaRx.tcl.html#::ixiaCaptureOnePort_81">::ixiaCaptureOnePort</a></a> $chasis $card $port $fd_res]
    }
}
<span class="comment-line">#################################################################################</span>
<span class="comment-line"># Procedure: InitWireshark</span>
<span class="comment-line"># Wireshark filters seem to change based on version.  That's a pain</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Internal proc to get the tshark version</span>
<span class="comment-line">#</span>
<span class="comment-line">#################################################################################</span>
<strong><a name="::::InitWireshark_2547">proc <a href="ixiaRx.tcl-annot.html#::::InitWireshark">::::InitWireshark</a></a></strong> {} {
    global TSHARKVERSION TSFILTER

    set pid [pid]
    set TSHARKVERSION &#34;NULL&#34;

    if {[catch {exec tshark -v &gt; /tmp/ts$pid} why]} {
        puts &#34;!!\n!!\nGetting tshark version failed\n!!\n!!&#34;
        <span class="comment-line">#There seems to be something wrong.  No tshark installed ?</span>
    } else {
        set fd_in [open &#34;/tmp/ts$pid&#34; &#34;r&#34;]
        while {[gets $fd_in line] != -1} {
            set cookedLine [<a name="::cookString(1)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $line]
puts &#34;Reading Line $line&#34;
            set lList [split $cookedLine]
            if {[lindex $lList 0] == &#34;TShark&#34; &amp;&amp; $TSHARKVERSION == &#34;NULL&#34;} {
                set TSHARKVERSION [lindex $lList 1]
            }
        }
        close $fd_in
        eval [file delete -force /tmp/ts$pid]
    } 
}
<span class="comment-line">#################################################################################</span>
<span class="comment-line"># Procedure: GetWireSharkFilter</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># args: filter - the wireshark display filter to verify</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#################################################################################</span>
<strong><a name="::::GetWireSharkFilter_2583">proc <a href="ixiaRx.tcl-annot.html#::::GetWireSharkFilter">::::GetWireSharkFilter</a></a></strong> {<a name="::filter(33)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a>} {
    global TSHARKVERSION TSFILTER

    if [info exists TSHARKVERSION] {
        puts &#34;TShark version = $TSHARKVERSION&#34;
    } else {
        puts &#34;TShark version NOT SET&#34;
    } 
    if {![info exists TSFILTER($filter)]} {
        puts &#34;$filter is not version dependent&#34;
        return $filter
    }

    <span class="comment-line"># -----  Examples from the tshark.cfg file   ----------------------------------</span>
    <span class="comment-line"># set TSFILTER(&#34;filter&#34;) [list &#34;start ver&#34; &#34;end ver&#34; &#34;alternate list&#34;]</span>
    <span class="comment-line"># set TSFILTER(&#34;sflow.sysuptime&#34;) [list &#34;1.0.0&#34; &#34;1.2.18&#34; &#34;sflow_245.sysuptime&#34;]</span>
    <span class="comment-line"># set TSFILTER(&#34;sflow_245.sysuptime&#34;) [list &#34;1.4.0&#34; &#34;2.0.4&#34; &#34;sflow.sysuptime&#34;]</span>
    <span class="comment-line"># -----------------------------------------------------------------------------</span>
    set fAlt [lindex $TSFILTER($filter) 2];<span class="comment-line"># wireshark alternate filter LIST</span>

    set filterList [concat $filter $fAlt]
    foreach f $filterList {
        puts &#34;Looking for $f&#34;
        set fStartV [lindex $TSFILTER($f) 0];<span class="comment-line"># wireshark start support version</span>
        set fEndV [lindex $TSFILTER($f) 1];<span class="comment-line"># wireshark end support version</span>
        if {$TSHARKVERSION &gt;= $fStartV &amp;&amp; $TSHARKVERSION &lt;= $fEndV} {
            puts &#34;Matched between $fStartV &amp;&amp; $fEndV - return $f&#34;
            return $f
        }
    }
    puts &#34;Error - no filter hit&#34;
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
