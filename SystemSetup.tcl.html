<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>SystemSetup.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#SystemSetup.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>SystemSetup.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="SystemSetup.tcl-annot.html">annotations</a> | <a href="SystemSetup.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: SystemSetup</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Do ixia initialization, build portMapping, and optionally </span>
<span class="comment-line">#	check connections setup.</span>
<span class="comment-line">#       Performs CheckConnection if CheckConnection is set</span>
<span class="comment-line">#       otherwise basic cli setup on DUTs</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Return value: ConnectionOkay or Connectionbad</span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 SystemSetup</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SystemSetup_16">proc <a href="SystemSetup.tcl-annot.html#::::SystemSetup">::::SystemSetup</a></a></strong><a name="::::SystemSetup"></a> {} {

    <span class="comment-line">################################################################</span>
    set testNo &#34;System Setup&#34;
    set title $testNo
    <span class="comment-line">################################################################</span>

    <span class="comment-line"># ----- Environment variables setup</span>
    global DUT1_CONNECT
    global ixiaCh1
    global SPIRENTCH1
    global startCardNum
    global portMappingList
    global trunkPortList
    global checkConnection
    global switchPort2DefaultRouter
    global ixiaPortMappingArray
    global MAIN
    global RELEASE_MASTER
    global DUTs_info
    global exos
    global DUT
    global env
    global whichDutNow
    global bcmPlatform bcmLynx;
    global lastDUT
    global numDUT 
    global VERBOSE
    global pioneerPlatform 
    set useNewMethod 1
    set MAIN(inbandFailCount) 0
    set MAIN(mgmtFailCount) 0
    <span class="comment-line"># Hack added for Everest; remove later -GV</span>
    global skipEdpCheck
    if [info exists skipEdpCheck] {
        if {$skipEdpCheck} {
            set useNewMethod 0
        }
    }
    <span class="comment-line"># End Hack</span>
    
    <span class="comment-line"># ------------------------------------------------------------------</span>
    <span class="comment-line"># Change title if enable in common.cfg</span>
    <span class="comment-line"># ------------------------------------------------------------------</span>
    <a name="::SetTerminalTitle(1)"><a href="./queueLib.tcl.html#::SetTerminalTitle_5146">::SetTerminalTitle</a></a> -add SystemSetup
    <a name="::UpdateTrackDBTxt(1)"><a href="./resource_track.tcl.html#::UpdateTrackDBTxt_133">::UpdateTrackDBTxt</a></a> &#34;executing: SystemSetup&#34;;<span class="comment-line"># tracking db location</span>

    <span class="comment-line"># Check the real ixia libs that have loaded.</span>
    puts &#34;This loaded Ixia_HOME directory is $env(IXIA_HOME)&#34;
    if ![info exist RELEASE_MASTER] {
        set RELEASE_MASTER Release_Master
    }  
    set fd_res [<a name="::open_result_file(1)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;$testNo&#34;]
    set time1 [clock seconds]
    
    result_h1 &#34;$title&#34;
    <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$title&#34;
    
    <span class="comment-line">#generate mapping info for physical portId connected between DUT</span>
    set portDutListUsed [<a name="::::SetupDUTConnections(1)"><a href="./SystemSetup.tcl.html#::::SetupDUTConnections_780">::::SetupDUTConnections</a></a>]
    
    set firstSubStr &#34;DUT&#34;
    set lastSubStr &#34;_CONNECT&#34;
    for {set i 1} {$i &lt;=$numDUT} {incr i 1} {
    	global $firstSubStr$i$lastSubStr
    	global $firstSubStr$i${lastSubStr}B ;<span class="comment-line">#global variable for msm-b</span>
    	if [info exists $firstSubStr$i$lastSubStr] {
    	    lappend DUTList $i
    	}
    }
    set platform [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]
    <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT

    set switchLicSet 1; <span class="comment-line"># We only what to set the main switch vars once.</span>
    foreach testDUT $DUTList {

        <span class="comment-line">#------ adding this part of script to support eware duts</span>
        global eware_dut
        if {[info exists eware_dut]} {
            if {[lsearch $eware_dut $testDUT] == -1 } {
                set loopVar 1
            } else {
                set loopVar 0
            }
        } else {
            set loopVar 1
        }
        
        <span class="comment-line">#---- adding the loop for  exos duts</span>
        if {$loopVar} {
            
            <span class="comment-line"># ----- Switch config </span>
            <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
            
            if {[<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${testDUT}] 16.2.0.0]&gt;=0} {
                <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure cli column 256&#34;
            }

            <span class="comment-line"># testing tftp connectivity</span>
            set returnFlagTftp &#34;ok&#34;
            <span class="comment-line">#if {$returnFlagTftp == &#34;ok&#34;} {</span>
            <span class="comment-line">#  result_ok &#34;tftp server connectivity test passed&#34;</span>
            <span class="comment-line">#} else {</span>
            <span class="comment-line">#  result_error &#34;tftp server connectivity test failed&#34;</span>
            <span class="comment-line">#}</span>
            
            <span class="comment-line"># Code Added to enable Ctrl+v+x+b reboot</span>
            <a name="::EnableDebugMode(1)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal configure sysrq 1&#34;
            <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
            <a name="::DisableDebugMode(1)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
            
            <span class="comment-line"># set regresession server time</span>
            set tm [exec date &#34;+%m %d %Y %H %M %S&#34;]
            set timeCmd &#34;configure time &#34;
            append timeCmd $tm
            <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> $timeCmd
            
            <span class="comment-line">#------ check added to skip license if not needed</span>
            set skipLicVar 1
            global skipLicenceCheck
            if [info exists skipLicenceCheck] {
                if {$skipLicenceCheck} {
                    set skipLicVar 0
                }
            }
            <span class="comment-line">#</span>
            <span class="comment-line"># Licensing.</span>
            <span class="comment-line">#    </span>
            if $skipLicVar {
                <span class="comment-line"># ------------------------------------------------</span>
                <span class="comment-line"># Disable the 30 day trial license</span>
                <span class="comment-line"># ------------------------------------------------</span>
                set parameterList &#34;&#34;
                lappend parameterList &#34;{30 days Trial} exist&#34;
                set result [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show license&#34; $parameterList -reportResults 0]
                if {$result == &#34;ok&#34;} {
                    <a name="::EnableDebugMode(2)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
                    <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug epm clear trial-license&#34;
                    <a name="::CheckReboot(1)"><a href="./SendSwCmd.tcl.html#::CheckReboot_1202">::CheckReboot</a></a>
                }
                <a name="::DisableDebugMode(2)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
                
                <span class="comment-line"># ------------------------------------------------</span>
                <span class="comment-line"># Restore License to Core if not at Core</span>
                <span class="comment-line"># For lync L2-Edge</span>
                <span class="comment-line"># ------------------------------------------------</span>
                <span class="comment-line"># Set the license keys dynamically</span>
                set varout [<a name="::::_SetSwitchLicVars(1)"><a href="./SystemSetup.tcl.html#::::_SetSwitchLicVars_1513">::::_SetSwitchLicVars</a></a> $testDUT 1]
                set parameterList &#34;&#34;
                <span class="comment-line"># EY-06-08-2007: Check for L2(edge) license for Lynx platform.</span>
                if {[regexp $bcmLynx $DUTs_info(DUT$testDUT,platform)]} {
                    lappend parameterList &#34;L2.* exist&#34;;
                } else {
                    lappend parameterList &#34;{core} exist&#34;;
                }
                if {[<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show license&#34; $parameterList]!=&#34;ok&#34;} {
                    if {1} {
                        set parameterList &#34;&#34;
                        lappend parameterList &#34;{Enabled License Level:} 0 1&#34;
                        lappend parameterList &#34;{Enabled License Level:} 1 1&#34;
                        set getLicense [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show license&#34; $parameterList]
                        if {[lindex [lindex $getLicense 0] 1] != &#34;&#34;} {
                            set temp [split [lindex $getLicense 0] &#34; &#34;]
                            set currentLicense [concat [lindex $temp 0][lindex $temp 1]]
                        } else {
                            set temp [split [lindex $getLicense 0] &#34; &#34;]
                            set currentLicense [lindex $temp 0]
                        }
                        if {[<a name="::EnableLicense(1)"><a href="./LicenseMgr.tcl.html#::EnableLicense_23">::EnableLicense</a></a> \
                            [string tolower $currentLicense] core] == &#34;error&#34;} {
                            if {![regexp $pioneerPlatform $DUTs_info(DUT$testDUT,platform)]} {
                                return error
                            }    
                        }
                    } else {
                        if {![regexp $pioneerPlatform $DUTs_info(DUT$testDUT,platform)]} { 
                           return error
                        }    
                    }
                }
                unset parameterList
                <span class="comment-line"># ------------------------------------------------</span>
                <span class="comment-line"># Restore Feature Packs if they are supported on this platform</span>
                <span class="comment-line"># ------------------------------------------------</span>
                if {![regexp -nocase &#34;stack&#34; $DUTs_info(DUT${testDUT},sysName)] &amp;&amp; 
                   $DUTs_info(DUT${testDUT},serial) != &#34;null&#34;} {
                    set fvarout [<a name="::::_SetFeatureLicenses(1)"><a href="./SystemSetup.tcl.html#::::_SetFeatureLicenses_1616">::::_SetFeatureLicenses</a></a> ${testDUT}]
                }
                ;<span class="comment-line"># ------------- End Feature License -----------        </span>
            } ;<span class="comment-line"># ------------ End of all Licensing -----------</span>
            
            <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
            <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
            <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable idletime&#34;
            <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable edp ports all&#34;
            <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ports all&#34;
            <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con edp advertisement-interval 15 holddown-interval 600&#34;
            
            global stackable
            if {[info exists DUTs_info(DUT${testDUT},coreFileTarget)]} {
                <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure debug core-dumps $DUTs_info(DUT${testDUT},coreFileTarget)&#34;
            }
            if {[info exists MAIN(feature_directory)] &amp;&amp; $MAIN(feature_directory) != &#34;null&#34;} {
                <a name="::::CheckForPreviousCore(1)"><a href="./SystemSetup.tcl.html#::::CheckForPreviousCore_1127">::::CheckForPreviousCore</a></a> $testDUT
                if {[info exists $firstSubStr$testDUT${lastSubStr}B]} {
                    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Renaming core on msm-b if any&#34;
                    <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT${lastSubStr}B] -masterCheck 0 -CheckOperational 0
                    <a name="::::CheckForPreviousCore(2)"><a href="./SystemSetup.tcl.html#::::CheckForPreviousCore_1127">::::CheckForPreviousCore</a></a> $testDUT backup
                    <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT${lastSubStr}] -masterCheck 0 -CheckOperational 0
                }
            }
        }
        <span class="comment-line">#Don't check for mariner now </span>
        if { [<a name="::::isExosPlatform(1)"><a href="./SystemSetup.tcl.html#::::isExosPlatform_970">::::isExosPlatform</a></a> &#34;DUT$testDUT&#34;] != 1 } {
            <span class="comment-line"># ----- Switch config</span>
            <a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
            <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
            <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear fdb&#34;
            <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
            <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable idletime&#34;
            <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure reboot-loop-protection threshold 10 3&#34;
            <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable edp ports all&#34;
            <a name="::EnableDebugMode(3)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            <span class="comment-line">#         SendACmd &#34;!echo dump_stack &gt; /sys/module/watchdog/parameters/watchdog_warn_behavior&#34;</span>
            <span class="comment-line">#    SendACmd &#34;configure reboot-loop-protection threshold 10 3&#34;</span>
            
            lappend parameterList &#34;{Image *:.*by} $RELEASE_MASTER&#34;
            <a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show version&#34; $parameterList -comment &#34;- Show $RELEASE_MASTER&#34;
            unset parameterList
            
            set version [<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> &#34;DUT$testDUT&#34; &#34;2&#34;]
            puts &#34;DUT$testDUT version: $version&#34;
            if {($version &gt;= 6.2) &amp;&amp; ([regexp -nocase &#34;godzilla&#34; [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>]] != 1) } {
                <span class="comment-line">##  CheckXMKStatus $testDUT</span>
            }
            
            lappend licenseKey &#34;{License:} 1&#34;
            set licenseVal [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show sw&#34; $licenseKey]
            if [regexp -nocase &#34;summit24e3&#34; $DUTs_info(DUT${testDUT},platform)] {
                if ![regexp -nocase &#34;advanced edge&#34; $licenseVal] {
                    <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license advanced-edge 7656871&#34;
                }
            } elseif ![regexp -nocase &#34;full l3&#34; $licenseVal] {
                <span class="comment-line"># Enable full l3 license</span>
                <a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license fullL3 7656871&#34;
            }
            unset licenseKey
            unset licenseVal
        }
    }

    <span class="comment-line">#Connect to ixia and setup connections</span>
    if { [<a name="::::SetupIxiaConnections(1)"><a href="./SystemSetup.tcl.html#::::SetupIxiaConnections_663">::::SetupIxiaConnections</a></a>] == &#34;connectionBad&#34; } {
    	return connectionBad
    }
    
    <span class="comment-line"># Not initializing ixia or check connection</span>
    if {([info exists checkConnection] == 1) &amp;&amp; $checkConnection == &#34;NO_IXIA&#34; } {
        <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Skipping ixia initialization and check connection&#34;
        <span class="comment-line">################################################</span>
        <span class="comment-line"># Clean up</span>
        <span class="comment-line">################################################</span>
        set time2 [clock seconds]
        result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
        <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
        <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        return &#34;connectionOkay&#34;
    }
    
    <span class="comment-line"># ----- Test variables setup</span>
    set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a>]
    if {$numIxiaCd == 0} {
        <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No ixia card found to be initialized&#34;
        return &#34;connectionBad&#34;
    }
    
    <span class="comment-line"># Check if desired to proceed</span>
    if {([info exists checkConnection] == 1) &amp;&amp; $checkConnection == 0} {
        foreach dut $DUTList {
            <span class="comment-line"># ----- Switch config </span>
            <a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$dut$lastSubStr]
            <a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
            <a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
        }
        <span class="comment-line">################################################</span>
        <span class="comment-line"># Clean up</span>
        <span class="comment-line">################################################</span>
        set time2 [clock seconds]
        result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
        <a name="::close_result_file(2)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
        <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        return &#34;connectionOkay&#34;
    }

    <span class="comment-line"># -----------------------------------------------------------------</span>
    <span class="comment-line"># Verify MGMT and INBAND Connections</span>
    <span class="comment-line"># -----------------------------------------------------------------</span>
    result_h2 &#34;Network port validation&#34;
    <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Network port validation&#34;
    set mgmtList &#34;&#34;
    foreach testDUT $DUTList {
       lappend mgmtList &#34;VerifyMgmtConnections $testDUT&#34;
    }
    <a name="::MultiTask(1)"><a href="./multiTask.tcl.html#::MultiTask_39">::MultiTask</a></a> $mgmtList
    <span class="comment-line">#Store results in init file</span>
    foreach testDUT $DUTList {
        if {([info exists MAIN(ifPipe)]) &amp;&amp; ($MAIN(ifPipe) != &#34;NULL&#34;)} {
            puts $MAIN(ifPipe) &#34;set DUTs_info(DUT${testDUT},InbandNetConnected) $DUTs_info(DUT${testDUT},InbandNetConnected)&#34;
            puts $MAIN(ifPipe) &#34;set DUTs_info(DUT${testDUT},MgmtNetConnected)   $DUTs_info(DUT${testDUT},MgmtNetConnected)&#34;
        }
    }
    <span class="comment-line">#  --- update the tracking database if failures</span>
    <a name="::::_updateMgmtInbandStatus(1)"><a href="./SystemSetup.tcl.html#::::_updateMgmtInbandStatus_3163">::::_updateMgmtInbandStatus</a></a>
    <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
 
    set returnVal &#34;connectionOkay&#34;
    set islDutFailList &#34;&#34;
    set lastDUT 0
    set portLearned 1
    foreach testDUT $DUTList {
        
        set thisDutPorts &#34;&#34;
        foreach portDutPair $portDutListUsed {
            if {[lindex $portDutPair 1] == $testDUT} {
                lappend thisDutPorts [lindex $portDutPair 0]
            }
        }
        <a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
        <span class="comment-line"># Added By nellinivasu; to overcome ports still part of default vlan.</span>
        <a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan default delete ports all&#34;
        <span class="comment-line"># Next two lines required temporarily for &#34;debug hal show compact-flash&#34;</span>
        <span class="comment-line">#logout</span>
        <span class="comment-line">#Login  [expr $$firstSubStr$testDUT$lastSubStr]</span>
        set tagId [<a name="::random(1)"><a href="./mysqlLib.tcl.html#::random_1092">::random</a></a> 4094]
        if {$tagId==1||$tagId==0} {set tagId 2}
        <a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan ixiaVlan&#34;
        set output  [<a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;]          
        <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;output :: $output&#34;
        if {[regexp -nocase &#34;Error&#34; $output]} {                
            set tagId 3
            <a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;
        }
        <a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port all tag&#34;
        
        <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
        
        <span class="comment-line">#result_debug &#34;Ports checked for $testDUT DUT are $thisDutPorts&#34;</span>
        foreach portId $thisDutPorts {
            set frameSent [<a name="::SendFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $portId -tag $tagId -frameSize 68 -frameRate 100 -streamType &#34;contPacket&#34;]
            <span class="comment-line">#after 300</span>
            <span class="comment-line">#set frameSent [SendFrame -txPortId $portId -tag $tagId -frameSize 68]</span>
            set sourceMac [<a name="::GetSourceMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameSent]
            set sourceMacFdb($portId) [<a name="::IxiaMacFormat2FdbFormat(1)"><a href="./misc.tcl.html#::IxiaMacFormat2FdbFormat_92">::IxiaMacFormat2FdbFormat</a></a> $sourceMac]
            <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FdbMac for port $portId: Source:|$sourceMacFdb($portId)| Dest:|[<a name="::GetDestMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetDestMacAddress_19">::GetDestMacAddress</a></a> $frameSent]|&#34;
            <span class="comment-line">#LK commented below 2 second sleeep and StopPortsTransmit will be done after checkConnection is verified</span>
            <span class="comment-line">#exSleep 2</span>
            <span class="comment-line">#StopPortsTransmit $portId</span>
        }
        <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 20
        foreach portId $thisDutPorts {
            if { [regexp -nocase &#34;a&#34; [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $testDUT] ] } {
                lappend detectMACList &#34;{$sourceMacFdb($portId) .*ixiaVlan.* d.*m} 1&#34;
            } else {
                lappend checkMACList &#34;$sourceMacFdb($portId) ixiaVlan [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $testDUT] exist&#34;
            }
        }

        if {[info exists detectMACList]} {
            set DUTPortList [<a name="::GetKeyValue(3)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show fdb&#34; $detectMACList]
        }

        

        <span class="comment-line">#if {[info exists DUTPortList] &amp;&amp; [regexp &#34;NOT&#34; $DUTPortList] } {</span>
        <span class="comment-line">#    puts &#34;DEBUG DUTPortList: $DUTPortList&#34;</span>
        <span class="comment-line">#    set returnFlag &#34;error&#34;</span>
        <span class="comment-line">#    result_error &#34;Unable to detect one or more connections on DUT$testDUT&#34;</span>
        <span class="comment-line">#    result_debug &#34;Please recheck all links&#34;</span>
        <span class="comment-line">#    set portLearned 0</span>
        <span class="comment-line">#}</span>

        foreach portId $thisDutPorts {
            if { [regexp -nocase &#34;a&#34; [<a name="::MapDUTPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $testDUT] ] } {
                set portIndex [lsearch -regexp $detectMACList &#34;$sourceMacFdb($portId) .*ixiaVlan.* d.*m&#34;]
                <span class="comment-line">#result_debug &#34;Auto detecting portId: $portId DUTPort: [lindex $DUTPortList $portIndex]&#34;</span>
                set replaceIndex [lsearch -regexp $portMappingList &#34;$portId *A * $testDUT&#34;]
                if {$replaceIndex != -1} {
                    set portMappingList [lreplace $portMappingList $replaceIndex $replaceIndex &#34;$portId [lindex $DUTPortList $portIndex] $testDUT&#34;]
                }
            }
        }

        <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;portMappingList: $portMappingList&#34;
        
        if {([info exists checkMACList] == 1)} {
            <span class="comment-line">################################################</span>
            set subTest &#34;Checking DUT$testDUT Connections via MAC fdb Learning&#34;
            <span class="comment-line">################################################</span>
            result_h2 &#34;$subTest&#34;
            <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
            set returnFlag [<a name="::CheckFdb(1)"><a href="./fdb.tcl.html#::CheckFdb_690">::CheckFdb</a></a> $checkMACList $fd_res $testNo]
            unset checkMACList
            <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        } else {
            set returnFlag &#34;ok&#34;
        }
        
        <span class="comment-line">################################################</span>
        set subTest &#34;Detecting DUT$testDUT Connections via MAC fdb Learning&#34;
        <span class="comment-line">################################################</span>
        result_h2 &#34;$subTest&#34;
        <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
        <a name="::::SetupDUTConnections(2)"><a href="./SystemSetup.tcl.html#::::SetupDUTConnections_780">::::SetupDUTConnections</a></a>
        set dutSpecificPortMappingList &#34;&#34;
        foreach el $portMappingList {
            if {[lindex $el 2]==$testDUT} {
                lappend dutSpecificPortMappingList $el
            }
        }

        if {[regexp &#34;NOT&#34; $dutSpecificPortMappingList] } {
            set returnFlag &#34;error&#34;
            <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Unable to detect one or more connections on DUT$testDUT&#34;
            <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Please recheck all links&#34;
            if {[info exists MAIN(CCIMAINDEBUG)] &amp;&amp; $MAIN(CCIMAINDEBUG)} {
                <a name="::imain_prompt(1)"><a href="./iMainLib.tcl.html#::imain_prompt_98">::imain_prompt</a></a> -id &#34;Failed FDB learning on DUT $testDUT&#34;
            }
        }
        foreach portId $thisDutPorts {
            <a name="::StopPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $portId
        }
        <a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan ixiaVlan&#34;
        <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        
        <span class="comment-line">#EDP check whether it's working or not</span>
        set dut [expr $$firstSubStr$testDUT$lastSubStr]
        if {$useNewMethod==1} {
            set dutEdpInfo($testDUT) [<a name="::::isEdpWorking(1)"><a href="./SystemSetup.tcl.html#::::isEdpWorking_986">::::isEdpWorking</a></a> $dut $DUTList]
            if {$dutEdpInfo($testDUT)&lt;=0 } {
                lappend islDutFailList $testDUT
                set returnVal &#34;connectionBad&#34;
                if {[info exists MAIN(CCIMAINDEBUG)] &amp;&amp; $MAIN(CCIMAINDEBUG)} {
                    <a name="::imain_prompt(2)"><a href="./iMainLib.tcl.html#::imain_prompt_98">::imain_prompt</a></a> -id &#34;Failed Trunk Port EDP on DUT $testDUT&#34;
                }
            }
        }
        
        if { ($returnFlag != &#34;ok&#34;) || ($returnFlagTftp != &#34;ok&#34;) } {
            set returnVal &#34;connectionBad&#34;
        }
    }
    if {[info exist MAIN(ifPipe)] &amp;&amp; ($MAIN(ifPipe) != &#34;NULL&#34;)} {
    	puts $MAIN(ifPipe) &#34;set portMappingList \{$portMappingList\}&#34;
    }
    <span class="comment-line">################################################</span>
    <span class="comment-line"># Clean up</span>
    <span class="comment-line">################################################</span>
    foreach testDUT $DUTList {
        <a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
        global eware_dut
        if {[info exists eware_dut]} {
            if {[lsearch $eware_dut $testDUT] == -1 } {
                <a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp ports all&#34;
                <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con edp advertisement-interval 60 holddown-interval 180&#34;
                <a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable dhcp vlan all&#34;
            } else {
                <a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp ports all&#34;
                <a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable dhcp vlan all&#34;
            }
        } else {
            <a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp ports all&#34;
            <a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con edp advertisement-interval 60 holddown-interval 180&#34;
            <a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable dhcp vlan all&#34;
        }
        <span class="comment-line">#_verifyCFCorruptionStatusOnLogin</span>
    }
    <span class="comment-line"># Gather portID info (generation platform speed etc) on a portid basis</span>
    if {$returnFlag == &#34;ok&#34;} {
        <span class="comment-line">#GetPortIdInfoStd 1</span>
    }
    set numPortIdNeeded [<a name="::::GetHighestPortId(1)"><a href="./SystemSetup.tcl.html#::::GetHighestPortId_580">::::GetHighestPortId</a></a>]
    <span class="comment-line"># adding check for ixia to hub connection</span>
    set hubConnectionStatus &#34;ok&#34;
    
    set time2 [clock seconds]
    result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
    <a name="::close_result_file(3)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
    <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    if {$hubConnectionStatus == &#34;connectionBad&#34;} {
        set returnVal &#34;connectionBad&#34;
    }
    if {!$portLearned} {
        set $returnVal &#34;connectionBad&#34;
    }
    if {$returnVal == &#34;connectionBad&#34;} {
        if {[llength $islDutFailList] &gt; 0} {
            set MAIN(CCEdpDutResults) &#34;EDP Failed on DUTs $islDutFailList&#34;
            <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check Connections Failed EDP Check on DUTs ${islDutFailList}.&#34;
            set tlstat [<a name="::::_verifyTrunkPortsActive(1)"><a href="./SystemSetup.tcl.html#::::_verifyTrunkPortsActive_2961">::::_verifyTrunkPortsActive</a></a> $islDutFailList]
            <span class="comment-line">#set pIdStat [_verifyPortMappingPortsActive]</span>
            if {$tlstat} {
                <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;EDP Ports are active.  The cfg file trunkPortList may be incorrect&#34;
                <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;All ports are active.  The cfg file trunkPortList may be incorrect&#34;
            } else {
                <a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;EDP Ports are down. May be a SW issue. Recheck cfg file too.&#34;
                <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Some of the trunk links are down. May be a SW issue. Recheck cfg file too.&#34;
            }
            <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
            <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        }
        if {![info exists VERBOSE] || $VERBOSE == &#34;yes&#34;} {
            <a name="::dumpAllSwitchInfo(1)"><a href="./cleanup.tcl.html#::dumpAllSwitchInfo_696">::dumpAllSwitchInfo</a></a>;
        }
    }
    return $returnVal
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetNumIxiaCd</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Get the number of ixia cards in testbed by a given total </span>
<span class="comment-line">#	number of ports</span>
<span class="comment-line"># Input args: {totalPorts} </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: integer</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 set numIxiaCd [GetNumIxiaCd $maxPorts]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetNumIxiaCd_546">proc <a href="SystemSetup.tcl-annot.html#::::GetNumIxiaCd">::::GetNumIxiaCd</a></a></strong><a name="::::GetNumIxiaCd"></a> { {totalPorts 0} } {
    global portMappingList
    global startCardNum
    
    <span class="comment-line"># get the last ixia port number from cfg port list, if no port is specified</span>
    if {$totalPorts == 0 } {
	set totalPorts [lindex [lindex $portMappingList [expr [llength $portMappingList] -1 ]] 0]
    }
    
    set result 1
    set cardNum $startCardNum
    set numPortPerCd [<a name="::findNumPortPerIxiaCard(1)"><a href="./ePTMisc.tcl.html#::findNumPortPerIxiaCard_388">::findNumPortPerIxiaCard</a></a> $cardNum]
    while { $totalPorts &gt; $numPortPerCd } {
	incr result
	set totalPorts [expr $totalPorts - $numPortPerCd]
	if {![<a name="::card(1)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> get 1 [expr $cardNum+1]]} {
	    incr cardNum
	}
	set numPortPerCd [<a name="::findNumPortPerIxiaCard(2)"><a href="./ePTMisc.tcl.html#::findNumPortPerIxiaCard_388">::findNumPortPerIxiaCard</a></a> $cardNum]
    }
    return $result
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetHighestPortId</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Get the highest ixia portId based on portMappingList </span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: integer</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 set numPortIdNeeded [GetHighestPortId]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetHighestPortId_580">proc <a href="SystemSetup.tcl-annot.html#::::GetHighestPortId">::::GetHighestPortId</a></a></strong><a name="::::GetHighestPortId"></a> { } {
    global portMappingList
    set maxPortId 0
    foreach portList $portMappingList {
	set portId [lindex $portList  0]
	if {$portId &gt; $maxPortId} {set maxPortId $portId}
    }
    return $maxPortId
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetATrunkPort</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Return the index-th port number on firstSw that links to secondSw.</span>
<span class="comment-line"># Input args: firstSw secondSw {index} </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: integer or a : separated integer set</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	  SendACmd  &#34;conf ebgp add port [GetATrunkPort 1 3]&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetATrunkPort_601">proc <a href="SystemSetup.tcl-annot.html#::::GetATrunkPort">::::GetATrunkPort</a></a></strong><a name="::::GetATrunkPort"></a> {firstSw secondSw {index 1} } {
    global DUT MAIN
    global DUTs_info
    
    set portList [<a name="::::GetTrunkPortList(1)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a> $firstSw $secondSw]
    <span class="comment-line">#use the first switch id to get the default blade</span>
    if {$index &gt; [llength $portList]} { return &#34;PORT_NOT_FOUND&#34; }
    if {$index &lt; 1} { return &#34;PORT_NOT_FOUND&#34; }
    <span class="comment-line"># add support for non ethernet wan ports</span>
    <span class="comment-line">#Each port added adds { {1 2 1 6:1 F48T} {fSw sSw index port hdWare} }</span>
    set tempList [<a name="::::GetTrunkPortList(2)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a> $secondSw $firstSw]
    if {[info exists MAIN(PRINTTopoInfo)]} {
        if {$MAIN(PRINTTopoInfo)} {
            <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INFO: DUT$firstSw [lindex $portList [expr $index -1]] goes to DUT$secondSw [lindex $tempList [expr $index -1]]&#34;
        }
    }
    lappend DUT(trunk,usageList) &#34;$firstSw $secondSw $index [lindex $portList [expr $index -1]] \
	    [<a name="::GetSlotNumType(1)"><a href="./misc.tcl.html#::GetSlotNumType_1810">::GetSlotNumType</a></a> $firstSw [lindex $portList [expr $index -1]]]&#34;
    return [lindex $portList [expr $index -1]]
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: GetTrunkPortList</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Return the list of all trunk port numbers on firstSw that link to secondSw.</span>
<span class="comment-line"># Input args: firstSw secondSw </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: list of integers or list of : separated integer set</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	  set portList [GetTrunkPortList $firstSw $secondSw]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetTrunkPortList_633">proc <a href="SystemSetup.tcl-annot.html#::::GetTrunkPortList">::::GetTrunkPortList</a></a></strong><a name="::::GetTrunkPortList"></a> {firstSw secondSw} {
    global trunkPortList
    
    set returnList &#34;&#34;
    if {![info exists trunkPortList]} {
	return $returnList
    }
    
    foreach s2sConnectPair $trunkPortList {
	if {[lindex $s2sConnectPair 0] == $firstSw &amp;&amp; \
		[lindex $s2sConnectPair 1] == $secondSw} {
	    lappend returnList [lindex $s2sConnectPair 2]
	}
    }
    
    return $returnList
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: SetupIxiaConnections</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Check number of ixia ports, build ixiaPortMappingArray, and </span>
<span class="comment-line">#	initialize each port.</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: connectionBad in failure</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 SetupIxiaConnections</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupIxiaConnections_663">proc <a href="SystemSetup.tcl-annot.html#::::SetupIxiaConnections">::::SetupIxiaConnections</a></a></strong><a name="::::SetupIxiaConnections"></a> {} {
    global ixiaCh1
    global SPIRENTCH1 ixiaPath
    global startCardNum
    global startPortNum
    global ixiaMappingList
    global ixiaPortMappingArray
    global portMappingList
    global MAIN
    global ixiaNoReset
    
    if { ![info exist startCardNum] } {
	<a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;startCardNum not defined &#34;
	return -1
    }
    if { [llength [split $startCardNum :]] == 2 }  {
	set startPortNum [lindex [split $startCardNum :] 1]
	set startCardNum [lindex [split $startCardNum :] 0]
	if { ($startPortNum &lt; 1) || ($startCardNum &lt; 1) } {
	    <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;startCardNum not defined properly $startCardNum&#34;
	    return -1
	}
    } elseif { [llength [split $startCardNum :]] == 1 }  {
	if { ![info exist startPortNum] } {
	    <span class="comment-line"># If dot1x is running, this will not be called,</span>
	    <span class="comment-line"># otherwise set default startPortNum to be 1</span>
	    set startPortNum 1
	}
    } else {
	<a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;startCardNum not defined properly $startCardNum&#34;
	return -1
    } 
    
    
    <span class="comment-line"># ----- Ixia initialization</span>
    <a name="::::getTECardSpeed(1)"><a href="./swConf.tcl.html#::::getTECardSpeed_1662">::::getTECardSpeed</a></a>

    <span class="comment-line">#package require IxTclHal</span>
    <span class="comment-line">#package require Mpexpr</span>
    <span class="comment-line">#clean up any previous mess</span>
    <span class="comment-line">#cleanUp</span>
    <span class="comment-line">#ixInitialize $ixiaCh1</span>
    set chid1 [<a name="::getChassisID(1)"><a href="./ixGenProcs.tcl.html#::getChassisID_34">::getChassisID</a></a> $ixiaCh1]
    set numPortIdNeeded [<a name="::::GetHighestPortId(2)"><a href="./SystemSetup.tcl.html#::::GetHighestPortId_580">::::GetHighestPortId</a></a>]
    set numPortIdFound 0
    set portIdList &#34;&#34;
    foreach item $portMappingList {
	lappend portIdList [lindex $item 0]
        if {($numPortIdNeeded &gt;= 11) &amp;&amp; ([lindex $item 0] == 8)} {
            lappend portIdList 9
        }
    }
    <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Total ports needed: $numPortIdNeeded&#34;
    if {([info exists ixiaMappingList] == 0) || [regexp -nocase &#34;AUTO&#34; $ixiaMappingList] } {
	<a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Auto detecting connections startCard:$startCardNum startPort:$startPortNum&#34;
	for {set card $startCardNum } {$card &lt;= 16 } {incr card } {
	    if {[<a name="::card(2)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> get 1 $card]!=0} {continue}  ;<span class="comment-line"># only go on if card is correct, 10G fails w/o it</span>
	    set portCount [<a name="::card(3)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> cget -portCount]
	    <span class="comment-line">#   puts &#34;cardType: [card cget -type]&#34;</span>
	    set skipFlag 0
	    for {set port $startPortNum } {$port &lt;= $portCount} {incr port} {
		incr numPortIdFound
		<span class="comment-line">#      puts &#34;numPortIdFound: $numPortIdFound $card $port&#34;</span>
		if {[lsearch -exact $portIdList $numPortIdFound]!=-1} {
		    set skipFlag 1
		    set ixiaPortMappingArray($numPortIdFound) &#34;1 $card $port&#34;
		    <span class="comment-line">#RTP-SQA added for fast init</span>
		    if {[info exist MAIN(ifPipe)] &amp;&amp; ($MAIN(ifPipe) != &#34;NULL&#34;)} {
                puts $MAIN(ifPipe) &#34;set ixiaPortMappingArray($numPortIdFound) \&#34;1 $card $port\&#34;&#34;
		    }
		} elseif {$numPortIdFound&lt;=$numPortIdNeeded} {
		    set port [expr $port-1]
		}
	    }
	    
	    if {$skipFlag==0} {
		set card [expr $card-1]
	    } else {
		set startPortNum 1
	    }
	    
	    if {$numPortIdFound &gt;= $numPortIdNeeded} { break }
	}
	if {$numPortIdFound &lt; $numPortIdNeeded } {
	    <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Not enough connections detected&#34;
	    <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wanted $numPortIdNeeded but only got $numPortIdFound&#34;
	    return &#34;connectionBad&#34;
	}
    } else {
	<a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Using user-defined connection pattern&#34;
	<a name="::GenerateIxiaPortMapping(1)"><a href="./ePTPortMapping.tcl.html#::GenerateIxiaPortMapping_268">::GenerateIxiaPortMapping</a></a>
    }
    <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;================Ixia port mapping===================&#34;
    <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;            portId       \[ChasisId, Card, Port\]&#34;
    for {set portId 1 } {$portId &lt;= $numPortIdNeeded } { incr portId } {
	if {[lsearch -exact $portIdList $portId]!=-1} {
	    set rxPort [<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port]
	    <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;              $portId      -&gt;            \[$chas, $card, $port\]&#34;
	}
    }
    if {![info exists ixiaNoReset]} {
        <a name="::IxiaPortsInit(1)"><a href="./ePTTx.tcl.html#::IxiaPortsInit_331">::IxiaPortsInit</a></a>
    }
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: SetupDUTConnections</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Generate mapping info for physical portId connection between </span>
<span class="comment-line">#	DUT and Ixia.</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: list of portId-&gt;DUTPort integers</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 SetupDUTConnections</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupDUTConnections_780">proc <a href="SystemSetup.tcl-annot.html#::::SetupDUTConnections">::::SetupDUTConnections</a></a></strong><a name="::::SetupDUTConnections"></a> {} {
    global portMappingList
    
    <span class="comment-line">#generate mapping info for physical portId connected between DUT and Ixia</span>
    <a name="::GenerateDUTPortMapping(1)"><a href="./ePTPortMapping.tcl.html#::GenerateDUTPortMapping_217">::GenerateDUTPortMapping</a></a>
    <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;================DUT port mapping===================&#34;
    <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;            portId           DUTPort&#34;
    
    foreach port $portMappingList {
        set portNum [lindex $port 0]
        set dutNum [lindex $port 2]
        if {$dutNum == &#34;&#34; } {set dutNum 1}
        lappend portListUsed $portNum
        lappend portDutListUsed &#34;$portNum $dutNum&#34;
        
        set DUTPort [<a name="::MapDUTPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portNum $dutNum]
        <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;              $portNum      -&gt;        $DUTPort on DUT$dutNum&#34;
    }
    <span class="comment-line">#also need to see how it maps port range</span>
    <span class="comment-line">#result_debug &#34;              1-22,23      -&gt;    [MapDUTPortId 1-22,23]&#34;</span>
    <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;&#34;
    return $portDutListUsed
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: CheckXMKStatus</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function checks and reports for 2nd OS running on dual </span>
<span class="comment-line">#	cpu with 256MB or more</span>
<span class="comment-line"># Input args: dut </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: None</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 CheckXMKStatus $dutNo</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckXMKStatus_816">proc <a href="SystemSetup.tcl-annot.html#::::CheckXMKStatus">::::CheckXMKStatus</a></a></strong><a name="::::CheckXMKStatus"></a> {dut} {

    lappend parameterList &#34;{Total DRAM Size:} 1&#34;
    set memory [<a name="::GetKeyValue(4)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show memory&#34; $parameterList]
    puts &#34;memory: $memory&#34;
    
    <a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show switch&#34;
    <a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;nofeep&#34;
    
    set flag [<a name="::::CheckXMK(1)"><a href="./SystemSetup.tcl.html#::::CheckXMK_874">::::CheckXMK</a></a>]
    puts &#34;Flag: $flag&#34;
    set dualCPU 1
    switch -- [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> &#34;DUT$dut&#34;] {
	Summit48i -
	Summit24i {
	    set dualCPU &#34;0&#34;     		   
	} 
    }
    if {$dualCPU } {
	<a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking 2nd OS (xmk) status on 2nd CPU&#34;
	if {$memory &gt;= 256 } {
	    if {$flag == &#34;xmk&#34;} {
		<a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;2nd OS is running on 2nd CPU&#34;
	    } else {
		<a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;2nd OS is not running on 2nd CPU&#34;
	    }
	} else {
	    if {$flag == &#34;xmk&#34;} {
		<a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;2nd OS is running on 2nd CPU, but should not&#34;
	    } else {
		<a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;2nd OS is not running on 2nd CPU&#34;
	    }      
	}
	<a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    } else {
	<a name="::report_start_test(9)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking for no 2nd OS (xmk) on single CPU&#34;
	if {$flag == &#34;xmk&#34;} {
	    <a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;2nd OS is running on, but should not&#34;
	} else {
	    <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;2nd OS is not running&#34;
	}      
	<a name="::report_end_test(10)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>    
    }
    <a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;shswitch&#34;
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: CheckXMK</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function checks if 2nd OS is running on 2nd CPU by nofeep</span>
<span class="comment-line">#	command &#34;xmk&#34;.</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Return value: verybadifgethere if failure</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 set flag [CheckXMK]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckXMK_874">proc <a href="SystemSetup.tcl-annot.html#::::CheckXMK">::::CheckXMK</a></a></strong><a name="::::CheckXMK"></a> {} {

    send &#34;xmk\r&#34;
    expect {
	timeout {
	    return &#34;TIMEOUT&#34;
	}
	&#34;2\\-&gt; &#34; {
	    send &#34;vx\r&#34;
	    return &#34;xmk&#34;
	}
	&#34;\\-&gt; &#34; {
	    return &#34;noxmk&#34;
	}
    }
    return &#34;verybadifgethere&#34;
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: AddTestbedInfoToDUTs_info</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This function appends test bed specific information to DUTs_info array</span>
<span class="comment-line">#        </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 AddTestbedInfoToDUTs_info</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::AddTestbedInfoToDUTs_info_905">proc <a href="SystemSetup.tcl-annot.html#::::AddTestbedInfoToDUTs_info">::::AddTestbedInfoToDUTs_info</a></a></strong><a name="::::AddTestbedInfoToDUTs_info"></a> {} {
   
    global ixiaCh1 defaultRouter tftpServerList startCardNum switchPort2DefaultRouter \
	    POWERCYCLE_IP POWERCYCLE_PORTS tftpShareName portMappingList trunkPortList \
	    checkConnection connectionTimeout SPIRENTCH1 MAIN
    global numDUT DUTs_info
    
    if {[info exists ixiaCh1]} {
	set DUTs_info(ixiaip) $ixiaCh1   
    }
    if {[info exists SPIRENTCH1]} {
        set DUTs_info(SPIRENTCH1) $SPIRENTCH1
    }
    if {[info exists tftpServerList]} {
	set DUTs_info(tftpserverlist) $tftpServerList   
    }
    if {[info exists defaultRouter]} {
	set DUTs_info(defaultRouter) $defaultRouter
    }
    if {[info exists POWERCYCLE_IP]} {
	set DUTs_info(powercycle_ip) $POWERCYCLE_IP
    }
    if {[info exists POWERCYCLE_PORTS]} {
	set DUTs_info(powercycle_ports) $POWERCYCLE_PORTS
    }
    if {[info exists tftpShareName]} {
	set DUTs_info(tftpsharename) $tftpShareName
    }
    if {[info exists startCardNum]} {
	set DUTs_info(startcardnum) $startCardNum
    }
    if {[info exists portMappingList]} {
	set DUTs_info(portmappinglist) $portMappingList
    }
    if {[info exists trunkPortList]} {
	set DUTs_info(trunkportlist) $trunkPortList
    }
    if {[info exists switchPort2DefaultRouter]} {
	set DUTs_info(switchport2defaultrouter) $switchPort2DefaultRouter
    }
    if {[info exists checkConnection]} {
	set DUTs_info(checkconnection) $checkConnection
    }
    if {[info exists connectionTimeout]} {
	set DUTs_info(connectiontimeout) $connectionTimeout
    }
    
    for {set i 1} {$i &lt;= $numDUT} {incr i 1} {
	global DUT${i}_CONNECT
	global DUT${i}_IP
	global DUT${i}_DefaultBlade
	global DUT${i}_SETUP
	set DUTs_info(DUT$i,connect) [set DUT${i}_CONNECT]
	set DUTs_info(DUT$i,ip) [set DUT${i}_IP]
	set DUTs_info(DUT$i,defaultblade) [set DUT${i}_DefaultBlade]
	set DUTs_info(DUT$i,setup) [set DUT${i}_SETUP]
    }
    <span class="comment-line"># Gather information about the slots / platform and assign to portIds</span>
    <span class="comment-line">#   The portId info comes from SystemSetup, so this must be run first</span>
    if {![info exists MAIN(skipIxInit)] || !$MAIN(skipIxInit)} {
        <a name="::::GetPortIdInfoStd(1)"><a href="./swConf.tcl.html#::::GetPortIdInfoStd_1938">::::GetPortIdInfoStd</a></a>
    }
}


<strong><a name="::::isExosPlatform_970">proc <a href="SystemSetup.tcl-annot.html#::::isExosPlatform">::::isExosPlatform</a></a></strong><a name="::::isExosPlatform"></a> { DUT } {
    global DUTs_info
    global supportedPlatform i386Platform
    
    <span class="comment-line">#    if {$DUTs_info($DUT,platform)==&#34;BD-Mariner&#34;||$DUTs_info($DUT,platform)==&#34;BD-10808&#34;||$DUTs_info($DUT,platform)==&#34;BD-PC&#34;||$DUTs_info($DUT,platform)==&#34;Summit-PC&#34;||$DUTs_info($DUT,platform)==&#34;Aspen&#34;} </span>
    <span class="comment-line"># SK: Removed above line as we need liberal regexp than hard equate</span>
    if {[regexp -nocase &#34;$supportedPlatform|$i386Platform&#34; $DUTs_info($DUT,platform)] || \
        [regexp -nocase &#34;$supportedPlatform|$i386Platform&#34; $DUTs_info($DUT,sysType)]} {
        return 1
    } else {
        <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-------------------------\n$DUTs_info($DUT,sysType) OR $DUTs_info($DUT,platform) NOT EXOS platform\n---------
----------------&#34;
        return 0
    }
}

<strong><a name="::::isEdpWorking_986">proc <a href="SystemSetup.tcl-annot.html#::::isEdpWorking">::::isEdpWorking</a></a></strong><a name="::::isEdpWorking"></a> {DUT DUTList} {
    global DUTs_info
    global whichDutNow
    global trunkPortList
    global lastDUT
    global checkHubConnection
    global bcmNWI	
    
    if {[llength $DUTList] &gt; 1 &amp;&amp; [info exists trunkPortList]} {
        for {set i 0} {$i&lt;[llength $trunkPortList]} {incr i} {
            set trunkPair [lindex $trunkPortList $i]
            set localDUT [lindex $trunkPair 0]
            set remoteDUT [lindex $trunkPair 1]
            if {$remoteDUT==0} continue;
            global eware_dut
            if {[info exists eware_dut]} {
                if {[lsearch $eware_dut $whichDutNow] == -1 } {
                    set loopVar 1
                } else {
                    set loopVar 0
                }
            } else {
                set loopVar 1
            }
            
            if {$loopVar} {
                
                if {$localDUT==$whichDutNow} {
                    if {$localDUT&lt;$remoteDUT} {
                        global stackable i386Stackable ewareStackable
                        if {[regexp -nocase &#34;$stackable|$i386Stackable|$ewareStackable|$bcmNWI&#34; \
                                 [<a name="::GetPlatform(4)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$remoteDUT]]} {
                            lappend edpList &#34;{[lindex $trunkPair 2] .* 00:00:$DUTs_info(DUT$remoteDUT,sysMAC) *1:[lindex [lindex $trunkPortList [expr $i+1]] 2]} exist&#34;
                        } else {
                            lappend edpList &#34;{[lindex $trunkPair 2] .* 00:00:$DUTs_info(DUT$remoteDUT,sysMAC) *[lindex [lindex $trunkPortList [expr $i+1]] 2]} exist&#34;
                        }
                    } else {
                        global stackable i386Stackable ewareStackable
                        if {[regexp -nocase &#34;$stackable|$i386Stackable|$ewareStackable|$bcmNWI&#34; \
                                 [<a name="::GetPlatform(5)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$remoteDUT]]} {
                            lappend edpList &#34;{[lindex $trunkPair 2] .* 00:00:$DUTs_info(DUT$remoteDUT,sysMAC) *1:[lindex [lindex $trunkPortList [expr $i-1]] 2]} exist&#34;
                        } else {
                            lappend edpList &#34;{[lindex $trunkPair 2] .* 00:00:$DUTs_info(DUT$remoteDUT,sysMAC) *[lindex [lindex $trunkPortList [expr $i-1]] 2]} exist&#34;
                        }
                    }
                }
            } else {
                if {$localDUT==$whichDutNow} {
                    if {$localDUT&lt;$remoteDUT} {
                        global stackable i386Stackable ewareStackable
                        if {[regexp -nocase &#34;$stackable|$i386Stackable|$ewareStackable|$bcmNWI&#34; \
                                 [<a name="::GetPlatform(6)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$remoteDUT]]} {
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {EDP is enabled} inLine&#34;
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-ID\=00:00:$DUTs_info(DUT$remoteDUT,sysMAC)} inLine exist 2&#34;
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-Port\=1:[lindex [lindex $trunkPortList [expr $i+1]] 2]} inLine exist 3&#34;
                        } else {
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {EDP is enabled} inLine&#34;
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-ID\=00:00:$DUTs_info(DUT$remoteDUT,sysMAC)} inLine exist 2&#34;
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-Port\=[lindex [lindex $trunkPortList [expr $i+1]] 2]} inLine exist 3&#34;
                        }
                    } else {
                        global stackable i386Stackable ewareStackable
                        if {[regexp -nocase &#34;$stackable|$i386Stackable|$ewareStackable|$bcmNWI&#34; \
                                   [<a name="::GetPlatform(7)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$remoteDUT]]} {
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {EDP is enabled} inLine&#34;
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-ID\=00:00:$DUTs_info(DUT$remoteDUT,sysMAC)} inLine exist 2&#34;
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-Port\=1:[lindex [lindex $trunkPortList [expr $i-1]] 2]} inLine exist 3&#34;
                        } else {
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {EDP is enabled} inLine&#34;
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-ID\=00:00:$DUTs_info(DUT$remoteDUT,sysMAC)} inLine exist 2&#34;
                            lappend edpList &#34;{port.*[lindex $trunkPair 2]} {Remote-Port\=[lindex [lindex $trunkPortList [expr $i-1]] 2]} inLine exist 3&#34;
                        }
                    }
                }
            }
            
        }
        <a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT
        <span class="comment-line">#SK: Doing file based CheckKeyValue to avoid dual edp port all, in case it does not work</span>
        set fd_edp [open &#34;Tmp/tmp_edp[pid]&#34; &#34;w&#34;]
        if {[info exists eware_dut]} {
            if {[lsearch $eware_dut $whichDutNow] == -1 } {
                set output [<a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show edp ports all&#34; NULL $fd_edp]
                <span class="comment-line"># Build regular expression pattern for EDP neighbor MAC address.</span>
                set key {^[0-9]+}
            } else {
                set key {[a-z]+}
                set output [<a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show edp&#34; NULL $fd_edp]
            }
        } else  {
            <span class="comment-line"># Build regular expression pattern for EDP neighbor MAC address.</span>
            set key {^[0-9]+}
            set output [<a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show edp ports all&#34; NULL $fd_edp]
        }
        close $fd_edp
        
        <span class="comment-line"># Check connection of DUT with HUB and if doesn't exist return connectionBad</span>
        if {([info exists checkHubConnection] == 1) &amp;&amp; $checkHubConnection == 0} {
            <span class="comment-line">#do nothing skip the hub connection check</span>
        } else {
            set DUT_Cnt [llength $DUTList]
            set retHubConnVal 0 
            for {set i $lastDUT} {$i&lt;[llength $trunkPortList]} {incr i} {
                set trunkPair [lindex $trunkPortList $i]
                set localDUT [lindex $trunkPair 0]
                if {$lastDUT==$localDUT} continue;
                set remoteDUT [lindex $trunkPair 1]
                set localDUTPort [lindex $trunkPair 2]
                if {$remoteDUT!=0} continue;
                for {set j 1} {$j&lt;=$DUT_Cnt} {incr j} {	
                    if {$j==$localDUT} continue; 
                    set DUT_HUBPortMap [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $j $remoteDUT] 
                    set DUT_Mac [<a name="::GetDUTMac(1)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> DUT$j]
                    global stackable i386Stackable
                    if {[regexp -nocase &#34;$stackable|$i386Stackable&#34; [<a name="::GetPlatform(8)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$j]]} {
                        lappend edpList &#34;{$localDUTPort .*$DUT_Mac *1:$DUT_HUBPortMap } exist&#34;
                    } else {
                        lappend edpList &#34;{$localDUTPort .*$DUT_Mac *$DUT_HUBPortMap } exist&#34;
                    }
                }
                set lastDUT $localDUT
                break;	
            }
        }
        if {[regexp -line $key $output]!=1} {
            <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;EDP not working ...&#34;
            file delete &#34;Tmp/tmp_edp[pid]&#34;
            return -1
        } else {
            set output [<a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;Tmp/tmp_edp[pid]&#34; $edpList  -comment &#34;for file operation: Check edp info&#34;]
            file delete &#34;Tmp/tmp_edp[pid]&#34;
            if {$output==&#34;ok&#34;} {
                return 1
            } else {
                return 0
            }
        }
    } else {
        return 1
    }
}
<strong><a name="::::CheckForPreviousCore_1127">proc <a href="SystemSetup.tcl-annot.html#::::CheckForPreviousCore">::::CheckForPreviousCore</a></a></strong><a name="::::CheckForPreviousCore"></a> {numDUT {msmType &#34;primary&#34;}} {
   global DUTs_info MAIN

   set date [clock format [clock seconds] -format &#34;%m%d%I%p&#34;]
   if {[info exists MAIN(feature_directory)] &amp;&amp; $MAIN(feature_directory) != &#34;null&#34;} {
       set mod $MAIN(feature_directory)
   } else {
       set modStringList [split [file tail [pwd]] &#34;/&#34;]
       set modListLength [llength $modStringList]
       set mod [lindex $modStringList [expr $modListLength - 1]]
   }

   if {[<a name="::CompareRelease(2)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(3)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.1.0.21]&gt;=0} {
    if { $msmType == &#34;primary&#34; } {
      <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; Memory Card Present : [regexp -nocase \&#34;present\&#34; $DUTs_info(DUT${numDUT},memoryCard)]&#34;
      if {[regexp -- &#34;present&#34; $DUTs_info(DUT${numDUT},memoryCard)]} {
         set coreBuf [<a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls /usr/local/ext&#34;]
      } else {
         set coreFileList &#34;&#34;
         lappend coreFileList &#34;core\.\[a-z\]+\.\[0-9\]+ 0&#34;
         if {[<a name="::CompareRelease(3)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(4)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.4.0.1]&gt;=0} {
            set coreBuf [<a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls /usr/local/tmp&#34;]
         } else {
            <a name="::EnableDebugMode(4)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            set coreBuf [<a name="::GetKeyValue(5)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;!ls /scratch&#34; $coreFileList 1]
         }
      }
    } else {
      <a name="::EnableDebugMode(5)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a> ; <span class="comment-line"># Required for executing !mv and !rm command</span>
      <span class="comment-line"># if MSM-A has memeory card, please make sure MSM-B also has memeory card.</span>
      if {[regexp -- &#34;present&#34; $DUTs_info(DUT${numDUT},memoryCard)]} {
         set coreBuf [<a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls /usr/local/ext&#34;]
      } else {
         set coreFileList &#34;&#34;
         lappend coreFileList &#34;core\.\[a-z\]+\.\[0-9\]+ 0&#34;
         if {[<a name="::CompareRelease(4)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(5)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.4.0.1]&gt;=0} {
            set coreBuf [<a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls /usr/local/tmp&#34;]
         } else {
            <a name="::EnableDebugMode(6)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            set coreBuf [<a name="::GetKeyValue(6)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;!ls /scratch&#34; $coreFileList 1]
         }
      }
    }


      if {[regexp -nocase &#34;core.*&#34; $coreBuf]} {
         <a name="::report_start_test(10)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on memoryCard, mv to different name&#34;
         <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found core dump on memoryCard, mv to different name&#34;
         foreach coreFile $coreBuf {
            <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;coreFile:|$coreFile,[regexp -nocase &#34;core&#34; $coreFile]|&#34;
            if {[regexp -nocase &#34;core&#34; $coreFile]} {
               regsub -all {core} $coreFile Kore newCore
               set newCoreFile ${mod}_${date}_$newCore
               set newProcFile ${mod}_${date}_process_traces.tgz
               
              if { $msmType == &#34;primary&#34; } { 
               if {[regexp -- &#34;present&#34; $DUTs_info(DUT${numDUT},memoryCard)]} {
                  <a name="::report_start_test(11)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on memoryCard, mv to different name&#34;
                  <a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log&#34; 
                  <a name="::SendACmd(47)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv /usr/local/ext/$coreFile /usr/local/ext/$newCoreFile&#34;
                  <a name="::report_start_test(12)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                  <a name="::SendACmd(48)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv /usr/local/ext/process_traces.tgz /usr/local/ext/$newProcFile&#34;
                  <a name="::report_end_test(11)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  <a name="::report_end_test(12)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               } else {
                  if {[<a name="::CompareRelease(5)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(6)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.4.0.1]&gt;=0} {
                     <a name="::report_start_test(13)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on internal, mv to different name&#34;
                     <a name="::SendACmd(49)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv /usr/local/tmp/$coreFile /usr/local/tmp/$newCoreFile&#34;
                     <a name="::report_start_test(14)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                     <a name="::SendACmd(50)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv /usr/local/tmp/process_traces.tgz /usr/local/tmp/$newProcFile&#34;
                     <a name="::report_end_test(13)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                     <a name="::report_end_test(14)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  } else {
                     <a name="::report_start_test(15)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on scratch, mv to different name&#34;
                     <a name="::SendACmd(51)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/$coreFile /scratch/$newCoreFile&#34;
                     <a name="::report_start_test(16)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                     <a name="::SendACmd(52)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/process_traces.tgz /scratch/$newProcFile&#34;
                     <a name="::report_end_test(15)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                     <a name="::report_end_test(16)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  }
               }
              } else {
               <span class="comment-line"># if MSM-A has memeory card, please make sure MSM-B also has memeory card.</span>
               if {[regexp -- &#34;present&#34; $DUTs_info(DUT${numDUT},memoryCard)]} {
                  <a name="::report_start_test(17)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on memoryCard, mv to different name&#34;
                  <a name="::SendACmd(53)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /mnt/a/$coreFile /mnt/a/$newCoreFile&#34;
                  <a name="::report_start_test(18)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                  <a name="::SendACmd(54)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /mnt/a/process_traces.tgz /mnt/a/$newProcFile&#34;
                  <a name="::report_end_test(17)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  <a name="::report_end_test(18)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               } else {
                  if {[<a name="::CompareRelease(6)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(7)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${numDUT}] 11.4.0.1]&gt;=0} {
                     <a name="::report_start_test(19)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on internal, mv to different name&#34;
                     <a name="::SendACmd(55)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/intern/$coreFile /scratch/intern/$newCoreFile&#34;
                     <a name="::report_start_test(20)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                     <a name="::SendACmd(56)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/intern/process_traces.tgz /scratch/intern/$newProcFile&#34;
                     <a name="::report_end_test(19)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                     <a name="::report_end_test(20)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  } else {
                     <a name="::report_start_test(21)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core dump on scratch, mv to different name&#34;
                     <a name="::SendACmd(57)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/$coreFile /scratch/$newCoreFile&#34;
                     <a name="::report_start_test(22)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                     <a name="::SendACmd(58)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/process_traces.tgz /scratch/$newProcFile&#34;
                     <a name="::report_end_test(21)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                     <a name="::report_end_test(22)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
                  }
               }
              }
            }
         }
      }
   }
}


<strong><a name="::::ChangeTraceFileName_1242">proc <a href="SystemSetup.tcl-annot.html#::::ChangeTraceFileName">::::ChangeTraceFileName</a></a></strong><a name="::::ChangeTraceFileName"></a> {} {
   global DUTs_info MAIN
   global whichDutNow
   global currentTestNumber

   if { ![info exists currentTestNumber] } {
        set tempCurrentTestNumber &#34;main&#34;
   } else {
        set currentTestNumber [string trim $currentTestNumber]
        if {[regexp {(.*) *;.*} $currentTestNumber match match1]} {
           set tempCurrentTestNumber $match1
        } else {
           set tempCurrentTestNumber $currentTestNumber
        }
        set tempCurrentTestNumber [string trim $tempCurrentTestNumber]
   }


   set date [clock format [clock seconds] -format &#34;%m%d%I%p&#34;]
   if {[info exists MAIN(feature_directory)] &amp;&amp; $MAIN(feature_directory) != &#34;null&#34;} {
       set mod $MAIN(feature_directory)
   } else {
       set modStringList [split [file tail [pwd]] &#34;/&#34;]
       set modListLength [llength $modStringList]
       set mod [lindex $modStringList [expr $modListLength - 1]]
   }

   <a name="::EnableDebugMode(7)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a> ; <span class="comment-line"># Required for executing !mv and !rm command</span>
   if {[info exists DUTs_info(DUT${whichDutNow},coreFileTarget)] &amp;&amp; \
           $DUTs_info(DUT${whichDutNow},coreFileTarget) == &#34;memorycard&#34; } {
      set traceBuf [<a name="::SendACmd(59)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls /usr/local/ext&#34;]
   } else {
      set traceBuf [<a name="::SendACmd(60)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls /usr/local/tmp&#34;];
   }

   if {[regexp -nocase &#34;trace.*&#34; $traceBuf]} {
      <a name="::report_start_test(23)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found traces, mv to different name&#34;
      foreach traceFile $traceBuf {
         <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;traceFile:|$traceFile,[regexp -nocase trace $traceFile]|&#34;
         if {[regexp -nocase &#34;trace&#34; $traceFile]} {
            <span class="comment-line">#regsub -all {trace} $traceFile grace newTrace</span>
            <span class="comment-line">#set newTraceFile ${newTrace}_${mod}_${date}</span>
            <span class="comment-line">#set newTraceFile ${newTrace}_${mod}_${tempCurrentTestNumber}</span>
            set newTraceFile ${traceFile}_${mod}_${tempCurrentTestNumber}

            if {([info exist DUTs_info(DUT${whichDutNow},memoryCard)]) &amp;&amp; ( [regexp -- &#34;present&#34; $DUTs_info(DUT${whichDutNow},memoryCard)])} {
               <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found traces on memoryCard, mv to different name&#34;
               <a name="::report_start_test(24)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving traces&#34;
               <a name="::SendACmd(61)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv /usr/local/ext/$traceFile /usr/local/ext/$newTraceFile&#34;
               <a name="::report_end_test(23)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
            } else {
               if {[<a name="::CompareRelease(7)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(8)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.4.0.1]&gt;=0} {
                  <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found traces on /usr/local/tmp, mv to different name&#34;
                  <a name="::report_start_test(25)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving process traces&#34;
                  <a name="::SendACmd(62)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv /usr/local/tmp/$traceFile /usr/local/tmp/$newTraceFile&#34;
                  <a name="::report_end_test(24)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               } else {
                  <a name="::report_start_test(26)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving traces&#34;
                  <a name="::SendACmd(63)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/$traceFile /scratch/$newTraceFile&#34;
                  <a name="::report_end_test(25)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               }
            }
         }
      }
      <a name="::report_end_test(26)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
   }
}

<strong><a name="::::ChangeCoreFileName_1310">proc <a href="SystemSetup.tcl-annot.html#::::ChangeCoreFileName">::::ChangeCoreFileName</a></a></strong><a name="::::ChangeCoreFileName"></a> {} {
   global DUTs_info MAIN
   global whichDutNow
   global currentTestNumber
   global numDUT
   global spawn_id
   global spawn_ids
   global enableAbortTestCondition

   for {set i 1} {$i &lt;= $numDUT} {incr i} {
        global DUT${i}_CONNECT DUT${i}_CONNECTB
   }

   <span class="comment-line">#find out the ipAddr of this session if it is MSM-A or MSM-B</span>
   global hostname
   foreach name $hostname {
      if { $spawn_id == $spawn_ids($name) } {
           set ipAddr $name
      }
   }
   <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;hostname : $hostname , ipAddr : $ipAddr&#34;
   <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 60 ; <span class="comment-line"># Delay after process died as DUT takes some time to reboot</span>

   <span class="comment-line"># Verifying whether process died on master/backup.</span>
   if { [info exists DUT${whichDutNow}_CONNECTB] } {
      if { $ipAddr == [set DUT${whichDutNow}_CONNECTB] } {
          <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Backup ip address : [set DUT${whichDutNow}_CONNECTB] , ipAddr : $ipAddr&#34;
          <a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECT] -masterCheck 0 -CheckOperational 0
          set showSwitchOutput &#34;&#34;
          lappend showSwitchOutput &#34;{Current State:} {In *Sync} inLine exists&#34;
          <a name="::CheckKeyValue(5)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $showSwitchOutput -time {s: 1 i: 5 d: 150 f: 200 r} -comment &#34;check both MSMs up in sh switch output&#34;

         <a name="::SendACmd(64)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log warning&#34;
         <a name="::SendACmd(65)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log&#34;
         lappend getKey &#34;{Current State:} 1&#34;
         set stateA [<a name="::GetKeyValue(7)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show switch&#34; $getKey]
         <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stateA : $stateA&#34;
         if {[string tolower $stateA] == &#34;master&#34;} {
             <span class="comment-line"># Calling run msm-failover as reboot happened due to process died. </span>
             <span class="comment-line"># can not use MakeMSMBMaster.</span>
             <a name="::SendACmd(66)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;run msm-failover&#34;
             <a name="::exSleep(5)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 90
             <a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECTB] 
             <a name="::CheckOperational(1)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
         } else {
             <a name="::Login(12)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECTB] 
             <a name="::CheckOperational(2)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
         }
      } else {
          <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Master ip address : [set DUT${whichDutNow}_CONNECT] , ipAddr : $ipAddr&#34;
          <a name="::Login(13)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECTB] -masterCheck 0 -CheckOperational 0
          set showSwitchOutput &#34;&#34;
          lappend showSwitchOutput &#34;{Current State:} {In *Sync} inLine exists&#34;
          <a name="::CheckKeyValue(6)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $showSwitchOutput -time {s: 1 i: 5 d: 150 f: 200 r} -comment &#34;check both MSMs up in sh switch output&#34;

         <a name="::SendACmd(67)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log warning&#34;
         <a name="::SendACmd(68)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log&#34;
         lappend getKey &#34;{Current State:} 1&#34;
         set stateA [<a name="::GetKeyValue(8)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show switch&#34; $getKey]
         <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stateA : $stateA&#34;
         if {[string tolower $stateA] == &#34;backup&#34;} {
             <span class="comment-line"># Calling run msm-failover as reboot happened due to process died. </span>
             <span class="comment-line"># can not use MakeMSMAMaster.</span>
             <a name="::SendACmd(69)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;run msm-failover&#34;
             <a name="::exSleep(6)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 90
             <a name="::Login(14)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECT]
             <a name="::CheckOperational(3)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
         } else {
             <a name="::Login(15)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECT]
             <a name="::CheckOperational(4)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
         }
      }
   } else {
          <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Backup not exist. Dut ip address : [set DUT${whichDutNow}_CONNECT] , ipAddr : $ipAddr&#34;
          <a name="::Login(16)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECT]
   }

   <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Processing core files&#34; 
   if { ![info exists currentTestNumber] } {
       set tempCurrentTestNumber &#34;main&#34;
   } else {
         set currentTestNumber [string trim $currentTestNumber]
         set tempCurrentTestNumber $currentTestNumber
         if {[regexp {(.*) *;.*} $currentTestNumber match match1]} {
           set tempCurrentTestNumber $match1
         } else {
           set tempCurrentTestNumber $currentTestNumber
         }
   }
   set date [clock format [clock seconds] -format &#34;%m%d%I%p&#34;]
   if {[info exists MAIN(feature_directory)] &amp;&amp; $MAIN(feature_directory) != &#34;null&#34;} {
       set mod $MAIN(feature_directory)
   } else {
       set modStringList [split [file tail [pwd]] &#34;/&#34;]
       set modListLength [llength $modStringList]
       set mod [lindex $modStringList [expr $modListLength - 1]]
   }

   <span class="comment-line">#Login $DUTs_info(DUT$whichDutNow,connect) -masterCheck 1</span>
   <a name="::EnableDebugMode(8)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a> ; <span class="comment-line"># Required for executing !mv and !rm command</span>
   <a name="::SendACmd(70)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log warning&#34;
   <a name="::SendACmd(71)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log&#34;

   if {([info exist DUTs_info(DUT${whichDutNow},memoryCard)]) &amp;&amp; ([regexp -- &#34;present&#34; $DUTs_info(DUT${whichDutNow},memoryCard)])} {
      set coreBuf [<a name="::SendACmd(72)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls /usr/local/ext&#34;]
   } else {
      if {[<a name="::CompareRelease(8)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(9)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.4.0.1]&gt;=0} {
         set coreBuf [<a name="::SendACmd(73)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls /usr/local/tmp&#34;]
      } else {
         set coreFileList &#34;&#34;
         lappend coreFileList &#34;core\.\[a-z\]+\.\[0-9\]+ 0&#34;
         set coreBuf [<a name="::GetKeyValue(9)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;!ls /scratch&#34; $coreFileList 1]
      }
   }

   if {[regexp -nocase &#34;core.*&#34; $coreBuf]} {
      <a name="::report_start_test(27)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: found core, mv to different name&#34;
      foreach coreFile $coreBuf {
         <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;coreFile:|$coreFile,[regexp -nocase core $coreFile]|&#34;
         if {([regexp -nocase &#34;core&#34; $coreFile]) &amp;&amp; (![regexp -nocase &#34;core.*\.gz_&#34; $coreFile]) &amp;&amp; (![regexp -nocase &#34;core\.nvram.*_&#34; $coreFile])} {
            set newCoreFile ${coreFile}_${mod}_${tempCurrentTestNumber}

            if {([info exist DUTs_info(DUT${whichDutNow},memoryCard)]) &amp;&amp; ( [regexp -- &#34;present&#34; $DUTs_info(DUT${whichDutNow},memoryCard)])} {
               <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found core on memoryCard, mv to different name&#34;
               <a name="::report_start_test(28)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving core&#34;
               <a name="::SendACmd(74)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv /usr/local/ext/$coreFile /usr/local/ext/$newCoreFile&#34;
               <a name="::report_end_test(27)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
            } else {
               if {[<a name="::CompareRelease(9)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(10)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.4.0.1]&gt;=0} {
                  <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NOTE: found core at /usr/local/tmp, mv to different name&#34;
                  <a name="::report_start_test(29)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving core&#34;
                  <a name="::SendACmd(75)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv /usr/local/tmp/$coreFile /usr/local/tmp/$newCoreFile&#34;
                  <a name="::report_end_test(28)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               } else {
                  <a name="::report_start_test(30)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;NOTE: moving core&#34;
                  <a name="::SendACmd(76)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mv /scratch/$coreFile /scratch/$newCoreFile&#34;
                  <a name="::report_end_test(29)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
               }
            }
         }
      }
      <a name="::report_end_test(30)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
   }
  if { ([info exists enableAbortTestCondition] ) &amp;&amp; ($enableAbortTestCondition ==&#34;coreDump&#34;) } {
    exit
  }
}
<strong><a name="::::EnableBGPServiceProviderEdgeLicence_1457">proc <a href="SystemSetup.tcl-annot.html#::::EnableBGPServiceProviderEdgeLicence">::::EnableBGPServiceProviderEdgeLicence</a></a></strong><a name="::::EnableBGPServiceProviderEdgeLicence"></a> { {duts &#34;&#34;} } {
   global DUTs_info

   if {$duts==&#34;&#34;} {
      set duts 1 
   }
   set dutList [split $duts ,]
   foreach dut $dutList {
      set DUTName [format %s%d DUT $dut]
      global ${DUTName}_CONNECT
      <a name="::Login(17)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT]

   if { [<a name="::CompareRelease(10)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(11)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${dut}] 12.1] &gt;=0 &amp;&amp; \
        [regexp -nocase &#34;X450e|X250e&#34; $DUTs_info(DUT${dut},platform)] } {
      set licenseInfo [<a name="::SendACmd(77)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show licenses&#34;]
     if {[regexp -nocase &#34;ServiceProviderEdge&#34; $licenseInfo] !=1} {
         <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Platform is not enabled with ServiceProviderEdge license&#34;
            if { [info exist DUTs_info(DUT${dut},bgp)] } {
                 <a name="::SendACmd(78)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${dut},bgp)&#34;
                 set licenseInfo [<a name="::SendACmd(79)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show licenses&#34;]
                 if {[regexp -nocase &#34;ServiceProviderEdge&#34; $licenseInfo] !=1} {
                     <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Platform is not enabled with BGP ServiceProviderEdge license.&#34;
	             <a name="::close_result_file(4)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
	             <a name="::report_end_test(31)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
                     return -code return testSkipped
                  }
             } else {
                    <a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ServiceProviderEdge licence key for bgp does not exist in cfg file. Please add the same and restart regression&#34;
	             <a name="::close_result_file(5)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
	             <a name="::report_end_test(32)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
                     return -code return testSkipped
             }
      } else {
         <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$DUTName is enabled with ServiceProviderEdge license&#34;
      }
    } else {
         <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$DUTName is not X450e|X250e or release &lt;12.1 does not require ServiceProviderEdge license&#34;
    }
   }

}
<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: _SetSwitchLicVars</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Internal proc to set the main license vars for a switch</span>
<span class="comment-line">#        </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: nDUT - which DUT</span>
<span class="comment-line">#             setLic - 1|0   1 sets the switch licenses</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 SetFeatureLicenses</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::_SetSwitchLicVars_1513">proc <a href="SystemSetup.tcl-annot.html#::::_SetSwitchLicVars">::::_SetSwitchLicVars</a></a></strong><a name="::::_SetSwitchLicVars"></a> {nDUT setLic} {
    global DUTs_info
    set ser $DUTs_info(DUT${nDUT},serial)
    set genFilePath &#34;&#34;
    if {![info exists DUTs_info(DUT${nDUT},serial)] || $ser == &#34;null&#34;} {
        return -1
    }
    if {[file exists keygen]} {
        set genFilePath &#34;./&#34;
    } elseif {[file exists ../main/keygen]} {
        set genFilePath &#34;../main/&#34;
    } elseif {[file exists ../../main/keygen]} {
        set genFilePath &#34;../../main/&#34;
    } else {
        <a name="::result_error(12)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;@@\n!!\nYour TCL sandbox is not configured to allow \n\
                      realtime licensing!\nset skipLicVar 0 in your cfg file\n and\
                      set your licenses to core manually\nOR \
                      email sqaauto to have this enabled if possible\n!!\n@@&#34;
        return -3
    }
    if {![regexp -nocase &#34;stack&#34; $DUTs_info(DUT${nDUT},sysName)] &amp;&amp; \
        $ser != &#34;null&#34;} {
        <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n@@@\nSetting $nDUT license VARS\n$DUTs_info(DUT${nDUT},sysType)\n@@@&#34;
        <span class="comment-line"># Device X670V-48x Serial Number - 1114G-01914 </span>
        set key [exec ${genFilePath}keygen 2 -d 3 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},advancededge_core) &#34;$key&#34;
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},unknown_core) &#34;$key&#34;
        set key [exec ${genFilePath}keygen 4 -d 1 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},advancedcore_edge) &#34;$key&#34;
        set key [exec ${genFilePath}keygen 2 -d 4 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},advancededge_advancedcore) &#34;$key&#34;
        set key [exec ${genFilePath}keygen 3 -d 4 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},core_advancedcore) &#34;$key&#34;
        set key [exec ${genFilePath}keygen 1 -d 2 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},edge_advancededge) &#34;$key&#34;
        set key [exec ${genFilePath}keygen 1 -d 3 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},edge_core) &#34;$key&#34;

        if {$setLic} {
            <span class="comment-line"># ------------------------------------------------</span>
            <span class="comment-line"># Restore License to Core if not at Core</span>
            <span class="comment-line"># For lync L2-Edge</span>
            <span class="comment-line"># ------------------------------------------------</span>
            global bcmLynx pioneerPlatform
            set parameterList &#34;&#34;
            if {[regexp $bcmLynx $DUTs_info(DUT$nDUT,platform)]} {
                lappend parameterList &#34;L2.* exist&#34;;
            } else {
                lappend parameterList &#34;{core} exist&#34;;
            }
            if {[<a name="::CheckKeyValue(7)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show license&#34; $parameterList -reportResults 0]!=&#34;ok&#34;} {
                set parameterList &#34;&#34;
                lappend parameterList &#34;{Enabled License Level:} 0 1&#34;
                lappend parameterList &#34;{Enabled License Level:} 1 1&#34;
                set getLicense [<a name="::GetKeyValue(10)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show license&#34; $parameterList]
                if {[lindex [lindex $getLicense 0] 1] != &#34;&#34;} {
                    set temp [split [lindex $getLicense 0] &#34; &#34;]
                    set currentLicense [concat [lindex $temp 0][lindex $temp 1]]
                } else {
                    set temp [split [lindex $getLicense 0] &#34; &#34;]
                    set currentLicense [lindex $temp 0]
                }
                if {[<a name="::EnableLicense(2)"><a href="./LicenseMgr.tcl.html#::EnableLicense_23">::EnableLicense</a></a> \
                          [string tolower $currentLicense] core] == &#34;error&#34;} {
                    if {![regexp $pioneerPlatform $DUTs_info(DUT$nDUT,platform)]} {
                        return error
                    }
                }
            }
            unset parameterList
        }
        return 1
    } else {
        return -2
    }
}
<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: SetFeatureLicenses</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Using info from DUTs_info, set all featurepack licenses</span>
<span class="comment-line">#        </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: nDUT - which DUT</span>
<span class="comment-line">#    </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	 SetFeatureLicenses</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::_SetFeatureLicenses_1616">proc <a href="SystemSetup.tcl-annot.html#::::_SetFeatureLicenses">::::_SetFeatureLicenses</a></a></strong><a name="::::_SetFeatureLicenses"></a> {nDUT} {
    global DUTs_info pioneerChassis gnssChassis bcmPlatform gnssPlatform
    set ser $DUTs_info(DUT${nDUT},serial)
    set genFilePath &#34;&#34;

    if {![info exists DUTs_info(DUT${nDUT},serial)]} {
        return -1
    }
    if {[file exists keygen]} {
        set genFilePath &#34;./&#34;
    } elseif {[file exists ../main/keygen]} {
        set genFilePath &#34;../main/&#34;
    } elseif {[file exists ../../main/keygen]} {
        set genFilePath &#34;../../main/&#34;
    } else {
        return -3
    }
    if {![regexp -nocase &#34;stack&#34; $DUTs_info(DUT${nDUT},sysName)] &amp;&amp; \
        $ser != &#34;null&#34;} {
        <span class="comment-line"># Set all feature pack licenses in DUTs_info for test usage</span>
        <a name="::result_debug(42)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n@@@\nSetting $nDUT feature license VARS for $DUTs_info(DUT${nDUT},sysName)\n@@@&#34;
        <span class="comment-line">#High Speed Port Enable</span>
        set key [exec ${genFilePath}keygen -y 3 -c 3 -v 24 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},port_speed) &#34;$key&#34;
        <span class="comment-line">#MPLS</span>
        set key [exec ${genFilePath}keygen -p 4 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},mpls_license) &#34;$key&#34;
        <span class="comment-line">#BGP</span>
        set key [exec ${genFilePath}keygen -p 16 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},bgp) &#34;$key&#34;
        <span class="comment-line">#Network Timing </span>
        set key [exec ${genFilePath}keygen -p 3 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},nettiming_license) &#34;$key&#34;
        <span class="comment-line">#TRILL </span>
        set key [exec ${genFilePath}keygen -p 12 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},trill_license) &#34;$key&#34;
        <span class="comment-line">#3rdParty </span>
        set key [exec ${genFilePath}keygen -p 9 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},40_100_optics_license) &#34;$key&#34;
        <span class="comment-line">#AVB </span>
        set key [exec ${genFilePath}keygen -p 10 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},avb_license) &#34;$key&#34;
        <span class="comment-line">#X440G2 Quad 10Gig </span>
        set key [exec ${genFilePath}keygen -p 13 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},x440quad_license) &#34;$key&#34;
        <span class="comment-line">#X440G2 Dual 10Gig </span>
        set key [exec ${genFilePath}keygen -p 14 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},x440dual_license) &#34;$key&#34;
        <span class="comment-line">#OPENFLOW </span>
        set key [exec ${genFilePath}keygen -p 11 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},openflow_license) &#34;$key&#34;
        <span class="comment-line">#SSH </span>
        set key [exec ${genFilePath}keygen -p 32 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},ssh_license) &#34;$key&#34;
        <span class="comment-line">#HQOS </span>
        set key [exec ${genFilePath}keygen -p 2 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},hqos_license) &#34;$key&#34;
        <span class="comment-line">#Direct Attach </span>
        set key [exec ${genFilePath}keygen -p 7 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},direct_attach_license) &#34;$key&#34;
        <span class="comment-line">#FlowVSR </span>
        set key [exec ${genFilePath}keygen -p 8 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},flowvsr_license) &#34;$key&#34;
        <span class="comment-line">#Dev </span>
        set key [exec ${genFilePath}keygen -p 1 -n $ser]
        set keyList [split [string trim $key] &#34; &#34;]
        set key [lindex $keyList [expr [llength $keyList] - 1]]
        set DUTs_info(DUT${nDUT},dev_license) &#34;$key&#34;
    } else {
        return -2
    }
    <span class="comment-line"># --------------------------------------------------------------------------</span>
    <span class="comment-line"># Start setting</span>
    <span class="comment-line"># --------------------------------------------------------------------------</span>
    set parameterList &#34;&#34;
    for {set z 0} {$z&lt;8} {incr z} {
        lappend parameterList &#34;{Enabled Feature Packs:} $z 1&#34;
    }
    lappend parameterList &#34;{Enabled Port Speed:} 0 1&#34; ;<span class="comment-line"># 870 690 portspeed</span>
    set getFeature [<a name="::GetKeyValue(11)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show license&#34; $parameterList]
    if {![regexp -nocase &#34;stack&#34; $DUTs_info(DUT${nDUT},sysName)] &amp;&amp; \
        $ser != &#34;null&#34;} {
        <span class="comment-line"># Device $sysT Serial Number - 1114G-01914</span>
        <span class="comment-line">#PortSpeed</span>
        if {[regexp -nocase &#34;x870&#34; $DUTs_info(DUT${nDUT},sysType)] &amp;&amp; \
            ![regexp -nocase &#34;24&#34; $getFeature]} {
            <a name="::result_debug(43)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nSet Port Speed License&#34;
            <a name="::SendACmd(80)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},port_speed)&#34;
        }
        <span class="comment-line">#MPLS</span>
        if {[regexp -nocase &#34;vm|x620|x690|x870|x590|x770|x670|x480|x460|e4g|bd|g2&#34; $DUTs_info(DUT${nDUT},sysType)] &amp;&amp; \
            ![regexp -nocase &#34;mpls&#34; $getFeature]} {
            <a name="::result_debug(44)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nSet MPLS License&#34;
            <a name="::SendACmd(81)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},mpls_license)&#34;
        }
        <span class="comment-line">#BGP</span>
        if {[regexp -nocase &#34;vm|x620|x870|x690|x770|x670|x480|x460|e4g|bd|x440|650|450g2&#34; $DUTs_info(DUT${nDUT},sysType)] &amp;&amp; \
            ![regexp -nocase &#34;service&#34; $getFeature]} {
            <a name="::result_debug(45)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nSet Service Provider License&#34;
            <a name="::SendACmd(82)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},bgp)&#34;
        }
        <span class="comment-line">#Network Timing - CANNOT BE ENABLED WITH AVB gPTP</span>
        <span class="comment-line">#if {[regexp -nocase &#34;x870|x770|x670g2|x460|e4g&#34; $DUTs_info(DUT${nDUT},sysType)] &amp;&amp; \</span>
        <span class="comment-line">#    ![regexp -nocase &#34;timing&#34; $getFeature]} {</span>
        <span class="comment-line">#    SendACmd &#34;enable license $DUTs_info(DUT${nDUT},nettiming_license)&#34;</span>
        <span class="comment-line">#}</span>
        <span class="comment-line">#3rdParty</span>
        if {(![regexp -nocase &#34;party&#34; $getFeature] &amp;&amp; \
            ![regexp -nocase &#34;x150|x250|x350|x450|e4g|460&#34; $DUTs_info(DUT${nDUT},sysType)]) ||
            (![regexp -nocase &#34;party&#34; $getFeature] &amp;&amp; \
            [regexp -nocase &#34;g2&#34; $DUTs_info(DUT${nDUT},sysType)])} {
            <a name="::result_debug(46)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nSet 3rdParty Optics License&#34;
            <a name="::SendACmd(83)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},40_100_optics_license)&#34;
        }
        <span class="comment-line">#AVB - Not compatible with networktiming</span>
        if {[regexp -nocase &#34;x620|x770|x670|x460|x440|x430|x450g2&#34; $DUTs_info(DUT${nDUT},sysType)]  &amp;&amp; \
            ![regexp -nocase &#34;avb&#34; $getFeature]} {
            <span class="comment-line">#SendACmd &#34;enable license $DUTs_info(DUT${nDUT},avb_license)&#34;</span>
        }
        <span class="comment-line">#X440G2 Quad 10Gig license</span>
        if {[regexp -nocase &#34;X440G2&#34; $DUTs_info(DUT${nDUT},sysType)]  &amp;&amp; \
            ![regexp -nocase &#34;quad&#34; $getFeature]} {
            <a name="::SendACmd(84)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},x440quad_license)&#34;
        }
        <span class="comment-line">#X440G2 Dual 10Gig license</span>
        if {[regexp -nocase &#34;X440G2&#34; $DUTs_info(DUT${nDUT},sysType)]  &amp;&amp; \
            ![regexp -nocase &#34;dual&#34; $getFeature]} {
            <a name="::SendACmd(85)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},x440dual_license)&#34;
        }
        <span class="comment-line">##OPENFLOW</span>
        <span class="comment-line">#if {![regexp -nocase &#34;openflow&#34; $getFeature]} {</span>
        <span class="comment-line">#    result_debug &#34;\nSet OpenFlow License&#34;</span>
        <span class="comment-line">#    SendACmd &#34;enable license $DUTs_info(DUT${nDUT},openflow_license)&#34;</span>
        <span class="comment-line">#}</span>
        if {[regexp -nocase &#34;$pioneerChassis|$gnssChassis&#34; $DUTs_info(DUT${nDUT},sysType)] &amp;&amp; \
            ![regexp -nocase &#34;qos&#34; $getFeature]} {
            <span class="comment-line">#HQOS</span>
            <a name="::result_debug(47)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Set HQOS License&#34;
            <a name="::SendACmd(86)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},hqos_license)&#34;
        }
        <span class="comment-line">#Direct Attach</span>
        if {[regexp -nocase &#34;$bcmPlatform&#34; $DUTs_info(DUT${nDUT},sysType)]  &amp;&amp; \
            ![regexp -nocase &#34;direct&#34; $getFeature]} {
            <a name="::result_debug(48)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Set Direct Attach License&#34;
            <a name="::SendACmd(87)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},direct_attach_license)&#34;
        }
        <span class="comment-line">#FlowVSR</span>
        if {[regexp -nocase &#34;$gnssPlatform&#34; $DUTs_info(DUT${nDUT},sysType)]  &amp;&amp; \
            ![regexp -nocase &#34;vsr&#34; $getFeature]} {
            <a name="::result_debug(49)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Set Flow VSR License&#34;
            <a name="::SendACmd(88)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},flowvsr_license)&#34;
        }
    } else {
        <a name="::result_debug(50)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Can't set feature licenses on Stacks yet&#34;
        return -3
        <span class="comment-line"># SKIP STACK FOR NOW.. ALL SLOTS NEED TO BE SET INDIVIDUALLY</span>
        <span class="comment-line">#     DEFER TO LATER</span>
        <span class="comment-line">#MPLS</span>
        set goMPLS 1
        foreach hw $DUTs_info(DUT${nDUT},hwList) {
            if {![regexp -nocase &#34;x770|x670|x480|x460|e4g|empty&#34; $hw]} {
                set goMPLS 0
                break
            }
        }
        if {$goMPLS &amp;&amp; ![regexp -nocase &#34;mpls&#34; $getFeature]} {
            <a name="::SendACmd(89)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},mpls_license)&#34;
        }
        <span class="comment-line">#BGP</span>
        set goBGP 1
        foreach hw $DUTs_info(DUT${nDUT},hwList) {
            if {![regexp -nocase &#34;x770|x670|x480|x460|e4g|x440|empty&#34; $hw]} {
                set goBGP 0
                break
            }
        }
        if {$goBGP &amp;&amp; ![regexp -nocase &#34;service&#34; $getFeature]} {
            <a name="::SendACmd(90)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},bgp)&#34;
        }
        <span class="comment-line">#Network Timing</span>
        set goTiming 1
        foreach hw $DUTs_info(DUT${nDUT},hwList) {
            if {![regexp -nocase &#34;x770|x670g2|x460|e4g|empty&#34; $hw]} {
                set goTiming 0
                break
            }
        }
        <span class="comment-line"># Timing cannot be enabled same time as AVB</span>
        <span class="comment-line">#if {$goTiming &amp;&amp; ![regexp -nocase &#34;timing&#34; $getFeature]} {</span>
        <span class="comment-line">#    SendACmd &#34;enable license $DUTs_info(DUT${nDUT},nettiming_license)&#34;</span>
        <span class="comment-line">#}</span>
        <span class="comment-line">#3rdParty</span>
        set go3rd 1
        foreach hw $DUTs_info(DUT${nDUT},hwList) {
            if {[regexp -nocase &#34;x450|x350|x250|x150&#34; $hw]} {
                set go3rd 0
                break
            }
        }
        if {$go3rd &amp;&amp; ![regexp -nocase &#34;part&#34; $getFeature]} {
            <a name="::SendACmd(91)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},40_100_optics_license)&#34;
        }
        <span class="comment-line">#AVB</span>
        set goAVB 1
        foreach hw $DUTs_info(DUT${nDUT},hwList) {
            if {![regexp -nocase &#34;x770|x670|x460|x440|x430|empty&#34; $hw]} {
                set goAVB 0
                break
            }
        }
        <span class="comment-line"># Don't install AVB. Not compatible with NetworkTiming</span>
        <span class="comment-line">#if {$goAVB &amp;&amp; ![regexp -nocase &#34;avb&#34; $getFeature]} {</span>
        <span class="comment-line">#    SendACmd &#34;enable license $DUTs_info(DUT${nDUT},nettiming_license)&#34;</span>
        <span class="comment-line">#}</span>
        <span class="comment-line">#OPENFLOW</span>
        if {![regexp -nocase &#34;openflow&#34; $getFeature]} {
            <a name="::SendACmd(92)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},openflow_license)&#34;
        }
        <span class="comment-line">#Direct Attach</span>
        if {![regexp -nocase &#34;direct&#34; $getFeature]} {
            <a name="::SendACmd(93)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable license $DUTs_info(DUT${nDUT},direct_attach_license)&#34;
        }
    }
}
<span class="comment-line">####################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">####################################################################</span>
<strong><a name="::::CheckConnectionsTraffic_1871">proc <a href="SystemSetup.tcl-annot.html#::::CheckConnectionsTraffic">::::CheckConnectionsTraffic</a></a></strong><a name="::::CheckConnectionsTraffic"></a> {dutList fd_res testNo} {
    global portDutListUsed SOURCEMACFDB portMappingList DUTPortMappingArray MACCHECKED

    set allPortIdList &#34;&#34;
    set MACCHECKED &#34;&#34;
    set initportMappingList $portMappingList
    set initportDutListUsed $portDutListUsed
    array set initDUTPortMappingArray [array get DUTPortMappingArray]
    
    set tagId [<a name="::random(2)"><a href="./mysqlLib.tcl.html#::random_1092">::random</a></a> 4094]
    foreach dut $dutList {
        global DUT${dut}_CONNECT
        <a name="::Login(18)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [set DUT${dut}_CONNECT]  -masterCheck 0 -CheckOperational 0
        <span class="comment-line"># Turn off flooding and broadcast</span>
        <a name="::SendACmd(94)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable edp port all&#34;
        <a name="::SendACmd(95)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable lldp port all&#34;
        <a name="::SendACmd(96)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable flooding all_cast port all&#34;
        <a name="::SendACmd(97)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan default delete ports all&#34;
        if {$tagId==1||$tagId==0} {set tagId 2}
        <a name="::SendACmd(98)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan ixiaVlan&#34;
        <a name="::SendACmd(99)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable igmp&#34;
        <a name="::SendACmd(100)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable igmp snooping&#34;
        set output  [<a name="::SendACmd(101)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;]          
        <a name="::result_debug(51)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;output :: $output&#34;
        if {[regexp -nocase &#34;Error&#34; $output]} {                
            set tagId 3
            <a name="::SendACmd(102)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;
        }
        <a name="::SendACmd(103)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port all tag&#34;
        <span class="comment-line"># Make a list of all portIds in use</span>
        foreach portDutPair $portDutListUsed {
            if {[lindex $portDutPair 1] == $dut} {
                lappend allPortIdList [lindex $portDutPair 0]
            }
        }
    }    
    <a name="::exSleep(7)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
    set initallPortIdList $allPortIdList
    <span class="comment-line"># Check the traffic - Check a second time on first failure.</span>
    global SKIPBROADCOMFDB
    set SKIPBROADCOMFDB 1
    set loopCount 1
    set repErrorAsSkip 1
    while {$loopCount &lt;= 2} {
        <a name="::report_start_test(31)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check Test Bed Connections Attempt $loopCount&#34;
        <span class="comment-line"># Start all traffic to all duts</span>
        foreach pId $allPortIdList {
            set frameSent [<a name="::SendFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $pId -tag $tagId -frameSize 68 \
                 -frameRate 100 -streamType &#34;contPacket&#34; -destMac ff:ff:ff:ff:ff:ff]
            set sourceMac [<a name="::GetSourceMacAddress(2)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameSent]
            set SOURCEMACFDB($pId) [<a name="::IxiaMacFormat2FdbFormat(2)"><a href="./misc.tcl.html#::IxiaMacFormat2FdbFormat_92">::IxiaMacFormat2FdbFormat</a></a> $sourceMac]
        }
        <a name="::exSleep(8)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 30
        foreach pId $allPortIdList {
            <a name="::StopPortsTransmit(2)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $pId
        }
    
        array set VerifyCCReturn &#34;&#34;
        array set VerifyEDPReturn &#34;&#34;
        foreach dut $dutList {
            puts &#34;CHECK TRAFFIC Logging into DUT $dut&#34;
            <a name="::Login(19)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECT]
            set VerifyCCReturn($dut) [<a name="::::_verifyCCFdb(1)"><a href="./SystemSetup.tcl.html#::::_verifyCCFdb_1988">::::_verifyCCFdb</a></a> $dut $repErrorAsSkip $fd_res $testNo]
            set VerifyLLDPReturn($dut) [<a name="::::_verifyTestBedLLDP(1)"><a href="./SystemSetup.tcl.html#::::_verifyTestBedLLDP_2370">::::_verifyTestBedLLDP</a></a> [set DUT${dut}_CONNECT] $dutList $repErrorAsSkip]
        }

        set returnFlag ok
        puts &#34;&#34;;
        foreach dut $dutList {
            <span class="comment-line">#puts &#34;EDP DUT$dut Found: $VerifyEDPReturn($dut)&#34;</span>
            <span class="comment-line">#if {!$VerifyEDPReturn($dut)} {</span>
            <span class="comment-line">#    set returnFlag error</span>
            <span class="comment-line">#}</span>
            puts &#34;LLDP DUT$dut Found: $VerifyLLDPReturn($dut)&#34;
            if {!$VerifyLLDPReturn($dut)} {
                set returnFlag error
            }
            puts &#34;Check FDB DUT$dut : $VerifyCCReturn($dut)&#34;
            if {$VerifyCCReturn($dut) != &#34;ok&#34;} {
                set returnFlag error
            }
        }
        if {$returnFlag == &#34;error&#34;} {
            <a name="::result_debug(52)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;HIT ERROR ON PASS $loopCount&#34;
            set portMappingList $initportMappingList
            set portDutListUsed $initportDutListUsed
            set allPortIdList $initallPortIdList
            array set DUTPortMappingArray [array get initDUTPortMappingArray]
            incr loopCount
            <a name="::exSleep(9)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 60
            <a name="::report_end_test(33)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        } else {
            set loopCount 10
            <a name="::report_end_test(34)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        }
        incr repErrorAsSkip -1
    }
    <span class="comment-line">#</span>
    <span class="comment-line"># Clean up the traffic settings</span>
    <span class="comment-line">#</span>
    foreach dut $dutList {
        <a name="::Login(20)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [set DUT${dut}_CONNECT]
        <span class="comment-line"># Turn on flooding and broadcast</span>
        <a name="::SendACmd(104)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp port all&#34;
        <a name="::SendACmd(105)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable igmp&#34;
        <a name="::SendACmd(106)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable igmp snooping&#34;
        <a name="::SendACmd(107)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable lldp port all&#34;
        <a name="::SendACmd(108)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure lldp transmit-interval 30&#34;
        <a name="::SendACmd(109)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable flooding all_cast port all&#34;
        <a name="::SendACmd(110)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan default delete ports all&#34;
        <a name="::SendACmd(111)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan ixiaVlan&#34;
    }
    return $returnFlag
}
<span class="comment-line">######################################################################</span>
<span class="comment-line"># Single DUT Verify MAC</span>
<span class="comment-line">######################################################################</span>
<strong><a name="::::_verifyCCFdb_1988">proc <a href="SystemSetup.tcl-annot.html#::::_verifyCCFdb">::::_verifyCCFdb</a></a></strong><a name="::::_verifyCCFdb"></a> {testDUT repErrorAsSkip fd_res testNo} {
    global portDutListUsed SOURCEMACFDB portMappingList SKIPBROADCOMFDB FAILSUMMARY MACCHECKED
    
    set thisDutPorts &#34;&#34;
    set DUTPortList &#34;&#34;
    set portLearned 1
    set returnFlag &#34;ok&#34;
    set SKIPBROADCOMFDB 1
    foreach portDutPair $portDutListUsed {
        if {[lindex $portDutPair 1] == $testDUT} {
            lappend thisDutPorts [lindex $portDutPair 0]
        }
    }

    foreach portId $thisDutPorts {
        if { [regexp -nocase &#34;a&#34; [<a name="::MapDUTPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $testDUT] ] } {
            lappend detectMACList &#34;{$SOURCEMACFDB($portId) .*ixiaVlan.* d.*m} 1&#34;
        } else {
            lappend checkMACList &#34;$SOURCEMACFDB($portId) ixiaVlan [<a name="::MapDUTPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $testDUT] exist&#34;
        }
    }
    if {[info exists detectMACList]} {
        set DUTPortList [<a name="::GetKeyValue(12)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show fdb&#34; $detectMACList]
    }

    if {[info exists DUTPortList] &amp;&amp; [regexp &#34;NOT&#34; $DUTPortList] } {
        puts &#34;DEBUG DUTPortList: $DUTPortList&#34;
        set returnFlag &#34;error&#34;
        if {$repErrorAsSkip} {
            result_skip &#34;Unable to detect one or more connections on DUT$testDUT&#34;
        } else {
            <a name="::result_error(13)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Unable to detect one or more connections on DUT$testDUT&#34;
            set fout [<a name="::SendACmd(112)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show fdb&#34;]
            lappend FAILSUMMARY &#34;MAC not found on DUT$testDUT : $fout&#34;
        }
        <a name="::result_debug(53)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Please recheck all links&#34;
        set portLearned 0
    }    
    foreach portId $thisDutPorts {
        if { [regexp -nocase &#34;a&#34; [<a name="::MapDUTPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $testDUT] ] } {
            set portIndex [lsearch -regexp $detectMACList &#34;$SOURCEMACFDB($portId) .*ixiaVlan.* d.*m&#34;]
            <a name="::result_debug(54)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;@@@@@@@@@@@@@ Auto detecting portId: $portId DUTPort: [lindex $DUTPortList $portIndex]&#34;
            <a name="::result_debug(55)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Search portMappingList for: $portId *A * $testDUT&#34;
            set replaceIndex [lsearch -regexp $portMappingList &#34;$portId *A * $testDUT&#34;]
            if {$replaceIndex != -1} {
                set portMappingList [lreplace $portMappingList $replaceIndex $replaceIndex \
                                        &#34;$portId [lindex $DUTPortList $portIndex] $testDUT&#34;]
            }
        }
    }
    <a name="::result_debug(56)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;portMappingList: $portMappingList&#34;
    
    if {([info exists checkMACList] == 1)} {
        <span class="comment-line">################################################</span>
        set subTest &#34;Checking DUT$testDUT Connections via MAC fdb Learning&#34;
        <span class="comment-line">################################################</span>
        result_h2 &#34;$subTest&#34;
        <a name="::report_start_test(32)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
        set returnFlag [<a name="::::CheckFdbNoError(1)"><a href="./SystemSetup.tcl.html#::::CheckFdbNoError_2089">::::CheckFdbNoError</a></a> $checkMACList $repErrorAsSkip $testDUT $fd_res $testNo]
        unset checkMACList
        <a name="::report_end_test(35)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    } else {
        set returnFlag &#34;ok&#34;
    }
    
    <span class="comment-line">################################################</span>
    set subTest &#34;Detecting DUT$testDUT Connections via MAC fdb Learning&#34;
    <span class="comment-line">################################################</span>
    result_h2 &#34;$subTest&#34;
    <a name="::report_start_test(33)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
    <a name="::::SetupDUTConnections(3)"><a href="./SystemSetup.tcl.html#::::SetupDUTConnections_780">::::SetupDUTConnections</a></a>
    set dutSpecificPortMappingList &#34;&#34;
    foreach el $portMappingList {
        if {[lindex $el 2]==$testDUT} {
            lappend dutSpecificPortMappingList $el
        }
    }
    if {[regexp &#34;NOT&#34; $dutSpecificPortMappingList] } {
        set returnFlag &#34;error&#34;
        result_skip &#34;Unable to detect one or more connections on DUT$testDUT&#34;
        <a name="::result_debug(57)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Please recheck all links&#34;
    }
    <a name="::report_end_test(36)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    return $returnFlag
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckFdbNoError</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is a wrapper function of</span>
<span class="comment-line">#               CheckKeyValue &#34;show fdb&#34; $parameterList.</span>
<span class="comment-line">#       Check fdb table, by passing in a list instead of a file</span>
<span class="comment-line">#           -reportFailAsSkip 1</span>
<span class="comment-line"># Input args: {checkMACList} {fd} {testNo}</span>
<span class="comment-line">#       checkMACList is a list of mac, vlan, and ports</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># returns &#34;ok&#34; if success &#34;error&#34; if failure</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       set returnFlag [CheckFdb $checkMACList $fd_res $testNo]</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::CheckFdbNoError_2089">proc <a href="SystemSetup.tcl-annot.html#::::CheckFdbNoError">::::CheckFdbNoError</a></a></strong><a name="::::CheckFdbNoError"></a> {checkMACList reportFailAsSkip testDUT fd_res testNo} {
   global DUTs_info whichDutNow pioneerPlatform FAILSUMMARY MACCHECKED
   set c 1
   foreach checkMAC $checkMACList {
      set mac  [lindex $checkMAC 0]       ;<span class="comment-line"># mac</span>
      set vlan [lindex $checkMAC 1]       ;<span class="comment-line"># vlan</span>
      set port [lindex $checkMAC 2]       ;<span class="comment-line"># ports</span>
      set wantResult [lindex $checkMAC 3]
      if {$wantResult == &#34;notExist&#34;} {
         lappend parameterList &#34;{$mac .*$vlan.* d .* $port} $wantResult&#34;
      } else {
         lappend parameterList &#34;{$mac .*$vlan.*d.*m} $port&#34;
      }
   }
   set retValue [<a name="::CheckKeyValue(8)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show fdb&#34; $parameterList -reportFailAsSkip $reportFailAsSkip]
   if { $retValue == &#34;ok&#34; } {
       return $retValue
   } elseif {[regexp -nocase $pioneerPlatform $DUTs_info(DUT$whichDutNow,platform)]} {
       set retValue &#34;ok&#34;
       set fdbCheck &#34;ok&#34;
       foreach checkMAC $checkMACList {
            set mac  [lindex $checkMAC 0]       ;<span class="comment-line"># mac</span>
            set vlan [lindex $checkMAC 1]       ;<span class="comment-line"># vlan</span>
            set port [lindex $checkMAC 2]       ;<span class="comment-line"># ports</span>
            set wantResult [lindex $checkMAC 3]
            set parameterList &#34;&#34;
            if {$wantResult == &#34;notExist&#34;} {
                 lappend parameterList &#34;{$mac.*$vlan.*$port} $wantResult&#34;
            } else {
                  lappend parameterList &#34;{$mac.*$vlan.*$port} exist&#34;
            }
            set retValue [<a name="::CheckKeyValue(9)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show fdb hardware $mac $vlan slot all&#34; -reportFailAsSkip 1 $parameterList]
            if { $retValue != &#34;ok&#34; } {
              set fdbCheck &#34;error&#34;
            }
      }
      return $fdbCheck
   } else {
       return $retValue
   }
}
<span class="comment-line">##########################################################</span>
<span class="comment-line"># Check mgmt and inband connections</span>
<span class="comment-line">##########################################################</span>
<strong><a name="::::VerifyMgmtConnections_2133">proc <a href="SystemSetup.tcl-annot.html#::::VerifyMgmtConnections">::::VerifyMgmtConnections</a></a></strong><a name="::::VerifyMgmtConnections"></a> {numDUT {chk_fp &#34;yes&#34;}} {
    global DUT${numDUT}_CONNECT 
    global DUT${numDUT}_IP
    global DUT${numDUT}_IP_FP
    global DUT${numDUT}_DefaultBlade 
    global switchPort2DefaultRouter tftpServerList
    global DUTs_info netConFlag
    global FAILSUMMARY MAIN

    set tftpServer [lindex $tftpServerList 0]
    if {![info exists netConFlag]} {
        <a name="::result_debug(58)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The netConFlag flag does not exists&#34;
        set netConFlag 1
    }

    set connect [set DUT${numDUT}_CONNECT]
    set dut_ip [set DUT${numDUT}_IP]
    set def_blade [set DUT${numDUT}_DefaultBlade]
    if { $def_blade != 0 } {
        set port $def_blade:$switchPort2DefaultRouter
    } else {
        set port $switchPort2DefaultRouter
    }
    result_h2 &#34;Checking Network port for DUT$numDUT&#34;
    <a name="::report_start_test(34)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking Network port for DUT$numDUT&#34;

    <a name="::Login(21)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $connect  -masterCheck 0 -CheckOperational 0
    <a name="::SendACmd(113)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf default del po all&#34;
    <a name="::ConfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::ConfigGatewayNetwork_2110">::ConfigGatewayNetwork</a></a>
    set ret [<a name="::CheckCLIPing(1)"><a href="./ping.tcl.html#::CheckCLIPing_178">::CheckCLIPing</a></a> &#34;ping vr vr-mgmt $tftpServer&#34;]
    <a name="::exSleep(10)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
    <a name="::UnconfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::UnconfigGatewayNetwork_2356">::UnconfigGatewayNetwork</a></a>
    if { $ret == 1 } {
        <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Network connection for DUT$numDUT is PASS&#34;
        <a name="::_setMultiTaskVar(1)"><a href="./multiTask.tcl.html#::_setMultiTaskVar_167">::_setMultiTaskVar</a></a>  DUTs_info(DUT${numDUT},MgmtNetConnected) 1
    } else {
        <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;Network connection for DUT$numDUT is FAIL&#34;
        <a name="::_setMultiTaskVar(2)"><a href="./multiTask.tcl.html#::_setMultiTaskVar_167">::_setMultiTaskVar</a></a>  DUTs_info(DUT${numDUT},MgmtNetConnected) 0
        set netConFlag 0
    }
    <a name="::report_end_test(37)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

    if {$chk_fp == &#34;yes&#34;} {
        <span class="comment-line"># Validate InBandNetwork Connection</span>
        result_h2 &#34;Checking InBand Network port for DUT$numDUT&#34;
        <a name="::report_start_test(35)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking InBand Network port for DUT$numDUT&#34;
        if {![info exist DUT${numDUT}_IP_FP]} {
            <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;No InBand Network Configured for DUT$numDUT - PASS&#34;
            set DUTs_info(DUT${numDUT},InbandNetConnected) 0
            <a name="::_setMultiTaskVar(3)"><a href="./multiTask.tcl.html#::_setMultiTaskVar_167">::_setMultiTaskVar</a></a>  DUTs_info(DUT${numDUT},InbandNetConnected) 0
        } else {
            <a name="::ConfigInBandNetwork(1)"><a href="./SendSwCmd.tcl.html#::ConfigInBandNetwork_2283">::ConfigInBandNetwork</a></a>;
            global SERVER1
            <a name="::exSleep(11)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
            set ret [<a name="::CheckCLIPing(2)"><a href="./ping.tcl.html#::CheckCLIPing_178">::CheckCLIPing</a></a> &#34;ping vr vr-default $SERVER1&#34;]
            <a name="::exSleep(12)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
            if { $ret == 1 } {
                <a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;InBand Network connection for DUT$numDUT is PASS&#34;
                set DUTs_info(DUT${numDUT},InbandNetConnected) 1
                <a name="::_setMultiTaskVar(4)"><a href="./multiTask.tcl.html#::_setMultiTaskVar_167">::_setMultiTaskVar</a></a>  DUTs_info(DUT${numDUT},InbandNetConnected) 1
            } else {
                <a name="::result_warning(2)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;InBand Network connection for DUT$numDUT is FAIL&#34;
                set DUTs_info(DUT${numDUT},InbandNetConnected) 0
                <a name="::_setMultiTaskVar(5)"><a href="./multiTask.tcl.html#::_setMultiTaskVar_167">::_setMultiTaskVar</a></a>  DUTs_info(DUT${numDUT},InbandNetConnected) 0
                <a name="::SendACmd(114)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show vlan&#34;
                set netConFlag 0
            }
            <a name="::UnconfigInBandNetwork(1)"><a href="./SendSwCmd.tcl.html#::UnconfigInBandNetwork_2327">::UnconfigInBandNetwork</a></a>;
        }
        <a name="::report_end_test(38)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    }
}
<strong><a name="::::GeneralSetup_2205">proc <a href="SystemSetup.tcl-annot.html#::::GeneralSetup">::::GeneralSetup</a></a></strong><a name="::::GeneralSetup"></a> {testDUT} {
    global DUTs_info MAIN
    global DUT
    global env
    global whichDutNow
    global bcmPlatform bcmLynx;
    global lastDUT
    global numDUT
    global pioneerPlatform
    global FAILSUMMARY stackable
    <span class="comment-line">#------ adding this part of script to support eware duts</span>
    global eware_dut
    set firstSubStr &#34;DUT&#34;
    set lastSubStr &#34;_CONNECT&#34;

    <span class="comment-line"># ----- Switch config</span>
    global ${firstSubStr}${testDUT}${lastSubStr}
    <a name="::Login(22)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]

    <span class="comment-line"># testing tftp connectivity</span>
    set returnFlagTftp &#34;ok&#34;
    <span class="comment-line">#if {$returnFlagTftp == &#34;ok&#34;} {</span>
    <span class="comment-line">#  result_ok &#34;tftp server connectivity test passed&#34;</span>
    <span class="comment-line">#} else {</span>
    <span class="comment-line">#  result_error &#34;tftp server connectivity test failed&#34;</span>
    <span class="comment-line">#}</span>

    <a name="::Login(23)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
    <a name="::EnableDebugMode(9)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
    <a name="::SendACmd(115)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal configure sysrq 1&#34;
    <a name="::exSleep(13)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
    <a name="::DisableDebugMode(3)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>

    <span class="comment-line"># set regresession server time</span>
    set tm [exec date &#34;+%m %d %Y %H %M %S&#34;]
    set timeCmd &#34;configure time &#34;
    append timeCmd $tm
    <a name="::SendACmd(116)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> $timeCmd

    <span class="comment-line">#------ check added to skip license if not needed</span>
    set skipLicVar 1
    global skipLicenceCheck
    if [info exists skipLicenceCheck] {
        if {$skipLicenceCheck} {
            set skipLicVar 0
        }
    }
    <span class="comment-line">#</span>
    <span class="comment-line"># Licensing.</span>
    <span class="comment-line">#</span>
    if $skipLicVar {
        <span class="comment-line"># ------------------------------------------------</span>
        <span class="comment-line"># Disable the 30 day trial license</span>
        <span class="comment-line"># ------------------------------------------------</span>
        set parameterList &#34;&#34;
        lappend parameterList &#34;{30 days Trial} exist&#34;
        set result [<a name="::CheckKeyValue(10)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show license&#34; $parameterList -reportResults 0]
        if {$result == &#34;ok&#34;} {
            <a name="::EnableDebugMode(10)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            <a name="::SendACmd(117)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug epm clear trial-license&#34;
            <a name="::CheckReboot(2)"><a href="./SendSwCmd.tcl.html#::CheckReboot_1202">::CheckReboot</a></a>
        }

        <span class="comment-line"># ------------------------------------------------</span>
        <span class="comment-line"># Restore License to Core if not at Core</span>
        <span class="comment-line"># For lync L2-Edge</span>
        <span class="comment-line"># ------------------------------------------------</span>
        <span class="comment-line"># Set the license keys dynamically</span>
        set varout [<a name="::::_SetSwitchLicVars(2)"><a href="./SystemSetup.tcl.html#::::_SetSwitchLicVars_1513">::::_SetSwitchLicVars</a></a> $testDUT 1]
        set parameterList &#34;&#34;
        <span class="comment-line"># EY-06-08-2007: Check for L2(edge) license for Lynx platform.</span>
        if {[regexp $bcmLynx $DUTs_info(DUT$testDUT,platform)]} {
            lappend parameterList &#34;L2.* exist&#34;;
        } else {
            lappend parameterList &#34;{core} exist&#34;;
        }
        if {[<a name="::CheckKeyValue(11)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show license&#34; $parameterList]!=&#34;ok&#34;} {
            if {1} {
                set parameterList &#34;&#34;
                lappend parameterList &#34;{Enabled License Level:} 0 1&#34;
                lappend parameterList &#34;{Enabled License Level:} 1 1&#34;
                set getLicense [<a name="::GetKeyValue(13)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show license&#34; $parameterList]
                if {[lindex [lindex $getLicense 0] 1] != &#34;&#34;} {
                    set temp [split [lindex $getLicense 0] &#34; &#34;]
                    set currentLicense [concat [lindex $temp 0][lindex $temp 1]]
                } else {
                    set temp [split [lindex $getLicense 0] &#34; &#34;]
                    set currentLicense [lindex $temp 0]
                }
                if {[<a name="::EnableLicense(3)"><a href="./LicenseMgr.tcl.html#::EnableLicense_23">::EnableLicense</a></a> \
                    [string tolower $currentLicense] core] == &#34;error&#34;} {
                    if {![regexp $pioneerPlatform $DUTs_info(DUT$testDUT,platform)]} {
                        return error
                    }
                }
            } else {
                if {![regexp $pioneerPlatform $DUTs_info(DUT$testDUT,platform)]} {
                   return error
                }
            }
        }
        unset parameterList
        <span class="comment-line"># ------------------------------------------------</span>
        <span class="comment-line"># Restore Feature Packs if they are supported on this platform</span>
        <span class="comment-line"># ------------------------------------------------</span>
        if {![regexp -nocase &#34;stack&#34; $DUTs_info(DUT${testDUT},sysName)] &amp;&amp;
           $DUTs_info(DUT${testDUT},serial) != &#34;null&#34;} {
            set fvarout [<a name="::::_SetFeatureLicenses(2)"><a href="./SystemSetup.tcl.html#::::_SetFeatureLicenses_1616">::::_SetFeatureLicenses</a></a> ${testDUT}]
        }
        ;<span class="comment-line"># ------------- End Feature License -----------</span>
    } ;<span class="comment-line"># ------------ End of all Licensing -----------</span>

    <a name="::SendACmd(118)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
    <a name="::SendACmd(119)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
    <a name="::SendACmd(120)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable idletime&#34;
    <a name="::SendACmd(121)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable edp ports all&#34;
    <a name="::SendACmd(122)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable lldp ports all&#34;
    <a name="::SendACmd(123)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ports all&#34;
    <a name="::SendACmd(124)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable auto-provision&#34;
    <a name="::SendACmd(125)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con edp advertisement-interval 15 holddown-interval 600&#34;
    <a name="::SendACmd(126)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con lldp transmit-interval 5&#34;
    <a name="::EnableDebugMode(11)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>

    if {[info exists DUTs_info(DUT${testDUT},coreFileTarget)]} {
        <a name="::SendACmd(127)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure debug core-dumps $DUTs_info(DUT${testDUT},coreFileTarget)&#34;
    }
    if {[info exists MAIN(feature_directory)] &amp;&amp; $MAIN(feature_directory) != &#34;null&#34;} {
        <a name="::::CheckForPreviousCore(3)"><a href="./SystemSetup.tcl.html#::::CheckForPreviousCore_1127">::::CheckForPreviousCore</a></a> $testDUT
        if {[info exists $firstSubStr$testDUT${lastSubStr}B]} {
            <a name="::result_debug(59)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Renaming core on msm-b if any&#34;
            <a name="::Login(24)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT${lastSubStr}B] -masterCheck 0 -CheckOperational 0
            <a name="::::CheckForPreviousCore(4)"><a href="./SystemSetup.tcl.html#::::CheckForPreviousCore_1127">::::CheckForPreviousCore</a></a> $testDUT backup
            <a name="::Login(25)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT${lastSubStr}] -masterCheck 0 -CheckOperational 0
        }
    }
    if { [<a name="::::isExosPlatform(2)"><a href="./SystemSetup.tcl.html#::::isExosPlatform_970">::::isExosPlatform</a></a> &#34;DUT$testDUT&#34;] != 1 } {
        <span class="comment-line"># ----- Switch config</span>
        <a name="::Login(26)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
        <a name="::SendACmd(128)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
        <a name="::SendACmd(129)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear fdb&#34;
        <a name="::SendACmd(130)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
        <a name="::SendACmd(131)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable idletime&#34;
        <a name="::SendACmd(132)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable auto-provision&#34;
        <a name="::SendACmd(133)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure reboot-loop-protection threshold 10 3&#34;
        <a name="::SendACmd(134)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable edp ports all&#34;

        lappend parameterList &#34;{Image *:.*by} $RELEASE_MASTER&#34;
        <a name="::CheckKeyValue(12)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show version&#34; $parameterList -comment &#34;- Show $RELEASE_MASTER&#34;
        unset parameterList

        set version [<a name="::GetVersion(12)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> &#34;DUT$testDUT&#34; &#34;2&#34;]
        puts &#34;DUT$testDUT version: $version&#34;
    }
}
<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: _verifyTestBedLLDP</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#        </span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Return value: 1 or 0</span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#        _verifyTestBedLLDP</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::_verifyTestBedLLDP_2370">proc <a href="SystemSetup.tcl-annot.html#::::_verifyTestBedLLDP">::::_verifyTestBedLLDP</a></a></strong><a name="::::_verifyTestBedLLDP"></a> {DUT DUTList {repErrorAsSkip 0}} {
    global DUTs_info
    global whichDutNow
    global trunkPortList
    global lastDUT
    global checkHubConnection
    global FAILSUMMARY

    <a name="::Login(27)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT
    set lldpList &#34;&#34;
    if {[llength $DUTList] &gt; 1 &amp;&amp; [info exists trunkPortList]} {
        for {set i 0} {$i&lt;[llength $trunkPortList]} {incr i} {
            set trunkPair [lindex $trunkPortList $i]
            set localDUT [lindex $trunkPair 0]
            set remoteDUT [lindex $trunkPair 1]
            if {$remoteDUT==0} continue;
            if {$localDUT==$whichDutNow} {
                if {$localDUT&lt;$remoteDUT} {
                    lappend lldpList &#34;{[lindex $trunkPair 2] .* $DUTs_info(DUT$remoteDUT,sysMAC) *\
                             [lindex [lindex $trunkPortList [expr $i+1]] 2]} exist&#34;
                } else {
                    lappend lldpList &#34;{[lindex $trunkPair 2] .* $DUTs_info(DUT$remoteDUT,sysMAC) *\
                             [lindex [lindex $trunkPortList [expr $i-1]] 2]} exist&#34;
                }
            }
        }

        <span class="comment-line"># Check connection of DUT with HUB and if doesn't exist return connectionBad</span>
        if {([info exists checkHubConnection] == 1) &amp;&amp; $checkHubConnection == 0} {
            <span class="comment-line">#do nothing skip the hub connection check</span>
            puts &#34;NO HUB CHECK&#34;
        } else {
            set DUT_Cnt [llength $DUTList]
            set retHubConnVal 0 
            for {set i $lastDUT} {$i&lt;[llength $trunkPortList]} {incr i} {
                set trunkPair [lindex $trunkPortList $i]
                set localDUT [lindex $trunkPair 0]
                puts &#34;trunkPair $trunkPair localDUT $localDUT&#34;
                if {$lastDUT==$localDUT} continue;
                set remoteDUT [lindex $trunkPair 1]
                set localDUTPort [lindex $trunkPair 2]
                if {$remoteDUT!=0} continue;
                for {set j 1} {$j&lt;=$DUT_Cnt} {incr j} {
                    if {$j==$localDUT} continue; 
                    set DUT_HUBPortMap [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $j $remoteDUT] 
                    set DUT_Mac [<a name="::GetDUTMac(2)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> DUT$j]
                    global stackable i386Stackable
                    puts &#34;$localDUTPort .*$DUT_Mac *$DUT_HUBPortMap&#34;
                    lappend lldpList &#34;{$localDUTPort .*$DUT_Mac *$DUT_HUBPortMap } exist&#34;
                }
                set lastDUT $localDUT
                break;
            }
        }
        set fd_lldp [open &#34;Tmp/tmp_lldp[pid]&#34; &#34;w&#34;]
        <span class="comment-line"># Build regular expression pattern for LLDP neighbor MAC address.</span>
        set key {^[0-9]+}
        set output [<a name="::SendACmd(135)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show lldp neighbor&#34; NULL $fd_lldp]
        close $fd_lldp        
        if {[regexp -line $key $output]!=1} {
            if {$repErrorAsSkip} {
                result_skip &#34;LLDP did not find neighbors ...&#34;
            } else {
                <a name="::result_error(14)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;LLDP did not find neighbors ...&#34;
                set fout [<a name="::SendACmd(136)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show lldp&#34;]
                lappend FAILSUMMARY &#34;LLDP did not find neighbors DUT $whichDutNow&#34;
            }
            file delete &#34;Tmp/tmp_lldp[pid]&#34;
            return -1
        } else {
            if {$repErrorAsSkip} {
                set output [<a name="::CheckKeyValue(13)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;Tmp/tmp_lldp[pid]&#34; $lldpList -reportFailAsSkip 1 \
                     -comment &#34;for file operation: Check LLDP info&#34;]
            } else {
                set output [<a name="::CheckKeyValue(14)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;Tmp/tmp_lldp[pid]&#34; $lldpList \
                     -comment &#34;for file operation: Check LLDP info&#34;]
            }
            file delete &#34;Tmp/tmp_lldp[pid]&#34;
            if {$output==&#34;ok&#34;} {
                return 1
            } else {
                set fout [<a name="::SendACmd(137)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show lldp&#34;]
                lappend FAILSUMMARY &#34;LLDP did not find ALL neighbors DUT $whichDutNow &#34;
                return 0
            }
        }
    } else {
        return 1
    }
}
<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: SystemSetup2</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       Do ixia initialization, build portMapping, and optionally </span>
<span class="comment-line">#       check connections setup.</span>
<span class="comment-line">#       Performs CheckConnection if CheckConnection is set</span>
<span class="comment-line">#       otherwise basic cli setup on DUTs</span>
<span class="comment-line"># Input args: none </span>
<span class="comment-line"># Return value: ConnectionOkay or Connectionbad</span>
<span class="comment-line"># Output args: none </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#        SystemSetup</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SystemSetup2_2474">proc <a href="SystemSetup.tcl-annot.html#::::SystemSetup2">::::SystemSetup2</a></a></strong><a name="::::SystemSetup2"></a> {} {

    <span class="comment-line">################################################################</span>
    set testNo &#34;System Setup and Verification&#34;
    set title $testNo
    <span class="comment-line">################################################################</span>

    <span class="comment-line"># ----- Environment variables setup</span>
    global DUT1_CONNECT
    global ixiaCh1
    global startCardNum
    global portMappingList
    global trunkPortList
    global checkConnection
    global switchPort2DefaultRouter
    global ixiaPortMappingArray
    global MAIN
    global RELEASE_MASTER
    global DUTs_info
    global exos
    global DUT
    global env
    global whichDutNow
    global bcmPlatform bcmLynx;
    global lastDUT
    global numDUT 
    global pioneerPlatform 
    global defaultRouter
    global bootpserver
    global tftpServerList
    global MGMT_REG
    global FAILSUMMARY
    global VERBOSE
     

    set useNewMethod 1
    set SKIPBROADCOMFDB 1
    set FAILSUMMARY &#34;&#34;
    lappend FAILSUMMARY &#34;\n@@@@@@@@@@@@@@   Start FAIL SUMMARY   @@@@@@@@@@@@@@@&#34;

    <a name="::UpdateTrackDBTxt(2)"><a href="./resource_track.tcl.html#::UpdateTrackDBTxt_133">::UpdateTrackDBTxt</a></a> &#34;executing: SystemSetup&#34;;<span class="comment-line"># tracking db location</span>

    <span class="comment-line"># Hack added for Everest; remove later -GV</span>
    global skipEdpCheck
    if [info exists skipEdpCheck] {
        if {$skipEdpCheck} {
            set useNewMethod 0
        }
    }
    <span class="comment-line"># End Hack</span>

    if ![info exist RELEASE_MASTER] {
        set RELEASE_MASTER Release_Master
    }  
    set fd_res [<a name="::open_result_file(2)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;$testNo&#34;]
    set time1 [clock seconds]
    
    result_h1 &#34;$title&#34;
    <a name="::report_start_test(36)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$title&#34;
    
    <span class="comment-line">#generate mapping info for physical portId connected between DUT</span>
    global portDutListUsed
    set portDutListUsed [<a name="::::SetupDUTConnections(4)"><a href="./SystemSetup.tcl.html#::::SetupDUTConnections_780">::::SetupDUTConnections</a></a>]
    
    set firstSubStr &#34;DUT&#34;
    set lastSubStr &#34;_CONNECT&#34;
    for {set i 1} {$i &lt;=$numDUT} {incr i 1} {
        global $firstSubStr$i$lastSubStr
        global $firstSubStr$i${lastSubStr}B ;<span class="comment-line">#global variable for msm-b</span>
        if [info exists $firstSubStr$i$lastSubStr] {
            lappend DUTList $i
        }
    }
    set platform [<a name="::GetPlatform(9)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]
    <a name="::Login(28)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
    if {[regexp -nocase &#34;stack&#34; $platform] } {
       <a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Its a stacking platfornm.Checking slots to be operational&#34;
       <a name="::CheckOperational(5)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
    }
    set returnFlag ok
    set platform [<a name="::GetPlatform(10)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]
    <a name="::Login(29)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
    if {[regexp -nocase &#34;stack&#34; $platform] } {
       <a name="::result_ok(9)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Its a stacking platfornm.Checking slots to be operational&#34;
       <a name="::CheckOperational(6)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
    }

    <span class="comment-line"># -----------------------------------------------------------------</span>
    <span class="comment-line"># Verify MGMT and INBAND Connections</span>
    <span class="comment-line"># -----------------------------------------------------------------</span>
    result_h2 &#34;Network port validation&#34;
    <a name="::report_start_test(37)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Network port validation&#34;
    global tftpServer netConFlag
    set tftpServer [lindex $tftpServerList 0]
    set netConFlag 1
    set mgmtList &#34;&#34;
    foreach testDUT $DUTList {
        lappend mgmtList &#34;VerifyMgmtConnections $testDUT&#34;
    }
    <a name="::MultiTask(2)"><a href="./multiTask.tcl.html#::MultiTask_39">::MultiTask</a></a> $mgmtList

    <a name="::result_debug(60)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;MGMT Check Flag $netConFlag&#34;
    <a name="::report_end_test(39)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    if {$netConFlag == 0} {
        foreach dut $DUTList {
            <span class="comment-line"># ----- Switch config</span>
            <a name="::Login(30)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$dut$lastSubStr]  -masterCheck 0 -CheckOperational 0
            <a name="::SendACmd(138)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
            <a name="::SendACmd(139)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
        }
        set MGMT_REG(useTelnetGlobalFlag) 0
        set MGMT_REG(useTelnetLocalFlag) 0
        set MGMT_REG(currentConnectionType) &#34;console&#34;
        set MGMT_REG(telnetNeedsConfig) 0
        set MGMT_REG(forceConsole) 1
        <span class="comment-line">################################################</span>
        <span class="comment-line"># Clean up</span>
        <span class="comment-line">################################################</span>
        set time2 [clock seconds]
        result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
        <a name="::close_result_file(6)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
        <a name="::report_end_test(40)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        set SKIPBROADCOMFDB 0
        return &#34;connectionBad&#34;
    } elseif {[info exists MGMT_REG(useTelnetGlobalFlag)] &amp;&amp; $MGMT_REG(useTelnetGlobalFlag)} {
        puts &#34;@@@\n@@@\n@@@ Go to TELNET mode\n@@@\n@@@\n@@@&#34;
        set MGMT_REG(useTelnetGlobalFlag) 1
        set MGMT_REG(useTelnetLocalFlag) 1
        set MGMT_REG(currentConnectionType) &#34;telnet&#34;
        set MGMT_REG(telnetNeedsConfig) 1
        set MGMT_REG(forceConsole) 0
    } else {
        <span class="comment-line">################################################</span>
        <span class="comment-line"># The mgmt port is good, Let do everything via</span>
        <span class="comment-line">#   the mgmt interface</span>
        <span class="comment-line">################################################</span>
        set MGMT_REG(useTelnetGlobalFlag) 0
        set MGMT_REG(useTelnetLocalFlag) 0
        set MGMT_REG(currentConnectionType) &#34;console&#34;
        set MGMT_REG(telnetNeedsConfig) 0
        set MGMT_REG(forceConsole) 1
    }
    <span class="comment-line"># -----------------------------------------------------------------</span>
    <span class="comment-line"># Gather info about the test bed, Set Licensing if required</span>
    <span class="comment-line"># -----------------------------------------------------------------</span>
    set genList &#34;&#34;
    foreach testDUT $DUTList {
        lappend genList &#34;GeneralSetup $testDUT&#34;
    }
    <a name="::MultiTask(3)"><a href="./multiTask.tcl.html#::MultiTask_39">::MultiTask</a></a> $genList

    <span class="comment-line"># -----------------------------------------------------------------</span>
    <span class="comment-line"># Start IXIA Verification</span>
    <span class="comment-line"># -----------------------------------------------------------------</span>
    <span class="comment-line">#Connect to ixia and setup connections</span>
    if { [<a name="::::SetupIxiaConnections(2)"><a href="./SystemSetup.tcl.html#::::SetupIxiaConnections_663">::::SetupIxiaConnections</a></a>] == &#34;connectionBad&#34; } {
        set SKIPBROADCOMFDB 0
        return connectionBad
    }
    
    <span class="comment-line"># Not initializing ixia or check connection</span>
    if {([info exists checkConnection] == 1) &amp;&amp; $checkConnection == &#34;NO_IXIA&#34; } {
        <a name="::result_debug(61)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Skipping ixia initialization and check connection&#34;
        <span class="comment-line">################################################</span>
        <span class="comment-line"># Clean up</span>
        <span class="comment-line">################################################</span>
        set time2 [clock seconds]
        result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
        <a name="::close_result_file(7)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
        <a name="::report_end_test(41)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        set SKIPBROADCOMFDB 0
        return &#34;connectionOkay&#34;
    }
    
    <span class="comment-line"># ----- Test variables setup</span>
    set numIxiaCd [<a name="::::GetNumIxiaCd(2)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a>]
    if {$numIxiaCd == 0} {
        <a name="::result_debug(62)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No ixia card found to be initialized&#34;
        set SKIPBROADCOMFDB 0
        return &#34;connectionBad&#34;
    }
    
    <span class="comment-line"># Check if desired to proceed</span>
    if {([info exists checkConnection] == 1) &amp;&amp; $checkConnection == 0} {
        foreach dut $DUTList {
            <span class="comment-line"># ----- Switch config </span>
            <a name="::Login(31)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$dut$lastSubStr]  -masterCheck 0 -CheckOperational 0
            <a name="::SendACmd(140)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log st&#34;
            <a name="::SendACmd(141)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipa&#34;
            <a name="::EnableDebugMode(12)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
        }
        <span class="comment-line">################################################</span>
        <span class="comment-line"># Clean up</span>
        <span class="comment-line">################################################</span>
        set time2 [clock seconds]
        result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
        <a name="::close_result_file(8)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
        <a name="::report_end_test(42)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
        set SKIPBROADCOMFDB 0
        return &#34;connectionOkay&#34;
    }
    
    set returnVal &#34;connectionOkay&#34;
    set lastDUT 0

    <span class="comment-line"># -----------------------------------------------------------------</span>
    <span class="comment-line"># Verify ixia and trunk ports</span>
    <span class="comment-line"># -----------------------------------------------------------------</span>
    set ccOut ok
    if {[<a name="::::CheckConnectionsTraffic(1)"><a href="./SystemSetup.tcl.html#::::CheckConnectionsTraffic_1871">::::CheckConnectionsTraffic</a></a> $DUTList fd_res testNo] != &#34;ok&#34;} {
        set ccOut error
    }

    if {[info exist MAIN(ifPipe)] &amp;&amp; ($MAIN(ifPipe) != &#34;NULL&#34;)} {
        puts $MAIN(ifPipe) &#34;set portMappingList \{$portMappingList\}&#34;
    }
    
    <span class="comment-line"># In case EDP did not work at all</span>
    if {$useNewMethod==0} {
        <a name="::result_debug(63)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Using the old Ixia traffic based trunk port validation...&#34;
        puts &#34;|[llength $DUTList]|[info exists trunkPortList]|&#34;
        if {[llength $DUTList] &gt; 1 &amp;&amp; [info exists trunkPortList]} {
            foreach trunkPair $trunkPortList {
                set firstDUT [lindex $trunkPair 0]
                set secondDUT [lindex $trunkPair 1]
                <span class="comment-line">#trunk port specification, no need to check</span>
                if {$secondDUT == 0 } { continue }
                set portNumber [lindex $trunkPair 2]
                <a name="::Login(32)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$firstDUT$lastSubStr]
                <a name="::SendACmd(142)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan ixiaVlan&#34;
                <a name="::SendACmd(143)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;
                <a name="::SendACmd(144)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port $portNumber tag&#34;

                <span class="comment-line">#now we have to find the corresponding index</span>
                set secondDUTPort &#34;PORT_NOT_FOUND&#34;
                set index 1
                while { [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $firstDUT $secondDUT $index] != &#34;PORT_NOT_FOUND&#34; } {
                    if { [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $firstDUT $secondDUT $index] == $portNumber} {
                        set secondDUTPort [<a name="::::GetATrunkPort(5)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $secondDUT $firstDUT $index]
                        break
                    }
                    incr index
                }
                <span class="comment-line"># Add support for non ethernet wans</span>
                <span class="comment-line">#Each port added adds { {1 2 1 6:1 F48T} {fSw sSw index port hdWare} }</span>
                unset   DUT(trunk,usageList)
                lappend DUT(trunk,usageList) &#34;$firstDUT $secondDUT $index $portNumber\
                        [<a name="::GetSlotNumType(2)"><a href="./misc.tcl.html#::GetSlotNumType_1810">::GetSlotNumType</a></a> $firstDUT $portNumber]&#34;
                lappend DUT(trunk,usageList) &#34;$secondDUT $firstDUT $index $secondDUTPort\
                        [<a name="::GetSlotNumType(3)"><a href="./misc.tcl.html#::GetSlotNumType_1810">::GetSlotNumType</a></a> $secondDUT $secondDUTPort]&#34;
                puts &#34;##########################\r&#34;
                puts &#34;trunk $DUT(trunk,usageList) ##############&#34;

                <span class="comment-line">#need to get a portId that belongs to the firstDUT</span>
                set ixiaCdPort [lindex [lindex $portMappingList 0] 0]
                foreach port $portMappingList {
                    if {[lindex $port 2] == $firstDUT } {
                        set ixiaCdPort [lindex $port 0]
                        break
                    }
                }
                <a name="::SendACmd(145)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port [<a name="::MapDUTPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $ixiaCdPort $firstDUT] tag&#34;

                <a name="::Login(33)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$secondDUT$lastSubStr]
                <a name="::SendACmd(146)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan ixiaVlan&#34;
                <a name="::SendACmd(147)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan tag $tagId&#34;
                <a name="::SendACmd(148)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan ixiaVlan add port $secondDUTPort tag&#34;

                set frameSent [<a name="::SendFrame(3)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $ixiaCdPort -tag $tagId -frameSize 68]
                after 300
                set frameSent [<a name="::SendFrame(4)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $ixiaCdPort -tag $tagId -frameSize 68]
                set sourceMac [<a name="::GetSourceMacAddress(3)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameSent]
                set srcMacFdb [<a name="::IxiaMacFormat2FdbFormat(3)"><a href="./misc.tcl.html#::IxiaMacFormat2FdbFormat_92">::IxiaMacFormat2FdbFormat</a></a> $sourceMac]
                <a name="::result_debug(64)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FdbMac for port $ixiaCdPort:|$srcMacFdb|[<a name="::GetDestMacAddress(2)"><a href="./MessageDecoding.tcl.html#::GetDestMacAddress_19">::GetDestMacAddress</a></a> $frameSent]|&#34;
                lappend checkMAC &#34;$srcMacFdb ixiaVlan $secondDUTPort exist&#34;

                <span class="comment-line">################################################</span>
                set subTest &#34;Checking Trunking #$index between DUT$firstDUT and DUT$secondDUT via MAC fdb Learning&#34;
                <span class="comment-line">################################################</span>
                result_h2 &#34;$subTest&#34;
                <a name="::report_start_test(38)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;

                set returnFlag [<a name="::CheckFdb(2)"><a href="./fdb.tcl.html#::CheckFdb_690">::CheckFdb</a></a> $checkMAC $fd_res $testNo]
                unset checkMAC
                <a name="::report_end_test(43)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

                if { $returnFlag != &#34;ok&#34; } {
                    set returnVal &#34;connectionBad&#34;
                }
                <a name="::Login(34)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$firstDUT$lastSubStr]
                <a name="::SendACmd(149)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ixiaVlan&#34;

                <a name="::Login(35)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$secondDUT$lastSubStr]
                <a name="::SendACmd(150)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ixiaVlan&#34;
            }
        }
    }
    
    <span class="comment-line">################################################</span>
    <span class="comment-line"># Clean up EDP</span>
    <span class="comment-line">################################################</span>
    foreach testDUT $DUTList {
        <a name="::Login(36)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr] -masterCheck 0 -CheckOperational 0
        global eware_dut
        if {[info exists eware_dut]} {
            if {[lsearch $eware_dut $testDUT] == -1 } {
                <a name="::SendACmd(151)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp ports all&#34;
                <a name="::SendACmd(152)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con edp advertisement-interval 60 holddown-interval 180&#34;
                <a name="::SendACmd(153)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable dhcp vlan all&#34;
            } else {
                <a name="::SendACmd(154)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp ports all&#34;
                <a name="::SendACmd(155)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable dhcp vlan all&#34;
            }
        } else {
            <a name="::SendACmd(156)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable edp ports all&#34;
            <a name="::SendACmd(157)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;con edp advertisement-interval 60 holddown-interval 180&#34;
            <a name="::SendACmd(158)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable dhcp vlan all&#34;
        }
        <span class="comment-line">#_verifyCFCorruptionStatusOnLogin</span>
    }
    
    <span class="comment-line"># -----------------------------------------------------------------</span>
    <span class="comment-line"># End SystemSetup and Return Value</span>
    <span class="comment-line"># -----------------------------------------------------------------</span>
    set time2 [clock seconds]
    result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
    <a name="::close_result_file(9)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
    <a name="::report_end_test(44)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    if {$ccOut == &#34;error&#34;} {
        set returnVal &#34;connectionBad&#34;
    }
    if {$returnVal == &#34;connectionBad&#34;} {
        if {![info exists VERBOSE] || $VERBOSE == &#34;yes&#34;} {
            <a name="::dumpAllSwitchInfo(2)"><a href="./cleanup.tcl.html#::dumpAllSwitchInfo_696">::dumpAllSwitchInfo</a></a>;
        }
        lappend FAILSUMMARY &#34;\n@@@@@@@@@@@@@@   END FAIL SUMMARY   @@@@@@@@@@@@@@@&#34;
        foreach fmsg $FAILSUMMARY {
            <a name="::result_debug(65)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n$fmsg&#34;
        }
    }
    return $returnVal
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VerifyInitFile</span>
<span class="comment-line"># Desc: make sure the init file is good, if not delete</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return 1 if there is a valid existing init file. else 0</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyInitFile_2823">proc <a href="SystemSetup.tcl-annot.html#::::VerifyInitFile">::::VerifyInitFile</a></a></strong><a name="::::VerifyInitFile"></a> {initFile} {
    if {[file exists $initFile] &amp;&amp; [file size $initFile] &gt; 0} {
        if {[catch {source $initFile} reason]} {
            <a name="::result_debug(66)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n!!!\nThere was a TCL error when sourcing\n$initFile\nError: $reason\n!!!&#34;
            regsub -all &#34;Tmp&#34; $initFile &#34;Tmp2&#34; initFile2
            regsub -all &#34;DUTINFO&#34; $initFile2 &#34;BADBADBAD&#34; initFile3
            if {[catch {file rename -force $initFile $initFile3} why]} {
                puts &#34;Failed to rename the init file $initFile as a failure: $reason&#34;
            }
            return 0
        }
        return 1
    }
    return 0
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetInitFileName</span>
<span class="comment-line"># Desc: Create a test bed variable storage init file name</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical Usage: set initFile [GetInitFileName $curAutoRoot $cfg]</span>
<span class="comment-line"># Return: filename</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetInitFileName_2846">proc <a href="SystemSetup.tcl-annot.html#::::GetInitFileName">::::GetInitFileName</a></a></strong><a name="::::GetInitFileName"></a> {cPath cfg {mTmp &#34;Tmp&#34;}} {
    global DUT1_CONNECT
    <span class="comment-line"># Use console in case there is an internal change in the cfg</span>
    regsub -all {[ ]+} $DUT1_CONNECT {_} console;
    set cfgp [file tail $cfg]
    set cfgp [string trim $cfgp]
    set cfgp [file rootname $cfgp]
    set initFile &#34;${cPath}/main/${mTmp}/DUTINFO_${cfgp}_${console}.txt&#34;
    regsub -all {[ ]+} $initFile {} initFile;
    return $initFile
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: _verifyPortMappingPortsActive</span>
<span class="comment-line"># Desc:  Verify that every port in the portMappingList is up</span>
<span class="comment-line">#       on all DUTs</span>
<span class="comment-line">#</span>
<span class="comment-line"># Args  in: none</span>
<span class="comment-line">#       out: 1|0</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#   if {[_verifyPortMappingPortsActive]} {</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::_verifyPortMappingPortsActive_2869">proc <a href="SystemSetup.tcl-annot.html#::::_verifyPortMappingPortsActive">::::_verifyPortMappingPortsActive</a></a></strong><a name="::::_verifyPortMappingPortsActive"></a> {} {
    global portMappingList whichDutNow MAIN

    set initDut $whichDutNow

    for {set nDUT 1; global DUT${nDUT}_CONNECT} { [info exists DUT${nDUT}_CONNECT] } \
                                             {incr nDUT ; global DUT${nDUT}_CONNECT} {
        <a name="::Login(37)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${nDUT}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
    }

    set allDUTs &#34;&#34;
    foreach portDef $portMappingList {
        set lDut [lindex $portDef 2]
        if {[lsearch $allDUTs $lDut] &lt; 0} {
            lappend allDUTs $lDut
        }
        set lPort [lindex $portDef 1]
        if {$lPort == &#34;A&#34;} {
            <a name="::result_debug(67)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Portmapping list is still in automatic State&#34;
            <a name="::Login(38)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${initDut}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
            return
        }
        lappend paramList($lDut) &#34;{$lPort .*E *A} exist&#34;
        lappend dutPortList($lDut) [string trim $lPort]
    }
    set res 1
    <span class="comment-line"># ----------------------------------------------------------------</span>
    <span class="comment-line"># Add recovery loop option if ports are down</span>
    <span class="comment-line"># ----------------------------------------------------------------</span>
    set tryToRecoverCount 1
    set recoveryType(1) &#34;&#34;
    set fixDutList &#34;&#34;
    while {$tryToRecoverCount &lt;= 3} {
        foreach d $allDUTs {
            <a name="::Login(39)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${d}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
            set portStr [join $dutPortList($d) &#34;,&#34;]
            set dutPortStr($d) $portStr
            set val [<a name="::CheckKeyValue(15)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show ports $portStr configuration no-refresh&#34; $paramList($d) \
                -time {s: 1 i: 10 d: 60 f: 60 r} -reportResults 0]
            if {$val != &#34;ok&#34;} {
                set res 0
                <span class="comment-line"># ----------------------------------------------------</span>
                <span class="comment-line"># Define what platforms qualify to attempt to recover</span>
                <span class="comment-line">#   ports that are down.</span>
                <span class="comment-line">#   4/2017 - VPEX slots are the only candidate</span>
                <span class="comment-line"># ----------------------------------------------------</span>
                if {[<a name="::::CheckForBpePorts(1)"><a href="./vpex.tcl.html#::::CheckForBpePorts_405">::::CheckForBpePorts</a></a> -dut $d -dutPortString $portStr -match &#34;any&#34;]} {
                    set recoveryType($d) &#34;bpeSlot&#34;
                    lappend fixDutList $d
                } else {
                    set recoveryType($d) &#34;&#34;
                }
            }
        }
        if {!$res &amp;&amp; [llength $fixDutList] &gt; 0 &amp;&amp; $tryToRecoverCount &lt; 3} {
            <span class="comment-line">#last condition tryToRecoverCount &lt; 3 means don't try to recover last time.</span>
            foreach d $fixDutList {
                switch $recoveryType($d) {
                    &#34;bpeSlot&#34;  {
                        if {[<a name="::PowerCycleBpes(1)"><a href="./poweroutlet.tcl.html#::PowerCycleBpes_1680">::PowerCycleBpes</a></a> -DUT $d] &lt; 0} {
                            <span class="comment-line"># could not power cycle</span>
                            <a name="::Login(40)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${initDut}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
                            return $res;
                        }
                        set res 1
                    }
                }
                <a name="::Login(41)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${d}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
                <a name="::CheckOperational(7)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>
            }
            incr tryToRecoverCount
            continue;
        } else {
            <a name="::Login(42)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${initDut}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
            return $res;
        }
    }
    <a name="::Login(43)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${initDut}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
    return $res
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: _verifyTrunkPortsActive</span>
<span class="comment-line"># Desc:  Verify that every port in the trunkPortList is up</span>
<span class="comment-line">#       on all DUTs</span>
<span class="comment-line">#</span>
<span class="comment-line"># Args  in: none</span>
<span class="comment-line">#       out: 1|0</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#   if {[_verifyTrunkPortsActive &#34;1 3&#34;]} {</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::_verifyTrunkPortsActive_2961">proc <a href="SystemSetup.tcl-annot.html#::::_verifyTrunkPortsActive">::::_verifyTrunkPortsActive</a></a></strong><a name="::::_verifyTrunkPortsActive"></a> {{dutList NULL}} {
    global trunkPortList whichDutNow MAIN
    set initDut $whichDutNow
    global DUT${whichDutNow}_CONNECT

    if {$dutList == &#34;NULL&#34;} {
        set dutList $MAIN(DUTLIST)
    }
    foreach nDUT $dutList {
        global DUT${nDUT}_CONNECT
        <a name="::Login(44)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${nDUT}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
    }

    set allDUTs &#34;&#34;
    foreach portDef $trunkPortList {
        set lDut [lindex $portDef 0]
        if {[lsearch $allDUTs $lDut] &lt; 0} {
            lappend allDUTs $lDut
        }
        set lPort [lindex $portDef 2]
        lappend paramList($lDut) &#34;{$lPort .*E *A} exist&#34;
        lappend dutPortList($lDut) $lPort
    }
    set res 1
    foreach d $dutList {
        <a name="::Login(45)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${d}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
        set portStr [join $dutPortList($d) &#34;,&#34;]
        set val [<a name="::CheckKeyValue(16)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show ports $portStr configuration no-refresh&#34; $paramList($d) \
            -time {s: 1 i: 10 d: 21 f: 21 r}]
        if {$val != &#34;ok&#34;} {
            set res 0
        }
    }
    <a name="::Login(46)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${initDut}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
    return $res
}
<span class="comment-line">###################################################################</span>
<span class="comment-line"># proc _smallCheckConnections</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Run a scaled back check Connections to create a new initFile</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">###################################################################</span>
<strong><a name="::::_smallCheckConnections_3005">proc <a href="SystemSetup.tcl-annot.html#::::_smallCheckConnections">::::_smallCheckConnections</a></a></strong><a name="::::_smallCheckConnections"></a> {} {
    global MAIN ixiaCh1 TrafficGen SPIRENTCH1 stcLabserver
    global ixiaPath auto_path LIB_PATH stcPath LABSERVER

    if {![info exists MAIN(autoRoot)] || ![info exists MAIN(cfg)]} {
        puts &#34;Can't create the init file&#34;
        return;
    }

    set MAIN(initFile) [<a name="::::GetInitFileName(1)"><a href="./SystemSetup.tcl.html#::::GetInitFileName_2846">::::GetInitFileName</a></a> $MAIN(autoRoot) $MAIN(cfg)]
    catch {open $MAIN(initFile) &#34;w&#34;} MAIN(ifPipe)
    if {[regexp -nocase &#34;denied&#34; $MAIN(ifPipe)]} {
        puts &#34;@\n@\nNO INIT FILE WILL BE CREATED. ERROR OPENING FILE\n@\n@&#34;
        set MAIN(ifPipe) NULL
        return;
    }

    if {0} {
        if {[info exists ixiaCh1] &amp;&amp; $ixiaCh1 != &#34;NO_IXIA&#34;} {
            puts &#34;****** the ixia chassis is $ixiaCh1&#34;;
            puts &#34;****** the ixia path is $ixiaPath($ixiaCh1)&#34;;
            set TrafficGen ixia
        } elseif {[info exists SPIRENTCH1]} {
            puts &#34;****** The Spirent Chassis is $SPIRENTCH1 ******&#34;
            set TrafficGen stc
            set ::LABSERVER $stcLabserver($SPIRENTCH1)
            set env(IXIA_HOME) null
            lappend auto_path &#34;/auto/ixia_5_70/lib/mpexpr-1.1/&#34;
            <a name="::::overWriteProcs(1)"><a href="./stc.tcl.html#::::overWriteProcs_95">::::overWriteProcs</a></a> $LIB_PATH [file join $LIB_PATH spirent]
            source [file join $LIB_PATH ePTLib ePTUtils.tcl]
            <a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> lappend auto_path $stcPath($stcLabserver($SPIRENTCH1))
            <a name="::stcInit(1)"><a href="./spirent.tcl.html#::stcInit_11">::stcInit</a></a> $LABSERVER
            package require Mpexpr
            puts &#34;\n\nPackage Require SpirentTestCenter&#34;
            <a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> package require SpirentTestCenter
            <a name="::GenerateDUTPortMapping(2)"><a href="./ePTPortMapping.tcl.html#::GenerateDUTPortMapping_217">::GenerateDUTPortMapping</a></a>; <span class="comment-line"># Add here temporarily b/c called in SystemSetup</span>
            <a name="::ReservePorts(1)"><a href="./spirent.tcl.html#::ReservePorts_67">::ReservePorts</a></a>
        }

        if {[info exists ixiaPath($ixiaCh1)] &amp;&amp; $TrafficGen == &#34;ixia&#34;} {
            <a name="::SetIxiaEnv(1)"><a href="./ePTMisc.tcl.html#::SetIxiaEnv_517">::SetIxiaEnv</a></a> &#34;$ixiaPath($ixiaCh1)&#34;
            puts &#34;****** The ixia path is $ixiaPath($ixiaCh1)&#34;;
        }
    }
    <span class="comment-line"># ----------------------------------------------------------</span>
    <span class="comment-line"># Gather critical variables from all switches in the test bed</span>
    <span class="comment-line"># ----------------------------------------------------------</span>
    if {[set rc [<a name="::::get_DUTs_info(1)"><a href="./swConf.tcl.html#::::get_DUTs_info_881">::::get_DUTs_info</a></a>]] != 0} {
        <a name="::result_error(15)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error $rc while calling get_DUTs_info.&#34;;
        <a name="::close_result_file(10)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>;
        return -7;
    }

    <span class="comment-line"># ----------------------------------------------------------</span>
    <span class="comment-line"># Verify all of the test bed connections</span>
    <span class="comment-line"># ----------------------------------------------------------</span>
    <span class="comment-line"># check connections between DUTs and Ixia</span>

    if {$TrafficGen == &#34;ixia&#34;} {
        if {![regexp -nocase &#34;no_ixia&#34; $ixiaCh1]} {
            set returnFlag [<a name="::::SystemSetup(1)"><a href="./SystemSetup.tcl.html#::::SystemSetup_16">::::SystemSetup</a></a>]
        } else {
            set returnFlag &#34;connectionOkay&#34;
        }
    } elseif {$TrafficGen == &#34;stc&#34;} {
        set returnFlag [<a name="::::SystemSetup(2)"><a href="./SystemSetup.tcl.html#::::SystemSetup_16">::::SystemSetup</a></a>]
    } else {
        <a name="::result_error(16)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Can't find Ixia OR Spirent Information&#34;
        set returnFlag &#34;connectionBad&#34;
    }

    <span class="comment-line"># Close the init file</span>
    if {([info exists MAIN(ifPipe)]) &amp;&amp; ($MAIN(ifPipe) != &#34;NULL&#34;)} {
        close $MAIN(ifPipe)
    }

}
<span class="comment-line">##################################################################################</span>
<span class="comment-line"># Procedure: _mgmtConnection</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################################</span>
<strong><a name="::::_mgmtConnection_3088">proc <a href="SystemSetup.tcl-annot.html#::::_mgmtConnection">::::_mgmtConnection</a></a></strong><a name="::::_mgmtConnection"></a> {numDUT} {
    global DUT${numDUT}_CONNECT
    global DUT${numDUT}_IP
    global DUT${numDUT}_IP_FP
    global DUT${numDUT}_DefaultBlade
    global switchPort2DefaultRouter tftpServer
    global DUTs_info netConFlag MGMT_REG

    set connect [set DUT${numDUT}_CONNECT]
    set dut_ip [set DUT${numDUT}_IP]
    set def_blade [set DUT${numDUT}_DefaultBlade]
    if { $def_blade != 0 } {
        set port $def_blade:$switchPort2DefaultRouter
    } else {
        set port $switchPort2DefaultRouter
    }
    set MGMT_REG(forceConsole) 1;
    <a name="::Login(47)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $connect  -masterCheck 0 -CheckOperational 0
    <a name="::ConfigGatewayNetwork(2)"><a href="./SendSwCmd.tcl.html#::ConfigGatewayNetwork_2110">::ConfigGatewayNetwork</a></a>
}
<span class="comment-line">##################################################################################</span>
<span class="comment-line"># Procedure: _ConfigMgmtNetworkAll</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################################</span>
<strong><a name="::::_ConfigMgmtNetworkAll_3115">proc <a href="SystemSetup.tcl-annot.html#::::_ConfigMgmtNetworkAll">::::_ConfigMgmtNetworkAll</a></a></strong><a name="::::_ConfigMgmtNetworkAll"></a> {} {
    global whichDutNow MGMT_REG
    set mgmtList &#34;&#34;

    set initDut $whichDutNow
    for {set nDUT 1; global DUT${nDUT}_CONNECT} { [info exists DUT${nDUT}_CONNECT] } \
                                             {incr nDUT ; global DUT${nDUT}_CONNECT} {
        lappend mgmtList &#34;_mgmtConnection $nDUT&#34;
    }
    <a name="::_setShowOutput(1)"><a href="./SendSwCmd.tcl.html#::_setShowOutput_3101">::_setShowOutput</a></a> -screen off -log off -res_fmt on
    <a name="::MultiTask(4)"><a href="./multiTask.tcl.html#::MultiTask_39">::MultiTask</a></a> $mgmtList
    <a name="::_setShowOutput(2)"><a href="./SendSwCmd.tcl.html#::_setShowOutput_3101">::_setShowOutput</a></a> -screen on -log on -res_fmt on
    set MGMT_REG(telnetNeedsConfig) 0
    set connect [set DUT${initDut}_CONNECT]
    <a name="::Login(48)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $connect  -masterCheck 0 -CheckOperational 0
    
}
<span class="comment-line">##################################################################################</span>
<span class="comment-line"># Procedure: _GetFailingPortIds</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################################</span>
<strong><a name="::::_GetFailingPortIds_3139">proc <a href="SystemSetup.tcl-annot.html#::::_GetFailingPortIds">::::_GetFailingPortIds</a></a></strong><a name="::::_GetFailingPortIds"></a> {} {
    global MAIN portMappingList

    set badPortIds &#34;&#34;
    foreach m $portMappingList {
        if {[regexp -nocase &#34;key_not_found&#34; $m]} {
            lappend badPortIds &#34;portId[lindex $m 0]&#34;
        }
    }
    if {[llength $badPortIds] &gt; 0} {
        set MAIN(CCPortIdResults) &#34;Ixia portIds failed: $badPortIds&#34;
    } else {
        set MAIN(CCPortIdResults) &#34;&#34;
    }
    return $MAIN(CCPortIdResults)
}
<span class="comment-line">##################################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################################</span>
<strong><a name="::::_updateMgmtInbandStatus_3163">proc <a href="SystemSetup.tcl-annot.html#::::_updateMgmtInbandStatus">::::_updateMgmtInbandStatus</a></a></strong><a name="::::_updateMgmtInbandStatus"></a> {} {
    global MAIN DUTs_info DUT1_IP_FP DUT2_IP_FP

    set bL &#34;&#34;
    if {![info exist DUT1_IP_FP] } {
        lappend bL &#34;NoInband&#34;
    }
    if {![info exist DUT2_IP_FP] &amp;&amp; [lsearch $bL &#34;NoInband&#34;] &lt; 0} {
        lappend bL &#34;NoInband&#34;
    }
    if {(!$DUTs_info(DUT1,InbandNetConnected) || !$DUTs_info(DUT2,InbandNetConnected)) &amp;&amp; \
            [lsearch $bL &#34;InbandIssue&#34;] &lt; 0} {
        lappend bL &#34;InbandIssue&#34;
    }
    if {(!$DUTs_info(DUT1,MgmtNetConnected) || !$DUTs_info(DUT2,MgmtNetConnected)) &amp;&amp; \
           [lsearch $bL &#34;MgmtIssue&#34;] &lt; 0} {
        lappend bL &#34;MgmtIssue&#34;
    }
    <span class="comment-line"># --- update the tracking db ---</span>
    if {[llength $bL] &gt; 1} {
        set o [join $bL &#34; &#34;]
        <a name="::_setTrackDBIssue(1)"><a href="./resource_track.tcl.html#::_setTrackDBIssue_165">::_setTrackDBIssue</a></a> &#34;$o&#34;
    } else {
        <a name="::_setTrackDBIssue(2)"><a href="./resource_track.tcl.html#::_setTrackDBIssue_165">::_setTrackDBIssue</a></a> &#34;$bL&#34;
    }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
