<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>StackLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#StackLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>StackLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="StackLib.tcl-annot.html">annotations</a> | <a href="StackLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line"># ----- Environment variables setup</span>

<strong><a name="::::EnableStack_4">proc <a href="StackLib.tcl-annot.html#::::EnableStack">::::EnableStack</a></a></strong> {args} {
<a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> EnableStack $args {
SetDefaults &#34;0&#34;
}
global DUT1_CONNECT
global DUT1_CONNECTB
global DUTs_info
global maxSlot
global getSlotId
global BackupNodeMac
global MasterNodeMac
global DUT1_Stacking_msma_slot
global DUT1_Stacking_msmb_slot

if {![info exists DUT1_CONNECTB]==1} {

<a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;not applicable as no DUT1_CONNECTB&#34;

} else {
<span class="comment-line"># ----- Switch config</span>
<a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0 -CheckOperational 0 

<span class="comment-line"># Default configuration for the stack topology</span>
if { [<a name="::CheckStack(1)"><a href="./StackLib.tcl.html#::CheckStack_162">::CheckStack</a></a> ] == 1 } {
<a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the No of Slots&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Factory MAC address} 2&#34;
set nodeMac [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking detail&#34; $parameterList]
set maxSlot [llength $nodeMac]
<a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;No of Slots is $maxSlot&#34;

<a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Master Node-Mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set MasterNodeMac [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $MasterNodeMac &#34;&#34; MasterNodeMac
<a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;MasterNodeMac -$MasterNodeMac&#34;

<a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECTB -masterCheck 0 -CheckOperational 0
<a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Backup node mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set BackupNodeMac [<a name="::GetKeyValue(3)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $BackupNodeMac &#34;&#34; BackupNodeMac
<a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;BackupNodeMac $BackupNodeMac&#34;

<a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0
<span class="comment-line"># verify Stacking is disabled</span>
<a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Verify Stacking is disabled&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{$MasterNodeMac.*Disabled.*Master} exist&#34;
lappend parameterList &#34;{$BackupNodeMac.*Disabled.*Master} exist&#34;
set result [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show stacking&#34; $parameterList \
     -comment &#34;check show slot output&#34; -reportResults 0]
<a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;result -$result&#34;

if {[regexp -nocase &#34;error&#34; $result]} {
<a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT  -masterCheck 0
<a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;Disable stacking&#34;
<a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;reboot stack-topology&#34;
<a name="::WaitForRebootStack(1)"><a href="./Stackmisc.tcl.html#::WaitForRebootStack_399">::WaitForRebootStack</a></a> 220 &#34;Waiting after reboot-stack&#34;

<a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0

set parameterList &#34;&#34;
lappend parameterList &#34;{$MasterNodeMac.*Disabled.*Master} exist&#34;
lappend parameterList &#34;{$BackupNodeMac.*Disabled.*Master} exist&#34;
<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show stacking&#34; $parameterList -time \
{s: 1 i: 5 d: 240 f: 240 r}  -comment &#34;Verify configurations after reboot&#34;
}


for {set i 1} {$i &lt;= $maxSlot} {incr i} {
set flag($i) 0
}

<a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT

<span class="comment-line"># Configure Master priority</span>
<a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable stacking node-address $MasterNodeMac&#34;
<a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $MasterNodeMac master-capability on&#34;
<a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $MasterNodeMac priority 3&#34;
<a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $MasterNodeMac  slot-number $DUT1_Stacking_msma_slot&#34;
<a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking mac-address&#34;
set flag($DUT1_Stacking_msma_slot) 1

<span class="comment-line">#Login $DUT1_CONNECT -masterCheck 0</span>

<span class="comment-line">#  Configure Backup Node</span>
<a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable stacking node-address $BackupNodeMac&#34;
<a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-addres $BackupNodeMac master-capability on&#34;
<a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $BackupNodeMac priority 2&#34;
<a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $BackupNodeMac slot-number $DUT1_Stacking_msmb_slot&#34;
set flag($DUT1_Stacking_msmb_slot) 1

if { $maxSlot &gt; 2 } {

<a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Nodemac for all the slots&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Factory MAC address} 2&#34;
<a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34; disable clipaging&#34;
set nodeMac [<a name="::GetKeyValue(4)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking detail&#34; $parameterList]
set maxSlot [llength $nodeMac]
set StandbyMac &#34;&#34;
for {set i 0 } {$i &lt; $maxSlot} {incr i } {
set mac [lindex $nodeMac $i]
if {($mac == $MasterNodeMac) || ($mac == $BackupNodeMac)} {
<span class="comment-line"># skipping for master and backup mac</span>
} else {
lappend StandbyMac $mac
}
}
<a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;StandbyMac -$StandbyMac&#34;


<span class="comment-line"># Configure remaining slots</span>
foreach slot $StandbyMac {
<a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable stacking node-address $slot&#34;
<a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-addres $slot master-capability off&#34;
<a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $slot priority 1&#34;

  for { set j 1 } {$j &lt;=$maxSlot }  {incr j } {
     if { $flag($j) == 0 } {
     <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $slot slot-number $j&#34;
     set flag($j) 1
     break
     } 
  }
}
}

<a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;reboot stack-topology&#34;
<a name="::WaitForRebootStack(2)"><a href="./Stackmisc.tcl.html#::WaitForRebootStack_399">::WaitForRebootStack</a></a> 220 &#34;Waiting after reboot-stack&#34;

<a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0
set parameterList &#34;&#34;
lappend parameterList &#34;{$MasterNodeMac.*$DUT1_Stacking_msma_slot.*Active.*Master} exist&#34;
lappend parameterList &#34;{$BackupNodeMac.*$DUT1_Stacking_msmb_slot.*Active.*Backup} exist&#34;
<a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show stacking&#34; $parameterList -time {s: 1 i: 5 d: 180 f: 180 r} \
                                -comment &#34;check show slot output&#34;

<a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;check show slot output&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Current State.*MASTER.*BACKUP.*In Sync} exist&#34;
<a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $parameterList -time {s: 1 i: 5 d: 180 f: 180 r} \
                                         -comment &#34;check show slot output&#34;

} else {

if { $SetDefaults == 1} {
<a name="::SetStackToDefaults(1)"><a href="./StackLib.tcl.html#::SetStackToDefaults_383">::SetStackToDefaults</a></a>
}
<a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Stack is Up&#34;
}

}
}

<strong><a name="::::CheckStack_162">proc <a href="StackLib.tcl-annot.html#::::CheckStack">::::CheckStack</a></a></strong> {} {

global DUT1_CONNECT
global DUT1_CONNECTB
global DUTs_info
global maxSlot
global getSlotId
global BackupNodeMac
global MasterNodeMac
global DUT1_Stacking_msma_slot
global DUT1_Stacking_msmb_slot

<a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0 -CheckOperational 0

<span class="comment-line"># Default configuration for the stack topology</span>

<a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the No of Slots&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Factory MAC address} 2&#34;
set nodeMac [<a name="::GetKeyValue(5)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking detail&#34; $parameterList]
<span class="comment-line">#set StandbyMac [getStandbyMac]</span>
set maxSlot [llength $nodeMac]
<a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;No of Slots is $maxSlot&#34;

<a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Master Node-Mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set MasterNodeMac [<a name="::GetKeyValue(6)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $MasterNodeMac &#34;&#34; MasterNodeMac
<a name="::result_ok(9)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;MasterNodeMac -$MasterNodeMac&#34;

<a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECTB -masterCheck 0 -CheckOperational 0
<a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Backup node mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set BackupNodeMac [<a name="::GetKeyValue(7)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $BackupNodeMac &#34;&#34; BackupNodeMac
<a name="::result_ok(10)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;BackupNodeMac $BackupNodeMac&#34;

<a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0

set StandbyMac [<a name="::getStandbyMac(1)"><a href="./StackLib.tcl.html#::getStandbyMac_252">::getStandbyMac</a></a>]

set parameterList &#34;&#34;
lappend parameterList &#34;{$MasterNodeMac.*$DUT1_Stacking_msma_slot.*Active.*Master} exist&#34;
lappend parameterList &#34;{$BackupNodeMac.*$DUT1_Stacking_msmb_slot.*Active.*Backup} exist&#34;
lappend parameterList &#34;{Disabled} notExist&#34;
if {$maxSlot &gt; 2} {
foreach standby $StandbyMac {
lappend parameterList &#34;{$standby.*Active.*Standby} exist&#34;
}
}
set res1 [<a name="::CheckKeyValue(5)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show stacking&#34; $parameterList \
                                -comment &#34;check show stacking&#34; -reportResults 0]
<a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;check show slot output&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Current State.*MASTER.*BACKUP.*In Sync} exist&#34;
set res2 [<a name="::CheckKeyValue(6)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $parameterList \
                                         -comment &#34;check show switch output&#34; -reportResults 0]

          set slotBState &#34;&#34;
          for {set i 1} {$i &lt;= $maxSlot} {incr i } {
         lappend slotBState &#34;{Slot-$i.*Operational} exist&#34;
         }
         set res3 [<a name="::CheckKeyValue(7)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot&#34;  $slotBState  \
                                         -comment &#34;check show slot output&#34; -reportResults 0]


set res [regexp &#34;error|0&#34; $res1|$res2|res3]

if { $res == 1 } { 
return 1 
} else {
return 0
}
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getStandbyMac</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the list of the Standby mac</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getStandbyMac_252">proc <a href="StackLib.tcl-annot.html#::::getStandbyMac">::::getStandbyMac</a></a></strong> {args} {
global getStandbyMac
global DUT1_CONNECT
global DUT1_CONNECTB

<a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the StandbyMac list for the stack&#34;
<a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0
set parameterList &#34;&#34;
lappend parameterList &#34;{Factory MAC address} 2&#34;
set nodeMac [<a name="::GetKeyValue(8)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking detail&#34; $parameterList]
set maxSlot [llength $nodeMac]
<a name="::result_ok(11)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;nodeMac $nodeMac&#34;
<a name="::result_ok(12)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;No of Slots is $maxSlot&#34;

<a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Master Node-Mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set MasterNodeMac [<a name="::GetKeyValue(9)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $MasterNodeMac &#34;&#34; MasterNodeMac
<a name="::result_ok(13)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;MasterNodeMac -$MasterNodeMac&#34;

<a name="::Login(12)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECTB -masterCheck 0 -CheckOperational 0
<a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Backup node mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set BackupNodeMac [<a name="::GetKeyValue(10)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $BackupNodeMac &#34;&#34; BackupNodeMac
<a name="::result_ok(14)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;BackupNodeMac $BackupNodeMac&#34;

<a name="::Login(13)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0

set getStandbyMac &#34;&#34;
for {set i 0 } {$i &lt; $maxSlot} {incr i } {
set mac [lindex $nodeMac $i]
if {($mac == $MasterNodeMac) || ($mac == $BackupNodeMac)} {
<span class="comment-line"># skipping for master and backup mac</span>
} else {
lappend getStandbyMac $mac
}
}
<a name="::result_ok(15)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;getStandbyMac -$getStandbyMac&#34;
return $getStandbyMac
}


<strong><a name="::::CheckPriority_297">proc <a href="StackLib.tcl-annot.html#::::CheckPriority">::::CheckPriority</a></a></strong> {} {

global DUT1_CONNECT
<a name="::Login(14)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
if { ![<a name="::CheckStack(2)"><a href="./StackLib.tcl.html#::CheckStack_162">::CheckStack</a></a> ] == 1 } {
set parameterList &#34;&#34;
set priorityList &#34;&#34;
lappend parameterList &#34;{Priority} 2&#34;
set priorityList [<a name="::GetKeyValue(11)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking detail&#34; $parameterList]
puts &#34;priorityList: $priorityList&#34;
if { [regexp Automatic $priorityList] } {
return &#34;Automatic&#34;
} else  {
return &#34;userDefined&#34;
}
} else {
<a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Stack is not UP&#34;
}
}

<strong><a name="::::SetPriority_317">proc <a href="StackLib.tcl-annot.html#::::SetPriority">::::SetPriority</a></a></strong> {{priority &#34;userDefined&#34;}} {
global DUT1_CONNECT
global DUT1_CONNECTB
global DUTs_info
global maxSlot
global getSlotId
global BackupNodeMac
global MasterNodeMac

<a name="::Login(15)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT

if {[<a name="::CheckStack(3)"><a href="./StackLib.tcl.html#::CheckStack_162">::CheckStack</a></a>]== 0} {
<a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the No of Slots&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Factory MAC address} 2&#34;
set nodeMac [<a name="::GetKeyValue(12)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking detail&#34; $parameterList]
set maxSlot [llength $nodeMac]
<a name="::result_ok(16)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;No of Slots is $maxSlot&#34;

<a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Master Node-Mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set MasterNodeMac [<a name="::GetKeyValue(13)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $MasterNodeMac &#34;&#34; MasterNodeMac
<a name="::result_ok(17)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;MasterNodeMac -$MasterNodeMac&#34;

<a name="::Login(16)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECTB -masterCheck 0 -CheckOperational 0
<a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Backup node mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set BackupNodeMac [<a name="::GetKeyValue(14)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $BackupNodeMac &#34;&#34; BackupNodeMac
<a name="::result_ok(18)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;BackupNodeMac $BackupNodeMac&#34;
  
set StandbyMac [<a name="::getStandbyMac(2)"><a href="./StackLib.tcl.html#::getStandbyMac_252">::getStandbyMac</a></a>]

if {$priority==&#34;userDefined&#34;} {
<a name="::Login(17)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<span class="comment-line"># Configure Master priority</span>
<a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $MasterNodeMac priority 3&#34;
<span class="comment-line">#  Configure Backup Node</span>
<a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $BackupNodeMac priority 2&#34;

foreach slot $StandbyMac {
<a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $slot priority 1&#34;
}
<a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show stacking detail&#34;
<a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show stacking configuration&#34;
} elseif {$priority==&#34;Automatic&#34;} {

<a name="::Login(18)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<span class="comment-line"># Configure Master priority</span>
<a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $MasterNodeMac priority automatic&#34;
<span class="comment-line">#  Configure Backup Node</span>
<a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $BackupNodeMac priority automatic&#34;

foreach slot $StandbyMac {
<a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $slot priority automatic&#34;
}
}
} else {
<a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Stack is not UP&#34;
}

}

<strong><a name="::::SetStackToDefaults_383">proc <a href="StackLib.tcl-annot.html#::::SetStackToDefaults">::::SetStackToDefaults</a></a></strong> { } {

global DUT1_CONNECT
global DUT1_CONNECTB
global DUTs_info
global maxSlot
global getSlotId
global BackupNodeMac
global MasterNodeMac
global DUT1_Stacking_msma_slot
global DUT1_Stacking_msmb_slot


if {![info exists DUT1_CONNECTB]==1} {

<a name="::result_ok(19)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;not applicable as no DUT1_CONNECTB&#34;

} else {

<a name="::Login(19)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the No of Slots&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Factory MAC address} 2&#34;
set nodeMac [<a name="::GetKeyValue(15)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking detail&#34; $parameterList]
set maxSlot [llength $nodeMac]
<a name="::result_ok(20)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;No of Slots is $maxSlot&#34;

<a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Master Node-Mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set MasterNodeMac [<a name="::GetKeyValue(16)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $MasterNodeMac &#34;&#34; MasterNodeMac
<a name="::result_ok(21)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;MasterNodeMac -$MasterNodeMac&#34;

<a name="::Login(20)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECTB -masterCheck 0 -CheckOperational 0
<a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Backup node mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set BackupNodeMac [<a name="::GetKeyValue(17)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $BackupNodeMac &#34;&#34; BackupNodeMac
<a name="::result_ok(22)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;BackupNodeMac $BackupNodeMac&#34;

for {set i 1} {$i &lt;= $maxSlot} {incr i} {
set flag($i) 0
}

<a name="::Login(21)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<span class="comment-line"># Configure Master priority</span>
<a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable stacking node-address $MasterNodeMac&#34;
<a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $MasterNodeMac master-capability on&#34;
<a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $MasterNodeMac priority 3&#34;
<a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $MasterNodeMac  slot-number $DUT1_Stacking_msma_slot&#34;
<a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking mac-address&#34;
set flag($DUT1_Stacking_msma_slot) 1

<span class="comment-line">#Login $DUT1_CONNECT -masterCheck 0</span>

<span class="comment-line">#  Configure Backup Node</span>
<a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable stacking node-address $BackupNodeMac&#34;
<a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-addres $BackupNodeMac master-capability on&#34;
<a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $BackupNodeMac priority 2&#34;
<a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $BackupNodeMac slot-number $DUT1_Stacking_msmb_slot&#34;
set flag($DUT1_Stacking_msmb_slot) 1

if { $maxSlot &gt; 2 } {

set StandbyMac [<a name="::getStandbyMac(3)"><a href="./StackLib.tcl.html#::getStandbyMac_252">::getStandbyMac</a></a>]
<a name="::result_ok(23)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;StandbyMac -$StandbyMac&#34;

<span class="comment-line"># Configure remaining slots</span>

foreach slot $StandbyMac {

<a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable stacking node-address $slot&#34;
<a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-addres $slot master-capability off&#34;
<a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $slot priority 1&#34;
  for { set j 1 } {$j &lt;=$maxSlot }  {incr j } {
     if { $flag($j) == 0 } {
     <a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure stacking node-address $slot slot-number $j&#34;
     set flag($j) 1
     break
     } 
  }

}
}

<a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;reboot stack-topology&#34;
<a name="::WaitForRebootStack(3)"><a href="./Stackmisc.tcl.html#::WaitForRebootStack_399">::WaitForRebootStack</a></a> 220 &#34;Waiting after reboot-stack&#34;

<a name="::Login(22)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0
set parameterList &#34;&#34;
lappend parameterList &#34;{$MasterNodeMac.*$DUT1_Stacking_msma_slot.*Active.*Master} exist&#34;
lappend parameterList &#34;{$BackupNodeMac.*$DUT1_Stacking_msmb_slot.*Active.*Backup} exist&#34;
<a name="::CheckKeyValue(8)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show stacking&#34; $parameterList -time {s: 1 i: 5 d: 180 f: 180 r} \
                                -comment &#34;check show slot output&#34;

<a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;check show slot output&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Current State.*MASTER.*BACKUP.*In Sync} exist&#34;
<a name="::CheckKeyValue(9)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $parameterList -time {s: 1 i: 5 d: 180 f: 180 r} \
                                         -comment &#34;check show slot output&#34;

}

}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
