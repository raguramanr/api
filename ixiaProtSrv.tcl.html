<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ixiaProtSrv.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ixiaProtSrv.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ixiaProtSrv.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ixiaProtSrv.tcl-annot.html">annotations</a> | <a href="ixiaProtSrv.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># GetProtocolServerInfo</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function will retrieve the specified protocol server</span>
;<span class="comment-line"># service states for the specified port.  The returned state for</span>
;<span class="comment-line"># a service will be 1 (true) if that service is enabled, or 0</span>
;<span class="comment-line"># (false) if the service is disabled.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portId: The logical port number to query.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     [-arpService &lt;vname=&#34;&#34;&gt;]: Stores the current state of the</span>
;<span class="comment-line">#         ARP protocol server in the TCL variable named by vname.</span>
;<span class="comment-line">#         If -arpService is not specified, the ARP service won't</span>
;<span class="comment-line">#         be queried.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-bgpService &lt;vname=&#34;&#34;&gt;]: Stores the current state of the</span>
;<span class="comment-line">#         BGP4 protocol service in the TCL variable named by</span>
;<span class="comment-line">#         vname.  If -bgpService is not specified, the BGP4</span>
;<span class="comment-line">#         service won't be queried.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-igmpService &lt;vname=&#34;&#34;&gt;]: Stores the current state of the</span>
;<span class="comment-line">#         IGMP protocol service in the TCL variable named by</span>
;<span class="comment-line">#         vname.  If -igmpService is not specified, the IGMP</span>
;<span class="comment-line">#         service won't be queried.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-isisService &lt;vname=&#34;&#34;&gt;]: Stores the current state of the</span>
;<span class="comment-line">#         ISIS protocol service in the TCL variable named by</span>
;<span class="comment-line">#         vname.  If -isisService is not specified, the ISIS</span>
;<span class="comment-line">#         service won't be queried.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-ospfService &lt;vname=&#34;&#34;&gt;]: Stores the current state of the</span>
;<span class="comment-line">#         OSPF protocol service in the TCL variable named by</span>
;<span class="comment-line">#         vname.  If -ospfService is not specified, the OSPF</span>
;<span class="comment-line">#         service won't be queried.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-pingService &lt;vname=&#34;&#34;&gt;]: Stores the current state of the</span>
;<span class="comment-line">#         PING protocol service in the TCL variable named by</span>
;<span class="comment-line">#         vname.  If -pingService is not specified, the PING</span>
;<span class="comment-line">#         service won't be queried.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-ripService &lt;vname=&#34;&#34;&gt;]: Stores the current state of the</span>
;<span class="comment-line">#         RIP protocol service in the TCL variable named by</span>
;<span class="comment-line">#         vname.  If -ripService is not specified, the RIP</span>
;<span class="comment-line">#         service won't be queried.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-rsvpService &lt;vname=&#34;&#34;&gt;]: Stores the current state of the</span>
;<span class="comment-line">#         RSVP protocol service in the TCL variable named by</span>
;<span class="comment-line">#         vname.  If -rsvpService is not specified, the RSVP</span>
;<span class="comment-line">#         service won't be queried.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value: None.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     GetProtocolServerInfo $txPort -ospfService ospfOnOrOff</span>
;<span class="comment-line">#     if {$ospfOnOrOff} {</span>
;<span class="comment-line">#         result_debug &#34;OSPF server is enabled.&#34;</span>
;<span class="comment-line">#     } else {</span>
;<span class="comment-line">#         result_debug &#34;OSPF server is disabled.&#34;</span>
;<span class="comment-line">#     }</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     # Enable the OSPF protocol server.</span>
;<span class="comment-line">#     SetProtocolServerInfo $txPort -ospfService true</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     # Do other stuff here.</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     # Restore the OSPF protocol server to its former state.</span>
;<span class="comment-line">#     SetProtocolServerInfo $txPort -ospfService $ospfOnOrOff</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::GetProtocolServerInfo_78">proc <a href="ixiaProtSrv.tcl-annot.html#::::GetProtocolServerInfo">::::GetProtocolServerInfo</a></a></strong> {portId args} {
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> -noComplain GetProtocolServerInfo $args {
        arpService  &#34;&#34;
        bgpService  &#34;&#34;
        igmpService &#34;&#34;
        isisService &#34;&#34;
        ospfService &#34;&#34;
        pingService &#34;&#34;
        ripService  &#34;&#34;
        rsvpService &#34;&#34;
        mldService &#34;&#34;
    }

    if {$portId &lt; 1} {
        error &#34;GetProtocolServerInfo: Port ID $portId is out of range.  It must be greater than 0.&#34;
    }

    <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port

    if {[protocolServer get $chas $card $port]} {
        error &#34;GetProtocolServerInfo: protocolServer get $chas $card $port failed.&#34;
    }

    if {$arpService != &#34;&#34;} {
        upvar $arpService tmp
        set tmp [protocolServer cget -enableArpResponse]
    }
    if {$bgpService != &#34;&#34;} {
        upvar $bgpService tmp
        set tmp [protocolServer cget -enableBgp4Service]
    }
    if {$igmpService != &#34;&#34;} {
        upvar $igmpService tmp
        set tmp [protocolServer cget -enableIgmpQuery]
    }
    if {$isisService != &#34;&#34;} {
        upvar $isisService tmp
        set tmp [protocolServer cget -enableIsisService]
    }
    if {$ospfService != &#34;&#34;} {
        upvar $ospfService tmp
        set tmp [protocolServer cget -enableOspfService]
    }
    if {$pingService != &#34;&#34;} {
        upvar $pingService tmp
        set tmp [protocolServer cget -enablePingResponse]
    }
    if {$ripService != &#34;&#34;} {
        upvar $ripService tmp
        set tmp [protocolServer cget -enableRipService]
    }
    if {$rsvpService != &#34;&#34;} {
        upvar $rsvpService tmp
        set tmp [protocolServer cget -enableRsvpService]
    }
    if {$mldService != &#34;&#34;} {
        upvar $mldService tmp
        set tmp [protocolServer cget -enableMldService]
    }
} ;<span class="comment-line"># GetProtocolServerInfo</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># SetProtocolServerInfo</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function will enable or disable the specified protocol</span>
;<span class="comment-line"># services for the specified port.  Specifying true or 1 for a</span>
;<span class="comment-line"># service will enable that service, and specifying false or 0</span>
;<span class="comment-line"># will disable it.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portId: The logical port number to query.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-arpService &lt;on=&#34;&#34;&gt;]: Enable or disable the ARP protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-bgpService &lt;on=&#34;&#34;&gt;]: Enable or disable the BGP4 protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-igmpService &lt;on=&#34;&#34;&gt;]: Enable or disable the IGMP protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-isisService &lt;on=&#34;&#34;&gt;]: Enable or disable the ISIS protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-ospfService &lt;on=&#34;&#34;&gt;]: Enable or disable the OSPF protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-pingService &lt;on=&#34;&#34;&gt;]: Enable or disable the PING protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-ripService &lt;on=&#34;&#34;&gt;]: Enable or disable the RIP protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-rsvpService &lt;on=&#34;&#34;&gt;]: Enable or disable the RSVP protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-mldService &lt;on=&#34;&#34;&gt;]: Enable or disable the MLD protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-write &lt;wr=true&gt;]: Specifies if protocol server settings</span>
;<span class="comment-line">#         are written to the IXIA hardware.  If left omitted,</span>
;<span class="comment-line">#         -write defaults to true.  When performing multiple</span>
;<span class="comment-line">#         protocol server changes, it may be useful to inhibit</span>
;<span class="comment-line">#         writing for performance reasons.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value: None.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     GetProtocolServerInfo $txPort -ospfService ospfOnOrOff</span>
;<span class="comment-line">#     if {$ospfOnOrOff} {</span>
;<span class="comment-line">#         result_debug &#34;OSPF server is enabled.&#34;</span>
;<span class="comment-line">#     } else {</span>
;<span class="comment-line">#         result_debug &#34;OSPF server is disabled.&#34;</span>
;<span class="comment-line">#     }</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     # Enable the OSPF protocol server.</span>
;<span class="comment-line">#     SetProtocolServerInfo $txPort -ospfService true</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     # Do other stuff here.</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     # Restore the OSPF protocol server to its former state.</span>
;<span class="comment-line">#     SetProtocolServerInfo $txPort -ospfService $ospfOnOrOff</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::SetProtocolServerInfo_209">proc <a href="ixiaProtSrv.tcl-annot.html#::::SetProtocolServerInfo">::::SetProtocolServerInfo</a></a></strong> {portId args} {
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> -noComplain SetProtocolServerInfo $args {
        arpService  &#34;&#34;
        bgpService  &#34;&#34;
        igmpService &#34;&#34;
        isisService &#34;&#34;
        ospfService &#34;&#34;
        pingService &#34;&#34;
        ripService  &#34;&#34;
        rsvpService &#34;&#34;
        mldService &#34;&#34;
        write       &#34;true&#34;
    }

   global TrafficGen
   switch -exact -- $TrafficGen {
      
      stc {
         return
      }
      ixia -
      ixvm {
    if {$portId &lt; 1} {
        error &#34;SetProtocolServerInfo: Port ID $portId is out of range.  It must be greater than 0.&#34;
    }

    <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port

    if {[protocolServer get $chas $card $port]} {
        error &#34;SetProtocolServerInfo: protocolServer get $chas $card $port failed.&#34;
    }

    if {$arpService != &#34;&#34;} {
        protocolServer config -enableArpResponse $arpService
    }
    if {$bgpService != &#34;&#34;} {
        protocolServer config -enableBgp4Service $bgpService
    }
    if {$igmpService != &#34;&#34;} {
        protocolServer config -enableIgmpQuery $igmpService
    }
    if {$isisService != &#34;&#34;} {
        protocolServer config -enableIsisService $isisService
    }
    if {$ospfService != &#34;&#34;} {
        protocolServer config -enableOspfService $ospfService
    }
    if {$pingService != &#34;&#34;} {
        protocolServer config -enablePingResponse $pingService
    }
    if {$ripService != &#34;&#34;} {
        protocolServer config -enableRipService $ripService
    }
    if {$rsvpService != &#34;&#34;} {
        protocolServer config -enableRsvpService $rsvpService
    }
    if {$mldService != &#34;&#34;} {
        protocolServer config -enableMldService $mldService
    }

    if {[protocolServer set $chas $card $port]} {
        error &#34;SetProtocolServerInfo: protocolServer set $chas $card $port failed.&#34;
    }
    
    if {[<a name="::IsTrue(1)"><a href="./misc.tcl.html#::IsTrue_2185">::IsTrue</a></a> $write]} {
        if {[protocolServer write $chas $card $port]} {
            error &#34;SetProtocolServerInfo: protocolServer write $chas $card $port failed.&#34;
        }
    }
      }
   }
} ;<span class="comment-line"># SetProtocolServerInfo</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># GetGwIpAddr</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function retrieves the gateway IP address in the IXIA's</span>
;<span class="comment-line"># IP address table for the specified port.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portId: The logical port number to query.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value: An IP address.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     set newGwIpAddr &#34;10.30.1.1&#34;</span>
;<span class="comment-line">#     set oldGwIpAddr [GetGwIpAddr $txPort]</span>
;<span class="comment-line">#     SetGwIpAddr $txPort $newGwIpAddr</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     SetGwIpAddr $txPort $oldGwIpAddr</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::GetGwIpAddr_308">proc <a href="ixiaProtSrv.tcl-annot.html#::::GetGwIpAddr">::::GetGwIpAddr</a></a></strong> {portId} {
    if {$portId &lt; 1} {
        error &#34;GetGwIpAddr: Port ID $portId is out of range.  It must be greater than 0.&#34;
    }

    <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port

    if {[ipAddressTable get $chas $card $port]} {
        error &#34;GetGwIpAddr: ipAddressTable get $chas $card $port failed.&#34;
    }

    return [ipAddressTable cget -defaultGateway]
} ;<span class="comment-line"># GetGwIpAddr</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># SetGwIpAddr</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function sets the gateway IP address in the IXIA's IP</span>
;<span class="comment-line"># address table for the specified port.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portId: The logical port number to modify.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     gIpAddr: An IP address representing the IXIA port's default</span>
;<span class="comment-line">#         gateway.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-write &lt;wr=true&gt;]: Specifies if protocol server settings</span>
;<span class="comment-line">#         are written to the IXIA hardware.  If omitted, -write</span>
;<span class="comment-line">#         defaults to true.  When performing multiple protocol</span>
;<span class="comment-line">#         server changes, it may be useful to inhibit writing for</span>
;<span class="comment-line">#         performance reasons.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value: None.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     set newGwIpAddr &#34;10.30.1.1&#34;</span>
;<span class="comment-line">#     set oldGwIpAddr [GetGwIpAddr $txPort]</span>
;<span class="comment-line">#     SetGwIpAddr $txPort $newGwIpAddr -write true</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     SetGwIpAddr $txPort $oldGwIpAddr -write true</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::SetGwIpAddr_357">proc <a href="ixiaProtSrv.tcl-annot.html#::::SetGwIpAddr">::::SetGwIpAddr</a></a></strong> {portId gIpAddr args} {
    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> -noComplain SetGwIpAddr $args {
        write &#34;true&#34;
    }

    if {$portId &lt; 1} {
        error &#34;SetGwIpAddr: Port ID $portId is out of range.  It must be greater than 0.&#34;
    }

    if {![<a name="::IsValidIpAddress(1)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $gIpAddr]} {
        error &#34;SetGwIpAddr: Invalid IP address, \&#34;$gIpAddr\&#34; specified.&#34;
    }

    <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port

    ipAddressTable setDefault
    if {[ipAddressTable get $chas $card $port]} {
        error &#34;SetGwIpAddr: ipAddressTable get $chas $card $port failed.&#34;
    }

    ipAddressTable config -defaultGateway $gIpAddr

    if {[ipAddressTable set $chas $card $port]} {
        error &#34;SetGwIpAddr: ipAddressTable set $chas $card $port failed.&#34;
    }

    if {[<a name="::IsTrue(2)"><a href="./misc.tcl.html#::IsTrue_2185">::IsTrue</a></a> $write]} {
        if {[protocolServer write $chas $card $port]} {
            error &#34;SetGwIpAddr: protocolServer write $chas $card $port failed.&#34;
        }
    }
} ;<span class="comment-line"># SetGwIpAddr</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># AddIpAddress</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function adds a range of IP addresses to the IXIA's IP</span>
;<span class="comment-line"># address table for the specified port.  No checking is done to</span>
;<span class="comment-line"># see if the new address range matches or overlaps an already</span>
;<span class="comment-line"># existing range.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portId: The logical port number to add to.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     ipAddr: The starting IP address of the range to add into</span>
;<span class="comment-line">#             the table.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-macAddr &lt;ma=&#34;default&#34;&gt;]: The starting MAC address of the</span>
;<span class="comment-line">#         range to add into the table.  If not specified, or if</span>
;<span class="comment-line">#         set to the keyword &#34;default&#34;, then the starting address</span>
;<span class="comment-line">#         is set to the MAC address configured in the IXIA &#34;port</span>
;<span class="comment-line">#         config -MacAddress&#34; object.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-netMask {nm=24&gt;]: An integer represent the IP network</span>
;<span class="comment-line">#         mask to be used.  If a value of 0 is specified, then</span>
;<span class="comment-line">#         the network mask is disabled for the IP address range.</span>
;<span class="comment-line">#         If not specified, the netmask defaults to a value of</span>
;<span class="comment-line">#         24.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-numAddrs &lt;na=1&gt;]: The number of IP addresses in the new</span>
;<span class="comment-line">#         address range.  IP addresses are generated by</span>
;<span class="comment-line">#         incrementing the host portion of $ipAddr (as determined</span>
;<span class="comment-line">#         by -netMask).  If not specified, the number of</span>
;<span class="comment-line">#         addresses defaults to 1.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-mapType &lt;mt=&#34;oneIpToOneMAC&#34;&gt;]: This option controls how</span>
;<span class="comment-line">#         MAC addresses are generated for thr range.  If the</span>
;<span class="comment-line">#         keyword &#34;oneIpToOneMAC&#34; or the value &#34;0&#34; is specified,</span>
;<span class="comment-line">#         then there will be a distinct MAC address for each IP</span>
;<span class="comment-line">#         address in the range.  MAC addresses are generated by</span>
;<span class="comment-line">#         incrementing the address specified in the -macAddr</span>
;<span class="comment-line">#         option.  If the keyword &#34;manyIpToOneMAC&#34; or the value</span>
;<span class="comment-line">#         &#34;1&#34; is specified, then all the IP addresses in the</span>
;<span class="comment-line">#         range will use the same MAC address.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-gwIpAddr &lt;gw=&#34;&#34;&gt;]: The IP address of a gateway used to</span>
;<span class="comment-line">#         override the gateway IP address specified for this</span>
;<span class="comment-line">#         port's IP address table.  If not specified, or set to</span>
;<span class="comment-line">#         the empty string (&#34;&#34; or {}), then the gateway IP</span>
;<span class="comment-line">#         address will not be overridden.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-objName &lt;on=&#34;&#34;&gt;]: Specifies an array name from which to</span>
;<span class="comment-line">#         take parameter values.  The keys for this array are</span>
;<span class="comment-line">#         ipAddr, macAddr, netMask, numAddrs, mapType, and</span>
;<span class="comment-line">#         gwIpAddr.  They take the same values and follow the</span>
;<span class="comment-line">#         same restrictions as their -parameter based counter-</span>
;<span class="comment-line">#         parts.  If an array name is specified, its values</span>
;<span class="comment-line">#         override any value specified by -parameters.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-write &lt;wr=true&gt;]: Specifies if protocol server settings</span>
;<span class="comment-line">#         are written to the IXIA hardware.  If omitted, -write</span>
;<span class="comment-line">#         defaults to true.  When performing multiple protocol</span>
;<span class="comment-line">#         server changes, it may be useful to inhibit writing for</span>
;<span class="comment-line">#         performance reasons.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value: None.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     set ipAddr &#34;10.30.1.1&#34;</span>
;<span class="comment-line">#     AddIpAddress $txPort $ipAddr</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     DeleteIpAddress $txPort $ipAddr</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::AddIpAddress_468">proc <a href="ixiaProtSrv.tcl-annot.html#::::AddIpAddress">::::AddIpAddress</a></a></strong> {portId ipAddr args} {
    <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> -noComplain AddIpAddress $args {
        macAddr  &#34;default&#34;
        tag      &#34;none&#34;
        netMask  24
        numAddrs 1
        mapType  &#34;oneIpToOneMAC&#34;
        gwIpAddr &#34;&#34;
        objName  &#34;&#34;
        write    &#34;true&#34;
    }
   global TrafficGen
    if {$portId &lt; 1} {
        error &#34;AddIpAddress: Port ID $portId is out of range.  It must be greater than 0.&#34;
    }

   
   switch -exact -- $TrafficGen {
      stc {        
         set error_flag 0
         if {![<a name="::IsValidIpAddress(2)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $ipAddr]} {
            error &#34;AddIpAddress: Invalid IP address, \&#34;$ipAddr\&#34; specified.&#34;
         }
         
         if {$macAddr != &#34;default&#34; &amp;&amp; [<a name="::isMacAddressValid(1)"><a href="./ePTUtils.tcl.html#::isMacAddressValid_632">::isMacAddressValid</a></a> $macAddr] != 0} {
            error &#34;AddIpAddress: Invalid MAC address, \&#34;$macAddr\&#34; specified.&#34;
         }
         
         if {![string is integer $netMask] || $netMask &lt; 0 || $netMask &gt; 32} {
            error &#34;AddIpAddress: Invalid netmask, \&#34;$netMask\&#34; specified.&#34;
         }
         
         if {![string is integer $numAddrs] || $numAddrs &lt; 1} {
            error &#34;AddIpAddress: Invalid number of addresses, \&#34;$numAddrs\&#34; specified.&#34;
         }
         
         if {([string is integer $mapType] &amp;&amp; ($mapType &lt; 0 || $mapType &gt; 1)) ||
             (![string is integer $mapType] &amp;&amp; ($mapType != &#34;oneIpToOneMAC&#34; &amp;&amp; $mapType != &#34;manyIpToOneMAC&#34;))} {
            error &#34;AddIpAddress: Invalid map type, \&#34;$mapType\&#34; specified.&#34;
         }
         
         if {$gwIpAddr != &#34;&#34; &amp;&amp; ![<a name="::IsValidIpAddress(3)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $gwIpAddr]} {
            error &#34;AddIpAddress: Invalid gateway IP address, \&#34;$gwIpAddr\&#34; specified.&#34;
         }
         set txPortId [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]
         if {($tag == &#34;none&#34;) || !$tag} {
            array set cmdResults [<a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv4If EthIIIf&#34; -IfCount &#34;1 1&#34; -DeviceCount $numAddrs -CreateCount $numAddrs]
            
            
         } else {
            array set cmdResults [<a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv4If VlanIf EthIIIf&#34; -IfCount &#34;1 1 1&#34; -DeviceCount $numAddrs -CreateCount $numAddrs]
            foreach deviceHndl $cmdResults(-ReturnList) {
               <a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] -VlanId $tag
            }
         }
         if {($mapType == &#34;oneIpToOneMAC&#34;) &amp;&amp; $numAddrs &gt; 1} {
            
            
            set deviceHndlList $cmdResults(-ReturnList)
            set index 0
            if {$macAddr == &#34;default&#34;} {set macAddr [<a name="::GetDefaultPortIdMAC(1)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $portId]}
            set tmpMacAddr $macAddr
            foreach deviceHndl $deviceHndlList {
               if {$gwIpAddr == {}} {
                  <a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] -Address [<a name="::incrIpField(1)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $ipAddr 4 $index] -PrefixLength $netMask -skipReserved FALSE
               } else {
                  <a name="::logcmd(9)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(10)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] -Address [<a name="::incrIpField(2)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $ipAddr 4 $index] -Gateway $gwIpAddr -PrefixLength $netMask -skipReserved FALSE
               }
               <a name="::logcmd(11)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(12)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] -SourceMac $tmpMacAddr
               incr index
               set tmpMacAddr [<a name="::incrMacAddr(1)"><a href="./loadShareUtil.tcl.html#::incrMacAddr_1483">::incrMacAddr</a></a> $tmpMacAddr]
            }
         } else {
            
            set deviceHndlList $cmdResults(-ReturnList)
            set index 0
            
            foreach deviceHndl $deviceHndlList {
               set dip [<a name="::incrIpField(3)"><a href="./ePTUtils.tcl.html#::incrIpField_522">::incrIpField</a></a> $ipAddr 4 $index]
               <span class="comment-line"># if broadcast then set prefix to 32</span>
               if {[expr 0xffffffff &gt;&gt; $netMask] == [expr (0xffffffff &gt;&gt; $netMask) &amp; [<a name="::ip2int(1)"><a href="./spirent.tcl.html#::ip2int_3418">::ip2int</a></a> $dip]] } {
                  set netMask 32
                  if {[lindex [split $dip .] 0] &gt;= 224} { set dip [join [lreplace [split $dip .] 0 0 223] .] }
               }
               if {$gwIpAddr == {}} {
                  <a name="::logcmd(13)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(14)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] -Address $dip -PrefixLength $netMask -skipReserved FALSE
               } else {
                  <a name="::logcmd(15)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(16)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] -Address $dip -Gateway $gwIpAddr -PrefixLength $netMask -skipReserved FALSE
               }
               if {$macAddr == &#34;default&#34;} {set macAddr [<a name="::GetDefaultPortIdMAC(2)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $portId]}
               <a name="::logcmd(17)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(18)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-EthIIIf] -SourceMac $macAddr
               incr index
               <a name="::logcmd(19)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
            }
         }         
         return $deviceHndlList
      }
      ixia -
      ixvm {
    <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
    if {$objName != &#34;&#34;} {
        upvar $objName ipArray
        if {![info exists ipArray]} {
            error &#34;AddIpAddress: Invalid array name, \&#34;$objName\&#34; specified.&#34;
        }
        set ipAddr   $ipArray(ipAddr)
        set macAddr  $ipArray(macAddr)
        set netMask  $ipArray(netMask)
        set numAddrs $ipArray(numAddrs)
        set mapType  $ipArray(mapType)
        set gwIpAddr $ipArray(gwIpAddr)
    }

    if {![<a name="::IsValidIpAddress(4)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $ipAddr]} {
        error &#34;AddIpAddress: Invalid IP address, \&#34;$ipAddr\&#34; specified.&#34;
    }

    if {$macAddr != &#34;default&#34; &amp;&amp; [<a name="::isMacAddressValid(2)"><a href="./ePTUtils.tcl.html#::isMacAddressValid_632">::isMacAddressValid</a></a> $macAddr] != 0} {
        error &#34;AddIpAddress: Invalid MAC address, \&#34;$macAddr\&#34; specified.&#34;
    }

    if {![isValidInteger $netMask] || $netMask &lt; 0 || $netMask &gt; 32} {
        error &#34;AddIpAddress: Invalid netmask, \&#34;$netMask\&#34; specified.&#34;
    }

    if {![isValidInteger $numAddrs] || $numAddrs &lt; 1} {
        error &#34;AddIpAddress: Invalid number of addresses, \&#34;$numAddrs\&#34; specified.&#34;
    }

    if {([isValidInteger $mapType] &amp;&amp; ($mapType &lt; 0 || $mapType &gt; 1)) ||
        (![isValidInteger $mapType] &amp;&amp; ($mapType != &#34;oneIpToOneMAC&#34; &amp;&amp; $mapType != &#34;manyIpToOneMAC&#34;))} {
        error &#34;AddIpAddress: Invalid map type, \&#34;$mapType\&#34; specified.&#34;
    }

    if {$gwIpAddr != &#34;&#34; &amp;&amp; ![<a name="::IsValidIpAddress(5)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $gwIpAddr]} {
        error &#34;AddIpAddress: Invalid gateway IP address, \&#34;$gwIpAddr\&#34; specified.&#34;
    }

    ipAddressTable setDefault
    ipAddressTableItem setDefault

    if {[ipAddressTable get $chas $card $port]} {
        error &#34;AddIpAddress: ipAddressTable get $chas $card $port failed.&#34;
    }

    ipAddressTableItem config -fromIpAddress $ipAddr

    if {$macAddr == &#34;default&#34;} {
        if {[<a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port]} {
            error &#34;AddIpAddress: port get $chas $card $port failed.&#34;
        }
        set macAddr [<a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]
    }
    ipAddressTableItem config -fromMacAddress $macAddr

    if {$tag != &#34;none&#34;} {
       <span class="comment-line"># Tag is only available in 3.65</span>
       if {![regexp -nocase &#34;3.50&#34; [<a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -installVersion]]} {
          ipAddressTableItem config -enableVlan true
          ipAddressTableItem config -vlanId $tag
       }
    }
    if {$netMask} {
        ipAddressTableItem config -enableUseNetwork true
        ipAddressTableItem config -netMask $netMask
    }

    ipAddressTableItem config -numAddresses $numAddrs
    ipAddressTableItem config -mappingOption $mapType

    if {$gwIpAddr != &#34;&#34;} {
        ipAddressTableItem config -overrideDefaultGateway true
        ipAddressTableItem config -gatewayIpAddress $gwIpAddr
    }

    ipAddressTableItem set

    if {[ipAddressTable addItem]} {
        error &#34;AddIpAddress: ipAddressTable addItem failed.&#34;
    }
    if {[ipAddressTable set $chas $card $port]} {
        error &#34;AddIpAddress: ipAddressTable set $chas $card $port failed.&#34;
    }

interfaceTable               select            $chas $card $port
interfaceTable               clearAllInterfaces 
interfaceIpV4                setDefault        
if {$gwIpAddr != &#34;&#34;} {
   interfaceIpV4                config            -gatewayIpAddress                   $gwIpAddr
}
if {$netMask} {
   interfaceIpV4                config            -maskWidth                          $netMask
}
interfaceIpV4                config            -ipAddress                          $ipAddr
interfaceEntry               addItem           addressTypeIpV4

interfaceEntry               setDefault        
interfaceEntry               config            -enable                             true
interfaceEntry               config            -description                        &#34;$ipAddr/$netMask - $card:$port&#34;
interfaceEntry               config            -macAddress                         $macAddr
if {$tag != &#34;none&#34;} {
   interfaceEntry               config            -enableVlan                         true
   interfaceEntry               config            -vlanId                             $tag
} else {
   interfaceEntry               config            -enableVlan                         false
   interfaceEntry               config            -vlanId                             0
}
interfaceEntry               config            -vlanPriority                       0
interfaceTable               addInterface      

interfaceEntry               clearAllItems     addressTypeIpV6
interfaceEntry               clearAllItems     addressTypeIpV4

    if {[<a name="::IsTrue(3)"><a href="./misc.tcl.html#::IsTrue_2185">::IsTrue</a></a> $write]} {
        if {[protocolServer write $chas $card $port]} {
            error &#34;AddIpAddress: protocolServer write $chas $card $port failed.&#34;
        }
    }
      }
   }
} ;<span class="comment-line"># AddIpAddress</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># GetIpAddress</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function will retrieve the attributes for an IP address</span>
;<span class="comment-line"># range from the IXIA's IP address table for the specified port.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portId: The logical port number to query.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     ipAddr: The starting IP address of the range to query.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     [-macAddrName &lt;vn=&#34;&#34;&gt;]: Specifies a TCL variable name into</span>
;<span class="comment-line">#         which the base MAC address for the address range will</span>
;<span class="comment-line">#         be stored.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-netMaskName &lt;vn=&#34;&#34;&gt;]: Specifies a TCL variable name into</span>
;<span class="comment-line">#         which the IP network mask for the address range will</span>
;<span class="comment-line">#         be stored.  If a network mask is disabled for this</span>
;<span class="comment-line">#         range, then the returned netMask value will be 0.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-numAddrsName &lt;vn=&#34;&#34;&gt;]: Specifies a TCL variable name into</span>
;<span class="comment-line">#         which the number of IP addresses for the address range</span>
;<span class="comment-line">#         will be stored.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-mapTypeName &lt;vn=&#34;&#34;&gt;]: Specifies a TCL variable name into</span>
;<span class="comment-line">#         which the IP address to MAC address mapping mode will</span>
;<span class="comment-line">#         be stored.  A value of &#34;0&#34; indicates a one-to-one</span>
;<span class="comment-line">#         mapping.  A value of &#34;1&#34; indicates a many-to-one</span>
;<span class="comment-line">#         mapping.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-gwIpAddrName &lt;vn=&#34;&#34;&gt;]: Specifies a TCL variable name into</span>
;<span class="comment-line">#         which the gateway IP address for the address range will</span>
;<span class="comment-line">#         be stored.  If this range is not overriding the IP</span>
;<span class="comment-line">#         address table's gateway IP address, then the returned</span>
;<span class="comment-line">#         value will be the empty string, &#34;&#34;.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-objName &lt;on=&#34;&#34;&gt;]: Specifies a TCL array name into which</span>
;<span class="comment-line">#         all the attributes of the address range will be stored.</span>
;<span class="comment-line">#         The keys for this array are ipAddr, macAddr, netMask,</span>
;<span class="comment-line">#         numAddrs, mapType, and gwIpAddr.  The value for each</span>
;<span class="comment-line">#         key has the same meaning as its -parameter based</span>
;<span class="comment-line">#         counterpart.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value:</span>
;<span class="comment-line">#     0 if the specified IP address range does not exist.</span>
;<span class="comment-line">#     1 if the specified IP address range exists.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     set ipAddr &#34;10.30.1.1&#34;</span>
;<span class="comment-line">#     GetIpAddress $txPort $ipAddr -objName ipAttrs</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     SetIpAddress $txPort $ipAddr -objName ipAttrs</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::GetIpAddress_750">proc <a href="ixiaProtSrv.tcl-annot.html#::::GetIpAddress">::::GetIpAddress</a></a></strong> {portId ipAddr args} {
    <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> -noComplain GetIpAddress $args {
        macAddrName  &#34;&#34;
        netMaskName  &#34;&#34;
        numAddrsName &#34;&#34;
        mapTypeName  &#34;&#34;
        gwIpAddrName &#34;&#34;
        objName      &#34;&#34;
    }

    if {$portId &lt; 1} {
        error &#34;GetIpAddress: Port ID $portId is out of range.  It must be greater than 0.&#34;
    }

    <a name="::MapIxiaPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port

    if {![<a name="::IsValidIpAddress(6)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $ipAddr]} {
        error &#34;GetIpAddress: Invalid IP address, \&#34;$ipAddr\&#34; specified.&#34;
    }

    ipAddressTable setDefault
    ipAddressTableItem setDefault

    if {[ipAddressTable get $chas $card $port]} {
        error &#34;GetIpAddress: ipAddressTable get $chas $card $port failed.&#34;
    }

    if {[ipAddressTable getItem $ipAddr]} {
        return 0
    }

    if {$macAddrName != &#34;&#34;} {
        upvar $macAddrName macAddr
        set macAddr [ipAddressTableItem cget -fromMacAddress]
    }
    if {$netMaskName != &#34;&#34;} {
        upvar $netMaskName netMask
        if {[ipAddressTableItem cget -enableUseNetwork]} {
            set netMask [ipAddressTableItem cget -netMask]
        } else {
            set netMask 0
        }
    }
    if {$numAddrsName != &#34;&#34;} {
        upvar $numAddrsName numAddrs
        set numAddrs [ipAddressTableItem cget -numAddresses]
    }
    if {$mapTypeName != &#34;&#34;} {
        upvar $mapTypeName mapType
        set mapType [ipAddressTableItem cget -mappingOption]
    }
    if {$gwIpAddrName != &#34;&#34;} {
        upvar $gwIpAddrName gwIpAddr
        if {[ipAddressTableItem cget -overrideDefaultGateway]} {
            set gwIpAddr [ipAddressTableItem cget -gatewayIpAddress]
        } else {
            set gwIpAddr &#34;&#34;
        }
    }

    if {$objName != &#34;&#34;} {
        upvar $objName ipArray

        set ipArray(ipAddr)       $ipAddr
        set ipArray(macAddr)      [ipAddressTableItem cget -fromMacAddress]
        
        if {[ipAddressTableItem cget -enableUseNetwork]} {
            set ipArray(netMask)  [ipAddressTableItem cget -netMask]
        } else {
            set ipArray(netMask)  0
        }

        set ipArray(numAddrs)     [ipAddressTableItem cget -numAddresses]
        set ipArray(mapType)      [ipAddressTableItem cget -mappingOption]

        if {[ipAddressTableItem cget -overrideDefaultGateway]} {
            set ipArray(gwIpAddr) [ipAddressTableItem cget -gatewayIpAddress]
        } else {
            set ipArray(gwIpAddr) &#34;&#34;
        }
    }

    return 1
} ;<span class="comment-line"># GetIpAddress</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># SetIpAddress</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function will modify the attributes for an existing IP</span>
;<span class="comment-line"># address range in the IXIA's IP address table for the specified</span>
;<span class="comment-line"># port.  Note that this function will only modify attributes</span>
;<span class="comment-line"># specified in the parameter list.  Any unspecified parameters</span>
;<span class="comment-line"># will preserve the existing attributes.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portId: The logical port number to modify on.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     ipAddr: The starting IP address of the range to modify.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-macAddr &lt;ma&gt;]: The starting MAC address of the range to</span>
;<span class="comment-line">#         modify.  If set to the keyword &#34;default&#34;, then the</span>
;<span class="comment-line">#         starting address is set to the MAC address configured</span>
;<span class="comment-line">#         in the IXIA &#34;port config -MacAddress&#34; object.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-netMask {nm&gt;]: An integer represent the IP network mask</span>
;<span class="comment-line">#         to be used.  If a value of 0 is specified, then the</span>
;<span class="comment-line">#         network mask is disabled for the IP address range.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-numAddrs &lt;na&gt;]: The number of IP addresses in the IP</span>
;<span class="comment-line">#         address range.  IP addresses are generated by</span>
;<span class="comment-line">#         incrementing the host portion of $ipAddr (as determined</span>
;<span class="comment-line">#         by -netMask).</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-mapType &lt;mt&gt;]: This option controls how MAC addresses are</span>
;<span class="comment-line">#         generated for thr range.  If the keyword</span>
;<span class="comment-line">#         &#34;oneIpToOneMAC&#34; or the value &#34;0&#34; is specified, then</span>
;<span class="comment-line">#         there will be a distinct MAC address for each IP</span>
;<span class="comment-line">#         address in the range.  MAC addresses are generated by</span>
;<span class="comment-line">#         incrementing the address specified in the -macAddr</span>
;<span class="comment-line">#         option.  If the keyword &#34;manyIpToOneMAC&#34; or the value</span>
;<span class="comment-line">#         &#34;1&#34; is specified, then all the IP addresses in the</span>
;<span class="comment-line">#         range will use the same MAC address.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-gwIpAddr &lt;gw&gt;]: The IP address of a gateway used to</span>
;<span class="comment-line">#         override the gateway IP address specified for this</span>
;<span class="comment-line">#         port's IP address table.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-objName &lt;on&gt;]: Specifies an array name from which to take</span>
;<span class="comment-line">#         parameter values.  The keys for this array are ipAddr,</span>
;<span class="comment-line">#         macAddr, netMask, numAddrs, mapType, and gwIpAddr.</span>
;<span class="comment-line">#         They take the same values and follow the same restrict-</span>
;<span class="comment-line">#         ions as their -parameter based counterparts.  If an</span>
;<span class="comment-line">#         array name is specified, its values override any value</span>
;<span class="comment-line">#         specified by -parameters.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-write &lt;wr=true&gt;]: Specifies if protocol server settings</span>
;<span class="comment-line">#         are written to the IXIA hardware.  If omitted, -write</span>
;<span class="comment-line">#         defaults to true.  When performing multiple protocol</span>
;<span class="comment-line">#         server changes, it may be useful to inhibit writing for</span>
;<span class="comment-line">#         performance reasons.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value:</span>
;<span class="comment-line">#     0 if the specified IP address range does not exist.</span>
;<span class="comment-line">#     1 if the specified IP address range exists.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     set ipAddr &#34;10.30.1.1&#34;</span>
;<span class="comment-line">#     GetIpAddress $txPort $ipAddr -objName ipAttrs</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     SetIpAddress $txPort $ipAddr -objName ipAttrs</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::SetIpAddress_909">proc <a href="ixiaProtSrv.tcl-annot.html#::::SetIpAddress">::::SetIpAddress</a></a></strong> {portId ipAddr args} {
    <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> -noComplain AddIpAddress $args {
        macAddr  &#34;NULL&#34;
        netMask  &#34;NULL&#34;
        numAddrs &#34;NULL&#34;
        mapType  &#34;NULL&#34;
        gwIpAddr &#34;NULL&#34;
        objName  &#34;NULL&#34;
        write    &#34;true&#34;
    }

    if {$portId &lt; 1} {
        error &#34;SetIpAddress: Port ID $portId is out of range.  It must be greater than 0.&#34;
    }

    <a name="::MapIxiaPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port

    if {$objName != &#34;NULL&#34;} {
        upvar $objName ipArray

        if {![info exists ipArray]} {
            error &#34;SetIpAddress: Invalid array name, \&#34;$objName\&#34; specified.&#34;
        }

        set ipAddr   $ipArray(ipAddr)
        set macAddr  $ipArray(macAddr)
        set netMask  $ipArray(netMask)
        set numAddrs $ipArray(numAddrs)
        set mapType  $ipArray(mapType)
        set gwIpAddr $ipArray(gwIpAddr)
    }

    if {![<a name="::IsValidIpAddress(7)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $ipAddr]} {
        error &#34;SetIpAddress: Invalid IP address, \&#34;$ipAddr\&#34; specified.&#34;
    }

    ipAddressTable setDefault
    ipAddressTableItem setDefault

    if {[ipAddressTable get $chas $card $port]} {
        error &#34;SetIpAddress: ipAddressTable get $chas $card $port failed.&#34;
    }

    if {[ipAddressTable getItem $ipAddr]} {
        return 0
    }

    if {$macAddr != &#34;NULL&#34;} {
        if {$macAddr == &#34;default&#34;} {
            if {[<a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port]} {
                error &#34;SetIpAddress: port get $chas $card $port failed.&#34;
            }
            set macAddr [<a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]
        } elseif {[<a name="::isMacAddressValid(3)"><a href="./ePTUtils.tcl.html#::isMacAddressValid_632">::isMacAddressValid</a></a> $macAddr] != 0} {
            error &#34;SetIpAddress: Invalid MAC address, \&#34;$macAddr\&#34; specified.&#34;
        }
        ipAddressTableItem config -fromMacAddress $macAddr
    }

    if {$netMask != &#34;NULL&#34;} {
        if {![isValidInteger $netMask] || $netMask &lt; 0 || $netMask &gt; 32} {
            error &#34;SetIpAddress: Invalid netmask, \&#34;$netMask\&#34; specified.&#34;
        }
        if {$netMask} {
            ipAddressTableItem config -enableUseNetwork true
            ipAddressTableItem config -netMask $netMask
        }
    }

    if {$numAddrs != &#34;NULL&#34;} {
        if {![isValidInteger $numAddrs] || $numAddrs &lt; 1} {
            error &#34;SetIpAddress: Invalid number of addresses, \&#34;$numAddrs\&#34; specified.&#34;
        }
        ipAddressTableItem config -numAddresses $numAddrs
    }

    if {$mapType != &#34;NULL&#34;} {
        if {([isValidInteger $mapType] &amp;&amp; ($mapType &lt; 0 || $mapType &gt; 1)) ||
            (![isValidInteger $mapType] &amp;&amp; ($mapType != &#34;oneIpToOneMAC&#34; &amp;&amp; $mapType != &#34;manyIpToOneMAC&#34;))} {
            error &#34;SetIpAddress: Invalid map type, \&#34;$mapType\&#34; specified.&#34;
        }
        ipAddressTableItem config -mappingOption $mapType
    }

    if {$gwIpAddr != &#34;NULL&#34;} {
        if {$gwIpAddr != &#34;&#34; &amp;&amp; ![<a name="::IsValidIpAddress(8)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $gwIpAddr]} {
            error &#34;SetIpAddress: Invalid gateway IP address, \&#34;$gwIpAddr\&#34; specified.&#34;
        }
        if {$gwIpAddr != &#34;&#34;} {
            ipAddressTableItem config -overrideDefaultGateway true
            ipAddressTableItem config -gatewayIpAddress $gwIpAddr
        }
    }

    ipAddressTableItem set
    if {[ipAddressTable set $chas $card $port]} {
        error &#34;SetIpAddress: ipAddressTable set $chas $card $port failed.&#34;
    }


    if {[<a name="::IsTrue(4)"><a href="./misc.tcl.html#::IsTrue_2185">::IsTrue</a></a> $write]} {
        if {[protocolServer write $chas $card $port]} {
            error &#34;SetIpAddress: protocolServer write $chas $card $port failed.&#34;
        }
    }

    return 1
} ;<span class="comment-line"># SetIpAddress</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># DeleteIpAddress</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function will remove an IP address range from the IXIA's</span>
;<span class="comment-line"># IP address table for the specified port.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portId: The logical port number from which to delete.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     ipAddr: The starting IP address of the range to remove.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-write &lt;wr=true&gt;]: Specifies if protocol server settings</span>
;<span class="comment-line">#         are written to the IXIA hardware.  If omitted, -write</span>
;<span class="comment-line">#         defaults to true.  When performing multiple protocol</span>
;<span class="comment-line">#         server changes, it may be useful to inhibit writing for</span>
;<span class="comment-line">#         performance reasons.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value: None.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     set ipAddr &#34;10.30.1.1&#34;</span>
;<span class="comment-line">#     AddIpAddress $txPort $ipAddr</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     DeleteIpAddress $txPort $ipAddr</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::DeleteIpAddress_1051">proc <a href="ixiaProtSrv.tcl-annot.html#::::DeleteIpAddress">::::DeleteIpAddress</a></a></strong> {portId ipAddr args} {
    <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> -noComplain DeleteIpAddress $args {
        write  &#34;true&#34;
    }

    if {$portId &lt; 1} {
        error &#34;DeleteIpAddress: Port ID $portId is out of range.  It must be greater than 0.&#34;
    }
   global TrafficGen
   
   switch -exact -- $TrafficGen {
      stc {
         
         if { [catch {
            set error_flag 0
            if {![<a name="::IsValidIpAddress(9)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $ipAddr]} {
               error &#34;DeleteIpAddress: Invalid IP address, \&#34;$ipAddr\&#34; specified.&#34;
            }
            
            set txPortId [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $portId]
            foreach deviceHndl [<a name="::logcmd(20)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources] {
               set ipv4If [<a name="::logcmd(21)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] 
               if {$ipv4If != &#34;&#34;} {
                  if {[<a name="::logcmd(22)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ipv4If -Address] == $ipAddr} {
                     <a name="::logcmd(23)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $deviceHndl
                  }
               }
            }
            
            
            
            
            
         } msg ] } {
            <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;AddIpAddress : Failed to configure AddIpAddress  $msg&#34;
            set error_flag 1
            
         }			
         
      }
      ixia -
      ixvm {
         
         
    <a name="::MapIxiaPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port

    if {![<a name="::IsValidIpAddress(10)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $ipAddr]} {
        error &#34;DeleteIpAddress: Invalid IP address, \&#34;$ipAddr\&#34; specified.&#34;
    }

    ipAddressTable setDefault
    ipAddressTableItem setDefault

    if {[ipAddressTable get $chas $card $port]} {
        error &#34;DeleteIpAddress: ipAddressTable get $chas $card $port failed.&#34;
    }

    if {[ipAddressTable getItem $ipAddr]} {
        return
    }

    if {[ipAddressTable delItem]} {
        error &#34;DeleteIpAddress: ipAddressTable delItem failed.&#34;
    }
    if {[ipAddressTable set $chas $card $port]} {
        error &#34;DeleteIpAddress: ipAddressTable set $chas $card $port failed.&#34;
    }

    if {[<a name="::IsTrue(5)"><a href="./misc.tcl.html#::IsTrue_2185">::IsTrue</a></a> $write]} {
        if {[protocolServer write $chas $card $port]} {
            error &#34;AddIpAddress: protocolServer write $chas $card $port failed.&#34;
        }
    }
      }
   }
} ;<span class="comment-line"># DeleteIpAddress</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># SaveAndSetProtocolServer</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function saves specific information about the specified</span>
;<span class="comment-line"># protocol servers on the IXIA, and then enables those servers</span>
;<span class="comment-line"># on the specified port.  It also saves any information about the</span>
;<span class="comment-line"># IXIA's IP address table for that port and then programs the</span>
;<span class="comment-line"># necessary IP addresses into the table.  All the saved infor-</span>
;<span class="comment-line"># mation is stored in the TCL array named by the objName para-</span>
;<span class="comment-line"># meter.  To restore the saved information, the</span>
;<span class="comment-line"># RestoreSavedProtocolServer function must be called.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portId: The logical port number to work on.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     ipAddr: The starting IP address of the range to add or</span>
;<span class="comment-line">#         modify.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     gwIpAddr: The IP address of the default gateway for this</span>
;<span class="comment-line">#         IXIA port.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#   To enable one or more protocol servers, specify any of the</span>
;<span class="comment-line">#   following parameters.</span>
;<span class="comment-line">#     [-arpService &lt;on=&#34;&#34;&gt;]: Enable or disable the ARP protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-bgpService &lt;on=&#34;&#34;&gt;]: Enable or disable the BGP4 protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-igmpService &lt;on=&#34;&#34;&gt;]: Enable or disable the IGMP protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-isisService &lt;on=&#34;&#34;&gt;]: Enable or disable the ISIS protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-ospfService &lt;on=&#34;&#34;&gt;]: Enable or disable the OSPF protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-pingService &lt;on=&#34;&#34;&gt;]: Enable or disable the PING protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-ripService &lt;on=&#34;&#34;&gt;]: Enable or disable the RIP protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-rsvpService &lt;on=&#34;&#34;&gt;]: Enable or disable the RSVP protocol</span>
;<span class="comment-line">#         server.  If not specified, no change will be made.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#   Optional IP address parameters:</span>
;<span class="comment-line">#     [-macAddr &lt;ma=&#34;default&#34;&gt;]: The starting MAC address of the</span>
;<span class="comment-line">#         range to add into the table.  If not specified, or if</span>
;<span class="comment-line">#         set to the keyword &#34;default&#34;, then the starting address</span>
;<span class="comment-line">#         is set to the MAC address configured in the IXIA &#34;port</span>
;<span class="comment-line">#         config -MacAddress&#34; object.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-netMask {nm=24&gt;]: An integer represent the IP network</span>
;<span class="comment-line">#         mask to be used.  If a value of 0 is specified, then</span>
;<span class="comment-line">#         the network mask is disabled for the IP address range.</span>
;<span class="comment-line">#         If not specified, the netmask defaults to a value of</span>
;<span class="comment-line">#         24.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-numAddrs &lt;na=1&gt;]: The number of IP addresses in the new</span>
;<span class="comment-line">#         address range.  IP addresses are generated by</span>
;<span class="comment-line">#         incrementing the host portion of $ipAddr (as determined</span>
;<span class="comment-line">#         by -netMask).  If not specified, the number of</span>
;<span class="comment-line">#         addresses defaults to 1.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-mapType &lt;mt=&#34;oneIpToOneMAC&#34;&gt;]: This option controls how</span>
;<span class="comment-line">#         MAC addresses are generated for thr range.  If the</span>
;<span class="comment-line">#         keyword &#34;oneIpToOneMAC&#34; or the value &#34;0&#34; is specified,</span>
;<span class="comment-line">#         then there will be a distinct MAC address for each IP</span>
;<span class="comment-line">#         address in the range.  MAC addresses are generated by</span>
;<span class="comment-line">#         incrementing the address specified in the -macAddr</span>
;<span class="comment-line">#         option.  If the keyword &#34;manyIpToOneMAC&#34; or the value</span>
;<span class="comment-line">#         &#34;1&#34; is specified, then all the IP addresses in the</span>
;<span class="comment-line">#         range will use the same MAC address.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [-gwIpAddr &lt;gw=&#34;&#34;&gt;]: The IP address of a gateway used to</span>
;<span class="comment-line">#         override the gateway IP address specified for this</span>
;<span class="comment-line">#         port's IP address table.  If not specified, or set to</span>
;<span class="comment-line">#         the empty string (&#34;&#34; or {}), then the gateway IP</span>
;<span class="comment-line">#         address will not be overridden.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     objName: The name of a TCL array into which information</span>
;<span class="comment-line">#         will be stored.  The key-value pairs in this array</span>
;<span class="comment-line">#         are for internal use only and should not be modified.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value:</span>
;<span class="comment-line">#     0 if the specified IP address range does not exist.</span>
;<span class="comment-line">#     1 if the specified IP address range exists.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     set ipAddr &#34;10.30.1.1&#34;</span>
;<span class="comment-line">#     set gwIpAddr &#34;10.30.1.2&#34;</span>
;<span class="comment-line">#     SaveAndSetProtocolServer $txPort $ipAddr $gwIpAddr ixInfo \</span>
;<span class="comment-line">#                              -arpService true \</span>
;<span class="comment-line">#                              -pingService true \</span>
;<span class="comment-line">#                              -macAddr &#34;00:A1:F1:00:00:01&#34;</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     RestoreSavedProtocolServer ixInfo</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::SaveAndSetProtocolServer_1235">proc <a href="ixiaProtSrv.tcl-annot.html#::::SaveAndSetProtocolServer">::::SaveAndSetProtocolServer</a></a></strong> {portId ipAddr gwIpAddr objName args} {
    set otherArgs [<a name="::parse_args(8)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> -noComplain SaveAndSetProtocolServer $args {
        tag         &#34;none&#34;
        arpService  &#34;&#34;
        bgpService  &#34;&#34;
        igmpService &#34;&#34;
        isisService &#34;&#34;
        ospfService &#34;&#34;
        pingService &#34;&#34;
        ripService  &#34;&#34;
        rsvpService &#34;&#34;
        mldService &#34;&#34;
        write       &#34;dummy arg to prevent cascading&#34;
    }]

    ;<span class="comment-line"># Validate the parameters.</span>
    if {$portId &lt; 1} {
        error &#34;SaveAndSetProtocolServer: Port ID $portId is out of range.  It must be greater than 0.&#34;
    }

    if {![<a name="::IsValidIpAddress(11)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $ipAddr]} {
        error &#34;SaveAndSetProtocolServer: Invalid IP address, \&#34;$ipAddr\&#34; specified.&#34;
    }

    if {![<a name="::IsValidIpAddress(12)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $gwIpAddr]} {
        error &#34;SaveAndSetProtocolServer: Invalid gateway IP address, \&#34;$gwIpAddr\&#34; specified.&#34;
    }

    if {$objName == &#34;&#34;} {
        error &#34;SaveAndSetProtocolServer: Invalid array name, \&#34;$objName\&#34; specified.&#34;
    }
    upvar $objName ipArray


    ;<span class="comment-line"># Save the port ID.</span>
    set ipArray(portId) $portId
    set ipArray(ipAddr) $ipAddr

    ;<span class="comment-line"># Save the IP address table's default gateway IP address.</span>
    set ipArray(tableGwIpAddr) [<a name="::GetGwIpAddr(1)"><a href="./ixiaProtSrv.tcl.html#::GetGwIpAddr_308">::GetGwIpAddr</a></a> $portId]

    ;<span class="comment-line"># Set the new gateway IP address.</span>
    <a name="::SetGwIpAddr(1)"><a href="./ixiaProtSrv.tcl.html#::SetGwIpAddr_357">::SetGwIpAddr</a></a> $portId $gwIpAddr -write false

    ;<span class="comment-line"># Check to see if the IP address range already exists.</span>
    set ipArray(ipFound) [<a name="::GetIpAddress(1)"><a href="./ixiaProtSrv.tcl.html#::GetIpAddress_750">::GetIpAddress</a></a> $portId $ipAddr -objName ipArray]
    if {$ipArray(ipFound)} {
        ;<span class="comment-line"># It exists, so delete the old one.</span>
        ;<span class="comment-line"># The parameters for the old range are already saved by the</span>
        ;<span class="comment-line"># call to GetIpAddress.</span>
        <a name="::DeleteIpAddress(1)"><a href="./ixiaProtSrv.tcl.html#::DeleteIpAddress_1051">::DeleteIpAddress</a></a> $portId $ipAddr -write false
    }
    
    ;<span class="comment-line"># Add the new IP address range.</span>
    eval AddIpAddress $portId $ipAddr -write false $args
    
    ;<span class="comment-line"># Build the argument list for GetProtocolServerInfo.</span>
    set protServs &#34;arpService bgpService igmpService isisService \
                   ospfService pingService ripService rsvpService \
                   mldService&#34;
    set getArgs &#34;&#34;
    foreach pServ $protServs {
        if {[set $pServ] == &#34;&#34;} {
            continue
        }
        lappend getArgs &#34;-$pServ ipArray($pServ)&#34;
    }
    set getArgs [join $getArgs]

    ;<span class="comment-line"># Save the state of the protocol servers.</span>
    eval GetProtocolServerInfo $portId $getArgs

    ;<span class="comment-line"># Set the new state of the protocol servers.</span>
    eval SetProtocolServerInfo $portId $args

    return $ipArray(ipFound)
} ;<span class="comment-line"># SaveAndSetProtocolServer</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># RestoreSavedProtocolServer</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function restores the IXIA protocol servers and IP address</span>
;<span class="comment-line"># table to the state saved by the SaveAndSetProtocolServer</span>
;<span class="comment-line"># function.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     objName: The name of a TCL array containing information</span>
;<span class="comment-line">#         stored by the SaveAndSetProtocolServer function.  The</span>
;<span class="comment-line">#         key-value pairs in this array are for internal use only</span>
;<span class="comment-line">#         and should not be modified.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: Variables in []'s are optional.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value: None.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     set ipAddr &#34;10.30.1.1&#34;</span>
;<span class="comment-line">#     set gwIpAddr &#34;10.30.1.2&#34;</span>
;<span class="comment-line">#     SaveAndSetProtocolServer $txPort $ipAddr $gwIpAddr ixInfo \</span>
;<span class="comment-line">#                              -arpService true \</span>
;<span class="comment-line">#                              -pingService true \</span>
;<span class="comment-line">#                              -macAddr &#34;00:A1:F1:00:00:01&#34;</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     RestoreSavedProtocolServer ixInfo</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::RestoreSavedProtocolServer_1346">proc <a href="ixiaProtSrv.tcl-annot.html#::::RestoreSavedProtocolServer">::::RestoreSavedProtocolServer</a></a></strong> objName {
    ;<span class="comment-line"># Validate the parameters.</span>
    if {$objName == &#34;&#34;} {
        error &#34;RestoreSavedProtocolServer: Invalid array name, \&#34;$objName\&#34; specified.&#34;
    }
    upvar $objName ipArray

   global TrafficGen
   switch -exact -- $TrafficGen {
      agilent {
         <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;Procedure 'RestoreSavedProtocolServer' is not valid on AGILENT N2X system, aborting...&#34;
         return 0
      }
      stc {
         <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Procedure 'RestoreSavedProtocolServer' is not valid on Spirent&#34;
         return 0
      }
      ixia {
      }
      ept {
      }
      default {
      }
   }
   
    set portId $ipArray(portId)

    ;<span class="comment-line"># Delete the IP address range created by SaveAndSetProtocolServer.</span>
    <a name="::DeleteIpAddress(2)"><a href="./ixiaProtSrv.tcl.html#::DeleteIpAddress_1051">::DeleteIpAddress</a></a> $portId $ipArray(ipAddr) -write false

    ;<span class="comment-line"># Restore the original IP address table item, if necessary.</span>
    if {$ipArray(ipFound)} {
        <a name="::AddIpAddress(1)"><a href="./ixiaProtSrv.tcl.html#::AddIpAddress_468">::AddIpAddress</a></a> $portId $ipArray(ipAddr) -objName ipArray -write false
    }
    
    ;<span class="comment-line"># Restore the gateway IP address.</span>
    <a name="::SetGwIpAddr(2)"><a href="./ixiaProtSrv.tcl.html#::SetGwIpAddr_357">::SetGwIpAddr</a></a> $portId $ipArray(tableGwIpAddr) -write false

    ;<span class="comment-line"># Build the argument list for SetProtocolServerInfo.</span>
    set protServs &#34;arpService bgpService igmpService isisService \
                   ospfService pingService ripService rsvpService&#34;
    set setArgs &#34;&#34;
    foreach pServ $protServs {
        if {![info exists ipArray($pServ)]} {
            continue
        }
        lappend setArgs &#34;-$pServ $ipArray($pServ)&#34;
    }
    set setArgs [join $setArgs]

    ;<span class="comment-line"># Restore the previous state of the protocol servers.</span>
    eval SetProtocolServerInfo $portId $setArgs
} ;<span class="comment-line"># RestoreSavedProtocolServer</span>



</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
