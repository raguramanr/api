<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>dosLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#dosLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>dosLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="dosLib.tcl-annot.html">annotations</a> | <a href="dosLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: loginDosServer</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to login to the DosServer using globally</span>
<span class="comment-line">#       defined user id and password.</span>
<span class="comment-line"># Input args: None</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       loginDosServer</span>
<span class="comment-line"># Category: Dos</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::loginDosServer_13">proc <a href="dosLib.tcl-annot.html#::::loginDosServer">::::loginDosServer</a></a></strong> { } {
   global dosServer
   global dosUser
   global dosPassword
   global dosSuPassword
   global spawn_id

   <a name="::login_linux(1)"><a href="./linux.tcl.html#::login_linux_16">::login_linux</a></a> $dosServer $dosUser $dosPassword $dosSuPassword
   <span class="comment-line">#make sure we are in root prompt</span>
   exp_send &#34;\r&#34;
   for {set try 0} {$try &lt; 10} {incr try} {
      expect {
         &#34;#&#34; {
            return 1
         }
         -ex &#34;$&#34; {
            send &#34;su\r&#34;
         }
         &#34;assword&#34; {
            send &#34;$dosSuPassword\r&#34;
         }
         timeout {
            send &#34;\r&#34;
         }
      }
   }
   return 0

}

<strong><a name="::::loginDosSwitch_43">proc <a href="dosLib.tcl-annot.html#::::loginDosSwitch">::::loginDosSwitch</a></a></strong> { } {
   global dosSwitch
   <span class="comment-line">#use login_linux instead of Login because Login is not able to deal with</span>
   <span class="comment-line">#EW cli</span>
   <a name="::login_linux(2)"><a href="./linux.tcl.html#::login_linux_16">::login_linux</a></a> $dosSwitch admin &#34;&#34; NULL
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: disableCPUDosProtect</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to config cpu-dos-protect parameters to </span>
<span class="comment-line">#       default and then disable cpu-dos-protect</span>
<span class="comment-line"># Input args: dut - the DUT number</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       disableCPUDosProtect 1</span>
<span class="comment-line"># Category: Dos</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::disableCPUDosProtect_61">proc <a href="dosLib.tcl-annot.html#::::disableCPUDosProtect">::::disableCPUDosProtect</a></a></strong> { dut } {
   global DUT1_CONNECT
   global DUT2_CONNECT

   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECT]
   <span class="comment-line">#SendACmd &#34;unconfigure cpu-dos-protect&#34;</span>
   <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable dos-protect&#34;
}

<strong><a name="::::cleanOsConf_70">proc <a href="dosLib.tcl-annot.html#::::cleanOsConf">::::cleanOsConf</a></a></strong> { } {
   global DUT1_CONNECT
   global DUT2_CONNECT
   
   <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
   <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf delete dosvlan&#34;
   <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan1&#34;
   <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlanbb&#34;
   <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
   <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ospf area all&#34;

   <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT
   <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlanbb&#34;
   <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan2&#34;
   <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
   <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ospf area all&#34;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: enableCPUDosProtect</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to enable cpu-dos-protect on a DUT.</span>
<span class="comment-line"># Input args: dut - the DUT number</span>
<span class="comment-line">#             alert - alert-threshold to configure</span>
<span class="comment-line">#             notify - notify-threshold to configure</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       enableCPUDosProtect 1</span>
<span class="comment-line"># Category: Dos</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::enableCPUDosProtect_100">proc <a href="dosLib.tcl-annot.html#::::enableCPUDosProtect">::::enableCPUDosProtect</a></a></strong> {dut {alert default} {notify default}} {
   global DUT1_CONNECT
   global DUT2_CONNECT
   
   set connect [set DUT${dut}_CONNECT]
   <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $connect
   <span class="comment-line">#clear the log so show log will not show info from previous test.</span>
   <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log&#34;
   <span class="comment-line">#in EXOS there is no unconfig dos-protect command so we have to config the</span>
   <span class="comment-line"># thresholds explicitly here to avoid left over config from previous test</span>
   if { $alert == &#34;default&#34; } { set alert 4000 }
   if { $notify == &#34;default&#34; } { set notify 3500 }
   <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable dos-protect&#34;
   <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure dos-protect type l3-protect alert-threshold $alert&#34;
   <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure dos-protect type l3-protect notify-threshold $notify&#34;
   return 1
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: verifyDosProtect</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to verify dos-protection</span>
<span class="comment-line"># Input args: testNo - test number</span>
<span class="comment-line">#             checkFor - acl  - verify ACL is created</span>
<span class="comment-line">#                        noAcl - verify no ACL is created</span>
<span class="comment-line">#                        notice - verify notify-threshold is reached</span>
<span class="comment-line">#                        noNotice - verify notify-threshold is not reached</span>
<span class="comment-line">#              port    - the port # in show log output</span>
<span class="comment-line">#              srcIp   - SRCIP address in show log output</span>
<span class="comment-line">#              destIp  - DESTIP address in show log output</span>
<span class="comment-line">#              proto   - PROTO protocol type in show log output</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     verifyDosProtect -checkFor &#34;acl notice&#34;</span>
<span class="comment-line"># Category: Dos</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::verifyDosProtect_136">proc <a href="dosLib.tcl-annot.html#::::verifyDosProtect">::::verifyDosProtect</a></a></strong> { args } {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> verifyDosProtect $args {
      testNo &#34;&#34;
      checkFor acl 
      <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> default
      srcIp default
      destIp default
      proto default
   } 
   global DUT1_CONNECT
   global DUT2_CONNECT
   global attackDut
   global dutDosPort
   global dutDosIp
   global dosServerAttackIp

   if ![regexp &#34;acl|noAcl|notice|noNotice&#34; $checkFor] {
      <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;wrong argument $checkFor given to verifyDosProtect&#34;
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;wrong argument $checkFor given to verifyDosProtect&#34;
      <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return 0
   }
   if { $port == &#34;default&#34; } { set port $dutDosPort($attackDut) }
<span class="comment-line">##########</span>
<span class="comment-line">#set port 1:4</span>
   if { $srcIp == &#34;default&#34; } { set srcIp $dosServerAttackIp  }
   if { $destIp == &#34;default&#34; } { set destIp $dutDosIp($attackDut)  }
   if { $proto == &#34;default&#34; } { set proto udp } 

   if { [<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1 whole] 11.4.0.21] &gt;= 0 } {
       <span class="comment-line"># if version &gt;= 11.4.0.21...</span>

       if { $srcIp == &#34;any&#34; } {
	   set srcIp &#34;0.0.0.0&#34;
       }

       set pShowLog(acl) &#34;{DOSProt.AddACLOK.*Added an ACL to port $port, srcIP $srcIp to destIP $destIp, protocol $proto} exist&#34;
       set pShowLog(noAcl) &#34;{DOSProt.AddACLOK.*Added an ACL} notExist&#34;
       set pShowLog(notice) &#34;{DOSProt.PktCntExcd.*Notify-threshold for L3 Protect} exist&#34;
       set pShowLog(noNotice) &#34;{DOSProt.PktCntExcd.*Notify-threshold for L3 Protect} notExist&#34;
   } else {
       set pShowLog(acl) &#34;{dosprot.info.* CREATE ACL: FROM PHYSPORT $port SRCIP $srcIp TO DESTIP $destIp PROTO $proto} exist&#34;
       set pShowLog(noAcl) &#34;{dosprot.info.* CREATE ACL} notExist&#34;
       set pShowLog(notice) &#34;{dosprot.info.* notify-threshold for L3 Protect} exist&#34;
       set pShowLog(noNotice) &#34;{dosprot.info.* notify-threshold for L3 Protect} notExist&#34;
   }

<span class="comment-line">##########</span>
<span class="comment-line">#set port 4</span>
   
   if {[<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1 majmin] &gt;= &#34;11.3&#34; } {
       set pShowAcl(acl) &#34;{$port +.* +ingress} exist&#34;
       set pShowAcl(noAcl) &#34;{$port +.* +ingress} notExist&#34;
   } else {
       set pShowAcl(acl) &#34;{$port +DOSpolicy.* +ingress} exist&#34;
       set pShowAcl(noAcl) &#34;{$port +DOSpolicy.* +ingress} notExist&#34;
   }
   set pShowAcl(notice) &#34;&#34;
   set pShowAcl(noNotice) &#34;&#34;

   set pListShowLog &#34;&#34;
   set pListShowAcl &#34;&#34;
   foreach check {acl noAcl notice noNotice} { 
      if [regexp $check $checkFor ] {
         lappend pListShowLog $pShowLog($check)
         lappend pListShowAcl $pShowAcl($check)
      }
   }


   <span class="comment-line">#sleep for traffic to stabilize</span>
   sleep 5
   <a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${attackDut}_CONNECT ]
   <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show log&#34; $pListShowLog -testNo $testNo \
      -comment $pListShowLog -time {s: 0 i: 2 d: 10 f: 10 r }
   <a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show access-list&#34; $pListShowAcl -testNo $testNo -comment \
      $pListShowAcl -time {s: 0 i: 2 d: 10 f: 10 r }


   <span class="comment-line">#In EXOS top won't show any meaningful output for DOS</span>
   <span class="comment-line">################################################</span>
   <span class="comment-line">#set subTest &#34;verify tNettask utilization using top command&#34;;</span>
   <span class="comment-line">################################################</span>
   <span class="comment-line">#result_h2 &#34;$subTest&#34;;</span>
   <span class="comment-line">#report_start_test &#34;$subTest&#34;;</span>
   <span class="comment-line">#tNetTask CPU% needs a long time to pick up after attack is started</span>
   <span class="comment-line">#sleep 40</span>

   <span class="comment-line">#Login [set DUT${attackDut}_CONNECT ];</span>
   <span class="comment-line">#set parameterList &#34;&#34;;</span>
   <span class="comment-line">#lappend parameterList &#34;tNetTask 0-5&#34;;</span>
   <span class="comment-line"># CheckTopStats $parameterList &#34;-Show the top statistics for tNetTask&#34;;</span>
   <span class="comment-line">#ChecktNetTask 0 5 </span>
   <span class="comment-line">#report_end_test;</span>
}

<strong><a name="::::getCmdOutput_232">proc <a href="dosLib.tcl-annot.html#::::getCmdOutput">::::getCmdOutput</a></a></strong> { command task} {
   global spawn_id
   set pid _[pid]
   set fileName &#34;Tmp/tmp_getCmdOutput$pid&#34;
   set fd_in [open $fileName &#34;w&#34;]
   set match_max 60000
   <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> $command NULL $fd_in
   close $fd_in
   set fd_in [open $fileName &#34;r&#34;]
   set output &#34;&#34;
   while {[gets $fd_in line] != -1} {
<a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;line is $line&#34;
      if [regexp $task $line ] {
         set output $line
      } 
   }
   <span class="comment-line">#set output [read $fd_in]</span>
   close $fd_in
 <span class="comment-line">#  file delete $fileName</span>
puts &#34;$output&#34;
   return $output
}

<strong><a name="::::ChecktNetTask_255">proc <a href="dosLib.tcl-annot.html#::::ChecktNetTask">::::ChecktNetTask</a></a></strong> { low high } {
   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking top statistics for tNetTask range $low-$high&#34;
   <span class="comment-line">#look for:</span>
   <span class="comment-line">#tNetTask      85c58c10        80d33214        PEND          0   69</span>
   set match 0
   for {set i 1} { $i &lt;= 5 } {incr i} {
      set output [<a name="::getCmdOutput(1)"><a href="./dosLib.tcl.html#::getCmdOutput_232">::getCmdOutput</a></a> &#34;top&#34; tNetTask]
      if [regexp \
         &#34;tNetTask +\[^ ]+ +\[^ ]+ +\[^ ]+ +(\[^ ]+) +\[^ ]+&#34; \
         $output dummy CPU] {
         set match 1
         break 
      }
   }
   if {$match == 0 } {
      <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;regexp not matched for tNetTask&#34;
      <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;output is:\n$output&#34;
      <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return 0
   }
   if { $CPU &gt; $high || $CPU &lt; $low } {
      <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> \
         &#34;Checking range of tNettask failed. Wanted $low-$high, Got $CPU&#34;
      <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return 0
   }
   <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checking range of tNettask is ok. Wanted $low-$high, Got $CPU&#34;
   <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return 1
}

<strong><a name="::::CheckAclMonitor_286">proc <a href="dosLib.tcl-annot.html#::::CheckAclMonitor">::::CheckAclMonitor</a></a></strong> { acl } {
   global spawn_id
   set pid _[pid]
   set fd_in [open &#34;Tmp/tmp_CheckACLMonitor$pid&#34; &#34;w&#34;]
puts &#34;#######################before SendACmd&#34;
   <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show access-list-monitor&#34; NULL $fd_in
puts &#34;#######################after SendACmd&#34;
   close $fd_in
   set fd_in [open &#34;Tmp/tmp_CheckACLMonitor$pid&#34; &#34;r&#34;]
   set aclFound 0
   while {[gets $fd_in line] != -1} {
      <span class="comment-line">#result_debug &#34;----- Line=|$line|&#34;</span>
      if [regexp $acl $line] {
          set aclFound 1
          break
       } else {
          continue
       }
   }
   close $fd_in
   file delete &#34;Tmp/tmp_CheckACLMonitor$pid&#34;
   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking access-list-monitor for $acl&#34;
   if {$aclFound == 1 } {
      <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$acl found in access-list-monitor&#34;
   } else {
      <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$acl not found in access-list-monitor&#34;
   }
   <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}





<span class="comment-line">#experimental proc</span>
<strong><a name="::::verifyTelnet_321">proc <a href="dosLib.tcl-annot.html#::::verifyTelnet">::::verifyTelnet</a></a></strong> { destination } {
   send &#34;telnet $destination\r&#34;;
      expect {
         &#34;closed&#34; {
            send &#34;\r\r&#34;
            return 0
         }
         &#34;failed&#34; {
            send &#34;\r\r&#34;
            return 0
         }
         timeout {
            <span class="comment-line">#want to get a Login prompt or #</span>
            send &#34;\r\r&#34;
            return 0
         }
         &#34;login:&#34; {
            send &#34;admin\r&#34;;
            exp_continue;
         }
         &#34;password:&#34; {
            send &#34;\r&#34;;
            exp_continue;
         }
         &#34;#&#34; {
            send &#34;logout\r&#34;;
            expect {
               -nocase &#34;? (y/n)&#34; {
                  send &#34;n\r&#34;;
                  exp_continue;
               }
               &#34;closed&#34; {
                  send &#34;\r&#34;
                  return 1
               }
               timeout {
                  send &#34;\r\r&#34;
                  return 0
               }
            }
         }
      }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: setupOSPFVlans</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to config OSPF on vlans</span>
<span class="comment-line"># Input args: </span>
<span class="comment-line">#        DUT1Vlan1_IP   ip address on vlan1 of DUT1</span>
<span class="comment-line">#        DUT1vlan1_2_IP ip address on vlanBB of DUT1</span>
<span class="comment-line">#        DUT2vlan1_2_IP ip address on vlanBB of DUT2</span>
<span class="comment-line">#        DUT2vlan2_IP   ip address on vlan2 of DUT2</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       setupOSPFVlans 1.1.1.1 11.11.11.1 11.11.11.2 22.22.22.1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Dos</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::setupOSPFVlans_381">proc <a href="dosLib.tcl-annot.html#::::setupOSPFVlans">::::setupOSPFVlans</a></a></strong> {DUT1Vlan1_IP DUT1vlan1_2_IP DUT2vlan1_2_IP DUT2vlan2_IP} {
   global DUT1_CONNECT;
   global DUT2_CONNECT
   
   <a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
   <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf add dosvlan area 0.0.0.0&#34;
   set portList &#34;[<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1]&#34;
   <a name="::SetupSingleOSPFVlan(1)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT1Vlan1_IP &#34;0.0.0.0&#34; $portList 1 &#34;vlan1&#34;
   set portList &#34;[<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2]&#34;
   <a name="::SetupSingleOSPFVlan(2)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT1vlan1_2_IP &#34;0.0.0.0&#34; $portList 1 &#34;vlanBB&#34;

   <a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT
   set portList &#34;[<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1]&#34;
   <a name="::SetupSingleOSPFVlan(3)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT2vlan1_2_IP &#34;0.0.0.0&#34; $portList 1 &#34;vlanBB&#34; &#34;false&#34;

   set portList &#34;[<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 9 2]&#34;
   <a name="::SetupSingleOSPFVlan(4)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT2vlan2_IP &#34;0.0.0.0&#34; $portList 1 &#34;vlan2&#34;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckWithOSPF</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to config OSPF on the DUTs.</span>
<span class="comment-line"># Input args: dutMac - Mac address of DUT</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       CheckWithOSPF</span>
<span class="comment-line"># Category: Dos</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckWithOSPF_410">proc <a href="dosLib.tcl-annot.html#::::CheckWithOSPF">::::CheckWithOSPF</a></a></strong> {dutMac} {
   global dutDosIp
   set DUT1Vlan1_IP 1.1.1.1
   set DUT1vlan1_2_IP 11.11.11.1
   set DUT2vlan1_2_IP 11.11.11.2
   set DUT2vlan2_IP 22.22.22.1
   set clientIP2 22.22.22.2
   set clientIP1 1.1.1.3
   set txPort 9
   set rxPort 1

   <a name="::setupOSPFVlans(1)"><a href="./dosLib.tcl.html#::setupOSPFVlans_381">::setupOSPFVlans</a></a> $DUT1Vlan1_IP $DUT1vlan1_2_IP $DUT2vlan1_2_IP $DUT2vlan2_IP
   <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Wait for 60 secs for ospf convergance&#34;
   sleep 45

   set checkPortList &#34;&#34;
   lappend checkPortList &#34;9 notForwarded&#34;
   lappend checkPortList &#34;1 forwarded&#34;
   <a name="::CheckForwarding(1)"><a href="./ePTForwarding.tcl.html#::CheckForwarding_269">::CheckForwarding</a></a> -txPortId $txPort -checkPortList $checkPortList \
                    -protocol &#34;ip&#34; -gIpAddr $DUT2vlan2_IP \
                    -dIpAddr $clientIP1 -sIpAddr $clientIP2 \
                    -rxPortId $rxPort -ttlDecr 2

   <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Transmit IP packets continusouly&#34;;
   <a name="::ClearPortsStats(1)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> &#34;$txPort $rxPort&#34;;
   set frameSent [<a name="::SendIpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -protocol &#34;ip&#34; -txPortId $txPort -sourceIp $clientIP2 \
                  -destIp $clientIP1 -destMac $dutMac \
                  -streamType &#34;contPacket&#34; -percentage .1];
   <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return 0  
}


<strong><a name="::::CheckRatesAndCounts_443">proc <a href="dosLib.tcl-annot.html#::::CheckRatesAndCounts">::::CheckRatesAndCounts</a></a></strong> { } {
   set txPort 9
   set rxPort 1


   <span class="comment-line">################################################</span>
   set subTest &#34;Verify the transmitted and received rates and packet counts via ospf&#34;;
   <span class="comment-line">################################################</span>
   result_h2 &#34;$subTest&#34;;
   <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;

   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Check receive and transmit rates&#34;
   set checkRateList &#34;&#34;
   lappend checkRateList &#34;$rxPort 100&#34;
   <a name="::CheckRates(1)"><a href="./ePTRx.tcl.html#::CheckRates_1509">::CheckRates</a></a> $txPort $checkRateList &#34;Check receive rate 100%&#34; 2

   <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

   <a name="::ClearPortsStats(2)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> &#34;$txPort $rxPort&#34;;
   sleep 10

   <a name="::StopPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $txPort;

   sleep 10
   set numSent [<a name="::GetNumFramesSent(1)"><a href="./ePTRx.tcl.html#::GetNumFramesSent_1324">::GetNumFramesSent</a></a> $txPort];
   set numRece [<a name="::GetNumFramesReceived(1)"><a href="./ePTRx.tcl.html#::GetNumFramesReceived_1346">::GetNumFramesReceived</a></a> $rxPort];
   <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;###Send = $numSent : Receive = $numRece&#34;;

   set diff [expr $numSent-$numRece];
   if {$diff &lt; 250} {
       <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Number of transmitted frames on first path is &lt;$numSent&gt; and recieved frames is &lt;$numRece&gt;&#34;;
       <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Number of transmitted frames on first path is &lt;$numSent&gt; and recieved frames is &lt;$numRece&gt;&#34;;
   } else {
       <a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Warning : Number of transmitted frames on first path &lt;$numSent&gt; is different than recieved frames &lt;$numRece&gt;&#34;;   
       <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Warning : Number of transmitted frames on first path &lt;$numSent&gt; is different than recieved frames &lt;$numRece&gt;&#34;;   
   }
   <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: ConfigDosNetwork</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to config the Dos networks according to the</span>
<span class="comment-line">#       following topology drawings. The dosSwitch is used to isolate DOS </span>
<span class="comment-line">#       attack traffic from the rest of the regression testbeds. </span>
<span class="comment-line">#</span>
<span class="comment-line">#       Topology 1 is used if we are testing a blade type that cannot</span>
<span class="comment-line">#       be directly connected with the dosSwitch. e.g. we want to test</span>
<span class="comment-line">#       G48X such that attack is coming into this blade, but we run out of </span>
<span class="comment-line">#       fiber port on the dosSwitch.</span>
<span class="comment-line"># </span>
<span class="comment-line">#       Topology 2 is used if the blade type under test can be directly</span>
<span class="comment-line">#       connected to the dosSwitch. or in case of PC as the DUT2, the PC</span>
<span class="comment-line">#       cannot route DOS traffic fast enough to trigger dos protection. We</span>
<span class="comment-line">#       want to connect DUT1 directly to dosSwitch.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Topology 1</span>
<span class="comment-line"># ===========</span>
<span class="comment-line">#</span>
<span class="comment-line">#       DOS attack traffic is routed by dosSwitch to DUT2 then to DUT1</span>
<span class="comment-line">#</span>
<span class="comment-line">#       Note that this topology exist together with the OSPF topology</span>
<span class="comment-line">#       but we are using a different trunk here between DUT1 and DUT2</span>
<span class="comment-line"># EXOS note:</span>
<span class="comment-line">#       Note that in EW the DOS switch is connected to DUT1 and DUT2 is under</span>
<span class="comment-line">#       attack. In EXOS we connect the DOS switch to DUT2  and DUT1 is under</span>
<span class="comment-line">#       attack. This is because in EXOS testbeds DUT1 and DUT2 can be different</span>
<span class="comment-line">#       platforms(e.g. DUT1 is Mariner and DUT2 is PC ). DUT1 is the platform</span>
<span class="comment-line">#       that we want to test. We also want the attack traffic coming in from</span>
<span class="comment-line">#       the trunk between DUT1 and 2 (e.g g60T, g60X etc) so the correct blade</span>
<span class="comment-line">#       is under attack.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#           network</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#        |  eth0           |</span>
<span class="comment-line">#        | DOS  Server     |</span>
<span class="comment-line">#        |  eth1           |</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#        123.123.1.4</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#            | </span>
<span class="comment-line">#     $dosSwitchPortToDosServer 123.123.1.3</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        |   DOS switch    |</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#      $dosSwitchPortToDut  124.124.$testbedId.3</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#      $dutDosPort(2) 124.124.$testbedId.2</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        |       DUT2      |</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#    125.125.$testbedId.2</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#      $dutDosPort(1) 125.125.$testbedId.1</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        |       DUT1      |</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#</span>
<span class="comment-line"># Topology 2</span>
<span class="comment-line"># ==========</span>
<span class="comment-line">#           network</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#        |  eth0           |</span>
<span class="comment-line">#        | DOS  Server     |</span>
<span class="comment-line">#        |  eth1           |</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#        123.123.1.4</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#            | </span>
<span class="comment-line">#     $dosSwitchPortToDosServer 123.123.1.3</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        |   DOS switch    |</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#      $dosSwitchPortToDut  124.124.$testbedId.3</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#            |</span>
<span class="comment-line">#      $dutDosPort(1) 124.124.$testbedId.1</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        |       DUT1      |</span>
<span class="comment-line">#        |                 |</span>
<span class="comment-line">#        +-----------------+</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: dosTopology  1 - use topology 1</span>
<span class="comment-line">#                          2 - use topology 2 </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       configDosNetwork</span>
<span class="comment-line"># Category: Dos</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::configDosNetwork_587">proc <a href="dosLib.tcl-annot.html#::::configDosNetwork">::::configDosNetwork</a></a></strong> { } {
    global dosSwitch
    global dosServer
    global dosServerAttackIp
    global dutDosPort
    global dutDosIp
    global dosSwitchPortToDut
    global dosSwitchPortToDosServer
    global dosTestbedId
    global DUT1_CONNECT
    global DUT2_CONNECT
    global dosTopology

 
    <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nconfigDosNetwork{}: set up DOS Network&#34;
    set dosServerAttackIp 123.123.1.4

    if { $dosTopology != 2 } {
       set dutDosIp(1) 125.125.$dosTestbedId.1
       set dutDosIp(2) 124.124.$dosTestbedId.2
    } else {
       set dutDosIp(1) 124.124.$dosTestbedId.1
    }
    <span class="comment-line">#######################</span>
    <span class="comment-line"># DOS Switch config</span>
    <span class="comment-line">#######################</span>
    <span class="comment-line">#set up routing between the DOS server and DUT using the DOS</span>
    <span class="comment-line">#switch</span>
    <a name="::loginDosSwitch(1)"><a href="./dosLib.tcl.html#::loginDosSwitch_43">::loginDosSwitch</a></a>
    <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure default delete port all&#34;
    <a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan dosvlanServer&#34;
    <a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable port $dosSwitchPortToDosServer&#34;
    <a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure dosvlanServer add port $dosSwitchPortToDosServer&#34;
    <a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure dosvlanServer ipaddress 123.123.1.3/24&#34;
    <a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan dosvlan$dosTestbedId&#34;
    <a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable port $dosSwitchPortToDut&#34;
    <a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure dosvlan$dosTestbedId add port $dosSwitchPortToDut&#34;
    <a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure dosvlan$dosTestbedId ipaddress 124.124.$dosTestbedId.3/24&#34;
    if { $dosTopology != 2 } {
       <a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure iproute add 125.125.$dosTestbedId.0/24 $dutDosIp(2)&#34;
    }
    <a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding dosvlanServer&#34;
    <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding broadcast dosvlanServer&#34;
    <a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding dosvlan$dosTestbedId&#34;
    <a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding broadcast dosvlan$dosTestbedId&#34;
    <span class="comment-line">#there's a chance that max number of telnet sessions at the dosSwitch got </span>
    <span class="comment-line">#used up better logout after use.</span>
    <a name="::logout(1)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>

    <span class="comment-line">#######################</span>
    <span class="comment-line"># DOS Server config</span>
    <span class="comment-line">#######################</span>
    <span class="comment-line">#dosServer eth0 for regular communication traffic</span>
    <span class="comment-line">#          eth1 for DOS traffic </span>
    <span class="comment-line">#Don't configure default route here for regular traffic. Instead</span>
    <span class="comment-line">#configure prefix 10 going to default router. in case dosServer doesn't</span>
    <span class="comment-line">#know where DOS traffic should go it has no default route to leak to the</span>
    <span class="comment-line">#rest of the company.</span>
    <span class="comment-line">#configure static route to 124 and 125 prefix going to dosswitch for</span>
    <span class="comment-line">#DOS traffic</span>
    <a name="::loginDosServer(1)"><a href="./dosLib.tcl.html#::loginDosServer_13">::loginDosServer</a></a>
    <a name="::linuxSendACmd(1)"><a href="./linux.tcl.html#::linuxSendACmd_268">::linuxSendACmd</a></a> &#34;/sbin/ifconfig eth1 $dosServerAttackIp/24&#34;
    <a name="::linuxSendACmd(2)"><a href="./linux.tcl.html#::linuxSendACmd_268">::linuxSendACmd</a></a> &#34;/sbin/route add -net 124.0.0.0/8 gw 123.123.1.3&#34;
    <a name="::linuxSendACmd(3)"><a href="./linux.tcl.html#::linuxSendACmd_268">::linuxSendACmd</a></a> &#34;/sbin/route add -net 125.0.0.0/8 gw 123.123.1.3&#34;
    <a name="::linuxSendACmd(4)"><a href="./linux.tcl.html#::linuxSendACmd_268">::linuxSendACmd</a></a> &#34;/sbin/route&#34;

    if { $dosTopology != 2 } {
       <span class="comment-line">#######################</span>
       <span class="comment-line"># Topology 1 DUT2 config</span>
       <span class="comment-line">#######################</span>
       <a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT
       <a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;enable port $dutDosPort(2)&#34;
       <a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;create vlan dosvlan&#34;
       <a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure dosvlan add port $dutDosPort(2)&#34;
       <a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure dosvlan ipaddress $dutDosIp(2)/24&#34;
       <span class="comment-line">#use 2nd trunk for DOS attack traffic. 1st trunk is used for</span>
       <span class="comment-line">#ixia traffic with ospf routing</span>
       set port [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1 2]
       <a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;enable port  $port&#34;
       <a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;create vlan dosvlan2&#34;
       <a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure dosvlan2 add port $port&#34;
       <a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure dosvlan2 ipaddress 125.125.$dosTestbedId.2/24&#34;
       <a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure iproute add $dosServerAttackIp/32 124.124.$dosTestbedId.3&#34;
       <a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;enable ipforwarding dosvlan&#34;
       <a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;enable ipforwarding broadcast dosvlan&#34;
       <a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;enable ipforwarding dosvlan2&#34;
       <a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;enable ipforwarding broadcast dosvlan2&#34;
   
       <span class="comment-line">#######################</span>
       <span class="comment-line"># Topology 1 DUT1 config</span>
       <span class="comment-line">#######################</span>
       <a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
       set dutDosPort(1)  [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 2]
       <a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;enable port $dutDosPort(1)&#34;
       <a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;create vlan dosvlan&#34;
       <a name="::SendACmd(47)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure dosvlan add port $dutDosPort(1)&#34;
       <a name="::SendACmd(48)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure dosvlan ipaddress $dutDosIp(1)/24&#34;
       <a name="::SendACmd(49)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> \
          &#34;configure iproute add $dosServerAttackIp/32 125.125.$dosTestbedId.2&#34;
       <a name="::SendACmd(50)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> \
      &#34;configure iproute add 124.124.$dosTestbedId.0/24 125.125.$dosTestbedId.2&#34;
    } else {
       <span class="comment-line">#######################</span>
       <span class="comment-line"># Topology 2 DUT1 config</span>
       <span class="comment-line">#######################</span>
       <a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
       <span class="comment-line">#set dutDosPort(1)  [GetATrunkPort 1 2 2]</span>
       <a name="::SendACmd(51)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;enable port $dutDosPort(1)&#34;
       <a name="::SendACmd(52)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;create vlan dosvlan&#34;
       <a name="::SendACmd(53)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure dosvlan add port $dutDosPort(1)&#34;
       <a name="::SendACmd(54)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure dosvlan ipaddress $dutDosIp(1)/24&#34;
       <a name="::SendACmd(55)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> \
          &#34;configure iproute add $dosServerAttackIp/32 124.124.$dosTestbedId.3&#34;
    }
}

<span class="comment-line">################################################################################</span>
<span class="comment-line"># Procedure Name: unconfigDosNetwork</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to unconfig the DOS topology</span>
<span class="comment-line"># Input args: None</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      unconfigDosNetwork</span>
<span class="comment-line"># Category: Dos</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::unconfigDosNetwork_713">proc <a href="dosLib.tcl-annot.html#::::unconfigDosNetwork">::::unconfigDosNetwork</a></a></strong> {} {
    global dosServer
    global dosServerAttackIp
    global dosSwitch
    global dutDosIp
    global dosTestbedId
    global DUT1_CONNECT
    global DUT2_CONNECT
    global dosTopology

    <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nUnconfigDosNetwork{}: unconfig DOS network&#34;

    <a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT
    <a name="::SendACmd(56)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;delete dosvlan&#34;
    <a name="::SendACmd(57)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;delete dosvlan2&#34;
    <a name="::SendACmd(58)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure iproute delete $dosServerAttackIp/32 124.124.$dosTestbedId.3&#34;

    <a name="::Login(12)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
    <a name="::SendACmd(59)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;delete dosvlan&#34;
    <a name="::SendACmd(60)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure iproute delete $dosServerAttackIp/32 125.125.$dosTestbedId.2&#34;
    <a name="::SendACmd(61)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;configure iproute delete $dosServerAttackIp/32 124.124.$dosTestbedId.3&#34;

    <a name="::loginDosServer(2)"><a href="./dosLib.tcl.html#::loginDosServer_13">::loginDosServer</a></a>
    <span class="comment-line">#donot unconfig anything on dosServer since some other testbed maybe running</span>
    <span class="comment-line">#DOS too</span>
    <a name="::linuxSendACmd(5)"><a href="./linux.tcl.html#::linuxSendACmd_268">::linuxSendACmd</a></a> &#34;/sbin/route&#34;

    <a name="::loginDosSwitch(2)"><a href="./dosLib.tcl.html#::loginDosSwitch_43">::loginDosSwitch</a></a>
    <span class="comment-line">#donot unconfig anything on the dosServer port</span>
    <a name="::SendACmd(62)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete dosvlan$dosTestbedId&#34;
    <a name="::SendACmd(63)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure iproute delete 125.125.$dosTestbedId.0/24 124.124.$dosTestbedId.2&#34;
    <span class="comment-line">#there's a chance that max number of telnet sessions at the dosSwitch got </span>
    <span class="comment-line">#used up better logout after use.</span>
    <a name="::logout(2)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>
}

<span class="comment-line">################################################################################</span>
<span class="comment-line"># Procedure Name: killOldAttacks</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to kill all dos attacks to the DUTs</span>
<span class="comment-line">#       It's for cleaning up and attack processes left by previous tests.</span>
<span class="comment-line"># Input args: None</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      killOldAttacks</span>
<span class="comment-line"># Category: Dos</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::killOldAttacks_760">proc <a href="dosLib.tcl-annot.html#::::killOldAttacks">::::killOldAttacks</a></a></strong> { } {
    <span class="comment-line">#clean up any zombie dos attack if there's any</span>
    <a name="::loginDosServer(3)"><a href="./dosLib.tcl.html#::loginDosServer_13">::loginDosServer</a></a>
    lappend parameterList &#34;123.123. 1 0&#34;
    lappend parameterList &#34;124.124. 1 0&#34;
    lappend parameterList &#34;125.125. 1 0&#34;
puts &#34;debug 0a&#34;
    set value [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;ps -eaf | egrep '123|124|125'&#34; $parameterList 0 0 &#34;&#34;]
puts &#34;debug 0b&#34;
    unset parameterList;

    foreach retVal $value {
	if {![regexp -nocase &#34;key_not_found&#34; $retVal]} {
	    <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;found zombies with '$retVal' pids, killing them all...&#34;
	    foreach val [join $retVal] {
		<a name="::linuxSendACmd(6)"><a href="./linux.tcl.html#::linuxSendACmd_268">::linuxSendACmd</a></a> &#34;kill -9 $val&#34;
	    }
	}
    }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
