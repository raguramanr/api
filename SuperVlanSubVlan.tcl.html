<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>SuperVlanSubVlan.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#SuperVlanSubVlan.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>SuperVlanSubVlan.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="SuperVlanSubVlan.tcl-annot.html">annotations</a> | <a href="SuperVlanSubVlan.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: check_subvlan_exist</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Check to see if a given subVlan is a sub-vlan of the </span>
<span class="comment-line">#	specified superVlan.</span>
<span class="comment-line"># Input args: subVlan superVlan fd_res testNo</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	check_subvlan_exist vlanson vlandad  $fd_res $testNo</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################    </span>
<strong><a name="::::check_subvlan_exist_14">proc <a href="SuperVlanSubVlan.tcl-annot.html#::::check_subvlan_exist">::::check_subvlan_exist</a></a></strong><a name="::::check_subvlan_exist"></a> {subVlan superVlan fd_res testNo} {
   global spawn_id
   set found &#34;false&#34;

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;sh $subVlan&#34; $fd_res $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking Sub-VLAN $subVlan to be part of Super-VLAN $superVlan&#34;
   while {[gets $fd_in line] != -1} {
      set cookedLine [<a name="::cookString(1)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $line]
      set aList [split $cookedLine]
<span class="comment-line">#result_debug &#34;----- cookedLine=$cookedLine&#34;</span>
	<span class="comment-line">#for older version</span>
      if { ([lindex $aList 0] == &#34;Super&#34;) &amp;&amp;
            ([lindex $aList 1] == &#34;vlan:&#34;) &amp;&amp;
            ([lindex $aList 2] == $superVlan) } {
         set found &#34;true&#34;
         <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$subVlan is sub_VLAN of Super-VLAN $superVlan, as expected&#34;
	 break
      }
      <span class="comment-line">#for newer version</span>
      if { ([lindex $aList 0] == &#34;SuperVlan:&#34;) &amp;&amp;
            ([lindex $aList 1] == $superVlan) } {
         set found &#34;true&#34;
         <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$subVlan is sub_VLAN of Super-VLAN $superVlan, as expected&#34;
	 break
      }   }
   if { ($found == &#34;false&#34;) }	{
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$subVlan is NOT sub_VLAN of Super-VLAN $superVlan, unexpected&#34;
   }
   <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: check_supervlan_subbridges</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Check if a given superVlan contains all the subVlans in list.</span>
<span class="comment-line"># Input args: superVlan subVlanList  fd_res testNo</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set subvlansList {&#34;vlanson exist&#34; &#34;vlandaughter exist&#34;}</span>
<span class="comment-line">#	check_supervlan_subbridges vlandad $subvlansList $fd_res $testNo</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################  </span>
<strong><a name="::::check_supervlan_subbridges_63">proc <a href="SuperVlanSubVlan.tcl-annot.html#::::check_supervlan_subbridges">::::check_supervlan_subbridges</a></a></strong><a name="::::check_supervlan_subbridges"></a> {superVlan subVlanList  fd_res testNo} {
   global spawn_id

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;sh $superVlan&#34; $fd_res $fd_in
   close $fd_in
   
   <span class="comment-line">#set all flag to false</span>
   foreach subVlan  $subVlanList  {
      set subVlanExist($subVlan) &#34;false&#34;
   }
   
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking Super-VLAN $superVlan sub-bridges list&#34;
   while {[gets $fd_in line] != -1} {
<span class="comment-line">#result_debug &#34;----- Line=$line&#34;</span>
      foreach subVlan $subVlanList {
      	 set subVlanName [lindex $subVlan 0]
         if { [string first $subVlanName $line] &gt;= 0 } {
            set subVlanExist($subVlan) &#34;true&#34;
         }
      }
   }
   
   <span class="comment-line">#check for any missing subvlan</span>
   foreach subVlan $subVlanList  {
      set subVlanFlag [lindex $subVlan 1]
      if { (([set subVlanExist($subVlan)] == &#34;true&#34;) &amp;&amp; \
       	   ($subVlanFlag == &#34;exist&#34;)) } {
         <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Super-VLAN $superVlan does contain Sub_VLAN $subVlan, as expected&#34;
      } elseif { (([set subVlanExist($subVlan)] == &#34;false&#34;) &amp;&amp; \
       	   ($subVlanFlag == &#34;notExist&#34;)) } {
         <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Super-VLAN $superVlan does not contain Sub_VLAN $subVlan, as expected&#34;
      } elseif { (([set subVlanExist($subVlan)] == &#34;false&#34;) &amp;&amp; \
       	   ($subVlanFlag == &#34;exist&#34;)) } {
         <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Super-VLAN $superVlan DOES contain Sub_VLAN $subVlan, unexpected&#34;
      } elseif { (([set subVlanExist($subVlan)] == &#34;true&#34;) &amp;&amp; \
       	   ($subVlanFlag == &#34;notExist&#34;)) } {
         <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Super-VLAN $superVlan DOES NOT contain Sub_VLAN $subVlan, unexpected&#34;
      } else {       
         <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Unexpected result for Sub_VLAN $subVlan&#34;
      }
   }
   <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Procedure Name: check_vlan_ip_addresses</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	Check if a given superVlan has primary and secondary address</span>
<span class="comment-line">#	or just regular vlan IP</span>
<span class="comment-line"># Input args: superVlan superVlanIPList fd_res testNo</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	lappend superVlanIPList &#34;$superVlanIP1 notExist&#34;</span>
<span class="comment-line">#	lappend superVlanIPList &#34;$superVlanIP3 primaryExist&#34;</span>
<span class="comment-line">#	lappend superVlanIPList &#34;$superVlanIP2/32 secondaryExist&#34;</span>
<span class="comment-line">#	check_vlan_ip_addresses vlandad $superVlanIPList  $fd_res $testNo</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::check_vlan_ip_addresses_126">proc <a href="SuperVlanSubVlan.tcl-annot.html#::::check_vlan_ip_addresses">::::check_vlan_ip_addresses</a></a></strong><a name="::::check_vlan_ip_addresses"></a> {superVlan superVlanIPList  fd_res testNo} {
   global spawn_id

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;sh ipconfig $superVlan&#34; $fd_res $fd_in
   close $fd_in
   
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking vlan $superVlan IP addresses&#34;
   lappend ipFoundList &#34;&#34;
   <span class="comment-line">#get all the primary and secondary IPs</span>
   while {[gets $fd_in line] != -1 &amp;&amp; ![regexp -nocase &#34;\&#34;&#34; $line]} {
<span class="comment-line">#result_debug &#34;----- Line=$line&#34;</span>
      if { ([lindex $line 0] == &#34;inet&#34;) } {
         set ip [lindex $line 1]
         lappend ipFoundList $ip
         set ipFoundArrayFlag($ip) &#34;primaryExist&#34;
         <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Found primary IP for $superVlan: $ip&#34;
      }
      if { ([lindex $line 0] == &#34;Secondary:&#34;) } {
         set ipList [lrange $line 1 end]
         <span class="comment-line">#puts &#34;IpList $ipList&#34;</span>
         foreach ip $ipList {
            lappend ipFoundList $ip
            set ipFoundArrayFlag($ip) &#34;secondaryExist&#34;
            <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Found secondary IP for $superVlan: $ip&#34;
         }
      }
   }
   foreach ipList $superVlanIPList {
      set ip [lindex $ipList 0]
      set ipFlagWanted [lindex $ipList 1]
      set ipFlagFound &#34;notExist&#34;
      <span class="comment-line">#check with what is found</span>
      foreach ipFound $ipFoundList {
<span class="comment-line">#      puts &#34;Found: ip=$ip ipFound=$ipFound&#34;</span>
         if { $ip == $ipFound } {
            set ipFlagFound $ipFoundArrayFlag($ipFound)
         }
      }
<span class="comment-line">#      puts &#34;Found: ip=$ip ipFlagFound=$ipFlagFound  ipFlagWanted=$ipFlagWanted&#34;</span>
      switch -- $ipFlagWanted \
         &#34;primaryNotExist&#34; {
         if { $ipFlagFound == &#34;primaryExist&#34; } {
            <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check Super-VLAN IP address $ip with flag: $ipFlagWanted&#34;
            <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Found: ip=$ip ipFlagFound=$ipFlagFound  ipFlagWanted=$ipFlagWanted&#34;
         } else {
            <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check Super-VLAN IP address $ip with flag: $ipFlagWanted&#34;
         }
      }  &#34;secondaryNotExist&#34; {
         if { $ipFlagFound == &#34;secondaryExist&#34; } {
            <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check Super-VLAN IP address $ip with flag: $ipFlagWanted&#34;
            <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Found: ip=$ip ipFlagFound=$ipFlagFound  ipFlagWanted=$ipFlagWanted&#34;
         } else {
            <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check Super-VLAN IP address $ip with flag: $ipFlagWanted&#34;
         }
      } default {
         if { $ipFlagFound == $ipFlagWanted } {
            <a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check Super-VLAN IP address $ip with flag: $ipFlagWanted&#34;
         } else {
            <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check Super-VLAN IP address $ip with flag: $ipFlagWanted&#34;
            <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Found: ip=$ip ipFlagFound=$ipFlagFound  ipFlagWanted=$ipFlagWanted&#34;
         }
      }
   }
   <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
