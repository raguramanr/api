<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>vpws.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#vpws.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>vpws.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="vpws.tcl-annot.html">annotations</a> | <a href="vpws.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: MulDutVpwsSetup</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line"># This procedure creates  a variable number of pseudo wire/service</span>
<span class="comment-line">#      pairs on a multi-node  test bed.  Each pseudo wire will have a service</span>
<span class="comment-line">#      A variable number of services can be configured.  OSPF and LDP</span>
<span class="comment-line">#      are setup by default</span>
<span class="comment-line">#</span>
<span class="comment-line">#      NOTE: The starting VPWS ID is always 50 + $j (j incr number of vpws's)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line">#      numTrunks &#34;1&#34; </span>
<span class="comment-line">#      numServiceVlan &#34;1&#34;</span>
<span class="comment-line">#      nonDefaultArg &#34;none&#34;</span>
<span class="comment-line">#      vlanVman &#34;vlan&#34;</span>
<span class="comment-line">#      noEcmp &#34;0&#34;</span>
<span class="comment-line">#      numDuts &#34;2&#34;</span>
<span class="comment-line">#      config  &#34;line&#34;</span>
<span class="comment-line">#      numVpws &#34;1&#34;</span>
<span class="comment-line">#      mtu &#34;1500&#34; </span>
<span class="comment-line">#      tagPattern &#34;tagged&#34;</span>
<span class="comment-line">#      portPattern &#34;continuous&#34;</span>
<span class="comment-line">#      vlanTagNums &#34;static&#34;</span>
<span class="comment-line">#      routing &#34;ospf&#34;</span>
<span class="comment-line">#      addVPWS &#34;1&#34;</span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line">#   -numTrunks &#34;1&#34;          &lt;= number of trunks connected between DUts</span>
<span class="comment-line">#   -numServiceVlan &#34;1&#34;     &lt;= number of service Vlan/Vman used </span>
<span class="comment-line">#   -nonDefaultArg &#34;none&#34;   &lt;= the ability to set non-default vpws values</span>
<span class="comment-line">#   -vlanVman &#34;vlan&#34;        &lt;= vpws can be configured in conjunction with vmans</span>
<span class="comment-line">#   -numDuts  &#34;2&#34;	          &lt;= number of Duts used for vpws setup </span>
<span class="comment-line">#   -config  &#34;line&#34;         &lt;= connection of Duts in the setup, </span>
<span class="comment-line">#           for ex if numDuts=3 and config=line, then</span>
<span class="comment-line">#           the script will configure trunk connection as below</span>
<span class="comment-line">#           DUT1&lt;===&gt;DUT2&lt;===&gt;DUT3</span>
<span class="comment-line">#           if config=loop then the configuation would be </span>
<span class="comment-line">#           DUT1&lt;===&gt;DUT2&lt;===&gt;DUT3</span>
<span class="comment-line">#             ^                 ^</span>
<span class="comment-line">#             |		           |	</span>
<span class="comment-line">#				  -----------------		</span>
<span class="comment-line">#   -numVpws  &#34;10&#34;          &lt;= number of vpws sessions to be used for testcase</span>
<span class="comment-line">#   -noEcmp &#34;1&#34;             &lt;= the value set to 1 indicates  ospf route costs</span>
<span class="comment-line">#                              between DUTs are different, otherwise 0,</span>
<span class="comment-line">#                              default is 0 indicates ECMP</span>
<span class="comment-line">#   -mtu  &#34;1500&#34;            &lt;= value of size of mtu to be given if </span>
<span class="comment-line">#                           nonDefaultArg is provided as varMtu</span>
<span class="comment-line">#                           value ranges between 1492 to 9216</span>
<span class="comment-line">#  Note : Make sure that number of vpws and number of service vlans are equal</span>
<span class="comment-line">#         This will have a one tone mapping with service vlan to vpws</span>
<span class="comment-line">#         For vman not more than two vpws sessions could be created using this proc</span>
<span class="comment-line">#         Only 1 vman is allowed port port, therefore vmans are limited by the number</span>
<span class="comment-line">#         of ports on each switch</span>
<span class="comment-line">#</span>
<span class="comment-line">#   -tagPattern  &#34;tagged&#34; &lt;= many cases will require a mix of tagged and</span>
<span class="comment-line">#                                        untagged ports on a service vlan</span>
<span class="comment-line">#           &#34;untagged&#34; &lt;=&gt; all vlans untagged</span>
<span class="comment-line">#           &#34;tagged&#34; &lt;=&gt; all vlans tagged </span>
<span class="comment-line">#           &#34;untag-tag&#34; &lt;=&gt; 1st vlan untag rest tagged </span>
<span class="comment-line">#</span>
<span class="comment-line">#   -portPattern &#34;continuous&#34; &lt;= many cases require different port patterns</span>
<span class="comment-line">#           &#34;continuousOne&#34; &lt;=&gt; port index 1 on each vlan on each DUT</span>
<span class="comment-line">#           &#34;continuousTwo&#34; &lt;=&gt; port index 1 and 2 on each vlan on each DUT</span>
<span class="comment-line">#           &#34;alternate&#34; &lt;=&gt; alternate portA on odd vlans portB on even vlans</span>
<span class="comment-line">#</span>
<span class="comment-line">#   -vlanTagNums &#34;static&#34;  &lt;= vlan tag to create on each DUT</span>
<span class="comment-line">#           &#34;static&#34; &lt;=&gt; same vlan tags on each dut</span>
<span class="comment-line">#           &#34;incr&#34; &lt;=&gt; increment the vlan tags on each dut</span>
<span class="comment-line">#                   tags incr by 100, starting at 600 on dut1</span>
<span class="comment-line">#</span>
<span class="comment-line">#   -routing &#34;ospf&#34; &lt;= choose the routing infrastructure</span>
<span class="comment-line">#           &#34;ospf&#34; &lt;=&gt; use ospf routing to bring up the infrastructure</span>
<span class="comment-line">#           &#34;static&#34; &lt;=&gt; use static routes to create reachability</span>
<span class="comment-line">#</span>
<span class="comment-line">#   -addVPWS &#34;1&#34; &lt;= Other modules may want to use this library with only the</span>
<span class="comment-line">#                   basic MPLS setup.  This option allows the skipping of VPWS</span>
<span class="comment-line">#                   Setup</span>
<span class="comment-line">#   -prot &#34;ldp&#34;  &lt;==== provide to the protocol with which the PW is constructed</span>
<span class="comment-line">#                      other protocol option  &#34;rsvp&#34;</span>
<span class="comment-line">#   -srcDut &#34;1&#34;  &lt;==== Specify tht estarting dut number of the rsvp-tunnel </span>
<span class="comment-line">#   -destDut &#34;3&#34; &lt;===== Specify the destination Dut of the rsvp-tunnel</span>
<span class="comment-line">#   -testNo      &#34;none&#34;  &lt;=== Added verify code so test can be aborted if config fails ex. $testNo</span>
<span class="comment-line">#   -time1       &#34;none&#34;  &lt;=== ex $time1 from parent proc</span>
<span class="comment-line">#   -verify      &#34;no&#34; &lt;=== switch to turn on verification</span>
<span class="comment-line">#   -exitOnVFail &#34;no&#34; &lt;=== choice to exit the parent test case if any of the config fails</span>
<span class="comment-line">#   -startTime   &#34;30&#34; &lt;=== time to delay before starting to verify the network</span>
<span class="comment-line">#   -failTime    &#34;75&#34; &lt;=== time to continue checking before failing case.</span>
<span class="comment-line">#    Note :provide addVPWS  0 for rsvp protocol </span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	 MulDutVpwsSetup  -numTrunks &#34;1&#34; \</span>
<span class="comment-line">#               -numServiceVlan &#34;1&#34; \</span>
<span class="comment-line">#               -numDuts  &#34;2&#34; \</span>
<span class="comment-line">#               -config  &#34;line&#34; \</span>
<span class="comment-line">#               -nonDefaultArg &#34;none&#34; \</span>
<span class="comment-line">#               -vlanVman &#34;vlan&#34; \</span>
<span class="comment-line">#	             -numVpws  &#34;10&#34; \	</span>
<span class="comment-line">#               -noEcmp &#34;1&#34; \</span>
<span class="comment-line">#               -tagPattern &#34;tagged&#34; \</span>
<span class="comment-line">#               -portPattern &#34;continuous&#34; \</span>
<span class="comment-line">#               -mtu &#34;1500&#34; \</span>
<span class="comment-line">#               -vlanTagNums &#34;static&#34; \</span>
<span class="comment-line">#               -routing &#34;ospf&#34; \</span>
<span class="comment-line">#               -addVPWS &#34;1&#34; \</span>
<span class="comment-line">#               -prot &#34;ldp&#34; \</span>
<span class="comment-line">#               -srcDut &#34;1&#34; \</span>
<span class="comment-line">#               -destDut &#34;3&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MulDutVpwsSetup_117">proc <a href="vpws.tcl-annot.html#::::MulDutVpwsSetup">::::MulDutVpwsSetup</a></a></strong><a name="::::MulDutVpwsSetup"></a> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> MulDutVpwsSetup $args {
      numTrunks &#34;1&#34;
      numServiceVlan &#34;1&#34;
      nonDefaultArg &#34;none&#34;
      vlanVman    &#34;vlan&#34;
      noEcmp      &#34;0&#34;
      numDuts     &#34;2&#34;
      config      &#34;line&#34;
      numVpws     &#34;1&#34;
      mtu         &#34;1492&#34;
      tagPattern  &#34;tagged&#34;
      portPattern &#34;continuousOne&#34;
      vlanTagNums &#34;static&#34;
      routing     &#34;static&#34;
      addVPWS     &#34;1&#34;
      prot        &#34;ldp&#34;
      srcDut      &#34;1&#34;
      destDut     &#34;3&#34;
      testNo      &#34;none&#34;
      time1       &#34;none&#34;
      verify      &#34;no&#34;
      exitOnVFail &#34;no&#34;
      startTime   &#34;30&#34;
      failTime    &#34;75&#34;
      conType     &#34;&#34;
   }
<a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;entering the mpls dut porc &#34;
global DUTs_info
set servPortsList1 &#34;[<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1 1] [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 2 1]&#34;
set servPortsList2 &#34;[<a name="::MapDUTPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 3 2] [<a name="::MapDUTPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 4 2]&#34;
set servPortsList3 &#34;[<a name="::MapDUTPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 5 3] [<a name="::MapDUTPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 6 3]&#34;
set servPortsList4 &#34;[<a name="::MapDUTPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 7 4] [<a name="::MapDUTPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 8 4]&#34;
set servPortsList5 &#34;[<a name="::MapDUTPortId(9)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 10 5] [<a name="::MapDUTPortId(10)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 11 5]&#34;

for {set i 1} {$i &lt;= $numDuts} {incr i} {
<span class="comment-line"># initialize the even-odd variable for altering ports</span>
set evenOdd 0;
<span class="comment-line"># initialize the tag pattern and count</span>
set tagOption &#34;tagged&#34;;
set tagCount 0;
set ipList$i &#34;&#34;
<span class="comment-line">#Login $DUTs_info(DUT$i,connect)</span>
<span class="comment-line"># Enable login with telnet to speed up these tests.  If the number</span>
<span class="comment-line">#  of VPWS and ServiceVlans are small.  No need for telnet</span>
if {($numVpws &lt; 100) &amp;&amp; ($numServiceVlan &lt; 100)} {
   <a name="::LoginFast(1)"><a href="./login.tcl.html#::LoginFast_403">::LoginFast</a></a> $i -noTelnet &#34;1&#34;
} else {
   <a name="::LoginFast(2)"><a href="./login.tcl.html#::LoginFast_403">::LoginFast</a></a> $i
}

   if {$vlanVman == &#34;vman&#34;} {
      <span class="comment-line"># Multiple VMANs can not be added to a port tagged</span>
      set topRange 2
   } else {
      set topRange $numServiceVlan
   }
   <span class="comment-line"># Create VPWS Service VLANs if they are required</span>
   <span class="comment-line">#</span>
   if {$conType ==&#34;end-end&#34;} {
      if {(($i==$srcDut) || ($i==$destDut))} {
         set createservVlan 1
      } else {
         set createservVlan 0
     }
   } else {
      set createservVlan 1
   }
   if $createservVlan {
   for {set j 0} {$j&lt;$topRange} {incr j} {
      <span class="comment-line"># logic to choose tagging options and port assignment options</span>
      switch $portPattern {
          &#34;continuousOne&#34; { set portVal [lindex [set servPortsList$i] 0];
                               set alt 0;
         }
          &#34;continuousTwo&#34; { set portVal &#34;[lindex [set servPortsList$i] 0],[lindex ${servPortsList$i} 1]&#34;;
                               set alt 0;
         }
          &#34;alternate&#34; {
                           set alt 1;
         }
      }
      switch $tagPattern {
          &#34;untagged&#34; {
                           set tagOption &#34;untagged&#34;;
         }
          &#34;tagged&#34; {
                           set tagOption &#34;tagged&#34;;
         }
          &#34;untag-tag&#34; {
                           if {$tagCount == 0} {
                              set tagOption &#34;untagged&#34;
                           } else {
                              set tagOption &#34;tagged&#34;
                           }
                           puts &#34;TAG UNTAG&#34;;
         }
      }
      <span class="comment-line">#--- Decide tag numbering</span>
      if {$vlanTagNums == &#34;incr&#34;} {
         set tagValue [expr 500 + $j + ($i * 100)]
      } else {
         set tagValue [expr 600 + $j]
      }
      <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure default delete port all&#34;
      <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
      <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create ${vlanVman} ${vlanVman}$j&#34;
      <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ${vlanVman} ${vlanVman}$j tag $tagValue&#34;
      if {!$alt} {
         <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ${vlanVman} ${vlanVman}$j add port \
                    $portVal $tagOption&#34;
      } else {
         <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ${vlanVman} ${vlanVman}$j add port \
                    [lindex [set servPortsList$i] $evenOdd] $tagOption&#34;
         <span class="comment-line"># switch DUT port index back and forth between 0 and 1</span>
         if {$evenOdd} {
            set evenOdd 0;
         } else {
            set evenOdd 1;
         }
      }
      incr tagCount;
   }
   }
   <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan loop&#34;
   <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan loop ipaddress 100.100.$i.1/32&#34;
   <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable loopback-mode loop&#34;
   <span class="comment-line"># Add each trunk vlan</span>
   <span class="comment-line">#--- Create a list of vlan names</span>
   set trunkVlans &#34;&#34;;
   if {$config == &#34;line&#34;} {
      for {set j 1} {$j&lt;=$numTrunks} {incr j} {
       <span class="comment-line">#---Line configuration meant duts are connected in sequence</span>
         if {$i != $numDuts} {
            set k [expr $i + 1]
            set wanID ${i}$k;
            set wanVlan trunk${wanID}_$j;
         <span class="comment-line">#---- if not last dut create the right facing wan vlan/port/ip</span>
            <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $wanVlan&#34;
            <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan tag ${wanID}$j&#34;
            <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan add port \
                      [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $i $k $j] tag&#34;
            <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan ipa 1${j}.0.${wanID}.1/30&#34;
            lappend ipList1 &#34;1${j}.0.${wanID}.2&#34;
            lappend DUTs_info(DUT${i},ldpPeerList) &#34;100.100.${i}.1 100.100.${k}.1&#34;
            <span class="comment-line">#--- Add static routing option</span>
            if {$routing != &#34;ospf&#34;} {
               for {set q $i} {$q&lt;$numDuts} {incr q} {
                  if {$noEcmp!=0} {
                     <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.[expr $q + 1].1/32 \
                               1${j}.0.${wanID}.2&#34;
                  } else {
                     <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.[expr $q + 1].1/32 \
                               1${j}.0.${wanID}.2 [expr 10 + $j]&#34;
                  }
               }
            }
            lappend trunkVlans $wanVlan;
         }
         if {$i !=1 } {
            set m [expr $i -1]
            set wanID ${m}$i;
            set wanVlan trunk${wanID}_$j;
         <span class="comment-line">#---- if not first dut create the left facing wan vlan/port/ip</span>
            <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $wanVlan&#34;
            <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan tag ${wanID}$j&#34;

            <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan add port \
                      [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $i $m $j] tag&#34;
            <a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan ipa 1${j}.0.${wanID}.2/30&#34;
            lappend DUTs_info(DUT${i},ldpPeerList) &#34;100.100.${i}.1 100.100.${m}.1&#34;
            <span class="comment-line">#--- Add static routing option</span>
            if {$routing != &#34;ospf&#34;} {
               for {set q 1} {$q&lt;$i} {incr q} {
                  if {$noEcmp!=0} {
                     <a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.${q}.1/32 \
                               1${j}.0.${wanID}.1&#34;
                  } else {
                     <a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.${q}.1/32 \
                               1${j}.0.${wanID}.1 [expr 10 + $j]&#34;
                  }
               }
            }
            lappend trunkVlans $wanVlan;
         }

      }
   }  elseif {$config == &#34;loop&#34;} {
      for {set j 1} {$j&lt;=$numTrunks} {incr j} {
       <span class="comment-line">#---Loop configuration means duts are connected in a ring</span>
         if {$i &lt;= $numDuts} {
         <span class="comment-line">#---- create the right facing wan vlan/port/ip</span>
            set k [expr $i + 1]
            set wanID ${i}$k;
            set wanVlan trunk${wanID}_$j;
            <span class="comment-line">#---- if dut is last, create a vlan to connect to dut 1</span>
            if {$i == $numDuts} {
               set k 1
               set wanID 1${i};
               set wanVlan trunk${wanID}_$j;
            }
            <a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $wanVlan&#34;
            <a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan tag ${wanID}$j&#34;
            <a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan add port \
                      [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $i $k $j] tag&#34;
            <a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan ipa 1${j}.0.${wanID}.1/30&#34;
            lappend DUTs_info(DUT${i},ldpPeerList) &#34;100.100.${i}.1 100.100.${k}.1&#34;
            <span class="comment-line">#--- Add static routing option</span>
            if {$routing != &#34;ospf&#34;} {
               for {set q [expr $i + 1]} {$q&lt;=$numDuts} {incr q} {
                  if {$noEcmp!=0} {
                     <a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.${q}.1/32 \
                               1${j}.0.${wanID}.2&#34;
                  } else {
                     <a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.${q}.1/32 \
                               1${j}.0.${wanID}.2 [expr 10 + $j]&#34;
                  }
               }
            }
            lappend trunkVlans $wanVlan;
         }
         if {$i &gt;= 1 } {
         <span class="comment-line">#---- if not first dut create the left facing wan vlan/port/ip</span>
            set m [expr $i -1]
            set wanID ${m}$i;
            set wanVlan trunk${wanID}_$j;
            <span class="comment-line">#---- if dut is first, create a vlan to connect to last dut</span>
            if {$i == 1} {
               set m $numDuts
               set wanID ${i}$numDuts;
               set wanVlan trunk${wanID}_$j;
            }
            <a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $wanVlan&#34;
            <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan tag ${wanID}$j&#34;
            <a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan add port \
                      [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $i $m $j] tag&#34;
            <a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan ipa 1${j}.0.${wanID}.2/30&#34;
            lappend DUTs_info(DUT${i},ldpPeerList) &#34;100.100.${i}.1 100.100.${m}.1&#34;
            <span class="comment-line">#--- Add static routing option</span>
            if {$routing != &#34;ospf&#34;} {

               for {set q 1} {$q&lt;$i} {incr q} {
                  if {$noEcmp!=0} {
                     <a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.${q}.1/32 \
                               1${j}.0.${wanID}.1&#34;
                  } else {
                     <a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.${q}.1/32 \
                               1${j}.0.${wanID}.1 [expr 10 + $j]&#34;
                  }
               }
            }
            lappend trunkVlans $wanVlan;
         }
      }
   }  else {
   <span class="comment-line">#---Mesh configuration, DUT's are connected between each other</span>
      <span class="comment-line">#--- Multiple trunks is not supported</span>
      set numTrunks 1;
      set ipList 1
      for {set x 1} {$x &lt;= $numDuts} {incr x} {
         if {[expr $i - $x]} {
            <span class="comment-line">#--- Decide how to name the trunk and set 4th octet numbers</span>
             <span class="comment-line">#DUT1 12.1  13.1 14.1</span>
             <span class="comment-line">#DUT2 12.2            23.1 24.1</span>
             <span class="comment-line">#DUT3       13.2      23.2      34.1</span>
             <span class="comment-line">#DUT4            14.2      24.2 34.2</span>
            if {$i&lt;$x} {
               set wanID &#34;${i}$x&#34;;
               set lastOctet 1
               set nextHop 2
            } else {
               set wanID &#34;${x}$i&#34;;
               set lastOctet 2
               set nextHop 1
            }
            set wanVlan trunk${wanID}_1;
            <a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $wanVlan&#34;
            <a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan tag ${wanID}1&#34;
            <a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan add port \
                      [<a name="::::GetATrunkPort(5)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $i $x 1] tag&#34;
            <a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $wanVlan ipa 11.0.${wanID}.${lastOctet}/30&#34;
            lappend DUTs_info(DUT${i},ldpPeerList) &#34;100.100.${i}.1 100.100.${x}.1&#34;
            if {$i&lt;$x} {
            lappend ipList1 &#34;11.0.${wanID}.2&#34;
            } else {
            lappend ipList1 &#34;11.0.${wanID}.1&#34;
            }
            <span class="comment-line">#--- Add static routing option</span>
            if {$routing != &#34;ospf&#34;} {
               if {$noEcmp!=0} {
                  <a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.$x.1/32 11.0.${wanID}.${nextHop}&#34;
               } else {
                  <a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr add 100.100.$x.1/32 11.0.${wanID}.${nextHop} [expr 10 + $x]&#34;
               }
            }
            lappend trunkVlans $wanVlan;
         }
      }
   }

   <a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding&#34;
   <a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf routerid 100.100.$i.1&#34;
   <a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf add loop area 0.0.0.0&#34;

   <span class="comment-line"># Configure ospf on trunk ports</span>
   set q 1;
   if {$numTrunks &gt; 1} {
      foreach wanLink $trunkVlans {
         <a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf add $wanLink area 0.0.0.0&#34;
         if {$noEcmp!=0} {
            <a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf vlan $wanLink cost [expr $q *10]&#34;
         }
         incr q;
      }
   } else {
      foreach wanLink $trunkVlans {
         <a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf add $wanLink area 0.0.0.0&#34;
         if {$noEcmp!=0} {
            <a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf vlan $wanLink cost [expr $i *10]&#34;
         }
         incr q;
      }
  }

   <span class="comment-line">############ Start Basic MPLS Setup #################</span>
   <a name="::SendACmd(47)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipr mpls-next-hop&#34;
   <a name="::SendACmd(48)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls lsr-id 100.100.$i.1&#34;
   <a name="::SendACmd(49)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add loop&#34;

   <span class="comment-line"># Add each trunk to mpls</span>
   foreach wanLink $trunkVlans {
      <a name="::SendACmd(50)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add $wanLink&#34;
   }
   <a name="::SendACmd(51)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls vlan all&#34;
   if {$prot == &#34;ldp&#34; } {
   <span class="comment-line"># Enable mpls and ldp</span>
   <a name="::SendACmd(52)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls protocol ldp&#34;
   <a name="::SendACmd(53)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls ldp vlan all&#34;
   <a name="::SendACmd(54)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls ldp advertise direct all&#34;
   } elseif {$prot == &#34;rsvp&#34;} {
      if {$i == $srcDut } {
         if {$config == &#34;line&#34;} {
            for {set x 0} {$x&lt;$numTrunks} {incr x} {
               <a name="::SendACmd(55)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34; create mpls rsvp-te path path_dut$destDut$x&#34;
               <a name="::SendACmd(56)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create mpls rsvp-te lsp lsp_dut$destDut$x destination 100.100.$destDut.1&#34;
               <a name="::SendACmd(57)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config mpls rsvp-te path path_dut$destDut$x add ero [lindex $ipList1 $x]/32 strict&#34;
               <a name="::SendACmd(58)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config mpls rsvp-te lsp lsp_dut$destDut$x add path path_dut$destDut$x&#34;
            }
        <span class="comment-line">#------ else part only for mesh network</span>
        } else {
           set indVal 0
           for {set k 1} {$k &lt;= $numDuts} {incr k} {
              if {[expr $i - $k]} {
                  <a name="::SendACmd(59)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34; create mpls rsvp-te path path_dut$destDut$k&#34;
                  <a name="::SendACmd(60)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create mpls rsvp-te lsp lsp_dut$destDut$k destination 100.100.$destDut.1&#34;
                  <a name="::SendACmd(61)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config mpls rsvp-te path path_dut$destDut$k add ero [lindex $ipList1 $indVal]/32 strict&#34;
                  <a name="::SendACmd(62)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config mpls rsvp-te lsp lsp_dut$destDut$k add path path_dut$destDut$k&#34;
                  incr indVal
               }
            }

        }
        <span class="comment-line">#---- only one service vlan is addded incase of rsvp, assigning ipaddress</span>
        <span class="comment-line">#---- directly</span>
         <a name="::SendACmd(63)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan0 ipaddress 20.0.$i.1/24&#34;
        <span class="comment-line"># SendACmd &#34;enable ipforwarding vlan0&#34;</span>
         <a name="::SendACmd(64)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf add vlan vlan0 area 0.0.0.0&#34;
         foreach wanLink $trunkVlans {
            <a name="::SendACmd(65)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls rsvp-te vlan $wanLink&#34;
         }
         <a name="::SendACmd(66)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34; enable mpls rsvp-te lsp all&#34;
     } else {
         <a name="::SendACmd(67)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan0 ipaddress 20.0.$i.1/24&#34;
        <span class="comment-line"># SendACmd &#34;enable ipforwarding vlan0&#34;</span>
         <a name="::SendACmd(68)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf add vlan vlan0 area 0.0.0.0&#34;
         foreach wanLink $trunkVlans {
            <a name="::SendACmd(69)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls rsvp-te vlan $wanLink&#34;
         }
     }
   <a name="::SendACmd(70)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls protocol rsvp-te&#34;
   <a name="::SendACmd(71)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf mpls-next-hop&#34;
}

     <span class="comment-line">#################### VPWS ###########################</span>
   if {$addVPWS} {
   if $createservVlan {
      <span class="comment-line"># Add pseudo wires with a service for each</span>
      <span class="comment-line"># Adding vpws and service </span>
      for {set j 1} {$j&lt;= $numVpws} {incr j} {
         <a name="::SendACmd(72)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create l2vpn vpws vpws$j fec-id-type pseudo-wire [expr 50 + $j]&#34;
         if {$config == &#34;line&#34;} {
            if {$conType == &#34;&#34;} {
            if {$i != $numDuts} {
            <span class="comment-line">#---- loop to prevent adding peer to DUT5 </span>
               set k [expr $i + 1]
               <a name="::SendACmd(73)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add peer 100.100.$k.1&#34;          }
            if {$i !=1 } {
            <span class="comment-line">#---- loop to prevent adding peer to DUT1</span>
               set m [expr $i -1]
               <a name="::SendACmd(74)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add peer 100.100.$m.1&#34;
            }
            } elseif {$conType ==&#34;end-end&#34;} {
            if {$i == $srcDut} {
              <a name="::SendACmd(75)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add peer 100.100.$destDut.1&#34;
            } elseif {$i == $destDut} {
              <a name="::SendACmd(76)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add peer 100.100.$srcDut.1&#34;
            }

           }
         } elseif {$config == &#34;loop&#34;} {
            if {$conType == &#34;&#34;} {
            if {$i &lt;= $numDuts} {
            <span class="comment-line">#---- loop to prevent adding peer to DUT5 </span>
               set k [expr $i + 1]
               if {$i == $numDuts} {
                  set k 1
               }
               if {$i == 1} {
                  set m $numDuts
               } else {
                  set m [expr $i -1]
               }
               <a name="::SendACmd(77)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add peer 100.100.$k.1&#34;          }
               <a name="::SendACmd(78)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add peer 100.100.$m.1&#34;
            } elseif {$conType ==&#34;end-end&#34;} {
            if {$i == $srcDut} {
              <a name="::SendACmd(79)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add peer 100.100.$destDut.1&#34;
            } elseif {$i == $destDut} {
              <a name="::SendACmd(80)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add peer 100.100.$srcDut.1&#34;
            }

           }
         } else {
          <span class="comment-line">#---Mesh configuration, DUT's are inter-connected </span>
         for {set k 1} {$k &lt;= $numDuts} {incr k} {
            if {[expr $i - $k]} {
               <span class="comment-line">#--- this loop will be executed if both DUT numbers are not equal</span>
                  <a name="::SendACmd(81)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add peer 100.100.$k.1&#34;
               }
            }
         }
         <span class="comment-line">#---- add the service vlan's/Vman to the VPWS</span>
         if {$j &lt;= $topRange} {
            <a name="::SendACmd(82)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable igmp snooping vlan ${vlanVman}[expr $j -1]&#34;
            <a name="::SendACmd(83)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j add service ${vlanVman} ${vlanVman}[expr $j -1]&#34;
         }
        
            
             if {$nonDefaultArg != &#34;none&#34;} {
               switch $nonDefaultArg {
                  &#34;dot1qExclude&#34; {
                     <a name="::SendACmd(84)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws  vpws$j dot1q tag exclude&#34;
                   }
                  &#34;dot1qExcludeMtu&#34; {
                     <a name="::SendACmd(85)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j dot1q tag exclude mtu 2000&#34;
                   }
                  &#34;dot1qOverwrite&#34; {
                     <a name="::SendACmd(86)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j dot1q ethertype 0x350$i&#34;
                   }
                  &#34;dot1qInclude&#34; {
                     <a name="::SendACmd(87)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j dot1q tag include&#34;
                   }
                  &#34;varMtu&#34; {
                     <a name="::SendACmd(88)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure l2vpn vpws vpws$j mtu $mtu&#34;
                   }
                 default {
                     <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;default vpws settings would be applied&#34;
                   }
               }
            }
         <a name="::SendACmd(89)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable l2vpn vpws vpws$j&#34;
      }
    }
   }
   <span class="comment-line">#--- Add static routing option </span>
   if {$routing == &#34;ospf&#34;} {
      <a name="::SendACmd(90)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
   }
   <a name="::SendACmd(91)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls&#34;
}   
for {set i 1} {$i &lt;= $numDuts} {incr i} {
   <a name="::LogoutFast(1)"><a href="./login.tcl.html#::LogoutFast_481">::LogoutFast</a></a> $i
}
<span class="comment-line"># -------------------------------------------------------------------------------</span>
<span class="comment-line">#                      Add option to verify that the network is up</span>
<span class="comment-line">#                      before continuing.  If the network does not come up</span>
<span class="comment-line">#                      the option to exit the test exists.</span>
if {$verify == &#34;yes&#34;} {
    if {$exitOnVFail == &#34;yes&#34; &amp;&amp; ($testNo == &#34;none&#34; || $time1 == &#34;none&#34;)} {
        <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;testNo and time1   M U S T  be passed in to exit on failure&#34;
        exit;
    }

    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nWait for peers to come up.&#34;
    <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $startTime
    set failTime [expr $failTime - $startTime] 
    for {set i 1} {$i &lt;= $numDuts} {incr i} {
        <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$i,connect)
        if {$prot == &#34;ldp&#34;} {
            for {set c 0} {$c &lt; [llength $DUTs_info(DUT${i},ldpPeerList)]} {incr c} {
                set peer [lindex $DUTs_info(DUT${i},ldpPeerList) $c] 
                <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;peer $c : $peer&#34;
                set localAdd [lindex $peer 0] 
                set remoteAdd &#34;[lindex $peer 1]:0&#34; 
                lappend parameterList &#34;{$localAdd * $remoteAdd * Operational} exist&#34;
            }
            set ldpStat [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls ldp peer&#34; $parameterList \
                 -testNo $testNo -comment &#34;- chk ldp peer on DUT$i&#34; \
                 -dut $i -time [list &#34;s:&#34; &#34;0&#34; &#34;i:&#34; &#34;5&#34; &#34;d:&#34; &#34;$failTime&#34; &#34;f:&#34; &#34;$failTime&#34; &#34;r&#34;]]
            unset parameterList
            if {$ldpStat == &#34;error&#34; &amp;&amp; $exitOnVFail == &#34;yes&#34;} {
                <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Failed check mpls ldp peer on DUT${i}: Abandon $testNo &#34;
                for {set y 1} {$y &lt;= $numDuts} {incr y} {
                   <a name="::LogoutFast(2)"><a href="./login.tcl.html#::LogoutFast_481">::LogoutFast</a></a> $y
                }
                <a name="::::MulDutVpwsCleanup(1)"><a href="./vpws.tcl.html#::::MulDutVpwsCleanup_763">::::MulDutVpwsCleanup</a></a>  -numTrunks &#34;$numTrunks&#34; \
                    -numServiceVlan &#34;$numServiceVlan&#34; \
                    -numDuts  &#34;$numDuts&#34; \
                    -vlanVman &#34;$vlanVman&#34; \
                    -numVpws  &#34;$numVpws&#34; \
                    -config   &#34;$config&#34; \
                    -routing  &#34;$routing&#34; \
                    -addVPWS  &#34;$addVPWS&#34;
                set time2 [clock seconds]
                result_p &#34;Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
                <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
                <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
                return -code return
            }
        }
        <span class="comment-line">#  RSVP is currently not enabled.</span>
        if {$prot == &#34;rsvp&#34; &amp;&amp; $i == $srcDut &amp;&amp; 0} {
            lappend parameterList &#34;{100.100.${i}.1 * 100.100.${destDut}.1 * Operational} exist&#34;
            set rsvpStat [<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mpls rsvp neighbor&#34; $parameterList \
                 -testNo $testNo -comment &#34;- chk rsvp neighbor on DUT$i&#34; \
                 -dut $i -time [list &#34;s:&#34; &#34;0&#34; &#34;i:&#34; &#34;5&#34; &#34;d:&#34; &#34;$failTime&#34; &#34;f:&#34; &#34;$failTime&#34; &#34;r&#34;]]
            unset parameterList
            if {$rsvpStat == &#34;error&#34; &amp;&amp; $exitOnVFail == &#34;yes&#34;} {
                <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Failed check mpls rsvp neighbor on DUT${i}: Abandon $testNo &#34;
                for {set y 1} {$y &lt;= $numDuts} {incr y} {
                   <a name="::LogoutFast(3)"><a href="./login.tcl.html#::LogoutFast_481">::LogoutFast</a></a> $y
                }
                <a name="::::MulDutVpwsCleanup(2)"><a href="./vpws.tcl.html#::::MulDutVpwsCleanup_763">::::MulDutVpwsCleanup</a></a>  -numTrunks &#34;$numTrunks&#34; \
                    -numServiceVlan &#34;$numServiceVlan&#34; \
                    -numDuts  &#34;$numDuts&#34; \
                    -vlanVman &#34;$vlanVman&#34; \
                    -numVpws  &#34;$numVpws&#34; \
                    -config   &#34;$config&#34; \
                    -routing  &#34;$routing&#34; \
                    -addVPWS  &#34;$addVPWS&#34;
                set time2 [clock seconds]
                result_p &#34;Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
                <a name="::close_result_file(2)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
                <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
                return -code return
            }
        }
        if {$numVpws &gt; 0 &amp;&amp; $addVPWS} {
            lappend parameterList &#34;{Total.*conf.*VPWS.*$numVpws|Total.*conf.*L2VPN.*$numVpws} exist&#34;
           if {$numVpws ==1} {
               lappend parameterList &#34;{Total.*active.*VPWS.*1|Total.*active.*L2VPN.*1} exist&#34;
            } else {
               lappend parameterList &#34;{Total.*active.*VPWS.*$topRange|Total.*active.*L2VPN.*$topRange} exist&#34;
            }
            set vpwsStat [<a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show l2vpn vpws summary&#34; $parameterList \
                 -testNo $testNo -comment &#34;- chk vpws on DUT$i&#34; \
                 -dut $i -time [list &#34;s:&#34; &#34;0&#34; &#34;i:&#34; &#34;5&#34; &#34;d:&#34; &#34;$failTime&#34; &#34;f:&#34; &#34;$failTime&#34; &#34;r&#34;]]
            unset parameterList
            if {$vpwsStat == &#34;error&#34; &amp;&amp; $exitOnVFail == &#34;yes&#34;} {
                <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Failed vpws coming active on DUT${i}: Abandon $testNo &#34;
                for {set y 1} {$y &lt;= $numDuts} {incr y} {
                   <a name="::LogoutFast(4)"><a href="./login.tcl.html#::LogoutFast_481">::LogoutFast</a></a> $y
                }
                <a name="::::MulDutVpwsCleanup(3)"><a href="./vpws.tcl.html#::::MulDutVpwsCleanup_763">::::MulDutVpwsCleanup</a></a>  -numTrunks &#34;$numTrunks&#34; \
                    -numServiceVlan &#34;$numServiceVlan&#34; \
                    -numDuts  &#34;$numDuts&#34; \
                    -vlanVman &#34;$vlanVman&#34; \
                    -numVpws  &#34;$numVpws&#34; \
                    -config   &#34;$config&#34; \
                    -routing  &#34;$routing&#34; \
                    -addVPWS  &#34;$addVPWS&#34;
                set time2 [clock seconds]
                result_p &#34;Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
                <a name="::close_result_file(3)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
                <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

                <span class="comment-line"># Make sure all config is cleaned off</span>
                for {set y 1} {$y &lt;= $numDuts} {incr y} {
                   <a name="::allCleanup(1)"><a href="./cleanup.tcl.html#::allCleanup_883">::allCleanup</a></a> $y
                }
                return -code return
            }
        }
    }
}

}

<span class="comment-line">###################################################################################################</span>
<span class="comment-line"># Procedure Name: MulDutVpwsCleanup</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line"># This procedure deletes   a variable number of pseudo wire/service</span>
<span class="comment-line">#      pairs on a multi-node  test bed.  </span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line">#   -numTrunks &#34;1&#34;          &lt;= number of trunks connected between DUts</span>
<span class="comment-line">#   -numServiceVlan &#34;1&#34;     &lt;= number of service Vlan/Vman used</span>
<span class="comment-line">#   -nonDefaultArg &#34;none&#34;   &lt;= the ability to set non-default vpws values</span>
<span class="comment-line">#   -vlanVman &#34;vlan&#34;        &lt;= vpws can be configured in conjunction with vmans</span>
<span class="comment-line">#   -numDuts  &#34;2&#34;           &lt;= number of Duts used for vpws setup</span>
<span class="comment-line">#   -config  &#34;line&#34;         &lt;= connection of Duts in the setup,</span>
<span class="comment-line">#                               for ex if numDuts=3 and config=line, then</span>
<span class="comment-line">#                               the script will configure trunk connection as below</span>
<span class="comment-line">#                               DUT1&lt;===&gt;DUT2&lt;===&gt;DUT3</span>
<span class="comment-line">#                               if config=loop then the configuation would be</span>
<span class="comment-line">#                               DUT1&lt;===&gt;DUT2&lt;===&gt;DUT3</span>
<span class="comment-line">#                                ^                 ^</span>
<span class="comment-line">#                                |                 |</span>
<span class="comment-line">#                                 -----------------</span>
<span class="comment-line">#   -numVpws  &#34;10&#34;          &lt;= number of vpws sessions to be used for testcase</span>
<span class="comment-line">#   -noEcmp &#34;1&#34;             &lt;= the value set to 1 indicates  ospf route costs</span>
<span class="comment-line">#                              between DUTs are different, otherwise 0,</span>
<span class="comment-line">#                              default is 0 indicates ECMP</span>
<span class="comment-line">#   -routing &#34;ospf&#34;         &lt;= ospf or static routing used to bring up ldp</span>
<span class="comment-line">#</span>
<span class="comment-line">#   -addVPWS &#34;1&#34;            &lt;= Other modules may want to use this library with only the</span>
<span class="comment-line">#                              basic MPLS setup. If setup skipped VPWS no need to clean  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#        MulDutVpwsCleanup  -numTrunks &#34;1&#34; \</span>
<span class="comment-line">#          -numServiceVlan &#34;1&#34; \</span>
<span class="comment-line">#          -numDuts  &#34;2&#34; \</span>
<span class="comment-line">#          -vlanVman &#34;vlan&#34; \</span>
<span class="comment-line">#          -numVpws  &#34;10&#34; \</span>
<span class="comment-line">#          -config   &#34;line \</span>
<span class="comment-line">#          -routing  &#34;ospf&#34; \</span>
<span class="comment-line">#          -addVPWS  &#34;1&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupSwitch</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::MulDutVpwsCleanup_763">proc <a href="vpws.tcl-annot.html#::::MulDutVpwsCleanup">::::MulDutVpwsCleanup</a></a></strong><a name="::::MulDutVpwsCleanup"></a> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> MulDutVpwsCleanup $args {
      numTrunks &#34;1&#34;
      numServiceVlan &#34;1&#34;
      vlanVman &#34;vlan&#34;
      numDuts &#34;2&#34;
      numVpws &#34;1&#34;
      config &#34;line&#34;
      routing &#34;static&#34;
      addVPWS &#34;1&#34;
      srcDut  &#34;1&#34;
      destDut &#34;3&#34;
      conType &#34;&#34;
   }
   global DUTs_info
for {set i 1} {$i &lt;= $numDuts} {incr i} {
   <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$i,connect)

   <span class="comment-line"># Clear global variables</span>
   set DUTs_info(DUT${i},ldpPeerList) &#34;&#34;

   <a name="::SendACmd(92)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable mpls&#34;
<span class="comment-line">#exSleep 2</span>
   <a name="::SendACmd(93)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;unconfigure mpls&#34;
<span class="comment-line">#exSleep 2</span>
   if {$conType ==&#34;end-end&#34;} {
      if {(($i==$srcDut) || ($i==$destDut))} {
         set delservVlan 1
      } else {
         set delservVlan 0
     }
   } else {
      set delservVlan 1
   }
 
   if $delservVlan {
   for {set j 1} {$j&lt;= $numVpws} {incr j} {
      if {$addVPWS} {
         <a name="::SendACmd(94)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable l2vpn vpws vpws$j&#34;
         <a name="::SendACmd(95)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete l2vpn vpws vpws$j&#34;
      }
   }
   if {$vlanVman == &#34;vman&#34;} {
      <span class="comment-line"># Multiple VMANs can not be added to a port tagged</span>
      set topRange 2
   } else {
      set topRange $numServiceVlan
   }

<a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
   <span class="comment-line"># delete VPWS Service VLANs </span>
   <span class="comment-line">#</span>
   for {set j 0} {$j&lt;$topRange} {incr j} {
      <a name="::SendACmd(96)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ${vlanVman} ${vlanVman}$j&#34;
   }
   }
   <a name="::SendACmd(97)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan loop&#34;
   <span class="comment-line">#</span>
   <span class="comment-line"># Delete trunk vlans</span>
   <span class="comment-line">#</span>
   set trunkVlans &#34;&#34;;
   if {$config == &#34;line&#34;} {
      for {set j 1} {$j&lt;=$numTrunks} {incr j} {
       <span class="comment-line">#---Line configuration meant duts are connected in sequence</span>
         if {$i != $numDuts} {
            set k [expr $i + 1]
            set wanID ${i}$k;
            set wanVlan trunk${wanID}_$j;
         <span class="comment-line">#---- if not last dut delete the right facing vlan</span>
            <a name="::SendACmd(98)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $wanVlan&#34;
            <span class="comment-line">#--- Delete Static Routes</span>
            if {$routing != &#34;ospf&#34;} {
               for {set q $i} {$q&lt;$numDuts} {incr q} {
                  <a name="::SendACmd(99)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr del 100.100.[expr $q + 1].1/32 \
                            1${j}.0.${wanID}.2&#34;
               }
            }
         } 
         if {$i !=1 } {
         <span class="comment-line">#---- if not first dut delete the left facing vlan</span>
            set m [expr $i -1]
            set wanID ${m}$i;
            set wanVlan trunk${wanID}_$j;
            <a name="::SendACmd(100)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $wanVlan&#34;
            <span class="comment-line">#--- Delete Static Routes</span>
            if {$routing != &#34;ospf&#34;} {
               for {set q 1} {$q&lt;$i} {incr q} {
                  <a name="::SendACmd(101)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr del 100.100.${q}.1/32 \
                            1${j}.0.${wanID}.1&#34;
               }
            }
         }
      }
   }  elseif {$config == &#34;loop&#34;} {
      for {set j 1} {$j&lt;=$numTrunks} {incr j} {
       <span class="comment-line">#---Loop configuration means duts are connected in a ring</span>
         if {$i &lt;= $numDuts} {
         <span class="comment-line">#---- delete the right facing vlans</span>
            set k [expr $i + 1]
            set wanID ${i}$k;
            set wanVlan trunk${wanID}_$j;         
            <span class="comment-line">#---- if dut is last, delete vlan connected to dut 1</span>
            if {$i == $numDuts} {
               set k 1
               set wanID 1${numDuts};
               set wanVlan trunk${wanID}_$j;
            }         
            <a name="::SendACmd(102)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $wanVlan&#34;
            <span class="comment-line">#--- Delete Static Routes</span>
            if {$routing != &#34;ospf&#34;} {
               for {set q [expr $i + 1]} {$q&lt;=$numDuts} {incr q} {
                  <a name="::SendACmd(103)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr del 100.100.${q}.1/32 \
                            1${j}.0.${wanID}.2&#34;
               }
            }
         } 
         if {$i &gt;= 1 } {
         <span class="comment-line">#---- if not first dut delete the left facing vlan</span>
            set m [expr $i -1]
            set wanID ${m}$i;
            set wanVlan trunk${wanID}_$j;
            <span class="comment-line">#---- if dut is first, delete a vlan connected to last dut</span>
            if {$i == 1} {
               set m $numDuts
               set wanID ${i}$numDuts;
               set wanVlan trunk${wanID}_$j;
            }
            <a name="::SendACmd(104)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $wanVlan&#34;
            <span class="comment-line">#--- Delete Static Routes</span>
            if {$routing != &#34;ospf&#34;} {
               for {set q 1} {$q&lt;$i} {incr q} {
                  <a name="::SendACmd(105)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr del 100.100.${q}.1/32 \
                            1${j}.0.${wanID}.1&#34;
               }
            }
         }
      }
   }  else {
   <span class="comment-line">#---Mesh configuration, DUT's are connected between each other</span>
      <span class="comment-line">#--- Multiple trunks is not supported</span>
      set numTrunks 1;
      for {set x 1} {$x &lt;= $numDuts} {incr x} {
         if {[expr $i - $x]} {
            <span class="comment-line">#--- Decide how to name the trunk and set 4th octet numbers</span>
            if {$i&lt;$x} {
               set wanID &#34;${i}$x&#34;;
               set lastOctet 1
               set nextHop 2
            } else {
               set wanID &#34;${x}$i&#34;;
               set lastOctet 2
               set nextHop 1
            }            
            set wanVlan trunk${wanID}_1;
            <a name="::SendACmd(106)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $wanVlan&#34;
            <span class="comment-line">#--- Delete Static Routes</span>
            if {$routing != &#34;ospf&#34;} {
               <a name="::SendACmd(107)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ipr del 100.100.$x.1/32 11.0.${wanID}.$nextHop&#34;
            }
         }
      }
   }
   if {$routing == &#34;ospf&#34;} {
      <a name="::SendACmd(108)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
   }
   <a name="::SendACmd(109)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf routerid 0.0.0.0&#34;
}
}



<strong><a name="::::SetupMPLSLine2.3_934">proc <a href="vpws.tcl-annot.html#::::SetupMPLSLine2.3">::::SetupMPLSLine2.3</a></a></strong><a name="::::SetupMPLSLine2.3"></a> {} {

global DUT1_CONNECT
global DUT2_CONNECT
global DUT3_CONNECT
global DUT4_CONNECT

<a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<a name="::SendACmd(110)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure default delete port all&#34;
set DUT1vlan2IP 1.0.0.1
set portList [<a name="::::GetATrunkPort(6)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2]
<a name="::SendACmd(111)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config ospf routerid 100.100.100.1&#34;
<a name="::::SetupSingleOSPFVlanWithPrefix(1)"><a href="./vpws.tcl.html#::::SetupSingleOSPFVlanWithPrefix_1052">::::SetupSingleOSPFVlanWithPrefix</a></a> &#34;100.100.100.1/32&#34; &#34;0.0.0.0&#34; &#34;None&#34; 1 &#34;loop&#34; &#34;false&#34;
<a name="::SetupSingleOSPFVlan(1)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT1vlan2IP 0.0.0.0 $portList 1 &#34;vlan12&#34;
<a name="::SendACmd(112)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipr mpls-next-hop&#34;
<a name="::SendACmd(113)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls lsr-id 100.100.100.1&#34;
<a name="::SendACmd(114)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add loop&#34;
<a name="::SendACmd(115)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add vlan12&#34;
<a name="::SendACmd(116)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls protocol ldp&#34;
<a name="::SendACmd(117)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls vlan all&#34;
<a name="::SendACmd(118)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls ldp vlan all&#34;
<a name="::SendACmd(119)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls ldp advertise direct all&#34;
<a name="::SendACmd(120)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
<a name="::SendACmd(121)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls&#34;

<a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT
<a name="::SendACmd(122)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure default delete port all&#34;
set DUT2vlan1IP 1.0.0.2
set portList [<a name="::::GetATrunkPort(7)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1]
<a name="::SendACmd(123)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config ospf routerid 100.100.100.2&#34;
<a name="::::SetupSingleOSPFVlanWithPrefix(2)"><a href="./vpws.tcl.html#::::SetupSingleOSPFVlanWithPrefix_1052">::::SetupSingleOSPFVlanWithPrefix</a></a> &#34;100.100.100.2/32&#34; &#34;0.0.0.0&#34; &#34;None&#34; 2 &#34;loop&#34; &#34;false&#34;
<a name="::SetupSingleOSPFVlan(2)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT2vlan1IP 0.0.0.0 $portList 2 &#34;vlan12&#34;
set DUT2vlan3IP 2.0.0.2
set portList [<a name="::::GetATrunkPort(8)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 3]
<a name="::SetupSingleOSPFVlan(3)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT2vlan3IP 0.0.0.0 $portList 2 &#34;vlan23&#34;
<a name="::SendACmd(124)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipr mpls-next-hop&#34;
<a name="::SendACmd(125)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls lsr-id 100.100.100.2&#34;
<a name="::SendACmd(126)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add loop&#34;
<a name="::SendACmd(127)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add vlan12&#34;
<a name="::SendACmd(128)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add vlan23&#34;
<a name="::SendACmd(129)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls protocol ldp&#34;
<a name="::SendACmd(130)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls vlan all&#34;
<a name="::SendACmd(131)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls ldp vlan all&#34;
<a name="::SendACmd(132)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls ldp advertise direct all&#34;
<a name="::SendACmd(133)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
<a name="::SendACmd(134)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls&#34;

<a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT3_CONNECT
<a name="::SendACmd(135)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure default delete port all&#34;
set DUT3vlan2IP 2.0.0.3
set portList [<a name="::::GetATrunkPort(9)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 2]
<a name="::SendACmd(136)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config ospf routerid 100.100.100.3&#34;
<a name="::::SetupSingleOSPFVlanWithPrefix(3)"><a href="./vpws.tcl.html#::::SetupSingleOSPFVlanWithPrefix_1052">::::SetupSingleOSPFVlanWithPrefix</a></a> &#34;100.100.100.3/32&#34; &#34;0.0.0.0&#34; &#34;None&#34; 3 &#34;loop&#34; &#34;false&#34;
<a name="::SetupSingleOSPFVlan(4)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT3vlan2IP 0.0.0.0 $portList 3 &#34;vlan23&#34;
set DUT3vlan4IP 3.0.0.3 ;
set portList [<a name="::::GetATrunkPort(10)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 4]
<a name="::SetupSingleOSPFVlan(5)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT3vlan4IP 0.0.0.4 $portList 3 &#34;vlan34&#34;
<a name="::SendACmd(137)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipr mpls-next-hop&#34;
<a name="::SendACmd(138)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls lsr-id 100.100.100.3&#34;
<a name="::SendACmd(139)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add loop&#34;
<a name="::SendACmd(140)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add vlan23&#34;
<a name="::SendACmd(141)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add vlan34&#34;
<a name="::SendACmd(142)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls protocol ldp&#34;
<a name="::SendACmd(143)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls vlan all&#34;
<a name="::SendACmd(144)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls ldp vlan all&#34;
<a name="::SendACmd(145)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls ldp advertise direct all&#34;
<a name="::SendACmd(146)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
<a name="::SendACmd(147)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls&#34;



<a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT4_CONNECT
<a name="::SendACmd(148)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure default delete port all&#34;
set DUT4vlan3IP 3.0.0.4
set portList [<a name="::::GetATrunkPort(11)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 4 3]
<a name="::SendACmd(149)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config ospf routerid 100.100.100.4&#34;
<a name="::::SetupSingleOSPFVlanWithPrefix(4)"><a href="./vpws.tcl.html#::::SetupSingleOSPFVlanWithPrefix_1052">::::SetupSingleOSPFVlanWithPrefix</a></a> &#34;100.100.100.4/32&#34; &#34;0.0.0.4&#34; &#34;None&#34; 4 &#34;loop&#34; &#34;false&#34;
<a name="::SetupSingleOSPFVlan(6)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT4vlan3IP 0.0.0.4 $portList 4 &#34;vlan34&#34;
<a name="::SendACmd(150)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipr mpls-next-hop&#34;
<a name="::SendACmd(151)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls lsr-id 100.100.100.4&#34;
<a name="::SendACmd(152)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add loop&#34;
<a name="::SendACmd(153)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls add vlan34&#34;
<a name="::SendACmd(154)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls protocol ldp&#34;
<a name="::SendACmd(155)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls vlan all&#34;
<a name="::SendACmd(156)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls ldp vlan all&#34;
<a name="::SendACmd(157)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mpls ldp advertise direct all&#34;
<a name="::SendACmd(158)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
<a name="::SendACmd(159)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mpls&#34;



<a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT4_CONNECT
<a name="::SendACmd(160)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
<a name="::SendACmd(161)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;config ospf area 0.0.0.4 nssa summary stub-default-cost 10&#34;
<a name="::SendACmd(162)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
<a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT3_CONNECT
<a name="::SendACmd(163)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
<a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5 ;<span class="comment-line">#Added sleep ...</span>
<a name="::SendACmd(164)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;config ospf area 0.0.0.4 nssa summary stub-default-cost 10&#34;
<a name="::SendACmd(165)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: SetupSingleOSPFVlanWithPrefix</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: ospf topology specific proc that is used to setup a single ospf vlan</span>
<span class="comment-line">#              for a given area with prefix</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlan1IP, vlanArea, portList, dutID, vlanName, enableOSPF, tag</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         SetupSingleOSPFVlanWithPrefix 100.101.10.1/24  $area [MapDUTPortId 1] 1 &#34;vlan1&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupSingleOSPFVlanWithPrefix_1052">proc <a href="vpws.tcl-annot.html#::::SetupSingleOSPFVlanWithPrefix">::::SetupSingleOSPFVlanWithPrefix</a></a></strong><a name="::::SetupSingleOSPFVlanWithPrefix"></a> { vlan1IP vlanArea portList dutID {vlanName &#34;vlan1&#34;} {enableOSPF &#34;true&#34;} {tag &#34;&#34;} {AreaType &#34;&#34;} } {

<a name="::SendACmd(166)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
sleep 2         ;<span class="comment-line"># exos</span>
<a name="::SendACmd(167)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding&#34;
<a name="::SendACmd(168)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $vlanName&#34;
<a name="::SendACmd(169)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName ipaddress $vlan1IP&#34;
<a name="::SendACmd(170)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show $vlanName&#34;
if { $portList != &#34;None&#34; } {
if {[string length $tag]} {
   <a name="::SendACmd(171)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName tag $tag&#34;
   <a name="::SendACmd(172)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName add port $portList tagged&#34;
} else {
   <a name="::SendACmd(173)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName add port $portList&#34;
}
}
<a name="::SendACmd(174)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding vlan $vlanName&#34;

<span class="comment-line">#just create the area eventhough the area might exist</span>
if {$vlanArea != &#34;0.0.0.0&#34; } { <a name="::SendACmd(175)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create ospf area $vlanArea&#34; }
<a name="::SendACmd(176)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config ospf add vlan $vlanName area $vlanArea&#34;

if { $vlanName == &#34;loop&#34; } { <a name="::SendACmd(177)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable loopback-mode loop&#34; }
if { $AreaType == &#34;stub&#34; } { <a name="::SendACmd(178)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf area 0.0.0.2 stub summary stub-default-cost 10&#34; }
if { $AreaType == &#34;nssa&#34; } { <a name="::SendACmd(179)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure ospf area 0.0.0.2 nssa summary stub-default-cost 10&#34; }
if { $enableOSPF == &#34;true&#34; } { <a name="::SendACmd(180)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34; }

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CleanupSingleOSPFVlanWithMPLS</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: ospf topology specific proc that is used to cleanup single ospf vlan cinfiguration</span>
<span class="comment-line">#              for a given area.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlanArea, vlanName true/false</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         CleanupSingleOSPFVlanWithMPLS $area vlan1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupSingleOSPFVlanWithMPLS_1096">proc <a href="vpws.tcl-annot.html#::::CleanupSingleOSPFVlanWithMPLS">::::CleanupSingleOSPFVlanWithMPLS</a></a></strong><a name="::::CleanupSingleOSPFVlanWithMPLS"></a> { vlanArea {vlanName &#34;vlan1&#34;} {OspfMplsCleanup &#34;true&#34;}} {
    if { $OspfMplsCleanup == &#34;true&#34; } {
    <a name="::SendACmd(181)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;disable ospf&#34;
    sleep 2         ;<span class="comment-line"># exos</span>
    <a name="::SendACmd(182)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;disable mpls&#34;
    <a name="::SendACmd(183)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;unconfigure mpls&#34;
    sleep 2         ;<span class="comment-line"># exos</span>
    <a name="::SendACmd(184)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;configure ospf routerid 0.0.0.0&#34;
    <a name="::SendACmd(185)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;clear fdb&#34;
    }
    <a name="::SendACmd(186)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;delete vlan $vlanName&#34;
    if {$vlanArea != &#34;0.0.0.0&#34; } { <a name="::SendACmd(187)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ospf area $vlanArea&#34;}
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetMplsStaticLabel</span>
<span class="comment-line"># Description:  Configure matching ingress and egress tags between</span>
<span class="comment-line">#               Pionner and Genesis platforms which support different</span>
<span class="comment-line">#               Tag ranges</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: newLabel</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       SendACmd &#34;configure mpls static lsp to-chennai-static egress \</span>
<span class="comment-line">#       [GetMplsStaticLabel -nextHopDUT 2 -baseLabel 32 -direction egress] \</span>
<span class="comment-line">#       egress-vlan chennai-link next-hop 150.151.1.1 ingress \</span>
<span class="comment-line">#       [GetMplsStaticLabel -baseLabel 29 -direction ingress] \</span>
<span class="comment-line">#       ingress-vlan core-mumbai&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: DUTConfig</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetMplsStaticLabel_1127">proc <a href="vpws.tcl-annot.html#::::GetMplsStaticLabel">::::GetMplsStaticLabel</a></a></strong><a name="::::GetMplsStaticLabel"></a> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> GetMplsStaticLabel $args {
     nextHopDUT  &#34;1&#34;
     baseLabel &#34;11&#34;
     direction &#34;ingress&#34;
     egressLSP &#34;0&#34;
     outputPacket &#34;0&#34;
   }

   global whichDutNow
   global gnssPlatform
   global bcmPlatform
   global pioneerPlatform

   if {($baseLabel &lt; 12) &amp;&amp; [regexp -nocase &#34;$pioneerPlatform&#34; [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]]} {
       <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Illegal baselabel value: invalid range on pioneer&#34;
   }
   if {[string length $baseLabel] &gt; 2} {
       <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Illegal baselabel value - should only be 2 chars or 1 char&#34;
   }
   <span class="comment-line"># break up the 2 nibble baseLabel</span>
   set label1 [string index $baseLabel 0]
   set label2 [string index $baseLabel 1]
   if {[regexp -nocase &#34;$gnssPlatform|$bcmPlatform&#34; [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]] &amp;&amp; \
       $direction == &#34;ingress&#34;} {
           if {$egressLSP} {
               if {$outputPacket} {
                   set outLabel &#34;80 0$label1 $label2&#34;
               } else {
                   set outLabel 0x800$baseLabel
               }
           } else {
               if {$outputPacket} {
                   set outLabel &#34;7F C$label1 $label2&#34;
               } else {
                   set outLabel 0x7FC$baseLabel
               }
           }
           <span class="comment-line">#result_debug &#34;Ingress Genesis 0x7FC$baseLabel&#34;</span>
           return $outLabel
   }
   if {[regexp -nocase &#34;$pioneerPlatform&#34; [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]] &amp;&amp; \
       $direction == &#34;ingress&#34;} {
           if {$outputPacket} {
               set outLabel &#34;00 0$label1 $label2&#34;
           } else {
               set outLabel 0x$baseLabel
           }
           <span class="comment-line">#result_debug &#34;Ingress Pioneer 0x$baseLabel&#34;</span>
           return $outLabel
   }
   if {[regexp -nocase &#34;$gnssPlatform|$bcmPlatform&#34; [<a name="::GetPlatform(4)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${nextHopDUT}]] &amp;&amp; \
       $direction == &#34;egress&#34;} {
           if {$egressLSP} {
               if {$outputPacket} {
                   set outLabel &#34;80 0$label1 $label2&#34;
               } else {
                   set outLabel 0x800$baseLabel
               }
           } else {
               if {$outputPacket} {
                   set outLabel &#34;7F C$label1 $label2&#34;
               } else {
                   set outLabel 0x7FC$baseLabel
               }
           }
           <span class="comment-line">#result_debug &#34;Egress to Genesis 0x7FC$baseLabel&#34;</span>
           return $outLabel
   }
   if {[regexp -nocase &#34;$pioneerPlatform&#34; [<a name="::GetPlatform(5)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${nextHopDUT}]] &amp;&amp; \
       $direction == &#34;egress&#34;} {
           if {$outputPacket} {
               set outLabel &#34;00 0$label1 $label2&#34; 
           } else {
               set outLabel 0x$baseLabel
           }
           <span class="comment-line">#result_debug &#34;Egress to Pioneer 0x$baseLabel&#34;</span>
           return $outLabel
   }
   <span class="comment-line"># If no matches have hit</span>
}
<span class="comment-line"># --------------------------------------------------------------------------</span>
<span class="comment-line"># in vpws certain tests use a mesh of predefined streams</span>
<span class="comment-line">#   at the beginning of these tests make sure the mess is configured</span>
<span class="comment-line">#</span>
<span class="comment-line"># --------------------------------------------------------------------------</span>
<strong><a name="::::CheckStreamMatrix_1213">proc <a href="vpws.tcl-annot.html#::::CheckStreamMatrix">::::CheckStreamMatrix</a></a></strong><a name="::::CheckStreamMatrix"></a> {} {
   global DUTs_info

   if {!$DUTs_info(DUT1,TrafficPrimed)} {
       <a name="::::PrimeVPWSTraffic(1)"><a href="./vpws.tcl.html#::::PrimeVPWSTraffic_1234">::::PrimeVPWSTraffic</a></a>
   }
}
<span class="comment-line"># -------------------------------------------------------------------------</span>
<span class="comment-line"># If any stream is sent the matrix is wiped from the ixia config</span>
<span class="comment-line">#    so it is necessary to unset the TrafficPrimed to 0</span>
<span class="comment-line">#    if the ixia is used.  PrimeVPWSTraffic will have to </span>
<span class="comment-line">#    be run to re-init the matrix</span>
<span class="comment-line"># ------------------------------------------------------------------------</span>
<strong><a name="::::ClearStreamMatrix_1226">proc <a href="vpws.tcl-annot.html#::::ClearStreamMatrix">::::ClearStreamMatrix</a></a></strong><a name="::::ClearStreamMatrix"></a> {} {
   global DUTs_info
   set DUTs_info(DUT1,TrafficPrimed) 0
}
<span class="comment-line"># -------------------------------------------------------------------------</span>
<span class="comment-line"># Set up the matrix of streams for the 1.3.x vpws tests</span>
<span class="comment-line">#</span>
<span class="comment-line"># -------------------------------------------------------------------------</span>
<strong><a name="::::PrimeVPWSTraffic_1234">proc <a href="vpws.tcl-annot.html#::::PrimeVPWSTraffic">::::PrimeVPWSTraffic</a></a></strong><a name="::::PrimeVPWSTraffic"></a> {} {
   global DUTs_info
   global DUT1_CONNECT
   global DUT2_CONNECT
   global DUT3_CONNECT
   global DUT4_CONNECT
   global DUT5_CONNECT

   <a name="::IxiaPortsInit(1)"><a href="./ePTTx.tcl.html#::IxiaPortsInit_331">::IxiaPortsInit</a></a>

   <span class="comment-line">#S1)  PORT W &gt; SA=W, DA=(Broadcast), Ethertype=0800 (untagged broadcast)</span>
   <a name="::createStreams(1)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 1 -startId 1 -endId 1 -name S1 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(1)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal {{sa &#34;00 A1 F1 00 00 01&#34;} {da &#34;FF FF FF FF FF FF&#34;} \
         {frameType &#34;08 00&#34;} {enable true} {dma advance} {numFrames 10}}
   <a name="::setStreamOptions(2)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;1.1.1.2&#34;} {destIpAddr &#34;255.255.255.255&#34;}}

   <span class="comment-line">#S2)  PORT X &gt; SA=X, DA=(Broadcast), Ethertype=8100 VID=10</span>
   <span class="comment-line">#                    (tagged broadcast on tagged port)</span>
   <a name="::createStreams(2)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 2 -startId 1 -endId 1 -name S2 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(3)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 1 -endId 1 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
   <a name="::setStreamOptions(4)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 1 -endId 1 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0601} {protocolTagId 33024}}
   <a name="::setStreamOptions(5)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal {{sa &#34;00 A1 F2 00 00 01&#34;} {da &#34;FF FF FF FF FF FF&#34;} \
         {frameType &#34;81 00&#34;} {enable true} {dma advance} {numFrames 10}}
   <a name="::setStreamOptions(6)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;2.2.2.2&#34;} {destIpAddr &#34;255.255.255.255&#34;}}

   <span class="comment-line">#vlan setDefault</span>
   <span class="comment-line">#vlan vlanID 1234</span>
   <span class="comment-line">#vlan userPriority 0</span>
   <span class="comment-line">#vlan cfi resetCFI</span>
   <span class="comment-line">#vlan mode vIdle</span>
   <span class="comment-line">#vlan repeat 10</span>
   <span class="comment-line">#vlan step 1</span>
   <span class="comment-line">#vlan maskval &#34;0000XXXXXXXXXXXX&#34;</span>
   <span class="comment-line">#protocol enable802dot1qTag true</span>

   <span class="comment-line">#stream enable true</span>
   <span class="comment-line">#stream frameType &#34;FF FF&#34;</span>
   <span class="comment-line">#stream numFrames 1</span>
   <span class="comment-line">#stream percentPacketRate 1.0</span>
   <span class="comment-line">#stream fpsRate 1488.0952381</span>
   <span class="comment-line">#stream rateMode usePercentRate</span>
   <span class="comment-line">#stream sa &#34;00 00 00 00 00 00&#34;</span>
   <span class="comment-line">#stream saRepeatCounter idle</span>
   <span class="comment-line">#stream saStep 1</span>
   <span class="comment-line">#stream da &#34;00 00 00 00 00 00&#34;</span>
   <span class="comment-line">#stream daRepeatCounter idle</span>
   <span class="comment-line">#stream daStep 1</span>
   <span class="comment-line">#stream framesize 128</span>
   <span class="comment-line">#stream pattern &#34;00 01 02 03&#34;</span>
   <span class="comment-line">#stream dma  &#34;advance|gotoFirst|firstLoopCount|contPacket|stopStream&#34;</span>
   <span class="comment-line">#stream loopCount 1</span>
   <span class="comment-line">#stream returnToId 1</span>

   <span class="comment-line">#ip sourceIpAddr &#34;0.0.0.0&#34;</span>
   <span class="comment-line">#ip sourceIpAddrMode ipIdle</span>
   <span class="comment-line">#ip sourceIpAddrRepeatCount 10</span>
   <span class="comment-line">#ip destIpAddr &#34;0.0.0.0&#34;</span>
   <span class="comment-line">#ip destIpAddrMode ipIdle</span>
   <span class="comment-line">#ip destIpAddrRepeatCount 10</span>
   <span class="comment-line">#ip destMacAddr &#34;00 DE BB 00 00 02&#34;</span>

   <span class="comment-line">#S3)  PORT W &gt; SA=W, DA=(Broadcast), Ethertype=8100 VID=10</span>
   <span class="comment-line">#                    (tagged broadcast on untagged port, local tag)</span>
   <a name="::createStreams(3)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 1 -startId 2 -endId 2 -name S3 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(7)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 2 -endId 2 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
   <a name="::setStreamOptions(8)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 2 -endId 2 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0601}}
   <a name="::setStreamOptions(9)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 2 -endId 2 -type &#34;stream&#34; \
         -optionVal {{sa &#34;00 A1 F1 00 00 01&#34;} {da &#34;FF FF FF FF FF FF&#34;} \
         {frameType &#34;81 00&#34;} {enable true} {dma advance} {numFrames 10}}
   <a name="::setStreamOptions(10)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 2 -endId 2 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;1.1.1.2&#34;} {destIpAddr &#34;255.255.255.255&#34;}}

   <span class="comment-line">#S4)  PORT W &gt; SA=W, DA=(Broadcast), Ethertype=8100 VID=50</span>
   <span class="comment-line">#                    (tagged broadcast on untagged port, remote tag)</span>
   <a name="::createStreams(4)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 1 -startId 3 -endId 3 -name S4 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(11)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 3 -endId 3 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
   <a name="::setStreamOptions(12)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 3 -endId 3 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0701}}
   <a name="::setStreamOptions(13)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 3 -endId 3 -type &#34;stream&#34; \
         -optionVal {{sa &#34;00 A1 F1 00 00 01&#34;} {da &#34;FF FF FF FF FF FF&#34;} \
         {frameType &#34;81 00&#34;} {enable true} {dma advance} {numFrames 10}}
   <a name="::setStreamOptions(14)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 3 -endId 3 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;1.1.1.2&#34;} {destIpAddr &#34;255.255.255.255&#34;}}

   <span class="comment-line">#S5)  PORT W &gt; SA=W, DA=(Broadcast), Ethertype=8100 VID=99</span>
   <span class="comment-line">#                    (tagged broadcast on untagged port, new tag)</span>
   <a name="::createStreams(5)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 1 -startId 4 -endId 4 -name S5 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(15)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 4 -endId 4 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
   <a name="::setStreamOptions(16)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 4 -endId 4 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0099}}
   <a name="::setStreamOptions(17)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 4 -endId 4 -type &#34;stream&#34; \
         -optionVal {{sa &#34;00 A1 F1 00 00 01&#34;} {da &#34;FF FF FF FF FF FF&#34;} \
         {frameType &#34;81 00&#34;} {enable true} {dma advance} {numFrames 10}}
   <a name="::setStreamOptions(18)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 4 -endId 4 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;1.1.1.2&#34;} {destIpAddr &#34;255.255.255.255&#34;}}

   <span class="comment-line">#S6)  PORT W &gt; SA=W, DA=Y, Ethertype=0800</span>
   <span class="comment-line">#                    (unknown unicast on untagged port)</span>
   <a name="::createStreams(6)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 1 -startId 5 -endId 5 -name S6 -type &#34;ipv4_udp&#34;
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;00 A1 F1 00 00 01\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   lappend optionsList &#34;da \&#34;[<a name="::cookMacForIxia(1)"><a href="./misc.tcl.html#::cookMacForIxia_61">::cookMacForIxia</a></a> $DUTs_info(DUT1,sysMAC)]\&#34;&#34;
   lappend optionsList &#34;dma advance&#34;
   lappend optionsList &#34;numFrames 10&#34;
   <a name="::setStreamOptions(19)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 5 -endId 5 -type &#34;stream&#34; \
         -optionVal $optionsList
   <a name="::setStreamOptions(20)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 5 -endId 5 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;1.1.1.2&#34;} {destIpAddr &#34;3.3.3.2&#34;}}

   <span class="comment-line">#S7)  PORT X &gt; SA=X, DA=Y, Ethertype=8100  VID=10</span>
   <span class="comment-line">#                    (unknown unicast on tagged port)</span>
   <a name="::createStreams(7)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 2 -startId 2 -endId 2 -name S7 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(21)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 2 -endId 2 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
   <a name="::setStreamOptions(22)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 2 -endId 2 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0601} {protocolTagId 33024}}
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;00 A1 F2 00 00 01\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;81 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   lappend optionsList &#34;da \&#34;[<a name="::cookMacForIxia(2)"><a href="./misc.tcl.html#::cookMacForIxia_61">::cookMacForIxia</a></a> $DUTs_info(DUT1,sysMAC)]\&#34;&#34;
   lappend optionsList &#34;dma advance&#34;
   lappend optionsList &#34;numFrames 10&#34;
   <a name="::setStreamOptions(23)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 2 -endId 2 -type &#34;stream&#34; \
         -optionVal $optionsList
   <a name="::setStreamOptions(24)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 2 -endId 2 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;1.1.1.2&#34;} {destIpAddr &#34;3.3.3.2&#34;}}

   <span class="comment-line">#</span>
   <span class="comment-line"># PORT  3 4 SETUP</span>
   <span class="comment-line">#</span>

   <span class="comment-line">#S8)  PORT Y &gt; SA=Y, DA=W, Ethertype=0800</span>
   <span class="comment-line">#                    (known unicast, untagged over PW)</span>
   <a name="::createStreams(8)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 3 -startId 1 -endId 1 -name S8 -type &#34;ipv4_udp&#34;
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;00 A3 F1 00 00 01\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   lappend optionsList &#34;da \&#34;00 A1 F1 00 00 01\&#34;&#34;
   lappend optionsList &#34;dma advance&#34;
   lappend optionsList &#34;numFrames 10&#34;
   <a name="::setStreamOptions(25)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 3 -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal $optionsList
   <a name="::setStreamOptions(26)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 3 -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;3.3.3.2&#34;} {destIpAddr &#34;1.1.1.2&#34;}}

   <span class="comment-line">#S9)  PORT Y &gt; SA=Y, DA=X, Ethertype=0800</span>
   <span class="comment-line">#                    (known unicast, untagged over PW)</span>
   <a name="::createStreams(9)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 3 -startId 2 -endId 2 -name S9 -type &#34;ipv4_udp&#34;
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;00 A3 F1 00 00 01\&#34;&#34;
   lappend optionsList &#34;da \&#34;00 A1 F2 00 00 01\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   lappend optionsList &#34;dma firstLoopCount &#34;
   lappend optionsList &#34;loopCount 1&#34;
   lappend optionsList &#34;numFrames 10&#34;
   <a name="::setStreamOptions(27)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 3 -startId 2 -endId 2 -type &#34;stream&#34; \
         -optionVal $optionsList
   <a name="::setStreamOptions(28)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 3 -startId 2 -endId 2 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;3.3.3.2&#34;} {destIpAddr &#34;2.2.2.2&#34;}}

   <span class="comment-line">#S10) PORT Z &gt; SA=Z, DA=W, Ethertype=8100  VID=50</span>
   <span class="comment-line">#                    (known unicast, tagged over PW)</span>
   <a name="::createStreams(10)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 4 -startId 1 -endId 1 -name S10 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(29)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 1 -endId 1 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
   <a name="::setStreamOptions(30)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 1 -endId 1 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0701} {protocolTagId 33024}}
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;00 A3 F2 00 00 01\&#34;&#34;
   lappend optionsList &#34;da \&#34;00 A1 F1 00 00 01\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;81 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   lappend optionsList &#34;dma advance&#34;
   lappend optionsList &#34;numFrames 10&#34;
   <a name="::setStreamOptions(31)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal $optionsList
   <a name="::setStreamOptions(32)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;4.4.4.2&#34;} {destIpAddr &#34;1.1.1.2&#34;}}

   <span class="comment-line">#S11) PORT Z &gt; SA=Z, DA=X, Ethertype=0800  VID=50</span>
   <span class="comment-line">#                    (known unicast, tagged over PW)</span>
   <a name="::createStreams(11)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 4 -startId 2 -endId 2 -name S11 -type &#34;ipv4_udp&#34;
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;00 A3 F2 00 00 01\&#34;&#34;
   lappend optionsList &#34;da \&#34;00 A1 F2 00 00 01\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   lappend optionsList &#34;dma advance&#34;
   lappend optionsList &#34;numFrames 10&#34;
   <a name="::setStreamOptions(33)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 2 -endId 2 -type &#34;stream&#34; \
         -optionVal $optionsList
   <a name="::setStreamOptions(34)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 2 -endId 2 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;3.3.3.2&#34;} {destIpAddr &#34;2.2.2.2&#34;}}

   <a name="::createStreams(12)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 4 -startId 3 -endId 3 -name S113 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(35)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 3 -endId 3 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
   <a name="::setStreamOptions(36)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 3 -endId 3 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0701} {protocolTagId 34984}}
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;00 A3 F2 00 00 01\&#34;&#34;
   lappend optionsList &#34;da \&#34;00 A1 F1 00 00 01\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;88 a8\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   lappend optionsList &#34;dma advance&#34;
   lappend optionsList &#34;numFrames 10&#34;
   <a name="::setStreamOptions(37)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 3 -endId 3 -type &#34;stream&#34; \
         -optionVal $optionsList
   <a name="::setStreamOptions(38)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 4 -startId 3 -endId 3 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;4.4.4.2&#34;} {destIpAddr &#34;1.1.1.2&#34;}}

   <span class="comment-line">#S12) PORT W &gt; SA=W, DA=X, Ethertype=0800</span>
   <span class="comment-line">#                    (known unicast, untagged to local port)</span>
   <a name="::createStreams(13)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 1 -startId 6 -endId 6 -name S12 -type &#34;ipv4_udp&#34;
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;00 A1 F1 00 00 01\&#34;&#34;
   lappend optionsList &#34;da \&#34;00 A1 F2 00 00 01\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   lappend optionsList &#34;dma firstLoopCount &#34;
   lappend optionsList &#34;loopCount 1&#34;
   lappend optionsList &#34;numFrames 10&#34;
   <a name="::setStreamOptions(39)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 6 -endId 6 -type &#34;stream&#34; \
         -optionVal $optionsList
   <a name="::setStreamOptions(40)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 1 -startId 6 -endId 6 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;1.1.1.2&#34;} {destIpAddr &#34;2.2.2.2&#34;}}

   <span class="comment-line">#S13) PORT X &gt; SA=X, DA=W, Ethertype=8100  VID=10</span>
   <span class="comment-line">#                    (known unicast, tagged to local port)</span>
   <a name="::createStreams(14)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 2 -startId 3 -endId 3 -name S13 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(41)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 3 -endId 3 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
   <a name="::setStreamOptions(42)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 3 -endId 3 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0601} {protocolTagId 33024}}
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;00 A1 F2 00 00 01\&#34;&#34;
   lappend optionsList &#34;da \&#34;00 A1 F1 00 00 01\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;81 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   lappend optionsList &#34;dma advance &#34;
   lappend optionsList &#34;numFrames 10&#34;
   <a name="::setStreamOptions(43)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 3 -endId 3 -type &#34;stream&#34; \
         -optionVal $optionsList
   <a name="::setStreamOptions(44)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 3 -endId 3 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;2.2.2.2&#34;} {destIpAddr &#34;1.1.1.2&#34;}}


   <span class="comment-line">#S13.5)  PORT X &gt; SA=X, DA=(Broadcast), protocolTagId=88a8(34984) VID=601</span>
   <span class="comment-line">#                    (tagged broadcast on tagged port)</span>
   <a name="::createStreams(15)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 2 -startId 4 -endId 4 -name S135 -type &#34;ipv4_udp&#34;
   <a name="::setStreamOptions(45)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 4 -endId 4 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true} }
   <a name="::setStreamOptions(46)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 4 -endId 4 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0601} {protocolTagId 34984}}
   <a name="::setStreamOptions(47)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 4 -endId 4 -type &#34;stream&#34; \
         -optionVal {{sa &#34;00 A1 F2 00 00 01&#34;} {da &#34;FF FF FF FF FF FF&#34;} \
         {frameType &#34;88 a8&#34;} {enable true} {dma firstLoopCount} {loopCount 1} {numFrames 10}}
   <a name="::setStreamOptions(48)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 2 -startId 4 -endId 4 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;2.2.2.2&#34;} {destIpAddr &#34;255.255.255.255&#34;}}

   <span class="comment-line">#</span>
   <span class="comment-line"># PORT  5 6 SETUP</span>
   <span class="comment-line">#</span>
   if {[info exists DUT3_CONNECT]} {
        <span class="comment-line">#S8)  PORT Y &gt; SA=Y, DA=W, Ethertype=0800</span>
        <span class="comment-line">#                    (known unicast, untagged over PW)</span>
        <a name="::createStreams(16)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 5 -startId 1 -endId 1 -name S8 -type &#34;ipv4_udp&#34;
        set optionsList &#34;&#34;
        lappend optionsList &#34;sa \&#34;00 A3 F1 00 00 01\&#34;&#34;
        lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
        lappend optionsList &#34;enable true&#34;
        lappend optionsList &#34;da \&#34;00 A1 F1 00 00 01\&#34;&#34;
        lappend optionsList &#34;dma advance&#34;
        lappend optionsList &#34;numFrames 10&#34;
        <a name="::setStreamOptions(49)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 5 -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal $optionsList
        <a name="::setStreamOptions(50)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 5 -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;3.3.3.2&#34;} {destIpAddr &#34;1.1.1.2&#34;}}
        
        <span class="comment-line">#S9)  PORT Y &gt; SA=Y, DA=X, Ethertype=0800</span>
        <span class="comment-line">#                    (known unicast, untagged over PW)</span>
        <a name="::createStreams(17)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 5 -startId 2 -endId 2 -name S9 -type &#34;ipv4_udp&#34;
        set optionsList &#34;&#34;
        lappend optionsList &#34;sa \&#34;00 A3 F1 00 00 01\&#34;&#34;
        lappend optionsList &#34;da \&#34;00 A1 F2 00 00 01\&#34;&#34;
        lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
        lappend optionsList &#34;enable true&#34;
        lappend optionsList &#34;dma firstLoopCount &#34;
        lappend optionsList &#34;loopCount 1&#34;
        lappend optionsList &#34;numFrames 10&#34;
        <a name="::setStreamOptions(51)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 5 -startId 2 -endId 2 -type &#34;stream&#34; \
         -optionVal $optionsList
        <a name="::setStreamOptions(52)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 5 -startId 2 -endId 2 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;3.3.3.2&#34;} {destIpAddr &#34;2.2.2.2&#34;}}
        
        <span class="comment-line">#S10) PORT Z &gt; SA=Z, DA=W, Ethertype=8100  VID=50</span>
        <span class="comment-line">#                    (known unicast, tagged over PW)</span>
        <a name="::createStreams(18)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 6 -startId 1 -endId 1 -name S10 -type &#34;ipv4_udp&#34;
        <a name="::setStreamOptions(53)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 6 -startId 1 -endId 1 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
        <a name="::setStreamOptions(54)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 6 -startId 1 -endId 1 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0801}}
        set optionsList &#34;&#34;
        lappend optionsList &#34;sa \&#34;00 A3 F2 00 00 01\&#34;&#34;
        lappend optionsList &#34;da \&#34;00 A1 F1 00 00 01\&#34;&#34;
        lappend optionsList &#34;frameType \&#34;81 00\&#34;&#34;
        lappend optionsList &#34;enable true&#34;
        lappend optionsList &#34;dma advance&#34;
        lappend optionsList &#34;numFrames 10&#34;
        <a name="::setStreamOptions(55)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 6 -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal $optionsList
        <a name="::setStreamOptions(56)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 6 -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;4.4.4.2&#34;} {destIpAddr &#34;1.1.1.2&#34;}}
        
        <span class="comment-line">#S11) PORT Z &gt; SA=Z, DA=X, Ethertype=0800  VID=50</span>
        <span class="comment-line">#                    (known unicast, tagged over PW)</span>
        <a name="::createStreams(19)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 6 -startId 2 -endId 2 -name S11 -type &#34;ipv4_udp&#34;
        set optionsList &#34;&#34;
        lappend optionsList &#34;sa \&#34;00 A3 F2 00 00 01\&#34;&#34;
        lappend optionsList &#34;da \&#34;00 A1 F2 00 00 01\&#34;&#34;
        lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
        lappend optionsList &#34;enable true&#34;
        lappend optionsList &#34;dma firstLoopCount&#34;
        lappend optionsList &#34;loopCount 1&#34;
        lappend optionsList &#34;numFrames 10&#34;
        <a name="::setStreamOptions(57)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 6 -startId 2 -endId 2 -type &#34;stream&#34; \
         -optionVal $optionsList
        <a name="::setStreamOptions(58)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 6 -startId 2 -endId 2 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;3.3.3.2&#34;} {destIpAddr &#34;2.2.2.2&#34;}}
   }

   <span class="comment-line">#</span>
   <span class="comment-line"># PORT  7 8 SETUP</span>
   <span class="comment-line">#</span>
   if {[info exists DUT4_CONNECT]} {
        <span class="comment-line">#S8)  PORT Y &gt; SA=Y, DA=W, Ethertype=0800</span>
        <span class="comment-line">#                    (known unicast, untagged over PW)</span>
        <a name="::createStreams(20)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 7 -startId 1 -endId 1 -name S8 -type &#34;ipv4_udp&#34;
        set optionsList &#34;&#34;
        lappend optionsList &#34;sa \&#34;00 A3 F1 00 00 01\&#34;&#34;
        lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
        lappend optionsList &#34;enable true&#34;
        lappend optionsList &#34;da \&#34;00 A1 F1 00 00 01\&#34;&#34;
        lappend optionsList &#34;dma advance&#34;
        lappend optionsList &#34;numFrames 10&#34;
        <a name="::setStreamOptions(59)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 7 -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal $optionsList
        <a name="::setStreamOptions(60)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 7 -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;3.3.3.2&#34;} {destIpAddr &#34;1.1.1.2&#34;}}
        
        <span class="comment-line">#S9)  PORT Y &gt; SA=Y, DA=X, Ethertype=0800</span>
        <span class="comment-line">#                    (known unicast, untagged over PW)</span>
        <a name="::createStreams(21)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 7 -startId 2 -endId 2 -name S9 -type &#34;ipv4_udp&#34;
        set optionsList &#34;&#34;
        lappend optionsList &#34;sa \&#34;00 A3 F1 00 00 01\&#34;&#34;
        lappend optionsList &#34;da \&#34;00 A1 F2 00 00 01\&#34;&#34;
        lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
        lappend optionsList &#34;enable true&#34;
        lappend optionsList &#34;dma firstLoopCount &#34;
        lappend optionsList &#34;loopCount 1&#34;
        lappend optionsList &#34;numFrames 10&#34;
        <a name="::setStreamOptions(61)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 7 -startId 2 -endId 2 -type &#34;stream&#34; \
         -optionVal $optionsList
        <a name="::setStreamOptions(62)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 7 -startId 2 -endId 2 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;3.3.3.2&#34;} {destIpAddr &#34;2.2.2.2&#34;}}
        
        <span class="comment-line">#S10) PORT Z &gt; SA=Z, DA=W, Ethertype=8100  VID=50</span>
        <span class="comment-line">#                    (known unicast, tagged over PW)</span>
        <a name="::createStreams(22)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 8 -startId 1 -endId 1 -name S10 -type &#34;ipv4_udp&#34;
        <a name="::setStreamOptions(63)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 8 -startId 1 -endId 1 -type &#34;protocol&#34; \
         -optionVal {{enable802dot1qTag true}}
        <a name="::setStreamOptions(64)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 8 -startId 1 -endId 1 -type &#34;vlan&#34; \
         -optionVal {{vlanID 0901}}
        set optionsList &#34;&#34;
        lappend optionsList &#34;sa \&#34;00 A3 F2 00 00 01\&#34;&#34;
        lappend optionsList &#34;da \&#34;00 A1 F1 00 00 01\&#34;&#34;
        lappend optionsList &#34;frameType \&#34;81 00\&#34;&#34;
        lappend optionsList &#34;enable true&#34;
        lappend optionsList &#34;dma advance&#34;
        lappend optionsList &#34;numFrames 10&#34;
        <a name="::setStreamOptions(65)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 8 -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal $optionsList
        <a name="::setStreamOptions(66)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 8 -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;4.4.4.2&#34;} {destIpAddr &#34;1.1.1.2&#34;}}
        
        <span class="comment-line">#S11) PORT Z &gt; SA=Z, DA=X, Ethertype=0800  VID=50</span>
        <span class="comment-line">#                    (known unicast, tagged over PW)</span>
        <a name="::createStreams(23)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn 8 -startId 2 -endId 2 -name S11 -type &#34;ipv4_udp&#34;
        set optionsList &#34;&#34;
        lappend optionsList &#34;sa \&#34;00 A3 F2 00 00 01\&#34;&#34;
        lappend optionsList &#34;da \&#34;00 A1 F2 00 00 01\&#34;&#34;
        lappend optionsList &#34;frameType \&#34;08 00\&#34;&#34;
        lappend optionsList &#34;enable true&#34;
        lappend optionsList &#34;dma firstLoopCount&#34;
        lappend optionsList &#34;loopCount 1&#34;
        lappend optionsList &#34;numFrames 10&#34;
        <a name="::setStreamOptions(67)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 8 -startId 2 -endId 2 -type &#34;stream&#34; \
         -optionVal $optionsList
        <a name="::setStreamOptions(68)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn 8 -startId 2 -endId 2 -type &#34;ip&#34; \
         -optionVal {{sourceIpAddr &#34;3.3.3.2&#34;} {destIpAddr &#34;2.2.2.2&#34;}}
   }
    global OspfMplsCleanup
    if { [info exists OspfMplsCleanup] &amp;&amp; $OspfMplsCleanup == &#34;true&#34; } {
    <a name="::SendACmd(188)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;disable ospf&#34;
    sleep 2         ;<span class="comment-line"># exos</span>
    <a name="::SendACmd(189)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;disable mpls&#34;
    <a name="::SendACmd(190)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;unconfigure mpls&#34;
    sleep 2         ;<span class="comment-line"># exos</span>
    <a name="::SendACmd(191)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;configure ospf routerid 0.0.0.0&#34;
    <a name="::SendACmd(192)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;clear fdb&#34;
    }
    <span class="comment-line">#SendACmd        &#34;delete vlan $vlanName&#34;</span>
    <span class="comment-line">#if {$vlanArea != &#34;0.0.0.0&#34; } { SendACmd &#34;delete ospf area $vlanArea&#34;}</span>
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: DecodeMPLSFrameLabel</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#          -get label |  type</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  args</span>
<span class="comment-line"># Output args: </span>
<span class="comment-line"># Return value: </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># set Mpls_Type_2 [DecodeMPLSFrameLabel -get type -frame &#34;$frame&#34;]</span>
<span class="comment-line"># set Mpls_Ingress_Label [DecodeMPLSFrameLabel -get label -frame &#34;$frame&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::DecodeMPLSFrameLabel_1681">proc <a href="vpws.tcl-annot.html#::::DecodeMPLSFrameLabel">::::DecodeMPLSFrameLabel</a></a></strong><a name="::::DecodeMPLSFrameLabel"></a> { args } {

   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> DecodeMPLSFrameLabel $args {
     frame    &#34;&#34;
     get      &#34;type&#34;
   }

   set type [string range $frame 36 40]
   switch -- $type \
      &#34;81 00&#34; {
          if {$get == &#34;type&#34;} {
              return [string range $frame 48 52]
          }
          if {$get == &#34;label&#34;} {
              return [string range $frame 54 60]
          }
          return -1   
   } default {
      if {$get == &#34;type&#34;} {
          return [string range $frame 36 40]
      }
      if {$get == &#34;label&#34;} {
          return [string range $frame 42 48]
      }
      return -1
   }
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
