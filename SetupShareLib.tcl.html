<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>SetupShareLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#SetupShareLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>SetupShareLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="SetupShareLib.tcl-annot.html">annotations</a> | <a href="SetupShareLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: shareDevInit</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Initialize the data structures and reserve the ixia</span>
<span class="comment-line">#              ports using sharing device for a feature. Called </span>
<span class="comment-line">#              from Main.tcl</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : 0 on success and -1 on Failure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [shareDevInit]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::shareDevInit_19">proc <a href="SetupShareLib.tcl-annot.html#::::shareDevInit">::::shareDevInit</a></a></strong> {} {

<span class="comment-line">################################################################</span>
    set testNo &#34;L1 Switch Setup&#34;
    set title $testNo
<span class="comment-line">################################################################</span>

   global sharingDeviceType
   
   set fd_res [<a name="::open_result_file(1)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;$testNo&#34;]
   set time1 [clock seconds]
    
   if {![info exist sharingDeviceType]} {
      <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No sharing device Found&#34;

      <span class="comment-line">################################################</span>
      <span class="comment-line"># Clean up</span>
      <span class="comment-line">################################################</span>
      set time2 [clock seconds]
      result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
      <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
    
      return 0
   }

   if {($sharingDeviceType == &#34;Extreme-eware&#34;) || ($sharingDeviceType == &#34;extreme-exos&#34;)} {
      set retVal [<a name="::generateExDevPortMapping(1)"><a href="./SetupShareLib.tcl.html#::generateExDevPortMapping_560">::generateExDevPortMapping</a></a>];
      if {$retVal == -1} {
         <span class="comment-line">################################################</span>
         <span class="comment-line"># Clean up</span>
         <span class="comment-line">################################################</span>
         set time2 [clock seconds]
         result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
         <a name="::close_result_file(2)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
    
         return -1
      }
   } else {
      set retVal [<a name="::generateEdenTreeTopologyMapping(1)"><a href="./SetupShareLib.tcl.html#::generateEdenTreeTopologyMapping_127">::generateEdenTreeTopologyMapping</a></a>];
      if {$retVal == -1} {
         <span class="comment-line">################################################</span>
         <span class="comment-line"># Clean up</span>
         <span class="comment-line">################################################</span>
         set time2 [clock seconds]
         result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
         <a name="::close_result_file(3)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
    
         return -1
      }
   }

   set retVal [<a name="::reserveIxiaPortResource(1)"><a href="./SetupShareLib.tcl.html#::reserveIxiaPortResource_202">::reserveIxiaPortResource</a></a>]

   <span class="comment-line">################################################</span>
   <span class="comment-line"># Clean up</span>
   <span class="comment-line">################################################</span>
   set time2 [clock seconds]
   result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
   <a name="::close_result_file(4)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
    
   return $retVal
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: shareDevDeInit</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Deinitialization and release the ixia</span>
<span class="comment-line">#              ports after completing a feature. Called </span>
<span class="comment-line">#              from Main.tcl</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : 0 on success and -1 on Failure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [shareDevDeInit]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::shareDevDeInit_99">proc <a href="SetupShareLib.tcl-annot.html#::::shareDevDeInit">::::shareDevDeInit</a></a></strong> {} {
   global sharingDeviceType

   if {![info exist sharingDeviceType]} {
      <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No sharing device Found&#34;
      return 0
   }

   <a name="::freeIxiaPortResource(1)"><a href="./SetupShareLib.tcl.html#::freeIxiaPortResource_263">::freeIxiaPortResource</a></a>;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: generateEdenTreeTopologyMapping</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Initialization of the share device related data </span>
<span class="comment-line">#              structure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : 0 on success and -1 on Failure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [generateEdenTreeTopologyMapping]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::generateEdenTreeTopologyMapping_127">proc <a href="SetupShareLib.tcl-annot.html#::::generateEdenTreeTopologyMapping">::::generateEdenTreeTopologyMapping</a></a></strong> {} {
<span class="comment-line"># --- Place Holder for MRV switch port Mapping array generation in case</span>
<span class="comment-line">#     in future edentree server is bypassed to configure MRV directly</span>
   global shareDevPortMappingList
   global exDevPortMap
   global exDevIxiaPortMap
   global setupSharingDevice
   global ixiaCh1
   global setupName
   global startCardNum
   global ixiaTotalPortInSetup


<span class="comment-line"># --- Cook the Setup Name from Ixia chasis card and port Info</span>
   set ixiaStr [split $ixiaCh1 '.']
   set setupName [join $ixiaStr _]
   set ixiaStr [split $startCardNum ':']
   set ixiaStr [join $ixiaStr _]

   append setupName &#34;_&#34; $ixiaStr
   set  setupName &#34;_$setupName&#34;
   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ixia chasis is $ixiaCh1 Card is $startCardNum setupName \
                 is $setupName&#34;
   set ixiaTotalPortInSetup [llength $shareDevPortMappingList]

   set ixiaPortId 1
   foreach link $shareDevPortMappingList {

<span class="comment-line">#     result_debug &#34;link is $link&#34;</span>
     set ind 1

     <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Ixia $ixiaPortId &lt;---&gt; $link &lt;---&gt; DUT PortId $ixiaPortId&#34;
     foreach port $link {
        set portId [lindex $port 3]
        set tList [lreplace $port 3 3 &#34;I$portId&#34;]
        if {$ind == 1} {
           set exDevIxiaPortMap($ixiaPortId) $tList
        } else {
           set exDevPortMap($ixiaPortId) $tList
        }
        incr ind
     }
     incr ixiaPortId
   }
  
   for {set ixiaPortId 1} {$ixiaPortId &lt;= $ixiaTotalPortInSetup} {incr ixiaPortId} {
        <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;exDevIxiaPortMap($ixiaPortId) $exDevIxiaPortMap($ixiaPortId)&#34;
   }

   for {set ixiaPortId 1} {$ixiaPortId &lt;= $ixiaTotalPortInSetup} {incr ixiaPortId} {
        <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;exDevPortMap($ixiaPortId) $exDevPortMap($ixiaPortId)&#34;
   }

   return 0
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: reserveIxiaPortResource</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Reserves all the ixia ports required for this setup</span>
<span class="comment-line">#              to run the given feature. It waits infinitely on</span>
<span class="comment-line">#              the resource until it is released by any other </span>
<span class="comment-line">#              setup sharing the same Ixia ports</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : 0 on success and -1 on Failure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [reserveIxiaPortResource]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::reserveIxiaPortResource_202">proc <a href="SetupShareLib.tcl-annot.html#::::reserveIxiaPortResource">::::reserveIxiaPortResource</a></a></strong> {} {

   global sharingDeviceType
   global L1DevLockFileLoc
   global setupName
   
<span class="comment-line"># --- If sharing device is not there, then just return free</span>
   if {![info exist sharingDeviceType]} {
      return free
   }
   set sharingDeviceType [string tolower $sharingDeviceType]

<span class="comment-line"># --- Lock the Ixia resource from others so that other processes wait until</span>
<span class="comment-line">#     the lock is released or the process ends</span>
   <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; Waiting for IXIA resource......&#34;
<span class="comment-line"># --- Cook Setup Name from ixia chasis card and Port Info</span>
   set cookFileName f$setupName
   set fileName &#34;$L1DevLockFileLoc$cookFileName&#34;

   set fd_res [<a name="::FileOpen(1)"><a href="./queueLib.tcl.html#::FileOpen_58">::FileOpen</a></a> &#34;$fileName&#34; &#34;w&#34; &#34;locking the resource&#34;]
   if {$fd_res == -1} {
      return $fd_res
   }
   chmod 0777 $fileName

<span class="comment-line"># --- If the setup uses MRV device, call eden tree APIs to reserve Ixia port</span>
   if {$sharingDeviceType == &#34;mrv&#34;} {
      set retVal [<a name="::edenTreeMakeReservation(1)"><a href="./SetupShareLib.tcl.html#::edenTreeMakeReservation_300">::edenTreeMakeReservation</a></a>]
   } elseif {($sharingDeviceType == &#34;extreme-eware&#34;) || ($sharingDeviceType == &#34;extreme-exos&#34;)} {
<span class="comment-line"># --- else if the setup uses extreme network device, call extreme networks</span>
<span class="comment-line">#     automation APIs to reserve Ixia port</span>
      set retVal [<a name="::extremeMakeReservation(1)"><a href="./SetupShareLib.tcl.html#::extremeMakeReservation_411">::extremeMakeReservation</a></a>]
   }
   
   if {$retVal == -1} {
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34; Could not aquire IXIA Resource. Exiting Resource \
                     Initialisation......&#34;
      return -1
   }

   <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; Aquired IXIA Resource. Proceeding for testing......&#34;
   return 0
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: freeIxiaPortResource</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Releases all the ixia ports used for this setup</span>
<span class="comment-line">#              to run the given feature.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: freeIxiaPortResource</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::freeIxiaPortResource_263">proc <a href="SetupShareLib.tcl-annot.html#::::freeIxiaPortResource">::::freeIxiaPortResource</a></a></strong> {} {

   global sharingDeviceType
   
<span class="comment-line"># --- If sharing device is not there, then just return free</span>
   if {![info exist sharingDeviceType]} {
      return
   }

<span class="comment-line"># --- If the setup uses MRV device, call eden tree APIs to reserve Ixia port</span>
   if {$sharingDeviceType == &#34;MRV&#34;} {
      <a name="::edenTreeFreeReservation(1)"><a href="./SetupShareLib.tcl.html#::edenTreeFreeReservation_377">::edenTreeFreeReservation</a></a>
   } elseif {($sharingDeviceType == &#34;Extreme-eware&#34;) || ($sharingDeviceType == &#34;Extreme-exos&#34;)} {
<span class="comment-line"># --- else if the setup uses extreme network device, call extreme networks</span>
<span class="comment-line">#     automation APIs to reserve Ixia port</span>
      <a name="::extremeFreeReservation(1)"><a href="./SetupShareLib.tcl.html#::extremeFreeReservation_482">::extremeFreeReservation</a></a>
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: edenTreeMakeReservation</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Reserves all the ixia ports used for this setup</span>
<span class="comment-line">#              to run the given feature. Used when MRV L1 Switch</span>
<span class="comment-line">#              is used to share the Ixia ports.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : 0 on success and -1 on Failure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [edenTreeMakeReservation]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::edenTreeMakeReservation_300">proc <a href="SetupShareLib.tcl-annot.html#::::edenTreeMakeReservation">::::edenTreeMakeReservation</a></a></strong> {} {

   global topology
   global defaultIxiaResvTime
   global edenTreeSrvLogin
   global edenTreeSrvPasswd
   global edenTreeSrv
   global topology
   global exDevIxiaPortMap
   global exDevPortMap
   global ixiaTotalPortInSetup

   
   if {(![info exist exDevIxiaPortMap]) || (![info exist ixiaTotalPortInSetup])} {
      <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Parse exDevIxiaPortMap and initialize ixiaTotalPortInSetup \
                   global variables&#34;
      return 0
   }

   set retVal [client_login $edenTreeSrvLogin $edenTreeSrvPasswd $edenTreeSrv]
   if {[regexp -nocase &#34;ERROR&#34; $retVal]} {
         <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;client_login fails. returns $retVal&#34;
         return -1
   }

   set printStat &#34;yes&#34;

   set res_id [make_new_reservation $topology 0 NOW NOW 12 {[0-9]*} -auton]

   if {![regexp -nocase &#34;ERROR&#34; $res_id]} {
       <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Aquiring IXIA resources.....&#34;
   } else {
<span class="comment-line"># --- Get which Topology is holding this Ixia Resource and delete the Topology</span>
<span class="comment-line">#     forcefully to get the IXIA resource</span>
       for {set ixiaPortId 1} {$ixiaPortId &lt;= $ixiaTotalPortInSetup} {incr ixiaPortId} {
          set retVal [parseConnectionString $exDevIxiaPortMap($ixiaPortId)]
          if {$retVal == -1} {
             return -1
           } 
          set retVal [parseConnectionString $exDevPortMap($ixiaPortId)]
          if {$retVal == -1} {
             return -1
          } 
       }

       <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Aquiring IXIA resources after deleting the reservation \
                     made by a non-existing or irrelevant process&#34;
       set res_id [make_new_reservation $topology 0 NOW NOW 12 {[0-9]*} -auton]
       <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;res id is $res_id&#34;

       if {[regexp -nocase &#34;ERROR&#34; $res_id]} {
           <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;EdenTree Server failed to reserve the resources&#34;
           return -1
       }
   }

   return 0
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: edenTreeFreeReservation</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Releases all the ixia ports used for this setup</span>
<span class="comment-line">#              to run the given feature. Used when MRV L1 Switch</span>
<span class="comment-line">#              is used to share the Ixia ports.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [edenTreeMakeReservation]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::edenTreeFreeReservation_377">proc <a href="SetupShareLib.tcl-annot.html#::::edenTreeFreeReservation">::::edenTreeFreeReservation</a></a></strong> {} {
   
<span class="comment-line"># --- If the reservation status is free, then only free the resource.</span>
<span class="comment-line">#     Or else assume that some one else in this process has reserved it </span>
<span class="comment-line">#     and he needs to free it</span>
   global edenTreeSrvLogin
   global edenTreeSrvPasswd
   global edenTreeSrv
   global topology

<span class="comment-line">#      client_login $edenTreeSrvLogin $edenTreeSrvPasswd $edenTreeSrv</span>
   delete_all_reservations $topology 0
   kick_off_user $edenTreeSrvLogin
   <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Deleting all Ixia resource Reservation&#34;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: extremeMakeReservation</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Reserves all the ixia ports used for this setup</span>
<span class="comment-line">#              to run the given feature. Used when Extreme Switch</span>
<span class="comment-line">#              is used to share the Ixia ports.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : 0 on success and -1 on Failure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [edenTreeMakeReservation]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::extremeMakeReservation_411">proc <a href="SetupShareLib.tcl-annot.html#::::extremeMakeReservation">::::extremeMakeReservation</a></a></strong> {} {

   global exDevVlanMap
   global exDevPortMap
   global exDevIxiaPortMap
   global setupSharingDevice
   global defaultIxiaResvTime
   global ixiaPortAlloc
   global ixiaTotalPortInSetup
   global sharingDeviceType
   global numDUT

   <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Trying to login to SharedSetup Device $setupSharingDevice&#34;
   set numDUT 1
   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $setupSharingDevice -CheckOperational 0

   <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure default delete port all&#34;
   <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ports all&#34;

   set availability [<a name="::getIxiaAvailability(1)"><a href="./SetupShareLib.tcl.html#::getIxiaAvailability_516">::getIxiaAvailability</a></a>]

   if {$availability == &#34;free&#34;} {

      for {set ixiaPortId 1} {$ixiaPortId &lt;= $ixiaTotalPortInSetup} {incr ixiaPortId} {
         if {$sharingDeviceType == &#34;extreme-eware&#34;} {
            <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $exDevVlanMap($ixiaPortId)&#34;
         } else {
            <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vman $exDevVlanMap($ixiaPortId)&#34;
         }
         <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure $exDevVlanMap($ixiaPortId) add port $exDevIxiaPortMap($ixiaPortId),$exDevPortMap($ixiaPortId)&#34;
         <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable igmp snooping $exDevVlanMap($ixiaPortId)&#34;
     <span class="comment-line"># SendACmd &#34;show vlan $exDevVlanMap($ixiaPortId)&#34;</span>
      }

   } else {
      for {set ixiaPortId 1} {$ixiaPortId &lt;= $ixiaTotalPortInSetup} {incr ixiaPortId} {
<span class="comment-line">#  --- Forcefully delete the vlans and take the Ixia ports</span>
         <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete $exDevVlanMap($ixiaPortId)&#34;
         if {$sharingDeviceType == &#34;extreme-eware&#34;} {
            <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $exDevVlanMap($ixiaPortId)&#34;
         } else {
            <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vman $exDevVlanMap($ixiaPortId)&#34;
         }
         <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure $exDevVlanMap($ixiaPortId) add port $exDevIxiaPortMap($ixiaPortId),$exDevPortMap($ixiaPortId)&#34;
         <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable igmp snooping $exDevVlanMap($ixiaPortId)&#34;
      }
   }

<span class="comment-line">#   SendACmd &#34;enable jumbo ports all&#34;</span>
<span class="comment-line">#   logout</span>
   return 0
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: extremeFreeReservation</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Releases all the ixia ports used for this setup</span>
<span class="comment-line">#              to run the given feature. Used when Extreme Switch</span>
<span class="comment-line">#              is used to share the Ixia ports.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [extremeFreeReservation]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::extremeFreeReservation_482">proc <a href="SetupShareLib.tcl-annot.html#::::extremeFreeReservation">::::extremeFreeReservation</a></a></strong> {} {
   global exDevVlanMap
   global exDevPortMap
   global exDevIxiaPortMap
   global setupSharingDevice
   global ixiaPortAlloc
   global ixiaTotalPortInSetup

   <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $setupSharingDevice -CheckOperational 0

   for {set ixiaPortId 1} {$ixiaPortId &lt;= $ixiaTotalPortInSetup} {incr ixiaPortId} {
      <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete $exDevVlanMap($ixiaPortId)&#34;
   }
   <a name="::logout(1)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getIxiaAvailability</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Gets the info to the caller whether some other </span>
<span class="comment-line">#              setup did not release the resorces and terminated.</span>
<span class="comment-line">#              Used when Extreme device is used to share the Ixia ports.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : free or success</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [getIxiaAvailability]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::getIxiaAvailability_516">proc <a href="SetupShareLib.tcl-annot.html#::::getIxiaAvailability">::::getIxiaAvailability</a></a></strong> {} {

   global shareDevPortMappingList
   global exDevVlanMap
   global exDevPortMap
   global setupSharingDevice
   global ixiaTotalPortInSetup
   global sharingDeviceType

   <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $setupSharingDevice -CheckOperational 0

   if {$sharingDeviceType == &#34;extreme-eware&#34;} {
      set tempStr [<a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show vlan&#34;]
   } else {
      set tempStr [<a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show vman&#34;]
   }

   for {set ixiaPortId 1} {$ixiaPortId &lt;= $ixiaTotalPortInSetup} {incr ixiaPortId} {
      if {[regexp -nocase $exDevVlanMap($ixiaPortId) $tempStr]} {
         return &#34;occupied&#34;
      }
   }

   return &#34;free&#34;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: generateExDevPortMapping</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Initialises the Port mapping arrays used in an </span>
<span class="comment-line">#              extreme device to share the Ixia resource between</span>
<span class="comment-line">#              different tesbed.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : 0 success -1 on failure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: set retVal [generateExDevPortMapping]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::generateExDevPortMapping_560">proc <a href="SetupShareLib.tcl-annot.html#::::generateExDevPortMapping">::::generateExDevPortMapping</a></a></strong> {} {
   global shareDevPortMappingList
   global exDevVlanMap
   global exDevPortMap
   global exDevIxiaPortMap
   global setupSharingDevice
   global ixiaCh1
   global setupName
   global startCardNum
   global ixiaTotalPortInSetup

   if {![info exist shareDevPortMappingList]} {
      return 0
   }

   set ixiaTotalPortInSetup [llength $shareDevPortMappingList]

<span class="comment-line"># --- Cook the Setup Name from Ixia chasis card and port Info</span>
   set ixiaStr [split $ixiaCh1 '.']
   set setupName [join $ixiaStr _]
   set ixiaStr [split $startCardNum ':']
   set ixiaStr [join $ixiaStr _]
   append setupName &#34;_&#34; $ixiaStr
   set setupName &#34;_$setupName&#34;
   <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ixia chasis is $ixiaCh1 Card is $startCardNum setupName is $setupName&#34;

   for {set i 0} {$i &lt; $ixiaTotalPortInSetup} {incr i} {
      set phyLinkList [lindex $shareDevPortMappingList $i]

      if {![info exist phyLinkList]} {
            <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ERROR: Link details for Ixia PortId, Sharing \
                          Switch and DUT does not exist&#34;
         return -1
      }

      set ixiaPortId [expr $i+1]
      set exDevIxiaPortMap($ixiaPortId) [lindex $phyLinkList 0]
      set exDevPortMap($ixiaPortId) [lindex $phyLinkList 1]

      set exDevVlanMap($ixiaPortId) &#34;v$ixiaPortId$setupName&#34;
      <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;exDevIxiaPortMap($ixiaPortId) $exDevIxiaPortMap($ixiaPortId)&#34;
      <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;exDevPortMap($ixiaPortId) $exDevPortMap($ixiaPortId)&#34;
      <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;exDevVlanMap($ixiaPortId) $exDevVlanMap($ixiaPortId)&#34;

   }
   return 0
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: exDevIxiaPortDisable</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Simulates disabling an ixia ports by disabling </span>
<span class="comment-line">#              appropriate link in the L1 switch to get the requied</span>
<span class="comment-line">#              link down on the DUT. Used only when Extreme device</span>
<span class="comment-line">#              is used to share the ixia ports between setups.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: portId - Ixia port id to be disabled</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: exDevIxiaPortDisable</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::exDevIxiaPortDisable_627">proc <a href="SetupShareLib.tcl-annot.html#::::exDevIxiaPortDisable">::::exDevIxiaPortDisable</a></a></strong> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exDevIxiaPortDisable $args {
      portId &#34;&#34;
   }
   
   global sharingDeviceType
   global setupSharingDevice
   global exDevPortMap
   global whichDutNow
   global DUT${whichDutNow}_CONNECT
   
   set ipAddr [set DUT${whichDutNow}_CONNECT]
   
   if {(![info exist sharingDeviceType]) || ($sharingDeviceType == &#34;MRV&#34;)} {
<span class="comment-line"># --- No need to act on the call, the link is transparent</span>
      return
   }

   <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $setupSharingDevice -CheckOperational 0

   <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable port $exDevPortMap($portId)&#34;;
   <a name="::logout(2)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>
   <a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $ipAddr -CheckOperational 0
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: exDevIxiaPortEnaable</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Simulates enabling an ixia ports by enabling </span>
<span class="comment-line">#              appropriate link in the L1 switch to get the requied</span>
<span class="comment-line">#              link up on the DUT. Used only when Extreme device</span>
<span class="comment-line">#              is used to share the ixia ports between setups.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: portId - Ixia port id to be disabled</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: exDevIxiaPortEnaable</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::exDevIxiaPortEnable_671">proc <a href="SetupShareLib.tcl-annot.html#::::exDevIxiaPortEnable">::::exDevIxiaPortEnable</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exDevIxiaPortEnable $args {
      portId &#34;&#34;
   }
   
   global sharingDeviceType
   global setupSharingDevice
   global exDevPortMap
   global whichDutNow
   global DUT${whichDutNow}_CONNECT
   
   set ipAddr [set DUT${whichDutNow}_CONNECT]
   
   if {(![info exist sharingDeviceType]) || ($sharingDeviceType == &#34;MRV&#34;)} {
<span class="comment-line"># --- No need to act on the call, the link is transparent</span>
      return
   }

   <a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $setupSharingDevice -CheckOperational 0

   <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable port $exDevPortMap($portId)&#34;;

   <a name="::logout(3)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>
   <a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $ipAddr -CheckOperational 0
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: exDevDutPortDisable</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Simulates disabling an ixia ports by disabling </span>
<span class="comment-line">#              appropriate link in the L1 switch to get the requied</span>
<span class="comment-line">#              link down on the ixia port. Used only when Extreme device</span>
<span class="comment-line">#              is used to share the ixia ports between setups.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: portId - Ixia port id for which the DUT port is </span>
<span class="comment-line">#                      brought down</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: exDevDutPortDisable</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::exDevDutPortDisable_717">proc <a href="SetupShareLib.tcl-annot.html#::::exDevDutPortDisable">::::exDevDutPortDisable</a></a></strong> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exDevIxiaPortDisable $args {
      portId &#34;&#34;
   }
   
   global sharingDeviceType
   global setupSharingDevice
   global exDevIxiaPortMap
   global whichDutNow;
   global DUT${whichDutNow}_CONNECT

   set ipAddr [set DUT${whichDutNow}_CONNECT]
   
   if {(![info exist sharingDeviceType]) || ($sharingDeviceType == &#34;MRV&#34;)} {
<span class="comment-line"># --- No need to act on the call, the link is transparent</span>
      return
   }

   <a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $setupSharingDevice -CheckOperational 0

   <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable port $exDevIxiaPortMap($portId)&#34;;
   <a name="::logout(4)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>
   <a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $ipAddr -CheckOperational 0
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: exDevDutPortEnable</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Simulates enabling an ixia ports by enabling </span>
<span class="comment-line">#              appropriate link in the L1 switch to get the requied</span>
<span class="comment-line">#              link up on the ixia port. Used only when Extreme device</span>
<span class="comment-line">#              is used to share the ixia ports between setups.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: portId - Ixia port id for which the DUT port is </span>
<span class="comment-line">#                      brought up</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: exDevDutPortEnable</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::exDevDutPortEnable_762">proc <a href="SetupShareLib.tcl-annot.html#::::exDevDutPortEnable">::::exDevDutPortEnable</a></a></strong> {args} {
   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exDevIxiaPortEnable $args {
      portId &#34;&#34;
   }
   
   global sharingDeviceType
   global setupSharingDevice
   global exDevIxiaPortMap
   global whichDutNow;
   global DUT${whichDutNow}_CONNECT

   set ipAddr [set DUT${whichDutNow}_CONNECT]
   
   if {(![info exist sharingDeviceType]) || ($sharingDeviceType == &#34;MRV&#34;)} {
<span class="comment-line"># --- No need to act on the call, the link is transparent</span>
      return
   }

   <a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $setupSharingDevice -CheckOperational 0

   <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable port $exDevIxiaPortMap($portId)&#34;;
   <a name="::logout(5)"><a href="./logout.tcl.html#::logout_21">::logout</a></a>
   <a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $ipAddr -CheckOperational 0
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
