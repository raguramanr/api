<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>misc.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#misc.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>misc.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="misc.tcl-annot.html">annotations</a> | <a href="misc.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#load {expect52.dll}</span>
set auto_path [linsert $auto_path 0 . ]

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cookString</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: String alternation</span>
<span class="comment-line">#              Change it to a list </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              line - string </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              string</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      return [cookString $line]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::cookString_22">proc <a href="misc.tcl-annot.html#::::cookString">::::cookString</a></a></strong> {line} {
   global spawn_id
   set finalString &#34;&#34;
   set emptyStr	&#34;&#34;
   set aList [split $line]
   set lineLength [llength $aList]
   set last [expr $lineLength-1]
   for {set i 0} {$i &lt; $lineLength} {incr i 1} {
      set element [lindex $aList $i]
	  if {$element != &#34;&#34;} {
	     switch $i {
		    $last { ;<span class="comment-line"># last element</span>
	            set finalString [append $emptyStr $element] }
			default {
	            set finalString [append $emptyStr $element &#34; &#34;] }
		 }
      }
   }
   return $finalString
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cookMacForIxia</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Mac String alternation</span>
<span class="comment-line">#              Replace mac string colons with spaces </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              line - mac string </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              mac string</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      return [cookMacForIxia $mac]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::cookMacForIxia_61">proc <a href="misc.tcl-annot.html#::::cookMacForIxia">::::cookMacForIxia</a></a></strong> {mac} {
   global spawn_id
   set cookedMac &#34;&#34;
   <span class="comment-line"># -- split the mac by colon</span>
   set aList [split $mac &#34;:&#34;]
   <span class="comment-line"># -- join by space</span>
   set cookedMac [join $aList &#34; &#34;]
   <span class="comment-line"># -- to upper case</span>
   set cookedMac [string toupper $cookedMac]
   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cookedMac=$cookedMac&#34;
   return $cookedMac
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IxiaMacFormat2FdbFormat</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Mac String alternation</span>
<span class="comment-line">#              Replace mac string colons with spaces and change it to lowercase </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              line - mac string </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              mac string</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      return [IxiaMacFormat2FdbFormat $mac]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::IxiaMacFormat2FdbFormat_92">proc <a href="misc.tcl-annot.html#::::IxiaMacFormat2FdbFormat">::::IxiaMacFormat2FdbFormat</a></a></strong> {mac} {
   regsub -all { } $mac {:} sourceMacFdb
   return [string tolower $sourceMacFdb]
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: eSplit</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: String alternation</span>
<span class="comment-line">#              Change it to a list </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              line - string </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              string</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      return [eSplit $line]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::eSplit_115">proc <a href="misc.tcl-annot.html#::::eSplit">::::eSplit</a></a></strong> {line} {
   set cookedLine [<a name="::cookString(1)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $line]
   set aList [split $cookedLine]
   return $aList
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetDUTName</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get DUTx based on DUTx_CONNECT </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              IP address </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              DUTx</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetDUTName $ip]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::GetDUTName_138">proc <a href="misc.tcl-annot.html#::::GetDUTName">::::GetDUTName</a></a></strong> {<a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a>} {
   set index 1
   global DUT${index}_CONNECT
   while { [info exists DUT${index}_CONNECT] } {
      set connect [set DUT${index}_CONNECT]
      if {$connect == $ip} { return &#34;DUT$index&#34;}
      incr index
      global DUT${index}_CONNECT
   }
   return &#34;UnknownDUT&#34;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: oldGetVersion</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get EW version on the DUT </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUTName </span>
<span class="comment-line">#              level </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return version</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetVersion &#34;DUT1&#34; 2]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>

<strong><a name="::::oldGetVersion_168">proc <a href="misc.tcl-annot.html#::::oldGetVersion">::::oldGetVersion</a></a></strong> {{DUTName &#34;DUT1&#34;} {level &#34;1&#34;} } {
global DUTs_info
if {$level == &#34;1&#34; } {
   <span class="comment-line"># -- return release and build number x.x.xbx</span>
   return $DUTs_info($DUTName,VERSION)
} elseif {$level == &#34;2&#34;} {
   <span class="comment-line"># -- return partly release number x.x</span>
   set x $DUTs_info($DUTName,version)
   set ver 0;
   set match 0;
   set flg [regexp -nocase {^([0-9]+.[0-9a-z]+).[0-9].*} $x match ver]
   if {$flg} {
      return $ver
   } else {
      return $match
   }
} elseif {$level == &#34;3&#34;} {
   <span class="comment-line"># -- return build number  </span>
   set x $DUTs_info($DUTName,version)
   set match 0;
   set build 0;
   set flg [regexp -nocase {^[0-9]+.[0-9a-z]+.[0-9]+[a-z]+([0-9]*)} $x match build]
   if {$flg} {
      return $build
   } else {
      return $match
   }
} elseif {$level == &#34;4&#34;} {
   <span class="comment-line"># -- return release number x.x.x</span>
   set x $DUTs_info($DUTName,version)
   set ver 0;
   set match 0;
   set flg [regexp -nocase {^([0-9]+.[0-9a-z]+.[0-9]+)[a-z]+} $x match ver]
   if {$flg} {
      return $ver
   } else {
      return $match
   }
}   

return $DUTs_info($DUTName,version)
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: VmanSupport </span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#              This API checks whether Vman can be run on the DUT. Default is DUT1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT1 or DUT2 or DUTx and portnumber</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      VmanSupport DUT1 [GetTrunkPort x x x ]</span>
<span class="comment-line">#       VmanSupport   (Default is DUT and GetATrunkport 1 2 1)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>


<strong><a name="::::VmanSupport_230">proc <a href="misc.tcl-annot.html#::::VmanSupport">::::VmanSupport</a></a></strong> {{DUT &#34;DUT1&#34;} {trunkport &#34;&#34;}} {
global [set DUT]_CONNECT
global bd8kChassis
global queensBlade
global napaBlade
global  aspenBlade
upvar time1 time1
upvar time2 time2
upvar testNo testNo

set plat [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> [set DUT]]
if { [regexp -nocase $bd8kChassis| $plat] } {
   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set [set DUT]_CONNECT]
   set port &#34;&#34;
   set parameterlist &#34;&#34;
   if { $trunkport == &#34;&#34; } {
      set trunkport [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1]
   }
   set port $trunkport
   set port [split $port :]
   set slot [lindex $port 0]
   lappend parameterlist &#34;Slot-$slot 1&#34;
   set blade [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show slot&#34; $parameterlist]
   puts &#34;The blade that is used : $blade&#34;
   if { [regexp -nocase &#34;$queensBlade|$napaBlade|$aspenBlade&#34; $blade&#34;] } {
      result_skip &#34;Skipping this testcase as Broadcom XGs3 platforms don't support VMAN operations&#34;
      set time2 [clock seconds];
      result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
      <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
      <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return -code return 0
   }
}

}



<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetVersion</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get version on the DUT </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#             DUTName   DUTx</span>
<span class="comment-line">#              option    takes the following values:</span>
<span class="comment-line">#                     1|whole     return whole version number</span>
<span class="comment-line">#                     2|majmin    return major.minor  number</span>
<span class="comment-line">#                     3|build     return build number</span>
<span class="comment-line">#                     4|release   return major.minor,patch number</span>
<span class="comment-line">#                     major       return major number</span>
<span class="comment-line">#                     minor       return minor number</span>
<span class="comment-line">#                     sustain     return sustaining number</span>
<span class="comment-line">#              e.g. if DUT version is 10.2.0.16 or 10.2.0b16 the following</span>
<span class="comment-line">#                   options returns different values</span>
<span class="comment-line">#                      option       return</span>
<span class="comment-line">#                    -----------   --------</span>
<span class="comment-line">#                     1 or whole    10.2.0.16 or 10.2.0b16 </span>
<span class="comment-line">#                     2 or majmin   10.2</span>
<span class="comment-line">#                     3 or build    16</span>
<span class="comment-line">#                     4 or release  10.2.0</span>
<span class="comment-line">#                     major         10</span>
<span class="comment-line">#                     minor          2 </span>
<span class="comment-line">#                     sustain        0 </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#             none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetVersion &#34;DUT1&#34; whole]</span>
<span class="comment-line">#             [GetVersion &#34;DUT1&#34; major]</span>
<span class="comment-line">#             [GetVersion &#34;DUT1&#34; build]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::GetVersion_303">proc <a href="misc.tcl-annot.html#::::GetVersion">::::GetVersion</a></a></strong> {{DUTName &#34;DUT1&#34;} {option 1} } {
   global DUTs_info whichDutNow

   if {![info exists DUTs_info($DUTName,version)]} {
      error \
         &#34;GetVersion: DUTs_info($DUTName,version) is not set.&#34;
   } elseif {$DUTs_info($DUTName,version) == &#34;INVALID&#34;} {
      global ${DUTName}_CONNECT
      <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
      set verList &#34;&#34;
      lappend verList &#34;{XOS version} 1&#34;
      set xos_version [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show version&#34; $verList]
      if {![regexp &#34;KEY_NOT_FOUND&#34; $xos_version]} {
         set DUTs_info($DUTName,version) $xos_version
      } else {
         <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> \
            &#34;GetVersion: DUTs_info($DUTName,version) is not set. Making it up&#34;
         set DUTs_info($DUTName,version) &#34;24.1.1.1&#34;
      }
   }
   <span class="comment-line">#puts  &#34;version $DUTs_info($DUTName,version)&#34;</span>
   if ![regexp {([0-9]+)\.([0-9]+)\.([0-9]+)[\.b]([0-9]+)} \
      $DUTs_info($DUTName,version)  match \
      major minor patch build] {  
      error \
         &#34;GetVersion: $DUTs_info($DUTName,version) not in good format.&#34;
      return &#34;error&#34;
   }
   switch $option {
      whole -
      1 {
         return $DUTs_info($DUTName,version)
      }  
      majmin -
      2 {
         return &#34;$major.$minor&#34;
      }
      build -
      3 {
        return $build
      }
      release -
      4 {
        return &#34;$major.$minor.$patch&#34;  
      }
      major {
        return $major
      }
      minor {
        return $minor
      }
      patch {
        return $patch
      }
      default {
         return $DUTs_info($DUTName,version)
      }  
   }
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetDUTMac</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get DUT Mac </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUTName </span>
<span class="comment-line">#              delimiter </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return dut mac</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetDUTMac &#34;DUT1&#34; &#34;:&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetDUTMac_380">proc <a href="misc.tcl-annot.html#::::GetDUTMac">::::GetDUTMac</a></a></strong> {{DUTName &#34;DUT1&#34;} {delim &#34;:&#34;}} {
global DUTs_info
set mac $DUTs_info($DUTName,sysMAC)
regsub -all {:} $mac $delim mac
return $mac
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetPortIdMac</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get Port ID Mac </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId  </span>
<span class="comment-line">#              delimiter </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return port mac</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetPortIdMac $portId &#34;:&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetPortIdMac_405">proc <a href="misc.tcl-annot.html#::::GetPortIdMac">::::GetPortIdMac</a></a></strong> {portId {delim &#34; &#34;} } {
global TrafficGen
if {$TrafficGen != &#34;ept&#34;} {
set portId [expr $portId - 1 ]
set card [expr $portId / 4 + 1 ]
set port [expr $portId % 4 + 1 ]
set cardNum [expr 160 + $card] 
set cardNumInHex [format %X $cardNum]
set mac &#34;00 $cardNumInHex F$port 00 00 01&#34;
regsub -all { } $mac $delim mac
return $mac
} else {
<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port
set mac [list 00 A1 F1 00 00 01 ]
set p1 [ expr 0x[ lindex $mac 0 ] ]
set p2 [ expr 0x[ lindex $mac 1 ] ]
set p3 [ expr 0x[ lindex $mac 2 ] ]
set p4 [ expr 0x[ lindex $mac 3 ] ]
set p5 [ expr 0x[ lindex $mac 4 ] ]
set p6 [ expr 0x[ lindex $mac 5 ] ]
if { [ expr $port % 15 ] == 0 } {
    set p2in [ expr (($port / 15) - 1 ) + $p2 ]
    set p3in 255
   } else {
      set p2in [ expr ($port / 15) + $p2]
      set p3in [ expr (($port % 15) - 1 ) + $p3 ]
   }
set mac [format &#34;%02X %02X %02X %02X %02X %02X&#34; $p1 $p2in $p3in $p4 $p5 $p6 ]
regsub -all { } $mac $delim mac
return $mac
}
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetSysType</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the show switch system type</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT name   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return sysType</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetSysType $dutname]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetSysType_453">proc <a href="misc.tcl-annot.html#::::GetSysType">::::GetSysType</a></a></strong> {{DUTName &#34;DUT1&#34;}} {
   global DUTs_info
   if {[info exists DUTs_info($DUTName,sysType)]} {
      return $DUTs_info($DUTName,sysType)
   } else {
      return &#34;unknown&#34;
   }
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetPlatform</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get platform </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT name   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return platform</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetPlatform $dutname]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetPlatform_478">proc <a href="misc.tcl-annot.html#::::GetPlatform">::::GetPlatform</a></a></strong> {{DUTName &#34;DUT1&#34;}} {
    global DUTs_info CFG_PLATFORM

    set dut &#34;null&#34;;
    catch {regexp {DUT([0-9]+)} $DUTName line dut} oops
    if {$dut == &#34;null&#34;} {
        <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;Called GetPlatform incorrectly.  Arg should be DUT# not just the #&#34;
	set dut 1
    }
    if {[info exists CFG_PLATFORM($dut)] &amp;&amp; $CFG_PLATFORM($dut) != &#34;null&#34;} {
        set DUTs_info($DUTName,platform) $CFG_PLATFORM($dut)
        return $CFG_PLATFORM($dut)
    } elseif {[info exists DUTs_info($DUTName,platform)]} {
        return $DUTs_info($DUTName,platform)
    } else {
        return &#34;unknown&#34;
    }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetSystemType</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Get the platform from show switch </span>
<span class="comment-line">#      instead of from sysName.  Similar to GetPlatform</span>
<span class="comment-line">#      but not dependent on DUTs_info</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT number  ie 1 | 2 | 3 | 4 | 5</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              return platform</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             [GetSystemType $dutname]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetSystemType_513">proc  <a href="misc.tcl-annot.html#::::GetSystemType">::::GetSystemType</a></a></strong> {{num &#34;1&#34;}} {
   global DUTs_info CFG_PLATFORM
   set returnValue &#34;unknown&#34;

   if {[info exists DUTs_info(DUT${num},platform)] &amp;&amp; $DUTs_info(DUT${num},platform) != &#34;INVALID&#34;} {
      return $DUTs_info(DUT${num},platform)
   } elseif {[info exists CFG_PLATFORM($num)] &amp;&amp; $CFG_PLATFORM($num) != &#34;null&#34;} {
      set DUTs_info(DUT${num},platform) $CFG_PLATFORM($num)
      <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SystemType bypassed.  Setting platform to vpex&#34;
      return $CFG_PLATFORM($num)
   } else {
      global DUT${num}_CONNECT;
      <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${num}_CONNECT] -CheckOperational 0 -masterCheck 0 ;
      set param &#34;&#34;
      lappend  param &#34;{System Type:} 0&#34;
      set pSystemType [<a name="::GetKeyValue(3)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show switch&#34; $param 0 1]
      <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;pSystemType is $pSystemType&#34;
      if {[regexp -nocase &#34;Stack&#34; [lindex $pSystemType 0]]} {
          set returnValue  &#34;Stack&#34;
      } else {
        set returnValue  [lindex [lindex $pSystemType 0]  2]
        <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SystemType is $returnValue&#34;
      }
      if {$returnValue != &#34;&#34;} {
          return $returnValue
      } else {
          return &#34;unknown&#34;
      }
   }
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetHardwareType</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get hardware information </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT name   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return hardware type</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetHardwareType $dutname]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetHardwareType_560">proc <a href="misc.tcl-annot.html#::::GetHardwareType">::::GetHardwareType</a></a></strong> {{DUTName &#34;DUT1&#34;}} {
global DUTs_info
return $DUTs_info($DUTName,HardwareType)
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetRelMaster</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get EW information - release master </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT name   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return release master information</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetRelMaster $dutname]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetRelMaster_582">proc <a href="misc.tcl-annot.html#::::GetRelMaster">::::GetRelMaster</a></a></strong> {{DUTName &#34;DUT1&#34;}} {
global DUTs_info
return  $DUTs_info($DUTName,relMaster)
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetMulticastMac</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Change Multicast IP to mac  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              Mutlicast IP </span>
<span class="comment-line">#              delimiter   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return mac address</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetMulticastMac $IP $delimiter]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetMulticastMac_605">proc <a href="misc.tcl-annot.html#::::GetMulticastMac">::::GetMulticastMac</a></a></strong> {multicastIp {delim &#34; &#34;}} {

   set ip1 0
   set ip2 0
   set ip3 0
   set ip4 0
   
   scan $multicastIp {%d.%d.%d.%d} ip1 ip2 ip3 ip4
   set macAddr &#34;01${delim}00${delim}5E${delim}[format %02X $ip2]${delim}[format %02X $ip3]${delim}[format %02X $ip4]&#34;
   <span class="comment-line">#puts &#34;Mac: |$macAddr| for ip: $multicastIp&#34;</span>
   return $macAddr

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetSysName</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get sysName </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT name   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return sysName</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [GetSysName $dutname]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetSysName_636">proc <a href="misc.tcl-annot.html#::::GetSysName">::::GetSysName</a></a></strong> {{DUTName &#34;DUT1&#34;}} {
   global DUTs_info
   if {[info exists DUTs_info($DUTName,sysName)]} {
      return $DUTs_info($DUTName,sysName)
   } else {
      return &#34;unknown&#34;
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: EnableLink</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Enable port link - like disconect/reconnect a cable  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              Port list </span>
<span class="comment-line">#              dut name   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [EnableLink $portIdList $DUTName]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::EnableLink_662">proc <a href="misc.tcl-annot.html#::::EnableLink">::::EnableLink</a></a></strong> {portIdList DUTName} {
   global ${DUTName}_CONNECT;
   global DUTs_info;

   global spawn_id
   set pid _[pid]
   <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];
   set result 1
   foreach portId $portIdList {
       set fd_in [open &#34;Tmp/tmp_EnableLink$pid&#34; &#34;w&#34;]
       <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable port $portId&#34; NULL $fd_in
       close $fd_in
       set fd_in [open &#34;Tmp/tmp_EnableLink$pid&#34; &#34;r&#34;]
       set rtValue [<a name="::check_illegality(1)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
       close $fd_in
       if { $rtValue == &#34;illegal&#34; } {
 	  set result 0
       }
       sleep 5
   }
   return $result
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: DisableLink</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Disable port link - like disconect/reconnect a cable  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              Port list </span>
<span class="comment-line">#              dut name   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [DisableLink $portIdList $DUTName]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::DisableLink_703">proc <a href="misc.tcl-annot.html#::::DisableLink">::::DisableLink</a></a></strong> {portIdList DUTName} {
   global ${DUTName}_CONNECT;
   global DUTs_info;

   global spawn_id
   set pid _[pid]
   <a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];
   set result 1
   foreach portId $portIdList {
       set fd_in [open &#34;Tmp/tmp_DisableLink$pid&#34; &#34;w&#34;]
       <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable port $portId&#34; NULL $fd_in
       close $fd_in
       set fd_in [open &#34;Tmp/tmp_DisableLink$pid&#34; &#34;r&#34;]
       set rtValue [<a name="::check_illegality(2)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
       close $fd_in
       if { $rtValue == &#34;illegal&#34; } {
 	  set result 0
       }
       sleep 3
   }
   return $result
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: EnableDutPort</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Wrap command to send enable port x and wait for port(s) to come</span>
<span class="comment-line">#              up</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: port(s)</span>
<span class="comment-line">#             dut name</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             [EnableDutPort $port $DUTName]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::EnableDutPort_743">proc <a href="misc.tcl-annot.html#::::EnableDutPort">::::EnableDutPort</a></a></strong> {portList DUTName {waitActive 1}} {
    global ${DUTName}_CONNECT;
    global DUTs_info;

    <a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];

    set dutPortList &#34;&#34;

    foreach port $portList {

        <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable port $port&#34;;

        if {($port != &#34;mgmt&#34;) &amp;&amp; ($port != &#34;all&#34;)} {
            lappend parameterList &#34;{.*$port.*active} exist&#34;
            set dutPortList &#34;$dutPortList $port,&#34;
        }
    }

    if {$waitActive == 1} {
        ;<span class="comment-line"># After all ports are enabled, wait until they go active before returning</span>

        if {$dutPortList != &#34;&#34;} {
            ;<span class="comment-line"># Strip trailing comma</span>
            set dutPortList [string trimright $dutPortList ,]
            <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show port $dutPortList info&#34; $parameterList \
                    -time {s: 0 i: 1 d: 10 f: 10} \
                    -reportResults 0
        }
    }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: DisableDutPort</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Wrap command to send disable port x.</span>
<span class="comment-line">#              up</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: port(s)</span>
<span class="comment-line">#             dut name</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             [DisableDutPort $port $DUTName]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::DisableDutPort_791">proc <a href="misc.tcl-annot.html#::::DisableDutPort">::::DisableDutPort</a></a></strong> {portList DUTName} {
    global ${DUTName}_CONNECT;
    global DUTs_info;

    <a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];

    foreach port $portList {
        <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable port $port&#34;;
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CompareVersion</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Compare the version with the version on the dut  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              version </span>
<span class="comment-line">#              dut name   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [CompareVersion $version $DUTName]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::CompareVersion_820">proc <a href="misc.tcl-annot.html#::::CompareVersion">::::CompareVersion</a></a></strong> {<a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> {DUTName &#34;DUT1&#34;}} {

    global DUTs_info;  
                
    <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CompareVersion build($version) and SW($DUTs_info($DUTName,version))&#34;
    set vn [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> $DUTName 4];
    set bn [<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> $DUTName 3];      
    set flag [regexp -nocase {^(.*)b(.*)} $version vs vn1 bn1];
    if {$flag} {
        <span class="comment-line"># -- compare release and build number</span>
        if {$vn1 &gt; $vn} {
            return 1;
        } elseif {$vn1 &lt; $vn} {
            return -1;
        } else {
          <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Build bld($bn1) sw($bn)&#34;;
          if {$bn1 &gt; $bn} {
              return 1;
          } elseif {$bn1 &lt; $bn} {
              return -1;
          } else {
              return 0;
          }
        }    
    } else {
        <span class="comment-line"># ---- compare only release number</span>
        set sw_fullversion $vn;
        set lng [string length $version];
        if {$lng &gt;= [string length $sw_fullversion]} {
            set sw_shortversion $sw_fullversion;
        } else {
            set sw_shortversion [string range $sw_fullversion 0 [expr $lng-1]];   
        }     
        
        if {($version == &#34;6.2e&#34;) &amp;&amp; ($sw_shortversion != &#34;6.2e&#34;)} {
            <span class="comment-line"># to prevent s24lc code</span>
            return 1;
        } elseif {$version &gt; $sw_shortversion} {
            return 1;
        } elseif {$version &lt; $sw_shortversion} {
            return -1;
        } else {
            return 0;
        }        
    }
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CompareRelease</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Compare two version strings. return 1 if first version</span>
<span class="comment-line">#              is greater. Return -1 if second version is greater</span>
<span class="comment-line">#              Return 0 if they are the same</span>
<span class="comment-line">#              Also do partial matching e.g.</span>
<span class="comment-line">#              version1  version2  return </span>
<span class="comment-line">#              --------  -------- -------</span>
<span class="comment-line">#              10.2      10.2.1     0</span>
<span class="comment-line">#              10.2.3b6  10.2.3     0</span>
<span class="comment-line">#              10.3      10.4.1     -1</span>
<span class="comment-line">#              7.3.40b3  7.3.40b2   1  </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              version1 in the format of x.x.x.x or x.x.xbx</span>
<span class="comment-line">#              version2 in the format of x.x.x.x or x.x.xbx</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [CompareRelease $version $version2]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CompareRelease_891">proc <a href="misc.tcl-annot.html#::::CompareRelease">::::CompareRelease</a></a></strong> {version1 version2} {
   <span class="comment-line">#puts &#34;comparing release $version1 and $version2&#34;</span>
   set v1 $version1
   set v2 $version2
   while { [string length $v1] &gt; 0 &amp;&amp; [string length $v2] &gt; 0} {
      <span class="comment-line"># extract the first token from the version strings</span>
      <span class="comment-line"># it can be a number or the . or b characters</span>
      if ![regexp {^[0-9]+|^[\.b]} $v1 token1 ] {
         error &#34;CompareRelease: illegal characters in version1: $version1.&#34;
         return &#34;error&#34;
      }
      if ![regexp {^[0-9]+|^[\.b]} $v2 token2 ] {
         error &#34;CompareRelease: illegal characters in version2: $version2.&#34;
         return &#34;error&#34;
      }
      <span class="comment-line"># remove the first tokens from version strings</span>
      regsub {^[0-9]+|^[\.b]} $v1 &#34;&#34; v1
      regsub {^[0-9]+|^[\.b]} $v2 &#34;&#34; v2
      <span class="comment-line">#puts &#34;token1 is $token1&#34;</span>
      <span class="comment-line">#puts &#34;token2 is $token2&#34;</span>
      <span class="comment-line">#puts &#34;v1 becomes $v1&#34;</span>
      <span class="comment-line">#puts &#34;v2 becomes $v2&#34;</span>
      <span class="comment-line">#if the token is . or b both tokens has to match otherwise</span>
      <span class="comment-line">#it's some kind of different format in the strings</span>
      if { [regexp {[\.b]} $token1] &amp;&amp; $token1 != $token2 } { 
         error &#34;CompareRelease: format mismatch in $version1 and $version2&#34;
         return &#34;error&#34;
      } 
      <span class="comment-line">#compare the numeric tokens</span>
      if {$token1 &gt; $token2 } {
         return 1
      }
      if {$token1 &lt; $token2 } {
         return -1
      }
      <span class="comment-line">#if matches loop to the next token </span>
   }
   <span class="comment-line">#if we get here that means both version strings matches entirely or</span>
   <span class="comment-line">#one of the version strings matches till the end e.g. 10.2 matches 10.2.0.6</span>
   return 0
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: DBug</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: for variable debug printing  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              level </span>
<span class="comment-line">#              command 1</span>
<span class="comment-line">#              command 2   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [DBug $lvl $cmd1 $cmd2]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::DBug_951">proc <a href="misc.tcl-annot.html#::::DBug">::::DBug</a></a></strong> { {lvl &#34;0&#34;}  {cmd1 &#34;0&#34;} {cmd2 &#34;0&#34;} } {
    <span class="comment-line"># dBuglevel meant to be a multiTest level trigger</span>
    global DUT

    if {[info exist DUT(bug)]} {
    
         if { ($lvl &lt;= $DUT(bug)) } {
                 puts &#34;**************************************************************************&#34;
                 puts &#34;***********-- $cmd1 --************&#34;
                 puts &#34;**************************************************************************&#34;
         }
         if { ($lvl == &#34;2&#34;) &amp;&amp; ($DUT(bug) == &#34;2&#34;) } {
             puts &#34;Press z then enter to continue&#34;
             gets stdin z
         }
         if { ($lvl == &#34;10&#34;) &amp;&amp; ($DUT(bug) == &#34;10&#34;) } {
             <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$cmd2&#34;
             
         }
    }
}

<span class="comment-line">################################################################################</span>
<span class="comment-line"># VerifyKeyValue</span>
<span class="comment-line">#</span>
<span class="comment-line">#     Find out if a value is in a buffer or not</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Examples:</span>
<span class="comment-line">#     VerifyKeyValue 1 &#34;show vlan&#34; 0 &#34;mgmt&#34;             </span>
<span class="comment-line">#        mgmt is in the output of 'show vlan' on DUT1</span>
<span class="comment-line">#     VerifyKeyValue 2 &#34;show vlan&#34; 0 &#34;mgmt -key 4094&#34;</span>
<span class="comment-line">#        mgmt is in the buffer, on the same line a '4094' on DUT2</span>
<span class="comment-line">#     VerifyKeyValue 1 &#34;show vlan&#34; 0 &#34;vlan12 -exist 0&#34;</span>
<span class="comment-line">#        vlan12 is not in the output of show vlan</span>
<span class="comment-line">#     VerifyKeyValue 1 &#34;show vlan&#34; 0 &#34;ANY -exist 5&#34;</span>
<span class="comment-line">#        the word ANY appears 5 times in the output</span>
<span class="comment-line">#     VerifyKeyValue 1 &#34;show vlan&#34; 0 &#34;vlan12 -key vlan9 -line 3&#34;</span>
<span class="comment-line">#        the word vlan12 is in buffer, three lines after 'vlan9' appears</span>
<span class="comment-line">#     VerifyKeyValue 1 &#34;show vlan&#34; {s: 1 i: 5 d: 20 f: 20} &#34;sue&#34;</span>
<span class="comment-line">#        see if the word 'sue' is in output.</span>
<span class="comment-line">#        wait 1 second before looking</span>
<span class="comment-line">#        if it is not there keep looking every 5 seconds until</span>
<span class="comment-line">#        20 seconds.  If not there in 20seconds, we fail.</span>
<span class="comment-line">#</span>
<span class="comment-line">#     Added ckcase parm... DEFAULT WE ARE CASE SENSITIVE, if you pass</span>
<span class="comment-line">#     -ckcase n   we will not be case sensitive. </span>
<span class="comment-line">#</span>
<span class="comment-line">#     Also changed key/val to work if there are multiple lines with key and</span>
<span class="comment-line">#     the key/val match is not on the first line key exists</span>
<span class="comment-line">#</span>
<span class="comment-line">################################################################################</span>
<strong><a name="::::VerifyKeyValue_1002">proc <a href="misc.tcl-annot.html#::::VerifyKeyValue">::::VerifyKeyValue</a></a></strong> {dut cmd time args} {

   <span class="comment-line"># if we have a time sensitive Verify, get the time information</span>
   <span class="comment-line"># -time {s: 10 i: 5 d: 20 f:50}</span>
   if {$time != &#34;0&#34;} {
      set sTime [lindex $time 1] ; <span class="comment-line"># time to initally wait before starting</span>
      set iTime [lindex $time 3] ; <span class="comment-line"># interval time to wait between checks</span>
      set dTime [lindex $time 5] ; <span class="comment-line"># expected time that we should pass</span>
      set fTime [lindex $time 7] ; <span class="comment-line"># max time we wait before failing the test</span>
      sleep $sTime
   } else {
      set sTime 2; set iTime 1; set dTime 1; set fTime 1; 
   }

   set done      0
   set ttime     $sTime
   set checkList [lindex $args 0] ; <span class="comment-line"># do this cause we have {{}}</span>
   set checkNum  [llength $checkList]

   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Verify &lt;$cmd&gt;&#34;

   while {!$done} {
      set DUTName [format %s%d DUT $dut]
      global ${DUTName}_CONNECT;
      <a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];
      set buf [<a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> $cmd]

      set numFail 0
      set myline &#34;##############################&#34;

      result_p &#34;\n$myline $myline&#34;
      result_p &#34;$myline $myline&#34;
      result_p &#34;SENDACMD &lt;$dut&gt; = $cmd\n$myline $myline&#34;
      result_p $buf
      result_p &#34;$myline $myline&#34;
      result_p &#34;$myline $myline\n&#34;

      for {set i 1} {$i &lt;= $checkNum} {incr i} {
         set check   [lindex $checkList [expr $i - 1]]
         set val     [lindex $check 0]
         set valArgs [lrange $check 1 &#34;end&#34;]
         <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> Verify $valArgs {
            exist   1
            key     NULL
            line    NULL
            comment &#34;&#34;
            ckcase  &#34;y&#34;
         }
         <span class="comment-line"># check to see if the buffer has the value </span>
         set inBuf [<a name="::CheckBufHaveValue(1)"><a href="./misc.tcl.html#::CheckBufHaveValue_1142">::CheckBufHaveValue</a></a> $buf $val $key $line $ckcase]

         <span class="comment-line"># if inBuf == exist, we got as many hits as we thought we would</span>
         if {$inBuf == $exist} {
            <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> [format &#34;%-20s pass&#34; $val]
            <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Verify passed: time=$ttime val=&lt;$val&gt; key=$key line=$line exist=$exist&#34;
         } else {
            incr numFail
            if {$ttime &gt; $fTime} {
               <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> [format &#34;%-20s fail&#34; $val]
               <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Verify fail: time=$ttime val=&lt;$val&gt; key=$key line=$line exist=$exist\($inBuf\)&#34; 
            }
         }
      }

      <span class="comment-line"># we want to end the testing if</span>
      <span class="comment-line"># 1) no failures</span>
      <span class="comment-line"># 2) we were not timing this test</span>
      <span class="comment-line"># 3) we exceeded the max time allowed</span>
      <span class="comment-line"># otherwise, we want to increment the time</span>
      if {($numFail == &#34;0&#34;) || ($time == &#34;0&#34;) || ($ttime &gt; $fTime)} {
          set done 1
      } else {
         <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;sleeping for $iTime secs...&#34;      
         <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Verify sleep: time= $ttime out of $fTime seconds&#34;
         sleep $iTime
         set ttime [expr $ttime + $iTime]
      }
   }

   <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $ttime
}

<span class="comment-line">################################################################################</span>
<span class="comment-line"># VerifyTraffic</span>
<span class="comment-line">#</span>
<span class="comment-line">#  This takes are arguement a list from IxFramesSent, and sees that </span>
<span class="comment-line">#  bidirection traffic got to the destination.  If we recieve more than send,</span>
<span class="comment-line">#  we assume pass, since probably igmp snoop or something.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Ex.     VerifyTraffic [IxFramesSent $ixport1 $ixport2]</span>
<span class="comment-line">#  </span>
<span class="comment-line">################################################################################</span>
<strong><a name="::::VerifyTraffic_1095">proc <a href="misc.tcl-annot.html#::::VerifyTraffic">::::VerifyTraffic</a></a></strong> {traffic {comment &#34;&#34;}} {
   
   set sentx [lindex $traffic 0]
   set recx  [lindex $traffic 1]
   set senty [lindex $traffic 2]
   set recy  [lindex $traffic 3]

   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;VerifyTraffic $comment&#34;

   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;VerifyTraffic X-&gt;Y&#34;
   if {$recy &gt;= ($sentx -10)} {
      <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;VerifyTraffic passed: SentX=$sentx RecY=$recy&#34;
   } else {
      <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;VerifyTraffic failed: SentX=$sentx RecY=$recy&#34;
   }
   <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

   <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;VerifyTraffic Y-&gt;X&#34;
   if {$recx &gt;= ($senty -10)} {
      <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;VerifyTraffic passed: SentY=$senty RecX=$recx&#34;
   } else {
      <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;VerifyTraffic failed: SentY=$senty RecX=$recx&#34;
   }
   <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
 
   <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}

<span class="comment-line">###############################################################################</span>
<span class="comment-line"># CheckBufHaveValue</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Finds out if val is in buf, based on a key or line parameter.</span>
<span class="comment-line">#   See Verify for more description</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Change so we check can toggle case sensitivity...</span>
<span class="comment-line">#   Changed so if we have a scenario like</span>
<span class="comment-line">#</span>
<span class="comment-line">#   &#34;a b c&#34;</span>
<span class="comment-line">#   &#34;x b c&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line">#   CheckBufHaveValue $buf x b </span>
<span class="comment-line">#</span>
<span class="comment-line">#   This will work. Before, it would find the first key hit, then see if the</span>
<span class="comment-line">#   val in on the line.  Now, it finds all lines the key is on, and returns</span>
<span class="comment-line">#   the number of times val is on key</span>
<span class="comment-line">#</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::CheckBufHaveValue_1142">proc <a href="misc.tcl-annot.html#::::CheckBufHaveValue">::::CheckBufHaveValue</a></a></strong> {buf val key line ckcase} {

   set buf       [<a name="::MakeList(1)"><a href="./misc.tcl.html#::MakeList_1660">::MakeList</a></a> $buf]
   set buflen    [llength $buf]
   set numFound  0

   <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;&gt;&gt;&gt;val=$val key=$key line=$line ckcase=$ckcase&#34;

   <span class="comment-line"># if key is NULL, we want to just find the number of times we see val</span>
   <span class="comment-line"># and return it</span>
   if {$key == &#34;NULL&#34;} {
         set indx 0
         set done 0
         while {!$done} {
            set linenum [<a name="::CheckBuf_FindValLine(1)"><a href="./misc.tcl.html#::CheckBuf_FindValLine_1215">::CheckBuf_FindValLine</a></a> $buf $val $indx $ckcase]
            if {$linenum != -1} {
               set indx [expr $linenum + 1]
               incr numFound
            } else {
               set done 1
            }
         }
   } else {

      <span class="comment-line"># we have a key, find all the linenumbers the key is on</span>
      set done 0
      set indx 0
      set keylinefoundlist &#34;&#34;
      while {!$done} {

         set linenum [<a name="::CheckBuf_FindValLine(2)"><a href="./misc.tcl.html#::CheckBuf_FindValLine_1215">::CheckBuf_FindValLine</a></a> $buf $key $indx $ckcase]
         if {$linenum != -1} {
            lappend keylinefoundlist $linenum
            set indx [expr $linenum + 1]
         } else {
            set done 1
         }
      }

      foreach linenum $keylinefoundlist {
         <span class="comment-line"># if we pass line, then search 'line' lines after the line key </span>
         <span class="comment-line"># was found on.  Otherwise, find the val on the key line.</span>
         if {$line == &#34;NULL&#34;} {
            set linebuf [lindex $buf $linenum]
         } else {
            set linebuf [lindex $buf [expr $linenum + $line]]
         }
         if {$ckcase != &#34;y&#34;} {
            set found   [regexp -nocase -indices $val $linebuf matchedRange]
         } else {
            set found   [regexp -indices $val $linebuf matchedRange]
         }
         if {$found} {
            incr numFound
         }
      }
   }
   return $numFound
}

<span class="comment-line">###############################################################################</span>
<span class="comment-line"># CheckBuf_FindValLine</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Finds out if 'val' is in 'buf', and returns the line number val is found on</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  buf - buffer you are looking in, must be a list  (use MakeList)</span>
<span class="comment-line">#  val - regexp value of what you are looking for</span>
<span class="comment-line">#  linenum - starting line you are looking in buf for the val</span>
<span class="comment-line">#</span>
<span class="comment-line">#  returns: line number of first occurance of a match, -1 if no match</span>
<span class="comment-line">#  added change so we can toggle case sensitivity</span>
<span class="comment-line">#</span>
<span class="comment-line">##############################################################################</span>
<strong><a name="::::CheckBuf_FindValLine_1215">proc <a href="misc.tcl-annot.html#::::CheckBuf_FindValLine">::::CheckBuf_FindValLine</a></a></strong> {buf val linenum ckcase} {

   for {} {$linenum &lt; [llength $buf]} {incr linenum} {
      set line    [lindex $buf $linenum]

      <span class="comment-line"># found is 1 if we find our val in line</span>
      <span class="comment-line"># regexp will be case insensitive, and store the beginning and ending</span>
      <span class="comment-line"># column of the match in matchedRange</span>
      if {$ckcase != &#34;y&#34;} {
         set found   [regexp -nocase -indices $val $line matchedRange]
      } else {
         set found   [regexp -indices $val $line matchedRange]
      }
      if {$found} {
         return $linenum 
      }
   }
   return -1
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendDUT</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Send a command to one or many DUT(s).</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              num - one or all</span>
<span class="comment-line">#              cmd - command   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none or output buffer</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [SendDUT &#34;all&#34; &#34;show switch&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">##############################################################################</span>
<span class="comment-line">##############################################################################</span>
<span class="comment-line">##############################################################################</span>
<strong><a name="::::SendDUT_1255">proc <a href="misc.tcl-annot.html#::::SendDUT">::::SendDUT</a></a></strong> {num cmd} {
   global spawn_id DUT

   <span class="comment-line">#trying not to use InitLoginDUT</span>
   if {$num == &#34;all&#34;} {
      foreach dut $DUT(list) {
         set     DUTName [format %s%d DUT $dut]
         global ${DUTName}_CONNECT;
         <a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [set ${DUTName}_CONNECT];
         <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> $cmd
      }
   } else {
      set     DUTName [format %s%d DUT $num]
      global ${DUTName}_CONNECT;
      <a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [set ${DUTName}_CONNECT];
      return [<a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> $cmd]
   }

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyNum</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#   Runs a pass/fail test on wether the number passed</span>
<span class="comment-line">#   passed in is in the min/max range.  If so, test passes.  If </span>
<span class="comment-line">#   not, the test fails.  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     num       - the value you are testing</span>
<span class="comment-line">#   minVal      - the minimum accepted pass value</span>
<span class="comment-line">#   maxVal      - the maximum accepted pass value</span>
<span class="comment-line">#   description - optional - custom text to output test case</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">#    lappend parameterList &#34;11.100.100.4 1&#34;</span>
<span class="comment-line">#    set num [GetKeyValue &#34;sh mpls vpls detail&#34; $parameterList]     </span>
<span class="comment-line">#    # we expect num to be 1000, give or take a few.</span>
<span class="comment-line">#    VerifyNum $num 900 1100 &#34;VPLS counter stats&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyNum_1302">proc <a href="misc.tcl-annot.html#::::VerifyNum">::::VerifyNum</a></a></strong> {num minVal maxVal {description &#34;&#34;}} {
   <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;VerifyNum $description&#34;
   if {$num &gt;= $minVal &amp;&amp; $num &lt;= $maxVal} {
      <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;VerifyNum $description passed: $minVal &gt;= $num &lt;= $maxVal&#34;
   } else {
      <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;VerifyNum $description failed: !  $minVal &gt;= $num &lt;= $maxVal&#34;
   }
   <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}




<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: BeginTest</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Build the test case detail report header</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              testNo </span>
<span class="comment-line">#              title   </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: test case  file handle</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [BeginTest &#34;2.1.1&#34; &#34;BGP CLI&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">##############################################################################</span>
<span class="comment-line">##############################################################################</span>
<span class="comment-line">##############################################################################</span>
<strong><a name="::::BeginTest_1335">proc <a href="misc.tcl-annot.html#::::BeginTest">::::BeginTest</a></a></strong> {testNo title} {
   global DUT
   set DUT(fd_res)       [<a name="::open_result_file(1)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;$testNo&#34;]
   set DUT(mystartTime)  [clock seconds]
   set DUT(testNo)       $testNo
   set DUT(title)        $title

   result_h1         &#34;$DUT(module) $testNo $title&#34;
   <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$DUT(module) $testNo $title&#34;
   return $DUT(fd_res)
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: EndTest</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Build the test case detail report end</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              none    </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             EndTest</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">##############################################################################</span>
<span class="comment-line">##############################################################################</span>
<span class="comment-line">##############################################################################</span>
<strong><a name="::::EndTest_1366">proc <a href="misc.tcl-annot.html#::::EndTest">::::EndTest</a></a></strong> {} {
   global DUT

   set t  [clock seconds]
   set fd_res $DUT(fd_res)

   result_p &#34;*** Time for $DUT(testNo) = [expr $t-$DUT(mystartTime)] secs\n\n&#34;
   <a name="::close_result_file(2)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a> 
   <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a> ; 
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VLAN_Create_Group</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: on one or many DUTs, create one or many L2/L3 vlans </span>
<span class="comment-line">#              with port, tag number, and ip address.</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT</span>
<span class="comment-line">#              vlan name</span>
<span class="comment-line">#              start</span>
<span class="comment-line">#              end </span>
<span class="comment-line">#              port</span>
<span class="comment-line">#              tag number</span>
<span class="comment-line">#              ip address</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [VLAN_Create &#34;all&#34; &#34;vlan1&#34; 1 10 &#34;2:1&#34; &#34;100&#34; &#34;10.10.10.1&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">###############################################################################</span>
<strong><a name="::::VLAN_Create_Group_1401">proc <a href="misc.tcl-annot.html#::::VLAN_Create_Group">::::VLAN_Create_Group</a></a></strong> {dut name s e p tag ip {mask 24}} {
   for {set i $s} {$i &lt;=$e} {incr i} {
      <a name="::VLAN_Create(1)"><a href="./misc.tcl.html#::VLAN_Create_1431">::VLAN_Create</a></a> $dut [format &#34;%s%s&#34; $name $i] $p $tag $ip $mask
      if {$ip != &#34;-&#34; } { set ip [<a name="::IncrIpAddr(1)"><a href="./misc.tcl.html#::IncrIpAddr_1523">::IncrIpAddr</a></a> $ip $mask]  }
      if {$tag != &#34;-&#34;} { incr tag }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VLAN_Create</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: create one L2/L3 vlans with port, tag number, and ip address on</span>
<span class="comment-line">#              one or many DUTs</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT</span>
<span class="comment-line">#              vlan name</span>
<span class="comment-line">#              port</span>
<span class="comment-line">#              tag number</span>
<span class="comment-line">#              ip address</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [VLAN_Create &#34;all&#34; &#34;vlan1&#34; &#34;2:1&#34; &#34;100&#34; &#34;10.10.10.1&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">###############################################################################</span>
<strong><a name="::::VLAN_Create_1431">proc <a href="misc.tcl-annot.html#::::VLAN_Create">::::VLAN_Create</a></a></strong> {dut name p tag ip {mask 24}} {

   <a name="::SendDUT(1)"><a href="./misc.tcl.html#::SendDUT_1255">::SendDUT</a></a> $dut &#34;cre vlan $name&#34;
   if {$tag != &#34;-&#34; } {
         <a name="::SendDUT(2)"><a href="./misc.tcl.html#::SendDUT_1255">::SendDUT</a></a> $dut &#34;config $name tag $tag&#34;
         <a name="::SendDUT(3)"><a href="./misc.tcl.html#::SendDUT_1255">::SendDUT</a></a> $dut &#34;config $name add port $p tag&#34;
   } else {
         <a name="::SendDUT(4)"><a href="./misc.tcl.html#::SendDUT_1255">::SendDUT</a></a> $dut &#34;config $name add port $p&#34;
   }
   if {$ip != &#34;-&#34; } {
         <a name="::SendDUT(5)"><a href="./misc.tcl.html#::SendDUT_1255">::SendDUT</a></a> $dut &#34;config $name ipa $ip/$mask&#34;
  }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VLAN_Delete_Group </span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Delete vlan(s) from one or many DUTs</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUT</span>
<span class="comment-line">#              vlan name</span>
<span class="comment-line">#              start</span>
<span class="comment-line">#              end</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             [VLAN_Delete_Group &#34;all&#34; &#34;vlan&#34; 1 10]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">###############################################################################</span>
<strong><a name="::::VLAN_Delete_Group_1465">proc <a href="misc.tcl-annot.html#::::VLAN_Delete_Group">::::VLAN_Delete_Group</a></a></strong> {dut name s e} {
   for {set i $s} {$i &lt;=$e} {incr i} {
      <a name="::SendDUT(6)"><a href="./misc.tcl.html#::SendDUT_1255">::SendDUT</a></a> $dut &#34;del vlan [format &#34;%s%s&#34; $name $i]&#34;
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: PortInVlan</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Get the port number from any vlan</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              none    </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             PortInVlan d v </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">################################################################################</span>
<strong><a name="::::PortInVlan_1488">proc <a href="misc.tcl-annot.html#::::PortInVlan">::::PortInVlan</a></a></strong> {d v {ixia &#34;NULL&#34;}} {

   global DUT

   foreach vlan $DUT($d,vlans) {
      set name [lindex $vlan 0]
      set ip   [lindex $vlan 1]
      set port [lindex $vlan 2]

      switch $name {
         &#34;ixia1&#34; {   set port [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a>  [expr ($d * 2 - 1)] $d]   } 
         &#34;ixia2&#34; {   set port [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a>  [expr $d * 2] $d]         } 
         default {   set port [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> [string index $port 0] [string index $port 1] [string index $port 2]]  }
      }      

      if {$name == $v} {
         if {$ixia != &#34;NULL&#34;} {
            <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> [lindex $vlan 5] c s p
            return [list $c $s $p]
         } else {
            return $port
         }
      }
   }
   return ERROR
}


<span class="comment-line">################################################################################</span>
<span class="comment-line"># IncrIpAddr - increase any section of the ip address</span>
<span class="comment-line">#</span>
<span class="comment-line">#    Ex.  IncrIpAddr 1.1.1.1    ;  ---- 1.1.1.2</span>
<span class="comment-line">#    Ex.  IncrIpAddr 1.1.1.1 24 ;  ---- 1.1.2.1</span>
<span class="comment-line">#</span>
<span class="comment-line">################################################################################</span>
<strong><a name="::::IncrIpAddr_1523">proc <a href="misc.tcl-annot.html#::::IncrIpAddr">::::IncrIpAddr</a></a></strong> {<a name="::ip(2)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> {mask &#34;none&#34;}} {
      regsub -all \\. $ip &#34; &#34; ip

      set ip1 [lindex $ip 0]
      set ip2 [lindex $ip 1]
      set ip3 [lindex $ip 2]
      set ip4 [lindex $ip 3]

      
      <span class="comment-line">#could have done switch.... got lazy</span>
      if {$mask == 24} {         set ip4 254      }
      if {$mask == 16} {         set ip3 254      }
      if {$mask == 8}  {         set ip2 254      }

      if {$ip4 == 254} {
         set ip4 1
         if {$ip3 == 254} {
            set ip3 1
            if {$ip2 == 254} {
               set ip2 1
               incr ip1
            } else {
               incr ip2
            }
         } else {
            incr ip3  
         }
      } else {
         incr ip4
      }
   set ip &#34;$ip1 $ip2 $ip3 $ip4&#34;
   regsub -all &#34; &#34; $ip \. ip
   return $ip
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IncrIPv4Route</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Increment the network portion of an IPv4 route.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#       IP address</span>
<span class="comment-line">#       subnet mask</span>
<span class="comment-line">#       {value to increment, default 1}</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#       IP address</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#       set new_ip [IncrIPv4Route 20.0.0.0 24];</span>
<span class="comment-line">#       # new_ip will now be 20.0.1.0.</span>
<span class="comment-line">#</span>
<span class="comment-line">#       set new_ip [IncrIPv4Route 20.0.0.1 28];</span>
<span class="comment-line">#       # new_ip will now be 20.0.0.17.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::IncrIPv4Route_1583">proc <a href="misc.tcl-annot.html#::::IncrIPv4Route">::::IncrIPv4Route</a></a></strong> {<a name="::ip(3)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> mask {value 1}} {
    <span class="comment-line"># Range-check the arguments.</span>
    if {![<a name="::IsValidIpAddress(1)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $ip]} {
        error &#34;IncrIPv4Route: Invalid format for IPv4 address $ip.&#34;;
    }
    if {![<a name="::IsInteger(1)"><a href="./misc.tcl.html#::IsInteger_2157">::IsInteger</a></a> $mask] || $mask &lt; 1 || $mask &gt; 32} {
        error &#34;IncrIPv4Route: Invalid format for subnet mask $mask.&#34;;
    }
    if {![<a name="::IsInteger(2)"><a href="./misc.tcl.html#::IsInteger_2157">::IsInteger</a></a> $value]} {
        error &#34;IncrIPv4Route: Invalid format for increment value $value.&#34;;
    }

    <span class="comment-line"># Turn the IP address into a list.</span>
    set ip [split $ip .];

    <span class="comment-line"># First, figure out how many bytes amd bits are in the network portion.</span>
    <span class="comment-line"># and initialize the pointer.</span>
    set byte_to_incr [expr $mask / 8];
    set subnet_bits [expr $mask % 8];

    <span class="comment-line"># If network mask falls on a byte boundary, do some adjustments.</span>
    if {$subnet_bits == 0} {
        set subnet_bits 8;
        incr byte_to_incr -1;
    }

    <span class="comment-line"># Adjust the increment value so it only touches the network portion.</span>
    set incr_value [expr $value &lt;&lt; (8 - $subnet_bits)];

    <span class="comment-line"># Get the lowest order network byte and increment it.</span>
    set byte [lindex $ip $byte_to_incr];
    incr byte $incr_value;

    <span class="comment-line"># If we overflowed or underflowed the byte, carry the excess up into the</span>
    <span class="comment-line"># next bytes.</span>
    while {$byte &gt; 255 || $byte &lt; 0} {
        <span class="comment-line"># Drop off the lower byte of the increment value as it's already been</span>
        <span class="comment-line"># used.</span>
        set incr_value [expr $byte &gt;&gt; 8];
        
        <span class="comment-line"># Then trim down the byte to be byte-size.</span>
        set byte [expr $byte &amp; 0xFF];
        
        <span class="comment-line"># Check if we're working on the highest-order byte.</span>
        if {$byte_to_incr &gt; 0} {
            <span class="comment-line"># If not, then put the new value in place and then set the</span>
            <span class="comment-line"># pointer to the next higher-order byte.</span>
            set ip [lreplace $ip $byte_to_incr $byte_to_incr $byte];
            incr byte_to_incr -1;
        } else {
            <span class="comment-line"># If so, then get out of the loop.</span>
            break;
        }
    
        <span class="comment-line"># We still need to process, so get the next high-order byte and</span>
        <span class="comment-line"># increment it.</span>
        set byte [lindex $ip $byte_to_incr];
        incr byte $incr_value;
    }

    <span class="comment-line"># Either we stopped overflowing or underflowing, or we reached the</span>
    <span class="comment-line"># highest-order byte.  In either case, put the new value back into the</span>
    <span class="comment-line"># list.</span>
    set ip [lreplace $ip $byte_to_incr $byte_to_incr $byte];

    <span class="comment-line"># Then turn the list back into an IP address and return it.</span>
    return [join $ip .];
}; <span class="comment-line"># IncrIPv4Route</span>
<span class="comment-line">################################################################################</span>
<span class="comment-line"># MakeList</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Takes the output from a SendDUT, or any other buffer, and makes a list </span>
<span class="comment-line">#  out of the buffer.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return:  a list of buf</span>
<span class="comment-line">#</span>
<span class="comment-line">################################################################################</span>
<strong><a name="::::MakeList_1660">proc <a href="misc.tcl-annot.html#::::MakeList">::::MakeList</a></a></strong> {buf} {
   set   infile   [open &#34;makelist.tmp&#34;  &#34;w&#34;]
   puts  $infile  $buf
   close $infile
   set infile     [open &#34;makelist.tmp&#34; &#34;r&#34;]
    while {[gets $infile line] != -1} {
      if {$line != {}} {
         lappend buflist $line
      }
   }
   close $infile
   return $buflist
}


<span class="comment-line">###############################################################################</span>
<span class="comment-line"># MyGets title [func]</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Prints the title to the screen, and pauses for a user to hit return.</span>
<span class="comment-line">#   Can use this proc to put pauses in scripts during developement to check</span>
<span class="comment-line">#   the status of things during a test.</span>
<span class="comment-line">#</span>
<span class="comment-line">#   The global variable DUT(MyGets) set to 0 will cause this proc to do </span>
<span class="comment-line">#   nothing.  You would want to set it to 0 not hit these pauses.</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Basically, this is a debug tool that allows you to pause your script.</span>
<span class="comment-line">#   You can turn all these pauses on/off by toggling one global.</span>
<span class="comment-line">#</span>
<span class="comment-line">#   The optional parameter funcs can also be passed in.  This is a proc</span>
<span class="comment-line">#   you pass in to be executed.</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Examples:</span>
<span class="comment-line">#     MyGets &#34;Pausing here before deleteing vlan&#34;</span>
<span class="comment-line">#     MyGets &#34;Pause after deleteing vlan&#34; &#34;SendACmd $cmd&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Limitations:</span>
<span class="comment-line">#      You cannot pass &#34; &#34; in the func parameter</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::MyGets_1698">proc <a href="misc.tcl-annot.html#::::MyGets">::::MyGets</a></a></strong> {title {func &#34;NULL&#34;}} {
   global DUT

   if {$DUT(MyGets)} {
      puts -nonewline &#34;$title: &#34;
      if {$func != &#34;NULL&#34;} {
         set rc [eval $func]
         puts &#34;MyGets:  Ran proc $func, rc = $rc&#34;
      }  
      gets stdin z
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: sortedPorts</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#   Sorts a given list of ports, supports : specific ports as well.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     portList  - List of ports to be sorted</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">#   set DUT2TrunkPortList [sortedPorts $DUT2TrunkPortList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::sortedPorts_1729">proc <a href="misc.tcl-annot.html#::::sortedPorts">::::sortedPorts</a></a></strong> {portList} {
   if {[regexp -nocase &#34;:&#34; $portList]} {
      set pList &#34;&#34;
      set portsList &#34;&#34;
      foreach po $portList {
         regsub -all {([0-9]+):([0-9]+)} $po {format %03d:%03d \1 \2} p
         lappend pList [eval $p]
      }
      set poList [lsort -increasing $pList]
      foreach po $poList {
         regsub -all {([0-9]+):([0-9]+)} $po {format %d:%d [string trimleft \1 0] [string trimleft \2 0]} p
         lappend portsList [eval $p]
      }
      return $portsList
   } else {
      return &#34;[lsort -integer $portList]&#34;
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: sortedPortsIndex</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#   Sorts a given list of ports, supports : specific ports as well.</span>
<span class="comment-line">#   It returns a index list</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     portList  - List of ports to be sorted</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">#   set indexList [sortedPortsIndex $DUT2TrunkPortList]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::sortedPortsIndex_1767">proc <a href="misc.tcl-annot.html#::::sortedPortsIndex">::::sortedPortsIndex</a></a></strong> {portList} {
   if {[regexp -nocase &#34;:&#34; $portList]} {
      set pList &#34;&#34;
      set portsList &#34;&#34;
      foreach po $portList {
         regsub -all {([0-9]+):([0-9]+)} $po {format %03d:%03d \1 \2} p
         lappend pList [eval $p]
      }
      set poList [lsort -increasing $pList]
      foreach po $poList {
         regsub -all {([0-9]+):([0-9]+)} $po {format %d:%d [string trimleft \1 0] [string trimleft \2 0]} p
         lappend portsList [eval $p]
      }
      set sortedList $portsList
   } else {
      set sortedList [lsort -integer $portList]
   }
   set indexList &#34;&#34;
   foreach port $portList {
      lappend indexList [lsearch -exact $sortedList $port]
   }
   <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;portList = $portList, indexList = $indexList&#34;;
   return $indexList
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetSlotNumType</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#   Returns the blade type when a port is passed in</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     port</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">#   set hardware [GetSlotNumType $dut 1:47]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:  setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetSlotNumType_1810">proc <a href="misc.tcl-annot.html#::::GetSlotNumType">::::GetSlotNumType</a></a></strong> { dut port } {
    global DUTs_Slot_info
    global DUTs_info
   
<span class="comment-line">#    result_debug &#34;slot info is $DUTs_info(DUT$dut,hwList)&#34;</span>
    set hwtype &#34;INVALID&#34;
    set j [split $port :]
    if {[info exists DUTs_Slot_info(DUT$dut,slot[lindex $j 0],hwModType)]} {
       set hwtype $DUTs_Slot_info(DUT$dut,slot[lindex $j 0],hwModType)
    }
    return $hwtype
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetSlotType</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#   Returns the blade type when a port is passed in</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     port</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">#   set hardware [GetSlotType $dut 1:47]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:  setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetSlotType_1841">proc <a href="misc.tcl-annot.html#::::GetSlotType">::::GetSlotType</a></a></strong> { dut port {slotNum &#34;&#34;}} {

    if {$slotNum == &#34;&#34;} {
       regexp &#34;(.*)(:.*)&#34; $port res0 slot
    } else {
       set slot $slotNum
    }

    set hwtype &#34;INVALID&#34;

    if {[info exists slot]} {
       <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Slot : $slot&#34;
       if {([regexp -nocase &#34;BD-12804&#34; [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$dut]]) &amp;&amp; ($slot &gt; 4)} {
          set slot [expr $slot - 2]
          <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;New slot : $slot&#34;
       }
       return [<a name="::::DutSlotType(1)"><a href="./swConf.tcl.html#::::DutSlotType_1509">::::DutSlotType</a></a> $dut $slot]
    } else {
       return $hwtype
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetPortType</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#   Returns the port type when a port is passed in</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     dutNumber port</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#     porttype</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">#   set port [GetATrunkPort 1 2]</span>
<span class="comment-line">#</span>
<span class="comment-line">#   set portType [GetPortType $dutNumber $port]</span>
<span class="comment-line">#   if {$portType == &#34;T1&#34;} {</span>
<span class="comment-line">#      setupPPPvlan $dutNumber $portType $port $vlanName $vlanTag</span>
<span class="comment-line">#   }</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:  setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetPortType_1886">proc <a href="misc.tcl-annot.html#::::GetPortType">::::GetPortType</a></a></strong> { dutNumber port } {
    global DUTs_info
    set porttype &#34;INVALID&#34;

    if {![info exists DUTs_info(DUT${dutNumber},$port)]} {
       <a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT${dutNumber},connect)
       <span class="comment-line">#Find 1st word to the right of &#34;Type:&#34;</span>
       lappend parameterList &#34;Type: 1&#34;
       set porttype [<a name="::GetKeyValue(4)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show port $port info detail&#34; $parameterList]
       set DUTs_info(DUT${dutNumber},$port) $porttype
    } else {
       set porttype $DUTs_info(DUT${dutNumber},$port)
    }
    return $porttype
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: setupPPPvlan</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#     Puts a T1/E1/T3 PPP link into a tagged vlan and enables the PPP port</span>
<span class="comment-line">#</span>
<span class="comment-line">#     A PPP port cannot be added to a vlan unless the vlan is tagged</span>
<span class="comment-line">#     A PPP port cannot be enabled unless it is in a vlan</span>
<span class="comment-line">#</span>
<span class="comment-line">#     to work, the companion DUT must also have it's PPP configuration</span>
<span class="comment-line">#     setup properly.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     dut porttype port vlanName vlanTag</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#   </span>
<span class="comment-line">#      #Should have the vlan created and configured with a tag before calling</span>
<span class="comment-line">#      SendACmd &#34;create vlan $vlanName&#34;</span>
<span class="comment-line">#      SendACmd &#34;configure vlan $vlanName tag $vlanTag&#34;</span>
<span class="comment-line">#      ...</span>
<span class="comment-line">#      set port [GetATrunkPort 1 2 1]</span>
<span class="comment-line">#      set portType [GetPortType $dutNumber $port]</span>
<span class="comment-line">#;      if {$portType == &#34;E1&#34; or &#34;T1&#34; or &#34;T3&#34;} {</span>
<span class="comment-line">#         setupPPPvlan $dutNumber $portType $port $vlanName $vlanTag</span>
<span class="comment-line">#;      }</span>
<span class="comment-line">#      #Don't forget to enable the port</span>
<span class="comment-line">#      SendACmd &#34;enable port $port&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:  setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::setupPPPvlan_1935">proc <a href="misc.tcl-annot.html#::::setupPPPvlan">::::setupPPPvlan</a></a></strong> { dutNumber porttype port vlanName vlanTag} {
    global DUTs_info

    <a name="::Login(12)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT${dutNumber},connect)
    if {[<a name="::IsWAN(1)"><a href="./misc.tcl.html#::IsWAN_1967">::IsWAN</a></a> $porttype]} {
        <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan $vlanName add port $port tagged&#34;
        <span class="comment-line">#SendACmd &#34;enable port $port&#34;</span>
    } else {
        <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupPPPvlan: the port passed into function is not a PPP port&#34;
    }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: IsWAN</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: Check if the specified value is a WAN port.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              Port Type</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              None.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#              1 if the input is true.</span>
<span class="comment-line">#              0 if the input is false.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      if {[IsWAN [GetPorttype $dutNumber [GetATrunkPort 1 2 1]]} ...</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::IsWAN_1967">proc <a href="misc.tcl-annot.html#::::IsWAN">::::IsWAN</a></a></strong> {valueToCheck} {
    if {[regexp {T1|E1|T3} $valueToCheck]} {
        return 1;
    } else {
        return 0;
    }
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: AlienWan</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#   Add components for non ethernet wans.</span>
<span class="comment-line">#    1)  Sleep 20 seconds for BCP on pos</span>
<span class="comment-line">#    2)  Add a L2 PVC for ATM</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     vlan on 1st DUT</span>
<span class="comment-line">#     vlan on 2nd DUT           </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">#   AlienWan default default</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:  setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::AlienWan_1996">proc <a href="misc.tcl-annot.html#::::AlienWan">::::AlienWan</a></a></strong> {} {
    global DUT
    global DUT1_CONNECT
    global DUT2_CONNECT
    global DUT3_CONNECT
    global DUT4_CONNECT
    global DUT5_CONNECT
    
    if {[info exists DUT(trunk,usageList)]} {
       foreach trunkSide $DUT(trunk,usageList) {
            set sideWeAreOn [lindex $trunkSide 0]
            set indexVPI  [lindex $trunkSide 2]
            set portToAdd [lindex $trunkSide 3]
            set hdWareType [lindex $trunkSide 4]
            <span class="comment-line"># puts &#34;###### hdWareType  = $hdWareType &#34;</span>
            if {([string tolower $hdWareType] == &#34;p3ci&#34;) || ([string tolower $hdWareType] == &#34;p12ci&#34;)} {
                
            } elseif {([string tolower $hdWareType] == &#34;a3ci&#34;)} {
                <span class="comment-line"># -- If it is an ATM connection we need to add an L2 PVC</span>
                <a name="::Login(13)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${sideWeAreOn}_CONNECT]
                set theVlan [<a name="::GetVlanOfPort(1)"><a href="./misc.tcl.html#::GetVlanOfPort_2097">::GetVlanOfPort</a></a> $portToAdd]
                <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ATM port!! Add the L2 PVC&#34;
                <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf atm add pvc ${indexVPI} / 100 encap L2 vlan $theVlan port $portToAdd&#34;
            }
       }
       if {([string tolower $hdWareType] == &#34;a3ci&#34;)} {
           <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleeping while ATM PVC settles&#34;
           sleep 10
       }
       if {([string tolower $hdWareType] == &#34;p3ci&#34;) || ([string tolower $hdWareType] == &#34;p12ci&#34;)} {
           <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleeping while POS BCP comes UP&#34;
           sleep 25 ;<span class="comment-line"># If it is a pos link just sleep for 25 seconds</span>
       }
    }
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: AlienWanClean</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#   Clean up non ethernet wan ports</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#              </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">#   AlienWan default default</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:  setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::AlienWanClean_2047">proc <a href="misc.tcl-annot.html#::::AlienWanClean">::::AlienWanClean</a></a></strong> {} {
    global DUT
    global DUT1_CONNECT
    global DUT2_CONNECT
    global DUT3_CONNECT
    global DUT4_CONNECT
    global DUT5_CONNECT

    
        if {[info exists DUT(trunk,usageList)]} {
           foreach trunkSide $DUT(trunk,usageList) {
                set sideWeAreOn [lindex $trunkSide 0]
                set indexVPI  [lindex $trunkSide 2]
                set portToAdd [lindex $trunkSide 3]
                set hdWareType [lindex $trunkSide 4]


            if {([string tolower $hdWareType] == &#34;p3ci&#34;) || ([string tolower $hdWareType] == &#34;p12ci&#34;)} {
                <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;POS No Clean up&#34;
                
            } elseif {([string tolower $hdWareType] == &#34;a3ci&#34;)} {
                <span class="comment-line"># -- If it is an ATM connection we need to delete pvcs</span>
                <a name="::Login(14)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${sideWeAreOn}_CONNECT]
                <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ATM port!! Delete all PVCs&#34;
                <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;conf atm del pvc all port all&#34;
            }
           }
        }
      unset DUT(trunk,usageList)
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetVlanOfPort</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#   Get the first vlan that a port is in</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     port number           </span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#     return vlan name         </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line">#   GetVlanOfPort 1:1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:  setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetVlanOfPort_2097">proc <a href="misc.tcl-annot.html#::::GetVlanOfPort">::::GetVlanOfPort</a></a></strong> {inPort} {

    lappend vlanKey &#34;{VLAN cfg:} 0 1&#34;
    set vlan [<a name="::GetKeyValue(5)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show port $inPort info det&#34; $vlanKey]
    return $vlan
    
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IsValidIpAddress</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Check for correct IP address </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              IP address </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#      0 if argument is not a valid IP address</span>
<span class="comment-line">#      1 if argument is a valid IP address</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      return [IsValidIpAddress $ipAddr]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::IsValidIpAddress_2124">proc <a href="misc.tcl-annot.html#::::IsValidIpAddress">::::IsValidIpAddress</a></a></strong> {ipAddress} {
    if {[regexp {^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$} $ipAddress]} {
        foreach byte [split $ipAddress .] {
            if {($byte &lt; 0) || ($byte &gt; 255)} {
                return 0;
            }
        }
        return 1;
    } else {
        return 0;
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IsInteger</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Check if the specified value is an integer number.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              A string value.</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              None.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#              1 if the input is an integer.</span>
<span class="comment-line">#              0 otherwise.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      if {[IsInteger $number]}...</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::IsInteger_2157">proc <a href="misc.tcl-annot.html#::::IsInteger">::::IsInteger</a></a></strong> {valueToCheck} {
    if {[regexp {^[+-]?[0-9]+$} $valueToCheck]} {
        return 1;
    } else {
        return 0;
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IsTrue</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Check if the specified value is logically true.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              An integer number or a string.</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              None.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#              1 if the input is true.</span>
<span class="comment-line">#              0 if the input is false.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      if {[IsTrue $feature]}...</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::IsTrue_2185">proc <a href="misc.tcl-annot.html#::::IsTrue">::::IsTrue</a></a></strong> {valueToCheck} {
    if {([<a name="::IsInteger(3)"><a href="./misc.tcl.html#::IsInteger_2157">::IsInteger</a></a> $valueToCheck] &amp;&amp; $valueToCheck != 0) ||
        [regexp {^[tT]} $valueToCheck]} {
        return 1;
    } else {
        return 0;
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IsFalse</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Check if the specified value is logically false.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              An integer number or a string.</span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              None.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#              1 if the input is false.</span>
<span class="comment-line">#              0 if the input is true.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      if {[IsFalse $feature]}...</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">################################################################## </span>
<strong><a name="::::IsFalse_2214">proc <a href="misc.tcl-annot.html#::::IsFalse">::::IsFalse</a></a></strong> {valueToCheck} {
    if {([<a name="::IsInteger(4)"><a href="./misc.tcl.html#::IsInteger_2157">::IsInteger</a></a> $valueToCheck] &amp;&amp; $valueToCheck == 0) ||
        [regexp {^[fF]} $valueToCheck]} {
        return 1;
    } else {
        return 0;
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckRxErrorMonitor   </span>
<span class="comment-line"># Description:  Verify packets are greater or less than specified</span>
<span class="comment-line">#               numbers for each of 7 rxError categories</span>
<span class="comment-line"># Input args: port checkList fd_res testNo</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      lappend checkRxErrorList &#34;RxCRC 1000 minPacket&#34;</span>
<span class="comment-line">#      lappend checkRxErrorList &#34;RxOver 1000 minPacket&#34;</span>
<span class="comment-line">#      lappend checkRxErrorList &#34;RxFrag 1000 minPacket&#34;</span>
<span class="comment-line">#      lappend checkRxErrorList &#34;RxLost 1000 minPacket&#34;</span>
<span class="comment-line">#      CheckRxErrorMonitor [MapDUTPortId 1 1] $checkRxErrorList $filePt $testFileName      </span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckRxErrorMonitor_2237">proc <a href="misc.tcl-annot.html#::::CheckRxErrorMonitor">::::CheckRxErrorMonitor</a></a></strong> {<a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> checkList fd_res testNo} {

    set rxErrors { {LinkStatus 0} {RxCRC 1} {RxOver 2} {RxUnder 3}
    		   {RxFrag 4} {RxJabber 5} {RxAlign 6} {RxLost 7} }

    <a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking port $port rxerrors&#34;
    
    <span class="comment-line"># -- store display information in the tmp file</span>
    global spawn_id
    set pid _[pid]
    set fd_in [open &#34;Tmp/tmp_$testNo$pid&#34; &#34;w&#34;]
    <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;show ports $port rxerrors&#34; $fd_res $fd_in
    close $fd_in
    
    <span class="comment-line"># -- process the information </span>
    set fd_in [open &#34;Tmp/tmp_$testNo$pid&#34; &#34;r&#34;]
    set indexFound -1
    while {[gets $fd_in line] != -1} {
	<span class="comment-line">#result_debug &#34;----- Line=|$line|&#34;</span>
	regsub {H} $line {H } line
	set index [lsearch -exact $line &#34;$port&#34;]
	<span class="comment-line"># -- get the last complete line, a cheap way of doing this</span>
	if {$index &gt;= 0 &amp;&amp; ([regexp &#34;5;01H&#34; $line]) &amp;&amp; ([regexp &#34;01;55H&#34; $line]) } {
	    set indexFound $index
	    set lineFound $line
	    <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;----- Line=|$line|&#34;
	    <span class="comment-line">#regsub -all {[^A-Z^a-z^0-9^_^-^5;01H^:]} $lineFound &#34; &#34; lineFound</span>
	}
    }    
    close $fd_in
    
    <span class="comment-line"># -- if found the value, compare it</span>
    if {$indexFound &gt;= 0} {
        <span class="comment-line"># -- check each item</span>
    	foreach rxCheckItem $checkList {
   	    set indexName [lindex $rxCheckItem 0]
   	    set index -1
   	    foreach rxErrorItem $rxErrors {
   	    	if {[string compare $indexName [lindex $rxErrorItem 0]] == 0} {
   	    	    set index [lindex $rxErrorItem 1]
   	    	    break
   	    	}
   	    }
   	    if {$index &gt;= 0} {
   	    	set valueWanted [lindex $rxCheckItem 1]
   	    	set compareFlag [lindex $rxCheckItem 2]
   	    	set valueFound [lindex $lineFound [expr $indexFound + $index + 1]]
   	    	switch $compareFlag {
   	    	    &#34;minPacket&#34; {
   	    	    	if {$valueWanted &lt;= $valueFound} {
   	    	    	    <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checking $indexName minimum value passed. Is over $valueWanted.&#34;  
   	    	    	} else {
   	    	    	    <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Checking $indexName minimum value failed. Wanted $valueWanted BUTGOT $valueFound&#34;
   	    	    	}
   	    	    }
   	    	    &#34;maxPacket&#34; {
   	    	    	if {$valueWanted &gt; $valueFound} {
   	    	    	    <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checking $indexName maximum value passed. Is under $valueWanted.&#34;  
   	    	    	} else {
   	    	    	    <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Checking $indexName maximum value failed. Wanted $valueWanted BUTGOT $valueFound&#34;
   	    	    	}
   	    	    }
   	    	    &#34;exactPacket&#34; -
   	    	    default {
   	    	    	if {$valueWanted == $valueFound} {
   	    	    	    <a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checking $indexName exact value passed. Is exactly $valueWanted.&#34;  
   	    	    	} else {
   	    	    	    <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Checking $indexName exact value failed. Wanted $valueWanted BUTGOT $valueFound&#34;
   	    	    	}
   	    	    }
   	    	}
   	    } else {
   	    	<a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;CheckRxErrorMonitor item name $indexName not found&#34;
  	    	break
   	    } 
    	}
    } else {
    	<a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No RxErrors data found for port $port&#34;
    }
    <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    catch {file delete &#34;Tmp/tmp_$testNo$pid&#34;}
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: incrx</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Increment hex string value by amount </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              	varName		string of hex value. for example:</span>
<span class="comment-line">#				&#34;00 01 02 03 04 05&#34;</span>
<span class="comment-line">#		index		at which hex byte</span>
<span class="comment-line">#		amount		  </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return 	next mac address</span>
<span class="comment-line">#	</span>
<span class="comment-line">#	00:a1:f1:00:00:01 -&gt; 00:a1:f1:00:00:02 if increment by 1</span>
<span class="comment-line">#	00 a1 f1 00 00 ff -&gt; 00 a1 f1 00 01 00 if increment by 1</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             set newMac [IncMacByOne $mac &#34;:&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::incrx_2341">proc <a href="misc.tcl-annot.html#::::incrx">::::incrx</a></a></strong> {varName {index  0} {amount 1}} {
    upvar 1 $varName var 
    if {[info exists var]} {
    	set residue [expr $amount % 256]
    	set quotient [expr $amount / 256]
	set theByte [lindex $var $index]
	set tmp [expr 0x$theByte + $residue]
	set theByte [format %02x $tmp]
	if {$tmp &gt;= 256 } {
	    set theByte [format %02x [expr $tmp - 256]]
	    set quotient [expr $quotient + 1]
	}
	set var [lreplace $var $index $index $theByte]
	if {$quotient &gt; 0 &amp;&amp; $index &gt; 1} {
	    set index [expr $index - 1]
	    set var [<a name="::incrx(1)"><a href="./misc.tcl.html#::incrx_2341">::incrx</a></a> var $index $quotient]
	}
    } else {
	set var &#34;$amount&#34;
    }
    return $var
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IncMacByOne</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Increment the mac address by 1 </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              	mac	mac address </span>
<span class="comment-line">#		delim	&#34;:&#34; or &#34; &#34;	  </span>
<span class="comment-line">#                </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line">#              return 	next mac address</span>
<span class="comment-line">#	</span>
<span class="comment-line">#	00:a1:f1:00:00:01 -&gt; 00:a1:f1:00:00:02</span>
<span class="comment-line">#	00 a1 f1 00 00 ff -&gt; 00 a1 f1 00 01 00</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#             set newMac [IncMacByOne $mac &#34;:&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::IncMacByOne_2383">proc <a href="misc.tcl-annot.html#::::IncMacByOne">::::IncMacByOne</a></a></strong> {mac {delim &#34; &#34;}} {
    set newMac $mac
    regsub -all $delim $newMac  &#34; &#34; newMac
    set newMac [<a name="::incrx(2)"><a href="./misc.tcl.html#::incrx_2341">::incrx</a></a> newMac 5 1]
    regsub -all { } $newMac $delim newMac
    return $newMac
}

<strong><a name="::::RemovePolFromDUT_2391">proc <a href="misc.tcl-annot.html#::::RemovePolFromDUT">::::RemovePolFromDUT</a></a></strong> {fileName} {
   global whichDutNow
<span class="comment-line">#   EnableDebugMode</span>
   catch {file delete &#34;Tmp/$fileName&#34;}  ;<span class="comment-line"># remove the temp file</span>
   global supportedPlatform
   if {[regexp -nocase $supportedPlatform [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$whichDutNow]] || \
       [regexp -nocase $supportedPlatform [<a name="::GetSysType(1)"><a href="./misc.tcl.html#::GetSysType_453">::GetSysType</a></a> DUT${whichDutNow}]]} {
      <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;rm $fileName.pol&#34;
   } else {
      <span class="comment-line"># Fix for PD2-232904551</span>
<span class="comment-line">#      SendACmd &#34;!rm /root/config/$fileName.pol&#34;</span>
      <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;rm $fileName.pol&#34;
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: EnableDebugModeConsole</span>
<span class="comment-line"># Description: Enable XOS debug mode on</span>
<span class="comment-line"># Input args:   none</span>
<span class="comment-line"># Output args:  none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       EnableDebugMode</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::EnableDebugModeConsole_2415">proc <a href="misc.tcl-annot.html#::::EnableDebugModeConsole">::::EnableDebugModeConsole</a></a></strong> {console} {

    <a name="::Login(15)"><a href="./login.tcl.html#::Login_24">::Login</a></a> &#34;$console&#34; -CheckOperational 0 -masterCheck 0
    <a name="::EnableDebugMode(1)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>

}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: EnableDebugMode</span>
<span class="comment-line"># Description: Enable XOS debug mode</span>
<span class="comment-line"># Input args:	none</span>
<span class="comment-line"># Output args:  none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line"># 	EnableDebugMode</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::EnableDebugMode_2430">proc <a href="misc.tcl-annot.html#::::EnableDebugMode">::::EnableDebugMode</a></a></strong> {} {
    global DUTs_info whichDutNow whichMsmNow

    if {![info exists DUTs_info(DUT${whichDutNow}${whichMsmNow},DEBUGENABLED)]} {
        set DUTs_info(DUT${whichDutNow}${whichMsmNow},DEBUGENABLED) 0;
    } 
    if {$DUTs_info(DUT${whichDutNow}${whichMsmNow},DEBUGENABLED)} {
        <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Debug mode enabled on DUT${whichDutNow} ${whichMsmNow}&#34;
        return
    }
    set counter 1
    while {$counter&lt;4} {
        set buf [<a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
        if {[regexp -nocase &#34;debug&#34; $buf]} {
           <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
           set DUTs_info(DUT${whichDutNow}${whichMsmNow},DEBUGENABLED) 1;
           break;
        } else {
           set output [<a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;]
           sleep 2
           global whichDutNow DUTs_info
           set newPass 1
     
           if {[info exists DUTs_info(DUT${whichDutNow},version)]} {
              if {[<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(3)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 15.4.0.1]&gt;=0 } { 
                   set newPass 18;
              } elseif {([<a name="::CompareRelease(2)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(4)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 15.3.0.0] &gt;= 0) ||
                  ([<a name="::CompareRelease(3)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(5)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 15.2.0.9] == 0 &amp;&amp;
                   [regexp SDK601 [<a name="::GetVersion(6)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}]]) ||
                  ([<a name="::CompareRelease(4)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(7)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 15.4.0.6] == 0 &amp;&amp;
                   [regexp HotSpot [<a name="::GetVersion(8)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}]])} {
                   set newPass 17;
              } elseif {[<a name="::CompareRelease(5)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(9)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 15.2.0.0]&gt;=0} {
                   set newPass 16;
              } elseif {[<a name="::CompareRelease(6)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(10)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 15.1.0.0]&gt;=0} {
                   set newPass 15
              } elseif {[<a name="::CompareRelease(7)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(11)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 12.7.0.1]&gt;=0} {
                   set newPass 14
              } elseif {[<a name="::CompareRelease(8)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(12)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 12.6.0.1]&gt;=0} {
                 set newPass 13
              } elseif {[<a name="::CompareRelease(9)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(13)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 12.5.0.14]&gt;=0} {
                 set newPass 12
              } elseif {[<a name="::CompareRelease(10)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(14)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 12.4.0.12]&gt;=0} {
                 set newPass 11
              } elseif {[<a name="::CompareRelease(11)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(15)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 12.3.0.0]&gt;=0} {
                 set newPass 10
              } elseif {[<a name="::CompareRelease(12)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(16)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 12.2.0.11]&gt;=0} {
                 set newPass 9
              } elseif {[<a name="::CompareRelease(13)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(17)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 12.1.0.37]&gt;=0} {
                 set newPass 8
              } elseif {[<a name="::CompareRelease(14)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(18)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.7.0.18]&gt;=0} {
                 set newPass 7
              } elseif {[<a name="::CompareRelease(15)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(19)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.6.0.6]&gt;=0} {
                 set newPass 6
              } elseif {[<a name="::CompareRelease(16)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(20)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.5.0.0]&gt;=0} {
                 set newPass 5
              } elseif {[<a name="::CompareRelease(17)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(21)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.4.0.16]&gt;=0} {
                 set newPass 4
              } elseif {[<a name="::CompareRelease(18)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(22)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.3.0.11]&gt;=0} {
                 set newPass 3
              } elseif {[<a name="::CompareRelease(19)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(23)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.2.0.13]&gt;=0} {
                 set newPass 2
              } elseif {[<a name="::CompareRelease(20)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(24)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}] 11.1.1.1]&gt;=0} {
                 set newPass 1
              } else {
                 set newPass 0
              }
           } else {
              set newPass 18;
           }

           puts &#34;new Pass : $newPass&#34;

           switch $newPass {
              &#34;18&#34; {<a name="::_tryOneTimePwd(1)"><a href="./misc.tcl.html#::_tryOneTimePwd_2536">::_tryOneTimePwd</a></a> $output}
              &#34;17&#34; {<a name="::_try15_3Pwd(1)"><a href="./misc.tcl.html#::_try15_3Pwd_2699">::_try15_3Pwd</a></a>}
              &#34;16&#34; {<a name="::_try15_2Pwd(1)"><a href="./misc.tcl.html#::_try15_2Pwd_2714">::_try15_2Pwd</a></a>}
              &#34;15&#34; {<a name="::_tryYukonPwd(1)"><a href="./misc.tcl.html#::_tryYukonPwd_2730">::_tryYukonPwd</a></a>}
              &#34;14&#34; {<a name="::_tryNilePwd(1)"><a href="./misc.tcl.html#::_tryNilePwd_2749">::_tryNilePwd</a></a>}
              &#34;13&#34; {<a name="::_tryColoradoPwd(1)"><a href="./misc.tcl.html#::_tryColoradoPwd_2768">::_tryColoradoPwd</a></a>}
              &#34;12&#34; { <a name="::_try12_5Pwd(1)"><a href="./misc.tcl.html#::_try12_5Pwd_2791">::_try12_5Pwd</a></a>}
              &#34;11&#34; { <a name="::_tryPulcianoPwd(1)"><a href="./misc.tcl.html#::_tryPulcianoPwd_2807">::_tryPulcianoPwd</a></a>}
              &#34;10&#34; { <a name="::_tryEdenPwd(1)"><a href="./misc.tcl.html#::_tryEdenPwd_2823">::_tryEdenPwd</a></a>}
              &#34;9&#34; { <a name="::_trySunlightpeakPwd(1)"><a href="./misc.tcl.html#::_trySunlightpeakPwd_2838">::_trySunlightpeakPwd</a></a>}
              &#34;8&#34; { <a name="::_tryZugspitzePwd(1)"><a href="./misc.tcl.html#::_tryZugspitzePwd_2852">::_tryZugspitzePwd</a></a> }
              &#34;7&#34; { <a name="::_tryMontebelloPwd(1)"><a href="./misc.tcl.html#::_tryMontebelloPwd_2865">::_tryMontebelloPwd</a></a> }
              &#34;6&#34; { <a name="::_tryFujiPwd(1)"><a href="./misc.tcl.html#::_tryFujiPwd_2878">::_tryFujiPwd</a></a> }
              &#34;5&#34; { <a name="::_tryMatterhornPwd(1)"><a href="./misc.tcl.html#::_tryMatterhornPwd_2891">::_tryMatterhornPwd</a></a> }
              &#34;4&#34; { <a name="::_tryMckinleyPwd(1)"><a href="./misc.tcl.html#::_tryMckinleyPwd_2904">::_tryMckinleyPwd</a></a> }
              &#34;3&#34; { <a name="::_tryRushmorePwd(1)"><a href="./misc.tcl.html#::_tryRushmorePwd_2917">::_tryRushmorePwd</a></a> }
              &#34;2&#34; { <a name="::_tryShastaPwd(1)"><a href="./misc.tcl.html#::_tryShastaPwd_2929">::_tryShastaPwd</a></a> }
              &#34;1&#34; { <a name="::_tryMontBlancPwd(1)"><a href="./misc.tcl.html#::_tryMontBlancPwd_2941">::_tryMontBlancPwd</a></a> }
              default { <a name="::_tryRainierPwd(1)"><a href="./misc.tcl.html#::_tryRainierPwd_2953">::_tryRainierPwd</a></a> }
           }
        }
        incr counter 1
    }
    if {$counter==4} {
       set module [lindex [split [pwd] /] end]
       if { [llength [info procs showDebugInfo$module]] == 1 } {
          <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Could not enable debug-mode in 3 retries&#34;
       } else {
          <a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Could not enable debug-mode in 3 retries&#34;
       }
    }
}
<strong><a name="::::_tryOneTimePwd_2536">proc <a href="misc.tcl-annot.html#::::_tryOneTimePwd">::::_tryOneTimePwd</a></a></strong> { challenge } {
    global DUTs_info
    global whichDutNow
    set keyFileList &#34;&#34;
    if {[file isfile maindiag.tcl]} {
        set myPath &#34;../main/&#34;
        foreach match [glob -nocomplain -- &#34;./Keys/*\.key&#34;] {
            set matchList [split $match &#34;/&#34;]
            set match [lindex $matchList [expr [llength $matchList] - 1]]
            set mList [split $match &#34;.&#34;]
            lappend keyFileList [lindex $mList 0]
        }
    } elseif {[file isfile ../main/maindiag.tcl]} {
        set myPath &#34;../main/&#34;
        foreach match [glob -nocomplain -- &#34;../main/Keys/*\.key&#34;] {
            set matchList [split $match &#34;/&#34;]
            set match [lindex $matchList [expr [llength $matchList] - 1]]
            set mList [split $match &#34;.&#34;]
            lappend keyFileList [lindex $mList 0]
        }
    } elseif {[file isfile ../../main/maindiag.tcl]} {
        set myPath &#34;../../main/&#34;
        foreach match [glob -nocomplain -- &#34;../../main/Keys/*\.key&#34;] {
            set matchList [split $match &#34;/&#34;]
            set match [lindex $matchList [expr [llength $matchList] - 1]]
            set mList [split $match &#34;.&#34;]
            lappend keyFileList [lindex $mList 0]
        }
    } elseif {[file isfile ../../../main/maindiag.tcl]} {
        set myPath &#34;../../../main/&#34;
        foreach match [glob -nocomplain -- &#34;../../../main/Keys/*\.key&#34;] {
            set matchList [split $match &#34;/&#34;]
            set match [lindex $matchList [expr [llength $matchList] - 1]]
            set mList [split $match &#34;.&#34;]
            lappend keyFileList [lindex $mList 0]
        }
    } else {
        <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DDDDD&#34;
        <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Can't find my current location OR key files&#34;
    }
    set keyFileList [lsort -decreasing $keyFileList]
    puts &#34;key list: $keyFileList&#34;
    set keyLength [llength $keyFileList]
    set hitAKey 0
    set keyInt -1
    set nostr 0
    set passLoop 1
    set keyLoop 0
    while {1} {
        set cMac &#34;&#34;
        set cVer &#34;&#34;
        set cMac &#34;&#34;
        set cCount 0
        set cList &#34;&#34;
        set vList &#34;&#34;
        <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Pull the challenge string&#34;
        regsub -all &#34;   &#34; $challenge &#34; &#34; challenge
        regsub -all &#34;  &#34; $challenge &#34; &#34; challenge
        set debugList [split $challenge \n]
        foreach dLine $debugList {
            set dLine [string trim $dLine]
            set lineList [split $dLine &#34; &#34;]
            if {[lindex $lineList 0] == &#34;EXOS&#34; &amp;&amp; [lindex $lineList 1] == &#34;version:&#34;} {
                set cVer [lindex $lineList 2]
            }
            if {[lindex $lineList 0] == &#34;System&#34; &amp;&amp; [lindex $lineList 1] == &#34;MAC&#34;} {
                set cMac [lindex $lineList 3]
            }
            if {$cCount &gt; 0 || ([lindex $lineList 0] == &#34;Challenge&#34; &amp;&amp; [lindex $lineList 1] == &#34;:&#34;)} {
                if {$cCount == 0} {
                    lappend cList [lindex $lineList 2]
                    incr cCount;
                } elseif {[lindex $lineList 0] != &#34;NOTE:&#34;} {
                    lappend cList [lindex $lineList 0]
                } else {
                    break;
                }
            }
        }
        set vList [split $cVer &#34;.&#34;]
        <span class="comment-line">#set keyFile &#34;[lindex $vList 0]_[lindex $vList 1].key&#34;</span>
        if {$keyInt &lt; 0} {
            set keyText [lindex $vList 0]_[lindex $vList 1]
            set keyInt [lsearch $keyFileList $keyText]
            set keyFile ${keyText}.key
        } else {
            set keyText [lindex $keyFileList $keyInt]
            set keyFile ${keyText}.key
        }
        if {$keyInt &lt; 0} {
            <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error - Version has no key file&#34;;
            incr nostr
            send &#34;\r&#34;;
            expect -re &#34;&gt; |# &#34;;
            send &#34;\r&#34;;
            expect -re &#34;&gt; |# &#34;;
            if {$nostr &gt; 2} {
                <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;;
                return [<a name="::_try15_3Pwd(2)"><a href="./misc.tcl.html#::_try15_3Pwd_2699">::_try15_3Pwd</a></a>];
            } else {
                set challenge [<a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;]
                incr keyInt
                continue
            }
        }
        set cText [join $cList &#34;&#34;]
        <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;keyPath ${myPath}\nOTP parts found - int $keyInt :\nVer: $cVer\nKey File: $keyFile\nMAC: $cMac\nChallenge: $cText&#34;

        set rc [catch {exec ${myPath}dbgPswd ${myPath}Keys/$keyFile $cMac $cText} res]
        if {$rc} {
            if {$keyInt &lt; $keyLength} {
                <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error getting the password with the challenge text: $res&#34;;
                send &#34;\r&#34;;
                expect -re &#34;&gt; |# &#34;;
                set challenge [<a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;]
                incr keyInt
                continue
            } else {
                return [<a name="::_try15_3Pwd(3)"><a href="./misc.tcl.html#::_try15_3Pwd_2699">::_try15_3Pwd</a></a>];
            }
        } elseif {[regexp -nocase &#34;ERROR&#34; $res]} {
            if {$keyInt &lt; $keyLength} {
                <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Could not open the key file&#34;
                send &#34;\r&#34;;
                expect -re &#34;&gt; |# &#34;;
                set challenge [<a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;]
                incr keyInt
                continue
            } else {
                return [<a name="::_try15_3Pwd(4)"><a href="./misc.tcl.html#::_try15_3Pwd_2699">::_try15_3Pwd</a></a>];
            }
        } else {
            <span class="comment-line">#result_debug &#34;rc = $rc\nres = $res&#34;</span>
            set oList [split $res &#34; &#34;]
            set otp [lindex $oList [expr [llength $oList] -1]]
            <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The OTP is $otp&#34;
            sleep 1;
            send &#34;$otp\r&#34;;
            expect -re &#34;&gt; |# &#34;;
            set buf [<a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;];
            if {[regexp -nocase &#34;debug&#34; $buf]} {
                <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;;
                return 1;
            } elseif {$keyInt &lt; $keyLength} {
                if {$keyLoop&gt;0} {
                    incr keyInt
                    <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Password did not work increment key to keyInt $keyInt&#34;;
                } else {
                    incr keyLoop
                    <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Password did not work. RETRY keyInt $keyInt&#34;;
                }
                send &#34;\r&#34;;
                expect -re &#34;&gt; |# &#34;;
                set challenge [<a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;]
                continue
            } else {
                <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NEXT - try15_3Pwd&#34;
                <a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;;
                return [<a name="::_try15_3Pwd(5)"><a href="./misc.tcl.html#::_try15_3Pwd_2699">::_try15_3Pwd</a></a>]
            }
        }
    }
}
<strong><a name="::::_try15_3Pwd_2699">proc <a href="misc.tcl-annot.html#::::_try15_3Pwd">::::_try15_3Pwd</a></a></strong> {} {
    sleep 1;
    send &#34;YZDEqm/FDD467rSN21T0\n&#34;;
    send &#34;\n&#34;;
    expect &#34;# &#34;;
    set buf [<a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;];
    if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
         <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;;
         return 1;
    } else {
        <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NEXT - try15_2Pwd&#34;
        <a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;;
        return [<a name="::_try15_2Pwd(2)"><a href="./misc.tcl.html#::_try15_2Pwd_2714">::_try15_2Pwd</a></a>];
    }
}
<strong><a name="::::_try15_2Pwd_2714">proc <a href="misc.tcl-annot.html#::::_try15_2Pwd">::::_try15_2Pwd</a></a></strong> {} {
    sleep 1;
    send &#34;O2M1Jy3hBwfBFyJ3Zon/\n&#34;;
    send &#34;\n&#34;;
    expect &#34;# &#34;;
    set buf [<a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;];
    if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
         <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;;
         return 1;
    } else {
        <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NEXT - tryYukonPwd&#34;
        <a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;;
        return [<a name="::_tryYukonPwd(2)"><a href="./misc.tcl.html#::_tryYukonPwd_2730">::_tryYukonPwd</a></a>];
    }
}

<strong><a name="::::_tryYukonPwd_2730">proc <a href="misc.tcl-annot.html#::::_tryYukonPwd">::::_tryYukonPwd</a></a></strong> {} {

    sleep 1
    send &#34;D2cq2XntLWTtlyRXYjE.\n&#34;
    send &#34;\n&#34;
    expect &#34;# &#34;
    set buf [<a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
    if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
         <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
         return 1;

    } else {
        <a name="::result_debug(42)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NEXT - tryNilePwd&#34;
        <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
        return [ <a name="::_tryNilePwd(2)"><a href="./misc.tcl.html#::_tryNilePwd_2749">::_tryNilePwd</a></a>]
    }

}

<strong><a name="::::_tryNilePwd_2749">proc <a href="misc.tcl-annot.html#::::_tryNilePwd">::::_tryNilePwd</a></a></strong> {} {

    sleep 1
    send &#34;JK8OJgCApYkJh6st8hw1\n&#34;
    send &#34;\n&#34;
    expect &#34;# &#34;
    set buf [<a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
    if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
         <a name="::result_debug(43)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
         return 1;

    } else {
        <a name="::result_debug(44)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NEXT - tryColoradoPwd&#34;
        <a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
        return [ <a name="::_tryColoradoPwd(2)"><a href="./misc.tcl.html#::_tryColoradoPwd_2768">::_tryColoradoPwd</a></a>]
    }

}

<strong><a name="::::_tryColoradoPwd_2768">proc <a href="misc.tcl-annot.html#::::_tryColoradoPwd">::::_tryColoradoPwd</a></a></strong> {} {

    sleep 1
    send &#34;/Lgp0w6qn3ugqqRLhM7.\n&#34;
    send &#34;\n&#34;
    expect &#34;# &#34;
    set buf [<a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
    if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
         <a name="::result_debug(45)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
         return 1;

    } else {
        <span class="comment-line">#</span>
        <span class="comment-line"># End support of older debug 2017/9 grant</span>
        <span class="comment-line">#</span>
        return 0;
        <a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
        return [ <a name="::_try12_5Pwd(2)"><a href="./misc.tcl.html#::_try12_5Pwd_2791">::_try12_5Pwd</a></a>]
    }

}


<strong><a name="::::_try12_5Pwd_2791">proc <a href="misc.tcl-annot.html#::::_try12_5Pwd">::::_try12_5Pwd</a></a></strong> {} {
   sleep 1
   send &#34;88DfwZ80K9oKesSdBQQ1\n&#34;
   send &#34;\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(46)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      return 0
      <a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryPulcianoPwd(2)"><a href="./misc.tcl.html#::_tryPulcianoPwd_2807">::_tryPulcianoPwd</a></a>]
   }
}

<strong><a name="::::_tryPulcianoPwd_2807">proc <a href="misc.tcl-annot.html#::::_tryPulcianoPwd">::::_tryPulcianoPwd</a></a></strong> {} {
   sleep 1
   send &#34;CIYRQQlsapAtVHefZjL.\n&#34;
   send &#34;\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(47)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryEdenPwd(2)"><a href="./misc.tcl.html#::_tryEdenPwd_2823">::_tryEdenPwd</a></a>]
   }
}


<strong><a name="::::_tryEdenPwd_2823">proc <a href="misc.tcl-annot.html#::::_tryEdenPwd">::::_tryEdenPwd</a></a></strong> {} {
   sleep 1
   send &#34;Z!EY/;.\}+:^*BY\$CI&amp;&amp;@\n&#34;
   send &#34;\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(48)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_trySunlightpeakPwd(2)"><a href="./misc.tcl.html#::_trySunlightpeakPwd_2838">::_trySunlightpeakPwd</a></a>]
   }
}

<strong><a name="::::_trySunlightpeakPwd_2838">proc <a href="misc.tcl-annot.html#::::_trySunlightpeakPwd">::::_trySunlightpeakPwd</a></a></strong> {} {
    <span class="comment-line"># h**u$^%$v]h68Hih9#%7</span>
   send &#34;h**u\$^%\$v]h68Hih9#%7\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(49)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryZugspitzePwd(2)"><a href="./misc.tcl.html#::_tryZugspitzePwd_2852">::_tryZugspitzePwd</a></a>]
   }
}

<strong><a name="::::_tryZugspitzePwd_2852">proc <a href="misc.tcl-annot.html#::::_tryZugspitzePwd">::::_tryZugspitzePwd</a></a></strong> {} {
   send &#34;&amp;*%HJtyuiOIk5688%jkl\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(50)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryMontebelloPwd(2)"><a href="./misc.tcl.html#::_tryMontebelloPwd_2865">::_tryMontebelloPwd</a></a>]
   }
}

<strong><a name="::::_tryMontebelloPwd_2865">proc <a href="misc.tcl-annot.html#::::_tryMontebelloPwd">::::_tryMontebelloPwd</a></a></strong> {} {
   send &#34;\&#34;fQ9b9#lOvE49XK1UiwP\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(51)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryFujiPwd(2)"><a href="./misc.tcl.html#::_tryFujiPwd_2878">::_tryFujiPwd</a></a>]
   }
}

<strong><a name="::::_tryFujiPwd_2878">proc <a href="misc.tcl-annot.html#::::_tryFujiPwd">::::_tryFujiPwd</a></a></strong> {} {
   send &#34;2)Jv@ffOc*4hRPwkil54\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(52)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(47)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryMatterhornPwd(2)"><a href="./misc.tcl.html#::_tryMatterhornPwd_2891">::_tryMatterhornPwd</a></a>]
   }
}

<strong><a name="::::_tryMatterhornPwd_2891">proc <a href="misc.tcl-annot.html#::::_tryMatterhornPwd">::::_tryMatterhornPwd</a></a></strong> {} {
   send &#34;WW1l8\$xR42fkwBu!xDEh\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(48)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(53)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(49)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryMckinleyPwd(2)"><a href="./misc.tcl.html#::_tryMckinleyPwd_2904">::_tryMckinleyPwd</a></a>]
   }
}

<strong><a name="::::_tryMckinleyPwd_2904">proc <a href="misc.tcl-annot.html#::::_tryMckinleyPwd">::::_tryMckinleyPwd</a></a></strong> {} {
   send &#34;x1RcQo0l%sOWW=w?vDiB\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(50)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(54)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(51)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryRushmorePwd(2)"><a href="./misc.tcl.html#::_tryRushmorePwd_2917">::_tryRushmorePwd</a></a>]
   }
}

<strong><a name="::::_tryRushmorePwd_2917">proc <a href="misc.tcl-annot.html#::::_tryRushmorePwd">::::_tryRushmorePwd</a></a></strong> {} {
   send &#34;93oTKW4.e@uU4h\$vOAb1\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(52)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(55)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(53)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryShastaPwd(2)"><a href="./misc.tcl.html#::_tryShastaPwd_2929">::_tryShastaPwd</a></a>]
   }
}
<strong><a name="::::_tryShastaPwd_2929">proc <a href="misc.tcl-annot.html#::::_tryShastaPwd">::::_tryShastaPwd</a></a></strong> {} {
   send &#34;u5BxIi8vL8Wc\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(54)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(56)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1;
   } else {
      <a name="::SendACmd(55)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryMontBlancPwd(2)"><a href="./misc.tcl.html#::_tryMontBlancPwd_2941">::_tryMontBlancPwd</a></a>]
   }
}
<strong><a name="::::_tryMontBlancPwd_2941">proc <a href="misc.tcl-annot.html#::::_tryMontBlancPwd">::::_tryMontBlancPwd</a></a></strong> {} {
   send &#34;3xtr3m3\n&#34;
   expect &#34;# &#34;
   set buf [<a name="::SendACmd(56)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;]
   if {[regexp -nocase &#34;\(debug\)&#34; $buf]} {
      <a name="::result_debug(57)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;debug-mode enabled&#34;
      return 1
   } else {
      <a name="::SendACmd(57)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable debug-mode&#34;
      return [<a name="::_tryRainierPwd(2)"><a href="./misc.tcl.html#::_tryRainierPwd_2953">::_tryRainierPwd</a></a>]
   }
}
<strong><a name="::::_tryRainierPwd_2953">proc <a href="misc.tcl-annot.html#::::_tryRainierPwd">::::_tryRainierPwd</a></a></strong> {} {
   send &#34;nomoreew\n&#34;
   return 1
}
<strong><a name="::::DisableDebugMode_2957">proc <a href="misc.tcl-annot.html#::::DisableDebugMode">::::DisableDebugMode</a></a></strong> {} {
    <a name="::SendACmd(58)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable debug-mode&#34;
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: SendAFileOld</span>
<span class="comment-line"># Description: upload the file to tftp server, then download it to</span>
<span class="comment-line">#	the DUT</span>
<span class="comment-line">#       Deprecated as does not work w/ certain tftp servers</span>
<span class="comment-line"># Input args:   </span>
<span class="comment-line">#	tftpServer: the tftp server</span>
<span class="comment-line">#	localFile: the file to be sent</span>
<span class="comment-line">#	remoteFile: the file to be on the remote</span>
<span class="comment-line">#	dut: the DUT# to send the file to </span>
<span class="comment-line"># Output args:  none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       SendAFile</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendAFileOld_2976">proc <a href="misc.tcl-annot.html#::::SendAFileOld">::::SendAFileOld</a></a></strong> {tftpServer localFile remoteFile {dut 1} } {

global DUT${dut}_CONNECT

set filePrefix &#34;[set DUT${dut}_CONNECT]&#34;
<span class="comment-line">#set filePrefix &#34;[set DUT${dut}_CONNECT] 123&#34;   ;# for testing</span>
regsub -all { } $filePrefix {.} filePrefix
set tftpFile $filePrefix.$remoteFile
set platform [<a name="::GetPlatform(4)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${dut}]
<a name="::result_debug(58)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$tftpFile, $platform&#34;

<span class="comment-line"># upload the file to tftpserver</span>
global spawn_id

set current_spawn_id $spawn_id
<a name="::result_debug(59)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;spawn_id = $spawn_id&#34;
spawn tftp $tftpServer
<a name="::result_debug(60)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;spawn_id = $spawn_id&#34;
<a name="::SendACmd(59)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;put $localFile $tftpFile&#34;
send &#34;quit\r&#34;
set spawn_id $current_spawn_id

<a name="::Login(16)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECT]

<span class="comment-line"># download from tftpServer to DUT</span>
global switchPort2DefaultRouter
<a name="::ConfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::ConfigGatewayNetwork_2110">::ConfigGatewayNetwork</a></a>
after 5000
set virtualRouter [<a name="::GetVrString(1)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $dut]
<a name="::SendACmd(60)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;tftp $tftpServer -v $virtualRouter -g -r $tftpFile -l $remoteFile&#34;
<a name="::UnconfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::UnconfigGatewayNetwork_2356">::UnconfigGatewayNetwork</a></a>

return $tftpFile
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: SendAFile</span>
<span class="comment-line"># Description: inturn calls tftp get and put</span>
<span class="comment-line">#	the DUT</span>
<span class="comment-line"># Input args:   </span>
<span class="comment-line">#	tftpServer: the tftp server</span>
<span class="comment-line">#	localFile: the file to be sent</span>
<span class="comment-line">#	remoteFile: the file to be on the remote</span>
<span class="comment-line">#	dut: the DUT# to send the file to </span>
<span class="comment-line"># Output args:  none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       SendAFile</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendAFile_3025">proc <a href="misc.tcl-annot.html#::::SendAFile">::::SendAFile</a></a></strong> {tftpServer localFile remoteFile {dut 1} } {

   global DUT${dut}_CONNECT
   <a name="::Login(17)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECT]

   set localFileTail [file tail $localFile]
   <a name="::CheckTftpPut(1)"><a href="./SendSwCmd.tcl.html#::CheckTftpPut_2435">::CheckTftpPut</a></a> $localFile
   <a name="::CheckTftpGet(1)"><a href="./SendSwCmd.tcl.html#::CheckTftpGet_2562">::CheckTftpGet</a></a> $localFileTail

   <a name="::SendACmd(61)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv $localFileTail.pol $remoteFile&#34;
}

<strong><a name="::::SendAFileToTftp_3037">proc <a href="misc.tcl-annot.html#::::SendAFileToTftp">::::SendAFileToTftp</a></a></strong> {tftpServer  remoteFile args} {
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendAFileToTftp $args {
       dut &#34;1&#34;
       nameFormat &#34;dynamic&#34;
   }

   global DUT${dut}_CONNECT

<span class="comment-line">#   set localFileTail [file tail $localFile]</span>
   <a name="::CheckTftpPut(2)"><a href="./SendSwCmd.tcl.html#::CheckTftpPut_2435">::CheckTftpPut</a></a> $remoteFile -nameFormat $nameFormat
<span class="comment-line">#   CheckTftpGet $localFileTail -confGw $Option -nameFormat $nameFormat</span>

   <span class="comment-line">#Login [set DUT${dut}_CONNECT]</span>
   <span class="comment-line">#SendACmd &#34;mv $localFileTail.pol $remoteFile&#34;</span>
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: DeleteAFile</span>
<span class="comment-line"># Description: delete a file on the DUT's config directory for Mariner</span>
<span class="comment-line">#       or on the DUT's bin directory for PCs</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#       remoteFile: the file to be deleted from the DUT</span>
<span class="comment-line">#       dut: the DUT# to deleted the file from</span>
<span class="comment-line"># Output args:  none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       DeleteAFile remoteFile dut</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::DeleteAFile_3066">proc <a href="misc.tcl-annot.html#::::DeleteAFile">::::DeleteAFile</a></a></strong> {remoteFile {dut 1} } {
global DUT${dut}_CONNECT
set platform [<a name="::GetPlatform(5)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${dut}]
set pid _[pid]

<a name="::Login(18)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECT]
set result 1

if {0} {
<a name="::EnableDebugMode(2)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
set fd_in [open &#34;Tmp/tmp_DeleteAFile$pid&#34; &#34;w&#34;]
global supportedPlatform
if {[regexp -nocase &#34;$supportedPlatform&#34; $platform]==1} {
   <a name="::SendACmd(62)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mount -o rw,remount /dev/mtdblock3 /config&#34; $fd_in
   <a name="::SendACmd(63)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!rm /config/$remoteFile&#34; $fd_in
   <a name="::SendACmd(64)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!mount -o ro,remount /dev/mtdblock3 /config&#34; $fd_in
} else {
   <a name="::SendACmd(65)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!rm $remoteFile&#34; $fd_in
   <a name="::SendACmd(66)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!rm /root/config/$remoteFile&#34; $fd_in
}
close $fd_in
<a name="::DisableDebugMode(1)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
}

set fd_in [open &#34;Tmp/tmp_DeleteAFile$pid&#34; &#34;w&#34;]
<a name="::SendACmd(67)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;rm $remoteFile&#34;
close $fd_in

set fd_in [open &#34;Tmp/tmp_DeleteAFile$pid&#34; &#34;r&#34;]
set rtValue [<a name="::check_illegality(3)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
close $fd_in
if { $rtValue == &#34;illegal&#34; } {
  set result 0
}
catch {file delete &#34;Tmp/tmp_DeleteAFile$pid&#34;}
return $result

}

<strong><a name="::::KillEXOSProcess_3105">proc <a href="misc.tcl-annot.html#::::KillEXOSProcess">::::KillEXOSProcess</a></a></strong> {processName} {
    <span class="comment-line">#</span>
    <span class="comment-line"># EY-07-31-2013: Remove global for spawn_id as it wasn't being used.</span>

    <span class="comment-line">#####################################</span>
    set subTest &#34;Kill $processName&#34;
    <span class="comment-line">#####################################</span>
    result_h2 &#34;$subTest&#34;
    <a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;

    <span class="comment-line">#</span>
    <span class="comment-line"># EY-07-31-2013: On chassis platforms, the &#34;show process detail&#34; command</span>
    <span class="comment-line">#                prints process information for every active control</span>
    <span class="comment-line">#                node.  This means we have to determine the current node</span>
    <span class="comment-line">#                first and only display the process info for that node.</span>
    set cmd &#34;show process $processName detail&#34;;

    <span class="comment-line">#</span>
    <span class="comment-line"># EY-07-31-2013: The current slot is marked by an &#34;*&#34; right after the</span>
    <span class="comment-line">#                slot name in the output of &#34;show switch&#34;.</span>
    if {[<a name="::Platform_IsChassis(1)"><a href="./platform.tcl.html#::Platform_IsChassis_76">::Platform_IsChassis</a></a>]} {
        set valList [list {Slot: 0}];
        set slotLine [<a name="::GetKeyValue(6)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show switch&#34; $valList 0 1];

        <span class="comment-line">#</span>
        <span class="comment-line"># Breakdown of regular expression:</span>
        <span class="comment-line">#</span>
        <span class="comment-line"># Slot:     Matches &#34;Slot:&#34; at beginning of line.</span>
        <span class="comment-line"># .*        Match everything up to what follows next.</span>
        <span class="comment-line"># \w+       Matches the slot name, e.g. MSM, MM, Slot.</span>
        <span class="comment-line"># -         The separator between the slot name and number.</span>
        <span class="comment-line"># (.)       The slot number, captured for retrieval.</span>
        <span class="comment-line"># &#34; \*&#34;     The active slot marker.</span>
        <span class="comment-line">#</span>
        <span class="comment-line"># Note: This regexp relies on greedy quantifiers as the default</span>
        <span class="comment-line">#       behavior.</span>
        <span class="comment-line">#</span>
        regexp {Slot:.*\w+-(.) \*} $slotLine notUsed currentSlotNum;
        append cmd &#34; slot $currentSlotNum&#34;;
    }

    <span class="comment-line">#</span>
    <span class="comment-line"># EY-07-31-2013: Fixed pattern match to be more specific.</span>
    lappend pidList &#34;{PID +Path} 1 2&#34;;
    set pid [<a name="::GetKeyValue(7)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> $cmd $pidList];
    regsub -all {main} $pid &#34;&#34; pid;
    <a name="::EnableDebugMode(3)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>;
    <a name="::SendACmd(68)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!kill -9 $pid&#34;;
    <a name="::DisableDebugMode(2)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>;
    <a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
}

<strong><a name="::::GetVrString_3157">proc <a href="misc.tcl-annot.html#::::GetVrString">::::GetVrString</a></a></strong> { {DUT 1} } { 
   global DUTs_info
   global switchPort2DefaultRouter

   set xos_version [<a name="::GetVersion(25)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT$DUT 4]
   if {[regexp -nocase &#34;mgmt&#34; $switchPort2DefaultRouter]} {
      if { $xos_version &gt;= &#34;10.2.0&#34; } {
         set virtualRouter VR-mgmt 
       } else {
          set virtualRouter VR-0
       }
   } else {
      if { $xos_version &gt;= &#34;10.2.0&#34; } {
         if {[info exists DUTs_info(UserVR)] &amp;&amp; $DUTs_info(UserVR) != &#34;&#34;} {
            set virtualRouter $DUTs_info(UserVR)
         } else {
            set virtualRouter VR-default
         }
      } else {
         set virtualRouter VR-2
      }
   }
   return $virtualRouter  
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: convertSlotPortRange</span>
<span class="comment-line"># Description: Converts a slot port range to EXOS format.</span>
<span class="comment-line">#              i.e. 2:8-2:12 converts to 2:8-12</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#       start - start slot:port</span>
<span class="comment-line">#       end - end slot:port</span>
<span class="comment-line"># Output args:  Converted range</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       set range [convertSlotPortRange 2:8 2:10]</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::convertSlotPortRange_3194">proc <a href="misc.tcl-annot.html#::::convertSlotPortRange">::::convertSlotPortRange</a></a></strong> {start end} {

    ;<span class="comment-line"># If they match, just return first i.e. 3:8 3:8 --&gt; returns 3:8</span>
    if {$start == $end} {
	return $start
    }

    if {! [regexp {(^[0-9]+):([0-9]+)} $start matchStart startSlot startPort]} {
	set startSlot &#34;&#34;
	set startPort $start
    }

    if {! [regexp {(^[0-9]+):([0-9]+)} $end matchEnd endSlot endPort]} {
	set endSlot &#34;&#34;
	set endPort $end
    }

    ;<span class="comment-line"># Make sure we return highest to lowest</span>
    if {$startPort &gt; $endPort} {
	set tempStart $startPort
	set startPort $endPort
	set endPort $tempStart
    }

    if {$startSlot != $endSlot} {
	puts &#34;Error: startSlot:$startSlot != endSlot:$endSlot&#34;
	return &#34;&#34;
    }

    if {$startSlot != &#34;&#34;} {
	return &#34;$startSlot:$startPort-$endPort&#34;
    } else {
	return &#34;$startPort-$endPort&#34;
    }

}

<strong><a name="::::CatPolOnDUT_3231">proc <a href="misc.tcl-annot.html#::::CatPolOnDUT">::::CatPolOnDUT</a></a></strong> {fileName} {
   global whichDutNow
   global supportedPlatform
   <a name="::EnableDebugMode(4)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
   if {[regexp -nocase &#34;$supportedPlatform&#34; [<a name="::GetPlatform(6)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$whichDutNow]]} {
      <a name="::SendACmd(69)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!cat /config/$fileName.pol&#34;
   } else {
      <a name="::SendACmd(70)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!cat /root/config/$fileName.pol&#34;
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetUniqueFileName</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: It returns a unique file name by combining pid,</span>
<span class="comment-line">#              ip address of machine and the time.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: file name</span>
<span class="comment-line"># Typical usage: set filename [ GetUniqueFileName ]</span>
<span class="comment-line">###################################################################</span>

<strong><a name="::::GetUniqueFileName_3253">proc <a href="misc.tcl-annot.html#::::GetUniqueFileName">::::GetUniqueFileName</a></a></strong> { {suffix &#34;&#34;} } {
   set fileName &#34;temp_&#34;
   set sp &#34;_&#34;
   set pid [pid]
   set ip [<a name="::GetLocalIpaddr(1)"><a href="./misc.tcl.html#::GetLocalIpaddr_3277">::GetLocalIpaddr</a></a>]
   set tt [clock second]
   if { $suffix != &#34;&#34; } {
      append fileName $pid $sp $tt $sp $ip $sp $suffix &#34;.txt&#34;
   } else {
      append fileName $pid $sp $tt $sp $ip &#34;.txt&#34;
   }
   return $fileName
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetLocalIpaddr</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: It returns the ip address of the local machine</span>
<span class="comment-line">#              It parses outout of 'ifconfig' to get the ipaddress</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args:ip address</span>
<span class="comment-line"># Typical usage: set ipaddr [  GetLocalIpaddr]</span>
<span class="comment-line">###################################################################</span>

<strong><a name="::::GetLocalIpaddr_3277">proc <a href="misc.tcl-annot.html#::::GetLocalIpaddr">::::GetLocalIpaddr</a></a></strong> { } {
         

   if { [catch {exec hostname -i } result]} {
       puts &#34;error in snmpwalk: $result&#34;
   } else {
       set resArr $result
       <span class="comment-line">#foreach line $resArr {</span>
       <span class="comment-line">#    result_debug &#34;$line&#34;</span>
       <span class="comment-line">#}</span>
       foreach address $resArr {
           if {$address != &#34;127.0.0.1&#34;} {
                set addr $address
                <a name="::result_debug(61)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a>  &#34;Local Ip Address: $addr&#34;
                return $addr
            }
       }
   }
   <a name="::result_error(12)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Cannot  find local ip addr&#34;
   return 0

}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: ldelete</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Deleting a list element by value</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: list and value</span>
<span class="comment-line"># Output args: the list</span>
<span class="comment-line"># Typical usage: set list [ldelete $list $value]</span>
<span class="comment-line">###################################################################</span>
<strong><a name="::::ldelete_3310">proc <a href="misc.tcl-annot.html#::::ldelete">::::ldelete</a></a></strong> { list  value } {
   set ix [lsearch -exact $list $value]
   if {$ix &gt;= 0} {
      return [lreplace $list $ix $ix]
   } else {
      return $list
   }
}

<span class="comment-line">########################################################################################################</span>
<span class="comment-line">#proc : getDutPortSpeed</span>
<span class="comment-line"># returns the speed of the port  on the dut</span>
<span class="comment-line"># input args : dut port</span>
<span class="comment-line"># return : speed 10 100 1000 10000 40000</span>
<span class="comment-line">#          -1 if speed cannot be found out</span>
<span class="comment-line">#</span>
<span class="comment-line"># usage : getDutPortSpeed 1 1:10</span>
<span class="comment-line">#########################################################################################################</span>
<strong><a name="::::getDutPortSpeed_3328">proc <a href="misc.tcl-annot.html#::::getDutPortSpeed">::::getDutPortSpeed</a></a></strong> {args } {
    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> getDutPortSpeed $args {
        dut &#34;1&#34;
        <a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;1&#34;
    }

    global DUTs_info
    if { ![info exist DUTs_info(DUT${dut},connect)] } {
         <a name="::result_error(13)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;getDutPortSpeed: Dut $dut doesn't exist&#34;
         return -1
    }
    <a name="::Login(19)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUTs_info(DUT${dut},connect)]
    set parameterList &#34;&#34;
    lappend parameterList &#34;{^ *Link State:} 2&#34;
    set speed [<a name="::GetKeyValue(8)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show port $port info detail&#34; $parameterList]
    unset parameterList

    switch $speed {
        &#34;10Mbps,&#34;   { return 10 }
        &#34;100Mbps,&#34;  { return 100 }
        &#34;1Gbps,&#34;    { return 1000 }
        &#34;2.5Gbps,&#34;  { return 2500 }
        &#34;5Gbps,&#34;    { return 5000 }
        &#34;10Gbps,&#34;   { return 10000 }
        &#34;40Gbps,&#34;   { return 40000 }
    }

    <a name="::result_error(14)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34; Unknown port speed Dut=$dut,  Port=$port Speed=$speed&#34;
    return -1
}

<span class="comment-line">########################################################################################################</span>
<span class="comment-line">#proc : getDutPortAutoNeg</span>
<span class="comment-line"># returns the AutoNeg status of the port  on the dut</span>
<span class="comment-line"># input args : dut port</span>
<span class="comment-line"># return : off on </span>
<span class="comment-line">#          -1 if auto negotiation status cannot be found out</span>
<span class="comment-line">#</span>
<span class="comment-line"># usage : getDutPortAutoNeg 1 1:10</span>
<span class="comment-line">#########################################################################################################</span>
<strong><a name="::::getDutPortAutoNeg_3368">proc <a href="misc.tcl-annot.html#::::getDutPortAutoNeg">::::getDutPortAutoNeg</a></a></strong> {args } {
    <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> getDutPortSpeed $args {
        dut &#34;1&#34;
        <a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;1&#34;
    }

    global DUTs_info
    if { ![info exist DUTs_info(DUT${dut},connect)] } {
         <a name="::result_error(15)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;getDutPortSpeed: Dut $dut doesn't exist&#34;
         return -1
    }
    <a name="::Login(20)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUTs_info(DUT${dut},connect)]
    set parameterList &#34;&#34;
    lappend parameterList &#34;{^$port } 4&#34;
    set autoNeg [<a name="::GetKeyValue(9)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show port $port configuration no-refresh&#34; $parameterList]
    unset parameterList

    switch $autoNeg {
        &#34;ON&#34;  { 
              return &#34;on&#34; 
             }
        &#34;OFF&#34; { 
              return &#34;off&#34; 
         }
    }

    <a name="::result_error(16)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34; Unknown port autoneg Dut=$dut,  Port=$port AutoNeg=$autoNeg&#34;
    return -1
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetDutMemory</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: It returns the dut memory information </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: memory size </span>
<span class="comment-line"># Output args: DUT memory</span>
<span class="comment-line"># Typical usage: set dutno [GetDutMemory 256mb]</span>
<span class="comment-line">###################################################################</span>

<strong><a name="::::GetDutMemory_3408">proc <a href="misc.tcl-annot.html#::::GetDutMemory">::::GetDutMemory</a></a></strong> {ramSize} {
   set firstSubStr &#34;DUT&#34;
   set lastSubStr &#34;_CONNECT&#34;
   set dutList &#34;&#34;
   global chassis

   if { $ramSize == &#34;&#34; } {
      return -1
   }

   for {set i 1} {$i &lt;=5} {incr i 1} {
      global $firstSubStr$i$lastSubStr
      if [info exists $firstSubStr$i$lastSubStr] {
         lappend DUTList $i
      }
   }

   foreach testDUT $DUTList {
      <a name="::Login(21)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
      set parameterList &#34;&#34;
      if {[regexp -nocase &#34;$chassis&#34; [<a name="::GetPlatform(7)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$i]]} {
      lappend parameterList &#34;{A.*Free} 2&#34;
      } else {
      lappend parameterList &#34;{Free} 2&#34;
      }
      set totalMemory [<a name="::GetKeyValue(10)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show memory&#34; $parameterList]
      unset parameterList
      <span class="comment-line">#set totalMemory [string range $totalMemory 1 5]</span>
      <span class="comment-line">#result_debug &#34;Afer range The mem: $totalMemory&#34;</span>
      <span class="comment-line">#if {[string tolower $ramSize] == [string tolower $totalMemory]}</span>
         <span class="comment-line">#result_debug &#34;The dut no. $testDUT&#34;</span>

      set totalMemory [lindex $totalMemory 0]
        <a name="::result_debug(62)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the total free memory is $totalMemory&#34;
       set freememory [expr $totalMemory/1024]
        <a name="::result_debug(63)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the free memory is $freememory&#34;
       if {$totalMemory &gt;= $ramSize} {
          lappend dutList $testDUT
      }
      <a name="::result_debug(64)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The dut list length. $dutList&#34;
   }
        set number [llength $dutList]
        <a name="::result_debug(65)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The number is $number&#34;
         return $number
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetDutNumber</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: It returns the dut no. with the memory size and</span>
<span class="comment-line">#              number of DUTs</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: memory size and number of DUTs with this memory</span>
<span class="comment-line"># Output args: DUT numbers</span>
<span class="comment-line"># Typical usage: set dutno [GetDutNumber 256mb 2]</span>
<span class="comment-line">###################################################################</span>

<strong><a name="::::GetDutNumber_3465">proc <a href="misc.tcl-annot.html#::::GetDutNumber">::::GetDutNumber</a></a></strong> {ramSize num} {
   set firstSubStr &#34;DUT&#34;
   set lastSubStr &#34;_CONNECT&#34;
   set dutList &#34;&#34;

   if { $ramSize == &#34;&#34; &amp;&amp; $num == &#34;&#34; } {
      return -1
   }

   for {set i 1} {$i &lt;=5} {incr i 1} {
      global $firstSubStr$i$lastSubStr
      if [info exists $firstSubStr$i$lastSubStr] {
         lappend DUTList $i
      }
   }

   foreach testDUT $DUTList {
      <a name="::Login(22)"><a href="./login.tcl.html#::Login_24">::Login</a></a>  [expr $$firstSubStr$testDUT$lastSubStr]
      lappend parameterList &#34;{Total DRAM Size:} 2&#34;
      set totalMemory [<a name="::GetKeyValue(11)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show memory&#34; $parameterList]
      unset parameterList
      set totalMemory [string range $totalMemory 1 5]
      <span class="comment-line">#result_debug &#34;Afer range The mem: $totalMemory&#34;</span>
      if {[string tolower $ramSize] == [string tolower $totalMemory]} {
         <span class="comment-line">#result_debug &#34;The dut no. $testDUT&#34;</span>
         lappend dutList $testDUT
      }
      <span class="comment-line">#result_debug &#34;The dut list length. $dutList&#34;</span>
      if {$num == [llength $dutList]} {
         return $dutList
      }
   }
}

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: checkLACPAggregation</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc checks whether that LACP Aggregation is properly</span>
<span class="comment-line"># formed between the ports of two DUT's</span>
<span class="comment-line">#              ip address of machine and the time.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: DUT Name, Master Port of the LACP trunk,Ports list that form the trunk and</span>
<span class="comment-line">#             Port priority</span>
<span class="comment-line"># Output args: Returns &#34;ok&#34; if success &#34;error&#34; if failure</span>
<span class="comment-line"># Typical usage: checkLACPAggregation 1 10:1 &#34;10:2 10:3 10:4&#34; 20</span>
<span class="comment-line">##############################################################################################</span>

<strong><a name="::::checkLACPAggregation_3512">proc <a href="misc.tcl-annot.html#::::checkLACPAggregation">::::checkLACPAggregation</a></a></strong> {DUT masterPort portIdList portPriority} {
   global DUT${DUT}_CONNECT i386Platform
   global DUTs_info;

   <a name="::Login(23)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${DUT}_CONNECT];
   if {$DUT == 1} {<a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5}  
   foreach portId $portIdList {
       if {[regexp -nocase &#34;$i386Platform&#34; $DUTs_info(DUT${DUT},platform)]} {
           lappend parameterList &#34;{ls_ports_show {loadShareMaster linkState port}} {$masterPort 1 $portId}  exist&#34;
           <a name="::CheckDictValue(1)"><a href="./jsonLib.tcl.html#::CheckDictValue_319">::CheckDictValue</a></a> -cmd &#34;show sharing&#34; -parameterList $parameterList -time {s: 0 i: 3 f: 15}
       } else {
           lappend parameterList &#34;{$portId.*Current.*Selected.*Collect-Dist.*A-GSCD} exist&#34;
           <a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show lacp lag $masterPort&#34; $parameterList \
                          -time {s: 0 i: 3 d: 15 f: 15 r} -comment \
                         &#34;- Checking LACP Aggregation for the port $portId on DUT$DUT&#34;
       }
       unset parameterList
   }
}

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: clearCounters</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc clears the counters of the DUT's</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: DUT Name List</span>
<span class="comment-line"># Output args: None </span>
<span class="comment-line"># Typical usage: clearCounters &#34;DUT1 DUT2&#34;</span>
<span class="comment-line">##############################################################################################</span>

<strong><a name="::::clearCounters_3542">proc <a href="misc.tcl-annot.html#::::clearCounters">::::clearCounters</a></a></strong> {DUTNameList} {

 global DUTs_info;
 foreach DUTName $DUTNameList {

         global ${DUTName}_CONNECT;
         <a name="::Login(24)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];
         <a name="::SendACmd(71)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear counters&#34;
         <a name="::SendACmd(72)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear l2stats&#34;
         <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5

  }

}

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: CheckLACPTrunkLoadShare</span>
<span class="comment-line">#  </span>
<span class="comment-line"># Description: This proc checks the traffic flow load share across LACP trunk</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line"># </span>
<span class="comment-line">#  -txPortId           - Port that sends traffic into LACP trunk</span>
<span class="comment-line">#  -rxTrunkPortIdList  - List of ports in the trunk</span>
<span class="comment-line">#  -DUTName            - DUT Name</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: CheckLACPTrunkLoadShare 1 &#34;2 3 4&#34; DUT1</span>
<span class="comment-line">##############################################################################################</span>


<strong><a name="::::CheckLACPTrunkLoadShare_3574">proc <a href="misc.tcl-annot.html#::::CheckLACPTrunkLoadShare">::::CheckLACPTrunkLoadShare</a></a></strong> {txPortId rxTrunkPortIdList DUTName {comment &#34;&#34;}} {

   set percent_tolerance 1.5;
   set txRate [<a name="::GetNumFramesSent(1)"><a href="./ePTRx.tcl.html#::GetNumFramesSent_1324">::GetNumFramesSent</a></a> $txPortId];
   <a name="::result_debug(66)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; txRate of $txPortId : $txRate &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#34;
   <a name="::report_start_test(9)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking Rates $comment&#34;;
   
   global ${DUTName}_CONNECT;
   <a name="::Login(25)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];

   foreach var $rxTrunkPortIdList {
  
      set rxPort [lindex $var 0];
      set rxPercent [lindex $var 1];
      set tag [lindex $var 2];
      set rtValue &#34;ok&#34;;

      set key &#34;&#34;
      lappend key &#34;$rxPort 4&#34;
      set txPacketCountToTrim [<a name="::GetKeyValue(12)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show port $rxPort statistics&#34; $key]
      set txPacketCount [string trim $txPacketCountToTrim &#34;{} #&#34;]
      set rxRate $txPacketCount

      <a name="::report_start_test(10)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Comparing txRate($txPortId)=$txRate and rxRate($rxPort)=$rxRate&#34;;
      <a name="::result_debug(67)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Comparing txRate($txPortId)=$txRate and rxRate($rxPort)=$rxRate&#34;;
       
      if { $txRate == 0 } {         
         if { $rxRate == 0 } {
            <a name="::result_error(17)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;txRate($txPortId)=rxRate($rxPort)=0&#34;;
            set rtValue &#34;error&#34;;
         } else {
            <a name="::result_error(18)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;txRate($txPortId)=0 but rxRate($rxPort)=$rxRate&#34;;
            set rtValue &#34;error&#34;;
         }
      } elseif { $rxRate &lt;= 4 } {
            <a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;txRate($txPortId)=rxRate($rxPort)=0&#34;; 
            set rtValue &#34;ok&#34;;        
      } else {
         if {$rxPercent == 0} {
            set rxPercent 100;
         } 
         set exp_rxRate [expr abs (double($txRate) * $rxPercent/100)];
         set diff [expr abs( double($exp_rxRate) - double($rxRate) )];
         puts &#34;Rate $exp_rxRate Diff $diff&#34;;
         if {$exp_rxRate &lt; 0.0001 } {
            set pPercent [expr $diff * $percent_tolerance] ;<span class="comment-line"># not sure this is right</span>
         } else {
            set pPercent [expr double($diff) / double($exp_rxRate) * 100.0];
         }         
         <a name="::result_debug(68)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- pPercent=$pPercent&#34;;
         
         if { $pPercent &lt;= $percent_tolerance } {
            <a name="::result_ok(9)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Passed&#34;;
              set rtValue &#34;gotit&#34;;
         } else {
            set difv 100;
            if {$txRate &gt; $rxRate} {
                set difv [expr $txRate - $rxRate]; 
            } else {
                set difv [expr $rxRate - $txRate];
            }
            if {$difv &lt; 4} {
                <a name="::result_ok(10)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Passed&#34;;
                  set rtValue &#34;gotit&#34;;
            } else {
                <a name="::result_error(19)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Failed. diff percentage:$pPercent exceeds %tolerance:$percent_tolerance&#34;;
                <a name="::result_error(20)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> [format &#34;Difference (%01.2f%%) exceeds tolerance (%01.2f%%). Tx Rate is $txRate, Rx Rate is $rxRate.\n&#34; $pPercent $percent_tolerance];
                set rtValue &#34;error&#34;;
            }
         }
      }
      <a name="::report_end_test(10)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;    
      lappend rtList $rtValue; 
   }
   <a name="::result_debug(69)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rtList = $rtList&#34;;
   set i 0;
   set x 0;
   set port 0;
   set temp &#34;&#34;
   foreach var $rtList {
       if {$var == &#34;gotit&#34;} {
           set temp [lindex $rxTrunkPortIdList $x];
           set port [lindex $temp 0];
           incr i;
       }   
       incr x;
   }
   if {$i == 1} {
       <a name="::report_start_test(11)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Port ($port) receives the traffic only&#34;;
       <a name="::result_ok(11)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Port ($port) receives the traffic only&#34;;
       <a name="::report_end_test(11)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;   
   } else {
       <a name="::report_start_test(12)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;More than one port received the traffic!&#34;;
       <a name="::result_error(21)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;More than one port received the traffic!&#34;; 
       <a name="::report_end_test(12)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;    
       set port 0;
   }
   <a name="::report_end_test(13)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;   
     
   return $port;
}

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: getIxiaCardType</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc returns the ixia card type of a ixia port.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#</span>
<span class="comment-line">#  -ixPort             - Ixia port</span>
<span class="comment-line">#           </span>
<span class="comment-line"># Output args: Ixia card name</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: getIxiaCardType 8</span>
<span class="comment-line">##############################################################################################</span>

<strong><a name="::::getIxiaCardType_3690">proc <a href="misc.tcl-annot.html#::::getIxiaCardType">::::getIxiaCardType</a></a></strong> {ixPort} {
      
<a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $ixPort chasis card port
set cardName [<a name="::card(1)"><a href="./ePTClient.tcl.html#::card_424">::card</a></a> cget -typeName]
return $cardName
}

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: getIxiaPortLinkState</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc returns the Link state of the ixia port.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#</span>
<span class="comment-line">#  -ixPort             - Ixia port</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: Ixia Link State</span>
<span class="comment-line">#  Return Value  Link State</span>
<span class="comment-line">#  ------------  ----------</span>
<span class="comment-line">#    0           Link Down</span>
<span class="comment-line">#    1           Link Up</span>
<span class="comment-line">#</span>
<span class="comment-line">#    There are 44 other link states,please refer to ixia documentation for more info</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: getIxiaPortLinkState 8</span>
<span class="comment-line">##############################################################################################</span>


<strong><a name="::::getIxiaPortLinkState_3718">proc <a href="misc.tcl-annot.html#::::getIxiaPortLinkState">::::getIxiaPortLinkState</a></a></strong> {ixPort} {
    
<a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $ixPort chasis card port
<a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chasis $card $port
set linkState [<a name="::port(5)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -linkState]
return $linkState
}

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: getDUTPortRxPacketCount</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc returns number of packets received on a DUT port.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#</span>
<span class="comment-line">#  -DUT                - DUT Name  </span>
<span class="comment-line">#  -Port               - DUT Port</span>
<span class="comment-line">#           </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: getDUTPortRxPacketCount DUT1 9</span>
<span class="comment-line">##############################################################################################</span>

<strong><a name="::::getDUTPortRxPacketCount_3741">proc <a href="misc.tcl-annot.html#::::getDUTPortRxPacketCount">::::getDUTPortRxPacketCount</a></a></strong> {DUT Port} {
    
 set key &#34;&#34;
 lappend key &#34;$Port 4&#34;
 set rxPacketCountToTrim [<a name="::GetKeyValue(13)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show port $Port statistics&#34; $key]
 set rxPacketCount [string trim $rxPacketCountToTrim &#34;{} #&#34;]
 return $rxPacketCount
       
}
       
<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: getDUTPortTxPacketCount</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Description: This proc returns number of packets sent from a DUT port.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line"># </span>
<span class="comment-line">#  -dutNum             - DUT Number</span>
<span class="comment-line">#  -Port               - DUT Port</span>
<span class="comment-line"># </span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># </span>
<span class="comment-line"># Typical usage: getDUTPortTxPacketCount 2  10</span>
<span class="comment-line">##############################################################################################</span>
       
<strong><a name="::::getDUTPortTxPacketCount_3766">proc <a href="misc.tcl-annot.html#::::getDUTPortTxPacketCount">::::getDUTPortTxPacketCount</a></a></strong> {dutNum Port} {
   
 global DUT${dutNum}_CONNECT 
 <a name="::Login(26)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dutNum]_CONNECT]
 set key &#34;&#34;
 lappend key &#34;$Port 2&#34;
 set txPacketCountToTrim [<a name="::GetKeyValue(14)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show port $Port statistics&#34; $key]
 set txPacketCount [string trim $txPacketCountToTrim &#34;{} #&#34;]
 return $txPacketCount

}

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: ConfirmLACPTraffic</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc is used to check continous traffic across LACP ports.</span>
<span class="comment-line">#       </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#   </span>
<span class="comment-line">#  -txPort             - Ixia port sending continous traffic </span>
<span class="comment-line">#  -verifyPortList     - LACP ports </span>
<span class="comment-line">#  -DUT                - DUT number</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: [ConfirmLACPTraffic 1 &#34;[GetATrunkPort 2 1 1] [GetATrunkPort 2 1 2]&#34; 2]</span>
<span class="comment-line">##############################################################################################</span>


<strong><a name="::::ConfirmLACPTraffic_3795">proc <a href="misc.tcl-annot.html#::::ConfirmLACPTraffic">::::ConfirmLACPTraffic</a></a></strong> { txPort verifyPortList DUT} {
    <a name="::result_debug(70)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Wait 6 seconds for things to settle down...&#34;
    <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 6

    set numFramesSent [<a name="::GetNumFramesSent(2)"><a href="./ePTRx.tcl.html#::GetNumFramesSent_1324">::GetNumFramesSent</a></a> $txPort]

    set numFramesRcd 0
    foreach portnum $verifyPortList {
        incr numFramesRcd [<a name="::getDUTPortRxPacketCount(1)"><a href="./misc.tcl.html#::getDUTPortRxPacketCount_3741">::getDUTPortRxPacketCount</a></a> $DUT $portnum]
    }
    <a name="::StopPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $txPort

    <a name="::result_debug(71)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numFramesSent=$numFramesSent; numFramesRcd=$numFramesRcd&#34;

    if { $numFramesRcd &gt;= [expr $numFramesSent*0.7] } {
        <span class="comment-line"># Pass</span>
        return 1
    } else {
        <span class="comment-line"># Fail</span>
        return 0
    }
}

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: isInRange</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc checks given values are with in the tolerance value</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#</span>
<span class="comment-line">#  -tolerance          - +/- Tolerance value</span>
<span class="comment-line">#  -received           -  Value1</span>
<span class="comment-line">#  -expected           - value2</span>
<span class="comment-line">#  -updown             - up      above received value</span>
<span class="comment-line">#                        down    below received value</span>
<span class="comment-line">#                        updown  above &amp; below received value</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: CheckLACPTrunkLoadShare 1 &#34;2 3 4&#34; DUT1</span>
<span class="comment-line">##############################################################################################</span>

<strong><a name="::::isInRange_3837">proc <a href="misc.tcl-annot.html#::::isInRange">::::isInRange</a></a></strong> { tolerance received expected updown } {
  set rslt 0
  if { $updown == &#34;updown&#34; } {
    if {($received &gt;= [expr $expected - $tolerance]) &amp;&amp; ($received &lt;= [expr $expected + $tolerance])} {
      set rslt 1
    }
  } elseif  { $updown == &#34;down&#34; } {
    if {$received &gt;= [expr $expected - $tolerance]} {
      set rslt 1
    }
  }  elseif  { $updown == &#34;up&#34; } {
    if {$received &lt;= [expr $expected + $tolerance]} {
      set rslt 1
    }
  }
  return $rslt
}

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># Procedure Name: CheckDutPortState</span>
<span class="comment-line"># </span>
<span class="comment-line"># Description: This proc check whether a DUT port is active</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#</span>
<span class="comment-line">#  -portList             - List of ports</span>
<span class="comment-line">#  -DUTName              - DUT of the port</span>
<span class="comment-line">#  -state                - port state to be checked; active by default</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: CheckDutPortState &#34;1 2&#34; &#34;DUT1&#34;</span>
<span class="comment-line">##############################################################################################</span>


<strong><a name="::::CheckDutPortState_3871">proc <a href="misc.tcl-annot.html#::::CheckDutPortState">::::CheckDutPortState</a></a></strong> {portList DUTName {state &#34;active&#34;}} {
    global ${DUTName}_CONNECT
    global DUTs_info
    
    <a name="::Login(27)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];
     
    foreach port $portList {
       lappend parameterList &#34;{.*$port.*$state} exist&#34;
       <a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show port $port info&#34; $parameterList \
                      -comment &#34;To check whether port $port of $DUTName is $state&#34;
       unset parameterList
    }
}  


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: SkipTestAfterFailure</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This function skips the $listOfTests in case of a failure in a testcase </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              listOfTests - List of testcases to skip </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      SkipTestAfterFailure &#34;1.2.1 1.2.2&#34;</span>
<span class="comment-line"># Note : This procedure can only be called after at least one report_end_test.</span>
<span class="comment-line"># (Because report_end_test increments the fail count)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SkipTestAfterFailure_3901">proc <a href="misc.tcl-annot.html#::::SkipTestAfterFailure">::::SkipTestAfterFailure</a></a></strong> {listOfTests} {
   global skipTestsOnFailure
   global origFailCount
   global failCount

   if { $origFailCount != $failCount } {
      <a name="::result_debug(72)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;origFailCount = $origFailCount, failCountAfter = $failCount&#34;
      set skipTestsOnFailure $listOfTests
  }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckTestsRemaining</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This function returns a 1 if the test passed is in the </span>
<span class="comment-line">#              list of tests to run</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              test case proc name  </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      if [CheckTestsRemaining 1.2.3] {lappend FilesToUpload &#34;Tmp/tmp_1.2.3&#34;}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckTestsRemaining_3924">proc <a href="misc.tcl-annot.html#::::CheckTestsRemaining">::::CheckTestsRemaining</a></a></strong> {testCase} {
   global TestsRemaining
   if { [lsearch $TestsRemaining $testCase] &gt;= 0} {
      return 1;
   } else {
      return 0;
   }
}

<span class="comment-line"># Determines if two dut's are the same type of platform (GNSS/BCM).</span>
<span class="comment-line"># Returns 1 if same type, 0 if different.</span>
<strong><a name="::::IsSamePlatformType_3935">proc <a href="misc.tcl-annot.html#::::IsSamePlatformType">::::IsSamePlatformType</a></a></strong> { dutList } {

    global gnssPlatform bcmPlatform

    <a name="::result_debug(73)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Verifying that all DUTs in '$dutList' are the same type of platform (GNSS/BCM)&#34;

    if { [llength $dutList] &lt; 2 } {
	<span class="comment-line"># only one platform supplied, of course it's same as itself!</span>
	return 1
    }

    set counter 0
    foreach firstDut $dutList {
	incr counter
	set remainingDuts [lrange $dutList $counter end]
	foreach secondDut $remainingDuts {
	    if { ([regexp $gnssPlatform [<a name="::GetPlatform(8)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $firstDut]]) &amp;&amp; ([regexp $bcmPlatform [<a name="::GetPlatform(9)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $secondDut]]) } {
		return 0
	    }
	    if { ([regexp $bcmPlatform [<a name="::GetPlatform(10)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $firstDut]]) &amp;&amp; ([regexp $gnssPlatform [<a name="::GetPlatform(11)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $secondDut]]) } {
		return 0
	    }
	}
    }

    return 1
}

<span class="comment-line"># Takes as input a filename and returns a list containing all lines in that file.</span>
<strong><a name="::::GetFileLinesList_3964">proc <a href="misc.tcl-annot.html#::::GetFileLinesList">::::GetFileLinesList</a></a></strong> { filename } {
   set fileid [open $filename &#34;r&#34;]
   set filelineslist &#34;&#34;
   set count 0
   set count2 0
   while { ! [eof $fileid] } {
        incr count
	incr count2
	gets $fileid nextLine
	set filelineslist &#34;$filelineslist\n[string trim $nextLine]&#34;
	if { $count2 == 1000 } {
	   puts &#34;$count Lines read...&#34;
	   set count2 0
	}
   }

   close $fileid
   set filelineslist [string trim $filelineslist]
   set filelineslist [split $filelineslist &#34;\n&#34;]

   return $filelineslist
}

<strong><a name="::::get_platform_blade_3987">proc <a href="misc.tcl-annot.html#::::get_platform_blade">::::get_platform_blade</a></a></strong> {cfgFile} {

  <span class="comment-line">#puts &#34;get_platform_blade: cfgFile $cfgFile&#34;</span>
  source ../../main/runReg.cfg
  global regPath
  set pwd [pwd]
  foreach platform_code_this [array names regplatform] {
      <span class="comment-line">#puts &#34;$platform_code_this == $regplatform($platform_code_this)&#34;</span>
      set platform_code_lst_this $regplatform($platform_code_this)
      set platform_this [lindex $platform_code_lst_this 0]
      set blade_this [lindex $platform_code_lst_this 1]
      set cfg_this [lindex $platform_code_lst_this 2]
      set regType [lindex $platform_code_lst_this 3]
      <span class="comment-line">#puts &#34;blade_this $blade_this,cfg_this $cfg_this&#34;</span>

     if {$cfg_this == $cfgFile &amp;&amp; [regexp -nocase $regType [file tail $regPath]]} {
       return $blade_this
     } elseif {$cfg_this == $cfgFile &amp;&amp; [regexp -- &#34;cli&#34; $regPath]} {
       return $blade_this
     }
  }
  return &#34;not_found&#34;
}
<span class="comment-line"># Determines if two dut's are the same type of platform (GNSS/BCM).</span>
<span class="comment-line"># Returns 1 if same type, 0 if different.</span>
<strong><a name="::::IsSamePlatformType_4012">proc <a href="misc.tcl-annot.html#::::IsSamePlatformType">::::IsSamePlatformType</a></a></strong> { dutList } {

    global gnssPlatform bcmPlatform

    <a name="::result_debug(74)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Verifying that all DUTs in '$dutList' are the same type of platform (GNSS/BCM)&#34;

    if { [llength $dutList] &lt; 2 } {
	<span class="comment-line"># only one platform supplied, of course it's same as itself!</span>
	return 1
    }

    set counter 0
    foreach firstDut $dutList {
	incr counter
	set remainingDuts [lrange $dutList $counter end]
	foreach secondDut $remainingDuts {
	    if { ([regexp $gnssPlatform [<a name="::GetPlatform(12)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $firstDut]]) &amp;&amp; ([regexp $bcmPlatform [<a name="::GetPlatform(13)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $secondDut]]) } {
		return 0
	    }
	    if { ([regexp $bcmPlatform [<a name="::GetPlatform(14)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $firstDut]]) &amp;&amp; ([regexp $gnssPlatform [<a name="::GetPlatform(15)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $secondDut]]) } {
		return 0
	    }
	}
    }

    return 1
}

<span class="comment-line"># Takes as input a filename and returns a list containing all lines in that file.</span>
<strong><a name="::::GetFileLinesList_4041">proc <a href="misc.tcl-annot.html#::::GetFileLinesList">::::GetFileLinesList</a></a></strong> { filename } {
   set fileid [open $filename &#34;r&#34;]
   set filelineslist &#34;&#34;
   set count 0
   set count2 0
   while { ! [eof $fileid] } {
        incr count
	incr count2
	gets $fileid nextLine
	set filelineslist &#34;$filelineslist\n[string trim $nextLine]&#34;
	if { $count2 == 1000 } {
	   puts &#34;$count Lines read...&#34;
	   set count2 0
	}
   }

   close $fileid
   set filelineslist [string trim $filelineslist]
   set filelineslist [split $filelineslist &#34;\n&#34;]

   return $filelineslist
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CompareVersion_eware</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Compare the version with the version on the dut</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              version</span>
<span class="comment-line">#              dut name</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             [CompareVersion $version $DUTName]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::CompareVersion_eware_4082">proc <a href="misc.tcl-annot.html#::::CompareVersion_eware">::::CompareVersion_eware</a></a></strong> {<a name="::version(2)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> {DUTName &#34;DUT1&#34;}} {

    global DUTs_info;

    <a name="::result_debug(75)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;CompareVersion build($version) with SW($DUTs_info($DUTName,version)) on DUT $DUTName&#34;
    set vn [<a name="::GetVersion_eware(1)"><a href="./misc.tcl.html#::GetVersion_eware_4158">::GetVersion_eware</a></a> $DUTName 4];
    set bn [<a name="::GetVersion_eware(2)"><a href="./misc.tcl.html#::GetVersion_eware_4158">::GetVersion_eware</a></a> $DUTName 3];

    <span class="comment-line"># ----- Add EXOS 4 digit case 7.3.0.22</span>
    <span class="comment-line"># Is the version string to compared a 4Digit string?</span>
    set exos4Digit [regexp -nocase {^[0-9]+.[0-9a-z]+.[0-9]+.([0-9]*)} $version]
    if {$exos4Digit} {
        set flag [regexp -nocase {^([0-9]+.[0-9a-z]+.[0-9]+).([0-9]*)} $version vs vn1 bn1]
    } else {
        set flag [regexp -nocase {^(.*)b(.*)} $version vs vn1 bn1];
    }
    if {$flag} {
        <span class="comment-line"># -- compare release and build number</span>
        if {$vn1 &gt; $vn} {
            return 1;
        } elseif {$vn1 &lt; $vn} {
            return -1;
        } else {
          <a name="::result_debug(76)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Build bld($bn1) sw($bn)&#34;;
          if {$bn1 &gt; $bn} {
              return 1;
          } elseif {$bn1 &lt; $bn} {
              return -1;
          } else {
              return 0;
          }
        }
    } else {
        <span class="comment-line"># ---- compare only release number</span>
        set sw_fullversion $vn; <span class="comment-line">#The version ONLY of software on DUT 1 (7.1.0) ;</span>
        set lng [string length $version]; <span class="comment-line">#Length of the version to compare with the DUT version ;</span>
        <span class="comment-line"># If the ver str to compare is &gt; than the ver str on the DUT, temp DUT ver str is not changed</span>
        if {$lng &gt;= [string length $sw_fullversion]} {
            set sw_shortversion $sw_fullversion;
        } else {
            <span class="comment-line"># If the ver str to compare is &lt; than the ver str on the DUT, make temp DUT ver str same length</span>
            set sw_shortversion [string range $sw_fullversion 0 [expr $lng-1]];
        }

        if {($version == &#34;6.2e&#34;) &amp;&amp; ($sw_shortversion != &#34;6.2e&#34;)} {
            <span class="comment-line"># to prevent s24lc code</span>
            return 1;
        } elseif {$version &gt; $sw_shortversion} {
            return 1;
        } elseif {$version &lt; $sw_shortversion} {
            return -1;
        } else {
            return 0;
        }
    }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetVersion_eware</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Get EW version on the DUT</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              DUTName</span>
<span class="comment-line">#              level</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              return version</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             [GetVersion &#34;DUT1&#34; 2]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetVersion_eware_4158">proc <a href="misc.tcl-annot.html#::::GetVersion_eware">::::GetVersion_eware</a></a></strong> {{DUTName &#34;DUT1&#34;} {level &#34;1&#34;} } {
global DUTs_info
if {$level == &#34;1&#34; } {
   <span class="comment-line"># -- return release and build number x.x.xbx</span>
   return $DUTs_info($DUTName,VERSION)
} elseif {$level == &#34;2&#34;} {
   <span class="comment-line"># -- return partly release number x.x</span>
   set x $DUTs_info($DUTName,version)
   set ver 0;
   set match 0;
<span class="comment-line">#   set flg [regexp -nocase {^([0-9]+.[0-9a-z]+).[0-9].*} $x match ver]</span>
   set flg [regexp -nocase {^([0-9]+.[0-9]+).*.[0-9].*} $x match ver]
   if {$flg} {
      return $ver
   } else {
      return $match
   }
} elseif {$level == &#34;3&#34;} {
   <span class="comment-line"># -- return build number</span>
   set match 0;
   set build 0;
   set x $DUTs_info($DUTName,version)
   <span class="comment-line"># Add EXOS 4 digit case 7.3.0.22</span>
   set exos4Digit [regexp -nocase {^[0-9]+.[0-9a-z]+.[0-9]+.([0-9]*)} $x]
   if {$exos4Digit} {
       set flg [regexp -nocase {^[0-9]+.[0-9a-z]+.[0-9]+.([0-9]*)} $x match build]
   } else {
       set flg [regexp -nocase {^[0-9]+.[0-9a-z]+.[0-9]+[a-z]+([0-9]*)} $x match build]
   }
   if {$flg} {
      return $build
   } else {
      return $match
   }
} elseif {$level == &#34;4&#34;} {
   <span class="comment-line"># -- return release number x.x.x</span>
   set match 0;
   set build 0;
   set x $DUTs_info($DUTName,version)
   <span class="comment-line"># Add EXOS 4 digit case 7.3.0.22</span>
   set exos4Digit [regexp -nocase {^[0-9]+.[0-9a-z]+.[0-9]+.([0-9]*)} $x]
   if {$exos4Digit} {
       set flg [regexp -nocase {^([0-9]+.[0-9a-z]+.[0-9]+).[0-9]*} $x match ver]
   } else {
       set flg [regexp -nocase {^([0-9]+.[0-9a-z]+.[0-9]+)[a-z]+} $x match ver]
   }
   if {$flg} {
      return $ver
   } else {
      return $match
   }
}

return $DUTs_info($DUTName,version)
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetUnUsedPort</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Get an unused port that is neigher a port ID</span>
<span class="comment-line">#              or a trunk port.</span>
<span class="comment-line">#              - This procedure is initially used to find a</span>
<span class="comment-line">#                loopback port to &#34;burn&#34;.  The port does not</span>
<span class="comment-line">#                need to be active.</span>
<span class="comment-line">#              - Match Count was added, so the proc can return</span>
<span class="comment-line">#                more than just the first empty port</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: DUTNum, MatchCount</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              return port number (# or #:#)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             - return the first unused port on dut 1</span>
<span class="comment-line">#             set myPort [GetUnUsedPort 1 1]</span>
<span class="comment-line">#             - return the second unused port on dut 1</span>
<span class="comment-line">#             set myPort [GetUnUsedPort 1 2]</span>

<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetUnUsedPort_4239">proc <a href="misc.tcl-annot.html#::::GetUnUsedPort">::::GetUnUsedPort</a></a></strong> {{DUTNum 1} {MatchCount 1} } {
global portMappingList
global trunkPortList
global DUTs_info
global chassis

    set portsUsed &#34;&#34;
    set slotsUsed &#34;&#34;
    set stackable 0
    <span class="comment-line">#</span>
    <span class="comment-line"># Gather a list of portId slots and ports in use</span>
    <span class="comment-line">#</span>
    if {[info exists portMappingList] &amp;&amp; $portMappingList != &#34;&#34;} {
        foreach portMap $portMappingList {
            set portId [lindex $portMap 0]
            set dutNumber [lindex $portMap 2]
            if {[regexp -nocase &#34;$chassis&#34; $DUTs_info(DUT${DUTNum},platform)]} {
                if {$dutNumber == &#34;$DUTNum&#34;} {
                    lappend portsUsed [<a name="::MapDUTPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $dutNumber]
                    lappend slotsUsed [lindex [split [<a name="::MapDUTPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $dutNumber] :] 0];
                }
            } else {
                set stackable 1
                if {$dutNumber == &#34;$DUTNum&#34;} {
                    lappend portsUsed [<a name="::MapDUTPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portId $dutNumber]
                }
            }
        }
    }
    <span class="comment-line">#</span>
    <span class="comment-line"># Gather a list of trunk port slots and ports in use</span>
    <span class="comment-line">#</span>
    if {[info exists trunkPortList] &amp;&amp; $trunkPortList != &#34;&#34;} {
        foreach trunkMap $trunkPortList {
            set fromDUT [lindex $trunkMap 0]
            set dutNumber $fromDUT
            set toDUT [lindex $trunkMap 1]
            if {[info exists trunkLinkCount($fromDUT,$toDUT)]} {
                set trunkLinkCount($fromDUT,$toDUT) [expr $trunkLinkCount($fromDUT,$toDUT) + 1]
            } else {
                set trunkLinkCount($fromDUT,$toDUT) 1
            }
    
            if {[regexp -nocase &#34;$chassis&#34; $DUTs_info(DUT${dutNumber},platform)]} {
                if {$dutNumber == &#34;$DUTNum&#34;} {
                    lappend portsUsed [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $fromDUT $toDUT $trunkLinkCount($fromDUT,$toDUT)]
                    lappend slotsUsed [lindex [split [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $fromDUT $toDUT $trunkLinkCount($fromDUT,$toDUT)] :] 0]
                }
            } else {
                if {$dutNumber == &#34;$DUTNum&#34;} {
                    set stackable 1
                    lappend portsUsed [<a name="::::GetATrunkPort(5)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $fromDUT $toDUT $trunkLinkCount($fromDUT,$toDUT)]
                }
            }
        }
    }
    <span class="comment-line">#</span>
    <span class="comment-line"># Pick the unused port</span>
    <span class="comment-line">#</span>
    set portCount 0
    if {!$stackable} {
        <span class="comment-line"># This is a chassis... Pick the first used slot to search for an unused port</span>
        set mySlot [lindex $slotsUsed 0]
        for {set i 1} {$i&lt;20} {incr i} {
            if {[lsearch $portsUsed ${mySlot}:$i] &lt; 0} {
                incr portCount
                if {$portCount == $MatchCount} {
                    <a name="::result_debug(77)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Found the $portCount Unused Port: ${mySlot}:$i&#34;;
                    return ${mySlot}:$i;
                }
            }
        }
    } else {
        for {set i 1} {$i&lt;20} {incr i} {
            if {[lsearch $portsUsed $i] &lt; 0} {
                incr portCount
                if {$portCount == $MatchCount} {
                    <a name="::result_debug(78)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Found the $portCount Unused Port: $i&#34;;
                    return $i;
                }
            }
        }
    }
    return 0;
}
<span class="comment-line"># EY-06-17-2008: Added utility routines to check if functions have run and</span>
<span class="comment-line"># completed successfully.</span>
<strong><a name="::::ProcStarts_4326">proc <a href="misc.tcl-annot.html#::::ProcStarts">::::ProcStarts</a></a></strong> {} {
    global proc_info;

    set procName [lindex [info level -1] 0];
    if {[info exists proc_info($procName,called)]} {
        incr proc_info($procName,called);
    } else {
        set proc_info($procName,called) 1;
    }
}

<strong><a name="::::ProcHasRun_4337">proc <a href="misc.tcl-annot.html#::::ProcHasRun">::::ProcHasRun</a></a></strong> {procName numTimes} {
    global proc_info;

    if {[info exists proc_info($procName,finished)]} {
        return [expr $proc_info($procName,finished) &gt;= $numTimes];
    } else {
        return 0;
    }
}

<strong><a name="::::ProcFinished_4347">proc <a href="misc.tcl-annot.html#::::ProcFinished">::::ProcFinished</a></a></strong> {} {
    global proc_info;

    set procName [lindex [info level -1] 0];
    if {[info exists proc_info($procName,called)]} {
        if {[info exists proc_info($procName,finished)]} {
            incr proc_info($procName,finished);
        } else {
            set proc_info($procName,finished) 1;
        }
    }
}

<strong><a name="::::ProcName_4360">proc <a href="misc.tcl-annot.html#::::ProcName">::::ProcName</a></a></strong> {} {
    return [lindex [info level -1] 0];
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckVirtualRouterFeatureSupported</span>
<span class="comment-line"># Description: If DUT does not support Virtual RouterFeature   </span>
<span class="comment-line">#              exit the test.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: - DUT</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: return</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># to skip a test if DUT1 does not support virtual router use like below</span>
<span class="comment-line">#       CheckVirtualRouterFeatureSupported 1 &#34;test&#34;</span>
<span class="comment-line"># to skip a module if DUT1 does not support virtual router use like below</span>
<span class="comment-line">#       CheckVirtualRouterFeatureSupported 1 &#34;module&#34;</span>
<span class="comment-line"># to skip a test if DUT 1,2,3 does not support virtual router use like below</span>
<span class="comment-line">#       CheckVirtualRouterFeatureSupported &#34;1 2 3&#34; &#34;test&#34;</span>
<span class="comment-line"># to skip a module if DUT 1,2,3 does not support virtual router use like below</span>
<span class="comment-line">#       CheckVirtualRouterFeatureSupported &#34;1 2 3&#34; &#34;module&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">#####################################################</span>
<strong><a name="::::CheckVirtualRouterFeatureSupported_4383">proc <a href="misc.tcl-annot.html#::::CheckVirtualRouterFeatureSupported">::::CheckVirtualRouterFeatureSupported</a></a></strong> {
        {dutList &#34;1&#34;}
        {skipFlag &#34;test&#34;}
        {testNo &#34;&#34;}
        {time1 &#34;&#34;}
        {portType &#34;none&#34;}
        {ixiaPortIds &#34;1&#34;}
        {trunkPortIds {&#34;1 2 1&#34;}}
    } {

    global vrSysTypes MAIN
    global DUTs_info
    global trunkPortList
    global portMappingList
    global bd8kChassis;

    <span class="comment-line"># - Verify testNo and time1</span>
    if {$testNo == &#34;&#34; &amp;&amp; [info exists MAIN(CURRENTTESTCASE)]} {
        set testNo $MAIN(CURRENTTESTCASE)
    }
    if {$time1 == &#34;&#34; &amp;&amp; [info exists MAIN(APPROXTIME1)]} {
        set time1 $MAIN(APPROXTIME1)
    } else {
        set time1 [clock seconds]
    }

    regsub -all {,} $dutList { } dutMapList
    set flag &#34;supported&#34;
    for {set j 0} {$j &lt; [llength $dutMapList]} {incr j 1} {
        set dut [lindex $dutMapList $j]
        set tPlatform $DUTs_info(DUT${dut},sysType)
        <a name="::result_debug(79)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DUT$dut platform is $tPlatform&#34;
        if {[regexp -nocase $vrSysTypes $DUTs_info(DUT${dut},sysType)]} {
            if {($flag == &#34;supported&#34; ) &amp;&amp; \
                ([regexp -nocase $bd8kChassis $DUTs_info(DUT${dut},sysType)])} {
                if {$portType == &#34;none&#34;} {
                    puts &#34;BD8K portType set to none. Set not supported&#34;
                    set flag &#34;non_supported&#34;
                } elseif {![<a name="::CheckPortOnAspenC-seriesIO(1)"><a href="./misc.tcl.html#::CheckPortOnAspenC-seriesIO_4475">::CheckPortOnAspenC-seriesIO</a></a> $skipFlag $testNo $time1 $portType $ixiaPortIds $trunkPortIds] } {
                    puts &#34;BD8K CheckPortOnAspenC-seriesIO returned set not supported&#34;
                    set flag &#34;non_supported&#34;
                }
            }
            global DUT${dut}_Stacking_msma_slot
            if {[info exists DUT${dut}_Stacking_msma_slot] &amp;&amp; [set DUT${dut}_Stacking_msma_slot] &gt; 0 &amp;&amp;
                    ![regexp -nocase &#34;vpex&#34; $DUTs_info(DUT${dut},sysType)]} {
                 set stkStat 0
                 foreach stackSlotSysType $DUTs_info(DUT${dut},hwList) {
                    if {$stackSlotSysType == &#34;Empty&#34;} {continue;}
                    if {![regexp -nocase &#34;$vrSysTypes&#34; $stackSlotSysType]} {
                        result_skip &#34;Slot ($stackSlotSysType) Does Not Support Virtual Router in DUT $dut Stack&#34;
                        set flag &#34;non_supported&#34;
                    } else {
                        incr stkStat
                    }
                 }
                 if {$stkStat&gt;0 &amp;&amp; $flag == &#34;supported&#34;} {
                     puts &#34;Stack verified $stkStat slots supporting Virtual Routing&#34;
                 }
            }
        } else {
            set flag &#34;non_supported&#34;
        }
        if { $flag == &#34;non_supported&#34; } {
            <a name="::result_debug(80)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Skipped Test: DUT $dut Hardware Does Not Support Virtual Router&#34;
            <a name="::report_start_test(13)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Skipped Test: DUT $dut Hardware Does Not Support Virtual Router&#34;
            result_skip &#34;Skipped Test: DUT $dut Hardware Does Not Support Virtual Router&#34;
            <a name="::report_end_test(14)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
            set time2 [clock seconds]
            result_p &#34;Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
            <a name="::close_result_file(3)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
            <a name="::report_end_test(15)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
            if {[regexp -nocase &#34;module&#34; $skipFlag]} {
                return -code return testSkipped
            } else {
                return -code return 0 
            }
        }
    }; <span class="comment-line"># for</span>
    return 1;
}; <span class="comment-line"># CheckVirtualRouterFeatureSupported</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckPortOnAspenC-seriesIO </span>
<span class="comment-line"># Description:  return 1  if port is on C series of aspen IO else 0 </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: - type, dut, portId trunkList testno time1 </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># CheckPortOnAspenC-seriesIO &#34;test&#34; &#34;1.init&#34; $time1 &#34;both&#34; &#34;1-2&#34; &#34;1 2 1&#34;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckPortOnAspenC-seriesIO_4475">proc <a href="misc.tcl-annot.html#::::CheckPortOnAspenC-seriesIO">::::CheckPortOnAspenC-seriesIO</a></a></strong> {{skipFlag &#34;test&#34;} { testNo &#34;&#34; } { time1 &#34;&#34; } {portType &#34;both&#34;} {portID &#34;1&#34;} {trunkList {&#34;1 2 1&#34;}} } {
   global DUTs_info
   set exitTests 0;
   if {$portType == &#34;port&#34;} {
      if {![<a name="::CheckIxiaPortOnAspenC-seriesIO(1)"><a href="./misc.tcl.html#::CheckIxiaPortOnAspenC-seriesIO_4514">::CheckIxiaPortOnAspenC-seriesIO</a></a> $portID]} {
         set exitTests 1;
      }
   } elseif {$portType == &#34;trunk&#34;} {
      if {![<a name="::CheckTrunkPortOnAspenC-seriesIO(1)"><a href="./misc.tcl.html#::CheckTrunkPortOnAspenC-seriesIO_4562">::CheckTrunkPortOnAspenC-seriesIO</a></a> $trunkList]} {
         set exitTests 1;
      }
   } elseif {$portType == &#34;skip&#34;} {
      <a name="::result_debug(81)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;port check skipped for aspen&#34;
   } else {
      if {![<a name="::CheckIxiaPortOnAspenC-seriesIO(2)"><a href="./misc.tcl.html#::CheckIxiaPortOnAspenC-seriesIO_4514">::CheckIxiaPortOnAspenC-seriesIO</a></a> $portID] || ![<a name="::CheckTrunkPortOnAspenC-seriesIO(2)"><a href="./misc.tcl.html#::CheckTrunkPortOnAspenC-seriesIO_4562">::CheckTrunkPortOnAspenC-seriesIO</a></a> $trunkList]} {
         set exitTests 1;
      }
   }
   if {$exitTests} {
        <a name="::result_debug(82)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Skipped Test: Aspen Hardware Does Not Support Virtual Router on Non C series of IO&#34;
        result_skip &#34;Skipped Test: Aspen Hardware Does Not Support Virtual Router on Non C series of IO&#34;
        return 0 
   } else {
        return 1 
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckIxiaPortOnAspenC-seriesIO </span>
<span class="comment-line"># Description: Return a 1 if all port IDs are on aspen C series of IO </span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: - delimited portID range</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: 1 if all CheckIxiaPortOnAspenC-seriesIO, 0 if not</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       CheckIxiaPortOnAspenC-seriesIO 1-2;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckIxiaPortOnAspenC-seriesIO_4514">proc <a href="misc.tcl-annot.html#::::CheckIxiaPortOnAspenC-seriesIO">::::CheckIxiaPortOnAspenC-seriesIO</a></a></strong> {{idList &#34;1&#34;}} {
   global PortID_Info
   set ok 1
   set idRange [split $idList -];
   set rangeLow [lindex $idRange 0];
     if {[llength $idRange] &gt; 1} {
      set rangeHigh [lindex $idRange 1]
      for {set x $rangeLow} {$x&lt;=$rangeHigh} {incr x} {
         if {![<a name="::CheckPortId5Thru8(1)"><a href="./ePTPortMapping.tcl.html#::CheckPortId5Thru8_302">::CheckPortId5Thru8</a></a>] &amp;&amp; $x &gt; 4 &amp;&amp; $x &lt; 9} {
            continue;
         }
         if {$PortID_Info($x,BcomType) != &#34;Firebolt2&#34;} {
            <a name="::result_debug(83)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;PortID_Info $x = $PortID_Info($x,BcomType)&#34;
            set ok 0;
            break;
         }
      }
   } else {
      foreach id $idList {
         if {![<a name="::CheckPortId5Thru8(2)"><a href="./ePTPortMapping.tcl.html#::CheckPortId5Thru8_302">::CheckPortId5Thru8</a></a>] &amp;&amp; $id &gt; 4 &amp;&amp; $id &lt; 9} {
            continue;
         }
         if {$PortID_Info($id,BcomType) != &#34;Firebolt2&#34;} {
            <a name="::result_debug(84)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;PortID_Info $id = $PortID_Info($id,BcomType)&#34;
            set ok 0;
            break;
         }
      }
   }
   if {$ok} {
      <a name="::result_debug(85)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Given ixia Ports are on aspen C series IO Passed&#34;
   }  else {
      <a name="::result_debug(86)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Some Given ixia Ports are NOT on aspen C series IO&#34;
   }
   return $ok
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckTrunkPortOnAspenC-seriesIO </span>
<span class="comment-line"># Description: Return a 1 if the trunk port is on aspen C series IO.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: - trunk string &#34;1 2 1&#34;</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: 1 if trunk  port is on aspen C series IO, 0 if not</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       CheckTrunkPortOnAspenC-seriesIO &#34;1 2 1&#34;;</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckTrunkPortOnAspenC-seriesIO_4562">proc <a href="misc.tcl-annot.html#::::CheckTrunkPortOnAspenC-seriesIO">::::CheckTrunkPortOnAspenC-seriesIO</a></a></strong> {{trunkList {&#34;1 2 1&#34;}}} {
   global Trunk_Info

   set ok 1
   foreach trunk $trunkList {
      set tMap Map[join $trunk &#34;&#34;];
      if {$Trunk_Info($tMap,BcomType) != &#34;Firebolt2&#34;} {
         <a name="::result_debug(87)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Trunk_Info $tMap = $Trunk_Info($tMap,BcomGen)&#34;
         set ok 0;
            break;
      }
 }
   if {$ok} {
      <a name="::result_debug(88)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Given Trunk ports are on aspen C series of IO&#34;
   }  else {
      <a name="::result_debug(89)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Some Given Trunk Ports are NOT on aspen C series IO&#34;
   }
   return $ok
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: tftpTest</span>
<span class="comment-line"># Description: Return &#34;ok&#34; if tftp connectivity test</span>
<span class="comment-line">#              passes - otherwises returns &#34;error&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: &#34;ok&#34; if tftp connectivity test</span>
<span class="comment-line">#                passes - otherwises returns &#34;error&#34;</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       tftpTest</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::tftpTest_4595">proc <a href="misc.tcl-annot.html#::::tftpTest">::::tftpTest</a></a></strong> {} {

  global tftpServerList, tftpServerLogin, tftpServerPasswd, tftpServerTftpboot
  global whichDutNow
  global DUT1_CONNECT
  global curAutoRoot

  <span class="comment-line">################################################</span>
  set subTest &#34;Checking tftp connectivity of DUT$whichDutNow&#34;
  <span class="comment-line">################################################</span>
  result_h2 &#34;$subTest&#34;
  <a name="::report_start_test(14)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;

  set curAR $curAutoRoot
  set comm_path [append curAR &#34;/main/cfg/common.cfg&#34;]
  puts &#34;comm_path $comm_path&#34;

  if [catch {source $comm_path} rea] {
      puts &#34;*** WARNING: Unable to source common.cfg:$rea............... ***&#34;
      puts &#34;*** WARNING: Application level variables may not be defined. ***&#34;
      return &#34;error&#34;
  }

  set TFTPServerIP [lindex $tftpServerList 0]
  set pid [pid]
  set tStartTime [clock seconds]
  set fd_out [open &#34;Tmp/tftptest_$pid$tStartTime&#34; &#34;w&#34;];
  puts $fd_out &#34;tftp test&#34;
  close $fd_out
  set testFilePath &#34;Tmp/tftptest_$pid$tStartTime&#34;
  set fd_out [open &#34;Tmp/tftptestcmd_$pid$tStartTime&#34; &#34;w&#34;];
  puts $fd_out &#34;timeout 5&#34;
  puts $fd_out &#34;put $testFilePath tftptest_$pid$tStartTime&#34;
  puts $fd_out &#34;quit&#34;
  close $fd_out
  puts &#34;Putting $testFilePath onto tftp Server $TFTPServerIP&#34;
  if {[catch {exec /usr/bin/tftp $TFTPServerIP &lt; ./Tmp/tftptestcmd_$pid$tStartTime} reason]} {
    puts &#34;error: $reason&#34;
    return &#34;error&#34;
  }
  file delete ./Tmp/tftptest_$pid$tStartTime
  file delete ./Tmp/tftptestcmd_$pid$tStartTime

  <a name="::ConfigGatewayNetwork(2)"><a href="./SendSwCmd.tcl.html#::ConfigGatewayNetwork_2110">::ConfigGatewayNetwork</a></a>
  <a name="::SendACmd(73)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ping vr [<a name="::GetVrString(2)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $whichDutNow] $TFTPServerIP&#34;
  <a name="::SendACmd(74)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;tftp $TFTPServerIP -v [<a name="::GetVrString(3)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $whichDutNow] \
                -g -l tftptest_$pid$tStartTime -r tftptest_$pid$tStartTime&#34;

  set out [<a name="::SendACmd(75)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls&#34;]
  if {[regexp -nocase &#34;.*tftptest_$pid$tStartTime.*&#34; $out]} {
    set rslt &#34;ok&#34;
    <a name="::result_ok(12)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;tftptest_$pid$tStartTime found on DUT$whichDutNow&#34;
    <a name="::SendACmd(76)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;rm tftptest_$pid$tStartTime&#34;
  } else {
    set rslt &#34;error&#34;
    <a name="::result_error(22)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;tftptest_$pid$tStartTime not found on DUT$whichDutNow&#34;
  }
  <span class="comment-line"># Verify that the default.xsf is on the switch</span>
  set out [<a name="::SendACmd(77)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls&#34;]
  if {[regexp -nocase &#34;.*default.*&#34; $out]} {
      <a name="::result_ok(13)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;default.xsf found on DUT$whichDutNow&#34;
  } else {
      <a name="::result_debug(90)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;default.xsf is missing.  Tftp it from the server&#34;
      <a name="::SendACmd(78)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;tftp $TFTPServerIP -v [<a name="::GetVrString(4)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $whichDutNow] \
                -g -l default.xsf -r default_do_not_erase&#34;
      set out [<a name="::SendACmd(79)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;ls&#34;]
      if {[regexp -nocase &#34;.*default.*&#34; $out]} {
          set rslt &#34;ok&#34;
          <a name="::result_ok(14)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;default.xsf found on DUT$whichDutNow&#34;
      } else {
          set rslt &#34;error&#34;
          <a name="::result_error(23)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;default.xsf not found on DUT$whichDutNow&#34;
      }
  }

  <a name="::UnconfigGatewayNetwork(2)"><a href="./SendSwCmd.tcl.html#::UnconfigGatewayNetwork_2356">::UnconfigGatewayNetwork</a></a>

  <span class="comment-line"># Remove files from tftp before exit</span>
  <a name="::login_linux(1)"><a href="./linux.tcl.html#::login_linux_16">::login_linux</a></a> $TFTPServerIP $tftpServerLogin $tftpServerPasswd
  <a name="::SendACmd(80)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;/bin/rm $tftpServerTftpboot/tftptest_$pid$tStartTime&#34; NULL NULL true 1

  <a name="::report_end_test(16)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
  return $rslt
}

<strong><a name="::::CheckIOPullOutPullInSupported_4680">proc <a href="misc.tcl-annot.html#::::CheckIOPullOutPullInSupported">::::CheckIOPullOutPullInSupported</a></a></strong> { {dutList &#34;1&#34;} {skipFlag &#34;test&#34;} { testNo &#34;&#34; } { time1 &#34;&#34; } } {

    global chassis
    global DUTs_info
    regsub -all {,} $dutList { } dutMapList
    set flag &#34;supported&#34;

    for {set j 0} {$j &lt; [llength $dutMapList]} {incr j 1} {
        set dut [lindex $dutMapList $j]
        <a name="::result_debug(91)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DUT$dut platform is $DUTs_info(DUT${dut},platform)&#34;
        if {([regexp -nocase $chassis $DUTs_info(DUT${dut},platform)] == 1) &amp;&amp; (!([regexp -nocase &#34;BD-128&#34; $DUTs_info(DUT${dut},platform)] == 1)) &amp;&amp; (!([regexp -nocase &#34;stack&#34; $DUTs_info(DUT${dut},platform)] == 1)) } {
           <span class="comment-line">#  result_debug &#34;DUT $dut Hardware Support IO Pull-out and Pull-In&#34;</span>
        } else {
             set flag &#34;non_supported&#34;
             <a name="::result_debug(92)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DUT $dut Hardware Does Not Support IO Pull-out and Pull-In&#34;
        } 
    }
    if { $flag == &#34;non_supported&#34; } {
       <a name="::result_debug(93)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Skipped Test: One of DUT in given dutList Does Not Support IO Pull-out and Pull-In&#34;
       <a name="::report_start_test(15)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Skipped Test: One of DUT in given dutList Does Not Support IO Pull-out and Pull-In&#34;
       result_skip &#34;Skipped Test: One of DUT in given dutList Does Not Support IO Pull-out and Pull-In&#34;
       <a name="::report_end_test(17)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
       
       set time2 [clock seconds]
       result_p &#34;Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
       <a name="::close_result_file(4)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
       <a name="::report_end_test(18)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
       
       if {[regexp -nocase &#34;module&#34; $skipFlag]} {
          return -code return testSkipped
       } else {
          return -code return 0
       }

    } else {
         return 1;
    }

}

<strong><a name="::::SimulateIOPullOut_4720">proc <a href="misc.tcl-annot.html#::::SimulateIOPullOut">::::SimulateIOPullOut</a></a></strong> { {dut &#34;1&#34;} {slotList &#34;NULL&#34;} } {

    global pioneerPlatform
    global DUTs_info DUT${dut}_CONNECT DUT${dut}_CONNECTB
    
    regsub -all {,} $slotList { } slotMapList 
    
    <a name="::Login(28)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$dut,connect) -masterCheck 0 -CheckOperational 0 
    <a name="::EnableDebugMode(5)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
    if {([regexp -nocase &#34;aspen|bd-88|XCM|BD-X8&#34; $DUTs_info(DUT${dut},platform)] == 1) } {
        for {set j 0} {$j &lt; [llength $slotMapList]} {incr j 1} {
            <a name="::SendACmd(81)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal run platform remove_card [lindex $slotMapList $j]&#34;
        }
        <a name="::DisableDebugMode(3)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
        if { [info exists DUT${dut}_CONNECTB] } {
            <a name="::Login(29)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECTB] -masterCheck 0 -CheckOperational 0 
            <a name="::EnableDebugMode(6)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            for {set j 0} {$j &lt; [llength $slotMapList]} {incr j 1} {
                <a name="::SendACmd(82)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal run platform remove_card [lindex $slotMapList $j]&#34;
            }
            <a name="::DisableDebugMode(4)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
        }
   } elseif {([regexp -nocase &#34;$pioneerPlatform&#34; $DUTs_info(DUT${dut},platform)] == 1) } {
        for {set j 0} {$j &lt; [llength $slotMapList]} {incr j 1} {
            <a name="::SendACmd(83)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal show device ucpipe hs_start [lindex $slotMapList $j]&#34;
        }
        <a name="::DisableDebugMode(5)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
        if { [info exists DUT${dut}_CONNECTB] } {
            <a name="::Login(30)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECTB] -masterCheck 0 -CheckOperational 0
            <a name="::EnableDebugMode(7)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            for {set j 0} {$j &lt; [llength $slotMapList]} {incr j 1} {
                <a name="::SendACmd(84)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal show device ucpipe hs_start [lindex $slotMapList $j]&#34;
            }
            <a name="::DisableDebugMode(6)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
        }
   } elseif {([regexp -nocase &#34;BD-10808|mariner&#34; $DUTs_info(DUT${dut},platform)] == 1) } {
        set slotMask 65535 
        for {set j 0} {$j &lt; [llength $slotMapList]} {incr j 1} {
            set slotNo  [lindex $slotMapList $j]
            set slotMask [expr {$slotMask ^ 1 &lt;&lt; $slotNo}]
        }
        <span class="comment-line">#convert the decimal value into hex</span>
        set slotMaskInHex [format %x $slotMask]
        <a name="::SendACmd(85)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal configure cardPresentMask 0x$slotMaskInHex&#34;
        <a name="::DisableDebugMode(7)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
   }
}

<strong><a name="::::SimulateIOPullIn_4768">proc <a href="misc.tcl-annot.html#::::SimulateIOPullIn">::::SimulateIOPullIn</a></a></strong> { {dut &#34;1&#34;} {slotList &#34;&#34;} } {

    global pioneerPlatform
    global DUTs_info DUT${dut}_CONNECT DUT${dut}_CONNECTB
    
    regsub -all {,} $slotList { } slotMapList 
    
    <a name="::Login(31)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$dut,connect) -masterCheck 0 -CheckOperational 0 
    <a name="::EnableDebugMode(8)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
    if {([regexp -nocase &#34;aspen|bd-88|XCM|BD-X8&#34; $DUTs_info(DUT${dut},platform)] == 1) } {
        for {set j 0} {$j &lt; [llength $slotMapList]} {incr j 1} {
            <a name="::SendACmd(86)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal run platform insert_card [lindex $slotMapList $j]&#34;
        } 
        <a name="::DisableDebugMode(8)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
        if { [info exists DUT${dut}_CONNECTB] } {
            <a name="::Login(32)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECTB] -masterCheck 0 -CheckOperational 0
            <a name="::EnableDebugMode(9)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            for {set j 0} {$j &lt; [llength $slotMapList]} {incr j 1} {
                <a name="::SendACmd(87)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal run platform insert_card [lindex $slotMapList $j]&#34;
            }
            <a name="::DisableDebugMode(9)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
        }
   } elseif {([regexp -nocase &#34;$pioneerPlatform&#34; $DUTs_info(DUT${dut},platform)] == 1) } {
        for {set j 0} {$j &lt; [llength $slotMapList]} {incr j 1} {
            <a name="::SendACmd(88)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal show device ucpipe hs_stop [lindex $slotMapList $j]\r\r&#34;
        }
        <a name="::DisableDebugMode(10)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
        if { [info exists DUT${dut}_CONNECTB] } {
            <a name="::Login(33)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECTB] -masterCheck 0 -CheckOperational 0
            <a name="::EnableDebugMode(10)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            for {set j 0} {$j &lt; [llength $slotMapList]} {incr j 1} {
                <a name="::SendACmd(89)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal show device ucpipe hs_stop [lindex $slotMapList $j]\r\r&#34;
            }
            <a name="::DisableDebugMode(11)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
        }
   } elseif {([regexp -nocase &#34;BD-10808|mariner&#34; $DUTs_info(DUT${dut},platform)] == 1) } {
        <a name="::SendACmd(90)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal configure cardPresentMask 0xffff&#34;
        <a name="::DisableDebugMode(12)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
   }
}

<strong><a name="::::CheckCablePullOutPullInSupported_4809">proc <a href="misc.tcl-annot.html#::::CheckCablePullOutPullInSupported">::::CheckCablePullOutPullInSupported</a></a></strong> { {dutList &#34;1&#34;} {skipFlag &#34;test&#34;} { testNo &#34;&#34; } { time1 &#34;&#34; } } {

    global bcmPlatform 
    global DUTs_info
    regsub -all {,} $dutList { } dutMapList
    set flag &#34;supported&#34;

    for {set j 0} {$j &lt; [llength $dutMapList]} {incr j 1} {
        set dut [lindex $dutMapList $j]
        if {([regexp -nocase $bcmPlatform $DUTs_info(DUT${dut},platform)] == 1) } {
             set flag &#34;non_supported&#34;
             <a name="::result_debug(94)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DUT $dut Hardware does not support Cable Pull-out and Pull-In&#34;
        } 
    }
    if { $flag == &#34;non_supported&#34; } {
       <a name="::result_debug(95)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Skipped Test: One of DUT in given dutList Does Not Support Cable Pull-out and Pull-In&#34;
       <a name="::report_start_test(16)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Skipped Test: One of DUT in given dutList Does Not Support Cable Pull-out and Pull-In&#34;
       result_skip &#34;Skipped Test: One of DUT in given dutList Does Not Support Cable Pull-out and Pull-In&#34;
       <a name="::report_end_test(19)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
       
       set time2 [clock seconds]
       result_p &#34;Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
       <a name="::close_result_file(5)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
       <a name="::report_end_test(20)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
       if {[regexp -nocase &#34;module&#34; $skipFlag]} {
          return -code return testSkipped
       } else {
          return -code return 0
       }
    } else {
         return 1;
    }

}


<strong><a name="::::SimulateCablePullOut_4845">proc <a href="misc.tcl-annot.html#::::SimulateCablePullOut">::::SimulateCablePullOut</a></a></strong> { {dut &#34;1&#34;} {portList &#34;&#34;} } {

    global gnssPlatform pioneerPlatform
    global DUTs_info
    
    regsub -all {,} $portList { } portMapList
    
    <a name="::Login(34)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$dut,connect) -masterCheck 0 -CheckOperational 0 
    <a name="::EnableDebugMode(11)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
    if {([regexp -nocase $gnssPlatform $DUTs_info(DUT${dut},platform)] == 1) } {
        for {set j 0} {$j &lt; [llength $portMapList]} {incr j 1} {
            <a name="::SendACmd(91)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal configure port [lindex $portMapList $j] linkdown&#34;
        }
    } elseif {([regexp -nocase $pioneerPlatform $DUTs_info(DUT${dut},platform)] == 1) } {
        for {set j 0} {$j &lt; [llength $portMapList]} {incr j 1} {
            set slotNo [lindex [split [lindex $portMapList $j] :] 0]
            set portNo [lindex [split [lindex $portMapList $j] :] 1]
            <a name="::SendACmd(92)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal show device packet-processor shutofflink $slotNo $portNo&#34;
        }
    }
    <a name="::DisableDebugMode(13)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
}

<strong><a name="::::SimulateCablePullIn_4868">proc <a href="misc.tcl-annot.html#::::SimulateCablePullIn">::::SimulateCablePullIn</a></a></strong> { {dut &#34;1&#34;} {portList &#34;&#34;} } {

    global gnssPlatform pioneerPlatform
    global DUTs_info
    
    regsub -all {,} $portList { } portMapList
    
    <a name="::Login(35)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$dut,connect) -masterCheck 0 -CheckOperational 0 
    <a name="::EnableDebugMode(12)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
    if {([regexp -nocase $gnssPlatform $DUTs_info(DUT${dut},platform)] == 1) } {
        for {set j 0} {$j &lt; [llength $portMapList]} {incr j 1} {
             <a name="::SendACmd(93)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal configure port [lindex $portMapList $j] linkup&#34;
             <a name="::SendACmd(94)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable port [lindex $portMapList $j]&#34;
             <a name="::SendACmd(95)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable port [lindex $portMapList $j]&#34;
        }
    } elseif {([regexp -nocase $pioneerPlatform $DUTs_info(DUT${dut},platform)] == 1) } {
         for {set j 0} {$j &lt; [llength $portMapList]} {incr j 1} {
              set slotNo [lindex [split [lindex $portMapList $j] :] 0]
              set portNo [lindex [split [lindex $portMapList $j] :] 1]
              <a name="::SendACmd(96)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;debug hal show device packet-processor enablelink $slotNo $portNo&#34;
         }
     }
    <a name="::DisableDebugMode(14)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
}
<strong><a name="::::EnableWatchDogTimeoutDumpStack_4892">proc <a href="misc.tcl-annot.html#::::EnableWatchDogTimeoutDumpStack">::::EnableWatchDogTimeoutDumpStack</a></a></strong> { {wdType &#34;dump_stack&#34;} } {
    global DUTs_info
    global numDUT
    for {set dut 1} {$dut &lt;= $numDUT} {incr dut} {
      global DUT${dut}_CONNECT
      global DUT${dut}_CONNECTB

      <a name="::Login(36)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECT] -masterCheck 0 -CheckOperational 0
      <a name="::EnableDebugMode(13)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
      <a name="::SendACmd(97)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!echo $wdType &gt; /sys/module/watchdog/parameters/watchdog_warn_behavior&#34;
      <a name="::DisableDebugMode(15)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
      if { [info exists DUT${dut}_CONNECTB] } {
            <a name="::Login(37)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECTB] -masterCheck 0 -CheckOperational 0
            <a name="::EnableDebugMode(14)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            <a name="::SendACmd(98)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!echo dump_stack &gt; /sys/module/watchdog/parameters/watchdog_warn_behavior&#34;
            <a name="::DisableDebugMode(16)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
      }
    } 
}
<strong><a name="::::dumpStackUtilizationInfo_4911">proc <a href="misc.tcl-annot.html#::::dumpStackUtilizationInfo">::::dumpStackUtilizationInfo</a></a></strong> { } {
    global DUTs_info
    global numDUT
    global currentTestIndex
    global currentTestNumber
    if { [info exists DUTs_info] &amp;&amp; [info exists numDUT] &amp;&amp; [info exists currentTestIndex] &amp;&amp; [info exists currentTestNumber]} {
    if { $currentTestIndex &gt; 2 } {
        for {set dut 1} {$dut &lt;= $numDUT} {incr dut} {
          global DUT${dut}_CONNECT
          global DUT${dut}_CONNECTB

          <a name="::Login(38)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECT] -masterCheck 0 -CheckOperational 0
          <a name="::EnableDebugMode(15)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
          <a name="::SendACmd(99)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!cat /proc/stack_util_info | grep '\*$'&#34;
          <a name="::DisableDebugMode(17)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
          if { [info exists DUT${dut}_CONNECTB] } {
            <a name="::Login(39)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECTB] -masterCheck 0 -CheckOperational 0
            <a name="::EnableDebugMode(16)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
            <a name="::SendACmd(100)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;!cat /proc/stack_util_info | grep '\*$'&#34;
            <a name="::DisableDebugMode(18)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
          }
        } 
    }
   }
}

<span class="comment-line">################################################################################</span>
<span class="comment-line"># Procedure Name: checkLinkSpeed</span>
<span class="comment-line"># Description: Return  1 if speed of all the ports mentioned </span>
<span class="comment-line">#              in the portlist are equal to the speed mentioned</span>
<span class="comment-line">#              in the input arg speed </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  dutlist portlist speed</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: 1 if speed of all the ports mentioned in the</span>
<span class="comment-line">#               portlist are equal to the speed mentioned in the</span>
<span class="comment-line">#               input arg speed</span>
<span class="comment-line">#        </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    checkLinkSpeed -dutlist &#34;1 2&#34; -portlist &#34;{3 4} {8:1 14:1}&#34; -speed 1000</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################################</span>

<strong><a name="::::checkLinkSpeed_4954">proc <a href="misc.tcl-annot.html#::::checkLinkSpeed">::::checkLinkSpeed</a></a></strong> {args} {
  <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> checkLinkSpeed $args { 

    dutlist &#34;1&#34;
    portlist &#34;1&#34;
    speed    &#34;1000&#34;

}

global DUTs_info

set dutlistlen [llength $dutlist]
set portlistlen [llength $portlist]

   if {$dutlistlen != $portlistlen} {
      <a name="::result_error(24)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Mismatch in inputs to the proc======== dutlist length not equal\
                    to portlist length &#34;
      return 0

    } else {

      for {set i 0 } {$i &lt; $dutlistlen } {incr i } {
         set portlistelement [lindex $portlist $i]
         set portlistelementlen [llength $portlistelement]
       	 for {set j 0 } {$j &lt; $portlistelementlen } {incr j} {
            set val  [<a name="::getDutPortSpeed(1)"><a href="./misc.tcl.html#::getDutPortSpeed_3328">::getDutPortSpeed</a></a>  -dut [lindex $dutlist $i] -port [lindex $portlistelement $j]]
                  if { $val == $speed} {
                    continue  
                  } else {
                    return 0
                  }

         }            

      }
  } 
return 1
}  

<span class="comment-line">################################################################################</span>
<span class="comment-line"># Procedure Name: checkSlotOperational</span>
<span class="comment-line"># Description: Returns  1 if all the slots mentioned in the slotlist of a </span>
<span class="comment-line">#              given DUT become operational in 200 seconds.</span>
<span class="comment-line">#             </span>
<span class="comment-line">#             </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  dut slotList </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: 1 if all the slots mentioned in the slotlist of a </span>
<span class="comment-line">#               given DUT are operational.               </span>
<span class="comment-line">#              </span>
<span class="comment-line">#        </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    checkSlotOperational -dut 1 -slotList &#34;1 2&#34; </span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################################</span>


<strong><a name="::::checkSlotOperational_5012">proc <a href="misc.tcl-annot.html#::::checkSlotOperational">::::checkSlotOperational</a></a></strong> {args} {
   <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> checkSlotOperational $args {
            dut &#34;1&#34;
            slotList &#34;1&#34;

   }

 
    global DUTs_info
    if { ![info exist DUTs_info(DUT${dut},connect)] } {
         <a name="::result_error(25)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;checkSlotOperational: Dut $dut doesn't exist&#34;
         return -1
    }   

    <a name="::Login(40)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUTs_info(DUT${dut},connect)]
    set parameterList &#34;&#34;
    lappend parameterList &#34;{State:} {Operational} inLine exists&#34;
    

    foreach slot $slotList {
        if { [<a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot $slot&#34; \
             $parameterList  -time {s: 51 i: 5  d: 200 f: 400 r}] != &#34;ok&#34; } {
             return 1
        } else {
             <a name="::result_error(26)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Slot $slot failed to become operational in  200 seconds&#34;
             return -1
        }
           
   }   
  

}


<span class="comment-line">###############################################################################</span>
<span class="comment-line"># pauseScriptRun</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#   Prints the comment to the screen, and pauses for a user to hit return.</span>
<span class="comment-line">#   Can use this proc to put pauses in scripts during developement to</span>
<span class="comment-line">#   perform manual action like card swap/pull out etc.</span>
<span class="comment-line">#</span>
<span class="comment-line">#   The global variable globalPause set to 0 will cause this proc to do</span>
<span class="comment-line">#   nothing.  You would want to set it to 0 not hit these pauses.</span>
<span class="comment-line">#   Set it to 1 for pause.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: comment</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Return value: None</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     pauseScriptRun -comment &#34;Pausing here for card swap&#34;</span>
<span class="comment-line">#     pauseScriptRun</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">#   Examples: Same as typical usage   </span>
<span class="comment-line">#</span>
<span class="comment-line">#   Limitations: None</span>
<span class="comment-line">#</span>
<span class="comment-line">###############################################################################</span>

<strong><a name="::::pauseScriptRun_5074">proc <a href="misc.tcl-annot.html#::::pauseScriptRun">::::pauseScriptRun</a></a></strong> {args} {
   <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> pauseScriptRun $args {
        comment &#34;NULL&#34;                 
   }
   
   global globalPause
   fconfigure stdin -blocking 1

   if {$globalPause} {
      <a name="::result_debug(96)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;##### SCRIPT PAUSED PRESS ENTER TO CONTINUE #####&#34;
      if {$comment != &#34;NULL&#34;} {
         <a name="::result_debug(97)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;##### $comment #####&#34;
      }
      gets stdin z
   }
}


<span class="comment-line">###############################################################################</span>
<span class="comment-line"># Procedure name: any</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Evaulate a predicate over every element in a list.  Iteration</span>
<span class="comment-line">#   over the list stops as soon as the predicate evaluates true.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               pred    The predicate to be evaluated.  It can either be the</span>
<span class="comment-line">#                       name of a TCL procedure, or it can be a TCL lambda.</span>
<span class="comment-line">#                       In either case, the predicate takes one argument, an</span>
<span class="comment-line">#                       element from the list, evaluates it, and then returns</span>
<span class="comment-line">#                       either a non-zero true value, or a zero false value.</span>
<span class="comment-line">#               lst     The list of elements to iterate over.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#               None</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#               0       If the predicate evaluates to 0 for all elements in</span>
<span class="comment-line">#                       the list.</span>
<span class="comment-line">#               1       If the predicate evaluates to 1 for any single</span>
<span class="comment-line">#                       list element.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#               # Check for any odd numbers using a named TCL procedure.</span>
<span class="comment-line">#               proc isOdd {n} {expr $n % 2 == 1};</span>
<span class="comment-line">#               set numList [list 2 4 5 6 8];</span>
<span class="comment-line">#               set result [any isOdd $numList];</span>
<span class="comment-line">#               ## $result will be 1.</span>
<span class="comment-line">#</span>
<span class="comment-line">#               # Check for any even numbers using a lambda.</span>
<span class="comment-line">#               set result [any {n {expr $n % 2 == 0}} [list 1 3 5 7]];</span>
<span class="comment-line">#               ## $result will be 0.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::any_5127">proc <a href="misc.tcl-annot.html#::::any">::::any</a></a></strong> {pred lst} {
    <span class="comment-line">#</span>
    <span class="comment-line"># Determine if predicate, pred, is a named TCL procedure or a lambda</span>
    <span class="comment-line"># function.</span>
    set p [expr {[llength $pred] == 1 ? [list $pred] : [list apply $pred]}];

    <span class="comment-line">#</span>
    <span class="comment-line"># Iterate over the list and evaluate the predicate for each element.</span>
    <span class="comment-line"># If the predicate evaluates true, quit right away.</span>
    foreach e $lst {
        <span class="comment-line">#</span>
        <span class="comment-line"># concat is needed in the case of a lambda to unpack the apply</span>
        <span class="comment-line"># command from the $p string.</span>
        if {[eval [concat $p $e]]} {
            return 1;
        }
    }
    return 0;
};

<span class="comment-line">#############################################################################################</span>
<span class="comment-line"># checkCustomAlgorithmSupported</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#      Checks whether the platform supports load sharing custom algorithm and skips the</span>
<span class="comment-line">#   test case if the platform doesn't support custom algorithm</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: dutNum</span>
<span class="comment-line"># Output args: portNum</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical Usage:</span>
<span class="comment-line">#  checkLacpCustomAlgorithmSupported -dutNum 1 -portNum 2</span>
<span class="comment-line">#</span>
<span class="comment-line">############################################################################################</span>
<strong><a name="::::checkLacpCustomAlgorithmSupported_5163">proc  <a href="misc.tcl-annot.html#::::checkLacpCustomAlgorithmSupported">::::checkLacpCustomAlgorithmSupported</a></a></strong> {args} {

       <a name="::parse_args(8)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> checkLacpCustomAlgorithmSupported $args {

            dutNum &#34;1&#34;
            portNum &#34;2&#34;
            testNo &#34;6.1.7&#34;
            time1  &#34;30&#34;

       }

global bcmChassis
global bcmx440
global bcmx430

lappend notSupportedList &#34;$bcmx440|$bcmx430&#34;

set platform [<a name="::GetPlatform(16)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$dutNum]

       if {[regexp -nocase $platform $bcmChassis]} {
                 set hwType [<a name="::GetSlotType(1)"><a href="./misc.tcl.html#::GetSlotType_1841">::GetSlotType</a></a> $dutNum $portNum]
                 if {[regexp -nocase $hwType $notSupportedList]} {

                      result_skip &#34;Custom algorithm Not supported on this platform&#34;
                      set time2 [clock seconds]
                      result_p &#34;Time for $testNo = [expr $time2-$time1] secs&#34;
                      <a name="::close_result_file(6)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
                      <a name="::report_end_test(21)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
                      return -code return
                 }
      } else {
           if {[regexp -nocase $platform $notSupportedList]} {

              result_skip &#34;Custom algorithm Not supported on this platform&#34;
              set time2 [clock seconds]
              result_p &#34;Time for $testNo = [expr $time2-$time1] secs&#34;
              <a name="::close_result_file(7)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
              <a name="::report_end_test(22)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
              return -code return
           }

      }

}


<span class="comment-line">###############################################################################</span>
<span class="comment-line"># Procedure name: xmap</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Evaulate a function over every element in a list and return a</span>
<span class="comment-line">#     list of results.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               f       The function to be evaluated.  It can either be the</span>
<span class="comment-line">#                       name of a TCL procedure, or it can be a TCL lambda.</span>
<span class="comment-line">#                       In either case, the function takes one argument, an</span>
<span class="comment-line">#                       element from the list, evaluates it, and then returns</span>
<span class="comment-line">#                       some value.</span>
<span class="comment-line">#               l       The list of elements to iterate over.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#               None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#               A TCL list containing the results of applying the function f</span>
<span class="comment-line">#               to every element in list l.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#               # Add &#34;ly&#34; to every word.</span>
<span class="comment-line">#               proc ly {w} {return &#34;${w}ly&#34;;}</span>
<span class="comment-line">#               set words [xmap ly [list slow quick dark distracting]];</span>
<span class="comment-line">#               ## $words will be &#34;slowly quickly darkly distractingly&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line">#               # Square the numbers in a list.</span>
<span class="comment-line">#               set nums [xmap {n (expr $n * $n}} [list 1 2 3 4 5]];</span>
<span class="comment-line">#               ## $nums will be &#34;1 4 9 16 25&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::xmap_5242">proc <a href="misc.tcl-annot.html#::::xmap">::::xmap</a></a></strong> {f l} {
    <span class="comment-line">#</span>
    <span class="comment-line"># Determine if function, f, is a named TCL procedure or a lambda</span>
    <span class="comment-line"># function.</span>
    set cmd [expr {[llength $f] == 1 ? [list $f] : [list apply $f]}];

    <span class="comment-line">#</span>
    <span class="comment-line"># Iterate over every element in the list, applying f to each one.</span>
    <span class="comment-line"># Build a list of results in the process.</span>
    foreach e $l {
        <span class="comment-line">#</span>
        <span class="comment-line"># concat is needed in the case of a lambda to unpack the apply</span>
        <span class="comment-line"># command from the $cmd string.</span>
        lappend rl [eval [concat $cmd $e]];
    }

    return $rl;
};


<span class="comment-line">###############################################################################</span>
<span class="comment-line"># Procedure name: expandPortRange</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     Expand a &#34;-&#34; separated range of port values into a full list of values.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     pr    A range of port values specified as &lt;port&gt;-&lt;port&gt;.  &lt;port&gt; can</span>
<span class="comment-line">#           be a simple port number, or a colon-separated slot-port pair,</span>
<span class="comment-line">#           e.g. 3:5.  When specifying slot:port pairs, the slot: for the</span>
<span class="comment-line">#           second port in the range may be omitted, and, if so, will be set</span>
<span class="comment-line">#           to the same slot as the first port, i.e. 7:8-10 is equivalent to</span>
<span class="comment-line">#           7:8-7:10.  Note that this function currently does not support</span>
<span class="comment-line">#           inter-slot ranges, e.g. 7:20-8:10 is invalid and will raise an</span>
<span class="comment-line">#           error.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#     A TCL list containing all values between, and including, the end-points</span>
<span class="comment-line">#     in the range.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     set pl [expandPortRange 7-10];</span>
<span class="comment-line">#     # $pl will be &#34;7 8 9 10&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line">#     set pl [expandPortRange 8:12-6];</span>
<span class="comment-line">#     # $pl will be &#34;8:6 8:7 8:8 8:9 8:10 8:11 8:12&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::expandPortRange_5294">proc <a href="misc.tcl-annot.html#::::expandPortRange">::::expandPortRange</a></a></strong> {pr} {
    <span class="comment-line">#</span>
    <span class="comment-line"># Notes on the regexp pattern:</span>
    <span class="comment-line">#   1. (x) groups and captures.</span>
    <span class="comment-line">#   2. (?:x) groups but does not capture.</span>
    <span class="comment-line">#   3. \d is a short-cut for [0-9].</span>
    <span class="comment-line">#   4. \d+ is a positive decimal number.</span>
    <span class="comment-line"># slotPort will match either a port number or a slot:port pair.</span>
    <span class="comment-line"># It will capture the entire slot:port pair, the slot, and the port.</span>
    set slotPort {((?:(\d+):)?(\d+))};

    <span class="comment-line">#</span>
    <span class="comment-line"># The pattern to match a range is a slotPort pattern followed by an</span>
    <span class="comment-line"># optional &#34;-&#34; and second slotPort pattern.</span>
    set pat &#34;${slotPort}(?:-${slotPort})?&#34;;
    
    <span class="comment-line">#</span>
    <span class="comment-line"># Capture variables:</span>
    <span class="comment-line">#   m   The matched string, if there is a match.</span>
    <span class="comment-line">#   sp1 The first slot:port (or port) in the range.</span>
    <span class="comment-line">#   s1  The first slot in the range.</span>
    <span class="comment-line">#   p2  The first port in the range.</span>
    <span class="comment-line">#   sp2 The second slot:port (or port) in the range.</span>
    <span class="comment-line">#   s2  The second slot in the range.</span>
    <span class="comment-line">#   p2  The second port in the range.</span>
    regexp -- $pat $pr m sp1 s1 p1 sp2 s2 p2;

    <span class="comment-line">#</span>
    <span class="comment-line"># Bail out if th pattern doesn't match.</span>
    if {![info exists m] || $m == &#34;&#34;} {
        error &#34;[<a name="::ProcName(1)"><a href="./misc.tcl.html#::ProcName_4360">::ProcName</a></a>]: Invalid port range, \&#34;$pr\&#34; specified.&#34;;
    }

    <span class="comment-line">#</span>
    <span class="comment-line"># Range has no second part, so just return the first (single) port.</span>
    if {$sp2 == &#34;&#34;} {
        return $sp1;
    }

    <span class="comment-line">#</span>
    <span class="comment-line"># Support for inter-slot ranges would require expanding the slot range,</span>
    <span class="comment-line"># identifying the module type in each slot, and then looking up the</span>
    <span class="comment-line"># maximum number of ports for each module.  Bail for now.</span>
    if {$s1 != &#34;&#34; &amp;&amp; $s2 != &#34;&#34; &amp;&amp; $s1 != $s2} {
        error &#34;[<a name="::ProcName(2)"><a href="./misc.tcl.html#::ProcName_4360">::ProcName</a></a>]: Inter-slot ranges are currently unsupported.&#34;;
    }

    <span class="comment-line">#</span>
    <span class="comment-line"># Be friendly and swap the port range if it's reversed.</span>
    if {$p1 &gt; $p2} {
        set tmp $p1;
        set p1 $p2;
        set p2 $tmp;
    }

    <span class="comment-line">#</span>
    <span class="comment-line"># Since slot numbers are guaranteed to be the same (see above), prefix</span>
    <span class="comment-line"># each port in the range with the slot number and a &#34;:&#34;, but only if</span>
    <span class="comment-line"># the port numbers are in slot:port format.</span>
    set pfx [expr {$s1 != &#34;&#34; ? &#34;$s1:&#34; : &#34;&#34;}];

    for {set i $p1} {$i &lt;= $p2} {incr i} {
        lappend pl ${pfx}$i;
    }

    return $pl;
}; <span class="comment-line"># proc expandPortRange</span>


<span class="comment-line">###############################################################################</span>
<span class="comment-line"># Procedure name: AssertPortState</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     Verify if the specified list of ports have transitioned into the</span>
<span class="comment-line">#     specified link state.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#     portList  A list of ports on the DUT to be verified.  The list can be</span>
<span class="comment-line">#               a normal, space-separated, TCL list, or a commna-separated</span>
<span class="comment-line">#               list.  Each element in the list can be either an individual</span>
<span class="comment-line">#               port, or a hyphen-separated port range.</span>
<span class="comment-line">#     DITId     Specifies which DUT on which the ports to verify reside.</span>
<span class="comment-line">#               If not specified, it defaults to DUT 1.</span>
<span class="comment-line">#     state     The link state to check for.  It can be either &#34;up&#34; or</span>
<span class="comment-line">#               &#34;down&#34;.  If not specified, it defaults to &#34;up&#34;.</span>
<span class="comment-line">#     -time     Specifies a set of timing parameters to control how often</span>
<span class="comment-line">#               the procedure checks the link state and how long until the</span>
<span class="comment-line">#               procedure should give up and declare a failure.  The time</span>
<span class="comment-line">#               parameters are the same as those for the CheckKeyValue</span>
<span class="comment-line">#               procedure.  If not specified, the default is an initial</span>
<span class="comment-line">#               wait time of 0, an interval of 2 seconds, and a failure time</span>
<span class="comment-line">#               of 10 seconds.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#     badPortList   An empty port list was specified.</span>
<span class="comment-line">#     badDUTId      A non-integer DUT ID, or an ID less than 1 was specified.</span>
<span class="comment-line">#     badLinkState  A link state other than &#34;up&#34; or &#34;down&#34; was specified.</span>
<span class="comment-line">#     ok            The ports achieved the desired link state in the specified</span>
<span class="comment-line">#                   time.</span>
<span class="comment-line">#     error         The ports failed to achieve the desired linke state in</span>
<span class="comment-line">#                   the specified time.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     # Check and wait for ports to link-up.</span>
<span class="comment-line">#     set rc [AssertPortState &#34;1 5-8 10&#34;];</span>
<span class="comment-line">#     if {$rc != &#34;ok&#34;} {</span>
<span class="comment-line">#         result_error &#34;Ports failed to link-up!  Reason: $rc&#34;;</span>
<span class="comment-line">#     }</span>
<span class="comment-line">#</span>
<span class="comment-line">#     # Check and wait for ports to go link-down.</span>
<span class="comment-line">#     set portList &#34;3:4,5:10,6:3-9&#34;;</span>
<span class="comment-line">#     Login $DUTs_info(DUT1,connect);</span>
<span class="comment-line">#     SendACmd &#34;disable ports $portList&#34;;</span>
<span class="comment-line">#     set rc [AssertPortState $portList 1 down];</span>
<span class="comment-line">#     if {$rc != &#34;ok&#34;} {</span>
<span class="comment-line">#         result_error &#34;Ports failed to link-down!  Reason: $rc&#34;;</span>
<span class="comment-line">#     }</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Verification</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::AssertPortState_5417">proc <a href="misc.tcl-annot.html#::::AssertPortState">::::AssertPortState</a></a></strong> {portList {DUTId 1} {state up} args} {
    <span class="comment-line">#</span>
    <span class="comment-line"># Validate the portList.  expandPortRange will do further validation of</span>
    <span class="comment-line"># the list elements.</span>
    if {$portList == &#34;&#34;} {
        return &#34;badPortList&#34;;
    }

    <span class="comment-line">#</span>
    <span class="comment-line"># Validate the DUTId.</span>
    if {![<a name="::IsInteger(5)"><a href="./misc.tcl.html#::IsInteger_2157">::IsInteger</a></a> $DUTId] || $DUTId &lt; 1} {
        return &#34;badDUTId&#34;;
    }

    <span class="comment-line">#</span>
    <span class="comment-line"># Validate the state and set the link state string.</span>
    switch -- $state {
        up      {set lnkStr A}
        down    {set lnkStr R}
        default {return &#34;badLinkState&#34;}
    }

    <span class="comment-line">#</span>
    <span class="comment-line"># Check for a time parameter record.</span>
    <a name="::parse_args(9)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> [<a name="::ProcName(3)"><a href="./misc.tcl.html#::ProcName_4360">::ProcName</a></a>] $args {
        time &#34;start: 0 interval: 2 dummy: 10 fail: 10&#34;
    }

    <span class="comment-line">#</span>
    <span class="comment-line"># Turn comma-separated lists into space-separated TCL lists.</span>
    regsub -all -- , $portList &#34; &#34; pList;

    <span class="comment-line">#</span>
    <span class="comment-line"># Map over the list and expand any port ranges into discrete port lists.</span>
    <span class="comment-line"># Since a TCL list will be substituted for the port range, join is used</span>
    <span class="comment-line"># to flatten out the list of lists.</span>
    set pList [join [<a name="::xmap(1)"><a href="./misc.tcl.html#::xmap_5242">::xmap</a></a> expandPortRange $pList]];

    <span class="comment-line">#</span>
    <span class="comment-line"># Map over the port list to build the list of patterns for CheckKeyValue.</span>
    <span class="comment-line"># In this case, an anonymous function, or lambda, is used.  For each port</span>
    <span class="comment-line"># in the list, it just returns a string containing the pattern to search</span>
    <span class="comment-line"># for.</span>
    set chkList [<a name="::xmap(2)"><a href="./misc.tcl.html#::xmap_5242">::xmap</a></a> &#34;p {return \&#34;{\$p *.* *\\\[DE\\\] *$lnkStr} exist\&#34;;}&#34; $pList];

    <span class="comment-line">#</span>
    <span class="comment-line"># Call CheckKeyValue and return.</span>
    return [<a name="::CheckKeyValue(5)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show ports $portList configuration no-refresh&#34; \
        $chkList -dut $DUTId -time $time -comment &#34;for link state $lnkStr.&#34;];
}; <span class="comment-line"># proc AssertPortState</span>
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: BackupDefaultXsf</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: cp the default.xsf so that it can be restored</span>
<span class="comment-line">#              at the end of a test case</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              dutList - list of duts to backup</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      BackupDefaultXsf &#34;1&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::BackupDefaultXsf_5482">proc <a href="misc.tcl-annot.html#::::BackupDefaultXsf">::::BackupDefaultXsf</a></a></strong> {dutList} {
    foreach d $dutList {
        <a name="::result_debug(98)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nMake a backup of the default.xsf on DUT $d&#34;
        global DUT${d}_CONNECT
        <a name="::Login(41)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${d}_CONNECT]
        <a name="::SendACmd(101)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;cp default.xsf default.backup&#34;
    }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: RestoreDefaultXsf</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: mv the default.bak to default.xsf</span>
<span class="comment-line">#              BackupDefaultXsf is typically run prior</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              dutList - list of duts to restore</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      RestoreDefaultXsf &#34;1&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::RestoreDefaultXsf_5505">proc <a href="misc.tcl-annot.html#::::RestoreDefaultXsf">::::RestoreDefaultXsf</a></a></strong> {dutList} {
    foreach d $dutList {
        <a name="::result_debug(99)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nRestore the orginal default.xsf on DUT $d&#34;
        global DUT${d}_CONNECT
        <a name="::Login(42)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${d}_CONNECT]
        <a name="::SendACmd(102)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;mv default.backup default.xsf&#34;
    }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
