<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>checkCmdLegality.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#checkCmdLegality.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>checkCmdLegality.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="checkCmdLegality.tcl-annot.html">annotations</a> | <a href="checkCmdLegality.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckCmdIllegal</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Sets result ok if CLI command sent to the switch </span>
<span class="comment-line">#               returns an error</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: cmd {fd_res NULL} {testNo &#34;CheckCmdIllegal&#34;}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckCmdIllegal_18">proc <a href="checkCmdLegality.tcl-annot.html#::::CheckCmdIllegal">::::CheckCmdIllegal</a></a></strong> {cmd {fd_res NULL} {testNo &#34;CheckCmdIllegal&#34;} {reportResults 1}} {
   global spawn_id
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <span class="comment-line">#do not need to show error status, since we know this will cause error</span>
   <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$cmd&#34; $fd_res $fd_in false
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   set rtValue [<a name="::check_illegality(1)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;

   if {$reportResults==1} {
      <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Command &lt;$cmd&gt; should fail&#34;
      if { $rtValue == &#34;illegal&#34; } {
         <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Command illegal as expected&#34;
      } else {
         <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Command should be illegal but accepted&#34;
      }
      <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   }
   return $rtValue
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckCmdLegal</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Test passes if Command sent to switch does not return </span>
<span class="comment-line">#               an error</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: cmd {fd_res NULL} {testNo &#34;CheckCmdLegal&#34;}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckCmdLegal_58">proc <a href="checkCmdLegality.tcl-annot.html#::::CheckCmdLegal">::::CheckCmdLegal</a></a></strong> {cmd {fd_res NULL} {testNo &#34;CheckCmdLegal&#34;} {reportResults 1}} {
   global spawn_id
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$cmd&#34; $fd_res $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   set rtValue [<a name="::check_illegality(2)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;

   if {$reportResults==1} {
      <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Command &lt;$cmd&gt; executed ok&#34;
      if { $rtValue == &#34;illegal&#34; } {
         <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error in executing command&#34;
      } else {
         <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Command executed successfully&#34;
      }
      <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   }
   return $rtValue
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name:  MakeCmdLegal</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  </span>
<span class="comment-line"># Send the command again until the switch accept it. It will</span>
<span class="comment-line"># try it three times and stop               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: cmd {fd_res NULL} {testNo &#34;CheckCmdLegal&#34;}</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MakeCmdLegal_99">proc <a href="checkCmdLegality.tcl-annot.html#::::MakeCmdLegal">::::MakeCmdLegal</a></a></strong> {cmd {fd_res NULL} {testNo &#34;CheckCmdLegal&#34;}} {
   global spawn_id
   
   set rtValue &#34;illegal&#34;
   for {set i 1} {$i &lt;= 3} {incr i 1} {
       set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
       <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$cmd&#34; $fd_res $fd_in
       close $fd_in

       set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
       set rtValue [<a name="::check_illegality(3)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
       close $fd_in
       file delete &#34;Tmp/tmp_$testNo[pid]&#34;

       if { $rtValue == &#34;illegal&#34; } {
           sleep 10
       } else {
           break  
       }
   }
       
   return $rtValue
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: check_illegality</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Used by CheckCmdLegal/Illegal as list of errors </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: fd_in</span>
<span class="comment-line"># Output args: warning/legal/illegal</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::check_illegality_139">proc <a href="checkCmdLegality.tcl-annot.html#::::check_illegality">::::check_illegality</a></a></strong> {fd_in} {
   global validstring
   set rtValue &#34;legal&#34;
   while {[gets $fd_in line] != -1} {
      set valid 0
      if {[info exists validstring]==1} {
      foreach {name value} [array get validstring] {
	if [regexp -nocase &#34;$value&#34; $line] {set valid 1; puts &#34;Matched - Break&#34;; return &#34;legal&#34;}
	}
      }
      <span class="comment-line"># check if line includes word error</span>
      if {[regexp -nocase &#34;error&#34; $line] } {
        set valid 0
      }
      if {$valid} {continue}
      set aList [split $line]
      set lineLength [llength $aList]
      for {set i 0} {$i &lt; $lineLength} {incr i 1} {
	set aWord [lindex $aList $i]
    	<span class="comment-line"># EY-04-20-2010: Remove &#34;default&#34; case from switch statement.</span>
        switch -- [string tolower $aWord] {
    	        &#34;warning&#34; 	{ set rtValue &#34;warning&#34;; break }
    	        &#34;warning:&#34; 	{ set rtValue &#34;warning&#34;; break }
	        &#34;error&#34;   	{ set rtValue &#34;illegal&#34; }
	        &#34;error:&#34;   	{ set rtValue &#34;illegal&#34; }
		&#34;error!&#34;   	{ set rtValue &#34;illegal&#34; }
	        &#34;error.&#34;  	{ set rtValue &#34;illegal&#34; }
                &#34;error:can't&#34;   { set rtValue &#34;illegal&#34; }
                &#34;can't&#34;         { set rtValue &#34;illegal&#34; }
	        &#34;must&#34; 		{ set rtValue &#34;illegal&#34; }
	        &#34;wrong&#34; 	{ set rtValue &#34;illegal&#34; }
		&#34;invalid&#34; 	{ set rtValue &#34;illegal&#34; }
		&#34;illegal&#34; 	{ set rtValue &#34;illegal&#34; }
		&#34;incomplete&#34; 	{ set rtValue &#34;illegal&#34; }
		&#34;unreachable&#34; 	{ set rtValue &#34;illegal&#34; }
		&#34;failed&#34;  	{ set rtValue &#34;illegal&#34; }
		&#34;only&#34;  	{ set rtValue &#34;illegal&#34; }
		&#34;failed:&#34;  	{ set rtValue &#34;illegal&#34; }
		&#34;failed,&#34;  	{ set rtValue &#34;illegal&#34; }
		&#34;cannot&#34;  	{ set rtValue &#34;illegal&#34; }
		&#34;out&#34;   	{ set rtValue &#34;illegal&#34; }
		&#34;already&#34;   	{ set rtValue &#34;illegal&#34; }
		&#34;reached!!&#34;   	{ set rtValue &#34;illegal&#34; }
		&#34;conflict&#34; 	{ set rtValue &#34;illegal&#34; }
		&#34;syntax&#34; 	{ set rtValue &#34;illegal&#34; }
		&#34;ambiguous&#34; 	{ set rtValue &#34;illegal&#34; }
		&#34;aborting&#34; 	{ set rtValue &#34;illegal&#34; }
		&#34;unable&#34; 	{ set rtValue &#34;illegal&#34; }
                &#34;not&#34;           { set rtValue &#34;illegal&#34; }
     	}
        if {[regexp -nocase &#34;Note: Accounts created with this version of EXOS .*&#34; $line]} {
            set rtValue &#34;legal&#34;;
        }
        if {[regexp -nocase &#34;Note: Accounts created with EXOS 16.1 and greater .*&#34; $line]} {
            set rtValue &#34;legal&#34;;
        }
        if {[regexp -nocase &#34;odo.*&#34; -- $line]} {
            set rtValue &#34;legal&#34;;
        }
        if { $rtValue == &#34;illegal&#34; } {
            <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Illegal Line is $line&#34;
		    return $rtValue
	}
      }
   }
   return $rtValue
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: check_vlan_ipAddr</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Verify that a vlan's ip address is correct </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: vlanN vlanIpAddr fd_res testNo</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::check_vlan_ipAddr_223">proc <a href="checkCmdLegality.tcl-annot.html#::::check_vlan_ipAddr">::::check_vlan_ipAddr</a></a></strong> {vlanN vlanIpAddr fd_res testNo} {
   global spawn_id
   global VERSION
   set found &#34;false&#34;

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;sh $vlanN&#34; $fd_res $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check vlan $vlanN Ip address configuration&#34;
   while {[gets $fd_in line] != -1} {
      set cookedLine [<a name="::cookString(1)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $line]
      set aList [split $cookedLine]
<span class="comment-line">#result_debug &#34;----- cookedLine=$cookedLine&#34;</span>
      if { [lindex $aList 0] == &#34;IP:&#34; } {
         set found &#34;true&#34;
	     set tmpIpAddr [lrange $aList 1 2]
         set tmpIpAddr [string trimright $tmpIpAddr .]
		 if { $tmpIpAddr == $vlanIpAddr } {
            <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$vlanN Ip address, $vlanIpAddr, is expected&#34;
         } else {
            <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$vlanN Ip address is wrong&#34;
            <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Expect $vlanIpAddr, got $tmpIpAddr&#34;
         }
	     break
      }
   }
   if { ($VERSION == 6) &amp;&amp; ($found == &#34;false&#34;) }	{
      <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$vlanN Ip address, $vlanIpAddr, is expected&#34;
   }
   <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: check_ip_forward</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  Determine if IPForwarding is enabled or not</span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: dList fd_res testNo</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::check_ip_forward_275">proc <a href="checkCmdLegality.tcl-annot.html#::::check_ip_forward">::::check_ip_forward</a></a></strong> {dList fd_res testNo} {
   global spawn_id
   global VERSION

   switch $VERSION {
      4 { set cmd &#34;sh ipconfig&#34; }
      5 { set cmd &#34;sh ipconfig&#34; }
      6 -
      default { set cmd &#34;sh ipconfig detail&#34; }
   }
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w+&#34;]
   <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$cmd&#34; $fd_res $fd_in
   flush $fd_in

   foreach dPair [lsort $dList]	{
      seek $fd_in 0
      set goValue &#34;go&#34;
      set vlan [lindex $dPair 0]
      set stat [lindex $dPair 1]

      while {[gets $fd_in line] != -1} {
         set cookedLine [<a name="::cookString(2)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $line]
         set aList [split $cookedLine]

         if { $vlan == &#34;&#34; } {
            if { ([lindex $aList 0] == &#34;IP&#34;) &amp;&amp; ([lindex $aList 1] == &#34;Routing&#34;) } {
               set tmpStat [lindex $aList 3]
               <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check DUT Ip forwarding status&#34;
               if { $tmpStat == $stat } {
                  <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Ip forwarding is $stat as expected&#34;
               } else {
                  <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Ip forwarding is $tmpStat, which is WRONG&#34;
               }
               <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
               set goValue end
	       break
            }
         } else {
            if { [lindex $aList 4] == $vlan } {
               while {[gets $fd_in line] != -1} {
                  set cookedLine [<a name="::cookString(3)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $line]
                  ;<span class="comment-line">#set aList [split $cookedLine]</span>
                  set ipfValue [<a name="::swValueYesNo(1)"><a href="./checkCmdLegality.tcl.html#::swValueYesNo_381">::swValueYesNo</a></a> $stat]
                  
                  ;<span class="comment-line">#Change to support sh ipc det o/p change since 700b38-SCFixes3-2</span>
                  ;<span class="comment-line">#set build [GetVersion DUT1 3];</span>
                  ;<span class="comment-line">#set image [GetVersion DUT1 2]</span>
                  ;<span class="comment-line">#set ver [GetVersion DUT1 4];</span>
                  ;<span class="comment-line">#if {($ver==&#34;7.0.0&#34;&amp;&amp;$build&gt;=38)||($image&gt;=&#34;7.0&#34;)} {</span>
                  ;<span class="comment-line">#   set firStr [lindex $aList 2]</span>
                  ;<span class="comment-line">#   set secStr [lindex $aList 3]</span>
                  ;<span class="comment-line">#   set tmpStat [lindex $aList 4]</span>
                  ;<span class="comment-line">#} else {</span>
                  ;<span class="comment-line">#   set firStr [lindex $aList 0]</span>
                  ;<span class="comment-line">#   set secStr [lindex $aList 1]</span>
                  ;<span class="comment-line">#   set tmpStat [lindex $aList 2]</span>
                  ;<span class="comment-line">#}</span>
                  ;<span class="comment-line">#if { $firStr==&#34;IP&#34;&amp;&amp;$secStr==&#34;Fwding&#34; }</span>
                  if {[regexp -nocase &#34;ip fwding *(yes|no)&#34; $cookedLine notUsed tmpStat]} {
                     <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check vlan $vlan Ip forwarding status&#34;
                     if { $tmpStat == $ipfValue } {
                        <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$vlan Ip forwarding is $stat as expected&#34;
                     } else {
                        <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$vlan Ip forwarding is $tmpStat, which is WRONG&#34;
                     }
                     <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
                     set goValue end
                     break
                  }
               } ;<span class="comment-line"># while</span>
            } ;<span class="comment-line"># if {line == vlan}</span>
	 } ;<span class="comment-line"># if {vlan != &#34;&#34;}</span>
         if { $goValue == &#34;end&#34; } {
            break
         }
      } ;<span class="comment-line"># while</span>
      if { $goValue == &#34;go&#34; } {
         <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check vlan $vlan Ip forwarding status&#34;
         if { $stat == &#34;Disabled&#34; } {
            <a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;$vlan Ip forwarding is $stat as expected&#34;
         } else {
            <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$vlan Ip forwarding is $tmpStat, which is WRONG&#34;
         }
         <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      }
   } ;<span class="comment-line"># foreach</span>
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;
} ;<span class="comment-line"># check_ip_forward</span>
   
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: swValueYesNo</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Determine if a status passed in is equal to </span>
<span class="comment-line">#                enabled or disabled</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::swValueYesNo_381">proc <a href="checkCmdLegality.tcl-annot.html#::::swValueYesNo">::::swValueYesNo</a></a></strong> {<a name="::stat(1)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a>} {
   switch $stat {
      Enabled  { set value YES }
	  enabled  { set value YES }
	  Disabled { set value NO }
	  disabled { set value NO }
   }
   return $value
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: check_multinetting</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Verify if IPMultinetting is enabled or disabled </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: stat DUT fd_res testNo</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::check_multinetting_407">proc <a href="checkCmdLegality.tcl-annot.html#::::check_multinetting">::::check_multinetting</a></a></strong> {<a name="::stat(2)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> DUT fd_res testNo} {
   global spawn_id
   global VERSION

   set cmd &#34;sh ipconfig&#34;
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT -fd $fd_res
   <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$cmd&#34; $fd_res $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   while {[gets $fd_in line] != -1} {
      set cookedLine [<a name="::cookString(4)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $line]
      set aList [split $cookedLine]

      if { [string tolower [lindex $aList 0]] == &#34;multinetting&#34; } {
         set tmpStat [string tolower [lindex $aList 2]]
         <a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check DUT Ip multinetting status&#34;
         if { $tmpStat	== $stat } {
            <a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Ip multinetting is $stat as expected&#34;
         } else {
            <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Ip multinetting is $tmpStat, which is WRONG&#34;
         }
         <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
	  }
	}  
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: check_fdb_aging</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Verify if FDB aging is set to an expected valued </span>
<span class="comment-line">#               </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: ageValue DUT fd_res testNo</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifySwitchOutput</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::check_fdb_aging_453">proc <a href="checkCmdLegality.tcl-annot.html#::::check_fdb_aging">::::check_fdb_aging</a></a></strong> {ageValue DUT fd_res testNo} {
   global spawn_id
   global VERSION

   set cmd &#34;sh fdb&#34;
   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;w&#34;]
   <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT -fd $fd_res
   <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;$cmd&#34; $fd_res $fd_in
   close $fd_in

   set fd_in [open &#34;Tmp/tmp_$testNo[pid]&#34; &#34;r&#34;]
   while {[gets $fd_in line] != -1} {
      set cookedLine [<a name="::cookString(5)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $line]
      set aList [split $cookedLine]

      if { ([string tolower [lindex $aList 0]] == &#34;fdb&#34;) &amp;&amp;
           ([string tolower [lindex $aList 1]] == &#34;aging&#34;) } {
         set tmpStat [lindex $aList 3]
         <a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check FDB aging time&#34;
         if { $tmpStat	== $ageValue } {
            <a name="::result_ok(9)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;FDB aging time is $tmpStat as expected&#34;
         } else {
            <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;FDB aging time is $tmpStat which is WRONG.  Expect $ageValue&#34;
         }
         <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
	  }
	}  
   close $fd_in
   file delete &#34;Tmp/tmp_$testNo[pid]&#34;
}
      
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
