<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>pimsm-lib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#pimsm-lib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>pimsm-lib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="pimsm-lib.tcl-annot.html">annotations</a> | <a href="pimsm-lib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::CheckShPim_2">proc <a href="pimsm-lib.tcl-annot.html#::::CheckShPim">::::CheckShPim</a></a></strong> {args} {
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckShPim $args {

       dutConnect &#34;1&#34;
       comment &#34;&#34;
       bsrState &#34;&#34;
       bsrAddress &#34;&#34;
       priority &#34;&#34;
       advInterval &#34;&#34;
       holdTimer &#34;&#34;
       s &#34;1&#34;
       i &#34;2&#34;
       d &#34;120&#34;
       f &#34;120&#34;
       }
        global DUT[set dutConnect]_CONNECT
        <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dutConnect]_CONNECT]
        
        set parameterList &#34;&#34;
        if {$advInterval != &#34;&#34;} {
        lappend parameterList &#34;{CRP.*Adv.*Interval.*$advInterval.*CRP.*Holdtime.*$holdTimer} exist&#34;
        }
        if {$bsrState != &#34;&#34;} {
        lappend parameterList &#34;{BSR.*state.*$bsrState}  exist&#34;
        }
        if {$bsrAddress != &#34;&#34;} {
        lappend parameterList  &#34;{Current.*BSR.*Info.*$bsrAddress} exist&#34;
        } 
        if {$priority != &#34;&#34;} {
        lappend parameterList  &#34;{Current.*BSR.*Info.*$bsrAddress.*Priority.*$priority} exist&#34;
        }
        <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show pim&#34; $parameterList -comment $comment \
                      -time &#34;s: [set s] i: [set i] d: [set d] f: [set f] r&#34;
        unset parameterList
}                 
<strong><a name="::::CheckShPimVlan_37">proc <a href="pimsm-lib.tcl-annot.html#::::CheckShPimVlan">::::CheckShPimVlan</a></a></strong> {args} {
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckShPim $args {

       dutConnect &#34;1&#34;
       comment &#34;&#34;
       <a name="::vlan(1)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> &#34;&#34;
       numBstraps &#34;&#34;
       }
        global DUT[set dutConnect]_CONNECT
        <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dutConnect]_CONNECT]
        
        set parameterList &#34;&#34;
        lappend parameterList &#34;{Hellos.*Bootstraps.*$numBstraps} exist&#34;
        <a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show pim $vlan&#34; $parameterList -comment $comment \
                      -time {s: 1 i: 2 d: 60 f: 60 r}
        unset parameterList

}

<strong><a name="::::CheckBootStraps_56">proc <a href="pimsm-lib.tcl-annot.html#::::CheckBootStraps">::::CheckBootStraps</a></a></strong> {args} {
    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckBootStraps $args {

       dutConnect &#34;1&#34;
       <a name="::vlan(2)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> &#34;&#34;
       inOut &#34;in&#34;
       comment &#34;&#34;
       numBstraps &#34;1&#34;
       }
        <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking Bootstrap $inOut Msg&#34;
        
        global DUT[set dutConnect]_CONNECT
        <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dutConnect]_CONNECT]
        if {$inOut == &#34;in&#34; } {
        set parameterList &#34;&#34;
        lappend parameterList &#34;Hellos.*Bootstraps 1&#34;
        } else {
         set parameterList &#34;&#34;
        lappend parameterList &#34;Hellos.*Bootstraps 2&#34;
        }
        set numBstrapsRcd [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show pim $vlan&#34; $parameterList]
        if {$numBstraps == $numBstrapsRcd} {
        <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Got correct Bootstraps = $numBstrapsRcd&#34;
        } else {
        <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Got incorrect Bootstraps = $numBstrapsRcd&#34;
        }
        <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}


<strong><a name="::::CheckShPimRP_86">proc <a href="pimsm-lib.tcl-annot.html#::::CheckShPimRP">::::CheckShPimRP</a></a></strong> {args} {
    <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckShPim $args {

       dutConnect &#34;1&#34;
       comment &#34;&#34;
       crp &#34;&#34;
       groupIp &#34;&#34;
       priority &#34;&#34;
       exists 1
       }
        global DUT[set dutConnect]_CONNECT
        <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dutConnect]_CONNECT]
        set parameterList &#34;&#34;
        if {$exists == 1} {
        if {$priority == &#34;&#34;} {
        set parameterList &#34;&#34;
        lappend parameterList &#34;{$groupIp.*$crp} exist&#34;
        } else {
        set parameterList &#34;&#34;
        lappend parameterList &#34;{$groupIp.*$crp.*$priority} exist&#34;
        }
        } else {
        if {$priority == &#34;&#34;} {
        set parameterList &#34;&#34;
        lappend parameterList &#34;{$groupIp.*$crp} notExist&#34;
        } else {
        set parameterList &#34;&#34;
        lappend parameterList &#34;{$groupIp.*$crp.*$priority} notExist&#34;
        } 
        }
        <a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show pim rp-set&#34; $parameterList -comment $comment \
                      -time {s: 1 i: 2 d: 50 f: 50  r} 
        unset parameterList
}
<strong><a name="::::CheckShLog_120">proc <a href="pimsm-lib.tcl-annot.html#::::CheckShLog">::::CheckShLog</a></a></strong> {args} {
    <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckShPim $args {

       dutConnect &#34;1&#34;
       comment &#34;&#34;
       vlanAccp &#34;&#34;
       vlanRej  &#34;&#34;
       bsrAddress &#34;&#34;
       }
        global DUT[set dutConnect]_CONNECT
        <a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dutConnect]_CONNECT]
        set parameterList &#34;&#34;
        lappend parameterList &#34;{Received.*pim.*Bootstrap.*$vlanAccp} {Bsr.*packet.*received.*from.*$bsrAddress.*failed.*RPF.*test} inLine exist 1&#34;
        lappend parameterList &#34;{Received.*pim.*Bootstrap.*$vlanAccp} {Received.*pim.*Bootstrap.*$vlanRej} inLine exist 2&#34;
        <a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show log&#34; $parameterList -comment $comment \
                      -time {s: 1 i: 2 d: 60 f: 60  r}
        unset parameterList
}

<strong><a name="::::CheckBootStrapsMsg_139">proc <a href="pimsm-lib.tcl-annot.html#::::CheckBootStrapsMsg">::::CheckBootStrapsMsg</a></a></strong> {args} {
    <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckBootStrapsMsg $args {

       dutConnect &#34;1&#34;
       <a name="::vlan(3)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> &#34;&#34;
       in &#34;1&#34;
       out &#34;1&#34;
       }

        global DUT[set dutConnect]_CONNECT
        <a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT[set dutConnect]_CONNECT]
        set parameterList &#34;&#34;
	lappend parameterList &#34;{Packet.*Statistics.*In.*Out} {Hellos.*Bootstraps.*$in.*$out} inLine exist 1&#34;
	<a name="::CheckKeyValue(5)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show pim $vlan&#34; $parameterList -time {s: 1 i: 2 d: 90 f: 90 r}

}

<strong><a name="::::encodedBSRGroupAddressesRP_156">proc <a href="pimsm-lib.tcl-annot.html#::::encodedBSRGroupAddressesRP">::::encodedBSRGroupAddressesRP</a></a></strong> {rawFrame RPAddressList  } {
   set messageType [<a name="::GetMessageType(1)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set groupAddress &#34;&#34;
   if {$messageType==&#34;IP_PIMv2_BOOTSTRAP&#34;} {
      set type [string range $rawFrame 36 40]
      if {$type == &#34;81 00&#34;} {
        set leftRawFrame [string range $rawFrame 0 35]
        set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
        set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
      }
       set BSRGroupAddresses &#34;&#34;
       set BSREncodedRPAddress &#34;&#34;
      set FRPCount [string range $rawFrame 168 172]
      if {$FRPCount == &#34;04 04&#34;} {
      <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$rawFrame&#34;
      set startLoc 144
      set RPStartLoc 156
      for {set startLoc 144} {[expr $startLoc+156]&lt;=[expr [string length $rawFrame]-11]} {incr startLoc $RPStartLoc} {
         lappend BSRGroupAddresses [<a name="::GetIPAddressOffset(1)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame [expr $startLoc + 12]]
         set BSRRPCount [string range $rawFrame [expr $startLoc+24] [expr $startLoc+24+1]]
         set RPAddressStartLoc [expr $startLoc + 36]
         set BSREncodedRPAddress &#34;&#34;
         for {set i 1} {$i&lt;=$BSRRPCount} {incr i} {
            lappend BSREncodedRPAddress [<a name="::GetIPAddressOffset(2)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame [expr $RPAddressStartLoc + 6]]
            set RPAddressStartLoc [expr $RPAddressStartLoc + 30]
         }
   }

   }
   lappend BSRGroupAddresses $BSREncodedRPAddress
   return $BSRGroupAddresses
   } else {
      return -1
   }
}


<strong><a name="::::CheckPimRegisterPkt_193">proc <a href="pimsm-lib.tcl-annot.html#::::CheckPimRegisterPkt">::::CheckPimRegisterPkt</a></a></strong> {args} {
    <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckPimRegisterPkt $args {
       portId &#34;&#34;
       }
        <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;PIM REGISTER MESSAGE RECEIVED&#34;

        set rawFrameLst [<a name="::GetCapturedFrames(1)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portId NULL 2000000]
        set match 0

                foreach rawFrame $rawFrameLst {

                set pimPktType [<a name="::GetMessageType(2)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
                <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$pimPktType&#34;

                if {($pimPktType == &#34;IP_PIMv2_REGISTER&#34;) || ($pimPktType == &#34;IP_PIMv2_NULL_REGISTER&#34;)} {
                        incr match
                        break;
               }
        }

                if {$match == 1} {
                        <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;PIM REGISTER MESSAGE RECEIVED&#34;
                } else {
                        <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;PIM REGISTER MESSAGE NOT RECEIVED&#34;
                        }


        <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

 }

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
