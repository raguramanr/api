<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>mysqlAutomateAll.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#mysqlAutomateAll.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>mysqlAutomateAll.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="mysqlAutomateAll.tcl-annot.html">annotations</a> | <a href="mysqlAutomateAll.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>


source ../Lib/parse_args.tcl
source ../Lib/mysqlLib.tcl
set cfgFile ../main/runReg.cfg

<span class="comment-line"># Source config file that has Regression PC information</span>
if [file exists $cfgFile] {
    puts &#34;Sourcing $cfgFile now&#34;
    catch {source $cfgFile} reason
} else {
    puts &#34;!!! Configuration file $cfgFile not found !!!&#34;
    return 0
}


global mysqlIP my_db
set host $mysqlIP
set db $my_db
global host mysql_handler

<a name="::conn_to_db(1)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db

<a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> mysqlAutomateAll $argv {
    regId &#34;null&#34;
    qId &#34;null&#34;
    module &#34;no&#34;
    forstats &#34;no&#34;
    type &#34;normal&#34;
    runNumber &#34;-1&#34;
    manual  &#34;null&#34;
}

if {$manual != &#34;null&#34;} {
    puts &#34;Using manual qId to get the regId&#34;
    set qId $manual
    set regId [mysqlsel $mysql_handler &#34;SELECT regression_id from regression_table WHERE queue_id = '$qId' &#34; -flatlist]
    if {[llength $regId] &gt; 1} {
        catch {flush stdin}
        set pId 0
        set uChoice &#34;abc.cfg&#34;
        puts &#34; &#34;
        puts -nonewline &#34;You gots to enter a cfg file too.  There are more than on test beds sharing this queueid. \[$uChoice]? &#34;
        flush stdout;
        set uChoice [gets stdin];
        set pId [mysqlsel $mysql_handler &#34;SELECT platform_id from platform_table WHERE platform_cfg_file_name = '$uChoice' AND status = 'Active'&#34; -flatlist]
        set pId [lindex $pId 0]
        if {[regexp -nocase &#34;\[0-9]+&#34; $pId]} {
            set regId [mysqlsel $mysql_handler &#34;SELECT regression_id from regression_table WHERE queue_id = '$qId' AND platform_id = '$pId'&#34; -flatlist]
        } else {
            puts &#34;Did not get the platform_id and there was more than 1 regid&#34;;
            exit;
        }
        if {[llength $regId] == 1} {
            puts &#34;Looking good&#34;
        } else {
            puts &#34;Still getting more than 1 regid&#34;;
            exit;
        }
    }
    if {$regId == &#34;&#34;} {
        puts &#34;No regression_id matching for queue_id:$qId&#34;
        return 0
    }
}
if {$regId == &#34;null&#34; &amp;&amp; $qId != &#34;null&#34;} {
    puts &#34;Using manual qId to get the regId&#34;
    set regId [mysqlsel $mysql_handler &#34;SELECT regression_id from regression_table WHERE queue_id = '$qId' &#34; -flatlist]
    if {[llength $regId] &gt; 1} {
        catch {flush stdin}
        set pId 0
        set uChoice &#34;abc.cfg&#34;
        puts &#34; &#34;
        puts -nonewline &#34;You gots to enter a cfg file too.  There are more than on test beds sharing this queueid. \[$uChoice]? &#34;
        flush stdout;
        set uChoice [gets stdin];
        set pId [mysqlsel $mysql_handler &#34;SELECT platform_id from platform_table WHERE platform_cfg_file_name = '$uChoice' AND status = 'Active'&#34; -flatlist]
        set pId [lindex $pId 0]
        if {[regexp -nocase &#34;\[0-9]+&#34; $pId]} {
            set regId [mysqlsel $mysql_handler &#34;SELECT regression_id from regression_table WHERE queue_id = '$qId' AND platform_id = '$pId'&#34; -flatlist]
        } else {
            puts &#34;Did not get the platform_id and there was more than 1 regid&#34;;
            exit;
        }
        if {[llength $regId] == 1} {
            puts &#34;Looking good&#34;
        } else {
            puts &#34;Still getting more than 1 regid&#34;;
            exit;
        }
    }
    if {$regId == &#34;&#34;} {
        puts &#34;No regression_id matching for queue_id:$qId&#34;
        return 0
    }    
}
puts &#34;regId $regId&#34;
set regression_id $regId


set regType [mysqlsel $mysql_handler &#34;SELECT feature_type from regression_table WHERE regression_id = '$regression_id' &#34; -flatlist]
if {$regType == &#34;&#34;} {
    puts &#34;No regType for regression_id:$regression_id&#34;
    return 0
}
puts &#34;regType: $regType&#34;

set regSubType [mysqlsel $mysql_handler &#34;SELECT feature_sub_type from regression_table WHERE regression_id = '$regression_id' &#34; -flatlist]
if {$regSubType == &#34;&#34;} {
    puts &#34;No regSubType for regression_id:$regression_id&#34;
    return 0
}
puts &#34;regSubType: $regSubType&#34;
if {$type != &#34;web&#34;} {
    puts &#34;Normal run&#34;
    set regressionModules [mysqlsel $mysql_handler \
            &#34;SELECT feature_directory FROM feature_table WHERE feature_type = '$regType' \
            AND feature_sub_type = '$regSubType' AND status = 'Active' ORDER BY feature_name&#34; -flatlist]


    if {$regressionModules == &#34;&#34;} {
        puts &#34;No modules list for regression_id: $regression_id&#34;
        return 0
    }
    puts &#34;regressionModules: \n$regressionModules\n&#34;

    foreach testModule $regressionModules {
        if {$module != &#34;no&#34; &amp;&amp; $testModule != &#34;$module&#34;} {
            continue;
        }
        puts &#34;\n ==== Uploading testModule $testModule for regId $regression_id ====&#34;
        if {[catch { exec {tclsh} mysqlAutomate.tcl -regId $regression_id -runNumber $runNumber -manual $manual -qId $qId \
                                 -module $testModule -forstats $forstats } \
                                 result]} {
            puts &#34;mysqlAutomate.tcl returned an error&#34;
        }
        
        puts &#34;RESULTS OF mysqlAutomate: $result&#34;
    }
} else {
    puts &#34;Web update with failAnalysis&#34;
    if {$module != &#34;no&#34;} {
        set inFId [mysqlsel $mysql_handler &#34;SELECT feature_id from feature_table WHERE feature_directory = '$module' &#34; -flatlist]
    }
    set feature_ids [mysqlsel $mysql_handler \
      &#34;SELECT feature_id FROM report_table WHERE regression_id = '$regId'&#34; -flatlist]
    puts &#34;SELECT feature_id FROM report_table WHERE regression_id = '$regId'&#34;
    puts &#34;Found [llength $feature_ids] features&#34;
    foreach feature_id $feature_ids {
        if {$module != &#34;no&#34; &amp;&amp; $feature_id != $inFId} {
            puts &#34;Skipping feature not passed in $feature_id&#34;
            continue;
        }
        set regression_id_url [http_formatQuery regression_id $regId feature_id \
                               $feature_id run_number 1 forstats $forstats]
        puts &#34;\n ==== failAnalysis $regression_id_url ====&#34;
        catch { exec {tclsh} mysqlFailAnalysis.tcl -regression_id $regId -feature_id $feature_id \
        -run_number 1 -forstats $forstats &amp;} result
    }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
