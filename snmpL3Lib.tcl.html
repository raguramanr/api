<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>snmpL3Lib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#snmpL3Lib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>snmpL3Lib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="snmpL3Lib.tcl-annot.html">annotations</a> | <a href="snmpL3Lib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>


<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpGetIfIndexForIpAddr</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures retrieves the interface index for the given</span>
<span class="comment-line">#    IP address.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection </span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    ipaddr  - IP address </span>
<span class="comment-line">#    fd      - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#     None</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Interface Index associated with the given IP address</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpGetIfIndexForIpAddr -session $sessionid -ipaddr 10.0.0.1</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpGetIfIndexForIpAddr_29">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpGetIfIndexForIpAddr">::::snmpGetIfIndexForIpAddr</a></a></strong> {session ipaddr {fd NULL}} {
  set func &#34;snmpGetIfIndexForIpAddr:&#34;

  <a name="::snmpDebug(1)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - session-$session ipaddr-$ipaddr&#34; $fd
  set result [snmpGet -session $session -oid ipAdEntIfIndex.$ipaddr]
  <a name="::snmpDebug(2)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - snmpGet -$result&#34; $fd
  set retVal [<a name="::snmpUtilGetVal(1)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $result]
  <a name="::snmpDebug(3)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - snmpGet IfIndex is $retVal&#34; $fd
  return $retVal
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCreateIpArpEntry</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures creates the static IP ARP entry.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection </span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    network - IP address of the network through which this ARP</span>
<span class="comment-line">#              entry to be created</span>
<span class="comment-line">#    ipaddr  - IP address in the ARP entry</span>
<span class="comment-line">#    mac     - MAC address in the ARP entry</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0       - On failure </span>
<span class="comment-line">#    Ifindex corresponding to the ARP entry - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCreateIpArpEntry -session $sessionid -network 10.0.0.0 \</span>
<span class="comment-line">#                         -ipaddr 10.0.0.5 -mac &#34;00:01:02:03:04:05&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpCreateIpArpEntry_69">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpCreateIpArpEntry">::::snmpCreateIpArpEntry</a></a></strong> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCreateIpArpEntry $args {
      session &#34;&#34;
      network &#34;&#34;
      ipaddr &#34;&#34;
      mac &#34;&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpCreateIpArpEntry:&#34;

   if { $network == &#34;&#34; || $session == &#34;&#34; || $mac == &#34;&#34; || $ipaddr == &#34;&#34;} {
       error &#34;$func network, session, ipaddress and mac must be specified&#34;
       return 0
   }

   <a name="::snmpDebug(4)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func network=$network session=$session ipaddr=$ipaddr mac=$mac - Start&#34; $fd

   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Creating static IP ARP entry $ipaddr - $mac --&#34;

   <span class="comment-line"># ----- Change the MAC address to corresponding HEX string</span>
   regsub {([0-9|A-F|a-f]+):([0-9|A-F|a-f]+):([0-9|A-F|a-f]+):([0-9|A-F|a-f]+):([0-9|A-F|a-f]+):([0-9|A-F|a-f]+)} $mac {\1 \2 \3 \4 \5 \6} cookedMac

   <a name="::snmpDebug(5)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func cookedMac is $mac -&gt; $cookedMac&#34; $fd

   set ifindex [<a name="::snmpGetIfIndexForIpAddr(1)"><a href="./snmpL3Lib.tcl.html#::snmpGetIfIndexForIpAddr_29">::snmpGetIfIndexForIpAddr</a></a> $session $network $fd]
   set result [snmpSet -session $session -oid ipNetToMediaType.$ifindex.$ipaddr\
                       -type i -val 4 \
                       -oid ipNetToMediaPhysAddress.$ifindex.$ipaddr \
                       -type x -val $cookedMac]
  <a name="::snmpDebug(6)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet - $result&#34; $fd

  <a name="::snmpDebug(7)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
  return $ifindex
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpDeleteIpArpEntry</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures deletes an already created static IP ARP entry.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection </span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    ifindex - Interface index returned when creating IP ARP entry.</span>
<span class="comment-line">#    ipaddr  - IP address in the ARP entry</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line">#    network - IP address of the network through which this ARP</span>
<span class="comment-line">#              entry was created</span>
<span class="comment-line">#    ifindex - This parameter is OPTIONAL, if network parameter </span>
<span class="comment-line">#              is specifed. Otherwise this is a mandatory parameter</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0    - On failure </span>
<span class="comment-line">#    1    - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#  set ifindex [snmpCreateIpArpEntry -session $sessionid \</span>
<span class="comment-line">#                                    -network 10.0.0.1 \</span>
<span class="comment-line">#                                    -ipaddr 10.0.0.5 \</span>
<span class="comment-line">#                                    -mac &#34;00:01:02:03:04:05&#34;]</span>
<span class="comment-line"># snmpDeleteIpArpEntry -session $sessionid -ifindex $ifindex\</span>
<span class="comment-line">#                      -ipaddr 10.0.0.5</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpDeleteIpArpEntry_140">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpDeleteIpArpEntry">::::snmpDeleteIpArpEntry</a></a></strong> {args} {
  <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpDeleteIpArpEntry $args {
     session &#34;&#34;
     ifindex &#34;&#34;
     ipaddr &#34;&#34;
     network &#34;&#34;
     fd &#34;NULL&#34;
  }

  set func &#34;snmpDeleteIpArpEntry:&#34;

  if { $ifindex != &#34;&#34; &amp;&amp; $network != &#34;&#34; } {
     error &#34;Either ifindex or network must be specified&#34;
     return 0
  }

  if { $session == &#34;&#34; || $ipaddr == &#34;&#34;} {
      error &#34;$func session, ipaddress and ifindex must be specified&#34;
      return 0
  }

  <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Deleting IP ARP entry $ipaddr, index - $ifindex --&#34;

  <a name="::snmpDebug(8)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session=$session ifindex=$ifindex ipaddr=$ipaddr - Start&#34; $fd

  <span class="comment-line"># ----- If network is specified, then ifindex needs to be found out</span>
   
  if { $network != &#34;&#34; } {
     set ifindex [<a name="::snmpGetIfIndexForIpAddr(2)"><a href="./snmpL3Lib.tcl.html#::snmpGetIfIndexForIpAddr_29">::snmpGetIfIndexForIpAddr</a></a> $session $network $fd]
  }

  set result [snmpSet -session $session -oid ipNetToMediaType.$ifindex.$ipaddr\
                       -type i -val 2]
  <a name="::snmpDebug(9)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpSet - $result&#34; $fd
  <a name="::snmpDebug(10)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
  return 1 
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckIpArpEntry</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures checks the existence of IP ARP entry.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session - Session identifier which identifies the connection </span>
<span class="comment-line">#              with the DUT</span>
<span class="comment-line">#    network - IP address of the network through which the ARP</span>
<span class="comment-line">#              entry is created</span>
<span class="comment-line">#    ipaddr  - IP address in the ARP entry</span>
<span class="comment-line">#    mac     - MAC address in the ARP entry</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    ifindex - Interface index associated with this ARP entry</span>
<span class="comment-line">#    comment - Test case comment to be logged in the text file.</span>
<span class="comment-line">#    result - If the value is &#34;exist&#34;, the ARP entry must be </span>
<span class="comment-line">#             present. If &#34;notexist&#34;, ARP entry should not </span>
<span class="comment-line">#             be present in the IP FDB. Default is &#34;exist&#34; </span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0       - On failure </span>
<span class="comment-line">#    1       - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckIpArpEntry -session $sessionid -network 10.0.0.0 \</span>
<span class="comment-line">#                         -ipaddr 10.0.0.5 -mac &#34;00:01:02:03:04:05&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpCheckIpArpEntry_212">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpCheckIpArpEntry">::::snmpCheckIpArpEntry</a></a></strong> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckIpArpEntry $args {
      session &#34;&#34;
      status &#34;exist&#34;
      network &#34;&#34;
      ipaddr &#34;&#34;
      mac &#34;&#34;
      ifindex &#34;&#34;
      fd &#34;NULL&#34;
      comment &#34;snmpCheckIpArpEntry&#34;
   }

   set func &#34;snmpCheckIpArpEntry:&#34;
   set retVal 0

   if { $network == &#34;&#34; || $session == &#34;&#34; || $mac == &#34;&#34; || $ipaddr == &#34;&#34;} {
       error &#34;$func network, session, ipaddress and mac must be specified&#34;
       return 0
   }

   <a name="::snmpDebug(11)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func network=$network session=$session ipaddr=$ipaddr mac=$mac - Start&#34; $fd

   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Checking IP ARP entry $ipaddr - $mac --&#34;

   <span class="comment-line"># ---- If ifindex is not specified, get the interface index</span>
   if { $ifindex == &#34;&#34; } {
      set ifIndex [<a name="::snmpGetIfIndexForIpAddr(3)"><a href="./snmpL3Lib.tcl.html#::snmpGetIfIndexForIpAddr_29">::snmpGetIfIndexForIpAddr</a></a> $session $network $fd]
   } else {
      set ifIndex $ifindex
   }

   set result [snmpGet -session $session -oid ipNetToMediaPhysAddress.$ifIndex.$ipaddr]
   <a name="::snmpDebug(12)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet - $result&#34; $fd
   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;
   <span class="comment-line"># ----- Change the MAC address according to the SNMP output</span>
   regsub {([0-9|A-F|a-f]+):([0-9|A-F|a-f]+):([0-9|A-F|a-f]+):([0-9|A-F|a-f]+):([0-9|A-F|a-f]+):([0-9|A-F|a-f]+)} $mac {\1 \2 \3 \4 \5 \6} cookedMac
   
   <a name="::snmpDebug(13)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func $mac is changed to $cookedMac&#34; $fd
   set test &#34;.*$cookedMac&#34;
   if {[regexp -nocase $test $result] == 1} {
      if {[string compare &#34;exist&#34; [string tolower $status]] == 0 } {
          <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IP ARP entry $ipaddr $mac exist. PASS&#34;
          set retVal 1
      } else {
          <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;IP ARP entry $ipaddr $mac exist expected $status. FAIL&#34;
      }
   } else {
      if {[string compare &#34;notexist&#34; [string tolower $status]] == 0 } {
          <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IP ARP entry $ipaddr $mac not exist expected $status. PASS&#34;
          set retVal 1
      } else {
          <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;IP ARP entry $ipaddr $mac not exist expected $status. FAIL&#34;
      }
   }

   <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   <a name="::snmpDebug(14)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   return $retVal
}


<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckIpFdb</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures checks whether the specified ipaddress </span>
<span class="comment-line">#    is learnt or not learnt through the given vlan and port id.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session   - Session identifier which identifies the connection </span>
<span class="comment-line">#                with the DUT</span>
<span class="comment-line">#    vlanid    - Identifier for already created vlan</span>
<span class="comment-line">#    port      - Port number</span>
<span class="comment-line">#    ipaddress - IP address to be checked for its existence or </span>
<span class="comment-line">#                non-existence.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    comment - Test case comment to be logged in the text file.</span>
<span class="comment-line">#    result - If the value is &#34;exist&#34;, the IP address must be </span>
<span class="comment-line">#             present. If &#34;notexist&#34;, IP address should not </span>
<span class="comment-line">#             be present in the IP FDB. Default is &#34;exist&#34; </span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    Logs the error message   - On failure </span>
<span class="comment-line">#    Logs the success message - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    set  ipaddr &#34;10.21.23.4&#34;</span>
<span class="comment-line">#    snmpCheckIpFdb -session $sessionid -vlanid $vlan_id -port 1\</span>
<span class="comment-line">#          -ipaddress $ipaddr -result exist \</span>
<span class="comment-line">#          -comment &#34;Check $ipaddr through vlan $vlan_id port 1&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpCheckIpFdb_309">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpCheckIpFdb">::::snmpCheckIpFdb</a></a></strong> { args } {
   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckIpFdb $args {
      session &#34;&#34;
      result &#34;exist&#34;
      mac &#34;&#34;
      ipaddress &#34;&#34;
      vlanid &#34;&#34;
      <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;&#34;
      comment &#34;none&#34;
      fd &#34;NULL&#34;
   }

  set func &#34;snmpCheckIpFdb:&#34;

  if { $session == &#34;&#34; || $ipaddress == &#34;&#34; || $mac == &#34;&#34; || $vlanid == &#34;&#34; || $port == &#34;&#34; } {
       error &#34;$func session,ipaddress,vlanid, mac and port must be specified&#34;
       return
  }

  <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Checking IP FDB entry $ipaddress - $mac --&#34;

  if { $result != &#34;&#34; } {
     set result [string tolower $result]
     if { !([string compare &#34;exist&#34; $result] == 0  ||
          [string compare &#34;notexist&#34; $result] == 0) } {
        error &#34;$func $result is invalid argument should be exist or notexist&#34;
        return 0
     }
 }

  <a name="::snmpDebug(15)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session mac-$mac ipaddress-$ipaddress vlanid-$vlanid port-$port - Start&#34; $fd
 
   <span class="comment-line"># Parse the port</span>
   set port [<a name="::snmpUtilParsePortList(1)"><a href="./snmplib.tcl.html#::snmpUtilParsePortList_1988">::snmpUtilParsePortList</a></a> $port]
 
   set mac [<a name="::snmpUtilFormatMacAddr(1)"><a href="./snmplib.tcl.html#::snmpUtilFormatMacAddr_2411">::snmpUtilFormatMacAddr</a></a> $mac] 

   <a name="::snmpDebug(16)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func formated mac address is - $mac&#34; $fd

   set output [snmpGetTable -session $session -oid extremeFdbIpFdbMacAddress]

   <a name="::snmpDebug(17)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func snmpGetTable - $output&#34; $fd

   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;

   foreach line [split $output &#34;\n&#34;] {
      if {[regexp -nocase $mac $line matchedRange] == 1} {
         regexp {.*[.]([0-9]+)} $line res seqnum
         if {[info exists seqnum] == 1} {
            set ipaInfo [snmpGet -session $session -oid \
                  extremeFdbIpFdbIPAddress.$seqnum]
            <a name="::snmpDebug(18)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet-$ipaInfo&#34; $fd
            set ipa [<a name="::snmpUtilGetVal(2)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> ipaddr $ipaInfo]

            set vlanInfo [snmpGet -session $session -oid \
                  extremeFdbIpFdbVlanIfIndex.$seqnum]
            <a name="::snmpDebug(19)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet-$vlanInfo&#34; $fd
            set vlanno [<a name="::snmpUtilGetVal(3)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $vlanInfo]

            set prt [snmpGet -session $session -oid \
                  extremeFdbIpFdbPortIfIndex.$seqnum]
            <a name="::snmpDebug(20)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet-$prt&#34; $fd
            set portnum [<a name="::snmpUtilGetVal(4)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $prt]

            <a name="::snmpDebug(21)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - Check for $portnum:$port $ipa:$ipaddress $vlanno:$vlanid&#34; $fd             
            if {$portnum == $port &amp;&amp; $ipa == $ipaddress &amp;&amp; $vlanno == $vlanid} {
               if {[string compare &#34;exist&#34; [string tolower $result]] == 0} {
                  <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IP FDB Entry is found with port $port vlanid $vlanid seqnum $seqnum result $result. PASS&#34;   
                } else {
                  <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;IP FDB Entry is found with port $port vlanid $vlanid seqnum $seqnum result $result. FAIL&#34;   
                }
                <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
                return
            } 
         }
      }
   }

   if {[string compare &#34;exist&#34; [string tolower $result]] == 0} {
      <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;IP FDB Entry is not found for $ipaddress $mac $vlanid $port result $result. FAIL&#34;
   } else {
      <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IP FDB Entry is not found for $ipaddress $mac $vlanid $port result $result. PASS&#34;
   }
   <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   <a name="::snmpDebug(22)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   return
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpGetIpStats</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures retrieves the IP statistical information for</span>
<span class="comment-line">#    a given parameter</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session   - Session identifier which identifies the connection </span>
<span class="comment-line">#                with the DUT</span>
<span class="comment-line">#    oid       - Object identifier which specifies the IP statistics</span>
<span class="comment-line">#                to be retrieved</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0             - On failure </span>
<span class="comment-line">#    IP statistics - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpGetIpStats -session $session -oid ipInAddrErrors.0</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpGetIpStats_424">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpGetIpStats">::::snmpGetIpStats</a></a></strong> {args} {
   <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpGetIpStats $args {
      session &#34;&#34;
      oid &#34;&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpGetIpStats&#34;

   if { $session == &#34;&#34; || $oid == &#34;&#34;} {
       error &#34;$func session and oid must be specified&#34;
       return 0
   }

   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Getting IP statistics $oid --&#34;
   set result [snmpGet -session $session -oid $oid]
   <a name="::snmpDebug(23)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - snmpGet - $result&#34; $fd

   <span class="comment-line"># ----- Extract the number from the output of snmpGet</span>
   set retVal [<a name="::snmpUtilGetVal(5)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> counter $result]
   <a name="::snmpDebug(24)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - snmpGet - return value is $retVal&#34; $fd

   return $retVal

}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpChangeIpForwarding</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures changes the IP forwarding state of the switch</span>
<span class="comment-line">#    or an individual VLAN</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session   - Session identifier which identifies the connection </span>
<span class="comment-line">#                with the DUT</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    status - Status indicating whether the IP forwarding state to</span>
<span class="comment-line">#             be enabled or disabled. Default is &#34;enable&#34;</span>
<span class="comment-line">#    vlanid - VLAN identifier of the VLAN for which the IP forwarding</span>
<span class="comment-line">#             state to be changed. If the VLAN id is not specified,</span>
<span class="comment-line">#             IP forwarding state of the switch will be changed.</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpChangeIpForwarding -session $session -status &#34;disable&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpChangeIpForwarding_480">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpChangeIpForwarding">::::snmpChangeIpForwarding</a></a></strong> {args} {
   <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpChangeIpForwarding $args {
      session &#34;&#34;
      status &#34;enable&#34;
      vlanid &#34;&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpChangeIpForwarding&#34;

   if { $session == &#34;&#34; } {
       error &#34;$func SNMP session id must be specified&#34;
       return 0
   }

   set status [string tolower $status]

   <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Changing IP forwarding status to $status --&#34;

   if { $status == &#34;enable&#34; } {
      set forwardState 1
   } elseif { $status == &#34;disable&#34; } {
      set forwardState 2
   } else {
      error &#34;$func - status value should be either enable or disable&#34;
      return 0
   }

   <a name="::snmpDebug(25)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session status-$status vlanid-$vlanid - Start&#34; $fd 
   <span class="comment-line"># ----- If vlanid is given, change IP forwarding state of the particular VLAN</span>
   if { $vlanid != &#34;&#34; } {
      set result [snmpSet -session $session -oid extremeVlanIpForwardingState.$vlanid \
                          -type i -val $forwardState]
      <a name="::snmpDebug(26)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - snmpSet - $result&#34; $fd

   } else {
      <span class="comment-line"># ----- Change the IP forwarding state of the switch instead</span>
      set result [snmpSet -session $session -oid ipForwarding.0 \
                         -type i -val $forwardState]
      <a name="::snmpDebug(27)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - snmpSet - $result&#34; $fd
   }
   <a name="::snmpDebug(28)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   return 1
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckIpForwarding</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures checks whether the IP forwarding state of the switch</span>
<span class="comment-line">#    or an individual VLAN is enabled or not</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session   - Session identifier which identifies the connection </span>
<span class="comment-line">#                with the DUT</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    status - If the value is &#34;enabled&#34;, the IP Forwarding state must be </span>
<span class="comment-line">#             true. If &#34;disabled&#34;, IP Forwarding state should false. Default is &#34;enabled&#34; </span>
<span class="comment-line">#    vlanid - VLAN identifier of the VLAN for which the IP forwarding</span>
<span class="comment-line">#             state to be checked. If the VLAN id is not specified,</span>
<span class="comment-line">#             IP forwarding state of the switch will be checked.</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckIpForwarding -session $session -status &#34;enabled&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpCheckIpForwarding_555">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpCheckIpForwarding">::::snmpCheckIpForwarding</a></a></strong> {args} {
   <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckIpForwarding $args {
      session &#34;&#34;
      status &#34;enabled&#34;
      vlanid &#34;&#34;
      fd &#34;NULL&#34;
      comment &#34;snmpCheckIpForwarding&#34;
   }

   set func &#34;snmpCheckIpForwarding&#34;

   if { $session == &#34;&#34; } {
       error &#34;$func SNMP session id must be specified&#34;
       return 0
   }

   set status [string tolower $status]

   <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Checking IP forwarding status for $status --&#34;

   if { $status == &#34;enabled&#34; } {
      set forwardState &#34;true&#34;
   } elseif { $status == &#34;disabled&#34; } {
      set forwardState &#34;false&#34;
   } else {
      error &#34;$func - status value should be either enabled or disabled&#34;
      return 0
   }

   <a name="::snmpDebug(29)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session status-$status vlanid-$vlanid - Start&#34; $fd 
   <span class="comment-line"># ----- If vlanid is given, check IP forwarding state of the particular VLAN</span>
   if { $vlanid != &#34;&#34; } {
      set result [snmpGet -session $session -oid extremeVlanIpForwardingState.$vlanid]
      <a name="::snmpDebug(30)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - snmpGet - $result&#34; $fd

      set ForwardingState [<a name="::snmpUtilGetVal(6)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> boolean $result]
      if {[string compare $forwardState $ForwardingState] != 0} {
         <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;IP Forwarding state for $vlanid expected is true but found \
                       $ForwardingState. FAIL&#34;
         return 0
      } else {
         <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IP Forwarding state for $vlanid expected is true and exists. PASS&#34;
      }

   } else {
      <span class="comment-line"># ----- Check the IP forwarding state of the switch instead</span>
      set result [snmpGet -session $session -oid ipForwarding.0]
      <a name="::snmpDebug(31)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - snmpGet - $result&#34; $fd
      
      if { [string compare $forwardState &#34;true&#34;] == 0 } {
          lappend parameterList {{.*forwarding(1)*} exist}
          <a name="::snmpCheckKeyValue(1)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;Check IP Forwarding is enabled in the switch&#34; -fd $fd
          unset parameterList 
      } elseif { [string compare $forwardState &#34;false&#34;] == 0 } {
          lappend parameterList {{.*notforwarding(2)*} exist}
          <a name="::snmpCheckKeyValue(2)"><a href="./snmplib.tcl.html#::snmpCheckKeyValue_1624">::snmpCheckKeyValue</a></a> $parameterList -output $result \
                    -comment &#34;Check IP Forwarding is not enabled in the switch&#34; -fd $fd
          unset parameterList 
      }

   }
   <a name="::snmpDebug(32)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   return 1
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpChangeVlanLoopbackMode</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpChangeVlanLoopbackMode</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures enables or disables loop back mode of a VLAN</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session   - Session identifier which identifies the connection </span>
<span class="comment-line">#                with the DUT</span>
<span class="comment-line">#    vlanid    - VLAN identifier of the VLAN for which the loopback</span>
<span class="comment-line">#                mode to be changed</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    status - Status indicating whether the loopback mode to</span>
<span class="comment-line">#             be enabled or disabled. Default is &#34;enable&#34;</span>
<span class="comment-line">#    fd - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    set vlanid [snmpCreateVlan]</span>
<span class="comment-line">#    snmpChangeVlanLoopbackMode -session $session -vlanid $vlanid \</span>
<span class="comment-line">#                               -state &#34;disable&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpChangeVlanLoopbackMode_655">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpChangeVlanLoopbackMode">::::snmpChangeVlanLoopbackMode</a></a></strong> { args } {
   <a name="::parse_args(8)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpChangeVlanLoopbackMode $args {
      session &#34;&#34;
      vlanid &#34;&#34;
      status &#34;enable&#34;
      fd &#34;NULL&#34;
   }

   set func &#34;snmpChangeVlanLoopbackMode:&#34;

   if { $session == &#34;&#34; || $vlanid == &#34;&#34; } {
      error &#34;$func session and vlanid should be specified&#34;
      return 0
   }

   set status [string tolower $status]

   <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Changing VLAN loopback mode to $status --&#34;

   if { $status == &#34;enable&#34; } {
      set loopbackState 1
      set loopbackVal &#34;true&#34;
   } elseif { $status == &#34;disable&#34; } {
      set loopbackState 2
      set loopbackVal &#34;false&#34;
   } else {
      error &#34;$func - status value should be either enable or disable&#34;
      return 0
   }

   <a name="::snmpDebug(33)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session vlanid-$vlanid status-$status - Start&#34; $fd

   <span class="comment-line"># ----- Enable or Disable loopback mode in VLAN</span>
   set output [snmpSet -session $session -oid extremeVlanIfLoopbackModeFlag.$vlanid -type i -val $loopbackState]

   <a name="::snmpDebug(34)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;snmpSet- Interface loopback mode $output&#34; $fd

   set get_info [snmpGet -session $session -oid extremeVlanIfLoopbackModeFlag.$vlanid]
   <a name="::snmpDebug(35)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;snmpGet- Interface loopback mode $get_info&#34; $fd

   set loopbackFlag [<a name="::snmpUtilGetVal(7)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> boolean $get_info]

   if {[string compare $loopbackVal $loopbackFlag] != 0} {
      <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;loop back Flag for vlan id $vlanid expected is $loopbackVal but found $loopbackFlag. FAIL&#34;
   <a name="::snmpDebug(36)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
      return 0
   } else {
      <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;loop back Flag for vlan id $vlanid expected is $loopbackVal, found $loopbackFlag. PASS&#34;
      <a name="::snmpDebug(37)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func - End\n&#34; $fd
   }
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckIpAddress</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures checks whether the given IP address exists</span>
<span class="comment-line">#    in the IP address table or not</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session   - Session identifier which identifies the connection </span>
<span class="comment-line">#                with the DUT</span>
<span class="comment-line">#    addr      - IP address </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    status - If the value is &#34;exist&#34;, the IP address must be </span>
<span class="comment-line">#             present. If &#34;notexist&#34;, IP address should not </span>
<span class="comment-line">#             be present in the IP address table. Default is &#34;exist&#34; </span>
<span class="comment-line">#    mask   - IP network mask. If the mask value is given, the netmask</span>
<span class="comment-line">#             value of the entry will also be checked</span>
<span class="comment-line">#    iface  - Interface index associated with the IP address. If the </span>
<span class="comment-line">#             interface index is specified, the interface index assocaited</span>
<span class="comment-line">#             with the IP address entry will also be checked</span>
<span class="comment-line">#    comment - Test case comment to be logged in the text file.</span>
<span class="comment-line">#    fd      - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckIpAddress -session $session -addr &#34;192.207.39.1&#34; \</span>
<span class="comment-line">#                       -mask &#34;255.255.255.0&#34; -iface 2</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpCheckIpAddress_743">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpCheckIpAddress">::::snmpCheckIpAddress</a></a></strong> {args} {
   <a name="::parse_args(9)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckIpAddress $args {
      session &#34;&#34;
      status &#34;exist&#34;
      addr &#34;&#34;
      mask &#34;&#34;
      iface &#34;&#34;
      comment &#34;none&#34; 
      fd &#34;NULL&#34; 
   }

   set func &#34;snmpCheckIpAddress&#34;
   set retVal 0

   if { $addr == &#34;&#34; || $session == &#34;&#34; } { 
       error &#34;$func IP address and SNMP session id must be specified&#34;
       return 0
   }

   <a name="::snmpDebug(38)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session addr-$addr mask-$mask iface-$iface - Start&#34; $fd

   <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Checking IP address $addr/$mask of a VLAN --&#34;

   <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;

   <span class="comment-line"># ----- Get the ipAddrTable entries to verify whether the IP address exists or not</span>
   set maskResult [snmpGet -session $session -oid ipAdEntNetMask.$addr]
   set ifaceResult [snmpGet -session $session -oid ipAdEntIfIndex.$addr]
    
   <a name="::snmpDebug(39)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet-$maskResult&#34; $fd
   <a name="::snmpDebug(40)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func snmpGet-$ifaceResult&#34; $fd
   <span class="comment-line"># ----- If the entry not exist but the check is for exist, return error</span>
   if {[regexp -nocase &#34;.*No Such Instance.*&#34; $maskResult]} {
      if { $status == &#34;exist&#34; } {
         <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;IP address $addr doesn't exist in the ipAddrTable. FAIL&#34;
      } else {
         <a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IP address $addr doesn't exist in the ipAddrTable result $status. PASS&#34;
      }
      <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return 0
   } else {
      if { $status == &#34;notexist&#34; } {
         <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;IP address $addr exist in the ipAddrTable result $status. FAIL&#34;
      }

      <span class="comment-line"># ---- Mask exist, so compare the mask with the given one</span>
      if { $mask == &#34;&#34; &amp;&amp; $iface == &#34;&#34;} {
         <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         return 0
      }
      <a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IP address $addr exist in the ipAddrTable result $status. PASS&#34;
   }
   
   <span class="comment-line"># ---- Match the netmask if it is given </span>
   if { $mask != &#34;&#34; } {
      set maskAddr [<a name="::snmpUtilGetVal(8)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> ipaddr $maskResult]
      if { $mask == $maskAddr } {
         <a name="::result_ok(9)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IP netmask $mask matched with $maskAddr. PASS&#34;
         set retVal 1
      } else {
         <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;IP netmask $mask not matched with $maskAddr. FAIL&#34;
      }
   }

   <span class="comment-line"># ---- Match the interface index if it is given </span>
   if { $iface != &#34;&#34; } {
      set index [<a name="::snmpUtilGetVal(9)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $ifaceResult]
      if { $iface == $index } {
         <a name="::result_ok(10)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Interface index $iface and $index matched. PASS&#34;
         <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         return $retVal 
      } else {
         <a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Interface index $iface and $index not matched. FAIL&#34;
         <span class="comment-line"># ----- If no error till now, then return error</span>
         if { $retVal == 1 } {
             <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
             return 0
         } else {
             <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
             return $retVal
         }
      }
    }

    <a name="::snmpDebug(41)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func returning $retVal - End\n&#34; $fd
    <a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    return $retVal
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckIpRoute</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures checks whether the given IP route exists</span>
<span class="comment-line">#    in the IP routing table or not</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session   - Session identifier which identifies the connection </span>
<span class="comment-line">#                with the DUT</span>
<span class="comment-line">#    addr      - IP address</span>
<span class="comment-line">#    gw        - Gateway address</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    status - If the value is &#34;exist&#34;, the route must be </span>
<span class="comment-line">#             present. If &#34;notexist&#34;, route should not </span>
<span class="comment-line">#             be present in the IP routing table. Default is &#34;exist&#34; </span>
<span class="comment-line">#    proto  - Protocol through which the route is learnt.</span>
<span class="comment-line">#             Possible values are (defined in RFC 1213)</span>
<span class="comment-line">#                * other</span>
<span class="comment-line">#                * local</span>
<span class="comment-line">#                * netmgmt</span>
<span class="comment-line">#                * icmp</span>
<span class="comment-line">#                * egp</span>
<span class="comment-line">#                * ggp</span>
<span class="comment-line">#                * hello</span>
<span class="comment-line">#                * rip</span>
<span class="comment-line">#                * is-is</span>
<span class="comment-line">#                * es-is</span>
<span class="comment-line">#                * ciscoIgrp</span>
<span class="comment-line">#                * bbnSpfIgp</span>
<span class="comment-line">#                * ospf</span>
<span class="comment-line">#                * bgp</span>
<span class="comment-line">#             Default value is &#34;local&#34;</span>
<span class="comment-line">#    comment - Test case comment to be logged in the text file.</span>
<span class="comment-line">#    fd      - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckIpRoute -session $session -addr &#34;192.207.39.1&#34; \</span>
<span class="comment-line">#                     -mask &#34;255.255.255.0&#34; -gw 192.207.39.1\</span>
<span class="comment-line">#                     -status &#34;exist&#34; -proto &#34;rip&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpCheckIpRoute_882">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpCheckIpRoute">::::snmpCheckIpRoute</a></a></strong> {args} {
   <a name="::parse_args(10)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckIpRoute $args {
      session &#34;&#34;
      status &#34;exist&#34;
      addr &#34;&#34;
      gw &#34;&#34;
      proto &#34;local&#34;
      comment &#34;snmpCheckIpRoute&#34; 
      fd &#34;NULL&#34; 
   }

   set func &#34;snmpCheckIpRoute:&#34;
   set retVal 0

   if { $addr == &#34;&#34; || $session == &#34;&#34; || $gw == &#34;&#34;} { 
       error &#34;$func IP address, SNMP session id and gateway address must be specified&#34;
       return 0
   }

   <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Checking IP route entry $addr with gateway $gw --&#34;

   <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;

   <a name="::snmpDebug(42)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session addr-$addr gw-$gw - Start&#34; $fd

   <span class="comment-line"># ----- convert the status string to lower to facilitate the string comparison</span>
   set status [string tolower $status]

   <span class="comment-line"># ----- Get the ipRouteTable entries to verify the IP address exists or not</span>
   set output [snmpGet -session $session -oid ipRouteNextHop.$addr]
   <a name="::snmpDebug(43)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;snmpGet - $output&#34; $fd
   set gwAddr [<a name="::snmpUtilGetVal(10)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> ipaddr $output]
   <a name="::snmpDebug(44)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;snmpGet - gateway address is $gwAddr&#34; $fd
   set protocol [snmpGet -session $session -oid ipRouteProto.$addr]
   <a name="::snmpDebug(45)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;snmpGet - protocol is $protocol&#34; $fd
   set test &#34;.*$proto.*&#34;
   if {[string compare $gwAddr $gw] == 0 \
       &amp;&amp; [regexp -nocase $test $protocol result] == 1} {
      if {[string compare $status &#34;exist&#34; ] == 0} {
         <a name="::result_ok(11)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;The route $addr with gateway $gw protocol $proto exists result $status. PASS&#34;
         set retVal 1
      } else {
         <a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;The route $addr with gateway $gw protocol $proto exists result $status. FAIL&#34;
      }
   } else {
      if {[string compare $status &#34;notexist&#34; ] == 0} {
         <a name="::result_ok(12)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;The route $addr with gateway $gw protocol $proto not exists result $status. PASS&#34;
         set retVal 1
      } else {
         <a name="::result_error(12)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;The route $addr with gateway $gw protocol $proto not exists result $status. FAIL&#34;
      }
   }

   <a name="::snmpDebug(46)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func returning $retVal - End\n&#34; $fd
   <a name="::report_end_test(10)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $retVal
}

<span class="comment-line">#################################################################</span>
<span class="comment-line">#  Procedure Name: snmpCheckIpForwardEntry</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Description:</span>
<span class="comment-line">#    This procedures checks whether the given IP route exists</span>
<span class="comment-line">#    in the IP forwarding table (defined in IP-FOWARDING MIB) </span>
<span class="comment-line">#    or not</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#    session   - Session identifier which identifies the connection </span>
<span class="comment-line">#                with the DUT</span>
<span class="comment-line">#    addr      - Destination IP address</span>
<span class="comment-line">#    gw        - Gateway address</span>
<span class="comment-line">#    mask      - Network Mask address</span>
<span class="comment-line">#    proto     - Protocol through which the route is learnt.</span>
<span class="comment-line">#                Possible values are (defined in RFC 1213)</span>
<span class="comment-line">#                * other</span>
<span class="comment-line">#                * local</span>
<span class="comment-line">#                * netmgmt</span>
<span class="comment-line">#                * icmp</span>
<span class="comment-line">#                * egp</span>
<span class="comment-line">#                * ggp</span>
<span class="comment-line">#                * hello</span>
<span class="comment-line">#                * rip</span>
<span class="comment-line">#                * is-is</span>
<span class="comment-line">#                * es-is</span>
<span class="comment-line">#                * ciscoIgrp</span>
<span class="comment-line">#                * bbnSpfIgp</span>
<span class="comment-line">#                * ospf</span>
<span class="comment-line">#                * bgp</span>
<span class="comment-line">#             Default value is &#34;local&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Optional Args:</span>
<span class="comment-line">#    ifindex - Interface index through which the route is reachable</span>
<span class="comment-line">#    status - If the value is &#34;exist&#34;, the route must be </span>
<span class="comment-line">#             present. If &#34;notexist&#34;, route should not </span>
<span class="comment-line">#             be present in the IP routing table. Default is &#34;exist&#34; </span>
<span class="comment-line">#</span>
<span class="comment-line">#    comment - Test case comment to be logged in the text file.</span>
<span class="comment-line">#    fd      - File descriptor of open log file</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Output Variables: </span>
<span class="comment-line">#     None</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Variables:</span>
<span class="comment-line">#    0 - On failure </span>
<span class="comment-line">#    1 - On success</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Possible Usage:</span>
<span class="comment-line">#    snmpCheckIpForwardEntry -session $session -addr &#34;192.207.39.0&#34; \</span>
<span class="comment-line">#                     -gw 192.207.39.1 -proto &#34;local&#34;\</span>
<span class="comment-line">#                     -ifindex 10 -status &#34;exist&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::snmpCheckIpForwardEntry_994">proc <a href="snmpL3Lib.tcl-annot.html#::::snmpCheckIpForwardEntry">::::snmpCheckIpForwardEntry</a></a></strong> {args} {
   <a name="::parse_args(11)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> snmpCheckIpForwardEntry $args {
      session &#34;&#34;
      status &#34;exist&#34;
      addr &#34;&#34;
      gw &#34;&#34;
      proto &#34;local&#34;
      ifindex &#34;&#34;
      mask &#34;&#34;
      comment &#34;snmpCheckIpForwardEntry&#34; 
      fd &#34;NULL&#34; 
   }

   set func &#34;snmpCheckIpForwardEntry:&#34;
   set retVal 0

   if { $addr == &#34;&#34; || $session == &#34;&#34; || $gw == &#34;&#34; || $proto == &#34;&#34; || $mask == &#34;&#34;} { 
       error &#34;$func IP address, SNMP session id, gateway, network mask address and protocol must be specified&#34;
       return 0
   }

   <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n-- Checking IP Forward entry $addr with gateway $gw proto -$proto --&#34;

   <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$comment&#34;

   <a name="::snmpDebug(47)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func session-$session addr-$addr gw-$gw proto-$proto - Start&#34; $fd

   <span class="comment-line"># ----- convert the status string to lower to facilitate </span>
   <span class="comment-line">#       the string comparison</span>
   set status [string tolower $status]
   set proto  [string tolower $proto]

   <span class="comment-line"># ---- If ifindex is not specified, get the interface index</span>
   if { $ifindex == &#34;&#34; } {
      set ifIndex [<a name="::snmpGetIfIndexForIpAddr(4)"><a href="./snmpL3Lib.tcl.html#::snmpGetIfIndexForIpAddr_29">::snmpGetIfIndexForIpAddr</a></a> $session $gw $fd]
   } else {
      set ifIndex $ifindex
   }

   <a name="::snmpDebug(48)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;$func - Interface index is $ifIndex&#34;

   <span class="comment-line"># ----- Get the ipForwardTable entries to verify the </span>
   <span class="comment-line">#       interface index exists or not</span>
   set output [snmpGet -session $session -oid ipForwardIfIndex.$addr.$proto.0.$gw]
   <a name="::snmpDebug(49)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;snmpGet - $output&#34; $fd
   set iface [<a name="::snmpUtilGetVal(11)"><a href="./snmplib.tcl.html#::snmpUtilGetVal_2283">::snmpUtilGetVal</a></a> int $output]
   <a name="::snmpDebug(50)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> LOG &#34;snmpGet - interface index is $iface, given index is $ifIndex&#34; $fd
   if { $iface == $ifIndex } {
      set result &#34;exist&#34;
   } else {
      set result &#34;notexist&#34;
   }
 
   if {[string compare $status $result ] == 0} {
         <a name="::result_ok(13)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;The route $addr with gateway $gw protocol $proto ifindex $ifIndex $result needed $status. PASS&#34;
         set retVal 1
   } else {
         <a name="::result_error(13)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;The route $addr with gateway $gw protocol $proto ifindex $ifIndex $result needed $status. FAIL&#34;
         set retVal 0
   }

   <a name="::snmpDebug(51)"><a href="./snmplib.tcl.html#::snmpDebug_63">::snmpDebug</a></a> DEBUG &#34;$func returning $retVal - End\n&#34; $fd
   <a name="::report_end_test(11)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $retVal
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
