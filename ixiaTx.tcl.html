<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ixiaTx.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ixiaTx.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ixiaTx.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ixiaTx.tcl-annot.html">annotations</a> | <a href="ixiaTx.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IxiaPortsInit</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that initializez all ixia ports for auto neg, protocol servers, mac address etc.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             IxiaPortsInit</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::IxiaPortsInit_17">proc <a href="ixiaTx.tcl-annot.html#::::IxiaPortsInit">::::IxiaPortsInit</a></a></strong> {} {

global portMappingList MAIN
   <a name="::globalSetDefault(1)"><a href="./ePTUtils.tcl.html#::globalSetDefault_1">::globalSetDefault</a></a>
global phyMode
   global TrafficGen

   set MAIN(skipIxInit) 0; set MAIN(IxiaReady) 1;

    switch -exact -- $TrafficGen {
        
        stc {
            return 1;
        }
        ixia -
        ixvm {
   set TxRxPortList {}
   set ind 0
   foreach port $portMappingList {
     set portId [lindex $port 0]
     <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chid c p	 
     <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Setting portId $portId to factory defaults...&#34;
     <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> setFactoryDefaults $chid $c $p
    <span class="comment-line">#------work around solution from ixia added to automation--- prasanna</span>
    <span class="comment-line">#if [port isValidFeature $chid $c $p portFeatureLocalCPU]  {</span>
    <span class="comment-line">#   if [portCpu reset $chid $c $p] {</span>
    <span class="comment-line">#      ixPuts $::ixErrorInfo</span>
<span class="comment-line">#	} </span>

 <span class="comment-line">#   ixPuts &#34;$chid:$c:$p has been reset&#34;</span>
  <span class="comment-line">#  }</span>
    <span class="comment-line">#####--- end of work around solution############</span>
     if {[info exists phyMode]} {
        if {[llength $phyMode]==1} {
           if {[regexp -nocase &#34;fiber&#34; $phyMode]} {
              <a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> setPhyMode $::portPhyModeFiber $chid $c $p
           }
           if {[regexp -nocase &#34;fibernoauto&#34; $phyMode]} {
               <a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -autonegotiate false
               <a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chid $c $p
           }
        } else {
           set portIdPhyMode [lindex [lindex $phyMode $ind] 1]
           if {[regexp -nocase &#34;fiber&#34; $portIdPhyMode]} {
              <a name="::port(5)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> setPhyMode $::portPhyModeFiber $chid $c $p
              if {[regexp -nocase &#34;fibernoauto&#34; $portIdPhyMode]} {
                  <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Setting $c $p to Fiber mode with auto negotiaton off&#34;
                  <a name="::port(6)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -autonegotiate false
                  <a name="::port(7)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chid $c $p
              } else {
                  <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Setting $c $p to Fiber mode&#34;
              }
           } else {
              <a name="::port(8)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> setPhyMode $::portPhyModeCopper $chid $c $p
              <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Setting $c $p to Copper mode&#34;
           }
        }
     } else {
         <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No phyMode configured&#34;
     }
     <a name="::StopPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $portId  ;<span class="comment-line"># setFactoryDefaults dont stop the xmit.</span>
     if {[<a name="::ixPortClearOwnership(1)"><a href="./mapping.tcl.html#::ixPortClearOwnership_76">::ixPortClearOwnership</a></a> $chid $c $p force]!=0} {
        <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Can not clear ixia port ownership:$chid $c $p&#34;
     }

     set retVal1 [<a name="::port(9)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -MacAddress [<a name="::GetPortIdMac(1)"><a href="./misc.tcl.html#::GetPortIdMac_405">::GetPortIdMac</a></a> $portId]]
     <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port Mac address config retVal is $retVal1.&#34;
     set retVal2 [<a name="::port(10)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chid $c $p]
     <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port Mac address set retVal is $retVal2.&#34;
     set retVal3 [<a name="::port(11)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> write $chid $c $p]
     <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port Mac address write retVal is $retVal3.&#34;
     if {($retVal2 != 0) || ($retVal3 != 0)} {
        set retVal1 [<a name="::port(12)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -MacAddress [<a name="::GetPortIdMac(2)"><a href="./misc.tcl.html#::GetPortIdMac_405">::GetPortIdMac</a></a> $portId]]
        <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port Mac address config retVal is $retVal1.&#34;
        set retVal2 [<a name="::port(13)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chid $c $p]
        <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port Mac address set retVal is $retVal2.&#34;
        set retVal3 [<a name="::port(14)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> write $chid $c $p]
        <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port Mac address write retVal is $retVal3.&#34;
     }
     if {($retVal2 != 0) || ($retVal3 != 0)} {
        <a name="::port(15)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> setFactoryDefaults $chid $c $p
        set retVal1 [<a name="::port(16)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -MacAddress [<a name="::GetPortIdMac(3)"><a href="./misc.tcl.html#::GetPortIdMac_405">::GetPortIdMac</a></a> $portId]]
        <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port Mac address config retVal is $retVal1.&#34;
        set retVal2 [<a name="::port(17)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chid $c $p]
        <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port Mac address set retVal is $retVal2.&#34;
        set retVal3 [<a name="::port(18)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> write $chid $c $p]
        <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port Mac address write retVal is $retVal3.&#34;
     }
     incr ind
   }

<span class="comment-line">#   ixiaGenMap $numIxiaCd $startCardNum &#34;standard&#34; &#34;2Way&#34; $chid</span>

   <span class="comment-line"># Make sure link is up</span>
   if [<a name="::ixInitLinks(1)"><a href="./ixGenProcs.tcl.html#::ixInitLinks_12">::ixInitLinks</a></a> one2oneArray $TxRxPortList] {
<span class="comment-line">#      cleanUp </span>
      return 1
   }
}
    }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaConf_groupPorts</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line"># Ixia control - for a group of ports, normally used to send mac frames in a group of ports</span>
<span class="comment-line">#        Called from SendFrameFromMultiplePorts.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#      numIxiaCd :		Number of Ixia cards involved (1-16)</span>
<span class="comment-line">#	   startCardNum :	Starting Ixia card slot number (1-16)</span>
<span class="comment-line">#      ixMapOption :	Standard or customized Ixia mapping</span>
<span class="comment-line">#                       For customized mapping, new program may need to</span>
<span class="comment-line">#                       be added in ixiaGenMap in ixiaMisc.tcl</span>
<span class="comment-line">#      direction :		uni-direction (1Way) or bi-direction (2Way)</span>
<span class="comment-line">#      numFrames :		Number of frames to send per Ixia port</span>
<span class="comment-line">#      frameSize :		Frame size</span>
<span class="comment-line">#      dataPattern :	Packet data pattern </span>
<span class="comment-line">#      streamType :		advance, contBurst, contPacket, firstLoopCount,</span>
<span class="comment-line">#						gotofirst, stopStream (Note: see Ixia manual)</span>
<span class="comment-line">#      patternOffset :	For &#34;filterPallette&#34; (Note: see Ixia manual)</span>
<span class="comment-line">#      fcsError :		good, alignErr, bad, dribbleErr, none</span>
<span class="comment-line">#						(Note: see Ixia manual)</span>
<span class="comment-line">#      wTag :			With Tag (true, false)</span>
<span class="comment-line">#	   tagNo :			Tag number</span>
<span class="comment-line">#      priority :		Priority for the packet</span>
<span class="comment-line">#      protocol :		mac, ip, ipx</span>
<span class="comment-line">#      saMode :			contDecrement, contIncrement, ctrRandom,</span>
<span class="comment-line">#						decrement, idle, increment (Note: see Ixia manual)</span>
<span class="comment-line">#      daMode :			contDecrement, contIncrement, ctrRandom,</span>
<span class="comment-line">#						decrement, idle, increment (Note: see Ixia manual)</span>
<span class="comment-line">#      percentage :		For TX speed - Percentage of the line rate</span>
<span class="comment-line">#      sendLearn :		To send learning frames? (true, false)</span>
<span class="comment-line">#      numLearnFrames :	Number of the learning frames</span>
<span class="comment-line">#      chid :			Ixia chassis id</span>
<span class="comment-line">#      applyFilter: Flag to indicate if the filter/filterPallette to be applied in ixia reciving ports</span>

<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#  ixiaConf_groupPorts -numIxiaCd $numIxiaCd  -startCardNum $startCardNum \</span>
<span class="comment-line">#                       -sendLearn $sendLearn -applyFilter $applyFilter -protocol $protocol \</span>
<span class="comment-line">#                       -numFrames $numFrames -frameSize $frameSize -frameSizeType $frameSizeType \</span>
<span class="comment-line">#                       -dataPattern $dataPattern -streamType $streamType -fcsError $fcsError \</span>
<span class="comment-line">#                       -saMode $saMode -daMode $daMode \</span>
<span class="comment-line">#                       -percentage $percentage -wTag $wTag -tagNo $tag</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ixiaConf_groupPorts_170">proc <a href="ixiaTx.tcl-annot.html#::::ixiaConf_groupPorts">::::ixiaConf_groupPorts</a></a></strong> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> ixiaConf_groupPorts $args {
      numIxiaCd 1
      startCardNum 1
      txPortId 1
      rxPortId 2
      ixMapOption &#34;standard&#34;
      direction &#34;2Way&#34;
      <a name="::protocol(1)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      numFrames &#34;1&#34;
      frameSize &#34;64&#34;
      frameSizeType &#34;sizeFixed&#34;
      dataPattern &#34;0000&#34;
      streamType &#34;stopStream&#34;
      patternOffset &#34;32&#34;
      fcsError &#34;good&#34;
      priority &#34;0&#34;
      <a name="::protocol(2)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      percentage &#34;100&#34;
      sendLearn &#34;false&#34;
      numLearnFrames &#34;1&#34;
      wTag &#34;false&#34;
	  tagNo &#34;002&#34;
	  tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
	  tagRepeat &#34;1&#34;
      chid &#34;1&#34;
      applyFilter &#34;0&#34;
      dontTx &#34;0&#34;
   }

   global spawn_id
   global one2oneArray
   global macBroadcast
   global preambleSize
   <a name="::globalSetDefault(2)"><a href="./ePTUtils.tcl.html#::globalSetDefault_1">::globalSetDefault</a></a>

   set macBroadcast	{ff ff ff ff ff ff}
   set preambleSize	8

   set date [clock format [clock seconds] -format &#34;%m-%d-%Y %I.%M.%S%p&#34;]
   <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*** date=$date&#34;
   set time1 [clock seconds]

   set lastCardNum [expr $startCardNum + $numIxiaCd - 1]  

   <a name="::ixiaGenMap(1)"><a href="./ePTMisc.tcl.html#::ixiaGenMap_218">::ixiaGenMap</a></a> $txPortId $rxPortId $ixMapOption $direction $chid

   if { $sendLearn == &#34;true&#34; } {
      learn config -numframes $numLearnFrames
      send_learn_frames one2oneArray
   }


   <span class="comment-line"># Config streams for validation traffic</span>
   foreach txMap [lsort -dictionary [array names one2oneArray]] {

      <span class="comment-line"># Here we gather information about the first port </span>
      scan $txMap					&#34;%d,%d,%d&#34; chid c p
      <a name="::port(19)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get						$chid $c $p
      set txSpeed					[<a name="::port(20)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -speed]
      set srcAddr 					[<a name="::port(21)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]

      <span class="comment-line"># Here we gather information about the second port</span>
      set rxMap						$one2oneArray($txMap)
      scan [join $rxMap]			&#34;%d %d %d&#34; rxch rxc rxp
      <a name="::port(22)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get						$rxch $rxc $rxp
      set destAddr					[<a name="::port(23)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]

      <span class="comment-line"># Now we configure the stream</span>
      <a name="::stream(1)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numFrames		$numFrames
      <a name="::stream(2)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -name 			S_${c}_${p}
      <a name="::stream(3)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -framesize		$frameSize
      <span class="comment-line">#random size</span>
      if {$frameSizeType == &#34;sizeRandom&#34;} {
         <a name="::stream(4)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameSizeType		$frameSizeType
         <a name="::stream(5)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameSizeMAX      1500
         <a name="::stream(6)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameSizeMIN      64
      }

      <a name="::decideLoopCount(1)"><a href="./ePTMisc.tcl.html#::decideLoopCount_499">::decideLoopCount</a></a> $numFrames $streamType
    <a name="::stream(7)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -rateMode usePercentRate
      <a name="::stream(8)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -percentPacketRate $percentage

<span class="comment-line">#      set frameRate [decideFrameRate $txSpeed $frameSize $percentage]</span>
     <span class="comment-line"># set ifg [calculateGap $frameRate $frameSize $preambleSize $txSpeed]</span>
      <a name="::stream(9)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -fcs                       $fcsError
     <span class="comment-line"># stream config -ifg                       $ifg</span>
     <span class="comment-line"># stream config -isg                       $ifg</span>
     <span class="comment-line"># stream config -ibg                       $ifg</span>
<span class="comment-line">#      stream config -fir                      true            ;# for timestamp</span>
      <a name="::stream(10)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -patternType nonRepeat  ;<span class="comment-line">#needed for version 3.1</span>
      <a name="::stream(11)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -dataPattern	userpattern -pattern $dataPattern
      <a name="::stream(12)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa				$srcAddr
      <a name="::stream(13)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da				$destAddr

      <a name="::stream(14)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -saRepeatCounter	$saMode
      <a name="::stream(15)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -daRepeatCounter $daMode
      if { $saMode != &#34;idle&#34; } { 
	     <a name="::stream(16)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numSA			$numFrames
      }
      if { $daMode != &#34;idle&#34; } { 
	     <a name="::stream(17)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numDA			$numFrames
      }

      <a name="::protocol(3)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> setDefault
      <a name="::protocol(4)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -name			$protocol
      <a name="::protocol(5)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -enable802dot1qTag	$wTag

      <a name="::vlan(1)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -cfi						$tagCfi
      <a name="::vlan(2)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -mode						$tagMode
      <a name="::vlan(3)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -repeat					$tagRepeat
	  <a name="::vlan(4)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -vlanID					$tagNo
      <a name="::vlan(5)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> set								$chid $c $p

      <a name="::stream(18)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> set 					$chid $c $p 1

      <a name="::filterPallette(1)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -pattern1			$dataPattern
      <a name="::filterPallette(2)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -patternOffset1 	$patternOffset
      <a name="::filterPallette(3)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set						$rxch $rxc $rxp

      <a name="::filter(1)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable		true
      <a name="::filter(2)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable		true
      if {$applyFilter} {
         <a name="::filter(3)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Enable true
         <a name="::filterPallette(4)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -DA1 				$destAddr
         <a name="::filter(4)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1DA		addr1
         <a name="::filterPallette(5)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -SA1             $srcAddr
         <a name="::filter(5)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1SA		addr1
         <a name="::filterPallette(6)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set				$rxch $rxc $rxp
      } else {
         <a name="::filter(6)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Enable false
      }
      
      <a name="::filter(7)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1DA			addr1
      <a name="::filter(8)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterPattern		anyPattern
      <a name="::filter(9)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerPattern		anyPattern
      <a name="::filter(10)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerDA			anyAddr
      <a name="::filter(11)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterDA			anyAddr
      <a name="::filter(12)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> set								$rxch $rxc $rxp
   }
   <a name="::writeConfigToHardware(1)"><a href="./mapping.tcl.html#::writeConfigToHardware_148">::writeConfigToHardware</a></a> one2oneArray
   <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
   zeroStats one2oneArray
   startCapture one2oneArray
   if {!$dontTx} {
      <a name="::startTx(1)"><a href="./mapping.tcl.html#::startTx_94">::startTx</a></a> one2oneArray
      set time2 [clock seconds]
      <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*** Time for Ixia TX setup = [expr $time2-$time1] secs&#34;

      <span class="comment-line"># Make sure TX done</span>
      if { $streamType == &#34;stopStream&#34; } {
         if { ($saMode != &#34;contIncrement&#34;) &amp;&amp; ($saMode != &#34;contDecrement&#34;) &amp;&amp;   \
              ($daMode != &#34;contIncrement&#34;) &amp;&amp; ($daMode != &#34;contDecrement&#34;) } {
            for {set c $startCardNum} {$c&lt;=$lastCardNum} {incr c 1} {
               set ixiaPortPerCard [<a name="::findNumPortPerIxiaCard(1)"><a href="./ePTMisc.tcl.html#::findNumPortPerIxiaCard_388">::findNumPortPerIxiaCard</a></a> $c]
               for {set p 1} {$p&lt;=$ixiaPortPerCard} {incr p 1} {
                  <a name="::ixiaCheckTxDone(1)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $chid $c $p $numFrames $txPortId
               }
            }
         }
      }
      set time3 [clock seconds]
      <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*** Time for Ixia TX done = [expr $time3-$time2] secs\n&#34;
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ixiaConf_2Ports</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line"># Ixia control - TX from a port &amp; RX from another port. </span>
<span class="comment-line"># Uni-direction or bi-direction.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#      numIxiaCd :		Number of Ixia cards involved (1-16)</span>
<span class="comment-line">#                       for statistics &amp; capture purpose</span>
<span class="comment-line">#	   startCardNum :	Starting Ixia card slot number (1-16)</span>
<span class="comment-line">#      direction :		uni-direction (1Way) or bi-direction (2Way)</span>
<span class="comment-line">#      txChas :			TX Ixia chassis id</span>
<span class="comment-line">#      txCard :			TX Ixia card number</span>
<span class="comment-line">#      txPort :			TX Ixia port number</span>
<span class="comment-line">#      rxChas :			RX Ixia chassis id</span>
<span class="comment-line">#      rxCard :			RX Ixia card number</span>
<span class="comment-line">#      rxPort :			RX Ixia port number</span>
<span class="comment-line">#      inSaMac :		Input source MAC address</span>
<span class="comment-line">#      inDaMac :		Input destination MAC address</span>
<span class="comment-line">#      numFrames :		Number of frames to send per Ixia port</span>
<span class="comment-line">#      frameSize :		Frame size</span>
<span class="comment-line">#      dataPattern :	Packet data pattern </span>
<span class="comment-line">#      streamType :		advance, contBurst, contPacket, firstLoopCount,</span>
<span class="comment-line">#						gotofirst, stopStream (Note: see Ixia manual)</span>
<span class="comment-line">#      patternOffset :	For &#34;filterPallette&#34; (Note: see Ixia manual)</span>
<span class="comment-line">#      fcsError :		good, alignErr, bad, dribbleErr, none</span>
<span class="comment-line">#						(Note: see Ixia manual)</span>
<span class="comment-line">#      wTag :			With Tag (true, false)</span>
<span class="comment-line">#	   tagNo :			Tag number</span>
<span class="comment-line">#      priority :		Priority for the packet</span>
<span class="comment-line">#      protocol :		mac, ip, ipx</span>
<span class="comment-line">#      saMode :			contDecrement, contIncrement, ctrRandom,</span>
<span class="comment-line">#						decrement, idle, increment (Note: see Ixia manual)</span>
<span class="comment-line">#      daMode :			contDecrement, contIncrement, ctrRandom,</span>
<span class="comment-line">#						decrement, idle, increment (Note: see Ixia manual)</span>
<span class="comment-line">#      percentage :		For TX speed - Percentage of the line rate</span>
<span class="comment-line">#      sendLearn :		To send learning frames? (true, false)</span>
<span class="comment-line">#      numLearnFrames :	Number of the learning frames</span>
<span class="comment-line">#      chid :			Ixia chassis id</span>
<span class="comment-line">#      userStatFltrSA1		MAC address filter for user stat 1</span>
<span class="comment-line">#      userStatFltrDA1		MAC address filter for user stat 1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#   set frameSent [ixiaConf_2Ports -numIxiaCd $numIxiaCd \</span>
<span class="comment-line">#                  -txChas $txChasisId -txCard $txCard -txPort $txPort -direction &#34;2Way&#34; \</span>
<span class="comment-line">#                  -rxChas $rxChasisId -rxCard $rxCard -rxPort $rxPort -sendLearn $sendLearn \</span>
<span class="comment-line">#                  -protocol $protocol -numFrames $numFrames -frameSize $frameSize \</span>
<span class="comment-line">#                  -frameSizeType $frameSizeType -frameSizeMIN $frameSizeMIN  -frameSizeMAX $frameSizeMAX \</span>
<span class="comment-line">#                  -dataPattern $dataPattern -streamType $streamType -fcsError $fcsError]</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::ixiaConf_2Ports_399">proc <a href="ixiaTx.tcl-annot.html#::::ixiaConf_2Ports">::::ixiaConf_2Ports</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> ixiaConf_2Ports $args {
      numIxiaCd &#34;1&#34;
      startCardNum &#34;1&#34;
      direction &#34;1Way&#34;
      txChas &#34;1&#34;
      txCard &#34;1&#34;
      txPort &#34;1&#34;
      rxChas &#34;1&#34;
      rxCard &#34;1&#34;
      rxPort &#34;2&#34;
      inSaMac &#34;default&#34;
      inDaMac &#34;default&#34;
      numFrames &#34;1&#34;
      frameSizeType &#34;sizeFixed&#34;
      frameSizeMAX &#34;1518&#34;
      frameSizeMIN &#34;64&#34;
      frameSize &#34;64&#34;
      dataPattern &#34;0000&#34;
      ethernetType &#34;noType&#34;
      frameType &#34;08 00&#34;
      streamType &#34;stopStream&#34;
      patternOffset &#34;32&#34;
      fcsError &#34;good&#34;
      priority &#34;0&#34;
      <a name="::protocol(6)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      saCount &#34;&#34;
      daCount &#34;&#34;
      percentage &#34;100&#34;
      sendLearn &#34;false&#34;
      numLearnFrames &#34;1&#34;
      wTag &#34;false&#34;
      tagNo &#34;002&#34;
      tagCfi &#34;resetCFI&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat &#34;1&#34;
      tagPriority &#34;0&#34;	  
      protocolTagId &#34;null&#34;
      chid &#34;1&#34;
      userDefinedStat1SA &#34;00:00:00:00:00:00&#34;
      userDefinedStat1DA &#34;00:00:00:00:00:00&#34;
      rate               &#34;null&#34;      
      udfEnable &#34;false&#34;
      udfInitval &#34;00&#34;
      udfOffset &#34;0&#34;
      udfCountertype &#34;c8&#34;
      udfContinuousCount &#34;false&#34;
      udfRepeat &#34;1&#34;
      protoOffsetEnable &#34;false&#34;
      protoOffset &#34;14&#34;
      userDefTag &#34;&#34;
      dontTx &#34;0&#34;
      ZeroStats &#34;yes&#34;
   }

   global spawn_id
   global one2oneArray
   global macBroadcast
   global preambleSize
   <a name="::globalSetDefault(3)"><a href="./ePTUtils.tcl.html#::globalSetDefault_1">::globalSetDefault</a></a>

   set date [clock format [clock seconds] -format &#34;%m-%d-%Y %I.%M.%S%p&#34;]
<span class="comment-line">#   result_debug &#34;*** date=$date for &lt;ixiaConf_2Ports&gt; on ($txChas $txCard $txPort)&#34;</span>
   set time1 [clock seconds]
 
   set macBroadcast	{ff ff ff ff ff ff}
   set preambleSize	8

   <span class="comment-line"># Create mapping</span>
   <a name="::map(1)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> new -type	one2one
   <a name="::map(2)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> config -type one2one
   <a name="::map(3)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> add $txChas $txCard $txPort $rxChas $rxCard $rxPort  
   if { $direction == &#34;2Way&#34; } {
      <a name="::map(4)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> add $rxChas $rxCard $rxPort $txChas $txCard $txPort
   }
   if { $sendLearn == &#34;true&#34; } {
      learn config -numframes $numLearnFrames
      send_learn_frames one2oneArray
   }


   <span class="comment-line"># Config streams for validation traffic</span>
   set wkTag $wTag
   set wkTagNo $tagNo
   set portNo 0
    
    <span class="comment-line">### TK add</span>
    set portList {}
   foreach txMap [lsort -dictionary [array names one2oneArray]] {
      if { $wkTag == &#34;true&#34; } {
	 set wTag &#34;true&#34;
	 set tagNo [lindex $wkTagNo $portNo]
	 incr portNo
         if { $tagNo == &#34;&#34; } {set tagNo [lindex $wkTagNo 0]}
	 if { $tagNo == 0 || $tagNo == &#34;none&#34; } {set wTag &#34;false&#34;}
	 <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;wTag = $wTag, tagNo = $tagNo&#34;
      }
      scan $txMap					&#34;%d,%d,%d&#34; chid c p
      <a name="::port(24)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get						$chid $c $p
      set txSpeed					[<a name="::port(25)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -speed]
      <a name="::stream(19)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numFrames		$numFrames
      <a name="::stream(20)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -name 			S_${c}_${p}
      <a name="::stream(21)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -framesize		$frameSize
      <span class="comment-line">#random size</span>
      if {$frameSizeType == &#34;sizeRandom&#34;} {
         <a name="::stream(22)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameSizeType		$frameSizeType
         <a name="::stream(23)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameSizeMAX      $frameSizeMAX
         <a name="::stream(24)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameSizeMIN      $frameSizeMIN
      }
      <a name="::decideLoopCount(2)"><a href="./ePTMisc.tcl.html#::decideLoopCount_499">::decideLoopCount</a></a> $numFrames $streamType
<span class="comment-line">#      set frameRate [decideFrameRate $txSpeed $frameSize $percentage]</span>
      if { $rate != &#34;null&#34; } {
         set percentage [<a name="::decidePercentage(1)"><a href="./ePTMisc.tcl.html#::decidePercentage_471">::decidePercentage</a></a> $txSpeed $frameSize $rate]
      }
      <a name="::stream(25)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -rateMode usePercentRate
      <a name="::stream(26)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -percentPacketRate $percentage

<span class="comment-line">#      set ifg [calculateGap $frameRate $frameSize $preambleSize $txSpeed]</span>
      <span class="comment-line"># Now we configure the stream</span>
      <a name="::stream(27)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -fcs                       $fcsError
<span class="comment-line">#      stream config -ifg                       $ifg</span>
<span class="comment-line">#      stream config -isg                       $ifg</span>
<span class="comment-line">#      stream config -ibg                       $ifg</span>
<span class="comment-line">#      stream config -fir                       true            ;# for timestamp</span>
      <a name="::stream(28)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -patternType nonRepeat  ;<span class="comment-line">#needed for version 3.1</span>
      <a name="::stream(29)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -dataPattern	userpattern -pattern $dataPattern
      <a name="::stream(30)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -frameType $frameType
      set srcAddr					[<a name="::port(26)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]
      set rxMap						$one2oneArray($txMap)
      scan [join $rxMap]			&#34;%d %d %d&#34; rxch rxc rxp
      <a name="::port(27)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get						$rxch $rxc $rxp
      set destAddr					[<a name="::port(28)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]

      <a name="::stream(31)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -saRepeatCounter $saMode 
      <a name="::stream(32)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -daRepeatCounter $daMode 
      if {$saMode != &#34;idle&#34;} {
          if {$saCount == &#34;&#34;} {
              <a name="::stream(33)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numSA $numFrames
          } else {
              <a name="::stream(34)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numSA $saCount
          }
      }
      if {$daMode != &#34;idle&#34;} {
          if {$daCount == &#34;&#34;} {
              <a name="::stream(35)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numDA $numFrames
          } else {
              <a name="::stream(36)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -numDA $daCount
          }
      }

<span class="comment-line"># Sending traffic, whether it's 1-way or 2-way, first port is always the src port</span>
<span class="comment-line"># and the second port is always the dest port in an entry in the one2one array</span>
if { 1 } {
      if {$direction == &#34;2Way&#34;} {
          if {($chid == $rxChas) &amp;&amp; ($c == $rxCard) &amp;&amp; ($p == $rxPort)} {
              if { $inSaMac == &#34;default&#34; } {
                  <a name="::stream(37)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $srcAddr
              } else { 
                  <a name="::stream(38)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $inDaMac 
              }				    
              if { $inDaMac == &#34;default&#34; } { 
                  <a name="::stream(39)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $destAddr
              } else {                 
                  <a name="::stream(40)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $inSaMac 
              }

		    <span class="comment-line">### TK add</span>
		    lappend portList [list $txChas $txCard $txPort]
          } else {
              if { $inSaMac == &#34;default&#34; } {
                  <a name="::stream(41)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $srcAddr
              } else { 
                  <a name="::stream(42)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $inSaMac 
              }				    
              if { $inDaMac == &#34;default&#34; } { 
                  <a name="::stream(43)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $destAddr
              } else {                 
                  <a name="::stream(44)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $inDaMac 
              }
		    <span class="comment-line">### TK add</span>
		    lappend portList [list $txChas $txCard $txPort]
		    lappend portList [list $rxChas $rxCard $rxPort]
          }
      } else {
          if { $inSaMac == &#34;default&#34; } {
              <a name="::stream(45)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $srcAddr
          } else { 
              <a name="::stream(46)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $inSaMac 
          }				    
          if { $inDaMac == &#34;default&#34; } { 
              <a name="::stream(47)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $destAddr
          } else {                 
              <a name="::stream(48)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $inDaMac 
          }
		<span class="comment-line">### TK add</span>
		lappend portList [list $txChas $txCard $txPort]
      }
} else {

	    <span class="comment-line">### TK</span>
	    ixPuts &#34;It should not come to this branch&#34;
      if { $inSaMac == &#34;default&#34; } {
              <a name="::stream(49)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $srcAddr
          } else { 
              <a name="::stream(50)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -sa $inSaMac 
          }				    
          if { $inDaMac == &#34;default&#34; } { 
              <a name="::stream(51)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $destAddr
          } else {                 
              <a name="::stream(52)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> config -da $inDaMac 
      }
}
      
      <a name="::protocol(7)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> setDefault
	  <a name="::protocol(8)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -name					$protocol
          if {[regexp -nocase &#34;ip&#34; $protocol]} {
            <a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> setDefault
	    <a name="::ip(2)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> config -ipProtocol 255
	    <a name="::ip(3)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> set $chid $c $p
          }
	  <a name="::protocol(9)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -ethernetType $ethernetType
	  <a name="::protocol(10)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -enable802dot1qTag	$wTag
	  <span class="comment-line">#ipx</span>
<span class="comment-line">#	  if { $protocol == &#34;ipx&#34; } {</span>
<span class="comment-line">#	   puts &#34;NetbiosOOOOOOOOOO&#34;</span>
<span class="comment-line">#	   ipx config -packetType &#34;typeNetBios&#34;</span>
<span class="comment-line">#	   ipx config -destSocket &#34;socketNetBios&#34;</span>
<span class="comment-line">#	   puts [ipx cget -packetType] }</span>

      <a name="::vlan(6)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -cfi						$tagCfi
      <a name="::vlan(7)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -mode						$tagMode
      <a name="::vlan(8)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -repeat					$tagRepeat
      <a name="::vlan(9)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -vlanID					$tagNo
      <a name="::vlan(10)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -userPriority					$tagPriority
      if {$protocolTagId != &#34;null&#34;} {
          set decProtoTagId [expr $protocolTagId]
          <a name="::vlan(11)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> config -protocolTagId                            $decProtoTagId
      }
      <a name="::vlan(12)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> set	 						$chid $c $p
      <span class="comment-line"># Define UDF package </span>
      if {$udfEnable == &#34;true&#34;} {
          set inter 0
          foreach udfOffs $udfOffset {
          <a name="::udf(1)"><a href="./ePTClient.tcl.html#::udf_2121">::udf</a></a> config -enable &#34;true&#34;
          <a name="::udf(2)"><a href="./ePTClient.tcl.html#::udf_2121">::udf</a></a> config -continuousCount [lindex $udfContinuousCount $inter]
          <a name="::udf(3)"><a href="./ePTClient.tcl.html#::udf_2121">::udf</a></a> config -initval [lindex $udfInitval $inter]
          <a name="::udf(4)"><a href="./ePTClient.tcl.html#::udf_2121">::udf</a></a> config -offset [lindex $udfOffset $inter]
          <a name="::udf(5)"><a href="./ePTClient.tcl.html#::udf_2121">::udf</a></a> config -countertype [lindex $udfCountertype $inter]
          <a name="::udf(6)"><a href="./ePTClient.tcl.html#::udf_2121">::udf</a></a> config -repeat [lindex $udfRepeat $inter]
          incr inter
          <a name="::udf(7)"><a href="./ePTClient.tcl.html#::udf_2121">::udf</a></a> set $inter
          }
      }
     
      <span class="comment-line"># define protocolOffset</span>
      if {$protoOffsetEnable == &#34;true&#34;} {
         <a name="::protocolOffset(1)"><a href="./ePTClient.tcl.html#::protocolOffset_816">::protocolOffset</a></a> setDefault
         <a name="::protocolOffset(2)"><a href="./ePTClient.tcl.html#::protocolOffset_816">::protocolOffset</a></a> config -enable true
         <a name="::protocolOffset(3)"><a href="./ePTClient.tcl.html#::protocolOffset_816">::protocolOffset</a></a> config -offset $protoOffset
         <a name="::protocolOffset(4)"><a href="./ePTClient.tcl.html#::protocolOffset_816">::protocolOffset</a></a> config -userDefinedTag $userDefTag
         if [<a name="::protocolOffset(5)"><a href="./ePTClient.tcl.html#::protocolOffset_816">::protocolOffset</a></a> set $txChas $txCard $txPort] {
            <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in protocolOffset set for \
                          $txChas $txCard $txPort&#34;
         }
      } else {
         <a name="::protocolOffset(6)"><a href="./ePTClient.tcl.html#::protocolOffset_816">::protocolOffset</a></a> setDefault
         <a name="::protocolOffset(7)"><a href="./ePTClient.tcl.html#::protocolOffset_816">::protocolOffset</a></a> config -enable false
         <a name="::protocolOffset(8)"><a href="./ePTClient.tcl.html#::protocolOffset_816">::protocolOffset</a></a> set $txChas $txCard $txPort
      }

      <a name="::stream(53)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> set $chid $c $p 1

	<span class="comment-line"># Define filter &amp; capture</span>

	<span class="comment-line">### TK add</span>
	if  {$direction == &#34;2Way&#34;} {
      <a name="::filterPallette(7)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -DA1 			$destAddr
      <a name="::filterPallette(8)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -pattern1			$dataPattern
      <a name="::filterPallette(9)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -patternOffset1 		$patternOffset
      <a name="::filterPallette(10)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set				$rxch $rxc $rxp

      <a name="::filter(13)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable		true
      <a name="::filter(14)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable		true
  
      <span class="comment-line">#user defined stats settings</span>
      if { ( $userDefinedStat1DA != &#34;00:00:00:00:00:00&#34; ) || \
           ( $userDefinedStat1SA != &#34;00:00:00:00:00:00&#34; ) }  {
        <a name="::filter(15)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Enable		true
        if { $userDefinedStat1DA != &#34;00:00:00:00:00:00&#34; } {
          <a name="::filterPallette(11)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -DA1 			$userDefinedStat1DA
          <a name="::filter(16)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1DA		addr1
        }
        if { $userDefinedStat1SA != &#34;00:00:00:00:00:00&#34; } {
          <a name="::filterPallette(12)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -SA1 			$userDefinedStat1SA
          <a name="::filter(17)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1SA		addr1
        }
        <a name="::filterPallette(13)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set				$rxch $rxc $rxp
      } else {
        <a name="::filter(18)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1Enable		false
        <a name="::filter(19)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -userDefinedStat1DA		addr1
      }      
      <a name="::filter(20)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterPattern		anyPattern
      <a name="::filter(21)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerPattern		anyPattern
      <a name="::filter(22)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerDA			anyAddr
      <a name="::filter(23)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterDA			anyAddr
      <a name="::filter(24)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> set 					$rxch $rxc $rxp 
	}; <span class="comment-line">### TK add</span>
}

    <span class="comment-line">#### TK modify</span>
    if {[<a name="::ixWriteConfigToHardware(1)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList -noProtocolServer]} {
	ixPuts &#34;failed to do ixWritePortsToHardware.\n$::ixErrorInfo&#34;
    }
    <span class="comment-line">#### Wait for the link to come up</span>
<span class="comment-line">#    if {[ixCheckLinkState portList]} {</span>
<span class="comment-line">#	ixPuts &#34;failed to do ixCheckLinkState.\n$::ixErrorInfo&#34;</span>
<span class="comment-line">#    }</span>
    
   if {$ZeroStats != &#34;no&#34; } {
	      <a name="::zeroPortStats(1)"><a href="./mapping.tcl.html#::zeroPortStats_130">::zeroPortStats</a></a> $txChas $txCard $txPort
      }
   <span class="comment-line">#for {set c $startCardNum} {$c&lt;=[expr $startCardNum + $numIxiaCd - 1]} {incr c 1} { </span>
   <span class="comment-line">#    ixiaConf_clearStat $c</span>
   <span class="comment-line">#    }</span>

   <span class="comment-line">#just in case some previous function stop capture on these ports</span>
    <span class="comment-line">### TK </span>
    <span class="comment-line">#   set pList &#34;&#34;</span>
    <span class="comment-line">#   lappend pList &#34;$txChas $txCard $txPort&#34;</span>
    <span class="comment-line">#   lappend pList &#34;$rxch $rxc $rxp&#34;</span>
    <a name="::ixStartCapture(1)"><a href="./mapping.tcl.html#::ixStartCapture_106">::ixStartCapture</a></a> portList

   if {!$dontTx} {
      <a name="::startTx(2)"><a href="./mapping.tcl.html#::startTx_94">::startTx</a></a> one2oneArray
      set time2 [clock seconds]
<span class="comment-line">#      result_debug &#34;*** Time for Ixia TX setup = [expr $time2-$time1] secs&#34;</span>
      <span class="comment-line">#get the stream so we can return it later</span>
      <a name="::stream(54)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> get $txChas $txCard $txPort 1
      set streamSent [<a name="::stream(55)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> cget -packetView]

      <span class="comment-line"># Make sure TX done</span>
      if { $streamType == &#34;stopStream&#34; } {
         if { ($saMode != &#34;contIncrement&#34;) &amp;&amp; ($saMode != &#34;contDecrement&#34;) &amp;&amp;   \
              ($daMode != &#34;contIncrement&#34;) &amp;&amp; ($daMode != &#34;contDecrement&#34;) } {
            <a name="::ixiaCheckTxDone(2)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $txChas $txCard $txPort $numFrames $txPort
            if { $direction == &#34;2Way&#34; } {
               <a name="::ixiaCheckTxDone(3)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $rxChas $rxCard $rxPort $numFrames $txPort
            }
         }
      }
<span class="comment-line">#   after 500</span>
   set time3 [clock seconds]
<span class="comment-line">#   result_debug &#34;*** Time for Ixia TX done = [expr $time3-$time2] secs\n&#34;</span>
   <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*** Ixia port config time [expr $time2-$time1] secs and TX time [expr $time3-$time2] secs\n&#34;

   if {$inDaMac == &#34;default&#34;} {
      set inDaMac $destAddr
   }
   if {$inSaMac == &#34;default&#34;} {
      set inSaMac $srcAddr
   }

   set txPortId [<a name="::MapIxiaCardnPort(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaCardnPort_331">::MapIxiaCardnPort</a></a> $txChas $txCard $txPort]
   set rxPortId [<a name="::MapIxiaCardnPort(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaCardnPort_331">::MapIxiaCardnPort</a></a> $rxChas $rxCard $rxPort]
   <a name="::displayMacPacketFormat(1)"><a href="./frameFormat.tcl.html#::displayMacPacketFormat_223">::displayMacPacketFormat</a></a> -txPortId $txPortId -rxPortId $rxPortId \
                    -frameSent $streamSent -streamType $streamType \
                    -destMac $inDaMac -srcMac $inSaMac -numFrames $numFrames \
                    -protocol $protocol -wTag $wTag -tag $tagNo \
                    -userPriority $priority -direction $direction -daMode \
                     $daMode -daCount $daCount -saMode $saMode -saCount $saCount \
                     -percentage $percentage

   return $streamSent
   } else {
      return &#34;&#34;
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: EnableFlowControl</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Set Flow control ability to the following modes -</span>
<span class="comment-line">#                   none,symmetric,asymmetric and both (both symmetric or asymmetric)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portIdList - Port list</span>
<span class="comment-line">#              mode </span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             [EnableAsymmetricFlowControl $portIdList &#34;symmetric&#34;]</span>
<span class="comment-line">#             [EnableAsymmetricFlowControl $portIdList &#34;asymmetric&#34; 0]  ;# 0 - Do not wait for link up</span>
<span class="comment-line">#           </span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::EnableFlowControl_799">proc <a href="ixiaTx.tcl-annot.html#::::EnableFlowControl">::::EnableFlowControl</a></a></strong> {portIdList mode {maxWait 15}} {

    puts &#34; Setting ports - $portIdList to flow control mode : $mode&#34;
    foreach portId $portIdList {   
        <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port

        <span class="comment-line"># ----- Get the port before re-writing to avoid messing up the old port info.</span>
        <a name="::port(29)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chasis $card $port

	if {$mode == &#34;asymmetric&#34;} {        
        <a name="::port(30)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -flowControl false
        <a name="::port(31)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -negotiateMasterSlave 0
        <a name="::port(32)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertiseAbilities portAdvertiseSend
        }
        if {$mode == &#34;symmetric&#34;} {
        <a name="::port(33)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -flowControl false
	<a name="::port(34)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -negotiateMasterSlave 1
        <a name="::port(35)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertiseAbilities portAdvertiseSendAndReceive
        }         

	if {$mode == &#34;none&#34;} {
        <a name="::port(36)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -flowControl false
        <a name="::port(37)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -negotiateMasterSlave 0
        <a name="::port(38)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertiseAbilities portAdvertiseNone
        }
        if {$mode == &#34;both&#34;} {
        <a name="::port(39)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -flowControl true
        <a name="::port(40)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -negotiateMasterSlave 1
        <a name="::port(41)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertiseAbilities portAdvertiseSendAndOrReceive
        }
        
        <a name="::port(42)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> config -advertise1000FullDuplex true
        <a name="::port(43)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> set $chasis $card $port
        <a name="::port(44)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> write $chasis $card $port
            
        if {$maxWait == 0} {
            continue
        }
         set maxWaitCounter $maxWait
       
         while { $maxWaitCounter } {
            <a name="::port(45)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chasis $card $port
            if {[<a name="::port(46)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -linkState] == 1} {
                <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FOUND LINK UP for portId:$portId!&#34;
                break
            } else {
                <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Waiting for portId:$portId linkUp..&#34;
                sleep 1
                incr maxWaitCounter -1 
            }
        }

        if {$maxWaitCounter == 0} {   
            <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;WARNING: No linkUp for Ixia portId:$portId&#34;
        }
   }
}
   

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: IxiaPortsClear</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: proc that clears ixia port ownership.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             IxiaPortsClear</span>
<span class="comment-line">#       </span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::IxiaPortsClear_873">proc <a href="ixiaTx.tcl-annot.html#::::IxiaPortsClear">::::IxiaPortsClear</a></a></strong> {} {
      
   global portMappingList
   <a name="::globalSetDefault(4)"><a href="./ePTUtils.tcl.html#::globalSetDefault_1">::globalSetDefault</a></a>
   set TxRxPortList {}
 
   foreach port $portMappingList {
      set portId [lindex $port 0]
      <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chid c p

      if {[<a name="::ixPortClearOwnership(2)"><a href="./mapping.tcl.html#::ixPortClearOwnership_76">::ixPortClearOwnership</a></a> $chid $c $p force]!=0} {
        <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Can not clear ixia port ownership:$chid $c $p&#34;
      }
   }

}

<span class="comment-line">######################################################################</span>

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
