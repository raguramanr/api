<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ePTQinQTx.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ePTQinQTx.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ePTQinQTx.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ePTQinQTx.tcl-annot.html">annotations</a> | <a href="ePTQinQTx.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendDoubleTagFrame</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Used to send Q-in-Q mac packets</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Retruns the packet sent</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#               set frameSent [SendDoubleTagFrame -txPortId 1 -destMac $destmac\</span>
<span class="comment-line">#                   -ctag 10 -ctagPriority 2 -stag 12 -stagPriority 3];</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendDoubleTagFrame_18">proc <a href="ePTQinQTx.tcl-annot.html#::::SendDoubleTagFrame">::::SendDoubleTagFrame</a></a></strong> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendDoubleTagFrame $args {
      txPortId &#34;1&#34;
      rxPortId &#34;0&#34;
      <a name="::protocol(1)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      sourceMac &#34;default&#34;
      destMac &#34;default&#34;
      numFrames &#34;1&#34;
      frameSize &#34;64&#34;
      frameSizeType &#34;sizeFixed&#34;
      dataPattern &#34;1234&#34;
      ethernetType &#34;noType&#34;
      frameType &#34;08 00&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      saCount &#34;&#34;
      daCount &#34;&#34;
      percentage &#34;100&#34;
      ctag &#34;none&#34;
      ctagPriority &#34;0&#34;	      
      stagEncap &#34;88A8&#34;
      stag &#34;none&#34;
      stagPriority &#34;0&#34;     
      frameRate &#34;null&#34;
      tagMode &#34;vIdle&#34;
      tagRepeat 1
      udfEnable &#34;false&#34;
      udfInitval &#34;00&#34;
      udfOffset &#34;0&#34;
      udfCountertype &#34;c8&#34;
      udfContinuousCount &#34;false&#34;
      dontTx &#34;0&#34;
   }

   if {($stag == &#34;none&#34;) &amp;&amp; ($ctag == &#34;none&#34;)} {
       <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ctag and stag parameter is required&#34;
<span class="comment-line">#       return -1</span>
   } elseif {($stag == &#34;none&#34;)} {
       <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stag parameter is required&#34;
<span class="comment-line">#       return -1</span>
   }
   
   if {$ctag == &#34;none&#34;} {
      set ctagHex &#34;&#34;
   } else {
      set cEncap &#34;8100&#34;
      set cEncapCan &#34;0&#34;
      set ctagBin [<a name="::int2bits(1)"><a href="./ePTQinQTx.tcl.html#::int2bits_304">::int2bits</a></a> $ctag 12]
      set ctagPrioBin [<a name="::int2bits(2)"><a href="./ePTQinQTx.tcl.html#::int2bits_304">::int2bits</a></a> $ctagPriority 3]
      set ctagBinStr &#34;$ctagPrioBin$cEncapCan$ctagBin&#34;

      set ctagHexStr &#34;&#34;

<span class="comment-line"># --- Get the Hex value of each bytes in 0xAA form</span>
      for {set i 0} {$i &lt; 2} {incr i} {
         set stOffset [expr $i*8]
         set endOffset [expr ($i+1)*8 -1]
         set ctagBinVal [string range $ctagBinStr $stOffset $endOffset]
         set ctagHexVal [<a name="::bits2hex(1)"><a href="./ePTQinQTx.tcl.html#::bits2hex_352">::bits2hex</a></a> $ctagBinVal 2]
         set ctagHexStr $ctagHexStr$ctagHexVal
      }
      set ctagHex &#34;$cEncap$ctagHexStr&#34;
   }

   set sEncapCan &#34;0&#34;
   set stagBin [<a name="::int2bits(3)"><a href="./ePTQinQTx.tcl.html#::int2bits_304">::int2bits</a></a> $stag 12]
   set stagPrioBin [<a name="::int2bits(4)"><a href="./ePTQinQTx.tcl.html#::int2bits_304">::int2bits</a></a> $stagPriority 3]
   set stagBinStr &#34;$stagPrioBin$sEncapCan$stagBin&#34;

   set stagHexStr &#34;&#34;
   for {set i 0} {$i &lt; 2} {incr i} {
      set stOffset [expr $i*8]
      set endOffset [expr ($i+1)*8 -1]
      set stagBinVal [string range $stagBinStr $stOffset $endOffset]
      set stagHexVal [<a name="::bits2hex(2)"><a href="./ePTQinQTx.tcl.html#::bits2hex_352">::bits2hex</a></a> $stagBinVal 2]
      set stagHexStr $stagHexStr$stagHexVal
   }
   set stagHex &#34;$stagEncap$stagHexStr&#34;
   if {$stag == &#34;none&#34;} {
       set userDefTag &#34;$ctagHex&#34;
      } elseif {$stag == &#34;none&#34; &amp;&amp; $ctag == &#34;none&#34;} {
      set userDefTag &#34;&#34;
      } elseif {$ctag == &#34;none&#34;} {
       set userDefTag &#34;$stagHex&#34;
      } else { 
       set userDefTag &#34;$stagHex$ctagHex&#34;
      }


   <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;userDefTag $userDefTag binStr is $stagBinStr ctaghex $ctagHex&#34;
   
   set framesent [<a name="::SendFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $txPortId -rxPortId $rxPortId \
          -protocol $protocol -sourceMac $sourceMac -destMac $destMac \
          -numFrames $numFrames -frameSize $frameSize \
          -frameSizeType $frameSizeType -dataPattern $dataPattern \
          -ethernetType $ethernetType -frameType $frameType \
          -streamType $streamType -fcsError $fcsError -saMode $saMode \
          -daMode $daMode -saCount $saCount -daCount $daCount \
          -percentage $percentage -tag &#34;none&#34; -tagPriority &#34;0&#34; \
          -frameRate $frameRate -tagMode $tagMode -tagRepeat $tagRepeat \
          -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset \
          -udfCountertype $udfCountertype \
          -udfContinuousCount $udfContinuousCount -dontTx $dontTx \
          -protoOffsetEnable &#34;true&#34; -protoOffset &#34;22&#34; -userDefTag $userDefTag]

    return $framesent
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendDoubleTagIpFrame</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Used to send Q-in-Q ip packets</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Retruns the packet sent</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#               set frameSent [SendDoubleTagIpFrame -txPortId 1 -destMac \</span>
<span class="comment-line">#                           $destmac -sourceIp $srcIp -destIp $destaddr \</span>
<span class="comment-line">#                 -ttl $ttl -ctag 10 -ctagPriority 2 -stag 12 -stagPriority 3];</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendDoubleTagIpFrame_145">proc <a href="ePTQinQTx.tcl-annot.html#::::SendDoubleTagIpFrame">::::SendDoubleTagIpFrame</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendDoubleTagIpFrame $args {
     <a name="::protocol(2)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ip&#34;
     txPortId &#34;1&#34;
     rxPortId &#34;0&#34;
     sourceMac &#34;default&#34;
     destMac &#34;00 e0 2b 00 00 01&#34;
     sourceIp &#34;127.0.0.1&#34;
     destIp &#34;127.0.0.1&#34;
     gatewayIp &#34;127.0.0.1&#34;
     dIpMask &#34;255.255.255.0&#34;
     sIpMask &#34;255.255.255.0&#34;
     dClass &#34;classC&#34;
     sourcePort &#34;0&#34;
     destPort &#34;0&#34;
     ttl &#34;64&#34;
     goodChecksum &#34;true&#34;
     numFrames &#34;1&#34;
     frameSize &#34;64&#34;
     frameSizeType &#34;sizeFixed&#34;
     ipOptions &#34;&#34;
     frameRate &#34;default&#34;
     frameType &#34;08 00&#34;
     dataPattern &#34;0000&#34;
     streamType &#34;stopStream&#34;
     fcsError &#34;good&#34;
     ctag &#34;none&#34;
     ctagPriority &#34;0&#34;	      
     stagEncap &#34;none&#34;
     stag &#34;none&#34;
     stagPriority &#34;0&#34;     
     TOS &#34;default&#34;
     userPriority &#34;0&#34;
     percentage &#34;100&#34;
     priority &#34;0&#34;
     saMode &#34;idle&#34;
     daMode &#34;idle&#34;
     saCount &#34;&#34;
     daCount &#34;&#34;
     ipSaMode &#34;ipIdle&#34;
     ipDaMode &#34;ipIdle&#34;
     ipSaCount &#34;&#34;
     ipDaCount &#34;&#34;
     dontFrag &#34;true&#34;
     tcpSynFlag &#34;false&#34;
     tcpFinFlag &#34;false&#34;
     tcpRstFlag &#34;false&#34;
     tcpAckFlag &#34;false&#34;
     tcpPushFlag &#34;false&#34;
     tcpUrgFlag &#34;false&#34;
     tcpSeqNum &#34;0&#34;
     type &#34;8&#34;
     code &#34;0&#34;
     id &#34;0&#34;
     sequence &#34;0&#34;
     direction &#34;1Way&#34;
     maxResponseTime &#34;100&#34;
     groupAddr &#34;224.0.0.1&#34;
     applyFilter &#34;0&#34;
     udfEnable &#34;false&#34;
     udfInitval &#34;00&#34;
     udfOffset &#34;0&#34;
     udfCountertype &#34;c8&#34;
     udfContinuousCount &#34;false&#34;
     clearStats &#34;yes&#34;
     dontTx &#34;0&#34;
}

   if {($ctag == &#34;none&#34;) &amp;&amp; ($stag == &#34;none&#34;)} {
       <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ctag and stag parameter is required&#34;
       return -1
   } elseif {($stag == &#34;none&#34;)} {
       <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stag parameter is required&#34;
   }
   
   if {$ctag == &#34;none&#34;} {
      set ctagHex &#34;&#34;
   } else {
      set cEncap &#34;8100&#34;
      set cEncapCan &#34;0&#34;
      set ctagBin [<a name="::int2bits(5)"><a href="./ePTQinQTx.tcl.html#::int2bits_304">::int2bits</a></a> $ctag 12]
      set ctagPrioBin [<a name="::int2bits(6)"><a href="./ePTQinQTx.tcl.html#::int2bits_304">::int2bits</a></a> $ctagPriority 3]
      set ctagBinStr &#34;$ctagPrioBin$cEncapCan$ctagBin&#34;
<span class="comment-line"># --- Get the Hex value of each bytes in 0xAA form</span>
      set ctagHexStr &#34;&#34;

      for {set i 0} {$i &lt; 2} {incr i} {
         set stOffset [expr $i*8]
         set endOffset [expr ($i+1)*8 -1]
         set ctagBinVal [string range $ctagBinStr $stOffset $endOffset]
         set ctagHexVal [<a name="::bits2hex(3)"><a href="./ePTQinQTx.tcl.html#::bits2hex_352">::bits2hex</a></a> $ctagBinVal 2]
         set ctagHexStr $ctagHexStr$ctagHexVal
      }
      set ctagHex &#34;$cEncap$ctagHexStr&#34;
   }

   set sEncapCan &#34;0&#34;
   set stagBin [<a name="::int2bits(7)"><a href="./ePTQinQTx.tcl.html#::int2bits_304">::int2bits</a></a> $stag 12]
   set stagPrioBin [<a name="::int2bits(8)"><a href="./ePTQinQTx.tcl.html#::int2bits_304">::int2bits</a></a> $stagPriority 3]
   set stagBinStr &#34;$stagPrioBin$sEncapCan$stagBin&#34;

   set stagHexStr &#34;&#34;
   for {set i 0} {$i &lt; 2} {incr i} {
      set stOffset [expr $i*8]
      set endOffset [expr ($i+1)*8 -1]
      set stagBinVal [string range $stagBinStr $stOffset $endOffset]
      set stagHexVal [<a name="::bits2hex(4)"><a href="./ePTQinQTx.tcl.html#::bits2hex_352">::bits2hex</a></a> $stagBinVal 2]
      set stagHexStr $stagHexStr$stagHexVal
   }

   set stagHex &#34;$stagEncap$stagHexStr&#34;

   set userDefTag &#34;$stagHex$ctagHex&#34;
   
   set framesent [<a name="::SendIpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPortId -rxPortId $rxPortId \
       -protocol $protocol \
       -sourceMac $sourceMac -destMac $destMac -numFrames $numFrames \
       -frameSize $frameSize -frameSizeType $frameSizeType \
       -dataPattern $dataPattern -tag &#34;none&#34; -frameRate $frameRate \
       -frameType $frameType -sourceIp $sourceIp -destIp $destIp \
       -gatewayIp $gatewayIp -dIpMask $dIpMask \
       -sIpMask $sIpMask -dClass $dClass -sourcePort $sourcePort \
       -destPort $destPort -ttl $ttl -goodChecksum $goodChecksum \
       -ipOptions $ipOptions -streamType $streamType -fcsError $fcsError \
       -TOS $TOS -percentage $percentage -priority $priority -saMode $saMode \
       -daMode $daMode -saCount $saCount -daCount $daCount -ipSaMode $ipSaMode \
       -ipDaMode $ipDaMode -ipSaCount $ipSaCount -dontFrag $dontFrag \
       -tcpSynFlag $tcpSynFlag -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
       -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
       -tcpUrgFlag $tcpUrgFlag -tcpSeqNum $tcpSeqNum -type $type -code $code \
       -id $id -sequence $sequence -direction $direction \
       -maxResponseTime $maxResponseTime -groupAddr $groupAddr \
       -applyFilter $applyFilter -udfEnable $udfEnable -udfInitval $udfInitval \
       -udfOffset $udfOffset -udfCountertype $udfCountertype \
       -udfContinuousCount $udfContinuousCount -clearStats $clearStats \
       -udfContinuousCount $udfContinuousCount -protoOffsetEnable &#34;true&#34; \
       -protoOffset &#34;22&#34; -userDefTag $userDefTag -dontTx $dontTx]

    return $framesent
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: int2bits</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: converts integer to binary and returns with </span>
<span class="comment-line">#              specifed number of bits</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: intVal - The interger Value</span>
<span class="comment-line">#             desiredLen - The number of bits desired after </span>
<span class="comment-line">#                          binary conversion</span>
<span class="comment-line"># Output args: None </span>
<span class="comment-line"># Return value: Retruns the binary equivalent of decVal with</span>
<span class="comment-line">#                       desiredLen number of bits</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             int2bits 10 12</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::int2bits_304">proc <a href="ePTQinQTx.tcl-annot.html#::::int2bits">::::int2bits</a></a></strong> {intVal {desiredLen 0}} {
   set binVal [exec echo &#34;obase=2; $intVal&#34; | bc]
   set len [string length $binVal]
 
   if {$desiredLen == 0} {
      set diffLen 0
   } else {
      set diffLen [expr $desiredLen - $len]
   }

   for {set i 0} {$i&lt;$diffLen} {incr i} {
      set binVal &#34;0$binVal&#34;
   }
   return $binVal
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: bits2int</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: converts binary to decimal </span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: binVal - The binary Value</span>
<span class="comment-line"># Output args: None </span>
<span class="comment-line"># Return value: Retruns the decimal equivalent of binVal</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             bits2int 10</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::bits2int_334">proc <a href="ePTQinQTx.tcl-annot.html#::::bits2int">::::bits2int</a></a></strong> {binVal} {
   set decVal [exec echo &#34;ibase=2; $binVal&#34; | bc]
   return $decVal
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: bits2hex</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: converts binary to hex</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Input args: binVal - The binary Value</span>
<span class="comment-line"># Output args: None </span>
<span class="comment-line"># Return value: Retruns the hex equivalent of binVal</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             bits2hex 10</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::bits2hex_352">proc <a href="ePTQinQTx.tcl-annot.html#::::bits2hex">::::bits2hex</a></a></strong> {binVal desiredLen} {
   set decVal [<a name="::bits2int(1)"><a href="./ePTQinQTx.tcl.html#::bits2int_334">::bits2int</a></a> $binVal]
   set hexVal [exec echo &#34;obase=16; $decVal&#34; | bc]

   set len [string length $hexVal]
 
   if {$desiredLen == 0} {
      set diffLen 0
   } else {
      set diffLen [expr $desiredLen - $len]
   }

   for {set i 0} {$i&lt;$diffLen} {incr i} {
      set hexVal &#34;0$hexVal&#34;
   }

   return $hexVal
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
