<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>Ospf.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#Ospf.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>Ospf.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="Ospf.tcl-annot.html">annotations</a> | <a href="Ospf.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFRouterID</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the ip address of the router id from a ospf control packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Router ip address or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#               set RouterID [GetOSPFRouterID $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFRouterID_17">proc <a href="Ospf.tcl-annot.html#::::GetOSPFRouterID">::::GetOSPFRouterID</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetIPAddressOffset(1)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame 114]          
   } default {
      <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Message Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFPktLength</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the length of a ospf packet in a ospf control packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: short integer or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          set ospfPktLength [GetOSPFPktLength $rawFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFPktLength_44">proc <a href="Ospf.tcl-annot.html#::::GetOSPFPktLength">::::GetOSPFPktLength</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
   if {$type == &#34;81 00&#34;} {
     set leftRawFrame [string range $rawFrame 0 35] 
     set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]] 
     set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
   }
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetShortIntOffset(1)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 108]
   } default {
      <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Message Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFAreaID</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the area ip address in a ospf control packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Ip address  or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           set AreaID [GetOSPFAreaID $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFAreaID_78">proc <a href="Ospf.tcl-annot.html#::::GetOSPFAreaID">::::GetOSPFAreaID</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetIPAddressOffset(2)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame 126]          
   } default {
      <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Message Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFAuthType</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the authentication type in a ospf control packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: short integer or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          set authType [GetOSPFAuthType $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFAuthType_105">proc <a href="Ospf.tcl-annot.html#::::GetOSPFAuthType">::::GetOSPFAuthType</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetShortIntOffset(2)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 144]          
   } default {
      <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFAuthentication</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the authentication string from a ospf control packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: 5 byte hex value or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              set auth [GetOSPFAuthentication $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFAuthentication_132">proc <a href="Ospf.tcl-annot.html#::::GetOSPFAuthentication">::::GetOSPFAuthentication</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [string range $rawFrame 150 172]         
   } default {
      <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFNetworkMask</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the ip address format network mask from a ospf control packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: IP address or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#               set NetworkMask [GetOSPFNetworkMask $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFNetworkMask_159">proc <a href="Ospf.tcl-annot.html#::::GetOSPFNetworkMask">::::GetOSPFNetworkMask</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetIPAddressOffset(3)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame 174]         
   } default {
      <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFNumberOfAdsInLsa</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the number of lsas in a ospf control packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: integer value or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          GetOSPFNumberOfAdsInLsa $rawFrame</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFNumberOfAdsInLsa_186">proc <a href="Ospf.tcl-annot.html#::::GetOSPFNumberOfAdsInLsa">::::GetOSPFNumberOfAdsInLsa</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
   if {$type == &#34;81 00&#34;} {
     set leftRawFrame [string range $rawFrame 0 35] 
     set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]] 
     set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
   }
   set msgType [<a name="::GetMessageType(1)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   if {$msgType == &#34;IP_OSPFv2_LINK_UPDATE&#34;} {
      return [<a name="::GetIntOffset(1)"><a href="./MessageDecoding.tcl.html#::GetIntOffset_854">::GetIntOffset</a></a> $rawFrame 174]
   } else {
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFHelloInterval</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the hello interval from a hello packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Short integer or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          set HelloInterval [GetOSPFHelloInterval $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFHelloInterval_217">proc <a href="Ospf.tcl-annot.html#::::GetOSPFHelloInterval">::::GetOSPFHelloInterval</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetShortIntOffset(3)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 186]         
   } default {
      <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFRouterPriority</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the ospf router priority from a hello packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Byte value or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          set RouterPriority [GetOSPFRouterPriority $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFRouterPriority_244">proc <a href="Ospf.tcl-annot.html#::::GetOSPFRouterPriority">::::GetOSPFRouterPriority</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetByteOffset(1)"><a href="./MessageDecoding.tcl.html#::GetByteOffset_789">::GetByteOffset</a></a> $rawFrame 195]         
   } default {
      <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFRouterDeadInterval</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the ospf router dead interval from a hello packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Integer or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           set RouterDeadInterval [GetOSPFRouterDeadInterval $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFRouterDeadInterval_271">proc <a href="Ospf.tcl-annot.html#::::GetOSPFRouterDeadInterval">::::GetOSPFRouterDeadInterval</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetIntOffset(2)"><a href="./MessageDecoding.tcl.html#::GetIntOffset_854">::GetIntOffset</a></a> $rawFrame 198]         
   } default {
      <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFDesignatedRouter</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the ip address of DR from a hello packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: IP address or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           set DesignatedRouter [GetOSPFDesignatedRouter $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFDesignatedRouter_298">proc <a href="Ospf.tcl-annot.html#::::GetOSPFDesignatedRouter">::::GetOSPFDesignatedRouter</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetIPAddressOffset(4)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame 210]         
   } default {
      <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFBackupRouter</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the ip address of BDR from a hello packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: IP address or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           set BackupRouter [GetOSPFBackupRouter $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFBackupRouter_325">proc <a href="Ospf.tcl-annot.html#::::GetOSPFBackupRouter">::::GetOSPFBackupRouter</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetIPAddressOffset(5)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame 222]         
   } default {
      <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFNeighbor</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the ip address of ospf neighbor from a hello packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: IP address or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           set NeighborList [GetOSPFNeighbor $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFNeighbor_352">proc <a href="Ospf.tcl-annot.html#::::GetOSPFNeighbor">::::GetOSPFNeighbor</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      set length [<a name="::GetShortIntOffset(4)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 108]
      puts &#34;PacketLength: $length&#34;
      if { $length == 44} { return &#34;&#34; }
      return [<a name="::GetIPAddressOffset(6)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame 234]         
   } default {
      <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFPacketLength</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the length of ospf packet from a ospf control packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: short integer or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#                  set length [GetOSPFPacketLength $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFPacketLength_382">proc <a href="Ospf.tcl-annot.html#::::GetOSPFPacketLength">::::GetOSPFPacketLength</a></a></strong> { rawFrame } {
   set type [string range $rawFrame 36 40]
   switch -- $type \
      &#34;08 00&#34; {
      return [<a name="::GetShortIntOffset(5)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 108]     
   } &#34;81 00&#34; {
      return [<a name="::GetShortIntOffset(6)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame 120]
   } default {
      <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFControlBits</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the control bits from a hello/dd ospf packet</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: hex value of 2 bytes or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#                  set length [GetOSPFPacketLength $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFControlBits_411">proc <a href="Ospf.tcl-annot.html#::::GetOSPFControlBits">::::GetOSPFControlBits</a></a></strong> { rawFrame } {
   set type [<a name="::GetMessageType(2)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   switch -- $type \
      &#34;IP_OSPFv2_DATABASE&#34; {
      return [string range $rawFrame 183 184]
   } &#34;IP_OSPFv2_HELLO&#34; {
      return [string range $rawFrame 192 193]
   } default {
      <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown IP Type: $type&#34;
      <span class="comment-line">#just return the type</span>
      return -1
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFSequenceNumber</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the list of lsa sequence numbers from update/linkack/dd ospf</span>
<span class="comment-line">#              control packets</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: List of integers or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         set slaveSeqNum [GetOSPFSequenceNumber $dataFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFSequenceNumber_441">proc <a href="Ospf.tcl-annot.html#::::GetOSPFSequenceNumber">::::GetOSPFSequenceNumber</a></a></strong> { rawFrame } {
   set type [<a name="::GetMessageType(3)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set incrCount 0
   switch -- $type \
      &#34;IP_OSPFv2_LINK_UPDATE&#34; {
         set LSUTypeList [<a name="::GetOspfOptions(1)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUType&#34;]
         <span class="comment-line">#result_debug &#34;the LSUTypeList is $LSUTypeList and numads are [GetOSPFNumberOfAdsInLsa $rawFrame]&#34;</span>
         set startLoc 222
         for {set i 0} {$i&lt;[<a name="::GetOSPFNumberOfAdsInLsa(1)"><a href="./Ospf.tcl.html#::GetOSPFNumberOfAdsInLsa_186">::GetOSPFNumberOfAdsInLsa</a></a> $rawFrame]} {incr i} {
            if {[lindex $LSUTypeList $i]==1} {
               set numLinks [<a name="::GetNumLinks(1)"><a href="./Ospf.tcl.html#::GetNumLinks_960">::GetNumLinks</a></a> $rawFrame 1]
               <span class="comment-line">#set numLinks [GetShortIntOffset $rawFrame [expr $startLoc+30]]</span>
               <span class="comment-line">#result_debug &#34;the numLinks is $numLinks&#34;</span>
               <span class="comment-line">#incr count is routerlinkheader(24)+numlinks*eachlinkad(36)+nextrouterlinkheader(36)</span>
               set incrCount [expr 36+[expr $numLinks*36]+36]
            } elseif {[lindex $LSUTypeList $i]==2} {
               <span class="comment-line"># incrCount by 32*3+3*4=108 for a network link</span>
               set incrCount 108
            } else {
	       <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;GetOSPFSequenceNumber&#34;
	       <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;i= $i, LSUTypeList= $LSUTypeList&#34;
            }
            lappend seqNumList [<a name="::GetIntOffset(3)"><a href="./MessageDecoding.tcl.html#::GetIntOffset_854">::GetIntOffset</a></a> $rawFrame $startLoc]
            set startLoc [expr $startLoc+$incrCount]
            <span class="comment-line">#result_debug &#34;the seqNumList $seqNumList and new startLoc is $startLoc&#34;</span>
         }
         return $seqNumList
      } &#34;IP_OSPFv2_LINK_ACK&#34; {
         <span class="comment-line">#result_debug &#34;the LSUTypeList is $LSUTypeList and numads are [GetOSPFNumberOfAdsInLsa $rawFrame]&#34;</span>
         for {set startLoc 210} {[expr $startLoc + 1] &lt;= [expr [string length $rawFrame]-12]} {incr startLoc 60} {
            lappend seqNumList [<a name="::GetIntOffset(4)"><a href="./MessageDecoding.tcl.html#::GetIntOffset_854">::GetIntOffset</a></a> $rawFrame $startLoc]
            <span class="comment-line">#result_debug &#34;the seqNumList $seqNumList&#34;</span>
         }
         return $seqNumList
      } &#34;IP_OSPFv2_DATABASE&#34; {
         return [<a name="::GetIntOffset(5)"><a href="./MessageDecoding.tcl.html#::GetIntOffset_854">::GetIntOffset</a></a> $rawFrame 186]
      } default {
         <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Message Type: $type&#34;
         <span class="comment-line">#just return the type</span>
         return -1
      }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetLSALengths</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the lsa lengh for link update ospf control packets</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: List of integers or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#          set lsaLength [GetLSALengths $rawFrame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetLSALengths_499">proc <a href="Ospf.tcl-annot.html#::::GetLSALengths">::::GetLSALengths</a></a></strong> { rawFrame } {
   set type [<a name="::GetMessageType(4)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set incrCount 0
   switch -- $type \
      &#34;IP_OSPFv2_LINK_UPDATE&#34; {
         set LSUTypeList [<a name="::GetOspfOptions(2)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUType&#34;]
         <span class="comment-line">#result_debug &#34;the LSUTypeList is $LSUTypeList and numads are [GetOSPFNumberOfAdsInLsa $rawFrame]&#34;</span>
         if {[string range $rawFrame 36 40]==&#34;08 00&#34;} {
            set startLoc 240
         } elseif {[string range $rawFrame 36 40]==&#34;81 00&#34;} {
            set startLoc 252
         }
         set lengthList &#34;&#34;
         for {set i 0} {$i&lt;[<a name="::GetOSPFNumberOfAdsInLsa(2)"><a href="./Ospf.tcl.html#::GetOSPFNumberOfAdsInLsa_186">::GetOSPFNumberOfAdsInLsa</a></a> $rawFrame]} {incr i} {
            if {[lindex $LSUTypeList $i]==1} {
               set numLinks [<a name="::GetNumLinks(2)"><a href="./Ospf.tcl.html#::GetNumLinks_960">::GetNumLinks</a></a> $rawFrame 1]
               <span class="comment-line">#set numLinks [GetShortIntOffset $rawFrame [expr $startLoc+30]]</span>
               <span class="comment-line">#result_debug &#34;the numLinks is $numLinks&#34;</span>
               <span class="comment-line">#incr count is routerlinkheader(24)+numlinks*eachlinkad(36)+nextrouterlinkheader(36)</span>
               set incrCount [expr 36+[expr $numLinks*36]+36]
            } elseif {[lindex $LSUTypeList $i]==2} {
               <span class="comment-line"># incrCount by 32*3+3*4=108 for a network link</span>
               set incrCount 108
            } else {
	       <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;GetLSALength&#34;
	       <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;i= $i, LSUTypeList= $LSUTypeList&#34;
            }
            lappend lengthList [<a name="::GetShortIntOffset(7)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame $startLoc]
            set startLoc [expr $startLoc+$incrCount]
            <span class="comment-line">#result_debug &#34;the seqNumList $seqNumList and new startLoc is $startLoc&#34;</span>
         }
         return $lengthList
      } default {
         <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Message Type: $type&#34;
         <span class="comment-line">#just return the type</span>
         return -1
      }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOSPFCheckSumValue</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that returns the checksum of packet for link update ospf control packets</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: list of hex integers or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           set checkSum [GetOSPFCheckSumValue $updatePkt]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOSPFCheckSumValue_553">proc <a href="Ospf.tcl-annot.html#::::GetOSPFCheckSumValue">::::GetOSPFCheckSumValue</a></a></strong> { rawFrame } {
   set type [<a name="::GetMessageType(5)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $rawFrame]
   set incrCount 0
   <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the type:$type&#34;
   switch -- $type \
      &#34;IP_OSPFv2_LINK_UPDATE&#34; {
         set LSUTypeList [<a name="::GetOspfOptions(3)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUType&#34;]
         <span class="comment-line">#result_debug &#34;the LSUTypeList is $LSUTypeList and numads are [GetOSPFNumberOfAdsInLsa $rawFrame]&#34;</span>
         set startLoc 234
         for {set i 0} {$i&lt;[<a name="::GetOSPFNumberOfAdsInLsa(3)"><a href="./Ospf.tcl.html#::GetOSPFNumberOfAdsInLsa_186">::GetOSPFNumberOfAdsInLsa</a></a> $rawFrame]} {incr i} {
            if {[lindex $LSUTypeList $i]==1} {
               set numLinks [<a name="::GetNumLinks(3)"><a href="./Ospf.tcl.html#::GetNumLinks_960">::GetNumLinks</a></a> $rawFrame 1]
               <span class="comment-line">#set numLinks [GetShortIntOffset $rawFrame [expr $startLoc+18]]</span>
               <span class="comment-line">#result_debug &#34;the numLinks is $numLinks&#34;</span>
               <span class="comment-line">#incr count is routerlinkheader(24)+numlinks*eachlinkad(36)+nextrouterlinkheader(36)</span>
               set incrCount [expr 36+[expr $numLinks*36]+36]
            } elseif {[lindex $LSUTypeList $i]==2} {
               <span class="comment-line"># incrCount by 32*3+3*4=108 for a network link</span>
               set incrCount 108
            } else {
	       <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;GetCheckSumValue&#34;
	       <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;i= $i, LSUTypeList= $LSUTypeList&#34;
            }
            lappend checkSumList [string range $rawFrame $startLoc [expr $startLoc+4]]
            set startLoc [expr $startLoc+$incrCount]
            <span class="comment-line">#result_debug &#34;the checkSumList $checkSumList and new startLoc is $startLoc&#34;</span>
         }
         return $checkSumList
      } default {
         <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Message Type: $type&#34;
         <span class="comment-line">#just return the type</span>
         return -1
      }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetOspfOptions</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: This proc is used to return OSPF packet options</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame, optionName</span>
<span class="comment-line"># optionName: LSRType: returns the list of link state type in Link State Request packet</span>
<span class="comment-line">#             LSUType: returns the list of link state type in Link State Update packet</span>
<span class="comment-line">#             LSRID: Returns the list of link state id in Link State Request packet</span>
<span class="comment-line">#             LSUID: Returns the list of link state id in Link State Update packet</span>
<span class="comment-line">#             RAdvertsingRouter: Returns the list of advertising router in Link State Request Packet</span>
<span class="comment-line">#             UAdvertsingRouter: Returns the list of advertising router in Link State Update Packet</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: List of option value or -1 on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           GetOspfOptions $rawFrame &#34;LSUType&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetOspfOptions_609">proc <a href="Ospf.tcl-annot.html#::::GetOspfOptions">::::GetOspfOptions</a></a></strong> { rawFrame optionName } {
   set type [string range $rawFrame 36 40]
   <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
   if {$type == &#34;81 00&#34;} {
     set leftRawFrame [string range $rawFrame 0 35] 
     set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]] 
     set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
   }

   switch -- $optionName {
      &#34;LSRType&#34; {
         set lsTypeList &#34;&#34;
         for {set startLoc 174} {[expr $startLoc + 10] &lt;= [expr [string length $rawFrame]-12]} {incr startLoc 36} {
            lappend lsTypeList [string trimleft [string range $rawFrame $startLoc [expr $startLoc + 10]] &#34; 0&#34;]
            <span class="comment-line">#result_debug &#34;the rawFrame $rawFrame and lsTypeList:$lsTypeList and string:[string range $rawFrame $startLoc [expr $startLoc + 10]]&#34;</span>
         }
         return $lsTypeList
      }
      &#34;LSUType&#34; {
         set lsUTypeList &#34;&#34;
         set startLoc 195
         set incrVal 0
         for {set i 0} {$i&lt;[<a name="::GetOSPFNumberOfAdsInLsa(4)"><a href="./Ospf.tcl.html#::GetOSPFNumberOfAdsInLsa_186">::GetOSPFNumberOfAdsInLsa</a></a> $rawFrame]} {incr i} {
            set lsUTypeValue [string trimleft [string range $rawFrame $startLoc [expr $startLoc + 1]] &#34; 0&#34;]
            lappend lsUTypeList $lsUTypeValue
            if {$lsUTypeValue==1} {
               set numLinks [<a name="::GetNumLinks(4)"><a href="./Ospf.tcl.html#::GetNumLinks_960">::GetNumLinks</a></a> $rawFrame 1]
               <span class="comment-line">#incr count is routerlinkheader(24)+numlinks*eachlinkad(36)+nextrouterlinkheader(36)</span>
               set incrVal [expr 36+[expr $numLinks*36]+36]
               <span class="comment-line">#set incrVal 108</span>
            } elseif {$lsUTypeValue==2} {
              <span class="comment-line">#set incrVal 105</span>
              set incrVal 84
           } elseif {$lsUTypeValue==3} {
              set incrVal 84
           } elseif {$lsUTypeValue==7} {
              set incrVal 108
           }
           set startLoc [expr $startLoc+$incrVal]
         }
         return $lsUTypeList
      }
      &#34;LSRID&#34; {
         set lsIdList &#34;&#34;
         for {set startLoc 186} {[expr $startLoc + 10] &lt;= [expr [string length $rawFrame]-12]} {incr startLoc 36} {
            lappend lsIdList [<a name="::GetIPAddressOffset(7)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame $startLoc]
         }
         return $lsIdList
      }
      &#34;LSUID&#34; {
         set lsUIdList &#34;&#34;
         set startLoc 198
         set incrVal 0

         for {set i 0} {$i&lt;[<a name="::GetOSPFNumberOfAdsInLsa(5)"><a href="./Ospf.tcl.html#::GetOSPFNumberOfAdsInLsa_186">::GetOSPFNumberOfAdsInLsa</a></a> $rawFrame]} {incr i} {
            set lsUId [<a name="::GetIPAddressOffset(8)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame $startLoc]
            set lsUTypeValue [lindex [<a name="::GetOspfOptions(4)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUType&#34;] $i]
            lappend lsUIdList $lsUId
            if {$lsUTypeValue==1} {
               set numLinks [<a name="::GetNumLinks(5)"><a href="./Ospf.tcl.html#::GetNumLinks_960">::GetNumLinks</a></a> $rawFrame 1]
               <span class="comment-line">#incr count is routerlinkheader(24)+numlinks*eachlinkad(36)+nextrouterlinkheader(36)</span>
               set incrVal [expr 36+[expr $numLinks*36]+36]
            } elseif {$lsUTypeValue==2} {
              <span class="comment-line">#set incrVal 144</span>
              set incrVal 108
           } elseif {$lsUTypeValue==3} {
              set incrVal 84
           } elseif {$lsUTypeValue==7} {
              set incrVal 108
           }
           <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the lsUTypeValue $lsUTypeValue and incrVal $incrVal and lsUIdList $lsUIdList&#34;
           set startLoc [expr $startLoc+$incrVal]
         }
         return $lsUIdList
      }
      &#34;UAdvertisingRouter&#34; {
         set advURouterList &#34;&#34;
         set startLoc 210
         set incrVal 0
         
         for {set i 0} {$i&lt;[<a name="::GetOSPFNumberOfAdsInLsa(6)"><a href="./Ospf.tcl.html#::GetOSPFNumberOfAdsInLsa_186">::GetOSPFNumberOfAdsInLsa</a></a> $rawFrame]} {incr i} {
            set advURouter [<a name="::GetIPAddressOffset(9)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame $startLoc]
            set lsUTypeValue [lindex [<a name="::GetOspfOptions(5)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUType&#34;] $i]            
            lappend advURouterList $advURouter
            if {$lsUTypeValue==1} {
               set numLinks [<a name="::GetNumLinks(6)"><a href="./Ospf.tcl.html#::GetNumLinks_960">::GetNumLinks</a></a> $rawFrame 1]
               <span class="comment-line">#incr count is routerlinkheader(24)+numlinks*eachlinkad(36)+nextrouterlinkheader(36)</span>
               set incrVal [expr 36+[expr $numLinks*36]+36]
            } elseif {$lsUTypeValue==2} {
              <span class="comment-line">#set incrVal 144</span>
              set incrVal 108
           } elseif {$lsUTypeValue==3} {
              set incrVal 84
           } elseif {$lsUTypeValue==7} {
              set incrVal 108
           }
           set startLoc [expr $startLoc+$incrVal]
         }
         return $advURouterList
      }
      &#34;LSUAGE&#34; {
         set lsUAgeList &#34;&#34;
         set startLoc 186
         set incrVal 0
         for {set i 0} {$i&lt;[<a name="::GetOSPFNumberOfAdsInLsa(7)"><a href="./Ospf.tcl.html#::GetOSPFNumberOfAdsInLsa_186">::GetOSPFNumberOfAdsInLsa</a></a> $rawFrame]} {incr i} {
            set lsUAge [string trimleft [string range $rawFrame $startLoc [expr $startLoc+4]] &#34; 0&#34;]
            set lsUType [lindex [<a name="::GetOspfOptions(6)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUType&#34;] $i]
            lappend lsUAgeList $lsUAge
            if {$lsUType==1} {
               set numLinks [<a name="::GetNumLinks(7)"><a href="./Ospf.tcl.html#::GetNumLinks_960">::GetNumLinks</a></a> $rawFrame 1]
               <span class="comment-line">#incr count is routerlinkheader(24)+numlinks*eachlinkad(36)+nextrouterlinkheader(36)</span>
               set incrVal [expr 36+[expr $numLinks*36]+36]
               <span class="comment-line">#set incrVal 108</span>
            } elseif {$lsUType==2} {
              <span class="comment-line">#set incrVal 105</span>
              <span class="comment-line">#set incrVal 84</span>
              set incrVal 96
           }
           set startLoc [expr $startLoc+$incrVal]
         }
         return $lsUAgeList
      }
      &#34;RAdvertisingRouter&#34; {
         set advRouterList &#34;&#34;
         for {set startLoc 198} {[expr $startLoc + 10] &lt;= [expr [string length $rawFrame]-12]} {incr startLoc 36} {
            lappend advRouterList [<a name="::GetIPAddressOffset(10)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame $startLoc]
         }
         return $advRouterList
      } default {
         <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown optionName supplied: $optionName&#34;
         <span class="comment-line">#just return the type</span>
         return -1
      }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyLSAInfo</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to verify the Router link and network link info in an link state update</span>
<span class="comment-line">#     for router link lsa: It verifies the linkid, link data and link type info for stub/transit network</span>
<span class="comment-line">#     for network link lsa: It verifies the attached routers and subnet mask</span>
<span class="comment-line">#     note that it does not verify the info correctness but it verifies the info format</span>
<span class="comment-line">#     and existence</span>
<span class="comment-line">#</span>
<span class="comment-line"># Assumptions:</span>
<span class="comment-line">#  1. This works considering the subnet mask 255.255.2255.255 and maximum</span>
<span class="comment-line">#     interface Ip is a.b.c.4.</span>
<span class="comment-line">#  2. DRIP in the network has to be correct when passed to this proc</span>
<span class="comment-line"># Input args: rawFrame DRIP</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: -1 only on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           VerifyLSAInfo $rawFrame $dsIpAddress</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyLSAInfo_769">proc <a href="Ospf.tcl-annot.html#::::VerifyLSAInfo">::::VerifyLSAInfo</a></a></strong> {rawFrame DRIP {LinkType 1}} {
   set LSUTypeList [<a name="::GetOspfOptions(7)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUType&#34;]
   <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the LSUTypeList $LSUTypeList&#34;
   for {set count 1} {$count&lt;=[llength $LSUTypeList]} {incr count} {
      switch -- [lindex $LSUTypeList [expr $count-1]] \
      &#34;1&#34; {
         if {$LinkType==1} {
         set numLinks [<a name="::GetNumLinks(8)"><a href="./Ospf.tcl.html#::GetNumLinks_960">::GetNumLinks</a></a> $rawFrame $count $LSUTypeList]
         <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the numLinks $numLinks&#34;
         for {set i 1} {$i&lt;=$numLinks} {incr i} {
            set routerLinkInfo [<a name="::GetRouterLinkInfo(1)"><a href="./Ospf.tcl.html#::GetRouterLinkInfo_1009">::GetRouterLinkInfo</a></a> $rawFrame $count $i]
            <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the routerLinkInfo $routerLinkInfo&#34;
            set linkId [lindex $routerLinkInfo 0]
            set linkData [lindex $routerLinkInfo 1]
            set linkType [lindex $routerLinkInfo 2]
            
            <span class="comment-line"># Verify the router link for stub/transit networks</span>
<span class="comment-line">#            result_debug &#34;the linkType is $linkType, linkId $linkId, linkData $linkData&#34;</span>
            
            if {$linkType==3} {     ;<span class="comment-line"># Stub network</span>
               <span class="comment-line">################################################</span>
               set subTest &#34;Router LSA ($count) for link $i, Id:$linkId, Data:$linkData, Type:$linkType (stub network)&#34;
               <span class="comment-line">################################################</span>
               result_h2 &#34;$subTest&#34;
               <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;

               scan $linkId {%d.%d.%d.%d} a b c d
               if {($d==0) &amp;&amp; ($linkData==&#34;255.255.255.0&#34;)} {
                  <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Correct Stub Network info:LinkId:$linkId, LinkData:$linkData, linkType:$linkType (stub network), PASS&#34;
               } else {
                  <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wrong Stub Network info:LinkId:$linkId, LinkData:$linkData, linkType:$linkType (stub network), FAIL&#34;
               }
            } elseif {$linkType==2} {   ;<span class="comment-line"># Transit network</span>
               <span class="comment-line">################################################</span>
               set subTest &#34;Router LSA ($count) for link $i, Id:$linkId, Data:$linkData, Type:$linkType (Transit network)&#34;
               <span class="comment-line">################################################</span>
               result_h2 &#34;$subTest&#34;
               <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;

               scan $linkData {%d.%d.%d.%d} a b c d
<span class="comment-line">#               result_debug &#34;the linkId is $linkId and d is $d&#34;</span>
               if {($linkId==$DRIP) &amp;&amp; ($d&lt;=4) &amp;&amp; ($d&gt;0)} {
                  <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Correct transit Network info:LinkId:$linkId, LinkData:$linkData, linkType:$linkType (Transit network), PASS&#34;
               } else {
                  <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wrong transit Network info:LinkId:$linkId, LinkData:$linkData, linkType:$linkType (Transit network), FAIL&#34;
               }
            } elseif {$linkType==1} {     ;<span class="comment-line"># P2P network</span>
               <span class="comment-line">################################################</span>
               set subTest &#34;Router LSA ($count) for link $i, Id:$linkId, Data:$linkData, Type:$linkType (Point to Point network)&#34;
               <span class="comment-line">################################################</span>
               result_h2 &#34;$subTest&#34;
               <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;

               <span class="comment-line"># Match linkData notlinkId for p2p link</span>
               if {$linkData==$DRIP} {
                  <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Correct P2P Network info:LinkId:$linkId, LinkData:$linkData, linkType:$linkType (P2P network), PASS&#34;
               } else {
                  <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wrong P2P Network info:LinkId:$linkId, LinkData:$linkData, linkType:$linkType (P2P Netowkr), FAIL&#34;
               }
            } else {
               <span class="comment-line">################################################</span>
               set subTest &#34;Router LSA ($count) for link $i, Invalid info&#34;
               <span class="comment-line">################################################</span>
               result_h2 &#34;$subTest&#34;
               <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
               <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invlaid linkType encountered $linkType&#34;
            }
            <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         }
         }
      } &#34;2&#34; {
         if {$LinkType==2} {
         set LSUId [<a name="::GetOspfOptions(8)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUID&#34;]
         set LSUAdvertRouter [<a name="::GetOspfOptions(9)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;UAdvertisingRouter&#34;]

         set advRouter [lindex $LSUAdvertRouter [expr $count-1]]
         set lsuid [lindex $LSUId [expr $count-1]]
         <span class="comment-line">################################################</span>
         set subTest &#34;Network LSA for linkId:$LSUId, Advertising router:$LSUAdvertRouter&#34;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;
         <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
         if {[regexp -nocase $DRIP $advRouter]} {
            <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Correct Network info:LinkStateId:$lsuid,adv router:$advRouter, PASS&#34;
         } else {
            <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wrong Network info:LinkStateId:$lsuid,adv router:$advRouter, FAIL&#34;
         }
         <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      }
      } &#34;3&#34; {
         if {$LinkType==3} {
         set LSUId [<a name="::GetOspfOptions(10)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUID&#34;]
         set LSUAdvertRouter [<a name="::GetOspfOptions(11)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;UAdvertisingRouter&#34;]

         set advRouter [lindex $LSUAdvertRouter [expr $count-1]]
         set lsuid [lindex $LSUId [expr $count-1]]
         <span class="comment-line">################################################</span>
         set subTest &#34;Summary-net LSA for linkId:$lsuid, Advertising router:$advRouter&#34;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;
         <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
         if {[regexp -nocase $DRIP $advRouter]} {
            <a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Correct Network info:LinkStateId:$lsuid,adv router:$advRouter, PASS&#34;
         } else {
            <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wrong Network info:LinkStateId:$lsuid,adv router:$advRouter, FAIL&#34;
         }
         <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         }
      } &#34;4&#34; {
         if {$LinkType==4} {
         set LSUId [<a name="::GetOspfOptions(12)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUID&#34;]
         set LSUAdvertRouter [<a name="::GetOspfOptions(13)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;UAdvertisingRouter&#34;]

         set advRouter [lindex $LSUAdvertRouter [expr $count-1]]
         set lsuid [lindex $LSUId [expr $count-1]]
         <span class="comment-line">################################################</span>
         set subTest &#34;Summary-asb LSA for linkId:$lsuid, Advertising router:$advRouter&#34;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;
         <a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
         if {[regexp -nocase $DRIP $advRouter]} {
            <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Correct Network info:LinkStateId:$lsuid,adv router:$advRouter, PASS&#34;
         } else {
            <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wrong Network info:LinkStateId:$lsuid,adv router:$advRouter, FAIL&#34;
         }
         <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         }
      } &#34;5&#34; {
         if {$LinkType==5} {
         set LSUId [<a name="::GetOspfOptions(14)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUID&#34;]
         set LSUAdvertRouter [<a name="::GetOspfOptions(15)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;UAdvertisingRouter&#34;]

         set advRouter [lindex $LSUAdvertRouter [expr $count-1]]
         set lsuid [lindex $LSUId [expr $count-1]]
         <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the total LSUId $LSUId, LSUAdvertRouter $LSUAdvertRouter&#34;
         <span class="comment-line">################################################</span>
         set subTest &#34;As-external LSA for linkId:$lsuid, Advertising router:$advRouter&#34;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;
         <a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
         if {[regexp -nocase $DRIP $advRouter]} {
            <a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Correct Network info:LinkStateId:$lsuid,adv router:$advRouter, PASS&#34;
         } else {
            <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wrong Network info:LinkStateId:$lsuid,adv router:$advRouter, FAIL&#34;
         }
         <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         }
      } &#34;7&#34; {
         if {$LinkType==7} {
         set LSUId [<a name="::GetOspfOptions(16)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUID&#34;]
         set LSUAdvertRouter [<a name="::GetOspfOptions(17)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;UAdvertisingRouter&#34;]

         set advRouter [lindex $LSUAdvertRouter [expr $count-1]]
         set lsuid [lindex $LSUId [expr $count-1]]
         <span class="comment-line">################################################</span>
         set subTest &#34;External-type7 LSA for linkId:$lsuid, Advertising router:$advRouter&#34;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;
         <a name="::report_start_test(9)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
         if {[regexp -nocase $DRIP $advRouter]} {
            <a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Correct Network info:LinkStateId:$lsuid,adv router:$advRouter, PASS&#34;
         } else {
            <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Wrong Network info:LinkStateId:$lsuid,adv router:$advRouter, FAIL&#34;
         }
         <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         }
      } default {
         <a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invalid link Type encountered [lindex $LSUTypeList [expr $count-1]]&#34;
         return -1
      }
   }
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetNumLinks</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Returns the number of links in a LSA given the lsa number</span>
<span class="comment-line">#              Should be called ONLY FOR Router LSAs But now fixed for network LSAs too;-)</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame, lsaName, LSUTypeList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: Returns the number of links found in rawFrame</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         GetNumLinks $rawFrame 1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetNumLinks_960">proc <a href="Ospf.tcl-annot.html#::::GetNumLinks">::::GetNumLinks</a></a></strong> {rawFrame lsaNum {LSUTypeList 1}} {
   set countValue 0
   for {set i 1} {$i&lt;=[llength $LSUTypeList]} {incr i} {
      set lsUType [lindex $LSUTypeList [expr $i-1]]
      if {$i!=$lsaNum} {
         if {$lsUType==1} {
            set countValue [expr 144+$countValue]
         } elseif {$lsUType==2} {
            set countValue [expr 108+$countValue]
         } elseif {$lsUType==3} {
            set countValue [expr 108+$countValue]
         }
         continue
      } else {
         set startingLoc 252
         if {[string range $rawFrame 36 40]==&#34;08 00&#34;} {
            set startingLoc 252
         } elseif {[string range $rawFrame 36 40]==&#34;81 00&#34;} {
            set startingLoc 264
         }
         set startLoc [expr $startingLoc + [expr $countValue * [expr $lsaNum-1]]]
         set numLinks [<a name="::GetShortIntOffset(8)"><a href="./MessageDecoding.tcl.html#::GetShortIntOffset_832">::GetShortIntOffset</a></a> $rawFrame $startLoc]
      }
   }
   <span class="comment-line">#result_debug &#34;the lsNum $lsaNum, startLoc:$startLoc, endLoc:$endLoc&#34;</span>
   <span class="comment-line">#return [string trimleft [string range $rawFrame $startLoc $endLoc] &#34; 0&#34;]</span>
   return $numLinks
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetRouterLinkInfo</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that is used to get the router link info including link Id,</span>
<span class="comment-line">#              link data and linkType</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame, lsaNum, linkNum</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value:</span>
<span class="comment-line">#            Returns a list of linkId, linkData and linkType from a LSA update given the</span>
<span class="comment-line">#            LSA number and link number in that lsa</span>
<span class="comment-line">#            make sure the lsaNum is the lsa number in lsupdate1 for lsanum 1 and 2 for lasNum 2</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         GetRouterLinkInfo $rawFrame $count $i</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetRouterLinkInfo_1009">proc <a href="Ospf.tcl-annot.html#::::GetRouterLinkInfo">::::GetRouterLinkInfo</a></a></strong> {rawFrame lsaNum linkNum} {
   set linkInfo &#34;&#34;
   set prevLinkType 0

   set LSUTypeList [<a name="::GetOspfOptions(18)"><a href="./Ospf.tcl.html#::GetOspfOptions_609">::GetOspfOptions</a></a> $rawFrame &#34;LSUType&#34;]
   
   set prevLinkType [lindex $LSUTypeList [expr $lsaNum-2]]   ;<span class="comment-line"># (-2 for getting the previous link type in number</span>
   

   if {$prevLinkType==1} {
      set startLoc [expr [expr 258 + [expr 144 * [expr $lsaNum-1]]] + [expr 36 * [expr $linkNum -1]]]
   } elseif {$prevLinkType==2} {
      set startLoc [expr [expr 258 + [expr 108 * [expr $lsaNum-1]]] + [expr 36 * [expr $linkNum -1]]]
   } else {
      set startLoc [expr [expr 258 + [expr 144 * [expr $lsaNum-1]]] + [expr 36 * [expr $linkNum -1]]]
   }
   <span class="comment-line">#result_debug &#34;the prevLinkType $prevLinkType and startLoc $startLoc, lsaNum $lsaNum and linkNum $linkNum and LSUTypeList $LSUTypeList&#34;</span>
   lappend linkInfo [<a name="::GetIPAddressOffset(11)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame $startLoc]
   set linkDataStart [expr $startLoc+12]
   lappend linkInfo [<a name="::GetIPAddressOffset(12)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $rawFrame $linkDataStart]
   set linkTypeStart [expr $linkDataStart + 12]
   lappend linkInfo [string trimleft [string range $rawFrame $linkTypeStart [expr $linkTypeStart+1]] &#34; 0&#34;]
   set linkTosMetric [expr $linkTypeStart + 3]
   lappend linkInfo [string trimleft [string range $rawFrame $linkTosMetric [expr $linkTosMetric+7]] &#34; 0&#34;]
   return $linkInfo
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: ReduceOSLSADefaultValues</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that is used to use nofeep interface to reduce default values of</span>
<span class="comment-line">#              ospfLsRegresh, ospfLsMaxAge, ospfLsCheckAge, ospfLsMaxAgeDiff.</span>
<span class="comment-line">#              This is done to reduce total time taken in wait of lsa refresh/flush during regression</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: dutList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         ReduceOSLSADefaultValues &#34;1 2 3 4&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ReduceOSLSADefaultValues_1055">proc <a href="Ospf.tcl-annot.html#::::ReduceOSLSADefaultValues">::::ReduceOSLSADefaultValues</a></a></strong> {dutList} {

   set firstSubStr &#34;DUT&#34;
   set lastSubStr &#34;_CONNECT&#34;
   foreach dut $dutList {
      global $firstSubStr$dut$lastSubStr
      <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$dut$lastSubStr]
      <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;

       <a name="::EnableDebugMode(1)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
       <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;jerry configure ospf lsa-timer-multiple 5&#34;
       <a name="::DisableDebugMode(1)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
       
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: MakeOSLSADefaultValues</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that is used to use nofeep interface to undo reduced values of</span>
<span class="comment-line">#              ospfLsRegresh, ospfLsMaxAge, ospfLsCheckAge, ospfLsMaxAgeDiff to default.</span>
<span class="comment-line">#              This is oppsite of ReduceOSLSADefaultValues</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: dutList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         MakeOSLSADefaultValues &#34;1 2 3 4&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MakeOSLSADefaultValues_1088">proc <a href="Ospf.tcl-annot.html#::::MakeOSLSADefaultValues">::::MakeOSLSADefaultValues</a></a></strong> {dutList} {

   set firstSubStr &#34;DUT&#34;
   set lastSubStr &#34;_CONNECT&#34;
   foreach dut $dutList {
      global $firstSubStr$dut$lastSubStr
      <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [expr $$firstSubStr$dut$lastSubStr]
      <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
       
      <a name="::EnableDebugMode(2)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>
      <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;jerry configure ospf lsa-timer-multiple 60&#34;
      <a name="::DisableDebugMode(2)"><a href="./misc.tcl.html#::DisableDebugMode_2957">::DisableDebugMode</a></a>
       
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupCommonVlan</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: ospf topology specific proc that is used to setup a common ospf vlan setup</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: vlan1IP, vlan2IP, vlanArea, dutID, enableOSPF</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         SetupCommonVlan $DUT1vlan1IP $DUT1vlan2IP $vlanArea 1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupCommonVlan_1120">proc <a href="Ospf.tcl-annot.html#::::SetupCommonVlan">::::SetupCommonVlan</a></a></strong> { vlan1IP vlan2IP vlanArea dutID {enableOSPF &#34;true&#34; }} {

<a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipforwarding&#34;
<a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan1&#34;
<a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 ipaddress $vlan1IP/24&#34;
<a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipforwarding vlan vlan1&#34;
<a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan1 add port [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> $dutID 0]&#34;
<a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create ospf area $vlanArea&#34;
<a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan vlan2&#34;
<a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan2 ipaddress $vlan2IP/24&#34;
<a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipforwarding vlan vlan2&#34;
<a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config vlan2 add port [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> [expr $dutID * 2] $dutID]&#34;
<a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config ospf add vlan vlan1 area $vlanArea&#34;
<a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config ospf add vlan vlan2 area $vlanArea&#34;
if { $enableOSPF == &#34;true&#34; } { <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ospf&#34; }

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupCommonVlan</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: ospf topology specific proc that is used to cleanup the configuration performed</span>
<span class="comment-line">#              by SetupCommonVlan</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: vlanArea</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         CleanupCommonVlan  $vlanArea</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupCommonVlan_1155">proc <a href="Ospf.tcl-annot.html#::::CleanupCommonVlan">::::CleanupCommonVlan</a></a></strong> { vlanArea } {

<a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan1&#34;
<a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan vlan2&#34;
<a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable ospf&#34;
sleep 2		;<span class="comment-line"># exos</span>
<a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete ospf area $vlanArea&#34;

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupSingleOSPFVlan</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: ospf topology specific proc that is used to setup a single ospf vlan</span>
<span class="comment-line">#              for a given area.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlan1IP, vlanArea, portList, dutID, vlanName, enableOSPF, tag</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         SetupSingleOSPFVlan 100.101.10.1  $area [MapDUTPortId 1] 1 &#34;vlan1&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupSingleOSPFVlan_1182">proc <a href="Ospf.tcl-annot.html#::::SetupSingleOSPFVlan">::::SetupSingleOSPFVlan</a></a></strong> { vlan1IP vlanArea portList dutID {vlanName &#34;vlan1&#34;} {enableOSPF &#34;true&#34;} {tag &#34;&#34;}} {

<a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
sleep 2		;<span class="comment-line"># exos</span>
<a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding&#34;
<a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $vlanName&#34;
<a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName ipaddress $vlan1IP/24&#34;
<a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show $vlanName&#34;
if {[string length $tag]} {
   <a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName tag $tag&#34;
   <a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName add port $portList tagged&#34;
} else {
   <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName add port $portList&#34;
}
<a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding vlan $vlanName&#34;

<span class="comment-line">#just create the area eventhough the area might exist</span>
if {$vlanArea != &#34;0.0.0.0&#34; } { <a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create ospf area $vlanArea&#34; }
<a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config ospf add vlan $vlanName area $vlanArea&#34;

if { $enableOSPF == &#34;true&#34; } { <a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ospf&#34; }

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: SetupSingleOSPFv3Vlan</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: ospf topology specific proc that is used to setup a single ospf vlan</span>
<span class="comment-line">#              for a given area.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlan1IP, vlanArea, portList, dutID, vlanName, enableOSPF, tag</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         SetupSingleOSPFVlan 100.101.10.1  $area [MapDUTPortId 1] 1 &#34;vlan1&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupSingleOSPFv3Vlan_1223">proc <a href="Ospf.tcl-annot.html#::::SetupSingleOSPFv3Vlan">::::SetupSingleOSPFv3Vlan</a></a></strong> { vlan1IP vlanArea portList {vlanName &#34;vlan1&#34;} {enableOSPF &#34;true&#34;} {tag &#34;&#34;}} {

sleep 2         ;<span class="comment-line"># exos</span>
<a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $vlanName&#34;
<a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName ipaddress $vlan1IP/64&#34;
if {[string length $tag]} {
   <a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName tag $tag&#34;
   <a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName add port $portList tagged&#34;
} else {
   <a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName add port $portList&#34;
}
<a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding ipv6&#34;
<a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show $vlanName&#34;
<span class="comment-line">#just create the area eventhough the area might exist</span>
if {$vlanArea != &#34;0.0.0.0&#34; } { <a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create ospfv3 area $vlanArea&#34; }
<a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config ospfv3 add vlan $vlanName area $vlanArea&#34;

if { $enableOSPF == &#34;true&#34; } { <a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospfv3&#34; }

}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupSingleOSPFVlanP2P</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: ospf p2p topology specific proc that is used to setup a single p2p ospf vlan</span>
<span class="comment-line">#              for a given area.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlan1IP, vlanArea, portList, dutID, vlanName, enableOSPF, tag</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         SetupSingleOSPFVlanP2P $DUT1vlan1_3IP $vlanAreaBB $portList 1 &#34;vlan1_3&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupSingleOSPFVlanP2P_1262">proc <a href="Ospf.tcl-annot.html#::::SetupSingleOSPFVlanP2P">::::SetupSingleOSPFVlanP2P</a></a></strong> { vlan1IP vlanArea portList dutID {vlanName &#34;vlan1&#34;} {enableOSPF &#34;true&#34;} {tag &#34;&#34;}} {

<a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
sleep 2		;<span class="comment-line"># exos</span>
<a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding&#34;
<a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan $vlanName&#34;
<a name="::SendACmd(47)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName ipaddress $vlan1IP/24&#34;
if {[string length $tag]} {
   <a name="::SendACmd(48)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName tag $tag&#34;
   <a name="::SendACmd(49)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName add port $portList tagged&#34;
} else {
   <a name="::SendACmd(50)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config $vlanName add port $portList&#34;
}
<a name="::SendACmd(51)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ipforwarding vlan $vlanName&#34;

<span class="comment-line">#just create the area eventhough the area might exist</span>
if {$vlanArea != &#34;0.0.0.0&#34; } { <a name="::SendACmd(52)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create ospf area $vlanArea&#34; }
<a name="::SendACmd(53)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;config ospf add vlan $vlanName area $vlanArea link point&#34;

if { $enableOSPF == &#34;true&#34; } { <a name="::SendACmd(54)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ospf&#34; }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupSingleOSPFVlan</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: ospf topology specific proc that is used to cleanup single ospf vlan cinfiguration</span>
<span class="comment-line">#              for a given area. opposite of SetupSingleOSPFVlan</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlanArea, vlanName</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         CleanupSingleOSPFVlan $area vlan1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupSingleOSPFVlan_1301">proc <a href="Ospf.tcl-annot.html#::::CleanupSingleOSPFVlan">::::CleanupSingleOSPFVlan</a></a></strong> { vlanArea {vlanName &#34;vlan1&#34;}} {

<a name="::SendACmd(55)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan $vlanName&#34;
sleep 2		;<span class="comment-line"># exos</span>
<a name="::SendACmd(56)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable ospf&#34;
sleep 2		;<span class="comment-line"># exos</span>
if {$vlanArea != &#34;0.0.0.0&#34; } { <a name="::SendACmd(57)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ospf area $vlanArea&#34;}

}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CleanupSingleOSPFv3Vlan</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: ospf topology specific proc that is used to cleanup single ospf vlan cinfiguration</span>
<span class="comment-line">#              for a given area. opposite of SetupSingleOSPFVlan</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlanArea, vlanName</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         CleanupSingleOSPFVlan $area vlan1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupSingleOSPFv3Vlan_1327">proc <a href="Ospf.tcl-annot.html#::::CleanupSingleOSPFv3Vlan">::::CleanupSingleOSPFv3Vlan</a></a></strong> { vlanArea {vlanName &#34;vlan1&#34;}} {

<a name="::SendACmd(58)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;delete vlan $vlanName&#34;
sleep 2         ;<span class="comment-line"># exos</span>
<a name="::SendACmd(59)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;disable ospfv3&#34;
sleep 2         ;<span class="comment-line"># exos</span>
if {$vlanArea != &#34;0.0.0.0&#34; } { <a name="::SendACmd(60)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ospfv3 area $vlanArea&#34;}

}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SetupSingleRIPVlan</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: ospf topology specific proc that is used to setup a RIP vlan for a given</span>
<span class="comment-line">#              vlan name.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlan1IP, portList, dutID, vlanName, enableRIP</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         SetupSingleRIPVlan $DUT2vlan2_3IP $portList 2 &#34;rip_vlan23&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupSingleRIPVlan_1355">proc <a href="Ospf.tcl-annot.html#::::SetupSingleRIPVlan">::::SetupSingleRIPVlan</a></a></strong> { vlan1IP portList dutID {vlanName &#34;vlan1&#34;} {enableRIP &#34;true&#34; }} {

<a name="::SendACmd(61)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;create vlan $vlanName&#34;
<a name="::SendACmd(62)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config $vlanName ipaddress $vlan1IP/24&#34;
<a name="::SendACmd(63)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable ipforwarding vlan $vlanName&#34;
<a name="::SendACmd(64)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config $vlanName add port $portList&#34;
<a name="::SendACmd(65)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config rip add vlan $vlanName&#34;
<a name="::SendACmd(66)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;configure rip updatetime 10&#34; ;<span class="comment-line">#shorten for testing purposes</span>

if { $enableRIP == &#34;true&#34; } { <a name="::SendACmd(67)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;enable rip&#34; }

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: SetupSingleRIPngVlan</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: ospf topology specific proc that is used to setup a RIP vlan for a given</span>
<span class="comment-line">#              vlan name.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlan1IP, portList, dutID, vlanName, enableRIP</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         SetupSingleRIPVlan $DUT2vlan2_3IP $portList 2 &#34;rip_vlan23&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SetupSingleRIPngVlan_1385">proc <a href="Ospf.tcl-annot.html#::::SetupSingleRIPngVlan">::::SetupSingleRIPngVlan</a></a></strong> { vlan1IP portList dutID {vlanName &#34;vlan1&#34;} {enableRIP &#34;true&#34; }} {

<a name="::SendACmd(68)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;create vlan $vlanName&#34;
<a name="::SendACmd(69)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;config $vlanName ipaddress $vlan1IP/64&#34;
<a name="::SendACmd(70)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;enable ipforwarding ipv6&#34;
<a name="::SendACmd(71)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;config $vlanName add port $portList&#34;
<a name="::SendACmd(72)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;config ripng add vlan $vlanName&#34;
<a name="::SendACmd(73)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;configure ripng updatetime 10&#34; ;<span class="comment-line">#shorten for testing purposes</span>

if { $enableRIP == &#34;true&#34; } { <a name="::SendACmd(74)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>  &#34;enable ripng&#34; }

}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CleanupSingleRIPVlan</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: ospf topology specific proc that is used to cleanup the RIP topology.</span>
<span class="comment-line">#              This proc is opposite of SetupSingleRIPVlan</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlanName</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         CleanupSingleRIPVlan &#34;rip_vlan23&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupSingleRIPVlan_1416">proc <a href="Ospf.tcl-annot.html#::::CleanupSingleRIPVlan">::::CleanupSingleRIPVlan</a></a></strong> {{vlanName &#34;vlan1&#34;}} {
<a name="::SendACmd(75)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config rip updatetime 30&#34;
<a name="::SendACmd(76)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;delete vlan $vlanName&#34;
<a name="::SendACmd(77)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;disable rip&#34;

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CleanupSingleRIPngVlan</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: ospf topology specific proc that is used to cleanup the RIP topology.</span>
<span class="comment-line">#              This proc is opposite of SetupSingleRIPVlan</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  vlanName</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#         CleanupSingleRIPVlan &#34;rip_vlan23&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CleanupSingleRIPngVlan_1440">proc <a href="Ospf.tcl-annot.html#::::CleanupSingleRIPngVlan">::::CleanupSingleRIPngVlan</a></a></strong> {{vlanName &#34;vlan1&#34;}} {
<a name="::SendACmd(78)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config ripng updatetime 30&#34;
<a name="::SendACmd(79)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;delete vlan $vlanName&#34;
<a name="::SendACmd(80)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;disable ripng&#34;

}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: CheckAreaCheckSum</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that checks the area checksum using &#34;sh os are $area&#34; for DUT1 and DUT2</span>
<span class="comment-line">#              for a given flag</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  area, DUT1Ip, DUT2Ip, flag</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#            CheckAreaCheckSum 0.0.0.0 $DUT1_CONNECT $DUT3_CONNECT</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::CheckAreaCheckSum_1464">proc <a href="Ospf.tcl-annot.html#::::CheckAreaCheckSum">::::CheckAreaCheckSum</a></a></strong> {area DUT1Ip DUT2Ip {flag &#34;equal&#34;} } {
   
   <a name="::report_start_test(10)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking area $area checksum between [<a name="::GetDUTName(1)"><a href="./misc.tcl.html#::GetDUTName_138">::GetDUTName</a></a> $DUT1Ip] and [<a name="::GetDUTName(2)"><a href="./misc.tcl.html#::GetDUTName_138">::GetDUTName</a></a> $DUT2Ip]&#34;
   <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1Ip
   lappend parameterList &#34;Chksum: 1&#34;
   set checkSumDUT1 [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show ospf area $area&#34; $parameterList]
   <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2Ip
   set checkSumDUT2 [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show ospf area $area&#34; $parameterList]
   if {$flag == &#34;equal&#34; } {
      if {$checkSumDUT1 == $checkSumDUT2} {
         <a name="::result_ok(9)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checksums for area $area are the same.&#34;
      } else {
         <span class="comment-line"># --- double check to make sure</span>
         for {set x 0} {$x &lt; 6} {incr x} {
             <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Got &lt;$checkSumDUT1&gt; and &lt;$checkSumDUT2&gt; first time, try getting again($x)...&#34;
             sleep 10
             <a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1Ip
             set checkSumDUT1 [<a name="::GetKeyValue(3)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show ospf area $area&#34; $parameterList]
	     <a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2Ip
             set checkSumDUT2 [<a name="::GetKeyValue(4)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show ospf area $area&#34; $parameterList]
	     if {$checkSumDUT1 == $checkSumDUT2} {
                   break;
             }
         }
	 if {$checkSumDUT1 == $checkSumDUT2} {
	    <a name="::result_ok(10)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checksums for area $area are the same.&#34;
	 } else { 
            <a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Checksums for area $area are different. Should be the same.&#34;
            <a name="::result_error(12)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Got &lt;$checkSumDUT1&gt; and &lt;$checkSumDUT2&gt;.&#34;
         }
      }
   } else {
      if {$checkSumDUT1 != $checkSumDUT2} {
         <a name="::result_ok(11)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Checksums for area $area are different.&#34;
      } else {
         <a name="::result_error(13)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Checksums for area $area are the same. Should be different.&#34;
         <a name="::result_error(14)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Got &lt;$checkSumDUT1&gt; and &lt;$checkSumDUT2&gt;.&#34;
      }
   }
   <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: IncreaseLinkCost</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: This proc is used to increase link cost of a given vlan vlanName</span>
<span class="comment-line">#              on a DUT by $cost.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  DUT, vlanName, cost</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#            IncreaseLinkCost &#34;DUT1&#34; &#34;vlan1_2_3&#34; $cost</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::IncreaseLinkCost_1523">proc <a href="Ospf.tcl-annot.html#::::IncreaseLinkCost">::::IncreaseLinkCost</a></a></strong> {DUT vlanName {cost &#34;10&#34;} } {

lappend parameterList &#34;Cost: 1&#34;
set currentCostField [<a name="::GetKeyValue(5)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show ospf interfaces $vlanName&#34; $parameterList]
unset parameterList
scan $currentCostField {%d} currentCost
set newCost [expr $currentCost + $cost]
<a name="::SendACmd(81)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>	&#34;config ospf $vlanName cost $newCost&#34;

lappend parameterList &#34;Cost: $newCost/C&#34;
<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show ospf interfaces $vlanName&#34; $parameterList
unset parameterList
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: GetDesiredPktType</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: This proc is used to return the packets from rawPktList that match pktType,</span>
<span class="comment-line">#              srcIp and destIp</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  rawPktList, pktType, srcIp, dstIp</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return vlaue: Integer or &#34;&#34; on error</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#  set OSPFHelloPackets [GetDesiredPktType $rawPortDataList IP_OSPFv2_HELLO $DUT1vlan1_3IP $ripMultiCastAddress]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetDesiredPktType_1555">proc <a href="Ospf.tcl-annot.html#::::GetDesiredPktType">::::GetDesiredPktType</a></a></strong> {rawPktList pktType srcIp dstIp} {

   set desiredPkts &#34;&#34;
   set prevPktFragFlag 0
   for {set i 0} {$i &lt; [llength $rawPktList]} {incr i} {
      set dataFrame [lindex $rawPktList $i]
      set messageType [<a name="::GetMessageType(6)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $dataFrame]
      set dstinationIp [<a name="::GetDestIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $dataFrame]
      set sourceIp [<a name="::GetSourceIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $dataFrame]
      <span class="comment-line"># Capture the packets from DUT1 to DRouters</span>
<span class="comment-line">#      result_debug &#34;the sourceIp $sourceIp,dstinationIp $dstinationIp,messageType $messageType&#34;</span>
      if {($messageType==$pktType)&amp;&amp;($sourceIp==$srcIp)&amp;&amp;($dstinationIp==$dstIp)} {
         lappend desiredPkts $dataFrame
<span class="comment-line">#	 result_debug &#34;dataFrame = $dataFrame&#34;</span>
      }
      set prevPktFragFlag [<a name="::GetIPFragmentFlags(1)"><a href="./MessageDecoding.tcl.html#::GetIPFragmentFlags_513">::GetIPFragmentFlags</a></a> $dataFrame]
   }
   return $desiredPkts
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: VerifyRxmtInterval</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: This proc is used to verify retransmit interval in time stamped packets</span>
<span class="comment-line">#              for $interval seconds. A tolerance is accepted in percentage by default 1%.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  timeStampList, interval, tolerance</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: 0 on error only</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              VerifyRxmtInterval $DD1TimeStamp</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::VerifyRxmtInterval_1593">proc <a href="Ospf.tcl-annot.html#::::VerifyRxmtInterval">::::VerifyRxmtInterval</a></a></strong> {timeStampList {interval 5} {tolerance 1}} {
   set subTest &#34;Verify if the Rxmt interval is $interval secs.&#34;
   <a name="::report_start_test(11)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;
   
   <span class="comment-line"># Check for error</span>
   if {[llength $timeStampList]&lt;2} {
      <a name="::result_error(15)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Insufficient information in timestamp list, FAIL&#34;
      <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      
      return 0
   }
   
   for {set i 0} {$i &lt; [expr [llength $timeStampList]-1]} {incr i} {
      set secondTimeStamp [lindex $timeStampList [expr $i + 1]]
      set firstTimeStamp [lindex $timeStampList $i]
      
      <span class="comment-line"># Store in mili seconds</span>
<span class="comment-line">#      set secTimeStamp [string range $secondTimeStamp 0 8]</span>
<span class="comment-line">#      set firTimeStamp [string range $firstTimeStamp 0 8]</span>
      
      <span class="comment-line">#result_debug &#34;the firTimeStamp:$firTimeStamp, secTimeStamp:$secTimeStamp&#34;</span>
      set intervalInSe [mpexpr $secondTimeStamp-$firstTimeStamp]
      set intervalInSec [mpexpr $intervalInSe/1000000000.0]
      set diff [expr abs(double($intervalInSec) - double($interval))]
      set percent [expr double($diff)/ double($interval)*100.0]
      <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The interval=$intervalInSec, percent=$percent and diff:$diff&#34;
      <span class="comment-line"># Count for a percentage of 1 tolerance</span>
      if {$percent &lt;= $tolerance} {
         set result &#34;ok&#34;
      } else {
         set wrongInterval $intervalInSec
         set result &#34;ng&#34;
      }
   }

   if {$result == &#34;ok&#34;} {
      <a name="::result_ok(12)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Packets correctly spaced with $intervalInSec secs, PASS&#34;
   } else {
      <a name="::result_error(16)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Packets incorrectly spaced with $wrongInterval secs, FAIL&#34;
   }
   <a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: setupOSPFRouter</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: This proc is used to setup ixia port as a ospf router. It can create multiple interfaces</span>
<span class="comment-line">#              supplied via interfaceIpList</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: -1 on error only</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#setupOSPFRouter -dutIp &#34;62.1.0.109&#34; -interfaceIpList &#34;62.1.0.23&#34; -maskList &#34;255.255.255.0&#34; -areaIdList &#34;0&#34; -helloIntervalList &#34;10&#34; \</span>
<span class="comment-line">#                -deadIntervalList &#34;40&#34; -networkTypeList &#34;ospfBroadcast&#34; -metricList &#34;10&#34; -mtuSizeList 1500 \</span>
<span class="comment-line">#                -linkTypeList &#34;ospfLinkTransit&#34; -numNetworksList 10000 -prefixList &#34;30&#34; -routeOriginList &#34;ospfRouteOriginArea&#34; \</span>
<span class="comment-line">#                -networkIpList &#34;37.0.0.0&#34; -routerIdList &#34;62.1.0.23&#34; -txPortId 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::setupOSPFRouter_1657">proc <a href="Ospf.tcl-annot.html#::::setupOSPFRouter">::::setupOSPFRouter</a></a></strong> {args} {
   global TrafficGen
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupOSPFRouter $args {
        dutIp &#34;&#34;
        interfaceMacList &#34;&#34;
        interfaceIpList &#34;&#34;
        maskList &#34;255.255.255.0&#34;
        areaIdList &#34;0&#34;
        helloIntervalList &#34;10&#34;
        deadIntervalList &#34;40&#34;
        networkTypeList &#34;ospfBroadcast&#34;
        metricList &#34;10&#34;
        mtuSizeList &#34;1500&#34;
        linkTypeList &#34;ospfLinkTransit&#34;
        numNetworksList &#34;0&#34;
        prefixList &#34;&#34;
        routeOriginList &#34;ospfRouteOriginArea&#34;
        networkIpList &#34;&#34;
        routeMetricList &#34;10&#34;
        routerIdList &#34;&#34;
        txPortId  &#34;1&#34;
        tag &#34;none&#34;
        trafficEng &#34;false&#34;
        routerPrioirty &#34;0&#34;
    }
    
   
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
         
    <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
    <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupOSPFRouter: Chas: $cha Card: $car Port: $por&#34;
    
    <span class="comment-line"># select the port</span>
    ipAddressTable clear
    ipAddressTable setDefault
    ipAddressTable config -defaultGateway $dutIp
    ipAddressTableItem setDefault
    ipAddressTableItem config -fromIpAddress [lindex $interfaceIpList 0]
    if {[llength $interfaceMacList] &gt; 0} {
        set macAddr [lindex $interfaceMacList 0]
        if {$macAddr == &#34;default&#34;} {
            if {[<a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $cha $car $por]} {
                error &#34;setupOSPFRouter: port get $chas $card $port failed.&#34;
            }
            set macAddr [<a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]
        }
    } else {
        set macAddr [<a name="::uniqMac(1)"><a href="./bgp.tcl.html#::uniqMac_1832">::uniqMac</a></a> $cha $car $por]
    }
    ipAddressTableItem config -fromMacAddress $macAddr
    ipAddressTableItem config -numAddresses 1
    ipAddressTableItem config -mappingOption oneIpToOneMac
    ipAddressTableItem config -enableUseNetwork true
    ipAddressTableItem config -netMask 24
    if {$tag != &#34;none&#34;} {
       ipAddressTableItem config -enableVlan true
       ipAddressTableItem config -vlanId $tag
    }
    ipAddressTableItem set               
    ipAddressTable addItem
    ipAddressTable set $cha $car $por
    
    if {[ospfServer select $cha $car $por]} {
        error &#34;setupOSPFRouter: ospfServer select $cha $car $por failed.&#34;
    }
    if {[ospfServer clearAllRouters]} {
        error &#34;setupOSPFRouter: ospfServer clearAllRouters failed.&#34;
    }

    for {set i 0} {$i&lt;[llength $interfaceIpList]} {incr i} {
        set interfaceIp [lindex $interfaceIpList $i]
        set mask [lindex $maskList $i]
        set areaId [lindex $areaIdList $i]
        set helloInterval [lindex $helloIntervalList $i]
        set deadInterval [lindex $deadIntervalList $i]
        set networkType [lindex $networkTypeList $i]
        set metric [lindex $metricList $i]
        set mtuSize [lindex $mtuSizeList $i]
        set linkType [lindex $linkTypeList $i]
        set numNetworks [lindex $numNetworksList $i]
        set prefix [lindex $prefixList $i]
        set routeOrigin [lindex $routeOriginList $i]
        set networkIp [lindex $networkIpList $i]
        set routeMetric [lindex $routeMetricList $i]
        set routerId [lindex $routerIdList $i]
        
        set returnCode [<a name="::extrMakeOspfRouter(1)"><a href="./Ospf.tcl.html#::extrMakeOspfRouter_2162">::extrMakeOspfRouter</a></a> -interfaceIp $interfaceIp -ipMask $mask \
                                           -areaId $areaId -helloInterval $helloInterval \
                                           -deadInterval $deadInterval \
                                           -networkType $networkType -metric $metric \
                                           -linkType $linkType -mtuSize $mtuSize \
                                           -numNetworks $numNetworks -prefix $prefix \
                                           -routeOrigin $routeOrigin \
                                           -networkIp $networkIp \
                                           -routeMetric $routeMetric -routerId $routerId \
                                           -txPortId $txPortId -trafEng $trafficEng]
        if {$returnCode==-1} {
            return -1
        }
    }
    
    protocolServer setDefault
    protocolServer config -enableArpResponse true
    protocolServer config -enablePingResponse true
    protocolServer config -enableOspfService true
    if {[protocolServer set $cha $car $por]} {
        error &#34;setupOSPFRouter: protocolServer set $cha $car $por failed.&#34;
    }
    
    set portList [list [list $cha $car $por]]   
    <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Writing Configuration to Hardware...&#34;
    if {[<a name="::ixWriteConfigToHardware(1)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList]} {
        <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error writing config to hardware&#34;
    }
      }
      
      stc {
         
         set txPortId [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
         set txSpeed [<a name="::getPortSpeed(1)"><a href="./spirent.tcl.html#::getPortSpeed_3479">::getPortSpeed</a></a> $txPortId]
         set txMedia [<a name="::stcGetMedia(1)"><a href="./spirent.tcl.html#::stcGetMedia_238">::stcGetMedia</a></a> $txPortId]
         <a name="::cleanupBgp(1)"><a href="./bgp.tcl.html#::cleanupBgp_161">::cleanupBgp</a></a>	$txPortId
         if {$mtuSizeList != &#34;&#34;} {
            <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;OSPF multi MTU not supported&#34;
            <a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform SetupPortsCommand -PortList $txPortId -Mtu [lindex $mtuSizeList 0] -Media $txMedia
         }
         for {set i 0} {$i&lt;[llength $interfaceIpList]} {incr i} {
            set j 0 ; <span class="comment-line"># for tracking lsa ids</span>
            set interfaceIp [lindex $interfaceIpList $i]
            set mask [<a name="::getIpV4MaskWidth2(1)"><a href="./spirent.tcl.html#::getIpV4MaskWidth2_381">::getIpV4MaskWidth2</a></a> [lindex $maskList $i]]
            set areaId [<a name="::long2IpAddr(1)"><a href="./ePTUtils.tcl.html#::long2IpAddr_144">::long2IpAddr</a></a> [lindex $areaIdList $i]]
            set helloInterval [lindex $helloIntervalList $i]
            set deadInterval [lindex $deadIntervalList $i]
            set networkType [lindex $networkTypeList $i]
            set metric [lindex $metricList $i]
            set mtuSize [lindex $mtuSizeList $i]
            set linkType [lindex $linkTypeList $i]
            set numNetworks [lindex $numNetworksList $i]
            set prefix [lindex $prefixList $i]
            set routeOrigin [lindex $routeOriginList $i]
            set networkIp [lindex $networkIpList $i]
            set routeMetric [lindex $routeMetricList $i]
            set routerId [lindex $routerIdList $i]
            
            if {$tag == &#34;none&#34;} {
               array set cmdResults [<a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv4If EthIIIf&#34; -IfCount &#34;1 1&#34; -active false]
               set deviceHndl $cmdResults(-ReturnList)
            } else {
               array set cmdResults [<a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv4If VlanIf EthIIIf&#34; -IfCount &#34;1 1 1&#34; -active false]
               set deviceHndl $cmdResults(-ReturnList)
               <a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] -VlanId $tag 
            }
            <a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $deviceHndl -RouterId $routerId
            <a name="::logcmd(9)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(10)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] -Address $interfaceIp -Gateway $dutIp -PrefixLength $mask
            
            if {$networkType == &#34;ospfBroadcast&#34;} {
               set networkType BROADCAST
            }
            
            set ospfAttributes &#34;-under $deviceHndl -RouterPriority $routerPrioirty -TeInfoPresent $trafficEng -LsaRefreshInterval 10&#34;
            if {$areaId != &#34;&#34;} {
               append ospfAttributes &#34; -AreaId [<a name="::int2ip(1)"><a href="./spirent.tcl.html#::int2ip_3424">::int2ip</a></a> $areaId]&#34;
            }
            if {$helloInterval != &#34;&#34;} {
               append ospfAttributes &#34; -HelloInterval $helloInterval&#34;
            }
            if {$deadInterval != &#34;&#34;} {
               append ospfAttributes &#34; -RouterDeadInterval $deadInterval&#34;					
            }
            if {$networkType != &#34;&#34;} {
               append ospfAttributes &#34; -NetworkType $networkType&#34;					
            }
            if {$metric != &#34;&#34;} {
               if {[llength $metric] &gt; 1} {set tmetric [lindex $metric 0]} else {set tmetric $metric}
               if {$tmetric &lt; 1} {set tmetric 1}
               append ospfAttributes &#34; -IfCost $tmetric&#34;					
            }
            
            set ospfRouterConfig [eval &#34;logcmd stc::create Ospfv2RouterConfig [subst $ospfAttributes]&#34;]
                        
            set routerLsaAttrs &#34;-AdvertisingRouterId $routerId&#34; ;<span class="comment-line"># -LinkStateId $routerId</span>
            
            switch [lindex [lindex $routeOrigin 0] 0] {
               ospfRouteOriginExternalType2 -
               ospfRouteOriginExternal { append routerLsaAttrs &#34; -Asbr TRUE&#34; } 
               ospfRouteOriginArea { append routerLsaAttrs &#34; -Abr TRUE&#34; }
               default { error &#34;Unsupported OSPF Route Origin : $routeOrigin&#34; }
            }
            
            set hRouterLsa [eval &#34;logcmd stc::create RouterLsa -under $ospfRouterConfig [subst $routerLsaAttrs]&#34;];<span class="comment-line"># -seqnum [expr ($i&lt;&lt;24) +$j]</span>
            incr j
            
            if {$linkType != &#34;&#34;} {
               <span class="comment-line"># get routerLSA</span>
               switch $linkType {
                  ospfLinkTransit { set linkType TRANSIT_NETWORK }
                  default { error &#34;did not understand OSPF Link Type : $linkType (should be POINT_TO_POINT, STUB_NETWORK, TRANSIT_NETWORK, or VL)&#34; }
               }
               <a name="::logcmd(11)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RouterLsaLink -under $hRouterLsa -LinkType $linkType
            }
            if {$trafficEng == &#34;true&#34;} {
               set hTeLsa [<a name="::logcmd(12)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create teLsa -under $ospfRouterConfig]
            }

            set idx 0
            while {[llength $networkIp] &gt; $idx} {
               set prefx [lindex $prefix $idx]
               set myIp [<a name="::cleanRoute(1)"><a href="./spirent.tcl.html#::cleanRoute_3436">::cleanRoute</a></a> [lindex $networkIp $idx] $prefx]
               if {[llength $metric] == [llength $networkIp]} { set rMetric [lindex $metric $idx] } else { set rMetric [lindex $routeMetric $idx] }
               set routeOrg [lindex $routeOrigin $idx]
               set noOfNetworks [lindex $numNetworks $idx]
               incr idx
               
               set ospfRouteAttrs &#34;-under $ospfRouterConfig&#34;;<span class="comment-line"># -seqnum [expr ($i&lt;&lt;24) +$j]&#34;</span>
               incr j
               if {$routerId != &#34;&#34;} {
                  append ospfRouteAttrs &#34; -AdvertisingRouterId $routerId&#34;
               }
               if {$rMetric != &#34;&#34;} {
                  append ospfRouteAttrs &#34; -Metric $rMetric&#34;
               }
               switch $routeOrg {
                  ospfRouteOriginExternal {
                     set ospfRoute [eval &#34;logcmd stc::create ExternalLsaBlock [subst $ospfRouteAttrs] -metrictype type1&#34;]
                  }
                  
                  ospfRouteOriginArea {
                     set ospfRoute [eval &#34;logcmd stc::create SummaryLsaBlock [subst $ospfRouteAttrs]&#34;]
                  }
                  
                  ospfRouteOriginExternalType2 {
                     set ospfRoute [eval &#34;logcmd stc::create ExternalLsaBlock [subst $ospfRouteAttrs] -metrictype type2&#34;]
                  }
                  default { error &#34;Unsupported OSPF Route Origin : $routeOrigin&#34; }
               }
               <a name="::logcmd(13)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(14)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ospfRoute -children-Ipv4NetworkBlock] -NetworkCount $noOfNetworks \
                  -StartIpList [<a name="::cleanRoute(2)"><a href="./spirent.tcl.html#::cleanRoute_3436">::cleanRoute</a></a> $myIp $prefx] -PrefixLength $prefx
            }
         }
      }
   }
} ;<span class="comment-line"># setupOSPFRouter</span>

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: startOspf</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: This proc is used to start test equipment ospf protocol adjacency</span>
<span class="comment-line">#              on the list of ports supplied via txPortIdList</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  txPortIdList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      startOspf 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::startOspf_1921">proc <a href="Ospf.tcl-annot.html#::::startOspf">::::startOspf</a></a></strong> {txPortIdList} {
    set pList &#34;&#34;
   
   global TrafficGen STARTOSPF
   
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
         
    foreach txPortId $txPortIdList {
	<a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startOspf: Chas: $cha Card: $car Port: $por&#34;
        lappend pList &#34;$cha $car $por&#34;
    }

    if {[ixStartOspf pList]} {
        error &#34;startOspf: ixStartOspf failed.&#34;
    }
}
      stc {
         set globalDeviceList &#34;&#34;
         foreach txPortId $txPortIdList {
            if {[info exists STARTOSPF($txPortId)] &amp;&amp; $STARTOSPF($txPortId)} {
                continue;
            }
            set STARTOSPF($txPortId) 1
            set txPortId [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            set deviceList [<a name="::logcmd(15)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
            <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startOSPF: Device List - $deviceList&#34;
            set globalDeviceList [concat $globalDeviceList $deviceList]
            <a name="::logcmd(16)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStartCommand -DeviceList $globalDeviceList
<span class="comment-line">#             set timeout1 [expr [clock seconds] + 60]</span>
<span class="comment-line">#             set timeout2 [expr [clock seconds] + 120]</span>
<span class="comment-line">#             foreach dev $deviceList {</span>
<span class="comment-line">#                set rtr [logcmd stc::get $dev -children-ospfv2routerconfig]</span>
<span class="comment-line">#                while 1 {</span>
<span class="comment-line">#                   puts &#34;WAITING 10 sec&#34;</span>
<span class="comment-line">#                   after 10000</span>
<span class="comment-line">#                   if {[logcmd stc::get $rtr -NeighborState] != &#34;FULL&#34;} {</span>
<span class="comment-line">#                      puts &#34;DOWN&#34;</span>
<span class="comment-line">#                     # logcmd stc::perform Ospfv2RestartRouterCommand -RouterList $dev</span>
<span class="comment-line">#                   } else {</span>
<span class="comment-line">#                      puts &#34;UP - exiting&#34;</span>
<span class="comment-line">#                      break</span>
<span class="comment-line">#                   }</span>
<span class="comment-line">#                   if {[clock seconds] &gt; $timeout1} { </span>
<span class="comment-line">#                      puts &#34;60 SEC TIMEOUT STOPPING and STARTING DEV&#34; </span>
<span class="comment-line">#                      logcmd stc::perform DeviceStopCommand $dev</span>
<span class="comment-line">#                      after 10000</span>
<span class="comment-line">#                      logcmd stc::perform DeviceStartCommand $dev</span>
<span class="comment-line">#                      set timeout1 [expr $timeout2+60]</span>
<span class="comment-line">#                   }</span>
<span class="comment-line">#                   if {[clock seconds] &gt; $timeout2} { break }</span>
<span class="comment-line">#                }</span>
<span class="comment-line">#             }</span>
<span class="comment-line"># #            result_debug &#34;READVERTISING LSAs&#34;</span>
<span class="comment-line">#             # logcmd stc::perform Ospfv2ReadvertiseLsaCommand -RouterList $deviceList</span>
         }
      }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: stopOspf</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: This proc is used to stop test equipment ospf protocol adjacency</span>
<span class="comment-line">#              on the list of ports supplied via txPortIdList</span>
<span class="comment-line">#              This proc is opposite of startOspf</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  txPortIdList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      stopOspf 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::stopOspf_2002">proc <a href="Ospf.tcl-annot.html#::::stopOspf">::::stopOspf</a></a></strong> {txPortIdList} {
    set pList &#34;&#34;
   
   set pList &#34;&#34;
   
   global TrafficGen
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
         
    foreach txPortId $txPortIdList {	
	<a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopOspf: Chas: $cha Card: $car Port: $por&#34;
        lappend pList &#34;$cha $car $por&#34;
    }

    if {[ixStopOspf pList]} {
        error &#34;stopOspf: ixStopOspf failed.&#34;
    }
}
      stc {
         foreach txPortId $txPortIdList {
            set STARTOSPF($txPortId) 0
            set txPortId [<a name="::hMapPortIdToSpirentPort(3)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            foreach emulatedDevice [set DeviceList [<a name="::logcmd(17)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]] {
               foreach {lsatype cmd} {summarylsablock Ospfv2AgeSummaryLsaCommand \
                                      routerlsa Ospfv2AgeRouterLsaCommand \
                                     ExternalLsaBlock Ospfv2AgeExternalLsaCommand} {
                  set rtrcfg [<a name="::logcmd(18)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-ospfv2routerconfig]
                  if {$rtrcfg == &#34;&#34;} {continue;}
                  if {[llength [set lsalist [<a name="::logcmd(19)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $rtrcfg -children-$lsatype]]] &gt; 0} {
                     puts &#34;AGING LSAs&#34;
                     <a name="::logcmd(20)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform $cmd -LsaList $lsalist
                  }
               }
               <a name="::logcmd(21)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
              <span class="comment-line"># after 10000</span>
               <a name="::logcmd(22)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform Ospfv2ShutdownRouterCommand -RouterList $emulatedDevice
            }
         }
<span class="comment-line">#          puts &#34;WAITING 30 SEC&#34;</span>
<span class="comment-line">#          after 30000</span>
      }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cleanupOspf</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: This proc is used to cleanup test equipment port for ospf configuration</span>
<span class="comment-line">#              that was performed by setupOSPFRouter</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  txPortIdList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      cleanupOspf 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cleanupOspf_2066">proc <a href="Ospf.tcl-annot.html#::::cleanupOspf">::::cleanupOspf</a></a></strong> {txPortIdList} {
   
   global TrafficGen
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
         
    foreach txPortId $txPortIdList {    
        <span class="comment-line"># get the port information</span>
        <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
        <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cleanupOspf: Chas: $cha Card: $car Port: $por&#34;
        
        <span class="comment-line"># select the port</span>
        if {[ospfServer select $cha $car $por]} {
            error &#34;cleanupOspf: ospfServer select $cha $car $por failed.&#34;
        }
        
        if {[ospfServer getRouter router1]} {
            error &#34;cleanupOspf: ospfServer getRouter router1 failed.&#34;
        }
        
        ospfRouter clearAllInterfaces
        ospfRouter clearAllLsaGroups
        ospfRouter clearAllRouteRanges
        ospfRouter setDefault
        
        if {[ospfServer clearAllRouters]} {
            error &#34;cleanupOspf: ospfServer clearAllRouters failed.&#34;
        }
        ospfServer write
        
        ipAddressTable setDefault
        ipAddressTable clear
        ipAddressTable set $cha $car $por

        protocolServer setDefault
        protocolServer config -enableArpResponse false
        protocolServer config -enablePingResponse false
        protocolServer config -enableOspfService false
        if {[protocolServer set $cha $car $por]} {
            error &#34;cleanupOspf: Error Setting Protocol Server&#34;
        }
        if {[protocolServer write $cha $car $por]} {
            error &#34;cleanupOspf: protocolServer write $cha $car $por failed.&#34;
        }
    } ;<span class="comment-line"># foreach txPortId</span>
      }
      stc {
         foreach txPortId $txPortIdList {
            set txPortId [<a name="::hMapPortIdToSpirentPort(4)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            foreach emulatedDevice [<a name="::logcmd(23)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources] {
               set ipv4If [<a name="::logcmd(24)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-Ipv4If]
               if {$ipv4If != &#34;&#34;} {                 
                  foreach {lsatype} {summarylsablock routerlsa ExternalLsaBlock} {
                     if {[llength [set lsalist [<a name="::logcmd(25)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::logcmd(26)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-ospfv2routerconfig] -children-$lsatype]]] &gt; 0} {
<span class="comment-line">#                        logcmd stc::perform $cmd -LsaList $lsalist</span>
<span class="comment-line">#                        logcmd stc::apply</span>
puts &#34;DELETING LSAS&#34;
                        foreach lsa $lsalist {
                           <a name="::logcmd(27)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $lsa
                        }
                     }
                  }
               }
            }
         }
         <a name="::logcmd(28)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
         after 2000
puts &#34;DELETING ROUTER&#34;
         <a name="::cleanupBgp(2)"><a href="./bgp.tcl.html#::cleanupBgp_161">::cleanupBgp</a></a>	$txPortIdList
      }
   }
} ;<span class="comment-line"># cleanupOspf</span>


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: extrMakeOspfRouter</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: This internal proc is used to setup test equipment port for ospf configuration</span>
<span class="comment-line">#              This is called within from setupOSPFRouter.</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: 0</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      set returnCode [extrMakeOspfRouter -interfaceIp $interfaceIp -ipMask $mask -areaId $areaId \</span>
<span class="comment-line">#          -helloInterval $helloInterval -deadInterval $deadInterval \</span>
<span class="comment-line">#          -networkType $networkType -metric $metric -linkType $linkType -mtuSize $mtuSize -numNetworks $numNetworks \</span>
<span class="comment-line">#          -prefix $prefix -routeOrigin $routeOrigin -networkIp $networkIp -routerId $routerId -txPortId $txPortId]</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::extrMakeOspfRouter_2162">proc <a href="Ospf.tcl-annot.html#::::extrMakeOspfRouter">::::extrMakeOspfRouter</a></a></strong> {args} {
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> extrMakeOspfRouter $args {
        interfaceIp &#34;&#34;
        ipMask &#34;&#34;
        areaId 0
        helloInterval 10
        deadInterval 40
        networkType &#34;ospfBroadcast&#34;
        metric 10
        routeMetric 10
        linkType &#34;ospfLinkTransit&#34;
        mtuSize &#34;1500&#34;
        numNetworks 0
        prefix &#34;&#34;
        routeOrigin &#34;ospfRouteOriginArea&#34;
        networkIp &#34;&#34;
        routerId &#34;&#34;
        txPortId  &#34;1&#34;
        trafEng   &#34;false&#34;
    }
    
    ospfRouter setDefault
    ospfRouter clearAllInterfaces
    ospfRouter clearAllRouteRanges
    ospfRouter config -enable true
    ospfRouter config -routerId $routerId
    
    ospfInterface setDefault
    ospfInterface config -enable true
    ospfInterface config -connectToDut true
    ospfInterface config -ipAddress $interfaceIp
    ospfInterface config -ipMask $ipMask
    ospfInterface config -areaId $areaId
    ospfInterface config -priority 0
    ospfInterface config -options 2
    ospfInterface config -helloInterval $helloInterval
    ospfInterface config -deadInterval $deadInterval
    ospfInterface config -networkType $networkType
    ospfInterface config -metric $metric
    ospfInterface config -numberOfLearnedLsas 0
    ospfInterface config -enableTrafficEngineering $trafEng
    ospfInterface config -maxBandwidth 0.0
    ospfInterface config -maxReservableBandwidth 0.0
    ospfInterface config -linkMetric 0
    ospfInterface config -unreservedBandwidthPriority0 0.0
    ospfInterface config -unreservedBandwidthPriority1 0.0
    ospfInterface config -unreservedBandwidthPriority2 0.0
    ospfInterface config -unreservedBandwidthPriority3 0.0
    ospfInterface config -unreservedBandwidthPriority4 0.0
    ospfInterface config -unreservedBandwidthPriority5 0.0
    ospfInterface config -unreservedBandwidthPriority6 0.0
    ospfInterface config -unreservedBandwidthPriority7 0.0
    ospfInterface config -linkType $linkType   
    ospfInterface config -neighborRouterId 0.0.0.0
    ospfInterface config -mtuSize $mtuSize
    ospfInterface config -enableValidateMtu true
    if {[ospfRouter addInterface interface1]} {
        error &#34;extrMakeOspfRouter: ospfRouter addInterface interface1 failed.&#34;
    }

    set idx 0
    set rangeId 1
    while {[llength $networkIp] &gt; $idx} {
    set myIp [lindex $networkIp $idx]
    set rMetric [lindex $routeMetric $idx]
    set prefx [lindex $prefix $idx]
    set routeOrg [lindex $routeOrigin $idx]
    set noOfNetworks [lindex $numNetworks $idx]
    incr idx
    ospfRouteRange setDefault
    ospfRouteRange config -enable true
    ospfRouteRange config -routeOrigin $routeOrg
    ospfRouteRange config -metric $rMetric
    ospfRouteRange config -numberOfNetworks $noOfNetworks
    ospfRouteRange config -prefix $prefx
    ospfRouteRange config -networkIpAddress $myIp

    ospfRouter addRouteRange [format &#34;routeRange%02d&#34; $rangeId]
    ospfRouteRange setDefault
    incr rangeId
}

<span class="comment-line">#    if {[ospfRouter addRouteRange routeRange1]} {</span>
<span class="comment-line">#        error &#34;extrMakeOspfRouter: ospfRouter addRouteRange routeRange1 failed.&#34;</span>
<span class="comment-line">#    }</span>
    if {[ospfServer addRouter router1]} {
        error &#34;extrMakeOspfRouter: ospfServer addRouter router1 failed.&#34;
    }
    
    return 0
} ;<span class="comment-line"># extrMakeOspfRouter</span>

<strong><a name="::::GetOspfLinkCost_2254">proc <a href="Ospf.tcl-annot.html#::::GetOspfLinkCost">::::GetOspfLinkCost</a></a></strong> {vlanName} {

   lappend parameterList &#34;Cost: 1&#34;
   set currentCostField [<a name="::GetKeyValue(6)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show ospf interface $vlanName&#34; $parameterList]
   unset parameterList
   scan $currentCostField {%d} currentCost
   return $currentCost
}

<strong><a name="::::Setup14.13.4.1_2263">proc <a href="Ospf.tcl-annot.html#::::Setup14.13.4.1">::::Setup14.13.4.1</a></a></strong> {} {

global DUT1_CONNECT
global DUT2_CONNECT
global DUT3_CONNECT
global DUT4_CONNECT

<a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<a name="::SendACmd(82)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config ospf routerid 4.0.0.1&#34;
set DUT1vlan1IP 1.0.0.1
set portList [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2]
<a name="::SetupSingleOSPFVlan(1)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT1vlan1IP 0.0.0.0 $portList 1 &#34;vlan12&#34;
<a name="::SendACmd(83)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create ospf area 0.0.0.4&#34;

<span class="comment-line">#set DUT3vlan1IP 2.0.0.3</span>
set DUT1vlan4IP 4.0.0.1 ;<span class="comment-line">#101.0.0.1</span>
set portList [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 4]
<a name="::SetupSingleOSPFVlan(2)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT1vlan4IP 0.0.0.4 $portList 1 &#34;vlan14&#34;
<span class="comment-line">#SendACmd &#34;configure ospf vlan vlan23 neighbor add $DUT3vlan1IP&#34;</span>

<a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT
set DUT2vlan1IP 1.0.0.2
set portList [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 1]
<a name="::SetupSingleOSPFVlan(3)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT2vlan1IP 0.0.0.0 $portList 2 &#34;vlan12&#34;

set DUT2vlan2IP 2.0.0.2
set portList [<a name="::::GetATrunkPort(5)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 2 3]
<a name="::SetupSingleOSPFVlan(4)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT2vlan2IP 0.0.0.0 $portList 2 &#34;vlan23&#34;

<a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT3_CONNECT

<span class="comment-line">#SendACmd &#34;config ospf routerid 101.0.0.113&#34;</span>
<a name="::SendACmd(84)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config ospf routerid 3.0.0.3&#34;
set DUT3vlan1IP 2.0.0.3
set portList [<a name="::::GetATrunkPort(6)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 2]
<a name="::SetupSingleOSPFVlan(5)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT3vlan1IP 0.0.0.0 $portList 3 &#34;vlan23&#34;

set DUT3vlan2IP 3.0.0.3 ;<span class="comment-line">#101.0.0.113</span>
set portList [<a name="::::GetATrunkPort(7)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 3 4]
<a name="::SetupSingleOSPFVlan(6)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT3vlan2IP 0.0.0.4 $portList 3 &#34;vlan34&#34;
<span class="comment-line">#SendACmd &#34;configure ospf vlan vlan12 neighbor add $DUT1vlan1IP&#34;</span>


<a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT4_CONNECT
set DUT4vlan1IP 4.0.0.4
set portList [<a name="::::GetATrunkPort(8)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 4 1]
<a name="::SetupSingleOSPFVlan(7)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT4vlan1IP 0.0.0.4 $portList 4 &#34;vlan14&#34;

set DUT4vlan2IP 3.0.0.4
set portList [<a name="::::GetATrunkPort(9)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 4 3]
<a name="::SetupSingleOSPFVlan(8)"><a href="./Ospf.tcl.html#::SetupSingleOSPFVlan_1182">::SetupSingleOSPFVlan</a></a> $DUT4vlan2IP 0.0.0.4 $portList 4 &#34;vlan34&#34;

<a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT4_CONNECT
<a name="::SendACmd(85)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
<a name="::SendACmd(86)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;config ospf area 0.0.0.4 nssa summary stub-default-cost 10&#34;
<a name="::SendACmd(87)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
<a name="::Login(12)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
<a name="::SendACmd(88)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
<a name="::SendACmd(89)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;config ospf area 0.0.0.4 nssa summary stub-default-cost 10&#34;
<a name="::SendACmd(90)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
<span class="comment-line">#Login $DUT2_CONNECT</span>
<span class="comment-line">#SendACmd &#34;disable ospf&#34;</span>
<span class="comment-line">#SendACmd        &#34;config ospf area 0.0.0.0 nssa summary stub-default-cost 10&#34;</span>
<span class="comment-line">#SendACmd &#34;enable ospf&#34;</span>
<a name="::Login(13)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT3_CONNECT
<a name="::SendACmd(91)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
<a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5 ;<span class="comment-line">#Added sleep ...</span>
<a name="::SendACmd(92)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;config ospf area 0.0.0.4 nssa summary stub-default-cost 10&#34;
<a name="::SendACmd(93)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable ospf&#34;
}


<strong><a name="::::Cleanup14.13.4.1_2335">proc <a href="Ospf.tcl-annot.html#::::Cleanup14.13.4.1">::::Cleanup14.13.4.1</a></a></strong> {} {
   global DUT1_CONNECT
   global DUT2_CONNECT
   global DUT3_CONNECT
   global DUT4_CONNECT

   <a name="::Login(14)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
   <a name="::SendACmd(94)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
   <a name="::SendACmd(95)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan vlan12&#34;	   
   foreach vlan  {vlan12 vlan14} {
      <a name="::SendACmd(96)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $vlan&#34;
   }
   <a name="::SendACmd(97)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ospf area all&#34;
   <a name="::SendACmd(98)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config ospf routerid automatic&#34;

   <a name="::Login(15)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT2_CONNECT
   <a name="::SendACmd(99)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
   foreach vlan  {vlan12 vlan23} {
      <a name="::SendACmd(100)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $vlan&#34;
   }
   <a name="::SendACmd(101)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ospf area all&#34;

   <a name="::Login(16)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT3_CONNECT
   foreach vlan  {vlan23 vlan34} {
      <a name="::SendACmd(102)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $vlan&#34;
   }
   <a name="::SendACmd(103)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ospf area all&#34;
   <a name="::SendACmd(104)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
   <a name="::SendACmd(105)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config ospf routerid automatic&#34;

   <a name="::Login(17)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT4_CONNECT
   <a name="::SendACmd(106)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable ospf&#34;
   foreach vlan  {vlan34 vlan14} {
      <a name="::SendACmd(107)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan $vlan&#34;
   }
   <a name="::SendACmd(108)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete ospf area all&#34;
}

<strong><a name="::::VerifyEmptyDDPacket_2373">proc <a href="Ospf.tcl-annot.html#::::VerifyEmptyDDPacket">::::VerifyEmptyDDPacket</a></a></strong> {dataFrame sourceIp destinationIp} {
   upvar $sourceIp srcIp
   upvar $destinationIp dstIp

   set messageType [<a name="::GetMessageType(7)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $dataFrame]
   set result 0
   set srcIp &#34;&#34;
   set dstIp &#34;&#34;
   if {$messageType == &#34;IP_OSPFv2_DATABASE&#34;} {
         set macDest [<a name="::GetDestMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetDestMacAddress_19">::GetDestMacAddress</a></a> $dataFrame]
         set srcIp [<a name="::GetSourceIPAddress(2)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $dataFrame]
         set dstIp [<a name="::GetDestIPAddress(2)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $dataFrame]
         set length [<a name="::GetOSPFPacketLength(1)"><a href="./Ospf.tcl.html#::GetOSPFPacketLength_382">::GetOSPFPacketLength</a></a> $dataFrame]
         set controlBits [<a name="::GetOSPFControlBits(1)"><a href="./Ospf.tcl.html#::GetOSPFControlBits_411">::GetOSPFControlBits</a></a> $dataFrame]

         <span class="comment-line">#result_debug &#34;Get an $messageType from $srcIp to $dstIp with length $length and controlBits $controlBits&#34;</span>
         if {$length == 32 &amp;&amp; $controlBits == &#34;07&#34;} {
            set mac1 255
                 scan $macDest {%d.} mac1
                 if {$mac1 != 01} {
               <a name="::result_ok(13)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Empty DD packet is sent to unicast mac address $macDest&#34;
               set result 1
                 } else {
               <a name="::result_error(17)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Empty DD packet is sent to multicast mac address $macDest&#34;
                 }
            set ip1 255
                 scan $dstIp {%d.} ip1
                 if {$ip1 &lt; 224} {
               <a name="::result_ok(14)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Empty DD packet is sent to unicast ip address $dstIp&#34;
                 } else {
               <a name="::result_error(18)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Empty DD packet is sent to multicast ip address $dstIp&#34;
               set result 0
                 }
              }
           }
      return $result
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
