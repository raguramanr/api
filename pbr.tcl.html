<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>pbr.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#pbr.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>pbr.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="pbr.tcl-annot.html">annotations</a> | <a href="pbr.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::DisableDutSlot_2">proc <a href="pbr.tcl-annot.html#::::DisableDutSlot">::::DisableDutSlot</a></a></strong> {slotList DUTName} {
    global ${DUTName}_CONNECT;
    global DUTs_info;
    global bcmStackable

    <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];

<span class="comment-line">#For stackables, the 'slot' value is actually the port</span>
    if {[regexp -nocase &#34;$bcmStackable&#34; $DUTs_info($DUTName,platform)]} {
        foreach slot $slotList {
            <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable port $slot&#34;;
        }
    } else {
        foreach slot $slotList {
            <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable slot $slot&#34;;
        }
    }
}


<strong><a name="::::EnableDutSlot_22">proc <a href="pbr.tcl-annot.html#::::EnableDutSlot">::::EnableDutSlot</a></a></strong> {slotList DUTName {waitActive 1}} {
    global ${DUTName}_CONNECT;
    global DUTs_info;
    global bcmStackable

    <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];

    set dutSlotList &#34;&#34;

<span class="comment-line">#For stackables, the 'slot' value is actually the port</span>
    if {[regexp -nocase &#34;$bcmStackable&#34; $DUTs_info($DUTName,platform)]} {
        foreach slot $slotList {
            <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable port $slot&#34;;
        }
    } else {
        foreach slot $slotList {
            <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable slot $slot&#34;;
           <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleeping till Slot $slot becomes operational&#34;
           set Output &#34;&#34;
       lappend Output &#34;{Slot-$slot.*Operational} exist&#34;
       <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot&#34; $Output -time {s: 1 i: 5 d: 180 f: 180 r} -comment &#34;check show slot&#34;


        }
    }
}

<strong><a name="::::CheckNextGenPorts_49">proc <a href="pbr.tcl-annot.html#::::CheckNextGenPorts">::::CheckNextGenPorts</a></a></strong> {{dutNumber 1} {portNum 1}} {
global DUTs_info
global chassis
global DUT1_CONNECT
global bcmChassis
global FireboltPort
global HelixPort
set FireboltPort &#34;&#34;
set HelixPort &#34;&#34;
global bcmJaguar
global bcmx650
global bcmx480

<span class="comment-line">#Identify Firebolt Helix platforms</span>
<a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n\nPlatform Name $DUTs_info(DUT${dutNumber},platform)&#34;
if {[regexp -nocase $bcmJaguar $DUTs_info(DUT${dutNumber},platform)]} {
   if {[regexp -nocase &#34;a|c&#34; $DUTs_info(DUT${dutNumber},platform)]} {
      <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Firebolt port&#34;
      set FireBoltPort 1;
      return 2;
   } elseif {[regexp -nocase &#34;e&#34; $DUTs_info(DUT${dutNumber},platform)]} {
      <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Helix port&#34;
      set HelixPort 1; 
      return 1;  
   }
}

<span class="comment-line">#Identify Scorpian/Triumph/Apollo/Trident chipsets</span>
if {[regexp -nocase $bcmx650 $DUTs_info(DUT${dutNumber},platform)]} {
   <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Scorpian chipset&#34;
   return 3
}
if {[regexp -nocase $bcmx480 $DUTs_info(DUT${dutNumber},platform)]} {
   <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Triumph chipset&#34;
   return 4
}
if {[regexp -nocase &#34;460|400&#34; $DUTs_info(DUT${dutNumber},platform)]} {
   <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Apollo chipset&#34;
   return 5
}
if {[regexp -nocase &#34;670&#34; $DUTs_info(DUT${dutNumber},platform)]} {
   <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Trident chipset&#34;
   return 6
}
if {[regexp -nocase &#34;200&#34; $DUTs_info(DUT${dutNumber},platform)]} {
   <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Enduro chipset&#34;
   return 7
}
if {[regexp -nocase &#34;440&#34; $DUTs_info(DUT${dutNumber},platform)]} {
   <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Hurricane chipset&#34;
   return 8
}


<span class="comment-line">##check if it is Chasssis</span>

if [regexp -nocase &#34;$bcmChassis&#34; $DUTs_info(DUT${dutNumber},platform)] {
   <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Hit Chassis Port $portNum = [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portNum $dutNumber]&#34;
   set portID1Slot [lindex [split [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $portNum $dutNumber] :] 0];
   <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;port id slot $portID1Slot&#34;
   set slotType [lindex $DUTs_info(DUT1,hwList) [expr $portID1Slot - 1]]
   <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;HWList $DUTs_info(DUT1,hwList)&#34;
   <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Slot Type = $slotType&#34;
   if {[regexp -nocase &#34;a|c&#34; $slotType]} {
      <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Firebolt port&#34;
      set FireBoltPort 1;
      return 2;
   } elseif {[regexp -nocase &#34;e&#34; $slotType]} {
      <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Helix port&#34;
      set HelixPort 1;
      return 1;
   } elseif {[regexp -nocase &#34;650&#34; $slotType]} {
      <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Scorpian chipset&#34;
      return 3;
   } elseif {[regexp -nocase &#34;480&#34; $slotType]} {
      <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Triumph chipset&#34;
      return 4;
   } elseif {[regexp -nocase &#34;460|400&#34; $slotType]} {
      <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Apollo chipset&#34;
      return 5;
   } elseif {[regexp -nocase &#34;670&#34; $slotType]} {
      <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Trident chipset&#34;
      return 6;
   } else {
      <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Not a Helix or Firebolt port&#34;
      return 0    
  }
}

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: telnetFromDut</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to start  telnet session from the DUT</span>
<span class="comment-line">#       It assume that the current session is at the DUT prompt</span>
<span class="comment-line"># Input args:  ip  - ip to telnet to</span>
<span class="comment-line">#              vr  - vr to use</span>
<span class="comment-line">#              user</span>
<span class="comment-line">#              password</span>
<span class="comment-line">#              logout - logout: logout of the telnet session at the end</span>
<span class="comment-line">#                       nologout: don't logout. the DUT will be in the telnet</span>
<span class="comment-line">#                                 session after running this proc</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           telnetFromDut 20.20.20.2 VR-Default admin &#34;&#34;</span>
<span class="comment-line"># Category: Telnet</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::telnetFromDut_158">proc <a href="pbr.tcl-annot.html#::::telnetFromDut">::::telnetFromDut</a></a></strong> { <a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> vr user password {<a name="::logout(1)"><a href="./logout.tcl.html#::logout_21">::logout</a></a> logout} } {
   set passwordSent 0
   set timeout 10
   set loginSuccess 0
   exp_send &#34;telnet vr $vr $ip\r&#34;
   sleep 2
   for {set try 0} {$try &lt; 7 } {incr try} {
      expect {
          -re &#34;Please contact the administrator&#34; {
         <a name="::::result_debug_expect(1)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 5
        }
         -re &#34;Maximum number of login attempts reached!&#34; {
         <a name="::::result_debug_expect(2)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 4
        }

        &#34;closed by foreign host&#34; {
            <a name="::::result_debug_expect(3)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
            if {$passwordSent == 1} {
               return 0
            } else {
               <span class="comment-line">#if connection closed without sending password something's wrong</span>
               return &#34;error&#34;
            }
         }

         -re &#34;.*login:&#34; {
            exp_send &#34;$user\r&#34;
         }
         -re &#34;.*assword:&#34; {
            set passwordSent 1
            exp_send &#34;$password\r&#34;
         }
         -re &#34;save your config.*\[#&gt;]&#34; {
            <span class="comment-line">#see the banner and then system prompt. we are in.</span>
            <a name="::::result_debug_expect(4)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
            set loginSuccess 1
            break
         }
         timeout {
            expect *
            <a name="::::result_debug_expect(5)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
            return &#34;error&#34;
         }
      }
      <a name="::::result_debug_expect(6)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
   }

if { $loginSuccess != 1 } {
      return &#34;error&#34;
   }
   <span class="comment-line">#if caller specify nologout, don't logout</span>
   if { $logout != &#34;logout&#34; } {
      return 1
   }
   exp_send &#34;exit\r&#34;
   expect {
      -nocase &#34;y/n&#34; {
          <a name="::::result_debug_expect(7)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
          send &#34;n\r&#34;
      }
   }
   expect {
      &#34;Connection closed by foreign host&#34; {
         <a name="::::result_debug_expect(8)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 1
      }
      timeout {
         expect *
         <a name="::::result_debug_expect(9)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return error
      }
   }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
