<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>tracker.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#tracker.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>tracker.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="tracker.tcl-annot.html">annotations</a> | <a href="tracker.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
catch {package require mysqltcl}
<span class="comment-line">#################################################################################</span>
<span class="comment-line"># Procedure: _GetResultBuild</span>
<span class="comment-line"># </span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#################################################################################</span>
<strong><a name="::::_GetPostResultBuild_9">proc <a href="tracker.tcl-annot.html#::::_GetPostResultBuild">::::_GetPostResultBuild</a></a></strong><a name="::::_GetPostResultBuild"></a> {} {
    global MAIN DUTs_info

    if {[info exists DUTs_info(DUT1,imageBooted)] &amp;&amp; \
        [info exists DUTs_info(DUT1,priImage)] &amp;&amp; \
        [info exists DUTs_info(DUT1,secImage)]} {

        if {[regexp -nocase &#34;pri&#34; $DUTs_info(DUT1,imageBooted)]} {
            set MAIN(RESULTBUILD) $DUTs_info(DUT1,priImage)
        } else {
            set MAIN(RESULTBUILD) $DUTs_info(DUT1,secImage)
        }
    }

}
<span class="comment-line">###############################################################################</span>
<span class="comment-line"># Connect to tracker</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::tracker_db_connect_27">proc <a href="tracker.tcl-annot.html#::::tracker_db_connect">::::tracker_db_connect</a></a></strong><a name="::::tracker_db_connect"></a> {} {
    global mysqlstatus MAIN
    set user GHundertmark-RO
    set password GHundertmark-RO

    if {![info exists MAIN(USETRACKER)] || !$MAIN(USETRACKER)} {
        return &#34;fail&#34;;
    }

    if {[catch {mysqlconnect -host tracker -user $user -password $password -db tracker} handle]} {
        puts &#34;\nFAILED TO Connect to db -host tracker -user $user&#34;
        return &#34;fail&#34;
    }
    puts &#34;\nConnect to db -host tracker&#34;
    set MAIN(TRACKERHANDLE) $handle
    return $handle
}
<span class="comment-line">###############################################################################</span>
<span class="comment-line">#</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::close_mysql_handle_47">proc <a href="tracker.tcl-annot.html#::::close_mysql_handle">::::close_mysql_handle</a></a></strong><a name="::::close_mysql_handle"></a> {hdl} {
    global MAIN

    if {[regexp -nocase &#34;my&#34; $hdl]} {
        set MAIN(TRACKERHANDLE) &#34;null&#34;
        set MAIN(RESDBHANDLE)   &#34;null&#34;
        catch {mysqlclose $hdl} reason
    } 
}
<span class="comment-line">###############################################################################</span>
<span class="comment-line"># Get tracker bugNumber if exists grant</span>
<span class="comment-line">############################################################################### </span>
<strong><a name="::::tracker_get_bugnumber_59">proc <a href="tracker.tcl-annot.html#::::tracker_get_bugnumber">::::tracker_get_bugnumber</a></a></strong><a name="::::tracker_get_bugnumber"></a> {args} {
    global CRINFO MAIN
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> tracker_get_bugnumber $args {
        testcase  &#34;null&#34;
        testplan  &#34;null&#34;
        release   &#34;null&#34;
        filterout &#34;null&#34;
        handle    &#34;null&#34;
    }
    set myCRs &#34;&#34;
    set select_query &#34;SELECT DISTINCT BD.bugNumber, BD.globalState, BD.status, UAM.autoManual &#34;
    append select_query &#34;FROM bugDescriptions BD &#34;
    append select_query &#34;LEFT JOIN udfAutoManual UAM ON BD.bugNumber = UAM.bugNumber &#34;
    append select_query &#34;LEFT JOIN udfFeatures UF ON BD.bugNumber = UF.bugNumber &#34;
    append select_query &#34;LEFT JOIN udfTestCase UTC ON BD.bugNumber = UTC.bugNumber &#34;
    append select_query &#34;LEFT JOIN udfTestPlan UTP ON BD.bugNumber = UTP.bugNumber &#34;
    append select_query &#34;LEFT JOIN releaseTracking RT on BD.bugNumber = RT.bugNumber &#34;
    append select_query &#34;WHERE BD.productFamily = 'xos' &#34;
    append select_query &#34;AND RT.targetReleaseId = '$release' &#34;
    append select_query &#34;AND (UF.features = '$testplan' OR UF.features LIKE '% $testplan' OR &#34;
    append select_query &#34;UF.features LIKE '$testplan %' OR UF.features LIKE '% $testplan %' OR &#34;
    append select_query &#34;UTP.testPlan = '$testplan' OR UTP.testPlan LIKE '$testplan %' OR &#34;
    append select_query &#34;UTP.testPlan LIKE '% $testplan' OR UTP.testPlan LIKE '% $testplan %') &#34;
    append select_query &#34;AND (UTC.testCase = '$testcase' OR UTC.testCase LIKE '$testcase %' OR &#34;
    append select_query &#34;UTC.testCase LIKE '% $testcase' OR UTC.testCase LIKE '% $testcase %')&#34;;

    <a name="::_writeMALog(1)"><a href="./mysqlLib.tcl.html#::_writeMALog_843">::_writeMALog</a></a> &#34;$select_query&#34;

    set qout [mysqlsel $handle $select_query -list]
    foreach r $qout {
        set cr [lindex $r 0]
        set gState [lindex $r 1]
        regsub {[ ]+} $gState &#34;_&#34; gState
        set status [lindex $r 2]
        regsub {[ ]+} $status &#34;_&#34; status
        set auto   [lindex $r 3]
        if {[regexp -nocase $filterout $status]} {
            <span class="comment-line">#puts &#34;skipped f $filterout s $status&#34;;</span>
            continue;
        }
        puts &#34;Found CR: $cr : globalState: $gState status: $status autoState: $auto&#34;
        set CRINFO($cr,globalState) $gState;
        set CRINFO($cr,status) $status;
        set CRINFO($cr,auto) $auto;
        set CRINFO($cr,testcase) $testcase;
        lappend myCRs $cr
        lappend MAIN(CRLIST) $cr;
        lappend MAIN(CRTESTCASELIST) $testcase
    }
    return $myCRs
}
<span class="comment-line">###############################################################################</span>
<span class="comment-line"># Get tracker REL.releaseName from a build</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::tracker_get_releaseInfo_113">proc <a href="tracker.tcl-annot.html#::::tracker_get_releaseInfo">::::tracker_get_releaseInfo</a></a></strong><a name="::::tracker_get_releaseInfo"></a> {args} {

    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> tracker_get_bugnumber $args {
        build    &#34;null&#34;
        getType  &#34;name&#34;
        handle   &#34;null&#34;
    }

    set select_query &#34;SELECT REL.releaseId, REL.releaseName &#34;
    append select_query &#34;FROM releases REL &#34;
    append select_query &#34;LEFT Join builds BLD on REL.releaseId = BLD.releaseId &#34;
    append select_query &#34;WHERE BLD.buildName = '$build' AND REL.productId = '132'&#34;;

    set qout [mysqlsel $handle $select_query -list]
    foreach r $qout {
        if {$getType == &#34;name&#34;} {
            return [lindex $r 1]
        } else {
            return [lindex $r 0]
        }
    }

}
<span class="comment-line">###############################################################################</span>
<span class="comment-line"># GetTestCaseCRS</span>
<span class="comment-line">###############################################################################</span>
<strong><a name="::::GetTestCaseCRS_139">proc <a href="tracker.tcl-annot.html#::::GetTestCaseCRS">::::GetTestCaseCRS</a></a></strong><a name="::::GetTestCaseCRS"></a> {args} {
    global MAIN

    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> GetTestCaseCRS $args {
        testcase    &#34;null&#34;
        close_hdl   &#34;null&#34;
    }

    set CRLIST &#34;&#34;
    if {![info exists MAIN(RESULTBUILD)] || ![info exists MAIN(feature_directory)]} {
        return &#34;&#34;
    }

    if {$MAIN(TRACKERHANDLE) != &#34;null&#34;} {
        set h [<a name="::::tracker_db_connect(1)"><a href="./tracker.tcl.html#::::tracker_db_connect_27">::::tracker_db_connect</a></a>]
    } else {
        set h $MAIN(TRACKERHANDLE)
    }
    if {$h == &#34;fail&#34;} {
        return &#34;&#34;;
    }
    set r [<a name="::::tracker_get_releaseInfo(1)"><a href="./tracker.tcl.html#::::tracker_get_releaseInfo_113">::::tracker_get_releaseInfo</a></a> -build &#34;$MAIN(RESULTBUILD)&#34; -getType &#34;id&#34; -handle $h]
    if {$r &gt; 100} {
        <span class="comment-line"># --- no filters for now -filterout &#34;resolv|close&#34;</span>
        set CRLIST [<a name="::::tracker_get_bugnumber(1)"><a href="./tracker.tcl.html#::::tracker_get_bugnumber_59">::::tracker_get_bugnumber</a></a> -handle $h -testcase $testcase \
                      -testplan $MAIN(feature_directory) -release &#34;$r&#34;]
        if {$close_hdl != &#34;null&#34;} {
            <a name="::::close_mysql_handle(1)"><a href="./tracker.tcl.html#::::close_mysql_handle_47">::::close_mysql_handle</a></a> $h
        }
        return $CRLIST
    } else {
        if {$close_hdl != &#34;null&#34;} {
            <a name="::::close_mysql_handle(2)"><a href="./tracker.tcl.html#::::close_mysql_handle_47">::::close_mysql_handle</a></a> $h
        }
        return &#34;&#34;
    }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
