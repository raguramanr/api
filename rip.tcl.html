<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>rip.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#rip.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>rip.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="rip.tcl-annot.html">annotations</a> | <a href="rip.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: SendRipFrame   </span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#	Send RIP packet(request or response) from an ixia port.  This Proc</span>
<span class="comment-line">#	mainly simulates a neighbor to advertise RIP routes to DUT. </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Frame sent</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#	set frame [SendRipFrame -txPortId 1  -destMac $destMac -frameSize 130 \</span>
<span class="comment-line">#         -sourceIp 192.207.39.2  -destIp $destIP \</span>
<span class="comment-line">#         -command $ripCommand  -version $ver  -numRoute 4 \</span>
<span class="comment-line">#         -routeFamilyId {2 2 2 2}  -routeTag {00 00 00 00}\</span>
<span class="comment-line">#         -routeIp &#34;$oldRoute(1) $oldRoute(2) $newRoute(1) $newRoute(2)&#34;  \</span>
<span class="comment-line">#         -routeMask &#34;$routeMask $routeMask $routeMask $routeMask&#34; \</span>
<span class="comment-line">#         -routeNextHop {0.0.0.0  0.0.0.0 0.0.0.0 0.0.0.0} \</span>
<span class="comment-line">#         -routeMetric {2 5 1 3} ]     </span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::SendRipFrame_21">proc <a href="rip.tcl-annot.html#::::SendRipFrame">::::SendRipFrame</a></a></strong> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendRipFrame $args {
     txPortId &#34;1&#34;
     sourceMac &#34;default&#34;
     destMac &#34;01 00 5e 00 00 09&#34;
     sourceIp &#34;127.0.0.1&#34;
     destIp &#34;224.0.0.9&#34;
     gatewayIp &#34;127.0.0.1&#34;
     sourcePort &#34;520&#34;
     destPort &#34;520&#34;
     goodChecksum &#34;true&#34;
     numFrames &#34;1&#34;
     frameSize &#34;70&#34;
     ipOptions &#34;&#34;
     frameRate &#34;default&#34;
     dataPattern &#34;0000&#34;
     streamType &#34;stopStream&#34;
     fcsError &#34;good&#34;
     tag &#34;none&#34;
     TOS &#34;0x00&#34;
     userPriority &#34;0&#34;
     percentage &#34;100&#34;
     priority &#34;0&#34;
     saMode &#34;idle&#34;
     daMode &#34;idle&#34;
     ipSaMode &#34;ipIdle&#34;
     ipDaMode &#34;ipIdle&#34;
     id &#34;0&#34;
     command &#34;ripRequest&#34;
     <a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> &#34;2&#34;
     authen &#34;&#34;
     authenType &#34;2&#34;
     numRoute &#34;1&#34;
     routeFamilyId {2}
     routeTag {00}
     routeIp {0.0.0.0}
     routeMask {0.0.0.0} 
     routeNextHop {0.0.0.0}
     routeMetric {16}
   }
   
   set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   set rxPo [<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chasisId card port]
   if {$tag != &#34;none&#34; } { set wTag &#34;true&#34; } else {set wTag &#34;false&#34; }
   global startCardNum
   set frameSent [<a name="::ixiaConf_2Ports_ip(1)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -numIxiaCd $numIxiaCd  \
              -txChas $chasisId -txCard $card -txPort $port \
              -rxChas $chasisId -rxCard $card -rxPort $rxPo \
              -ipProtocol &#34;udp&#34; -sMacAddr $sourceMac -dMacAddr $destMac \
              -sIpAddr $sourceIp -dIpAddr $destIp -dDutIpAddr $gatewayIp \
              -pSrcPort $sourcePort -pDstPort $destPort -ttl 1 \
	      -goodChecksum $goodChecksum -numFrames $numFrames -frameSize $frameSize \
	      -frameRate $frameRate -dataPattern $dataPattern -streamType $streamType \
	      -fcsError $fcsError -wTag $wTag -tagNo $tag -TOS $TOS -userPriority $userPriority \
	      -percentage $percentage -priority $priority -ipOptions $ipOptions \
              -saMode $saMode -daMode $daMode -ipSaMode $ipSaMode -ipDaMode $ipDaMode \
              -id $id -ipApplication &#34;rip&#34; -ripCommand $command  -ripVersion $version \
              -ripAuthen $authen  -ripAuthenType $authenType  -ripNumRoute $numRoute \
              -ripRouteFamilyId $routeFamilyId  -ripRouteIp $routeIp  \
              -ripRouteMetric $routeMetric  -ripRouteNextHop $routeNextHop  \
              -ripRouteTag $routeTag  -ripRouteMask $routeMask ]
  if {$streamType != &#34;contPacket&#34; &amp;&amp; $numFrames &gt; 100} {
    <a name="::ixiaCheckTxDone(1)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $chasisId $card $port $numFrames $txPortId
  }  
  return $frameSent           
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: CheckRIPRoutes    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This proc is used to verify if the required RIP routes exist in </span>
<span class="comment-line">#	the specified list of RIP frames.  OneOrAll parameter determines</span>
<span class="comment-line">#	if all frames have to adverise the routes required to exist.</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#	set route(1) &#34;00 02 00 00 C0 CF 27 00 FF FF FF 00 00 00 00 00 00 00 00 10&#34;</span>
<span class="comment-line">#	set route(2) &#34;00 02 00 00 C0 CF 28 00 FF FF FF 00 00 00 00 00 00 00 00 01&#34;</span>
<span class="comment-line">#	lappend routeList &#34;{$route(1)} exist&#34;</span>
<span class="comment-line">#       lappend routeList &#34;{$route(2)} notExist&#34;</span>
<span class="comment-line">#       CheckRIPRoutes $ripFrameList $routeList &#34;one&#34; &#34;-- on rif vlan1&#34;</span>
<span class="comment-line">#       unset routeList</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################  </span>
<strong><a name="::::CheckRIPRoutes_106">proc <a href="rip.tcl-annot.html#::::CheckRIPRoutes">::::CheckRIPRoutes</a></a></strong> {ripFrameList routeList {oneOrAll &#34;all&#34;} {comment &#34;&#34;}} {

 <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking routes in RIP packets $comment&#34; 
 set numFrame [llength $ripFrameList]

 if { $numFrame &gt; 0 } {
   set numPass $numFrame
   for {set i 1} {$i &lt;= $numFrame} {incr i 1} {
      set frame [lindex $ripFrameList [expr $i - 1]]
      set msgType [<a name="::GetMessageType(1)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $frame]
      <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$msgType frame($i):&#34;
      <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frame&#34;
      set routeCheck 1
      foreach routeItem $routeList {
        set route [lindex $routeItem 0]
        set flag [lindex $routeItem 1]
        set existence [string first $route [string range $frame 138 end] ]
        switch $flag {
          &#34;notExist&#34; 	{
             if { $existence != -1 } {
                set routeCheck 0
                <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;!!!! frame($i) advertises the unexpected route: ($route) !!!!&#34;
             } else {   
             	<a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;frame($i) doesn't advertise the unexpected route: ($route)&#34;
             }
          }
          
          &#34;exist&#34; -
          default	{
             if { $existence != -1 } {
                <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;frame($i) advertises the expected route: ($route)&#34;
             } else {
                set routeCheck 0
                <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;!!!! frame($i) doesn't advertise the expected route: ($route) !!!!&#34;
             }
          }
        }
      }       
      if { !$routeCheck } { set numPass [expr $numPass - 1] }
   }
   
   switch $oneOrAll {
      &#34;all&#34;  	{ if { $numPass == $numFrame } {
   	            <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;ALL RIP frames advertising routes check passed&#34;
   	         } else {
   	            <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ALL RIP frames advertising routes check failed&#34; 
   	         }
   	       	}
      default 	{ if { $numPass &gt;= 1 } {
   	            <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;At least one RIP frame advertising routes check passed&#34;
   	         } else {
   	            <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;At least one RIP frame advertising routes check failed&#34; 
   	         }
   	       	}               
   }
 } else {
   <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;!!!! no frame in provided RIP frame list while invoking CheckRIPRoutes!!!!&#34;
   <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;routes in RIP packets check failed due to empty RIP frame list&#34;
 }  

  <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: startRip</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  start the RIP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: txPortIdList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      startRip {1}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::startRip_184">proc <a href="rip.tcl-annot.html#::::startRip">::::startRip</a></a></strong> {txPortIdList} {

    set pList &#34;&#34;;
   global TrafficGen
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
    foreach txPortId $txPortIdList {
        <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por;
        <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startRip - Chas: $cha Card: $car Port: $por&#34;;
        lappend pList &#34;$cha $car $por&#34;;
    }
    
    if {[ixStartRip pList]} {
        error &#34;startRip: ixStartRip failed.&#34;;
    }
}
      stc {
         set globalDeviceList &#34;&#34;
         foreach txPortId $txPortIdList {
            set txPortId [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            set deviceList [<a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
            <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startRip: Device List - $deviceList&#34;
            set globalDeviceList [concat $globalDeviceList $deviceList]				
         }
         
         if {[catch {<a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStartCommand -DeviceList $globalDeviceList} retCode]} {
            error &#34;startRip: Spirent device start failed.&#34;
         } 
      }
   }	
   
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: stopRip</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  start the RIP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: txPortIdList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      stopRip {1}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::stopRip_233">proc <a href="rip.tcl-annot.html#::::stopRip">::::stopRip</a></a></strong> {txPortIdList} {

    set pList &#34;&#34;;
   global TrafficGen
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {	
    foreach txPortId $txPortIdList {	
        <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por;
        <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopRip - Chas: $cha Card: $car Port: $por&#34;;
        lappend pList &#34;$cha $car $por&#34;;
    }

    if {[ixStopRip pList]} {
        error &#34;stopRip: ixStopRip failed.&#34;;
    }
}
      stc {
         
         set globalDeviceList &#34;&#34;
         foreach txPortId $txPortIdList {
            set txPortId [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            set deviceList [<a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
            <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopRip: Device List - $deviceList&#34;
				set globalDeviceList [concat $globalDeviceList $deviceList]				
         }
         
         if {[catch {<a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStopCommand -DeviceList $globalDeviceList} retCode]} {
            error &#34;stopRip: Spirent device start failed.&#34;
         } 
      }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cleanupRip</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  cleanup the RIP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: txPortIdList, routerIp</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      cleanupRip {4} &#34;11.11.11.2&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cleanupRip_282">proc <a href="rip.tcl-annot.html#::::cleanupRip">::::cleanupRip</a></a></strong> {txPortIdList routerIp} {
        
   global TrafficGen
   
   switch -exact -- $TrafficGen {
      
      stc {
         if { [catch {
            foreach txPortId $txPortIdList {
               set txPortId [<a name="::hMapPortIdToSpirentPort(3)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
               foreach emulatedDevice [<a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources] {
						set ipv4If [<a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-Ipv4If]
                  if {$ipv4If != &#34;&#34;} {
                     if {[<a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ipv4If -Address] ==  $routerIp} {
                        <a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $emulatedDevice
                     }
                  }
               }
            }
            
         } msg ] } {
            <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;cleanupRip : Failed to delete RIP configuration $msg&#34;
				return 0
         }			
         
      }
      
      ixia -
      ixvm {
         
         
  set routerId 1   
  set rangeId 1   
  foreach txPortId $txPortIdList {    
    <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chas card port;
    set pl [list [list $chas $card $port]] 
    <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cleanupRip - Chas: $chas Card: $card Port: $port&#34;;
           
    <span class="comment-line"># select the port           </span>
    if {[ripServer select $chas $card $port]} {
        <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Connecting to ripServer&#34;;
    }    
    ripServer clearAllRouters         
    ripInterfaceRouter clearAllRouteRange
    if [ripServer write] {
        error &#34;Error writing ripServer&#34; 
    }
 
    arpServer setDefault   
    <a name="::DeleteIpAddress(1)"><a href="./ixiaProtSrv.tcl.html#::DeleteIpAddress_1051">::DeleteIpAddress</a></a> $txPortId $routerIp
    <span class="comment-line">#--- This will delete the interface table </span>
    interfaceTable select $chas $card $port
    interfaceTable getInterface &#34;Port $card:$port Interface&#34;
    interfaceTable delInterface &#34;Port $card:$port Interface&#34;
    <span class="comment-line"># EY-07-17-2008: Removed invalid parameter to &#34;interfaceTable</span>
    <span class="comment-line"># clearAllInterfaces&#34; command.</span>
    interfaceTable clearAllInterfaces;
    interfaceTable write;

    
    protocolServer config -enableArpResponse false
    protocolServer config -enableRipService false 
    protocolServer set 1 $card $port
    
    if {[protocolServer write $chas $card $port]} {
        error &#34;protocolServer write $chas $card $port failed.&#34;
    } 
    <span class="comment-line"># Send to the hardware </span>
    <a name="::ixWritePortsToHardware(1)"><a href="./mapping.tcl.html#::ixWritePortsToHardware_145">::ixWritePortsToHardware</a></a> pl 
  }      
}
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: setupRipPeer</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  setup the RIP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: </span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#    setupRipPeer -routerIp &#34;11.11.11.2&#34; -txPortId 1 -rangeIpList $rangeIpList \</span>
<span class="comment-line">#                 -prefixList $prefixList -numberofrouteList $numberofrouteList \</span>
<span class="comment-line">#                 -metricList $metricList -nexthopList $nexthopList -tagList $tagList</span>
<span class="comment-line">#             </span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::setupRipPeer_374">proc <a href="rip.tcl-annot.html#::::setupRipPeer">::::setupRipPeer</a></a></strong> {args} {
   global TrafficGen
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupRipPeer $args {
        routerIp &#34;1.1.1.1&#34;
        mask &#34;255.255.255.0&#34;
        txPortId 1
        updateInterval 30
        updateIntervalOffset 5              
        rangeIpList {}
        prefixList {}
        numberofrouteList {}
        metricList {}
        nexthopList {}
        tagList {}
    }

   switch -exact -- $TrafficGen {
      
      stc {
         if { [catch {
            set txPortId [<a name="::hMapPortIdToSpirentPort(4)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            <a name="::cleanupBgp(1)"><a href="./bgp.tcl.html#::cleanupBgp_161">::cleanupBgp</a></a> $txPortId
            array set cmdResults [<a name="::logcmd(9)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(10)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv4If EthIIIf&#34; -IfCount &#34;1 1&#34;]
            set deviceHndl $cmdResults(-ReturnList)
            set gatewayIp [join &#34;[lrange [split $routerIp .] 0 2] 1&#34; .]  
            <a name="::logcmd(11)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(12)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] -Address $routerIp -Gateway $gatewayIp
            
            set ripRouterAttrs &#34;-under $deviceHndl -RipVersion V2&#34; ;<span class="comment-line"># -DutIpv4Addr 224.0.0.9</span>
            if {$updateInterval != &#34;&#34;} {
               append ripRouterAttrs  &#34; -UpdateInterval $updateInterval&#34;
            }
            if {$updateIntervalOffset != &#34;&#34;} {
               append ripRouterAttrs  &#34; -UpdateJitter $updateIntervalOffset&#34;
            }
            set ripRouterConfig [eval &#34;logcmd stc::create RipRouterConfig [subst $ripRouterAttrs]&#34;] 
            set idx 0 
            while {[llength $rangeIpList] &gt; $idx} {    
               <span class="comment-line"># Extract the information from the table and set the route ranges </span>
               set myIp [lindex $rangeIpList $idx]
               set prefix [lindex $prefixList $idx]
               set numRoutes [lindex $numberofrouteList $idx]
               set metric [lindex $metricList $idx]
               set nextHop [lindex $nexthopList $idx]
               set routeTag [lindex $tagList $idx]
               incr idx
               set ipv4RouteAttrs &#34;-under $ripRouterConfig&#34;
               if {$metric != &#34;&#34;} {
                  append ipv4RouteAttrs  &#34; -Metric $metric&#34;
               }
               if {$nextHop != &#34;&#34;} {
                  append ipv4RouteAttrs  &#34; -NextHop $nextHop&#34;
               }
               if {$routeTag != &#34;&#34;} {
                  append ipv4RouteAttrs  &#34; -RouteTag $routeTag&#34;
               }
               
               set ripv4Route [eval &#34;logcmd stc::create Ripv4RouteParams [subst $ipv4RouteAttrs]&#34;]
               set ipv4BlockAttrs &#34;-StartIpList [<a name="::cleanRoute(1)"><a href="./spirent.tcl.html#::cleanRoute_3436">::cleanRoute</a></a> $myIp $prefix]&#34;
               if {$prefix != &#34;&#34;} {
                  append ipv4BlockAttrs  &#34; -PrefixLength $prefix&#34;
               }
               if {$numRoutes != &#34;&#34;} {
                  append ipv4BlockAttrs  &#34; -NetworkCount $numRoutes&#34;
               }
               eval &#34;logcmd stc::config [<a name="::logcmd(13)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ripv4Route -children-Ipv4NetworkBlock] [subst $ipv4BlockAttrs]&#34;
            }									
            
         } msg ] } {
            <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;setupRipPeer : Failed to configure RIP  $msg&#34;
            return 0
         }			
         
		}
		
		ixia -
                ixvm {
	
    <span class="comment-line">#An array of multiple route ranges, organized as a table </span>
    <span class="comment-line"># Num </span>
    <span class="comment-line"># RangeIp Prefix Routes Metric Next-Hop Tag </span>
    <span class="comment-line">#set routeRanges {{10.0.0.0 13 10 4 198.18.1.2 9} \</span>
    <span class="comment-line">#                {20.0.0.0 17 10 4 198.18.1.2 10}}</span>
    set routerId 1
    set rangeId 1 
    
    <span class="comment-line"># get the port information   </span>
    <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chas card port
    <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupRipPeer - Chas: $chas Card: $card Port: $port&#34;
    
    set pl [list [list $chas $card $port]] 
    set myMac [format &#34;00 be ef 00 %02x %02x&#34; $card $port]

    <span class="comment-line"># Basic parameters for the RIP router </span>
    set sendType ripBroadcastV2 
    set receiveType ripReceiveVersion2 
    set updateInterval 30 
    set updateIntervalOffset 5
        
    <span class="comment-line"># Initialize port </span>
<span class="comment-line">#    port setFactoryDefaults $chas $card $port </span>
<span class="comment-line">#    port setDefault </span>
<span class="comment-line">#    port set $chas $card $port</span>

    <span class="comment-line"># Select the port and clear all defined routers </span>
    ripServer select $chas $card $port 
    ripServer clearAllRouters

    <span class="comment-line"># For all the defined routers</span>
    set idx 0 
    while {[llength $rangeIpList] &gt; $idx} {    
        <span class="comment-line"># Extract the information from the table and set the route ranges </span>
        set myIp [lindex $rangeIpList $idx]
        set prefix [lindex $prefixList $idx]
        set numRoutes [lindex $numberofrouteList $idx]
        set metric [lindex $metricList $idx]
        set nextHop [lindex $nexthopList $idx]
        set routeTag [lindex $tagList $idx]
        incr idx
                                            
        ripRouteRange setDefault 
        ripRouteRange config -enableRouteRange true 
        ripRouteRange config -routeTag $routeTag 
        ripRouteRange config -networkIpAddress $myIp 
        ripRouteRange config -networkMaskWidth $prefix 
        ripRouteRange config -numberOfNetworks $numRoutes 
        ripRouteRange config -nextHop $nextHop
        ripRouteRange config -metric $metric
    
        <span class="comment-line"># Create a name for each individual route range </span>
        ripInterfaceRouter addRouteRange \
            [format &#34;routeRange%02d&#34; $rangeId] 
        incr rangeId 
    }

    arpServer setDefault 
    arpServer config -mode arpGatewayOnly 
    arpServer set $chas $card $port
    if {![regexp -nocase &#34;3.50&#34; [<a name="::version(2)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -installVersion]]} {
       interfaceTable               select            $chas $card $port
       interfaceIpV4                setDefault        
       interfaceIpV4                config            -maskWidth                          24
       interfaceIpV4                config            -ipAddress                          &#34;$routerIp&#34;
       interfaceEntry               addItem           addressTypeIpV4
       interfaceEntry               setDefault        
       interfaceEntry               config            -enable                             true
       interfaceEntry               config            -description                        &#34;Port $card:$port Interface&#34;
       interfaceEntry               config            -macAddress                         &#34;$myMac&#34;
       interfaceEntry               config            -enableVlan                         false
       interfaceEntry               config            -vlanId                             0
       interfaceEntry               config            -vlanPriority                       0
       interfaceTable               addInterface      
 
       interfaceEntry               clearAllItems     addressTypeIpV6
       interfaceEntry               clearAllItems     addressTypeIpV4
    }
    
    ripInterfaceRouter           setDefault        
    ripInterfaceRouter           config            -enableRouter                       true
    ripInterfaceRouter           config            -ipAddress                          &#34;$routerIp&#34;
    ripInterfaceRouter           config            -ipMask                             &#34;$mask&#34;
    ripInterfaceRouter           config            -responseMode                       ripSplitHorizonSpaceSaver
    ripInterfaceRouter           config            -sendType                           $sendType
    ripInterfaceRouter           config            -receiveType                        $receiveType
    ripInterfaceRouter           config            -updateInterval                     $updateInterval
    ripInterfaceRouter           config            -updateIntervalOffset               $updateIntervalOffset
    if {[regexp -nocase &#34;3.50&#34; [<a name="::version(3)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -installVersion]]} {
       <span class="comment-line"># And add the router to the ripServer with a unique ID </span>
       ripServer addRouter [format &#34;router%02d&#34; $routerId]
    } else {
       ripInterfaceRouter           config            -enableAuthorization                false
       ripInterfaceRouter           config            -authorizationPassword              {}
       ripInterfaceRouter           config            -protocolInterfaceDescription       &#34;Port $card:$port Interface&#34;
       ripServer                    addRouter         router1
    }
    
    <span class="comment-line"># Set up the IP address table, arp server and protocol server </span>
    <span class="comment-line"># To respond to arps from the router </span>
    ipAddressTableItem setDefault 
    ipAddressTableItem config -numAddresses 1 
    ipAddressTableItem config -mappingOption oneIpToOneMac 
    ipAddressTableItem config -overrideDefaultGateway false 
    ipAddressTableItem config -fromIpAddress $routerIp 
    ipAddressTableItem config -fromMacAddress $myMac 
    ipAddressTable addItem 
    ipAddressTable set $chas $card $port



    protocolServer get $chas $card $port 
    protocolServer config -enableArpResponse true 
    protocolServer config -enableRipService true 
    protocolServer config -enablePingResponse false 
    protocolServer set 1 $card $port
    
    <span class="comment-line"># Send to the hardware </span>
    <a name="::ixWritePortsToHardware(2)"><a href="./mapping.tcl.html#::ixWritePortsToHardware_145">::ixWritePortsToHardware</a></a> pl 
    <span class="comment-line">#ixCheckLinkState pl</span>
		}
	}

}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
