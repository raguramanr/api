<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>mirrorLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#mirrorLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>mirrorLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="mirrorLib.tcl-annot.html">annotations</a> | <a href="mirrorLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<strong><a name="::::CheckOprationalVirtualSlot_1">proc <a href="mirrorLib.tcl-annot.html#::::CheckOprationalVirtualSlot">::::CheckOprationalVirtualSlot</a></a></strong> {} {
global DUT1_CONNECT
global DUT2_CONNECT
global bd8kChassis
global chassis
global DUTs_info
global platform
global stacking

 for {set k 1} {$k &lt;= 2} {incr k} {
   set platform [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${k}]
   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${k}_CONNECT]
   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;platform : $platform&#34;
   if {[regexp -nocase &#34;$stacking&#34; $DUTs_info(DUT${k},platform)]} {
       set slotName $DUTs_info(DUT${k},hwList)
       puts &#34;slotName value is $slotName&#34;
        set Slot 1
        foreach i $slotName {
              if {&#34;$i&#34; != &#34;Empty&#34;} {
                 <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;slot is $Slot&#34;
                 lappend parameterList &#34;{State:.*Operational} exist&#34;
                 <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot $Slot&#34; $parameterList -time  {s: 1 i: 5 d: 200 f: 200 r} \
                        -comment &#34;Check slot$Slot are in operational state from DUT$k&#34;
                 unset parameterList
              }
        incr Slot
       }

   } elseif {[regexp -nocase &#34;BD-X8|$chassis&#34; $DUTs_info(DUT${k},platform)]} {
        set slotName $DUTs_info(DUT${k},hwList)
        set Slot 1
        foreach i $slotName {
              if {&#34;$i&#34; != &#34;Empty&#34;} {
                 <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;slot is $Slot&#34;
                 lappend parameterList &#34;{State:.*Operational} exist&#34;
                 <a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot $Slot&#34; $parameterList -time  {s: 1 i: 5 d: 200 f: 200 r} \
                        -comment &#34;Check slot$Slot are in operational state from DUT$k&#34;
                 unset parameterList
              }
        incr Slot
       }
   }
 }
}

<strong><a name="::::findslotsystemdump1_46">proc <a href="mirrorLib.tcl-annot.html#::::findslotsystemdump1">::::findslotsystemdump1</a></a></strong> {} {
global DUT1_CONNECT
global DUT2_CONNECT
global bd8kChassis
global chassis
global DUTs_info
global bladeType
global platform
global stacking
global gnssPlatform

for {set k 1} {$k &lt;= 2} {incr k} {
   set platform [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${k}]
   <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${k}_CONNECT]
   <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;platform : $platform&#34;
   if {[regexp -nocase &#34;$stacking&#34; $DUTs_info(DUT${k},platform)]} {
       set slotName $DUTs_info(DUT${k},hwList)
       puts &#34;slotName value is $slotName&#34;
        set Slot 1
        foreach i $slotName {
        puts &#34;I value is : $i&#34;
              if {&#34;$i&#34; != &#34;Empty&#34;} {
                 <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;slot is $Slot&#34;
                 lappend parameterList &#34;{core_dump_info} notExist&#34;
                 if { [<a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show debug system-dump slot $Slot&#34; $parameterList -comment &#34;Check core in slot-$Slot DUT$k&#34;] != &#34;ok&#34; } {
                 <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear debug system-dump slot $Slot&#34;
                 <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;system-dump cleared on slot-$Slot DUT$k&#34;
                 }
                 unset parameterList
              }
        incr Slot
       }

   } elseif {[regexp -nocase &#34;BD-X8|$chassis&#34; $DUTs_info(DUT${k},platform)]} {
        set slotName $DUTs_info(DUT${k},hwList)
       puts &#34;slotName value is $slotName&#34;
        set Slot 1
        foreach i $slotName {
        puts &#34;I value is : $i&#34;
              if {&#34;$i&#34; != &#34;Empty&#34;} {
                 <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;slot is $Slot&#34;
                 lappend parameterList &#34;{core_dump_info} notExist&#34;
                 if { [<a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show debug system-dump slot $Slot&#34; $parameterList -comment &#34;Check core in slot-$Slot DUT$k&#34;] != &#34;ok&#34; } {
                 <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear debug system-dump slot $Slot&#34;
                 <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;system-dump cleared on slot-$Slot DUT$k&#34;
                 }
                 unset parameterList
              }
        incr Slot
       }
        lappend msm_key &#34;{M(S)?M-A} Operational inLine Exist&#34;
        if {[<a name="::CheckKeyValue(5)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot&#34; $msm_key -comment &#34;Checking MSM availability&#34;] == &#34;ok&#34; } {
            <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show debug system-dump msm a&#34;
               lappend parameterList &#34;{core_dump_info} notExist&#34;
               if { [<a name="::CheckKeyValue(6)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show debug system-dump msm a&#34; $parameterList -comment &#34;Check core in MSM-A DUT$k&#34;] != &#34;ok&#34; } {
                        <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear debug system-dump msm a&#34;
                        <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;system-dump cleared on MSM-A DUT$k&#34;
                  }
        }
        unset msm_key
	if {[regexp -nocase $bd8kChassis $DUTs_info(DUT1,platform)]} {
        <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;system $bd8kChassis&#34;
        lappend msm_key &#34;{MSM-B} Operational inLine Exist&#34;
        if {[<a name="::CheckKeyValue(7)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot&#34; $msm_key -comment &#34;Checking MSM availability&#34;] == &#34;ok&#34; } {
            <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show debug system-dump msm b&#34;
                lappend parameterList &#34;{core_dump_info} notExist&#34;
               if { [<a name="::CheckKeyValue(8)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show debug system-dump msm b&#34; $parameterList -comment &#34;Check core in MSM-B DUT$k&#34;] != &#34;ok&#34; } {
                        <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear debug system-dump msm b&#34;
                        <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;system-dump cleared on MSM-B DUT$k&#34;
                  }
        }
	}
   } else {
                set parameterList &#34;&#34;
                lappend parameterList &#34;{core_dump_info} notExist&#34;
               if {[<a name="::CheckKeyValue(9)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show debug system-dump&#34; $parameterList -comment &#34;Check core in DUT$k&#34;] != &#34;ok&#34;} {
                        <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear debug system-dump&#34;
                        <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;system-dump cleared on DUT$k&#34;
                  }
                unset parameterList
                <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Stand Alone switch is $k&#34;
          }
}
}


<strong><a name="::::get_links_speed_factors_132">proc <a href="mirrorLib.tcl-annot.html#::::get_links_speed_factors">::::get_links_speed_factors</a></a></strong> {ixiaPortsList trunkPortsList ixiaPortFactors trunkPortsFactors } {
  upvar $ixiaPortFactors ixiaFactors
  upvar $trunkPortsFactors trunkFactors

  set lowestSpeed &#34;&#34;
  <span class="comment-line"># find the lowest speed among ixia ports</span>
  set ixiaPortsSpeedList {}
  foreach ixiaPort $ixiaPortsList {
    <span class="comment-line">#get port speed</span>
    set ixiaPortSpeed [<a name="::GetPortIdSpeed(1)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> $ixiaPort]
    <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ixiaPortSpeed $ixiaPortSpeed&#34;
    lappend ixiaPortsSpeedList $ixiaPortSpeed
    if { ($lowestSpeed == &#34;&#34;) || ($ixiaPortSpeed &lt; $lowestSpeed) } {
      set lowestSpeed $ixiaPortSpeed
    }
  }
  <span class="comment-line"># see if any trunk is slower then that</span>
  <span class="comment-line"># each element in trunkPortsList is a list of 2 elements</span>
  <span class="comment-line"># 1. Port - ex: 2:3</span>
  <span class="comment-line"># 2. DUT - ex 2</span>
  set trunkPortsSpeedList {}
  foreach trunkPort $trunkPortsList {
    set port [lindex $trunkPort 0]
    set dut [lindex $trunkPort 1]
    <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;trunkPort $trunkPort&#34;
    set trunkPortSpeed [<a name="::getDutPortSpeed(1)"><a href="./misc.tcl.html#::getDutPortSpeed_3328">::getDutPortSpeed</a></a> -dut $dut -port $port]
    <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;trunkPortSpeed $trunkPortSpeed&#34;
    lappend trunkPortsSpeedList $trunkPortSpeed
    if { ($lowestSpeed == &#34;&#34;) || ($trunkPortSpeed &lt; $lowestSpeed) } {
      set lowestSpeed $trunkPortSpeed
    }
  }
  <span class="comment-line"># lets create the result lists</span>
  set ixiaFactors {}
  foreach ixiaPortSpeed $ixiaPortsSpeedList {
    set a &#34;$ixiaPortSpeed.0&#34;
    set b &#34;$lowestSpeed.0&#34;
    set ixiaPortFactor [expr $b/$a] 
    <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ixiaPortFactor $ixiaPortFactor&#34;
    lappend ixiaFactors $ixiaPortFactor
  }
  set trunkFactors {}
  foreach trunkPortSpeed $trunkPortsSpeedList {
    set a &#34;$trunkPortSpeed.0&#34;
    set b &#34;$lowestSpeed.0&#34;
    set trunkPortFactor [expr $b/$a] 
    <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;trunkPortFactor $trunkPortFactor&#34;
    lappend trunkFactors $ixiaPortFactor
  }
  <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ixiaFactors $ixiaFactors&#34;
  <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;trunkFactors $trunkFactors&#34;
}

<span class="comment-line">#############################################################################</span>
<span class="comment-line"># Procedure Name: SetTwoPortSameChip                                       ##</span>
<span class="comment-line"># Sets two  ports on same chip and third port  on diff chip                ##</span>
<span class="comment-line"># usage: SetTwoPortSameChip &#34;4&#34;                                            ##</span>
<span class="comment-line"># returns : $portSetList if all ports are on same chip.                    ##</span>
<span class="comment-line"># DUT physical ports list {egress mtp ingress} if they are different.      ##</span>
<span class="comment-line">#############################################################################</span>
<strong><a name="::::SetTwoPortSameChip_192">proc <a href="mirrorLib.tcl-annot.html#::::SetTwoPortSameChip">::::SetTwoPortSameChip</a></a></strong> { numPorts } {

set j $numPorts

for {set i 1} { $i &lt;=$numPorts } {incr i} {
   for {set j $numPorts} {$j &gt;= 1} {set j [expr {$j - 1}]} {
      if { $i == $j} {
         continue;
      } else {
         if { [<a name="::GetBcomSameChip(1)"><a href="./broadcom.tcl.html#::GetBcomSameChip_14">::GetBcomSameChip</a></a> [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $j ] [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $i ] ] == 1 } {
            lappend sameAsicList [<a name="::MapDUTPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $i ]
            lappend sameAsicList [<a name="::MapDUTPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $j ]
            set j 1
            set i 10
            break
         }
      }
   }
}
if ![info exists sameAsicList] {
   return -1;
}


for {set k 1} { $k &lt;=$numPorts } {incr k} {
   if {([lsearch [<a name="::MapDUTPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $k ] [lindex $sameAsicList 0]] == -1) &amp;&amp; ([lsearch [<a name="::MapDUTPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $k ] [lindex $sameAsicList 1]] == -1)} {
     if { [<a name="::GetBcomSameChip(2)"><a href="./broadcom.tcl.html#::GetBcomSameChip_14">::GetBcomSameChip</a></a> [<a name="::MapDUTPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $k ] [lindex $sameAsicList 0]] != 1 } {
         lappend notSameAsicList [<a name="::MapDUTPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $k]
         break
     }
   }
}


if ![info exists notSameAsicList] {
   return -1;
} else {
   set port1 [lindex $sameAsicList 0]
   set port2 [lindex $sameAsicList 1]
   set port3 [lindex $notSameAsicList 0]
   set portSetList &#34;&#34;
   lappend portSetList &#34;$port1 $port2 $port3&#34;
}

foreach item $portSetList {
   <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$item&#34;
}

return $portSetList
}
<span class="comment-line">######################################################################</span>
<span class="comment-line"># Procedure Name: SetThreePortDiffChip</span>
<span class="comment-line"># Sets three ports on different chip a</span>
<span class="comment-line"># usage: SetEgressMtpSameChip &#34;4&#34;</span>
<span class="comment-line"># returns : $portSetList  if all ports are on different chip. DUT physical ports list\</span>
<span class="comment-line"># {egress mtp ingress} if they are in  different asic.</span>
<span class="comment-line">#######################################################################</span>
<strong><a name="::::SetThreePortDiffChip_249">proc <a href="mirrorLib.tcl-annot.html#::::SetThreePortDiffChip">::::SetThreePortDiffChip</a></a></strong> { numPorts } {

set j $numPorts

for {set i 1} { $i &lt;=$numPorts } {incr i} {
   for {set j $numPorts} {$j &gt;= 1} {set j [expr {$j - 1}]} {
      if { $i == $j} {
         continue;
      } else {
         if { [<a name="::GetBcomSameChip(3)"><a href="./broadcom.tcl.html#::GetBcomSameChip_14">::GetBcomSameChip</a></a> [<a name="::MapDUTPortId(9)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $j ] [<a name="::MapDUTPortId(10)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $i ] ] == 0 } {
            lappend sameAsicList1 [<a name="::MapDUTPortId(11)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $i ]
            lappend sameAsicList2 [<a name="::MapDUTPortId(12)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $j ]
            set j 1
            set i 10
            break
         }
      }
   }
}

if ![info exists sameAsicList1] {
   return -1;
}

for {set k 1} { $k &lt;=$numPorts } {incr k} {
   if {([lsearch [<a name="::MapDUTPortId(13)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $k ] [lindex $sameAsicList1 0]] == -1) &amp;&amp; ([lsearch [<a name="::MapDUTPortId(14)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $k ] [lindex $sameAsicList2 1]] == -1)} {
     if { ([<a name="::GetBcomSameChip(4)"><a href="./broadcom.tcl.html#::GetBcomSameChip_14">::GetBcomSameChip</a></a> [<a name="::MapDUTPortId(15)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $k ] [lindex $sameAsicList1 0]] != 1) &amp;&amp; ([<a name="::GetBcomSameChip(5)"><a href="./broadcom.tcl.html#::GetBcomSameChip_14">::GetBcomSameChip</a></a> [<a name="::MapDUTPortId(16)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $k ] [lindex $sameAsicList2 0]] != 1) } {
         lappend sameAsicList3 [<a name="::MapDUTPortId(17)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $k]
         break
     }
   }
}

if ![info exists sameAsicList3] {
   return -1;
} else {
   set port1 [lindex $sameAsicList1 0]
   set port2 [lindex $sameAsicList2 0]
   set port3 [lindex $sameAsicList3 0]
   set portSetList &#34;&#34;
   lappend portSetList &#34;$port1 $port2 $port3&#34;
}

foreach item $portSetList {
   <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$item&#34;
}

return $portSetList
}

<span class="comment-line">#####################################################################################</span>
<span class="comment-line">#Procedure Name: returnIxiaLogicalPortID                                           ##</span>
<span class="comment-line">#returnIxiaLogicalPortID retuns the logical port based on DUT's physical port      ##</span>
<span class="comment-line">#usage: returnIxiaLogicalPortID &#34;4:1&#34; &#34;1&#34;                                          ##</span>
<span class="comment-line">##returns : Logical Ixia port                                                      ##</span>
<span class="comment-line">#####################################################################################</span>

<strong><a name="::::returnIxiaLogicalPortID_306">proc <a href="mirrorLib.tcl-annot.html#::::returnIxiaLogicalPortID">::::returnIxiaLogicalPortID</a></a></strong> {actualport dutno} {
global  portMappingList
foreach subList $portMappingList {
if {[lindex $subList 1]== &#34;$actualport&#34; }  {
  if {[lindex $subList 2]== $dutno} {
     return [lindex $subList 0]
    }
}
}
return -1
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetL2DataPattern</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetL2DataPattern_322">proc <a href="mirrorLib.tcl-annot.html#::::GetL2DataPattern">::::GetL2DataPattern</a></a></strong> { dataFrame } {
   return [string range $dataFrame 36 40]
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetL2DataPatternTag</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetL2DataPatternTag_331">proc <a href="mirrorLib.tcl-annot.html#::::GetL2DataPatternTag">::::GetL2DataPatternTag</a></a></strong> { dataFrame } {
   return [string range $dataFrame 48 52]
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetL3DataPattern</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetL3DataPattern_340">proc <a href="mirrorLib.tcl-annot.html#::::GetL3DataPattern">::::GetL3DataPattern</a></a></strong> { dataFrame } {
   return [string range $dataFrame 102 106]
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetL3DataPatternTag</span>
<span class="comment-line">#  Category: Setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::GetL3DataPatternTag_349">proc <a href="mirrorLib.tcl-annot.html#::::GetL3DataPatternTag">::::GetL3DataPatternTag</a></a></strong> { dataFrame } {
   return [string range $dataFrame 114 118]
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: findOperSlots</span>
<span class="comment-line"># Description: To find the no of operational slots in Chassi          </span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Num of slots, Slot no list</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       findOperSlots</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>


<strong><a name="::::findOperSlots_365">proc <a href="mirrorLib.tcl-annot.html#::::findOperSlots">::::findOperSlots</a></a></strong> {} {

global DUT1_CONNECT
global NumActiveSlots
global slotList

<span class="comment-line">## taking the no of active slots (operational)</span>
set NumActiveSlots 0
set slotList &#34;&#34;

<a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT

set fd_in [open &#34;Tmp/tmp_showslotinfo&#34; &#34;w&#34;]
<a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show slot&#34; &#34;NULL&#34; $fd_in
close $fd_in

set fd_in [open &#34;Tmp/tmp_showslotinfo&#34; &#34;r&#34;]

while {[gets $fd_in line] != -1} {
   set cookedLine [<a name="::cookString(1)"><a href="./misc.tcl.html#::cookString_22">::cookString</a></a> $line]
   set aList [split $cookedLine]
   <span class="comment-line"># Gather the slot state for all 10 slots</span>
   for {set slotNum 1} {$slotNum&lt;=10} {incr slotNum 1} {
      if { ([lindex $aList 0] == &#34;Slot-$slotNum&#34;) &amp;&amp;
           (([lindex $aList 1] == &#34;Operational&#34;) ||
           ([lindex $aList 2] == &#34;Operational&#34;) ||
           ([lindex $aList 3] == &#34;Operational&#34;)) } {
           incr NumActiveSlots 1
           lappend slotList $slotNum
         }
      }
   }

close $fd_in
file delete &#34;Tmp/tmp_showslotinfo&#34;
<a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The no of slots in this stack : $NumActiveSlots&#34;

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: findSlotList</span>
<span class="comment-line"># Description: To find the no of operational slots in Chassi          </span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Num of slots, Slot no list</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       findOperSlots</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>


<strong><a name="::::findSlotList_416">proc <a href="mirrorLib.tcl-annot.html#::::findSlotList">::::findSlotList</a></a></strong> {} {

global DUT1_CONNECT
global DUTs_info
global bcmx650;
global stacking
global bcmChassis
global NumActiveSlots
global slot
global slotList
global totalPorts
global totalPortsList
global gnssPlatform

set maxFilter 128


if {[regexp -nocase &#34;$gnssPlatform&#34; [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]]} {
      set maxFilter 64
}

<span class="comment-line">## taking the no of active slots (operational)</span>

<a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT

   <span class="comment-line">##To find the no of operational slots,Slotlist and then Ports in the Slots</span>

   <a name="::findOperSlots(1)"><a href="./mirrorLib.tcl.html#::findOperSlots_365">::findOperSlots</a></a>
   <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;slotlist : $slotList&#34;

   set totalPorts 0
   set origPorts 0
   set valuefound 0
   set valuefound1 0
   set parameterList &#34;&#34;
   set platform [<a name="::GetPlatform(4)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]
   set portList &#34;&#34;

   lappend portList [<a name="::MapDUTPortId(18)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1] [<a name="::MapDUTPortId(19)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 2] [<a name="::MapDUTPortId(20)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 3] [<a name="::MapDUTPortId(21)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 4] \
   [<a name="::::GetATrunkPort(1)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] [<a name="::::GetATrunkPort(2)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 2] [<a name="::::GetATrunkPort(3)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 3]

   lappend totalPortsList [<a name="::MapDUTPortId(22)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1] [<a name="::MapDUTPortId(23)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 2] [<a name="::MapDUTPortId(24)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 3] [<a name="::MapDUTPortId(25)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 4] \
   [<a name="::::GetATrunkPort(4)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] [<a name="::::GetATrunkPort(5)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 2] [<a name="::::GetATrunkPort(6)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 3]

   set totalPorts [llength $totalPortsList]

   foreach slot $slotList {

   lappend parameterList  &#34;Slot-$slot.*Operational 1&#34;
   set valuefound [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show slot&#34; $parameterList]
   unset parameterList
   set valuefound1 [lindex $valuefound 0]


      set slotType [lindex $DUTs_info(DUT1,hwList) [expr $slot -1]]
      <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SlotType: $slotType&#34;

      set totalPorts [expr ($totalPorts + $valuefound1)]

      if { $totalPorts &gt; $maxFilter}  {
           set addPorts [expr $maxFilter + 1 - $origPorts]
           set count 0

            for {set i 1}  {$i&lt;= $valuefound1} {incr i} {
                set port1  $slot:$i
                if {  $count &lt; $addPorts } {
                        if { [lsearch -regexp $portList $port1] == -1} {
                         lappend totalPortsList $slot:$i
                         incr count
                        }
                }
            }
   
     } else {

      for {set i 1} {$i&lt;=$valuefound1} {incr i} {

         if { [regexp -nocase &#34;$bcmx650&#34; $slotType] } {
         <span class="comment-line"># For tiger, skipping ports 23 and 24  used as stacking ports.</span>
   
           if {($i == 23) || ($i ==24)} {
                 <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Skipping 1:23 and 1:24 for Tiger platform&#34;
                 set totalPorts [expr ($totalPorts - 1)]
                 continue
              }
         }

         set port1  $slot:$i
         if { ([lsearch -regexp $portList $port1] == -1)} {
                   lappend totalPortsList $slot:$i
         }
     }

    }
     set totalPorts [llength $totalPortsList]
     set origPorts $totalPorts
   }

   <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Total ports in FindSlotList is  : $totalPorts&#34;
   <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Total portList in FindSlotList is  : $totalPortsList&#34;

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: findNewSlot</span>
<span class="comment-line"># Description: If active ports are not sufficient, configure </span>
<span class="comment-line">#              module to add some ports.</span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: Num of slots, Slot no list</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       findOperSlots</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>


<strong><a name="::::findNewSlot_532">proc <a href="mirrorLib.tcl-annot.html#::::findNewSlot">::::findNewSlot</a></a></strong> {} {

global DUT1_CONNECT
global NumActiveSlots
global slotList
global newSlot
global bcmChassis;
global stacking;

<a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT

set newSlot 0 
set addPorts 0 
set cardList &#34;&#34;

<span class="comment-line">###find the new slot that is to be added</span>

set platform [<a name="::GetPlatform(5)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]

if {[regexp -nocase &#34;$bcmChassis&#34; $platform]} {
   
     if {[regexp -nocase &#34;$stacking&#34; $platform]} { 
        lappend cardList 1 2 3 4 5 6 7 8 
     } else {
        lappend cardList 1 2 3 4 5 6   
     } 
   } else {
    <span class="comment-line">## FOR GENESIS AND PIONEER </span>
    if {[regexp -nocase &#34;BD-20804&#34; $platform]} {
       lappend cardList 1 2 3 4
    } elseif {[regexp -nocase &#34;BD-12804&#34; $platform]} {
       lappend cardList 1 2 5 6
    } elseif {[regexp -nocase &#34;BD-12802&#34; $platform]} {
       lappend cardList 1 2
    } else {
       lappend cardList 1 2 3 4 5 6 7 8
    }
   } 
  
   foreach card1 $cardList {
       if {([lsearch -exact $slotList $card1] == -1)} {
            set newSlot $card1
            lappend slotList $card1
            <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;findNewSlot: slotList=$slotList, newSlot=$newSlot&#34;
            break;
          } 
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: findMirrorFilters</span>
<span class="comment-line"># Description: To find the no of mirroring filters          </span>
<span class="comment-line"># Input args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: list of total filters</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       findMirrorFilters</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>


<strong><a name="::::findMirrorFilters_594">proc <a href="mirrorLib.tcl-annot.html#::::findMirrorFilters">::::findMirrorFilters</a></a></strong> {} {

global DUT1_CONNECT
global slotList;
global slot;
global newSlot;
global bcmChassis;
global bcmStackable;
global gnssChassis;
global gnssPlatform
global pioneerChassis;
global stacking;
global tftpServerList
global mirrFilterList;
global totalPorts; 
global totalPortsList;
global listOfNewSlots 
global everestChassis
global flag
global new_slot
global newslotflag
global bd8kChassis
set noPortsInSlot 0
set maxFilter 128
set newslotflag &#34;&#34;;

if {[regexp -nocase &#34;$gnssPlatform&#34; [<a name="::GetPlatform(6)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]]} {
   set maxFilter 64
}

set tftpServer  [lindex $tftpServerList 0]
set platform [<a name="::GetPlatform(7)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]
<a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;platform : $platform&#34;
set dut1Ver [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1 1];

puts &#34;$dut1Ver&#34;
<a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Image version : $dut1Ver&#34;
<a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;platform : $platform&#34;
set flag 0

if {[regexp -nocase &#34;$stacking&#34; $platform]} {
        if {([<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $dut1Ver &#34;15.4&#34;]) &gt;= 0} {
             set addSlot &#34;X670V-48x&#34;
             set noPortsInSlot 48
             set flag 1
         puts &#34;$addSlot&#34;

        } else {
             set addSlot &#34;X450e-48p&#34;
             set noPortsInSlot 48
         puts &#34;$addSlot&#34;
        }
}


if {[regexp -nocase &#34;$bd8kChassis&#34; $platform]} {
     
  if {[<a name="::CompareRelease(2)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> [<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1] 15.3.1.4]&gt;=0} {
                set addSlot &#34;G48Xc&#34;
                set noPortsInSlot 48
            } else {
                set addSlot &#34;8900-G48T-xl&#34;
                set noPortsInSlot 48
            }
<span class="comment-line"># EY-01-10-2014: Added missing close-brace.</span>
} else {         
     
     <span class="comment-line"># FOR GENESIS / PIONEER PLATFORMS </span>
    if {[regexp -nocase &#34;BD-20&#34; $platform]} {
       set addSlot &#34;GM-40XB&#34;
       set noPortsInSlot 40
    } elseif {[regexp -nocase &#34;BD-12&#34; $platform]} {
       set addSlot &#34;GM-20XTR&#34;
       set noPortsInSlot 20
    } elseif {[regexp -nocase &#34;BD-10&#34; $platform]} {
       set addSlot &#34;G60T&#34;
       set noPortsInSlot 60
    } elseif {[regexp -nocase &#34;BD-X8&#34; $platform]} {
       set addSlot &#34;BDXA-10G48X&#34;
       set noPortsInSlot 48
    }

}

<span class="comment-line">###   Check for Aspen/Stacking and StandAlone BCM platforms</span>

if {[regexp -nocase &#34;$bcmStackable&#34; $platform]} {

   <span class="comment-line">#### Stand Alone Switches</span>

   set totalPortsList &#34;&#34;
   <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Summit platform&#34;

  if {[regexp -nocase &#34;E4G-200&#34; $platform]} {
   set totalPorts 12
  } elseif {[regexp -nocase &#34;E4G-400&#34; $platform]} {
   set totalPorts 28
  } elseif {[regexp -nocase &#34;NWI-E450A&#34; $platform]} {
   set totalPorts 13
  } elseif {[regexp -nocase &#34;X440-L2-48t|X440-L2-24t&#34; $platform]} {
    set val1 [lindex [split $platform -] 2]
    set totalPorts [lindex [split $val1 &#34;x|t|p&#34;] 0]
  } else {
	<a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT
	<a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan default add ports all&#34;

	set parameterList &#34;&#34;
	lappend parameterList &#34;{Default}  5 0&#34;
	set totalPorts [string range  [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show vlan&#34; $parameterList] 1 end]
	<a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure vlan default delete ports all&#34;


  }

   <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Total Ports in the summit Switch is :$totalPorts&#34;
  
   <span class="comment-line">## Ixia Connection 3 is used as the Monitor port </span>
   <span class="comment-line">## Ixia Connection 2-5 Active Mirroring Filters </span>

   set portList &#34;&#34;
   lappend portList [<a name="::MapDUTPortId(26)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1] [<a name="::MapDUTPortId(27)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 2] [<a name="::MapDUTPortId(28)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 3] [<a name="::MapDUTPortId(29)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 4] \
   [<a name="::::GetATrunkPort(7)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] [<a name="::::GetATrunkPort(8)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 2] [<a name="::::GetATrunkPort(9)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 3]

   <span class="comment-line"># Find the list of dummy mirroring filters, by excluding the above active ports</span>
   set mirrFilterList &#34;&#34;
   set count 0
   
   for {set i 1} {$i&lt;=$totalPorts} {incr i} {

      if {([lsearch -exact $portList $i] == -1)} {
         lappend mirrFilterList $i 
         set count [llength $mirrFilterList]
      }

   }
    <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;MirrorFilterList excluding active ports : $mirrFilterList&#34;
  

} else {
 
   set totalPortsList &#34;&#34;
   set totalPorts 0
   <a name="::findSlotList(1)"><a href="./mirrorLib.tcl.html#::findSlotList_416">::findSlotList</a></a>

   <span class="comment-line">##Check if the total ports is &gt; than Max Mirroring filters else add \</span>
   <span class="comment-line">##more slots with required ports </span>

   while {$totalPorts &lt;= $maxFilter } {
     <a name="::findNewSlot(1)"><a href="./mirrorLib.tcl.html#::findNewSlot_532">::findNewSlot</a></a>
     if {$newSlot == 0} {
        break
     }
     lappend listOfNewSlots $newSlot
     set addPorts [expr $maxFilter + 1 - $totalPorts]
     <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure slot $newSlot module  $addSlot&#34;
     lappend newslotflag $newSlot
     for {set i 1} {$i&lt;=$addPorts} {incr i} {
             if  {$i &lt;= $noPortsInSlot} {
               lappend totalPortsList $newSlot:$i
             }
      }
     unset addPorts
     set totalPorts [llength $totalPortsList]
   }

  <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n totalPortsList : $totalPortsList&#34;
  <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n Total no of Ports     : $totalPorts&#34;
      
  <span class="comment-line">## The Port [MapDUTPortId 3]   is used as the Monitor port to mirror the pkts.</span>
  <span class="comment-line">## The other ports  [MapDUTPortId 1],[MapDUTPortId 2] , [MapDUTPortId 4],</span>
  <span class="comment-line">## [GetATrunkPort 1 2 1], [GetATrunkPort 1 2 2] are used as ACTIVE Mirroring Ports </span>
   
  set portList &#34;&#34;
  lappend portList [<a name="::MapDUTPortId(30)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 1] [<a name="::MapDUTPortId(31)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 2] [<a name="::MapDUTPortId(32)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 3] [<a name="::MapDUTPortId(33)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> 4] \
  [<a name="::::GetATrunkPort(10)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 1] [<a name="::::GetATrunkPort(11)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 2] [<a name="::::GetATrunkPort(12)"><a href="./SystemSetup.tcl.html#::::GetATrunkPort_601">::::GetATrunkPort</a></a> 1 2 3]

  <span class="comment-line"># Find the list of dummy mirroring filters, by excluding the above active ports</span>

  <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n\nPortList :$portList\n&#34;
  foreach port1 $totalPortsList {
       if {([lsearch -exact $portList $port1] == -1)} {
          lappend mirrFilterList $port1
       } 
   }
    set count 0 
    set count [llength $mirrFilterList]
    <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FiltersCount: $count&#34;
    <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n MirrorFiltersList excluding active ports: $mirrFilterList&#34;

  }
}


<span class="comment-line">################################################################################</span>
<span class="comment-line"># Procedure Name: FindTrafficRate </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to find the minimum traffic rate for linerate forwarding</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args : None</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># return     : Rate</span>
<span class="comment-line"># Typical Usage: FindTrafficRate</span>
<span class="comment-line">################################################################################</span>

<strong><a name="::::FindTrafficRate_799">proc <a href="mirrorLib.tcl-annot.html#::::FindTrafficRate">::::FindTrafficRate</a></a></strong> {} {

global DUT1_CONNECT
global DUT2_CONNECT
global DUT3_CONNECT

lappend portSpeedList [<a name="::GetPortIdSpeed(2)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> 1]
lappend portSpeedList [<a name="::GetPortIdSpeed(3)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> 2]
lappend portSpeedList [<a name="::GetPortIdSpeed(4)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> 3]
lappend portSpeedList [<a name="::GetPortIdSpeed(5)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> 4]

lappend portSpeedList [<a name="::GetPortIdSpeed(6)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> 9]
lappend portSpeedList [<a name="::GetPortIdSpeed(7)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> 10]
lappend portSpeedList [<a name="::GetPortIdSpeed(8)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> 11]
lappend portSpeedList [<a name="::GetPortIdSpeed(9)"><a href="./ePTMisc.tcl.html#::GetPortIdSpeed_451">::GetPortIdSpeed</a></a> 12]


set portlist [lsort -integer $portSpeedList]
set lowspeed [lindex $portlist 0]

<span class="comment-line">##setting up the frame rate for diff speeds</span>

switch -- $lowspeed  &#34;100&#34; {
   set maxframerate 100000
} &#34;1000&#34; {
   set maxframerate 1000000
} &#34;10000&#34; {
   set maxframerate 10000000
} &#34;10&#34; {
   set maxframerate 10000
} default {
   set maxframerate 100000
}

<a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nLinerate Traffic rate for the setup: $maxframerate pps\n\n&#34;

return $maxframerate
}

<span class="comment-line">#################################################################</span>
<span class="comment-line"># Procedure Name: CheckMSMIsInSync</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: runs &#34;show switch&#34; until all MSMs are in sync</span>
<span class="comment-line">#              or 10 minutes</span>
<span class="comment-line"># Input args: CheckMSMsIsInSync</span>
<span class="comment-line"># Optional Args: none</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">##################################################################</span>


<strong><a name="::::CheckMSMIsInSync_852">proc <a href="mirrorLib.tcl-annot.html#::::CheckMSMIsInSync">::::CheckMSMIsInSync</a></a></strong> {} {
    lappend parameterList &#34;BACKUP {In Sync} inLine&#34;;
    set timeOut &#34;start: 60 interval: 3 dummy: 3 fail: 600&#34;;

    set returnCode [<a name="::CheckKeyValue(10)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $parameterList -time $timeOut];
    if {$returnCode != &#34;ok&#34;} {
        <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;MSMs not in sync after 420 seconds.&#34;;
        return 0;
    } else {
        return 1;
    }
}


<strong><a name="::::ConfMirroring_866">proc <a href="mirrorLib.tcl-annot.html#::::ConfMirroring">::::ConfMirroring</a></a></strong> {args} {

   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> ConfMirroring $args {
      <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;NULL&#34;
      <a name="::vlan(1)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> &#34;NULL&#34;
      direction &#34; &#34;
   }

   global whichDutNow
   global gnssPlatform

   set platform [<a name="::GetPlatform(8)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]
   if {[regexp -nocase &#34;$gnssPlatform&#34; $platform]} {
      set direction &#34;&#34;
   }

   if {$port == &#34;NULL&#34;} {
      if {$vlan == &#34;NULL&#34;} {
         <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invalid arg in ConfMirroring: port not set.&#34;
      } else {
         <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mirror add vlan $vlan $direction&#34;
      }
   } else {
      if {$vlan != &#34;NULL&#34;} {
         <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mirror add port $port vlan $vlan $direction&#34;
      } else {
         <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mirror add port $port $direction&#34;
      }
   }
   <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
}

<strong><a name="::::GetMaxNumFilters_898">proc <a href="mirrorLib.tcl-annot.html#::::GetMaxNumFilters">::::GetMaxNumFilters</a></a></strong> {newfilters {platform &#34;default&#34;}} {

   global whichDutNow
   global gnssPlatform
   global mirrFilterList

   if {$platform == &#34;default&#34;} {
      set platform [<a name="::GetPlatform(9)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]
   }
   set existingFitlers [llength $mirrFilterList]
   set totFilters [expr $existingFitlers + $newfilters]

   if {[regexp -nocase &#34;$gnssPlatform&#34; $platform]} {
      set filterCnt 64
   } else {
      set filterCnt 128
   }
   if {$totFilters &lt;= $filterCnt} {
      set filterCnt $totFilters
   }
   return $filterCnt
}


set  CLF_PROT_FOUND 1
set  CLF_PROT_NOT_FOUND 0
set udpPortId 1;
set tcpPortId 2;

set ipAddrUdp      &#34;192.1.1.100&#34;; <span class="comment-line"># IP address from the RX port used t send TCP</span>
set ipAddrTcp      &#34;192.1.2.100&#34;; <span class="comment-line"># IP address from the TX port used t send UDP</span>
set ipAddrRxPort       &#34;192.1.1.100&#34;; <span class="comment-line"># IP address from the RX port used t send TCP</span>
set ipAddrTxPort       &#34;192.1.2.100&#34;; <span class="comment-line"># IP address from the TX port used t send UDP</span>

set macAddrRxPort      &#34;00 A1 F1 00 00 01&#34;; <span class="comment-line"># mac  address for the RX port</span>
set macAddrTxPort      &#34;00 A1 F1 00 00 02&#34;; <span class="comment-line"># mac  address for the Tllllll</span>
set macAddrUdpPort     &#34;00 A1 F1 00 00 01&#34;; <span class="comment-line"># mac  address for the RX port</span>
set macAddrTcpPort     &#34;00 A1 F1 00 00 02&#34;; <span class="comment-line"># mac  address for the Tllllll</span>
set vlan1IpAddr        &#34;192.1.1.9&#34;
set vlan2IpAddr        &#34;192.1.2.9&#34;
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: configVlansAndIxia</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: </span>
<span class="comment-line"># -&gt;Configure the Vlans for the ClearFlow tests</span>
<span class="comment-line"># Will create two Vlans. </span>
<span class="comment-line"># Vlan1 with IXIA port 1, and Vlan2 with Ixia port 2 </span>
<span class="comment-line"># -&gt;Send ARp packets from one each Ixia ports to the DUTs </span>
<span class="comment-line"># -&gt; Set the Receiving filters on each Ixia port</span>
<span class="comment-line"># This is a fixed filter based on the SrcIp and Pattern</span>
<span class="comment-line"># -&gt; Clear the port Stats</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: Up or Down</span>
<span class="comment-line"># By default Uses ports from uppper part of the so as to use MSM A</span>
<span class="comment-line"># If want to use the lower ports, pass Down as an argument</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types </span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::configVlansAndIxia_962">proc <a href="mirrorLib.tcl-annot.html#::::configVlansAndIxia">::::configVlansAndIxia</a></a></strong> { args} {
global DUT1_CONNECT;
<a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a>   $DUT1_CONNECT;
set  dutMac [<a name="::GetDUTMac(1)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> DUT1]

set rxPortId 1;
set txPortId 2;
global udpPortId 
global tcpPortId 

global ipAddrUdp
global ipAddrTcp
global macAddrUdpPort
global macAddrTcpPort

global ipAddrRxPort
global ipAddrTxPort
global macAddrRxPort
global macAddrTxPort
global vlan1IpAddr 
global vlan2IpAddr

<span class="comment-line">####  if the Down argument is passed, choose only those ixia ports that are </span>
<span class="comment-line">####  connected to the lower ports on the DUT</span>
set lowerPorts &#34;&#34;
if {([llength $args] &gt;= 1) &amp;&amp; ($args == &#34;Down&#34;) } {
    <span class="comment-line"># the first 8 ixia ports are connected to the DUT1.</span>
    for {set i 1}  {$i &lt;= 8} {incr i} {

        set dutPort [<a name="::MapDUTPortId(34)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $i 1]
        puts &#34;PORT : $dutPort&#34;

        set lport [lindex [split $dutPort :] 1]
        if {( ($lport &gt; 15) &amp;&amp; ($lport &lt;= 30)) || ($lport &gt;= 46) } {
            lappend lowerPorts $lport
        }
    }
    puts &#34;Lower Ports :  [llength $lowerPorts] :: $lowerPorts&#34;


    if { [llength $lowerPorts ] &lt; 2 } {
        return 1 ; <span class="comment-line"># didn't find two lower ports</span>
    } else {
        set udpPort [lindex $lowerPorts 0]
        set tcpPort [lindex $lowerPorts 1]
    }
}

<a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;create vlan vlan1&#34;;
if {$args == &#34;tag&#34;} {<a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan vlan1 tag 13&#34;}
<a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;configure vlan1 ipaddr $vlan1IpAddr/24&#34;;
<a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;configure vlan1 add port [<a name="::MapDUTPortId(35)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $udpPortId 1]&#34;;
<a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;enable ipforwarding vlan1&#34;;
<a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;clear counter&#34;;

<a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;create vlan vlan2&#34;;
if {$args == &#34;tag&#34;} {<a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config vlan vlan1 tag 14&#34;}
<a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;configure vlan2 ipaddr $vlan2IpAddr/24&#34;;
<a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;configure vlan2 add port [<a name="::MapDUTPortId(36)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $tcpPortId 1]&#34;;
<a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;enable ipforwarding vlan2&#34;;
<a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>        &#34;clear counter&#34;;

<span class="comment-line">#Send ARP from the udpPort</span>
set frameSent [<a name="::SendArpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $udpPortId -sourceIp $ipAddrUdp -destIp $vlan1IpAddr \
        -sourceMac $macAddrUdpPort -destMac $dutMac -numFrames 2];

<span class="comment-line">#Send ARP from the tcpPort</span>
set frameSent [<a name="::SendArpFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $tcpPortId -sourceIp $ipAddrTcp -destIp $vlan2IpAddr \
        -sourceMac $macAddrTcpPort -destMac $dutMac -numFrames 2];
return 0
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
