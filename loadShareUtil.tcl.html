<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>loadShareUtil.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#loadShareUtil.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>loadShareUtil.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="loadShareUtil.tcl-annot.html">annotations</a> | <a href="loadShareUtil.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetCaptureFilter</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Get the number of frames received on a port after applying the filter</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              portId - Port Id</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              return frames received</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              [GetCaptureFilter $portId]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetCaptureFilter_18">proc <a href="loadShareUtil.tcl-annot.html#::::GetCaptureFilter">::::GetCaptureFilter</a></a></strong> {{portId &#34;1&#34;}} {
        <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasis card port
        <a name="::stat(1)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasis $card $port
        return [<a name="::stat(2)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -captureFilter]
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: EnableFilter</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     The follwoing proc is used to set up ixia filter to detect</span>
<span class="comment-line">#       dataPattern at offset</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#       PostIdList - ixia port IDs</span>
<span class="comment-line">#       dataPattern</span>
<span class="comment-line">#       offset</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical Usage:</span>
<span class="comment-line">#       EnableIsisFilterOutHello 1 &#34;1234&#34; 12</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::EnableFilter_38">proc <a href="loadShareUtil.tcl-annot.html#::::EnableFilter">::::EnableFilter</a></a></strong> {portIdList dataPattern {offset 12} } {
    foreach portId $portIdList {
        <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
        <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port

        <span class="comment-line"># Define filter &amp; capture</span>
        <a name="::filterPallette(1)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -pattern1 $dataPattern

<span class="comment-line">#       filterPallette config -patternMask1 {00 00}</span>
        <a name="::filterPallette(2)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -patternOffset1 $offset
        <a name="::filterPallette(3)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -matchType1 3
        <a name="::filterPallette(4)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set $chas $card $port

        <a name="::filter(1)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable true
        <a name="::filter(2)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable true
        <a name="::filter(3)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterPattern pattern1
        <a name="::filter(4)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerPattern pattern1
        <a name="::filter(5)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerDA anyAddr
        <a name="::filter(6)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterDA anyAddr
        <a name="::filter(7)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerSA anyAddr
        <a name="::filter(8)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterSA anyAddr
        <a name="::filter(9)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> set $chas $card $port
        set portList [list [list $chas $card $port]]
        <a name="::ixWriteConfigToHardware(1)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList
    }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: DisableFilter</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     The follwoing proc is used to reset the ixia filter that has been set up</span>
<span class="comment-line">#       via EnableFilter</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#       PostIdList - ixia port IDs</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical Usage:</span>
<span class="comment-line">#       DisableIsisFilter 1</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::DisableFilter_77">proc <a href="loadShareUtil.tcl-annot.html#::::DisableFilter">::::DisableFilter</a></a></strong> {portIdList} {
    foreach portId $portIdList {
        <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
        <a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port

        <span class="comment-line"># Define filter &amp; capture</span>

        <a name="::filterPallette(5)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -pattern1 00
        <a name="::filterPallette(6)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -patternMask1 00
        <a name="::filterPallette(7)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set $chas $card $port

        <a name="::filter(10)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable true
        <a name="::filter(11)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable true
        <a name="::filter(12)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterPattern anypattern
        <a name="::filter(13)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerPattern anypattern
        <a name="::filter(14)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerDA anyAddr
        <a name="::filter(15)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterDA anyAddr
        <a name="::filter(16)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerSA anyAddr
        <a name="::filter(17)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterSA anyAddr
        <a name="::filter(18)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> set $chas $card $port
        set portList [list [list $chas $card $port]]
        <a name="::ixWriteConfigToHardware(2)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList
    }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: EnableSaFilter</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     The follwoing proc is used to set up ixia filter to detect</span>
<span class="comment-line">#       the specified sourceMac</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#       PostIdList - ixia port IDs</span>
<span class="comment-line">#       sourceMac</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical Usage:</span>
<span class="comment-line">#       EnableIsisFilterOutHello 1 &#34;00:A1:F1:00:00:01&#34;</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::EnableSaFilter_115">proc <a href="loadShareUtil.tcl-annot.html#::::EnableSaFilter">::::EnableSaFilter</a></a></strong> {portIdList sourceMac } {
    foreach portId $portIdList {
        <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
        <a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port
        regsub -nocase {:} $sourceMac { } sourceMac
        <span class="comment-line"># Define filter &amp; capture</span>
        <a name="::filterPallette(8)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -SA1 $sourceMac
        <a name="::filterPallette(9)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -SAMask1 {FF FF FF FF FF FF}
        <a name="::filterPallette(10)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set $chas $card $port
        <a name="::filter(19)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable true
        <a name="::filter(20)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable true
        <a name="::filter(21)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerDA anyAddr
        <a name="::filter(22)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterDA anyAddr
        <a name="::filter(23)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerSA addr1
        <a name="::filter(24)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterSA addr1
        <a name="::filter(25)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> set $chas $card $port
        set portList [list [list $chas $card $port]]
        <a name="::ixWriteConfigToHardware(3)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList
    }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: DisableSaFilter</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     The follwoing proc is used to reset the ixia filter that has been set up</span>
<span class="comment-line">#       via EnableSaFilter</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#       PostIdList - ixia port IDs</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical Usage:</span>
<span class="comment-line">#       DisableIsisFilter 1</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::DisableSaFilter_149">proc <a href="loadShareUtil.tcl-annot.html#::::DisableSaFilter">::::DisableSaFilter</a></a></strong> {portIdList} {
    foreach portId $portIdList {
        <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
        <a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port

        <span class="comment-line"># Define filter &amp; capture</span>

        <a name="::filterPallette(11)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -SA1 {00 00 00 00 00 00}
        <a name="::filterPallette(12)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> config -SAMask1 {00 00 00 00 00 00}
        <a name="::filterPallette(13)"><a href="./ePTClient.tcl.html#::filterPallette_915">::filterPallette</a></a> set $chas $card $port
        <a name="::filter(26)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterEnable true
        <a name="::filter(27)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerEnable true
        <a name="::filter(28)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterPattern anypattern
        <a name="::filter(29)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerPattern anypattern
        <a name="::filter(30)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerDA anyAddr
        <a name="::filter(31)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterDA anyAddr
        <a name="::filter(32)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureTriggerSA anyAddr
        <a name="::filter(33)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> config -captureFilterSA anyAddr
        <a name="::filter(34)"><a href="./ePTClient.tcl.html#::filter_846">::filter</a></a> set $chas $card $port
        set portList [list [list $chas $card $port]]
        <a name="::ixWriteConfigToHardware(4)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList
    }
}


<strong><a name="::::GetRatio_174">proc <a href="loadShareUtil.tcl-annot.html#::::GetRatio">::::GetRatio</a></a></strong> {a b} {
    if {$b == 0} {return -99999}
    return [expr int (double($a) /(double($b)/1000.0)) ]
}

<strong><a name="::::clicksPerMilliSeconds_179">proc <a href="loadShareUtil.tcl-annot.html#::::clicksPerMilliSeconds">::::clicksPerMilliSeconds</a></a></strong> {} {
    set t1 [clock clicks]
    after 10000
    set t2 [clock clicks]
    return [expr ($t2 - $t1) / 10000]
}
<strong><a name="::::GetMasterLoadSharePort_185">proc <a href="loadShareUtil.tcl-annot.html#::::GetMasterLoadSharePort">::::GetMasterLoadSharePort</a></a></strong> { pList } {
    <span class="comment-line">#first filter the comma</span>
    regsub -all {,} $pList { } portList
    set mPort [lindex $portList 0]
    foreach port $portList {
      if { [regexp {([0-9]+):([0-9]+)} $port prt prt1 prt2] == 1 } {
         set tmpPort [expr [expr $prt1 * 100] + $prt2]
         if { [regexp {([0-9]+):([0-9]+)} $mPort prt prt1 prt2] == 1 } {
           set tmpmPort [expr [expr $prt1 * 100] + $prt2]
           if { $tmpPort &lt; $tmpmPort } {
              set mPort $port
           }
         }
      } else {
         if { $port &lt; $mPort } {
             set mPort $port
         }
      }
    }
    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Master port among ports: $portList is $mPort&#34;
    return $mPort
}

<strong><a name="::::enableSharing_208">proc <a href="loadShareUtil.tcl-annot.html#::::enableSharing">::::enableSharing</a></a></strong> {master groupRange DUTName fd_res testNo args} {
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> enableSharing $args {
      CheckSharing &#34;0&#34;
      algo &#34;&#34;
   }

   global DUTs_info
   global supportedPlatform gnssChassis

   if {[regexp -nocase &#34;$supportedPlatform&#34; [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $DUTName]]} {
      if {$algo==&#34;&#34;} {
         if {[regexp -nocase $gnssChassis [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $DUTName]]} {
            set algo port
         } elseif {[regexp -nocase &#34;vpex&#34; [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> $DUTName]]} {
            set algo &#34;address custom&#34;
         } else {
            set algo address
         }
      }
      if {!$CheckSharing} {
         <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable sharing [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $master [string range $DUTName 3 end]] grouping [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $groupRange [string range $DUTName 3 end]] algorithm $algo&#34;
      } else {
         return [<a name="::CheckCmdIllegal(1)"><a href="./checkCmdLegality.tcl.html#::CheckCmdIllegal_18">::CheckCmdIllegal</a></a> &#34;enable sharing [<a name="::MapDUTPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $master [string range $DUTName 3 end]] grouping [<a name="::MapDUTPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $groupRange [string range $DUTName 3 end]] algorithm $algo&#34; $fd_res $testNo]
      }
   } else {
      if {$algo==&#34;&#34;} {
         set algo roundrobin
      }
      if {!$CheckSharing} {
         <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable sharing [<a name="::MapDUTPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $master [string range $DUTName 3 end]] grouping [<a name="::MapDUTPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $groupRange [string range $DUTName 3 end]] algorithm $algo&#34;
      } else {
         return [<a name="::CheckCmdIllegal(2)"><a href="./checkCmdLegality.tcl.html#::CheckCmdIllegal_18">::CheckCmdIllegal</a></a> &#34;enable sharing [<a name="::MapDUTPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $master [string range $DUTName 3 end]] grouping [<a name="::MapDUTPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $groupRange [string range $DUTName 3 end]] algorithm $algo&#34; $fd_res $testNo]
      }
   }
}

<strong><a name="::::GetLowestPort_244">proc <a href="loadShareUtil.tcl-annot.html#::::GetLowestPort">::::GetLowestPort</a></a></strong> { portlist } {
    return [lindex [<a name="::sortedPorts(1)"><a href="./misc.tcl.html#::sortedPorts_1729">::sortedPorts</a></a> $portlist] 0]
}

<strong><a name="::::GetHighestPort_248">proc <a href="loadShareUtil.tcl-annot.html#::::GetHighestPort">::::GetHighestPort</a></a></strong> { portlist } {
    set num [expr [llength $portlist] - 1]
    return [lindex [<a name="::sortedPorts(2)"><a href="./misc.tcl.html#::sortedPorts_1729">::sortedPorts</a></a> $portlist] $num]
}

<strong><a name="::::ConfirmLSTraffic_253">proc <a href="loadShareUtil.tcl-annot.html#::::ConfirmLSTraffic">::::ConfirmLSTraffic</a></a></strong> { txPort rxPortList verifyPortList } {
    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Wait 6 seconds for things to settle down...&#34;
    <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 6

    set numFramesSentRate [<a name="::GetFrameRateSent(1)"><a href="./ePTRx.tcl.html#::GetFrameRateSent_1374">::GetFrameRateSent</a></a> $txPort]

    set numFramesRcdRate 0
    foreach portnum $verifyPortList {
    	incr numFramesRcdRate [<a name="::GetFrameRateReceived(1)"><a href="./ePTRx.tcl.html#::GetFrameRateReceived_1402">::GetFrameRateReceived</a></a> $portnum]
    }
    <a name="::StopPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $txPort

    <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numFramesSentRate=$numFramesSentRate; numFramesRcdRate=$numFramesRcdRate&#34;

    if { $numFramesRcdRate &gt;= [expr $numFramesSentRate*0.9] } {
        <span class="comment-line"># Pass</span>
        return 1
    } else {
        <span class="comment-line"># Fail</span>
        return 0
    }
}

<strong><a name="::::verifyFrameCounts_276">proc <a href="loadShareUtil.tcl-annot.html#::::verifyFrameCounts">::::verifyFrameCounts</a></a></strong> {portIdList  {SkipPortId &#34;none&#34;}} {

    set portIdTx 1
    set destMacAddrTx 00:A2:F1:00:00:01
    after 200
    foreach portId $portIdList {
	<a name="::EnablePortFilter(1)"><a href="./ePTRx.tcl.html#::EnablePortFilter_1817">::EnablePortFilter</a></a> $portId  &#34;&#34; &#34;{[<a name="::GetPortIdMac(1)"><a href="./misc.tcl.html#::GetPortIdMac_405">::GetPortIdMac</a></a> $portIdTx &#34; &#34;]}&#34;
    }

    <a name="::ClearPortsStats(1)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdTx
    <a name="::ClearPortsStats(2)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdList
    set Totalframessent 0
    set numFrames 20
    set k 00
    set x 01
    <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Verify total frame count sent and received&#34;
    for {set i 1} {$i&lt;=10} {incr i} {
	set destmac 00:A1:01:$k:$x:01
	set k [format &#34;%02x&#34; [expr 0x$k + 4]]
	set x [format &#34;%02x&#34; [expr 0x$x + 1]]
	set frameSent [<a name="::SendFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $portIdTx -sourceMac $destMacAddrTx \
		-numFrames $numFrames -destMac $destmac -daMode &#34;ctrRandom&#34; \
		-frameRate 5000]

	<a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FrameSent: $frameSent&#34;
	set framesSent [<a name="::GetNumFramesSent(1)"><a href="./ePTRx.tcl.html#::GetNumFramesSent_1324">::GetNumFramesSent</a></a> $portIdTx]
	set Totalframessent [expr $Totalframessent + $framesSent]
    }
   <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
    set totalFramesReceived 0
    foreach portId $portIdList {
	set framesReceived [<a name="::GetNumFramesReceived(1)"><a href="./ePTRx.tcl.html#::GetNumFramesReceived_1346">::GetNumFramesReceived</a></a> $portId]
	<span class="comment-line">#set framesReceived [lindex [ixiaUserDefinedStat1 $portId] 1]</span>
	<a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;framesReceived on portId $portId $framesReceived&#34;
	<a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SkipPortId $SkipPortId&#34;

	if {$SkipPortId!=&#34;none&#34;} {
	    if {[lsearch -exact $SkipPortId $portId]==-1} {
		<a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Verify traffic on present member port $portId&#34;
		if {$framesReceived==0} {
		    <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;framesReceived $framesReceived on $portId&#34;
		} else {
		    <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;correct framesReceived $framesReceived on $portId&#34;
		}
	    } else {
		<a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Verify traffic on deleted member port $portId&#34;
		if {$framesReceived!=0} {
		    <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;framesReceived $framesReceived on $portId&#34;
		} else {
		    <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;correct framesReceived $framesReceived on $portId&#34;
		}
	    }
	    <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
	} elseif {$framesReceived==0} {
	    <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;framesReceived $framesReceived on $portId&#34;
	}
	set totalFramesReceived [expr $framesReceived+$totalFramesReceived]
    }
    <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;framesSent: $Totalframessent, totalFramesReceived: $totalFramesReceived&#34;
    if {$totalFramesReceived&lt;$Totalframessent || $totalFramesReceived&gt;[expr $Totalframessent+3]} {
	<a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;totalFramesReceived is different than framesSent $Totalframessent&#34;
    } else {
	<a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;totalFramesReceived is same as framesSent $Totalframessent&#34;
    }

    <a name="::StopPortsTransmit(2)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> &#34;1&#34;

    <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

    foreach portId $portIdList {
	<a name="::DisablePortFilter(1)"><a href="./ePTRx.tcl.html#::DisablePortFilter_1937">::DisablePortFilter</a></a> $portId
    }

    return $totalFramesReceived

}


<strong><a name="::::CheckLoadSharePorts_354">proc <a href="loadShareUtil.tcl-annot.html#::::CheckLoadSharePorts">::::CheckLoadSharePorts</a></a></strong> {txPortId rxPortIdList {comment &#34;&#34;}} {

    set percent_tolerance .1;
    set txRate [<a name="::GetFrameRateSent(2)"><a href="./ePTRx.tcl.html#::GetFrameRateSent_1374">::GetFrameRateSent</a></a> $txPortId];
    <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking Rates $comment&#34;;

    foreach var $rxPortIdList {

	set rxPort [lindex $var 0];
	set rxPercent [lindex $var 1];
	set tag [lindex $var 2];
	set rtValue &#34;ok&#34;;
	if {$tag!=&#34;&#34;} {
	    set rxRate [<a name="::GetTaggedFrameRateReceived(1)"><a href="./ePTRx.tcl.html#::GetTaggedFrameRateReceived_1424">::GetTaggedFrameRateReceived</a></a> $rxPort];
	} else {
	    set rxRate [<a name="::GetFrameRateReceived(2)"><a href="./ePTRx.tcl.html#::GetFrameRateReceived_1402">::GetFrameRateReceived</a></a> $rxPort];
	}

	<a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Comparing txRate($txPortId)=$txRate and rxRate($rxPort)=$rxRate&#34;;
	<a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Comparing txRate($txPortId)=$txRate and rxRate($rxPort)=$rxRate&#34;;

	if { $txRate == 0 } {
	    if { $rxRate == 0 } {
		<a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;txRate($txPortId)=rxRate($rxPort)=0&#34;;
		set rtValue &#34;error&#34;;
	    } else {
		<a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;txRate($txPortId)=0 but rxRate($rxPort)=$rxRate&#34;;
		set rtValue &#34;error&#34;;
	    }
	} elseif { $rxRate &lt;= 4 } {
            <a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;txRate($txPortId)=rxRate($rxPort)=0&#34;;
            set rtValue &#34;ok&#34;;
	} else {
	    if {$rxPercent == 0} {
		set rxPercent 100;
	    }
	    set exp_rxRate [expr abs (double($txRate) * $rxPercent/100)];
	    set diff [expr abs( double($exp_rxRate) - double($rxRate) )];
	    puts &#34;Rate $exp_rxRate Diff $diff&#34;;
	    if {$exp_rxRate &lt; 0.0001 } {
		set pPercent [expr $diff * $percent_tolerance] ;<span class="comment-line"># not sure this is right</span>
	    } else {
		set pPercent [expr double($diff) / double($exp_rxRate) * 100.0];
	    }
	    <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- pPercent=$pPercent&#34;;

	    if { $pPercent &lt;= $percent_tolerance } {
		<a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Passed&#34;;
		set rtValue &#34;gotit&#34;;
	    } else {
		set difv 100;
		if {$txRate &gt; $rxRate} {
		    set difv [expr $txRate - $rxRate];
		} else {
		    set difv [expr $rxRate - $txRate];
		}
		if {$difv &lt; 4} {
		    <a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Passed&#34;;
		    set rtValue &#34;gotit&#34;;
		} else {
		    <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;TxRate:$txRate, rxRate:$rxRate check Failed. diff percentage:$pPercent exceeds %tolerance:$percent_tolerance&#34;;
		    <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> [format &#34;Difference (%01.2f%%) exceeds tolerance (%01.2f%%). Tx Rate is $txRate, Rx Rate is $rxRate.\n&#34; $pPercent $percent_tolerance];
		    set rtValue &#34;error&#34;;
		}
	    }
	}
	<a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
	lappend rtList $rtValue;
    }
    <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rtList = $rtList&#34;;
    set i 0;
    set x 0;
    set port 5;
    foreach var $rtList {
	if {$var == &#34;gotit&#34;} {
	    incr i;
	    set port [expr $port+$x];
	}
	incr x;
    }
    if {$i == 1} {
	<a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Port ($port) receives the traffic only&#34;;
	<a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Port ($port) receives the traffic only&#34;;
	<a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
    } else {
	<a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;More than one port received the traffic!&#34;;
	<a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;More than one port received the traffic!&#34;;
	<a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
	set port 0;
    }
    <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

    return $port;
}

<strong><a name="::::CheckDiffPortTraffic_449">proc <a href="loadShareUtil.tcl-annot.html#::::CheckDiffPortTraffic">::::CheckDiffPortTraffic</a></a></strong> {PortIdList} {

    set val 0;
    foreach port $PortIdList {
	set val 0;
	foreach port1 $PortIdList {
	    if {$port == $port1} {
		incr val;
	    }
	}
	if {$val &gt; 1} {
	    break;
	}
    }

    if {$val &gt; 1} {
 	<a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Some traffic went to the same received port&#34;;
 <span class="comment-line">#	result_error &#34;Some traffic went to the same received port($PortIdList)&#34;;</span>
    } else {
	<a name="::report_start_test(9)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;All traffic went to different received port($PortIdList)&#34;;
	<a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Not all traffic went to different received port($PortIdList)&#34;;
    }
    <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

}

<strong><a name="::::CheckSamePortTraffic_475">proc <a href="loadShareUtil.tcl-annot.html#::::CheckSamePortTraffic">::::CheckSamePortTraffic</a></a></strong> {PortIdList} {

    set x [lindex $PortIdList 0];
    set val &#34;true&#34;;
    foreach port $PortIdList {
	if {$port != $x} {
	    set val &#34;false&#34;;
	    break;
	}
    }

    if {$val == &#34;true&#34;} {
	<a name="::report_start_test(10)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;All traffic went to the same received port ($x)&#34;;
	<a name="::result_ok(9)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;All traffic went to the same received port ($x)&#34;;
    } else {
	<a name="::report_start_test(11)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Not all traffic went to the same received port ($x)&#34;;
	<a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Not all traffic went to the same received port ($x)&#34;;
    }
    <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: ValidateTrunkLinkForLoadshare</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#              Determine if trunk links between any 2 DUT's are of the same speed.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Side effects:</span>
<span class="comment-line">#              THIS PROC WILL CHANGE AUTONEG TO OFF ON ALL TRUNK PORTS WHERE NEEDED.</span>
<span class="comment-line">#              A &#34;1.END&#34; FILE SHOULD BE ADDED TO CHANGE AUTONEG BACK TO ON AGAIN ON ALL TRUNK PORTS.</span>
<span class="comment-line">#             </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              {firstDUT &#34;DUT1&#34;} {secondDUT &#34;DUT2&#34;}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              1 if trunk links are both same speed OR autoneg off was successful</span>
<span class="comment-line">#              0 if trunk links are different speed OR autoneg off was not successful</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              Inside a testcase:</span>
<span class="comment-line">#                 if { ![ValidateTrunkLinkForLoadshare DUT1 DUT2] } {</span>
<span class="comment-line">#                      result_ok &#34;Skipping this testcase because trunk links of different speeds not supported.&#34;</span>
<span class="comment-line">#                      return</span>
<span class="comment-line">#                 }</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Testcase validation</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ValidateTrunkLinkForLoadshare_523">proc <a href="loadShareUtil.tcl-annot.html#::::ValidateTrunkLinkForLoadshare">::::ValidateTrunkLinkForLoadshare</a></a></strong> { {firstDUT &#34;DUT1&#34;} {secondDUT &#34;DUT2&#34;} } {
    global DUTs_info

    <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Verifying that $firstDUT and $secondDUT share all same speed trunk links&#34;

    set firstDUTnumber [string range $firstDUT 3 3]
    set secondDUTnumber [string range $secondDUT 3 3]
    set TrunkPortList1to2 [<a name="::::GetTrunkPortList(1)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a> $firstDUTnumber $secondDUTnumber]
    set TrunkPortList2to1 [<a name="::::GetTrunkPortList(2)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a> $secondDUTnumber $firstDUTnumber]
    <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;TrunkPortList1to2='$TrunkPortList1to2'&#34;
    <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;TrunkPortList2to1='$TrunkPortList2to1'&#34;
    set trunkSpeedList1 &#34;&#34;
    set trunkSpeedList2 &#34;&#34;

    <span class="comment-line"># For all builds, if at least one 10Gbps link combined with different speed, loadshare is not supported</span>
    set dut1 [string range $firstDUT 3 3]
    set num10glinks 0
    foreach trunkPort $TrunkPortList1to2 {
	if { [<a name="::getDutPortSpeed(1)"><a href="./misc.tcl.html#::getDutPortSpeed_3328">::getDutPortSpeed</a></a> -dut $dut1 -port $trunkPort] == 10000 } {
	    <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$trunkPort on $firstDUT is 10Gig link.&#34;
	    incr num10glinks
	}
    }
    if { ($num10glinks == 0) || ($num10glinks == [llength $TrunkPortList1to2]) } {
	<span class="comment-line"># All or none links are 10gig. Loadshare is supported, continue with rest of function to validate...</span>
    } else {
	<a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;At least one link is 10gig, loadshare is not supported.&#34;
	return 0
    }

    <span class="comment-line"># For build greater than 11.6 load share ports with different link speeds are supported</span>
    if {([<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> $firstDUT 2]&gt;&#34;11.6&#34;) &amp;&amp; ([<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> $secondDUT 2]&gt;&#34;11.6&#34;)} {
       <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; Leaving ValidateTrunkLinkForLoadshare, build greater than 11.6&#34;
       return 1
    }

    <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info($firstDUT,connect)
    foreach trunkPort $TrunkPortList1to2 {
	set parameterList &#34;&#34;
	lappend parameterList &#34;$trunkPort 6&#34;
	set trunkPortSpeedToTrim [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show port $trunkPort configuration&#34; $parameterList]
	set trunkPortSpeed [string trim $trunkPortSpeedToTrim &#34;{} #&#34;]
	<a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;trunkPortSpeed :: $trunkPortSpeed&#34;
	lappend trunkSpeedList1 $trunkPortSpeed
	<a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;trunkSpeedList1 :: $trunkSpeedList1&#34;
    }
    
    <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info($secondDUT,connect)
    foreach trunkPort $TrunkPortList2to1 {
	set parameterList &#34;&#34;
	lappend parameterList &#34;$trunkPort 6&#34;
	set trunkPortSpeedToTrim [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show port $trunkPort configuration&#34; $parameterList]
	set trunkPortSpeed [string trim $trunkPortSpeedToTrim &#34;{} #&#34;]
	<a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;trunkPortSpeed :: $trunkPortSpeed&#34;
	lappend trunkSpeedList2 $trunkPortSpeed
	<a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;trunkSpeedList2 :: $trunkSpeedList2&#34;
    }

    <span class="comment-line"># Figure out which trunk links are not equal speed, if any.</span>
    if { [llength $trunkSpeedList1] == 2 } {
	<span class="comment-line"># 2 trunk links between the dut's...</span>
	set trunk1 [lindex $trunkSpeedList1 0]
	set trunk2 [lindex $trunkSpeedList1 1]
	set allPairs &#34;{$trunk1 $trunk2}&#34;
    } else {
	<span class="comment-line"># 3 trunk links between the dut's...</span>
	set trunk1 [lindex $trunkSpeedList1 0]
	set trunk2 [lindex $trunkSpeedList1 1]
	set trunk3 [lindex $trunkSpeedList1 2]
	set allPairs &#34;{$trunk1 $trunk2} {$trunk1 $trunk3} {$trunk2 $trunk3}&#34;
    }
    foreach numberPair $allPairs {
	if { [lindex $numberPair 0] != [lindex $numberPair 1] } {
	    lappend diffSpeedList1 &#34;diff&#34;
	} else {
	    lappend diffSpeedList1 &#34;same&#34;
	}
    }

    <span class="comment-line"># If all trunk ports are same speed then no need to continue.........</span>
    if { ![regexp &#34;diff&#34; $diffSpeedList1] } {
	<a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;All trunk links between the two DUT's are equal speed. Continuing with testcase.&#34;
	return 1
    }

    <span class="comment-line"># This corresponds to link1/2, link 1/3, link 2/3 comparisons</span>
    switch $diffSpeedList1 {
	&#34;diff&#34; {
	    <span class="comment-line"># Only 2 links between the dut's and they dont match</span>
	    set returnVal [<a name="::TryAutoNeg(1)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk1 $trunk2 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	}
	&#34;diff same same&#34; {
	    <span class="comment-line"># Trunk links 1&amp;2 dont match, others all match</span>
	    set returnVal [<a name="::TryAutoNeg(2)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk1 $trunk2 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	}
	&#34;same diff same&#34; {
	    <span class="comment-line"># Trunk links 1&amp;3 dont match, others all match</span>
	    set returnVal [<a name="::TryAutoNeg(3)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk1 $trunk3 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	}
	&#34;same same diff&#34; {
	    <span class="comment-line"># Trunk links 2&amp;3 dont match, others all match</span>
	    set returnVal [<a name="::TryAutoNeg(4)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk2 $trunk3 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	}
	&#34;diff diff same&#34; {
	    <span class="comment-line"># Trunk links 1&amp;2 and 1&amp;3 dont match, 2&amp;3 matches.</span>
	    set returnVal1 [<a name="::TryAutoNeg(5)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk1 $trunk2 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	    set returnVal2 [<a name="::TryAutoNeg(6)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk1 $trunk3 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	    if { ($returnVal1 == 1) &amp;&amp; ($returnVal2 == 1) } {
		set returnVal 1
	    } else {
		set returnVal 0
	    }
	}
	&#34;same diff diff&#34; {
	    <span class="comment-line"># Trunk links 1&amp;3 and 2&amp;3 dont match, 1&amp;2 matches.</span>
	    set returnVal1 [<a name="::TryAutoNeg(7)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk1 $trunk3 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	    set returnVal2 [<a name="::TryAutoNeg(8)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk2 $trunk3 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	    if { ($returnVal1 == 1) &amp;&amp; ($returnVal2 == 1) } {
		set returnVal 1
	    } else {
		set returnVal 0
	    }
	}
	&#34;diff diff diff&#34; {
	    <span class="comment-line"># None of the links match</span>
	    set returnVal1 [<a name="::TryAutoNeg(9)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk1 $trunk2 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	    set returnVal2 [<a name="::TryAutoNeg(10)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk1 $trunk3 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	    set returnVal3 [<a name="::TryAutoNeg(11)"><a href="./loadShareUtil.tcl.html#::TryAutoNeg_761">::TryAutoNeg</a></a> $trunk2 $trunk3 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]
	    if { ($returnVal1 == 1) &amp;&amp; ($returnVal2 == 1) &amp;&amp; ($returnVal3 == 1) } {
		set returnVal 1
	    } else {
		set returnVal 0
	    }
	}
    }

    return $returnVal
}

<span class="comment-line">####################################################</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: ValidateLinkSpeedtoIxia</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#              Determine if links between DUT1 and IXIA are connected with 10Gig Links.</span>
<span class="comment-line">#</span>
<span class="comment-line">#    </span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              {firstDUT &#34;DUT1&#34;}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              1 if links connected to IXIA from DUT1 are  all  10Gig links nor a single 10Gig link</span>
<span class="comment-line">#              0 if one of links connected from DUT1 to IXIA is 10Gig link</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              Inside a testcase:</span>
<span class="comment-line">#                 if { ![ValidateLinkSpeedtoIxia  DUT1] } {</span>
<span class="comment-line">#                      result_ok &#34;Skipping this testcase because one of the links of is 10Gig link.&#34;</span>
<span class="comment-line">#                      return</span>
<span class="comment-line">#                 }</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Testcase validation</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::ValidateLinkSpeedtoIxia_688">proc <a href="loadShareUtil.tcl-annot.html#::::ValidateLinkSpeedtoIxia">::::ValidateLinkSpeedtoIxia</a></a></strong> { {firstDUT &#34;DUT1&#34;} } {

global DUTs_info
global portMappingList
set DUT_num [string range $firstDUT 3 3]

set Counter 0
    <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Verifying that $firstDUT and IXIA links contain 10Gig&#34;


foreach item $portMappingList {

	if  { [lindex $item 2] == $DUT_num } {
	incr Counter

}   

}

puts $Counter 
for {set i 1} {$i &lt;= $Counter } {incr i} {

	lappend portMapList &#34;[<a name="::MapDUTPortId(9)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $i]&#34;

	}

set num10glinks 0

for {set i 0} {$i &lt; [llength $portMapList]} {incr i} {


if { [<a name="::getDutPortSpeed(2)"><a href="./misc.tcl.html#::getDutPortSpeed_3328">::getDutPortSpeed</a></a> -dut 1 -port [lindex $portMapList $i]] == 10000  } {
        
	<a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; [lindex $portMapList $i]  on $firstDUT is 10Gig link.&#34;
	incr num10glinks

}

}

<a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Number of 10Gig Links present are $num10glinks out of [llength $portMapList] connected to IXIA from DUT1&#34;
if { ($num10glinks == 0) || ($num10glinks == [llength $portMapList])} {

	return 1

} else {
	return 0 

}

}
<span class="comment-line">######################################################</span>



<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: TryAutoNeg</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#              See if setting autonegotiation on 2 trunk links is allowed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              Speed of each trunk link and the trunk ports themselves</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              1 if config autonegotiation was successful</span>
<span class="comment-line">#              0 if config autonegotiation was not successful</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    set returnVal1 [TryAutoNeg $trunk1 $trunk2 $TrunkPortList1to2 $TrunkPortList2to1 $firstDUT $secondDUT]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Config</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::TryAutoNeg_761">proc <a href="loadShareUtil.tcl-annot.html#::::TryAutoNeg">::::TryAutoNeg</a></a></strong> { port1speed port2speed TrunkPortList1to2 TrunkPortList2to1 firstDUT secondDUT} {
    global DUTs_info

    if { $port1speed != $port2speed } {
	if { $port1speed &lt; $port2speed } {
	    set portSpeed $port1speed
	} else {
	    set portSpeed $port2speed
	}
	<a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info($firstDUT,connect)
	foreach trunkPort $TrunkPortList1to2 {
	    set DUT1buf [string tolower [<a name="::CheckCmdLegal(1)"><a href="./checkCmdLegality.tcl.html#::CheckCmdLegal_58">::CheckCmdLegal</a></a> &#34;configure port $trunkPort auto off speed $portSpeed duplex full&#34; NULL CheckCmdLegal 0]]
	    <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DUT1buf=$DUT1buf&#34;
            <span class="comment-line"># regexp replaing with if. Using regexp caused problem </span>
            if { $DUT1buf == &#34;illegal&#34; } {	
	        <a name="::result_ok(10)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Trunk links of different speeds not supported. Skipping test&#34;
		<a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info($firstDUT,connect)
		foreach trunkPort $TrunkPortList1to2 { <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure port $trunkPort auto on&#34;   }
		<a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info($secondDUT,connect)
		foreach trunkPort $TrunkPortList2to1 { <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure port $trunkPort auto on&#34;   }
		return 0
	    }
	}
	<a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info($secondDUT,connect)
	foreach trunkPort $TrunkPortList2to1 {
	    set DUT2buf [string tolower [<a name="::CheckCmdLegal(2)"><a href="./checkCmdLegality.tcl.html#::CheckCmdLegal_58">::CheckCmdLegal</a></a> &#34;configure port $trunkPort auto off speed $portSpeed duplex full&#34; NULL CheckCmdLegal 0]]
	    <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;DUT2buf=$DUT2buf&#34;
            <span class="comment-line"># regexp replaing with if. Using regexp caused problem </span>
            if { $DUT2buf == &#34;illegal&#34; } {	
		<a name="::result_ok(11)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Trunk links of different speeds not supported. Skipping test&#34;
		<a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info($firstDUT,connect)
		foreach trunkPort $TrunkPortList1to2 { <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure port $trunkPort auto on&#34;   }
		<a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info($secondDUT,connect)
		foreach trunkPort $TrunkPortList2to1 { <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure port $trunkPort auto on&#34;   }
		return 0
	    }
	}
    }
    return 1
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This proc can be used to send any L2/L3 unicast/multicast</span>
<span class="comment-line">#	packets and verify their forwarding over one of the Load </span>
<span class="comment-line">#       Shared ports in a LS group. </span>
<span class="comment-line">#       In checkPortList input, for receiving port 1 packet</span>
<span class="comment-line">#       is expected to be received.</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       lappend checkPortList &#34;6 forwarded&#34;</span>
<span class="comment-line">#	CheckForwardingLS4SinglePort -txPortId 9 -rxPortId 0 -checkPortList \</span>
<span class="comment-line">#              $checkPortList -numIpFrame 7 -protocol &#34;tcp&#34; -dIpAddr \</span>
<span class="comment-line">#              &#34;192.168.0.18&#34; -sIpAddr &#34;24.3.89.146&#34; -dPort 21 \</span>
<span class="comment-line">#              -gIpAddr &#34;24.3.89.145&#34; -filePt $fd_res \</span>
<span class="comment-line">#              -ttlDecr 2 -comment &#34;- redi.&#34; -ipDaMode &#34;ipIncrHost&#34;</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################  </span>
<strong><a name="::::CheckForwardingLS4SinglePort_820">proc <a href="loadShareUtil.tcl-annot.html#::::CheckForwardingLS4SinglePort">::::CheckForwardingLS4SinglePort</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckForwardingLS4SinglePort $args {
     txPortId &#34;1&#34;
     rxPortId &#34;0&#34;    ;<span class="comment-line">#default not sending learn arp, otherwise use this port as the 2nd arp port</span>
     <a name="::protocol(1)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
     tag      &#34;none&#34;
     generateArpReq &#34;1&#34;
     inSaMac &#34;00:00:01:A1:00:01&#34;
     inDaMac &#34;FF:FF:FF:FF:FF:FF&#34;
     sIpAddr &#34;127.0.0.1&#34;
     dIpAddr &#34;127.0.0.1&#34;
     gIpAddr &#34;0.0.0.0&#34;     ;<span class="comment-line">#gateway address</span>
     sPort &#34;0&#34;
     dPort &#34;0&#34;
     frameSize &#34;64&#34;
     icmpType &#34;0&#34;
     icmpCode &#34;0&#34;
     dontFrag &#34;true&#34;
     ttl &#34;64&#34;
     ttlDecr &#34;1&#34;
     checkPortList {&#34;2 forwarded&#34;}
     numLearnFrame &#34;1&#34;
     numIpFrame &#34;1&#34;
     filePt &#34;NULL&#34;
     ipDaMode &#34;ipIdle&#34;
     ipSaMode &#34;ipIdle&#34;
     ipDaCount &#34;&#34;
     ethernetType &#34;noType&#34;
     frameType &#34;08 00&#34;
     ipSaCount &#34;&#34;
     ipOptions &#34;&#34;
     tcpSynFlag &#34;false&#34;
     tcpFinFlag &#34;false&#34;
     tcpRstFlag &#34;false&#34;
     tcpAckFlag &#34;false&#34;
     tcpPushFlag &#34;false&#34;
     tcpUrgFlag &#34;false&#34;
     checkMirroringTag &#34;yes&#34;
     mirroringPort &#34;0&#34;
     TOS &#34;default&#34;
     userPriority &#34;0&#34;
     CRC &#34;good&#34;
     comment &#34;&#34;
     rate &#34;null&#34;
     udfEnable &#34;false&#34;
     udfInitval &#34;00&#34;
     udfOffset &#34;0&#34;
     udfCountertype &#34;c8&#34;
     udfContinuousCount &#34;false&#34;
     loadShareType &#34;SA&#34;
   }

   set rc 0

   if { $gIpAddr == &#34;0.0.0.0&#34; } { set gIpAddr $dIpAddr }

   set pPattern &#34;abcd&#34;   

   if {$rxPortId == $txPortId} {
      <a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invalid port specification: txPortId=rxPortId&#34;
      return
   }
   foreach checkPort $checkPortList {
      lappend portMonitorList [lindex $checkPort 0]
   }
   
   <a name="::ClearPortsStats(3)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portMonitorList
   if {[lindex $tag 0]!=&#34;none&#34;&amp;&amp;$frameSize==64} {set frameSize 68}
   switch -- $protocol {
      &#34;mac&#34; -
      &#34;ipx&#34; -
      &#34;mac_ip&#34; -
      &#34;arp&#34; -
      &#34;multicastControl&#34; {
         <a name="::report_start_test(12)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Frame $protocol L2 forwarding check on Txport $txPortId $comment&#34;
         <span class="comment-line">#turn on capturing function on all the monitor ports</span>
         <a name="::StartPortsCapture(1)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portMonitorList
         switch -- $protocol {
            &#34;mac&#34; -
            &#34;mac_ip&#34; -
            &#34;ipx&#34; {
               set prot $protocol
               set rxTag &#34;none&#34;
               if {[llength $tag] &gt; 1} { set rxTag [lindex $tag 1] }
               if {$prot == &#34;mac_ip&#34; } {set prot &#34;ip&#34;}
               if {$rxPortId &gt; 0} {
                  <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Send a $prot packet on port $rxPortId for fdb to learn the destination&#34;
		  if {$CRC == &#34;bad&#34;} {
			set frameSent [<a name="::SendFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -frameRate $rate -txPortId $rxPortId -protocol $prot -tag $rxTag -fcsError $CRC -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
		  } elseif {$inDaMac == &#34;FF:FF:FF:FF:FF:FF&#34;} {
	                set frameSent [<a name="::SendFrame(3)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -frameRate $rate -txPortId $rxPortId -protocol $prot -tag $rxTag -frameRate 10 -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]

		  } else {
	                set frameSent [<a name="::SendFrame(4)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -sourceMac $inDaMac -frameRate $rate -txPortId $rxPortId -protocol $prot -tag $rxTag -frameRate 10 -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
                  }
                  <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;
                  set inDaMac [<a name="::GetSourceMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameSent]
               }
               <span class="comment-line">#sending mac frame</span>
	       <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frame ($protocol) sent on portId $txPortId:&#34;
	       if {$CRC == &#34;bad&#34;} {
               set frameSent [<a name="::SendFrame(5)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -frameRate $rate -txPortId $txPortId -dataPattern $pPattern -tag [lindex $tag 0] \
                              -sourceMac $inSaMac  -destMac $inDaMac -frameSize $frameSize -protocol $prot  \
                              -frameType $frameType -ethernetType $ethernetType \
                              -numFrames $numIpFrame -fcsError $CRC -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
	       } else {
	       set frameSent [<a name="::SendFrame(6)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -frameRate $rate -txPortId $txPortId -dataPattern $pPattern -tag [lindex $tag 0] \
                              -sourceMac $inSaMac  -destMac $inDaMac -frameSize $frameSize -protocol $prot  \
                              -frameType $frameType -ethernetType $ethernetType \
                              -numFrames $numIpFrame -frameRate 10 -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
	       }
	       <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;
            }
            &#34;arp&#34; {
            <span class="comment-line">#sending arp frame</span>
		
	    if {$CRC == &#34;bad&#34;} {
		set frameSent [<a name="::SendArpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $txPortId -sourceIp $sIpAddr \
                           -destIp $dIpAddr -tag $tag -fcsError $CRC -numFrames $numIpFrame ]
	    } else {	
		set frameSent [<a name="::SendArpFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $txPortId -sourceIp $sIpAddr \
                           -destIp $dIpAddr -tag $tag -numFrames $numIpFrame]
	    }

            }
            &#34;multicastControl&#34; {
            <span class="comment-line">#send an join multicast group igmp packet</span>
            set membershipQuerry 17
	    if {$CRC == &#34;bad&#34; } {
		set frameSent [<a name="::SendIgmpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendIgmpFrame_867">::SendIgmpFrame</a></a> -txPortId $txPortId -type $membershipQuerry -destMac $inDaMac \
                           -sourceIp  $sIpAddr  -destIp $dIpAddr -groupAddr $dIpAddr -fcsError $CRC \
                           -dontFrag $dontFrag \
                           -numFrames $numIpFrame -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
	    } else {
		set frameSent [<a name="::SendIgmpFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendIgmpFrame_867">::SendIgmpFrame</a></a> -txPortId $txPortId -type $membershipQuerry -destMac $inDaMac \
                           -sourceIp  $sIpAddr  -destIp $dIpAddr -groupAddr $dIpAddr  \
                           -dontFrag $dontFrag \
                           -numFrames $numIpFrame -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
	    }

            }
         }
         set numExpectedFrame $numIpFrame
         <span class="comment-line">#retrieve data</span>
 
         foreach portId $portMonitorList {
           set numPacketReceived($portId) 0
           set rawPortData [<a name="::GetCapturedFrames(1)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portId]
           foreach frameReceived $rawPortData {
               <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frames received on portId $portId:&#34;
               <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameReceived&#34;
               if {($checkMirroringTag == &#34;no&#34;) &amp;&amp; ($mirroringPort == $portId)} {
                   if { [<a name="::CompareFrame(1)"><a href="./ePTForwarding.tcl.html#::CompareFrame_789">::CompareFrame</a></a> $frameSent $frameReceived 0] } {
                      incr numPacketReceived($portId) 1      
                   }            
               } else { 
                   if { [<a name="::CompareFrame(2)"><a href="./ePTForwarding.tcl.html#::CompareFrame_789">::CompareFrame</a></a> $frameSent $frameReceived 0] &amp;&amp; [<a name="::CheckTag(1)"><a href="./ePTForwarding.tcl.html#::CheckTag_978">::CheckTag</a></a> $frameReceived [lindex $tag 1] ] } {
                      incr numPacketReceived($portId) 1
                   }
               }    
           }
           <a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numPacketReceived($portId)= $numPacketReceived($portId)&#34; 
        }
      }
      &#34;ip&#34; -
      &#34;icmp&#34; -
      &#34;udp&#34; -
      &#34;tcp&#34; -
      &#34;multicast&#34; {
         if { $ttlDecr == 0 } { <a name="::report_start_test(13)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Packet $protocol L2 forwarding check on Txport $txPortId $comment&#34;
         } elseif { $ttlDecr == 1} { <a name="::report_start_test(14)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Packet $protocol L3 forwarding check on Txport $txPortId $comment&#34;
         } elseif { $ttlDecr == &#34;ignore&#34;} { <a name="::report_start_test(15)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Packet $protocol forwarding check on Txport $txPortId $comment&#34;
         } else { <a name="::report_start_test(16)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Packet $protocol forwarding check with TTL decr $ttlDecr on Txport $txPortId $comment&#34; }
         <span class="comment-line">#set to user input, will be overwritten when using learn_arp function</span>
         set destMacAddrTx $inDaMac

         if {$protocol == &#34;multicast&#34; } {
            if {[<a name="::GetVersion(3)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1 4] &lt; &#34;6.2.1&#34; } {
              <span class="comment-line">#send an multicast ip packet, 1st packet is flooded on the vlan, just ignore</span>
              set frameSent [<a name="::SendIpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPortId -protocol &#34;udp&#34; -dataPattern $pPattern \
                  -destMac $inDaMac -sourceIp $sIpAddr  -destIp $dIpAddr -ttl $ttl -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
              <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;1st Frame ($protocol) sent on portId $txPortId: (will be flooded)&#34;
              <a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;
            }  
            set protocol &#34;udp&#34;
            set rxPortId 0
            set generateArpReq 0
         }
         set rxTag &#34;none&#34;
         if {[llength $tag] &gt; 1} { set rxTag [lindex $tag 1] }
         set txTag [lindex $tag 0]
         
         <span class="comment-line">#enable protocol server for the Rx port, to reponse to ARP request</span>
         if {$rxPortId &gt; 0} {
            <a name="::SaveAndSetProtocolServer(1)"><a href="./ixiaProtSrv.tcl.html#::SaveAndSetProtocolServer_1235">::SaveAndSetProtocolServer</a></a> $rxPortId $dIpAddr $dIpAddr ixInfo \
               -arpService true -tag $rxTag
               if {[lindex $tag 1]!=&#34;&#34;} {
                  <span class="comment-line"># Send ARP from the rxPortId, because Arp req to any </span>
                  <span class="comment-line"># Load Share group will do.</span>
                  <a name="::SendArpFrame(3)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $rxPortId -tag [lindex $tag 1] -sourceIp $dIpAddr
               } else {
                  <a name="::SendArpFrame(4)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $rxPortId -sourceIp $dIpAddr
               }

               if {[regexp -nocase &#34;bd&#34; [<a name="::GetPlatform(4)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>]] &amp;&amp; [<a name="::GetHardwareType(1)"><a href="./misc.tcl.html#::GetHardwareType_560">::GetHardwareType</a></a>] == &#34;OLD_GEN&#34; } {
                  <a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sending a mac frame for hardware to learn mac first - timing problem&#34;
                  <a name="::SendFrame(7)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $rxPortId
                  }
         }
         <span class="comment-line">#request mac to send ip packet</span>
         if { $generateArpReq == 1} {
           <span class="comment-line">#this section is being implemented this way for the old gen BD</span>
           <span class="comment-line">#since it require 2 arp requests separated by about 1ms </span>
           <span class="comment-line">#in order for the ipf table to get updated</span>
           
           for {set index 0} {$index &lt; $numLearnFrame} { incr index } {
              set destMacAddrTx [<a name="::SendArpRequest(1)"><a href="./ePTSendPacket.tcl.html#::SendArpRequest_1127">::SendArpRequest</a></a> $txPortId $sIpAddr $gIpAddr $txTag]
           }
           <span class="comment-line">#need to set this to some invalid mac, otherwise ixia send function won't return</span>
           if {$destMacAddrTx == &#34;NO_ARP_REPLY&#34; } {
               set destMacAddrTx &#34;00 00 00 00 00 00&#34;
               if {$dIpAddr == &#34;255.255.255.255&#34;} {
                  set destMacAddrTx &#34;FF FF FF FF FF FF&#34;
               }
           }
         }
         <span class="comment-line">#Send arp request from dPort for numIpFrame</span>
         if {($ipDaMode == &#34;ipIncrHost&#34;) &amp;&amp; \
             ($rxPortId != 0)} {
            set firstPart [string range $dIpAddr 0 [string last . $dIpAddr]]
            set lastPart [string range $dIpAddr [expr [string last . $dIpAddr] +1] [string length $dIpAddr]]
            if {$ipDaCount == &#34;&#34;} {
                set numArps $numIpFrame
            } else {
                set numArps $ipDaCount
            }
            for {set i 1} {$i &lt;= $numArps} {incr i} {
               set tmpIpAddr [format &#34;%s%s&#34; $firstPart $lastPart]
               <span class="comment-line">#sending arp frame</span>
               set frameSent [<a name="::SendArpFrame(5)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $rxPortId -sourceIp $tmpIpAddr \
                              -destIp $gIpAddr]

               set lastPart [expr $lastPart + 1]
            }

            <span class="comment-line"># Set numIpFrame to be 1 as doesn't seem to send more, verify!!</span>
            <span class="comment-line">#set numIpFrame 1</span>
         }

         <span class="comment-line"># Send a single IP frame to seed the FDB, IP ARP, and IP FDB tables.</span>
         if {$rxPortId &gt; 0 &amp;&amp; $numIpFrame &gt; 1} {
             <a name="::SendIpFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPortId -sourceIp $sIpAddr \
                         -destMac $destMacAddrTx -gatewayIp $gIpAddr \
                         -rxPortId $rxPortId -destIp $dIpAddr
         }

         <span class="comment-line">#turn on capturing function on all the monitor ports</span>
         <a name="::StartPortsCapture(2)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portMonitorList
         
         <span class="comment-line">#send packets</span>
         <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n$numIpFrame Frames ($protocol) sent on portId $txPortId:&#34;
         set frameSent [<a name="::SendIpFrame(3)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPortId -protocol $protocol -tag $txTag \
                        -frameType $frameType \
                        -destPort $dPort -sourcePort $sPort \
                        -ipDaMode $ipDaMode -ipDaCount $ipDaCount \
                        -ipSaMode $ipSaMode -ipSaCount $ipSaCount \
                        -TOS $TOS -userPriority $userPriority  -dontFrag $dontFrag \
                        -type $icmpType -code $icmpCode -ttl $ttl \
                        -tcpSynFlag $tcpSynFlag -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag -tcpAckFlag $tcpAckFlag \
                 -tcpPushFlag $tcpPushFlag -tcpUrgFlag $tcpUrgFlag \
                        -dataPattern $pPattern -numFrames $numIpFrame -frameSize $frameSize -sourceMac $inSaMac \
                        -destMac $destMacAddrTx -sourceIp $sIpAddr  -destIp $dIpAddr -ipOptions $ipOptions -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
         <a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;
         set numExpectedFrame $numIpFrame
         <span class="comment-line">#retrieve data</span>
         foreach portId $portMonitorList {
           set numPacketReceived($portId) 0
           set rawPortData [<a name="::GetCapturedFrames(2)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portId]
           foreach frameReceived $rawPortData {
               <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frames received on portId $portId:&#34;
               <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameReceived&#34;
               if { [<a name="::CompareFrame(3)"><a href="./ePTForwarding.tcl.html#::CompareFrame_789">::CompareFrame</a></a> $frameSent $frameReceived $ttlDecr $ipDaMode $ipSaMode] &amp;&amp; \
                    [<a name="::CheckTag(2)"><a href="./ePTForwarding.tcl.html#::CheckTag_978">::CheckTag</a></a> $frameReceived [lindex $tag 1] ] } {
                  incr numPacketReceived($portId) 1
               }
           }
           <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numPacketReceived($portId)= $numPacketReceived($portId)&#34;
        }
        <span class="comment-line"># Restore the protocol server to its state before calling CheckForwardingLoadShare.</span>
        if {$rxPortId &gt; 0} {
           <a name="::RestoreSavedProtocolServer(1)"><a href="./ixiaProtSrv.tcl.html#::RestoreSavedProtocolServer_1346">::RestoreSavedProtocolServer</a></a> ixInfo
        }

      }
      &#34;proxyArp&#34; {
         <a name="::report_start_test(17)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Proxy-ARP forwarding check on Txport $txPortId $comment&#34;
         
         <span class="comment-line">#turn on capturing function on all the monitor ports</span>
         <a name="::StartPortsCapture(3)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portMonitorList
         
         <a name="::result_debug(42)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frame (arp) sent on portId $txPortId:&#34;
<span class="comment-line">#         result_debug &#34;$frameSent&#34;</span>
         
         <span class="comment-line">#sending arp frame</span>
         <span class="comment-line">#this section is being implemented this way for the old gen BD</span>
         <span class="comment-line">#since it require 2 arp requests separated by about 1ms </span>
         <span class="comment-line">#in order for the ipf table to get updated</span>
         for {set index 0} {$index &lt; $numLearnFrame} { incr index } {
             set frameSent [<a name="::SendArpFrame(6)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $txPortId -sourceIp $sIpAddr \
                            -destIp $dIpAddr -tag $tag]
         }
         <span class="comment-line">#this is set to 1 for any numLearnFrame, since this sendArpFrame will</span>
         <span class="comment-line">#reset the port capturing, a feature in ixia sending function that should be removed</span>
         set numExpectedFrame $numLearnFrame
         <span class="comment-line">#retrieve data</span>
         foreach portId $portMonitorList {
            set numPacketReceived($portId) 0
            set rawPortData [<a name="::GetCapturedFrames(3)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portId]
            set sourceMac [<a name="::GetDUTMac(1)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT1&#34; &#34; &#34;]
            foreach frameReceived $rawPortData {
               <a name="::result_debug(43)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frames received on portId $portId:&#34;
               <a name="::result_debug(44)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameReceived&#34;
               <a name="::result_debug(45)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;sourceMac:$sourceMac| sMACRecv:[<a name="::GetSourceMacAddress(2)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameReceived]|&#34;
               if { $sourceMac == [<a name="::GetSourceMacAddress(3)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameReceived] } {
                  <a name="::result_debug(46)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;sIPRecv: [<a name="::GetSourceIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frameReceived] sIPSent: [<a name="::GetSourceIPAddress(2)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frameSent]&#34;
                  <a name="::result_debug(47)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;dIPRecv: [<a name="::GetDestIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameReceived] dIPSent: [<a name="::GetDestIPAddress(2)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameSent]&#34;
                  if { [<a name="::GetMessageType(1)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $frameReceived] == &#34;ARP_REQUEST&#34; } {
                     if { ([<a name="::GetSourceIPAddress(3)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frameReceived] == $gIpAddr) &amp;&amp; \
                          ([<a name="::GetTargetMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetTargetMacAddress_159">::GetTargetMacAddress</a></a> $frameReceived] == &#34;00 00 00 00 00 00&#34;) &amp;&amp; \
                           ([<a name="::GetDestIPAddress(3)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameReceived] == [<a name="::GetDestIPAddress(4)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameSent]) } {
                         incr numPacketReceived($portId) 1
                     }
                  }
               }
            }
            <a name="::result_debug(48)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numPacketReceived($portId)= $numPacketReceived($portId)&#34; 
         }
      }
      default {
         <a name="::report_start_test(18)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Unknown protocol $protocol $comment&#34;
         <a name="::result_error(12)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invalid protocol.&#34;
      }
   }

   <span class="comment-line">#now check received data against checkList to see if matched</span>
   set testResult &#34;good&#34;
   foreach checkPort $checkPortList {
      set portId [lindex $checkPort 0]
      set portFlag [lindex $checkPort 1]
      set expectedRange &#34;exact&#34;
      switch -- $portFlag \
         &#34;forwarded&#34; {
            if {[lindex $checkPort 2] == &#34;&#34;} {
              set expectedPacket $numExpectedFrame
            } else {  
              set expectedPacket [lindex $checkPort 2]
              if { [lindex $checkPort 3] != &#34;&#34;} { 
                 set expectedRange [lindex $checkPort 3] ;<span class="comment-line"># could be up or down</span>
              }  
            }   
      }  &#34;notForwarded&#34; {
            set expectedPacket 0
      }  default {
            set expectedPacket $portFlag
      }
                        
           if { ($numPacketReceived($portId) == $expectedPacket) } {
              <a name="::result_debug(49)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Forwarding on port $portId checked Ok ($numPacketReceived($portId)). Was $portFlag&#34;
              set rc $portId
           }
   }

   <a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

<a name="::result_debug(50)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;returning rc value $rc&#34;
<a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2 
   return $rc
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This proc can be used to send any L2/L3 unicast/multicast</span>
<span class="comment-line">#	packets and verify their forwarding over Load Shared ports. </span>
<span class="comment-line">#       In checkPortList input, for each receiving port 1 packets </span>
<span class="comment-line">#       is expected to be received.</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># 	set checkPortList &#34;5 6 7 8&#34;</span>
<span class="comment-line">#	CheckForwardingLoadShare -txPortId 9 -rxPortId 0 -checkPortList \</span>
<span class="comment-line">#              $checkPortList -numIpFrame 7 -protocol &#34;tcp&#34; -dIpAddr \</span>
<span class="comment-line">#              &#34;192.168.0.18&#34; -sIpAddr &#34;24.3.89.146&#34; -dPort 21 \</span>
<span class="comment-line">#              -gIpAddr &#34;24.3.89.145&#34; -filePt $fd_res \</span>
<span class="comment-line">#              -ttlDecr 2 -comment &#34;- redi.&#34; -ipDaMode &#34;ipIncrHost&#34;</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################  </span>
<strong><a name="::::CheckForwardingLoadShare_1216">proc <a href="loadShareUtil.tcl-annot.html#::::CheckForwardingLoadShare">::::CheckForwardingLoadShare</a></a></strong> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckForwardingLoadShare $args {
     txPortId &#34;1&#34;
     rxPortId &#34;0&#34;    ;<span class="comment-line">#default not sending learn arp, otherwise use this port as the 2nd arp port</span>
     <a name="::protocol(2)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
     tag      &#34;none&#34;
     generateArpReq &#34;1&#34;
     inSaMac &#34;00:00:01:A1:00:01&#34;
     inDaMac &#34;FF:FF:FF:FF:FF:FF&#34;
     sIpAddr &#34;127.0.0.1&#34;
     dIpAddr &#34;127.0.0.1&#34;
     gIpAddr &#34;0.0.0.0&#34;     ;<span class="comment-line">#gateway address</span>
     sPort &#34;0&#34;
     dPort &#34;0&#34;
     frameSize &#34;64&#34;
     icmpType &#34;0&#34;
     icmpCode &#34;0&#34;
     dontFrag &#34;true&#34;
     ttl &#34;64&#34;
     ttlDecr &#34;1&#34;
     checkPortList {&#34;2 forwarded 1 exact&#34;}
     numLearnFrame &#34;1&#34;
     filePt &#34;NULL&#34;
     ethernetType &#34;noType&#34;
     frameType &#34;08 00&#34;
     ipOptions &#34;&#34;
     tcpSynFlag &#34;false&#34;
     tcpFinFlag &#34;false&#34;
     tcpRstFlag &#34;false&#34;
     tcpAckFlag &#34;false&#34;
     tcpPushFlag &#34;false&#34;
     tcpUrgFlag &#34;false&#34;
     checkMirroringTag &#34;yes&#34;
     mirroringPort &#34;0&#34;
     TOS &#34;default&#34;
     userPriority &#34;0&#34;
     CRC &#34;good&#34;
     comment &#34;&#34;
     rate &#34;null&#34;
     udfEnable &#34;false&#34;
     udfInitval &#34;00&#34;
     udfOffset &#34;0&#34;
     udfCountertype &#34;c8&#34;
     udfContinuousCount &#34;false&#34;
     loadShareType &#34;SA&#34;
   }

   foreach checkPort $checkPortList {
      set statusRxPort($checkPort) 0
      lappend checkPortForwList &#34;$checkPort forwarded&#34;
   }

   switch -- $loadShareType {
     &#34;IPSA&#34; {
         set txIpSrcAddr $sIpAddr
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingLS4SinglePort(1)"><a href="./loadShareUtil.tcl.html#::CheckForwardingLS4SinglePort_820">::CheckForwardingLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -tag $tag \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $inDaMac -sIpAddr $txIpSrcAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -userPriority $userPriority -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             set txIpSrcAddr [<a name="::incrIpAddr(1)"><a href="./loadShareUtil.tcl.html#::incrIpAddr_1456">::incrIpAddr</a></a> -ipAddr $txIpSrcAddr]
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
             <a name="::result_debug(51)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;txIpSrcAddr $txIpSrcAddr&#34;
         }
      }
     &#34;IPDA&#34; {
         set txIpDstAddr $dIpAddr
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingLS4SinglePort(2)"><a href="./loadShareUtil.tcl.html#::CheckForwardingLS4SinglePort_820">::CheckForwardingLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -tag $tag \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $inDaMac -sIpAddr $sIpAddr -dIpAddr $txIpDstAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -userPriority $userPriority -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             set txIpDstAddr [<a name="::incrIpAddr(2)"><a href="./loadShareUtil.tcl.html#::incrIpAddr_1456">::incrIpAddr</a></a> -ipAddr $txIpDstAddr]
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
         }
      }
     &#34;L4SRCPORT&#34; {
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingLS4SinglePort(3)"><a href="./loadShareUtil.tcl.html#::CheckForwardingLS4SinglePort_820">::CheckForwardingLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -tag $tag \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $inDaMac -sIpAddr $sIpAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -userPriority $userPriority -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             incr sPort
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
         }
      }
     &#34;L4DSTPORT&#34; {
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingLS4SinglePort(4)"><a href="./loadShareUtil.tcl.html#::CheckForwardingLS4SinglePort_820">::CheckForwardingLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -tag $tag \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $inDaMac -sIpAddr $sIpAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -userPriority $userPriority -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             incr dPort
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
         }
      }
     &#34;DA&#34; {
         set txMacDstAddr $inDaMac
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingLS4SinglePort(5)"><a href="./loadShareUtil.tcl.html#::CheckForwardingLS4SinglePort_820">::CheckForwardingLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -tag $tag \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $txMacDstAddr -sIpAddr $sIpAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -userPriority $userPriority -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             set txMacDstAddr [<a name="::incrMacAddr(1)"><a href="./loadShareUtil.tcl.html#::incrMacAddr_1483">::incrMacAddr</a></a> -macAddr $txMacDstAddr]
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
         }
      }
     &#34;SA&#34; - 
     default {
         set txMacSrcAddr $inSaMac
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingLS4SinglePort(6)"><a href="./loadShareUtil.tcl.html#::CheckForwardingLS4SinglePort_820">::CheckForwardingLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -tag $tag \
             -generateArpReq $generateArpReq -inSaMac $txMacSrcAddr \
             -inDaMac $inDaMac -sIpAddr $sIpAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -userPriority $userPriority -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             set txMacSrcAddr [<a name="::incrMacAddr(2)"><a href="./loadShareUtil.tcl.html#::incrMacAddr_1483">::incrMacAddr</a></a> -macAddr $txMacSrcAddr]
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
         }
      }
    }

   foreach checkPort $checkPortList {
<a name="::report_start_test(19)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Load sharing verification on Ixia portId $checkPortList&#34;
      if {$statusRxPort($checkPort) == 1} {
         <a name="::result_ok(12)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Packet received over ixia PortId $checkPort correctly&#34;
      } else {
         <a name="::result_error(13)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$statusRxPort($checkPort) packets received over ixia \
                    PortId $checkPort, expected 1&#34;
      }
<a name="::report_end_test(10)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>   
   }

}

<span class="comment-line">####################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This proc is used to get the incremental ip address for </span>
<span class="comment-line">#       the specified progression. Used in CheckForwardingLoadShare.</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage: set incrIpAddr [incrIpAddr -ipAddr &#34;10.0.0.1&#34; \</span>
<span class="comment-line">#                                 -numIncr &#34;2&#34;]</span>
<span class="comment-line"># Category: General</span>
<span class="comment-line">####################################################################  </span>
<strong><a name="::::incrIpAddr_1456">proc <a href="loadShareUtil.tcl-annot.html#::::incrIpAddr">::::incrIpAddr</a></a></strong> {args} {
   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> incrIpAddr $args {
    ipAddr &#34;127.0.0.1&#34;
    numIncr &#34;1&#34;
   }

   set srcIpAddrList [split $ipAddr .]
   set lstByte [lindex $srcIpAddrList 3]
   for {set i 1} {$i &lt;= $numIncr } {incr i} {
      incr lstByte
      set tList [lreplace $srcIpAddrList 3 3 $lstByte]
      lappend retIpAddrList [join $tList .]
   }
   return $retIpAddrList
}

<span class="comment-line">####################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This proc is used to get the incremental mac address for </span>
<span class="comment-line">#       the specified progression. Used in CheckForwardingLoadShare.</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#       set incrMacAddr [incrMacAddr -macAddr &#34;00:00:A0:00:A1:01&#34; \</span>
<span class="comment-line">#                                    -numIncr &#34;2&#34;]</span>
<span class="comment-line"># Category: General</span>
<span class="comment-line">####################################################################  </span>
<strong><a name="::::incrMacAddr_1483">proc <a href="loadShareUtil.tcl-annot.html#::::incrMacAddr">::::incrMacAddr</a></a></strong> {args} {
   <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> incrMacAddr $args {
    macAddr &#34;00:00:00:00:00:01&#34;
    numIncr &#34;1&#34;
   }

   set srcMacAddrList [split $macAddr :]
   <a name="::result_debug(52)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;srcMacAddrList is $srcMacAddrList&#34;
   set lstByte [lindex $srcMacAddrList 5]
   for {set i 1} {$i &lt;= $numIncr } {incr i} {
      set lstByte [<a name="::hextodec(1)"><a href="./ePTUtils.tcl.html#::hextodec_451">::hextodec</a></a> $lstByte]
      incr lstByte
      set lstByte [<a name="::dectohex(1)"><a href="./ePTUtils.tcl.html#::dectohex_470">::dectohex</a></a> $lstByte]
      if {[string length $lstByte] == 1} {
         set lstByte &#34;0$lstByte&#34;
      }
      set tList [lreplace $srcMacAddrList 5 5 $lstByte]
      lappend retMacAddrList [join $tList :]
   }
   return $retMacAddrList
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This proc can be used to send any L2/L3 unicast/multicast</span>
<span class="comment-line">#	packets and verify their forwarding.  In checkPortList input, for </span>
<span class="comment-line">#	each receiving port the number of packets expected to be received</span>
<span class="comment-line">#	can be specify to be any exact number or up/down range. </span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># 	lappend checkPortList &#34;5 forwarded 1 up&#34;</span>
<span class="comment-line">#	lappend checkPortList &#34;6 forwarded 7 exact&#34;</span>
<span class="comment-line">#	lappend checkPortList &#34;7 forwarded 5 down&#34;</span>
<span class="comment-line">#	lappend checkPortList &#34;9 notForwarded&#34;</span>
<span class="comment-line">#	CheckForwardingQInQLS4SinglePort -txPortId 9 -rxPortId 0 -checkPortList $checkPortList -numIpFrame 7 \</span>
<span class="comment-line">#              -protocol &#34;tcp&#34; -dIpAddr &#34;192.168.0.18&#34; -sIpAddr &#34;24.3.89.146&#34; -dPort 21 \</span>
<span class="comment-line">#              -gIpAddr &#34;24.3.89.145&#34; -filePt $fd_res -careTotalIp &#34;yes&#34; -ttlDecr 2 \</span>
<span class="comment-line">#              -comment &#34;- redi.&#34; -ipDaMode &#34;ipIncrHost&#34;</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################  </span>
<strong><a name="::::CheckForwardingQInQLS4SinglePort_1524">proc <a href="loadShareUtil.tcl-annot.html#::::CheckForwardingQInQLS4SinglePort">::::CheckForwardingQInQLS4SinglePort</a></a></strong> {args} {
   <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckForwardingQInQLS4SinglePort $args {
     txPortId &#34;1&#34;
     rxPortId &#34;0&#34;    ;<span class="comment-line">#default not sending learn arp, otherwise use this port as the 2nd arp port</span>
     <a name="::protocol(3)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
     ctag      &#34;none&#34;
     stag      &#34;none&#34;
     direction &#34;c2s&#34;
     sEncap    &#34;88A8&#34;
     ctagPriority &#34;0&#34;
     stagPriority &#34;0&#34;
     generateArpReq &#34;1&#34;
     inSaMac &#34;default&#34;
     inDaMac &#34;FF:FF:FF:FF:FF:FF&#34;
     sIpAddr &#34;127.0.0.1&#34;
     dIpAddr &#34;127.0.0.1&#34;
     gIpAddr &#34;0.0.0.0&#34;     ;<span class="comment-line">#gateway address</span>
     sPort &#34;0&#34;
     dPort &#34;0&#34;
     frameSize &#34;64&#34;
     icmpType &#34;0&#34;
     icmpCode &#34;0&#34;
     dontFrag &#34;true&#34;
     ttl &#34;64&#34;
     ttlDecr &#34;1&#34;
     checkPortList {&#34;2 forwarded 1 exact&#34;} 
     numLearnFrame &#34;1&#34;
     numIpFrame &#34;1&#34;
     filePt &#34;NULL&#34;
     ipDaMode &#34;ipIdle&#34;
     ipSaMode &#34;ipIdle&#34;
     ipDaCount &#34;&#34;
     ethernetType &#34;noType&#34;
     frameType &#34;08 00&#34;
     ipSaCount &#34;&#34;
     ipOptions &#34;&#34;
     tcpSynFlag &#34;false&#34;
     tcpFinFlag &#34;false&#34;
     tcpRstFlag &#34;false&#34;
     tcpAckFlag &#34;false&#34;
     tcpPushFlag &#34;false&#34;
     tcpUrgFlag &#34;false&#34;
     checkMirroringTag &#34;yes&#34;
     mirroringPort &#34;0&#34;
     TOS &#34;default&#34;
     careTotalIp &#34;no&#34; 	;<span class="comment-line"># if to ckeck total IP packets rcvd from all forwarded ports</span>
     CRC &#34;good&#34;
     comment &#34;&#34;
     rate &#34;null&#34;
     udfEnable &#34;false&#34;
     udfInitval &#34;00&#34;
     udfOffset &#34;0&#34;
     udfCountertype &#34;c8&#34;
     udfContinuousCount &#34;false&#34;
   }

   set rc 0

   if { $gIpAddr == &#34;0.0.0.0&#34; } { set gIpAddr $dIpAddr }

   set pPattern &#34;abcd&#34;   

   if {$rxPortId == $txPortId} {
      <a name="::result_error(14)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invalid port specification: txPortId=rxPortId&#34;
      return
   }
   foreach checkPort $checkPortList {
      lappend portMonitorList [lindex $checkPort 0]
   }

<span class="comment-line"># --- Set the Tx and Rx parameter related to vlan Tag</span>
   if {[llength $ctag] &gt; 1} { 
      set rxCtag [lindex $ctag 1]
      set txCtag [lindex $ctag 0]
   } else {
      set rxCtag [lindex $ctag 0]
      set txCtag [lindex $ctag 0]
   }

   if {[llength $ctagPriority] &gt; 1} { 
      set rxCcos [lindex $ctagPriority 1]
      set txCcos [lindex $ctagPriority 0]
   } else {
      set rxCcos &#34;none&#34;
      set txCcos [lindex $ctagPriority 0]
   }
   set ctagPriority $txCcos

   if {[llength $stag] &gt; 1} { 
      set rxStag [lindex $stag 1]
      set txStag [lindex $stag 0]
   } else {
      set rxStag [lindex $stag 0]
      set txStag [lindex $stag 0]
   }
   
   if {[llength $sEncap] &gt; 1} {
      set rxEncap [lindex $sEncap 1]
      set txEncap [lindex $sEncap 0]
      <a name="::result_debug(53)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rxEncap is $rxEncap txEncap is $txEncap&#34;
   } else {
      set rxEncap [lindex $sEncap 0]
      set txEncap [lindex $sEncap 0]
   }

<span class="comment-line"># --- txEncap Can;t be none. Anyway for c2s direction this field will not </span>
<span class="comment-line">#     be used</span>
   if {$txEncap == &#34;none&#34;} {
      set txEncap &#34;88A8&#34;
   }

   if {$careTotalIp == &#34;yes&#34;} { set totalIpPacketReceived 0 }
   if {[lindex $ctag 0]!=&#34;none&#34;&amp;&amp;$frameSize==64} {set frameSize 68}
   switch -- $protocol {
      &#34;mac&#34; -
      &#34;ipx&#34; -
      &#34;mac_ip&#34; -
      &#34;arp&#34; -
      &#34;multicastControl&#34; {
         <a name="::report_start_test(20)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Frame $protocol L2 forwarding check on Txport $txPortId $comment&#34;
         <span class="comment-line">#turn on capturing function on all the monitor ports</span>
         <a name="::StartPortsCapture(4)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portMonitorList
         switch -- $protocol {
            &#34;mac&#34; -
            &#34;mac_ip&#34; -
            &#34;ipx&#34; {
               set prot $protocol
               set rxTag &#34;none&#34;
               if {[llength $ctag] &gt; 1} { 
                  set rxTag [lindex $ctag 1]
                  set txTag [lindex $ctag 0]
               }
               if {$prot == &#34;mac_ip&#34; } {set prot &#34;ip&#34;}
               if {$rxPortId &gt; 0} {
                  <a name="::result_debug(54)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Send a $prot packet on port $rxPortId for fdb to learn the destination&#34;
               if {$direction == &#34;c2s&#34;} {
		  if {$CRC == &#34;bad&#34;} {
			set frameSent [<a name="::SendFrame(8)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -frameRate $rate -txPortId $rxPortId -protocol $prot -tag $rxcTag -fcsError $CRC -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
		  } else {
	                set frameSent [<a name="::SendFrame(9)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -frameRate $rate -txPortId $rxPortId -protocol $prot -tag $rxCtag -frameRate 10 -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
		  }
               } else {
		  if {$CRC == &#34;bad&#34;} {
			set frameSent [<a name="::SendDoubleTagFrame(1)"><a href="./ePTQinQTx.tcl.html#::SendDoubleTagFrame_18">::SendDoubleTagFrame</a></a> -frameRate $rate -txPortId $rxPortId -protocol $prot -ctag $rxCtag -stag $rxStag -fcsError $CRC -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
		  } else {
	                set frameSent [<a name="::SendDoubleTagFrame(2)"><a href="./ePTQinQTx.tcl.html#::SendDoubleTagFrame_18">::SendDoubleTagFrame</a></a> -frameRate $rate -txPortId $rxPortId -protocol $prot  -ctag $rxCtag -stag $rxStag -frameRate 10 -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount]
		  }
               }
                  <a name="::result_debug(55)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;
                  
                  set inDaMac [<a name="::GetSourceMacAddress(4)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameSent]
               }
               <span class="comment-line">#sending mac frame</span>
	       <a name="::result_debug(56)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frame ($protocol) sent on portId $txPortId:&#34;
               if {$direction == &#34;c2s&#34;} {
	          if {$CRC == &#34;bad&#34;} {
                     set frameSent [<a name="::SendFrame(10)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -frameRate $rate \
                         -txPortId $txPortId -dataPattern $pPattern \
                         -tag $txCtag -sourceMac $inSaMac  -destMac $inDaMac \
                         -tagPriority $ctagPriority \
                         -frameSize $frameSize -protocol $prot  \
                         -frameType $frameType -ethernetType $ethernetType \
                         -numFrames $numIpFrame -fcsError $CRC \
                         -udfEnable $udfEnable -udfInitval $udfInitval \
                         -udfOffset $udfOffset -udfCountertype $udfCountertype \
                         -udfContinuousCount $udfContinuousCount]
	          } else {
	             set frameSent [<a name="::SendFrame(11)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -frameRate $rate \
                         -txPortId $txPortId -dataPattern $pPattern \
                         -tag $txCtag -sourceMac $inSaMac  -destMac $inDaMac \
                         -tagPriority $ctagPriority \
                         -frameSize $frameSize -protocol $prot \
                         -frameType $frameType -ethernetType $ethernetType \
                         -numFrames $numIpFrame -frameRate 10 \
                         -udfEnable $udfEnable -udfInitval $udfInitval \
                         -udfOffset $udfOffset -udfCountertype $udfCountertype \
                         -udfContinuousCount $udfContinuousCount]
	          }
               } else {
<span class="comment-line"># --- If the Dicerion is s2c or s2s need to send Q-InQ packets</span>
	          if {$CRC == &#34;bad&#34;} {
                     set frameSent [<a name="::SendDoubleTagFrame(3)"><a href="./ePTQinQTx.tcl.html#::SendDoubleTagFrame_18">::SendDoubleTagFrame</a></a> -frameRate $rate \
                         -txPortId $txPortId -dataPattern $pPattern \
                         -ctag $txCtag -stag $txStag -stagEncap $txEncap \
                         -ctagPriority $ctagPriority \
                         -stagPriority $stagPriority \
                         -sourceMac $inSaMac -destMac $inDaMac \
                         -frameSize $frameSize -protocol $prot \
                         -frameType $frameType -ethernetType $ethernetType \
                         -numFrames $numIpFrame -fcsError $CRC \
                         -udfEnable $udfEnable -udfInitval $udfInitval \
                         -udfOffset $udfOffset -udfCountertype $udfCountertype \
                         -udfContinuousCount $udfContinuousCount]
	          } else {
                     set frameSent [<a name="::SendDoubleTagFrame(4)"><a href="./ePTQinQTx.tcl.html#::SendDoubleTagFrame_18">::SendDoubleTagFrame</a></a> -frameRate $rate \
                         -txPortId $txPortId -dataPattern $pPattern \
                         -ctag $txCtag -stag $txStag -stagEncap $txEncap \
                         -ctagPriority $ctagPriority \
                         -stagPriority $stagPriority \
                         -sourceMac $inSaMac -destMac $inDaMac \
                         -frameSize $frameSize -protocol $prot \
                         -frameType $frameType -ethernetType $ethernetType \
                         -numFrames $numIpFrame -frameRate 10 \
                         -udfEnable $udfEnable -udfInitval $udfInitval \
                         -udfOffset $udfOffset -udfCountertype $udfCountertype \
                         -udfContinuousCount $udfContinuousCount]
	          }
               }
	       <a name="::result_debug(57)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;
            }
            &#34;arp&#34; {
            <span class="comment-line">#sending arp frame</span>
		
	       if {$CRC == &#34;bad&#34;} {
	          set frameSent [<a name="::SendArpFrame(7)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $txPortId \
                           -sourceIp $sIpAddr -destIp $dIpAddr -tag $txCtag \
                           -fcsError $CRC -numFrames $numIpFrame ]
               } else {	
                  set frameSent [<a name="::SendArpFrame(8)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $txPortId \
                           -sourceIp $sIpAddr -destIp $dIpAddr -tag $txCtag \
                           -numFrames $numIpFrame]
	       }

            }
            &#34;multicastControl&#34; {
            <span class="comment-line"># send an join multicast group igmp packet. QInQ Support is not</span>
            <span class="comment-line"># there. Needs to be added if required.</span>
               set membershipQuerry 17
               if {$CRC == &#34;bad&#34; } {
	          set frameSent [<a name="::SendIgmpFrame(3)"><a href="./ePTSendPacket.tcl.html#::SendIgmpFrame_867">::SendIgmpFrame</a></a> -txPortId $txPortId \
                         -type $membershipQuerry -destMac $inDaMac \
                         -sourceIp $sIpAddr -destIp $dIpAddr \
                         -groupAddr $dIpAddr -fcsError $CRC \
                         -dontFrag $dontFrag -numFrames $numIpFrame \
                         -udfEnable $udfEnable -udfInitval $udfInitval \
                         -udfOffset $udfOffset -udfCountertype $udfCountertype \
                         -udfContinuousCount $udfContinuousCount]
	    } else {
                  set frameSent [<a name="::SendIgmpFrame(4)"><a href="./ePTSendPacket.tcl.html#::SendIgmpFrame_867">::SendIgmpFrame</a></a> -txPortId $txPortId \
                         -type $membershipQuerry -destMac $inDaMac \
                         -sourceIp $sIpAddr -destIp $dIpAddr \
                         -groupAddr $dIpAddr -dontFrag $dontFrag \
                         -numFrames $numIpFrame -udfEnable $udfEnable \
                         -udfInitval $udfInitval -udfOffset $udfOffset \
                         -udfCountertype $udfCountertype \
                         -udfContinuousCount $udfContinuousCount]
	    }

            }
         }
         set numExpectedFrame $numIpFrame
         <span class="comment-line">#retrieve data</span>
 
         foreach portId $portMonitorList {
           set numPacketReceived($portId) 0
           set rawPortData [<a name="::GetCapturedFrames(4)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portId]
           foreach frameReceived $rawPortData {
              <a name="::result_debug(58)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frames received on portId $portId:&#34;
              <a name="::result_debug(59)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameReceived&#34;
              if {($checkMirroringTag == &#34;no&#34;) &amp;&amp; ($mirroringPort == $portId)} {
                if {[<a name="::CompareFrameQInQ(1)"><a href="./ForwardingQInQ.tcl.html#::CompareFrameQInQ_660">::CompareFrameQInQ</a></a> $frameSent $frameReceived $direction 0 $rxCtag]} {
                      incr numPacketReceived($portId) 1      
                }            
              } else {
                 if {[<a name="::CompareFrameQInQ(2)"><a href="./ForwardingQInQ.tcl.html#::CompareFrameQInQ_660">::CompareFrameQInQ</a></a> $frameSent $frameReceived $direction 0 $rxCtag] \
                           &amp;&amp; [<a name="::CheckTagQInQ(1)"><a href="./ForwardingQInQ.tcl.html#::CheckTagQInQ_820">::CheckTagQInQ</a></a> -frameReceived $frameReceived \
                                 -ctag $rxCtag -stag $rxStag -sEncap $rxEncap \
                                 -direction $direction -ccos $rxCcos]} {
                      incr numPacketReceived($portId) 1
                 }
              }
           }
           <a name="::result_debug(60)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numPacketReceived($portId)=$numPacketReceived($portId)&#34;
        }
      }
      &#34;ip&#34; -
      &#34;icmp&#34; -
      &#34;udp&#34; -
      &#34;tcp&#34; -
      &#34;multicast&#34; {
         if { $ttlDecr == 0 } { <a name="::report_start_test(21)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Packet $protocol L2 forwarding check on Txport $txPortId $comment&#34;
         } elseif { $ttlDecr == 1} { <a name="::report_start_test(22)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Packet $protocol L3 forwarding check on Txport $txPortId $comment&#34;
         } elseif { $ttlDecr == &#34;ignore&#34;} { <a name="::report_start_test(23)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Packet $protocol forwarding check on Txport $txPortId $comment&#34;
         } else { <a name="::report_start_test(24)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Packet $protocol forwarding check with TTL decr $ttlDecr on Txport $txPortId $comment&#34; }
         <span class="comment-line">#set to user input, will be overwritten when using learn_arp function</span>
         set destMacAddrTx $inDaMac

         if {$protocol == &#34;multicast&#34; } {
            if {[<a name="::GetVersion(4)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1 4] &lt; &#34;6.2.1&#34; } {
              <span class="comment-line">#send an multicast ip packet, 1st packet is flooded on the vlan, just ignore</span>
              set frameSent [<a name="::SendIpFrame(4)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPortId -protocol &#34;udp&#34; \
                         -dataPattern $pPattern -destMac $inDaMac \
                         -sourceIp $sIpAddr  -destIp $dIpAddr -ttl $ttl \
                         -udfEnable $udfEnable -udfInitval $udfInitval \
                         -udfOffset $udfOffset -udfCountertype $udfCountertype \
                         -udfContinuousCount $udfContinuousCount]
              <a name="::result_debug(61)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;1st Frame ($protocol) sent on portId $txPortId: \
                            (will be flooded)&#34;
              <a name="::result_debug(62)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;
            }
            set protocol &#34;udp&#34;
            set rxPortId 0
            set generateArpReq 0
         }
         set rxTag &#34;none&#34;
         if {[llength $ctag] &gt; 1} { set rxTag [lindex $ctag 1] }
         set txTag [lindex $ctag 0]
         
         <span class="comment-line">#enable protocol server for the Rx port, to reponse to ARP request</span>
         if {$rxPortId &gt; 0} {
            <a name="::SaveAndSetProtocolServer(2)"><a href="./ixiaProtSrv.tcl.html#::SaveAndSetProtocolServer_1235">::SaveAndSetProtocolServer</a></a> $rxPortId $dIpAddr $dIpAddr ixInfo \
               -arpService true -tag $rxTag
            if {[lindex $ctag 1]!=&#34;&#34;} {
               <a name="::SendArpFrame(9)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $rxPortId -tag $rxCtag -sourceIp $dIpAddr
            } else {
               if {[regexp -nocase &#34;bd&#34; [<a name="::GetPlatform(5)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>]] &amp;&amp; \
                            [<a name="::GetHardwareType(2)"><a href="./misc.tcl.html#::GetHardwareType_560">::GetHardwareType</a></a>] == &#34;OLD_GEN&#34; } {
                  <a name="::result_debug(63)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sending a mac frame for hardware to learn \
                                mac first - timing problem&#34;
                  <a name="::SendFrame(12)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $rxPortId
                  <span class="comment-line">#SendArpRequest $rxPortId $dIpAddr &#34;0.0.0.0&#34;</span>
               }
            }
         }
         <span class="comment-line">#request mac to send ip packet</span>
         if { $generateArpReq == 1} {
           <span class="comment-line">#this section is being implemented this way for the old gen BD</span>
           <span class="comment-line">#since it require 2 arp requests separated by about 1ms </span>
           <span class="comment-line">#in order for the ipf table to get updated</span>
           
           for {set index 0} {$index &lt; $numLearnFrame} { incr index } {
              set destMacAddrTx [<a name="::SendArpRequest(2)"><a href="./ePTSendPacket.tcl.html#::SendArpRequest_1127">::SendArpRequest</a></a> $txPortId $sIpAddr $gIpAddr \
                                                $txTag]
           }
           <span class="comment-line">#need to set this to some invalid mac, otherwise ixia send function won't return</span>
           if {$destMacAddrTx == &#34;NO_ARP_REPLY&#34; } {
               set destMacAddrTx &#34;00 00 00 00 00 00&#34;
           }
         }
         <span class="comment-line">#Send arp request from dPort for numIpFrame</span>
         if {($ipDaMode == &#34;ipIncrHost&#34;) &amp;&amp; \
             ($rxPortId != 0)} {
            set firstPart [string range $dIpAddr 0 [string last . $dIpAddr]]
            set lastPart [string range $dIpAddr [expr [string last . $dIpAddr] +1] [string length $dIpAddr]]
            if {$ipDaCount == &#34;&#34;} {
                set numArps $numIpFrame
            } else {
                set numArps $ipDaCount
            }
            for {set i 1} {$i &lt;= $numArps} {incr i} {
               set tmpIpAddr [format &#34;%s%s&#34; $firstPart $lastPart]
               <span class="comment-line">#sending arp frame</span>
               set frameSent [<a name="::SendArpFrame(10)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $rxPortId \
                                    -sourceIp $tmpIpAddr -destIp $gIpAddr]

               set lastPart [expr $lastPart + 1]
            }

            <span class="comment-line"># Set numIpFrame to be 1 as doesn't seem to send more, verify!!</span>
            <span class="comment-line">#set numIpFrame 1</span>
         }

         <span class="comment-line"># Send a single IP frame to seed the FDB, IP ARP, and IP FDB tables.</span>
         if {$rxPortId &gt; 0 &amp;&amp; $numIpFrame &gt; 1} {
             <a name="::SendIpFrame(5)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPortId -sourceIp $sIpAddr \
                         -destMac $destMacAddrTx -gatewayIp $gIpAddr \
                         -rxPortId $rxPortId -destIp $dIpAddr
         }

         <span class="comment-line">#turn on capturing function on all the monitor ports</span>
         <a name="::StartPortsCapture(5)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portMonitorList
         
         <span class="comment-line">#send packets</span>
         <a name="::result_debug(64)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n$numIpFrame Frames ($protocol) sent on portId $txPortId:&#34;
         if {$direction == &#34;c2s&#34;} {
            set frameSent [<a name="::SendIpFrame(6)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPortId -protocol $protocol \
                             -tag $txCtag -frameType $frameType \
                             -destPort $dPort -sourcePort $sPort \
                             -ipDaMode $ipDaMode -ipDaCount $ipDaCount \
                             -ipSaMode $ipSaMode -ipSaCount $ipSaCount \
                             -TOS $TOS -userPriority $ctagPriority \
                             -dontFrag $dontFrag -type $icmpType \
                             -code $icmpCode -ttl $ttl -tcpSynFlag $tcpSynFlag \
                             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
                             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
                             -tcpUrgFlag $tcpUrgFlag -dataPattern $pPattern \
                             -numFrames $numIpFrame -frameSize $frameSize \
                             -sourceMac $inSaMac -destMac $destMacAddrTx \
                             -sourceIp $sIpAddr -destIp $dIpAddr \
                             -ipOptions $ipOptions -udfEnable $udfEnable \
                             -udfInitval $udfInitval -udfOffset $udfOffset \
                             -udfCountertype $udfCountertype \
                             -udfContinuousCount $udfContinuousCount]
         } else {
         <span class="comment-line"># --- If it is s2c send a QInQ packet</span>
            set frameSent [<a name="::SendDoubleTagIpFrame(1)"><a href="./ePTQinQTx.tcl.html#::SendDoubleTagIpFrame_145">::SendDoubleTagIpFrame</a></a> -txPortId $txPortId \
                             -protocol $protocol -ctag $txCtag -stag $txStag \
                             -ctagPriority $ctagPriority \
                             -stagPriority $stagPriority \
                             -stagEncap $txEncap -frameType $frameType \
                             -destPort $dPort -sourcePort $sPort \
                             -ipDaMode $ipDaMode -ipDaCount $ipDaCount \
                             -ipSaMode $ipSaMode -ipSaCount $ipSaCount \
                             -TOS $TOS -ctagPriority $ctagPriority  \
                             -dontFrag $dontFrag -type $icmpType \
                             -code $icmpCode -ttl $ttl \
                             -tcpSynFlag $tcpSynFlag -tcpFinFlag $tcpFinFlag \
                             -tcpRstFlag $tcpRstFlag -tcpAckFlag $tcpAckFlag \
                             -tcpPushFlag $tcpPushFlag -tcpUrgFlag $tcpUrgFlag \
                             -dataPattern $pPattern -numFrames $numIpFrame \
                             -frameSize $frameSize -sourceMac $inSaMac \
                             -destMac $destMacAddrTx -sourceIp $sIpAddr \
                             -destIp $dIpAddr -ipOptions $ipOptions \
                             -udfEnable $udfEnable -udfInitval $udfInitval \
                             -udfOffset $udfOffset \
                             -udfCountertype $udfCountertype \
                             -udfContinuousCount $udfContinuousCount]
         }
         <a name="::result_debug(65)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameSent&#34;
         set numExpectedFrame $numIpFrame
         <span class="comment-line">#retrieve data</span>
         foreach portId $portMonitorList {
           set numPacketReceived($portId) 0
           set rawPortData [<a name="::GetCapturedFrames(5)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portId]
           foreach frameReceived $rawPortData {
               <a name="::result_debug(66)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frames received on portId $portId:&#34;
               <a name="::result_debug(67)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameReceived&#34;
               if { [<a name="::CompareFrameQInQ(3)"><a href="./ForwardingQInQ.tcl.html#::CompareFrameQInQ_660">::CompareFrameQInQ</a></a> $frameSent $frameReceived $direction \
                    $ttlDecr $rxCtag $ipDaMode $ipSaMode] &amp;&amp; [<a name="::CheckTagQInQ(2)"><a href="./ForwardingQInQ.tcl.html#::CheckTagQInQ_820">::CheckTagQInQ</a></a> \
                    -frameReceived $frameReceived -ctag $rxCtag -stag $rxStag \
                    -direction $direction -sEncap $rxEncap -ccos $rxCcos]} {
                  incr numPacketReceived($portId) 1
               }
           }
           <a name="::result_debug(68)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numPacketReceived($portId)= $numPacketReceived($portId)&#34;
           if {$careTotalIp == &#34;yes&#34;} {incr totalIpPacketReceived $numPacketReceived($portId)}  
        }
        <span class="comment-line"># Restore the protocol server to its state before calling CheckForwarding.</span>
        if {$rxPortId &gt; 0} {
           <a name="::RestoreSavedProtocolServer(2)"><a href="./ixiaProtSrv.tcl.html#::RestoreSavedProtocolServer_1346">::RestoreSavedProtocolServer</a></a> ixInfo
        }

      }
      &#34;proxyArp&#34; {
         <a name="::report_start_test(25)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Proxy-ARP forwarding check on Txport $txPortId $comment&#34;
         
         <span class="comment-line">#turn on capturing function on all the monitor ports</span>
         <a name="::StartPortsCapture(6)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portMonitorList
         
         <a name="::result_debug(69)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frame (arp) sent on portId $txPortId:&#34;
<span class="comment-line">#         result_debug &#34;$frameSent&#34;</span>
         
         <span class="comment-line">#sending arp frame</span>
         <span class="comment-line">#this section is being implemented this way for the old gen BD</span>
         <span class="comment-line">#since it require 2 arp requests separated by about 1ms </span>
         <span class="comment-line">#in order for the ipf table to get updated</span>
         for {set index 0} {$index &lt; $numLearnFrame} { incr index } {
             set frameSent [<a name="::SendArpFrame(11)"><a href="./ePTSendPacket.tcl.html#::SendArpFrame_959">::SendArpFrame</a></a> -txPortId $txPortId -sourceIp $sIpAddr \
                            -destIp $dIpAddr -tag $ctag]
         }
         <span class="comment-line">#this is set to 1 for any numLearnFrame, since this sendArpFrame will</span>
         <span class="comment-line">#reset the port capturing, a feature in ixia sending function that should be removed</span>
         set numExpectedFrame $numLearnFrame
         <span class="comment-line">#retrieve data</span>
         foreach portId $portMonitorList {
            set numPacketReceived($portId) 0
            set rawPortData [<a name="::GetCapturedFrames(6)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portId]
            set sourceMac [<a name="::GetDUTMac(2)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT1&#34; &#34; &#34;]
            foreach frameReceived $rawPortData {
               <a name="::result_debug(70)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frames received on portId $portId:&#34;
               <a name="::result_debug(71)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frameReceived&#34;
               <a name="::result_debug(72)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;sourceMac:$sourceMac| sMACRecv:[<a name="::GetSourceMacAddress(5)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameReceived]|&#34;
               if { $sourceMac == [<a name="::GetSourceMacAddress(6)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameReceived] } {
                  <a name="::result_debug(73)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;sIPRecv: [<a name="::GetSourceIPAddress(4)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frameReceived] sIPSent: [<a name="::GetSourceIPAddress(5)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frameSent]&#34;
                  <a name="::result_debug(74)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;dIPRecv: [<a name="::GetDestIPAddress(5)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameReceived] dIPSent: [<a name="::GetDestIPAddress(6)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameSent]&#34;
                  if { [<a name="::GetMessageType(2)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $frameReceived] == &#34;ARP_REQUEST&#34; } {
                     if { ([<a name="::GetSourceIPAddress(6)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frameReceived] == $gIpAddr) &amp;&amp; \
                          ([<a name="::GetTargetMacAddress(2)"><a href="./MessageDecoding.tcl.html#::GetTargetMacAddress_159">::GetTargetMacAddress</a></a> $frameReceived] == &#34;00 00 00 00 00 00&#34;) &amp;&amp; \
                           ([<a name="::GetDestIPAddress(7)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameReceived] == [<a name="::GetDestIPAddress(8)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameSent]) } {
                         incr numPacketReceived($portId) 1
                     }
                  }
               }
            }
            <a name="::result_debug(75)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numPacketReceived($portId)= $numPacketReceived($portId)&#34; 
         }
      }
      default {
         <a name="::report_start_test(26)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Unknown protocol $protocol $comment&#34;
         <a name="::result_error(15)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invalid protocol.&#34;
      }
   }

   <span class="comment-line">#now check received data against checkList to see if matched</span>
   set testResult &#34;good&#34;
   foreach checkPort $checkPortList {
      set portId [lindex $checkPort 0]
      set portFlag [lindex $checkPort 1]
      set expectedRange &#34;exact&#34;
      switch -- $portFlag \
         &#34;forwarded&#34; {
            if {[lindex $checkPort 2] == &#34;&#34;} {
              set expectedPacket $numExpectedFrame
            } else {  
              set expectedPacket [lindex $checkPort 2]
              if { [lindex $checkPort 3] != &#34;&#34;} { 
                 set expectedRange [lindex $checkPort 3] ;<span class="comment-line"># could be up or down</span>
              }  
            }   
      }  &#34;notForwarded&#34; {
            set expectedPacket 0
      }  default {
            set expectedPacket $portFlag
      }
                        

      if { ($numPacketReceived($portId) == $expectedPacket) } {
         <a name="::result_debug(76)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Forwarding on port $portId checked Ok \
                       ($numPacketReceived($portId)). Was $portFlag&#34;
         set rc $portId
      }
   }

   <a name="::report_end_test(11)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

   return $rc
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     	This proc can be used to send any L2/L3 unicast/multicast</span>
<span class="comment-line">#	packets and verify their forwarding over Load Shared ports. </span>
<span class="comment-line">#       In checkPortList input, for each receiving port 1 packets </span>
<span class="comment-line">#       is expected to be received.</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># 	set checkPortList &#34;5 6 7 8&#34;</span>
<span class="comment-line">#	CheckForwardingQinQLoadShare -txPortId 9 -rxPortId 0 -checkPortList \</span>
<span class="comment-line">#              $checkPortList -numIpFrame 7 -protocol &#34;tcp&#34; -dIpAddr \</span>
<span class="comment-line">#              &#34;192.168.0.18&#34; -sIpAddr &#34;24.3.89.146&#34; -dPort 21 \</span>
<span class="comment-line">#              -gIpAddr &#34;24.3.89.145&#34; -filePt $fd_res \</span>
<span class="comment-line">#              -ttlDecr 2 -comment &#34;- redi.&#34; -ipDaMode &#34;ipIncrHost&#34;</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################  </span>
<strong><a name="::::CheckForwardingQinQLoadShare_2069">proc <a href="loadShareUtil.tcl-annot.html#::::CheckForwardingQinQLoadShare">::::CheckForwardingQinQLoadShare</a></a></strong> {args} {
   <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckForwardingQinQLoadShare $args {
     txPortId &#34;1&#34;
     rxPortId &#34;0&#34;    ;<span class="comment-line">#default not sending learn arp, otherwise use this port as the 2nd arp port</span>
     <a name="::protocol(4)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
     ctag      &#34;none&#34;
     stag      &#34;none&#34;
     direction &#34;c2s&#34;
     sEncap    &#34;88A8&#34;
     ctagPriority &#34;0&#34;
     stagPriority &#34;0&#34;
     generateArpReq &#34;1&#34;
     inSaMac &#34;00:00:01:A1:00:01&#34;
     inDaMac &#34;FF:FF:FF:FF:FF:FF&#34;
     sIpAddr &#34;127.0.0.1&#34;
     dIpAddr &#34;127.0.0.1&#34;
     gIpAddr &#34;0.0.0.0&#34;     ;<span class="comment-line">#gateway address</span>
     sPort &#34;0&#34;
     dPort &#34;0&#34;
     frameSize &#34;64&#34;
     icmpType &#34;0&#34;
     icmpCode &#34;0&#34;
     dontFrag &#34;true&#34;
     ttl &#34;64&#34;
     ttlDecr &#34;1&#34;
     checkPortList {&#34;2 forwarded 1 exact&#34;}
     numLearnFrame &#34;1&#34;
     filePt &#34;NULL&#34;
     ethernetType &#34;noType&#34;
     frameType &#34;08 00&#34;
     ipOptions &#34;&#34;
     tcpSynFlag &#34;false&#34;
     tcpFinFlag &#34;false&#34;
     tcpRstFlag &#34;false&#34;
     tcpAckFlag &#34;false&#34;
     tcpPushFlag &#34;false&#34;
     tcpUrgFlag &#34;false&#34;
     checkMirroringTag &#34;yes&#34;
     mirroringPort &#34;0&#34;
     TOS &#34;default&#34;
     userPriority &#34;0&#34;
     CRC &#34;good&#34;
     comment &#34;&#34;
     rate &#34;null&#34;
     udfEnable &#34;false&#34;
     udfInitval &#34;00&#34;
     udfOffset &#34;0&#34;
     udfCountertype &#34;c8&#34;
     udfContinuousCount &#34;false&#34;
     loadShareType &#34;SA&#34;
   }

   global gnssPlatform
   set platform [<a name="::GetPlatform(6)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1];
   if {[regexp -nocase &#34;$gnssPlatform&#34; $platform]} {
      set platform &#34;genesis&#34;
      set numPack 2
   } else {
      set platform &#34;broadcom&#34;
      set numPack 2
   }

   foreach checkPort $checkPortList {
      set statusRxPort($checkPort) 0
      lappend checkPortForwList &#34;$checkPort forwarded&#34;
   }

   switch -- $loadShareType {
     &#34;IPSA&#34; {
         set txIpSrcAddr $sIpAddr
         for {set loopCnt 1} {$loopCnt &lt;= $numPack} {incr loopCnt} {
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingQInQLS4SinglePort(1)"><a href="./loadShareUtil.tcl.html#::CheckForwardingQInQLS4SinglePort_1524">::CheckForwardingQInQLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -ctag $ctag -stag $stag \
             -direction &#34;$direction&#34; -sEncap $sEncap \
             -ctagPriority $ctagPriority -stagPriority $stagPriority \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $inDaMac -sIpAddr $txIpSrcAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             set txIpSrcAddr [<a name="::incrIpAddr(3)"><a href="./loadShareUtil.tcl.html#::incrIpAddr_1456">::incrIpAddr</a></a> -ipAddr $txIpSrcAddr]
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
             <a name="::result_debug(77)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;txIpSrcAddr $txIpSrcAddr&#34;
         }
         }
      }
     &#34;IPDA&#34; {
         set txIpDstAddr $dIpAddr
         for {set loopCnt 1} {$loopCnt &lt;= $numPack} {incr loopCnt} {
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingQInQLS4SinglePort(2)"><a href="./loadShareUtil.tcl.html#::CheckForwardingQInQLS4SinglePort_1524">::CheckForwardingQInQLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -ctag $ctag -stag $stag \
             -direction &#34;$direction&#34; -sEncap $sEncap \
             -ctagPriority $ctagPriority -stagPriority $stagPriority \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $inDaMac -sIpAddr $sIpAddr -dIpAddr $txIpDstAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             set txIpDstAddr [<a name="::incrIpAddr(4)"><a href="./loadShareUtil.tcl.html#::incrIpAddr_1456">::incrIpAddr</a></a> -ipAddr $txIpDstAddr]
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
         }
         }
      }
     &#34;L4SRCPORT&#34; {
         for {set loopCnt 1} {$loopCnt &lt;= $numPack} {incr loopCnt} {
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingQInQLS4SinglePort(3)"><a href="./loadShareUtil.tcl.html#::CheckForwardingQInQLS4SinglePort_1524">::CheckForwardingQInQLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -ctag $ctag -stag $stag \
             -direction &#34;$direction&#34; -sEncap $sEncap \
             -ctagPriority $ctagPriority -stagPriority $stagPriority \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $inDaMac -sIpAddr $sIpAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             incr sPort
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
         }
         }
      }
     &#34;L4DSTPORT&#34; {
         for {set loopCnt 1} {$loopCnt &lt;= $numPack} {incr loopCnt} {
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingQInQLS4SinglePort(4)"><a href="./loadShareUtil.tcl.html#::CheckForwardingQInQLS4SinglePort_1524">::CheckForwardingQInQLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -ctag $ctag -stag $stag \
             -direction &#34;$direction&#34; -sEncap $sEncap \
             -ctagPriority $ctagPriority -stagPriority $stagPriority \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $inDaMac -sIpAddr $sIpAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             incr dPort
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
         }
         }
      }
     &#34;DA&#34; {
         set txMacDstAddr $inDaMac
         for {set loopCnt 1} {$loopCnt &lt;= $numPack} {incr loopCnt} {
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingQInQLS4SinglePort(5)"><a href="./loadShareUtil.tcl.html#::CheckForwardingQInQLS4SinglePort_1524">::CheckForwardingQInQLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -ctag $ctag -stag $stag \
             -direction &#34;$direction&#34; -sEncap $sEncap \
             -ctagPriority $ctagPriority -stagPriority $stagPriority \
             -generateArpReq $generateArpReq -inSaMac $inSaMac \
             -inDaMac $txMacDstAddr -sIpAddr $sIpAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             set txMacDstAddr [<a name="::incrMacAddr(3)"><a href="./loadShareUtil.tcl.html#::incrMacAddr_1483">::incrMacAddr</a></a> -macAddr $txMacDstAddr]
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
             }
         }
         }
      }
     &#34;SA&#34; - 
     default {
         set txMacSrcAddr $inSaMac
         for {set loopCnt 1} {$loopCnt &lt;= $numPack} {incr loopCnt} {
         foreach checkPort $checkPortList {
            set rxPort [<a name="::CheckForwardingQInQLS4SinglePort(6)"><a href="./loadShareUtil.tcl.html#::CheckForwardingQInQLS4SinglePort_1524">::CheckForwardingQInQLS4SinglePort</a></a> -txPortId $txPortId \
             -rxPortId $rxPortId -protocol $protocol -ctag $ctag -stag $stag \
             -direction &#34;$direction&#34; -sEncap $sEncap \
             -ctagPriority $ctagPriority -stagPriority $stagPriority \
             -generateArpReq $generateArpReq -inSaMac $txMacSrcAddr \
             -inDaMac $inDaMac -sIpAddr $sIpAddr -dIpAddr $dIpAddr \
             -gIpAddr $gIpAddr -sPort $sPort -dPort $dPort \
             -frameSize $frameSize -icmpType $icmpType -icmpCode $icmpCode \
             -dontFrag $dontFrag -ttl $ttl -ttlDecr $ttlDecr \
             -checkPortList $checkPortForwList -numLearnFrame $numLearnFrame \
             -filePt $filePt -ethernetType $ethernetType -frameType $frameType \
             -ipOptions $ipOptions -tcpSynFlag $tcpSynFlag \
             -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag \
             -tcpAckFlag $tcpAckFlag -tcpPushFlag $tcpPushFlag \
             -tcpUrgFlag $tcpUrgFlag -checkMirroringTag $checkMirroringTag \
             -mirroringPort $mirroringPort -TOS $TOS \
             -CRC $CRC -comment $comment \
             -rate $rate -udfEnable $udfEnable -udfInitval $udfInitval \
             -udfOffset $udfOffset -udfCountertype $udfCountertype \
             -udfContinuousCount $udfContinuousCount]
             set txMacSrcAddr [<a name="::incrMacAddr(4)"><a href="./loadShareUtil.tcl.html#::incrMacAddr_1483">::incrMacAddr</a></a> -macAddr $txMacSrcAddr]
             if {[info exists statusRxPort($rxPort)]} {
                incr statusRxPort($rxPort)
                <a name="::result_debug(78)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rxPort $rxPort statusRxPort $statusRxPort($rxPort)&#34;
             }
         }
         }
      }
    }

   foreach checkPort $checkPortList {
<a name="::report_start_test(27)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Load sharing verification on Ixia portId $checkPortList&#34;
      if {$statusRxPort($checkPort) == $numPack} {
         <a name="::result_ok(13)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Packet received over ixia PortId $checkPort correctly&#34;
      } else {
         <a name="::result_error(16)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$statusRxPort($checkPort) packets received over ixia \
                    PortId $checkPort, expected $numPack&#34;
      }
<a name="::report_end_test(12)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>   
   }

}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: AutoNegOn</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#              Enable autonegotiation on DUTs trunk links</span>
<span class="comment-line">#              (Often used with ValidateTrunkLinkForLoadshare)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              List of DUT pairs </span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              AutoNegOn &#34;{1 2} {1 3} {1 4} {2 3} {2 4} {3 4}&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Config</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::AutoNegOn_2357">proc <a href="loadShareUtil.tcl-annot.html#::::AutoNegOn">::::AutoNegOn</a></a></strong> {dutPairList} {

    global DUTs_info

    foreach dutPair $dutPairList {
        set firstDUTnumber [lindex $dutPair 0]
        set secondDUTnumber [lindex $dutPair 1]
        set TrunkPortList1to2 [<a name="::::GetTrunkPortList(3)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a> $firstDUTnumber $secondDUTnumber]
        set TrunkPortList2to1 [<a name="::::GetTrunkPortList(4)"><a href="./SystemSetup.tcl.html#::::GetTrunkPortList_633">::::GetTrunkPortList</a></a> $secondDUTnumber $firstDUTnumber]
        <a name="::result_debug(79)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;TrunkPortList1to2='$TrunkPortList1to2'&#34;
        <a name="::result_debug(80)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;TrunkPortList2to1='$TrunkPortList2to1'&#34;
        <a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$firstDUTnumber,connect)
            foreach trunkPort $TrunkPortList1to2 { <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure port $trunkPort auto on&#34;   }
        <a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$secondDUTnumber,connect)
            foreach trunkPort $TrunkPortList2to1 { <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure port $trunkPort auto on&#34;   }
    }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: ValidatePortForLoadshare </span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#	Check if ports given by user are with same speed</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               DUT ID</span>
<span class="comment-line">#		pList port list seprated by , </span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              1 if port speeds are same </span>
<span class="comment-line">#              0 if port speed are different</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              ValidatePortForLoadshare 1 &#34;10:1,5:2&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Config</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ValidatePortForLoadshare_2392">proc <a href="loadShareUtil.tcl-annot.html#::::ValidatePortForLoadshare">::::ValidatePortForLoadshare</a></a></strong> { dutId pList } {
 
global DUTs_info
if { ![info exist DUTs_info(DUT${dutId},connect)] } {
         <a name="::result_error(17)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$dutId doesn't exist&#34;
         return 0 
}
<a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUTs_info(DUT${dutId},connect)]

regsub -all {,} $pList { } portMapList

set flag 0
if { [llength $portMapList] &gt; 0 } {
      if {[regexp -nocase &#34;vpex&#34; [<a name="::GetPlatform(7)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$dutId]]} {
         set result [<a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable sharing [lindex $portMapList 0] grouping $portMapList algorithm address custom&#34;]
      } else {
         set result [<a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable sharing [lindex $portMapList 0] grouping $portMapList&#34;]
      }
      <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable sharing [lindex $portMapList 0]&#34; 
      if { [regexp -nocase &#34;cannot.*support.*load.*sharing.*different.*maximum.*speed&#34; $result ] || [regexp -nocase &#34;Error:.*is.*a.*native.* port.*while.*load.*share.*group.*master.*is.*an.*extended.*port.&#34; $result] || [regexp -nocase &#34;Error:.*Port.*is.*an.*extended.*port.*while.*load.*share.*group.*master.*is.*a.*native.*port.&#34; $result ]} {
         <a name="::result_debug(81)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;System does not support load sharing among port with different maximum speed &#34;
         return 0 
      }  
}

for {set j 1} {$j &lt; [llength $portMapList]} {incr j} {
        if { [<a name="::getDutPortSpeed(3)"><a href="./misc.tcl.html#::getDutPortSpeed_3328">::getDutPortSpeed</a></a> -dut $dutId -port [lindex $portMapList 0]] != [<a name="::getDutPortSpeed(4)"><a href="./misc.tcl.html#::getDutPortSpeed_3328">::getDutPortSpeed</a></a> -dut $dutId -port [lindex $portMapList $j] ] } {
        set flag 1
        break
        }
        if { [<a name="::getDutPortAutoNeg(1)"><a href="./misc.tcl.html#::getDutPortAutoNeg_3368">::getDutPortAutoNeg</a></a> -dut $dutId -port [lindex $portMapList 0]] != [<a name="::getDutPortAutoNeg(2)"><a href="./misc.tcl.html#::getDutPortAutoNeg_3368">::getDutPortAutoNeg</a></a> -dut $dutId -port [lindex $portMapList $j] ] } {
        set flag 2 
        break
        }
}
if { $flag == 1 } {
 <a name="::result_debug(82)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port [lindex $portMapList 0] and [lindex $portMapList $j] are not with same speed&#34;
 return 0
} elseif { $flag == 2 } {
 <a name="::result_debug(83)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Port [lindex $portMapList 0] and [lindex $portMapList $j] are not with same auto Neg status&#34;
 return 0

} else {
 <a name="::result_debug(84)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Ports are with same speed&#34;
 return 1
}

}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: verifyFrameCountsPioneer </span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: </span>
<span class="comment-line">#	Check if traffic is corrected distributed with incremental dest mac packet</span>
<span class="comment-line">#       This is deiffent then verifyFrameCounts because voyager does not support load sharing of unknown mac packets</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: </span>
<span class="comment-line">##################################################################</span>
 
<strong><a name="::::verifyFrameCountsPioneer_2456">proc <a href="loadShareUtil.tcl-annot.html#::::verifyFrameCountsPioneer">::::verifyFrameCountsPioneer</a></a></strong> {portIdList  {SkipPortId &#34;none&#34;}} {

    set portIdTx 1
    set destMacAddrTx 00:A2:F1:00:00:01
    after 200
    foreach portId $portIdList {
	<a name="::EnablePortFilter(2)"><a href="./ePTRx.tcl.html#::EnablePortFilter_1817">::EnablePortFilter</a></a> $portId  &#34;&#34; &#34;{[<a name="::GetPortIdMac(2)"><a href="./misc.tcl.html#::GetPortIdMac_405">::GetPortIdMac</a></a> $portIdTx &#34; &#34;]}&#34;
    }

    <a name="::ClearPortsStats(4)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdTx
    <a name="::ClearPortsStats(5)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portIdList
    set Totalframessent 0
    set numFrames 20
    set k 00
    set x 01
    <a name="::report_start_test(28)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Verify total frame count sent and received&#34;
    for {set i 1} {$i&lt;=10} {incr i} {
	set destmac 00:A1:01:$k:$x:01
	set k [format &#34;%02x&#34; [expr 0x$k + 4]]
	set x [format &#34;%02x&#34; [expr 0x$x + 1]]
	set frameSent [<a name="::SendFrame(13)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $portIdTx -sourceMac $destMacAddrTx \
		-numFrames $numFrames -destMac $destmac -daMode &#34;ctrRandom&#34; \
		-frameRate 5000]

	<a name="::result_debug(85)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FrameSent: $frameSent&#34;
	set framesSent [<a name="::GetNumFramesSent(2)"><a href="./ePTRx.tcl.html#::GetNumFramesSent_1324">::GetNumFramesSent</a></a> $portIdTx]
	set Totalframessent [expr $Totalframessent + $framesSent]
    }
   <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
    set totalFramesReceived 0
    foreach portId $portIdList {
	set framesReceived [<a name="::GetNumFramesReceived(2)"><a href="./ePTRx.tcl.html#::GetNumFramesReceived_1346">::GetNumFramesReceived</a></a> $portId]
	<span class="comment-line">#set framesReceived [lindex [ixiaUserDefinedStat1 $portId] 1]</span>
	<a name="::result_debug(86)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;framesReceived on portId $portId $framesReceived&#34;
	<a name="::result_debug(87)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;SkipPortId $SkipPortId&#34;

	if {$SkipPortId!=&#34;none&#34;} {
	    if {[lsearch -exact $SkipPortId $portId]==-1} {
		<a name="::report_start_test(29)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Verify traffic on present member port $portId&#34;
	    } else {
		<a name="::report_start_test(30)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Verify traffic on deleted member port $portId&#34;
		if {$framesReceived!=0} {
		    <a name="::result_error(18)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;framesReceived $framesReceived on $portId&#34;
		} else {
		    <a name="::result_ok(14)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;correct framesReceived $framesReceived on $portId&#34;
		}
	    }
	    <a name="::report_end_test(13)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
	}
	set totalFramesReceived [expr $framesReceived+$totalFramesReceived]
	}
    <a name="::result_debug(88)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;framesSent: $Totalframessent, totalFramesReceived: $totalFramesReceived&#34;
    if {$totalFramesReceived&lt;$Totalframessent || $totalFramesReceived&gt;[expr $Totalframessent+3]} {
	<a name="::result_error(19)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;totalFramesReceived is different than framesSent $Totalframessent&#34;
    } else {
	<a name="::result_ok(15)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;totalFramesReceived is same as framesSent $Totalframessent&#34;
    }

    <a name="::StopPortsTransmit(3)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> &#34;1&#34;

    <a name="::report_end_test(14)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

    foreach portId $portIdList {
	<a name="::DisablePortFilter(2)"><a href="./ePTRx.tcl.html#::DisablePortFilter_1937">::DisablePortFilter</a></a> $portId
    }

    return $totalFramesReceived

}


</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
