<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>xmodLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#xmodLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>xmodLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="xmodLib.tcl-annot.html">annotations</a> | <a href="xmodLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line"># -----------------------------------------------------------------------------</span>
<span class="comment-line"># Procedure Name: CheckXmodRequired</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Check to see if a DUT requires an xmod</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Determine if this platform requires the xmod</span>
<span class="comment-line">#  The REQUIRED_XMOD variable is set in the common.cfg</span>
<span class="comment-line">#  REQUIRED_XMOD(8900diags,SysTypes) $manhattanBlade</span>
<span class="comment-line">#  REQUIRED_XMOD(8900diags,SupportStartRelease) &#34;16.2&#34;</span>
<span class="comment-line">#  REQUIRED_XMOD(8900diags,SupportEndRelease) &#34;null&#34;</span>
<span class="comment-line">#  REQUIRED_XMOD(diagnostics,SysTypes) $bcmx480</span>
<span class="comment-line">#  REQUIRED_XMOD(diagnostics,SupportStartRelease) &#34;15.6&#34;</span>
<span class="comment-line">#  REQUIRED_XMOD(diagnostics,SupportEndRelease) &#34;null&#34;</span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               args</span>
<span class="comment-line">#               dut           : DUT to check</span>
<span class="comment-line">#               xmod          : xmod to verify required for the DUT</span>
<span class="comment-line">#               extVerChkOn   : in qloadimage no assumption can be made about versions</span>
<span class="comment-line">#               chkVerName    : in you know what the target version is going to be.</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              1 = required</span>
<span class="comment-line">#              0 = not required</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              if [CheckXmodRequired -dut 1 -xmod &#34;ssh&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: GetSwitchInfo</span>
<span class="comment-line"># -----------------------------------------------------------------------------</span>
<strong><a name="::::CheckXmodRequired_32">proc <a href="xmodLib.tcl-annot.html#::::CheckXmodRequired">::::CheckXmodRequired</a></a></strong><a name="::::CheckXmodRequired"></a> {args} {
    global DUTs_info
    global REQUIRED_XMOD
    global bd8kChassis

    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckXmodRequired $args {
        dut           &#34;1&#34;           ;<span class="comment-line"># DUT to check</span>
        xmod          &#34;diagnostics&#34;
        chkVerName    &#34;null&#34;        ;<span class="comment-line"># Version that Xmod must be supported on</span>
        extVerChkOn   &#34;0&#34;
    }

    set xmod [<a name="::::VerifyXmodFileExt(1)"><a href="./xmodLib.tcl.html#::::VerifyXmodFileExt_97">::::VerifyXmodFileExt</a></a> -dut $dut -xmod $xmod]

    set startRel $REQUIRED_XMOD($xmod,SupportStartRelease)
    set endRel $REQUIRED_XMOD($xmod,SupportEndRelease)

    if {$chkVerName == &#34;null&#34;} {
        set chkVerName [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT$dut]
    }

    <span class="comment-line"># check the hwList (chassis/stack slots) AND systype to see if xmod should be loaded</span>
    if {([regexp -nocase $REQUIRED_XMOD($xmod,SysTypes) $DUTs_info(DUT${dut},hwList)] || \
           [regexp -nocase $REQUIRED_XMOD($xmod,SysTypes) $DUTs_info(DUT${dut},platform)]) &amp;&amp; \
           ![regexp -nocase &#34;vpex&#34; [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT$dut]]} {

        if {$extVerChkOn == 0} {
            <span class="comment-line">#  --- Check the versions to make sure xmod is required</span>
            if {([<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $chkVerName $startRel] &gt;= 0 || \
                    $startRel == &#34;null&#34;) &amp;&amp; ([<a name="::CompareRelease(2)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $chkVerName $endRel] &lt;= 0 || \
                    $endRel == &#34;null&#34;) } {
                return 1
            } else {
                return 0
            }
        } else {
            return 1
        }
    } else {
        return 0
    }
}

<span class="comment-line"># -----------------------------------------------------------------------------</span>
<span class="comment-line"># Procedure Name: VerifyXmodFileExt</span>
<span class="comment-line">#</span>
<span class="comment-line"># There will be some confusion in naming for the diagnostics xmods b/c</span>
<span class="comment-line"># the x480 and the 8900 have very different names for there xmod types. We will</span>
<span class="comment-line"># sort this out here.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              args</span>
<span class="comment-line">#              dut   --- DUT to check</span>
<span class="comment-line">#              xmod  --- xmod to verify required for the DUT</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#             8900diags || diagnostics </span>
<span class="comment-line">#              </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              set xmod [VerifyXmodFileExt dut $dut xmod $xmod]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line"># -----------------------------------------------------------------------------</span>
<strong><a name="::::VerifyXmodFileExt_97">proc <a href="xmodLib.tcl-annot.html#::::VerifyXmodFileExt">::::VerifyXmodFileExt</a></a></strong><a name="::::VerifyXmodFileExt"></a> {args} {
    global DUTs_info
    global bd8kChassis

    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> VerifyXmodFileExt $args {
        dut     &#34;1&#34;            ;<span class="comment-line"># DUT to check</span>
        xmod    &#34;diagnostics&#34;  ;<span class="comment-line">#</span>
    }

    <span class="comment-line"># There will be some confusion in naming for the diagnostics xmods b/c</span>
    <span class="comment-line"># the x480 and the 8900 have very different names for there xmod types. We will</span>
    <span class="comment-line"># sort this out here.</span>
    if {[regexp -nocase &#34;diag&#34; $xmod]} {
        if {[regexp -nocase &#34;$bd8kChassis&#34; $DUTs_info(DUT${dut},platform)]} {
            return &#34;8900diags&#34;
        } else {
            return &#34;diagnostics&#34;
        }
    } else {
        return $xmod;
    }
}
<span class="comment-line"># -----------------------------------------------------------------------------</span>
<span class="comment-line"># Procedure Name: CheckXmodInstalled</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Check to see if an xmod is installed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              args</span>
<span class="comment-line">#              dut   --- DUT to check</span>
<span class="comment-line">#              xmod  --- xmod to verify required for the DUT</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              1 = is installed</span>
<span class="comment-line">#              0 = not installed</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              if {![CheckXmodInstalled -dut $xmod -xmod $xmod]}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: GetSwitchInfo</span>
<span class="comment-line"># -----------------------------------------------------------------------------</span>
<strong><a name="::::CheckXmodInstalled_139">proc <a href="xmodLib.tcl-annot.html#::::CheckXmodInstalled">::::CheckXmodInstalled</a></a></strong><a name="::::CheckXmodInstalled"></a> {args} {
    global DUTs_info
    global whichDutNow
    global platform
    global connectionTimeout

    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckXmodInstalled $args {
        dut    &#34;1&#34;  ;<span class="comment-line"># DUT</span>
        xmod  &#34;diagnostics&#34; ;<span class="comment-line"># </span>
    }
    global DUT${dut}_CONNECT
    
    set xmod [<a name="::::VerifyXmodFileExt(2)"><a href="./xmodLib.tcl.html#::::VerifyXmodFileExt_97">::::VerifyXmodFileExt</a></a> -dut $dut -xmod $xmod]

    <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECT]
    set partition $DUTs_info(DUT$dut,imageSel)
    set parameterList &#34;&#34;
    lappend parameterList &#34;{${xmod}.*xmod} exist&#34;
    set xmodExists [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show version image $partition&#34; $parameterList \
                    -reportResults 0&#34;]
    unset parameterList
    if {[regexp -nocase &#34;error&#34; $xmodExists&#34;]} {
        <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$xmod is not installed on DUT$dut&#34;
        return 0
    } else {
        <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$xmod image is installed in DUT$dut&#34;
        return 1
    }
}
<span class="comment-line"># -----------------------------------------------------------------------------</span>
<span class="comment-line"># Procedure Name: XmodImageDownload  *** TO BOOTED PARTITION ***</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Download an xmod to a BOOTED image partition</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              args</span>
<span class="comment-line">#              dut   --- DUT to check</span>
<span class="comment-line">#              xmod  --- xmod to verify required for the DUT</span>
<span class="comment-line">#              image --- image passed into proc from moduleArg</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              1 = sucessful</span>
<span class="comment-line">#              0 = not successful</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#              if [XmodImageDownload -dut $dut -xmod $xmod]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: GetSwitchInfo</span>
<span class="comment-line"># -----------------------------------------------------------------------------</span>
<strong><a name="::::XmodImageDownload_189">proc <a href="xmodLib.tcl-annot.html#::::XmodImageDownload">::::XmodImageDownload</a></a></strong><a name="::::XmodImageDownload"></a> {args} {
    global DUTs_info
    global whichDutNow whichMsmNow
    global tftpServerList
    global connectionTimeout
    global moduleArg
    global tftpServerLogin tftpServerPasswd tftpServerTftpboot

    <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> XmodImageDownload $args {
        dut    &#34;1&#34;  ;<span class="comment-line"># DUT</span>
        xmod  &#34;diagnostics&#34; ;<span class="comment-line"># </span>
    }

    global DUT${dut}_CONNECT${whichMsmNow}
    set connect [set DUT${dut}_CONNECT${whichMsmNow}]

    set xmod [<a name="::::VerifyXmodFileExt(3)"><a href="./xmodLib.tcl.html#::::VerifyXmodFileExt_97">::::VerifyXmodFileExt</a></a> -dut $dut -xmod $xmod]

    set partition $DUTs_info(DUT$dut,imageBooted)
    set version $DUTs_info(DUT$dut,version)
    set platform [string tolower $DUTs_info(DUT$whichDutNow,platform)]
    set majMin [<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT$whichDutNow majmin]
    
    set origConnectionTimeout $connectionTimeout
    set connectionTimeout 200

    <a name="::UnconfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::UnconfigGatewayNetwork_2356">::UnconfigGatewayNetwork</a></a>
    <a name="::ConfigGatewayNetwork(1)"><a href="./SendSwCmd.tcl.html#::ConfigGatewayNetwork_2110">::ConfigGatewayNetwork</a></a>

    set xmodFile [<a name="::CopyImageToTftp(1)"><a href="./LocateImage.tcl.html#::CopyImageToTftp_316">::CopyImageToTftp</a></a> -platform &#34;$platform&#34; -version &#34;$version&#34; \
        -majMin &#34;$majMin&#34; \
        -image &#34;$xmod&#34;]

    if {[regexp -nocase &#34;inval&#34; $xmodFile]} {
        <span class="comment-line"># if it fails with the show switch version, try the show version string</span>
        set v1 $version
        catch {set version $DUTs_info(DUT$dut,sVVersion)} oops
        <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Xmod not found at ${v1}. Trying $version&#34;
        set xmodFile [<a name="::CopyImageToTftp(2)"><a href="./LocateImage.tcl.html#::CopyImageToTftp_316">::CopyImageToTftp</a></a> -platform &#34;$platform&#34; -version &#34;$version&#34; \
            -majMin &#34;$majMin&#34; \
            -image &#34;$xmod&#34;]
    }


    if {[regexp -nocase &#34;inval&#34; $xmodFile]} {
        <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Could not copy the $xmod file to the tftp server&#34;
        return 0
    }

    puts &#34;!!\n!!\nDUT = $dut xmodFile = $xmodFile CheckDownloadImage $tftpServerList $xmodFile $partition&#34;
    set dlXStatus [<a name="::CheckDownloadImage(1)"><a href="./downLoadCode.tcl.html#::CheckDownloadImage_943">::CheckDownloadImage</a></a> $tftpServerList $xmodFile $partition]
    if {$dlXStatus == &#34;error&#34;} {
        <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error downloading $xmod xmod to $partition partition&#34;
        return 0
    } else {
        <span class="comment-line"># Remove files from tftp before exit</span>
        foreach TFTPServerIP $tftpServerList {
            <a name="::login_linux(1)"><a href="./linux.tcl.html#::login_linux_16">::login_linux</a></a> $TFTPServerIP $tftpServerLogin $tftpServerPasswd
            catch {<a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;/bin/rm $tftpServerTftpboot/$xmodFile&#34; NULL NULL true 1}
            <a name="::_ClearExpectSession(1)"><a href="./logout.tcl.html#::_ClearExpectSession_215">::_ClearExpectSession</a></a>
        }
    }

    <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $connect -CheckOperational &#34;0&#34; -masterCheck &#34;0&#34;

    set parameterList &#34;&#34;
    lappend parameterList &#34;{${xmod}\.xmod}&#34;
    set xmodExists [<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show version image $partition&#34; $parameterList \
                    -reportResults 0&#34;]
    unset parameterList
    if {[regexp -nocase &#34;error&#34; $xmodExists&#34;]} {
        set connectionTimeout $origConnectionTimeout
        return 0
    } else {
        <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Diagnostics Image is installed successfully in DUT$dut&#34;
        set connectionTimeout $origConnectionTimeout        
        return 1
    }
}

<strong><a name="::::UninstallXmod_269">proc <a href="xmodLib.tcl-annot.html#::::UninstallXmod">::::UninstallXmod</a></a></strong><a name="::::UninstallXmod"></a> {args} {
    global DUTs_info
    global whichDutNow

    <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> UninstallXmod $args {
        xmodList  &#34;diagnostics&#34; ;<span class="comment-line"># a list of xmods to uninstall</span>
    }

    set version $DUTs_info(DUT$whichDutNow,version)
    if {[<a name="::CompareRelease(3)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $version 11.2.0.18]&gt;=0} {
        <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;terminate process thttpd forceful&#34;
    } else {
        <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;terminate process exsshd forceful&#34;
    }
    <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
    <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;
    if {[<a name="::CompareRelease(4)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $version 12.3.0.3]&gt;=0} {
        <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;terminate process snmpMaster forceful&#34;
        <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10
        <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;terminate process xmlc forceful&#34;
        <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10
        <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;terminate process techSupport forceful&#34;
        <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10
    }

    <a name="::::UnInstallXmodImage(1)"><a href="./xmodLib.tcl.html#::::UnInstallXmodImage_307">::::UnInstallXmodImage</a></a>  -xmodList &#34;$xmodList&#34; -p &#34;$DUTs_info(DUT$whichDutNow,imageSel)&#34;

    if {[<a name="::CompareRelease(5)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $version 12.3.0.3]&gt;=0} {
        <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;start process thttpd&#34;
        <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;start process snmpMaster&#34;
        <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;start process techSupport&#34;
        <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;start process xmlc&#34;
        <a name="::exSleep(5)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 5
    }
    <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;&#34;
}


<strong><a name="::::UnInstallXmodImage_307">proc <a href="xmodLib.tcl-annot.html#::::UnInstallXmodImage">::::UnInstallXmodImage</a></a></strong><a name="::::UnInstallXmodImage"></a> {args} {
    global DUTs_info
    global whichDutNow
    global stackable
    global stacking
    global maxSlot
    global DUT1_CONNECTB

    <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> UnInstallXmodImage $args {
        partition   &#34;null&#34;  ;<span class="comment-line"># partition</span>
        p           &#34;sec&#34;   ;<span class="comment-line"># partition</span>
        xmodList    &#34;diag&#34;  ;<span class="comment-line"># </span>
    }

    if {$partition != &#34;null&#34;} {
        set p $partition
    }
    if {[regexp -nocase &#34;pri&#34; $p]} {
        set p &#34;primary&#34;
    } else {
        set p &#34;secondary&#34;
    }

    set dut $whichDutNow
    global DUT${whichDutNow}_CONNECT DUT${whichDutNow}_CONNECTB
    set maxTry 5
    set i 3

    set res 1
    for {set try 0} {$try &lt;= 5 } {incr try } {
        if {$try == $maxTry} {
            <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error removing $moduleName module after trying $maxTry times&#34;
            return 0
        } else {
            if {([regexp -nocase $stackable $DUTs_info(DUT$whichDutNow,platform)]) || \
                     ([<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>] == &#34;BD-12802&#34;)} {

                set output [<a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show version image $partition &#34; ]

                foreach xmod $xmodList {
                    set xmod [<a name="::::VerifyXmodFileExt(4)"><a href="./xmodLib.tcl.html#::::VerifyXmodFileExt_97">::::VerifyXmodFileExt</a></a> -dut $dut -xmod $xmod]
                    set match 0
<span class="comment-line">#set match [regexp -nocase {(Slot secondary|Switch secondary|MM secondary|MSM secondary).* (.*\-diags\.xmod)} $output line part img</span>
                    set match [regexp -nocase \
                    ((Slot.*$p|Switch.*$p|MM.*$p|MSM.*$p).* (\[0-9a-zA-Z\-\.]+-${xmod}\.xmod)) $output line part img]
                    puts &#34;line $line part $part img $img&#34;
                    if {$match &amp;&amp; [regexp -nocase &#34;${xmod}.*xmod&#34; $img]} {
                        <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uninstall image $img $p&#34;
                        <a name="::exSleep(6)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10
                    } else {
                        <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No match for $xmod Xmod on partition $p&#34;
                        return 0
                    }
                }
            } else {
                set msmtype &#34;msm A&#34;
                set output [<a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show version image $partition $msmtype &#34;]
                foreach xmod $xmodList {
                    set xmod [<a name="::::VerifyXmodFileExt(5)"><a href="./xmodLib.tcl.html#::::VerifyXmodFileExt_97">::::VerifyXmodFileExt</a></a> -dut $dut -xmod $xmod]
                    set match 0
                    set match [regexp -nocase \
                    ((Slot.*$p|Switch.*$p|MM.*$p|MSM.*$p).* (\[0-9a-zA-Z\-\.]+-${xmod}\.xmod)) $output line part img]
                    puts &#34;line $line part $part img $img&#34;
                    if {$match &amp;&amp; [regexp -nocase &#34;${xmod}.*xmod&#34; $img]} {
                        <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uninstall image $img $p&#34;
                        <a name="::exSleep(7)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10
                    } else {
                        <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No match for $xmod Xmod on partition $p&#34;
                        return 0
                    }
                }
                if {[info exists DUT${whichDutNow}_CONNECTB]!=1} {
                    return $res
                }
                set msmtype &#34;msm B&#34;
                set output [<a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show version image $partition $msmtype &#34;]
                foreach xmod $xmodList {
                    set xmod [<a name="::::VerifyXmodFileExt(6)"><a href="./xmodLib.tcl.html#::::VerifyXmodFileExt_97">::::VerifyXmodFileExt</a></a> -dut $dut -xmod $xmod]
                    set match 0
                    set match [regexp -nocase \
                    ((Slot.*$p|Switch.*$p|MM.*$p|MSM.*$p).* (\[0-9a-zA-Z\-\.]+-${xmod}\.xmod)) $output line part img]
                    puts &#34;line $line part $part img $img&#34;

                    if {$match &amp;&amp; [regexp -nocase &#34;${xmod}.*xmod&#34; $img]} {
                        <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;uninstall image $img $p&#34;
                        <a name="::exSleep(8)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10
                    } else {
                        <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No match for $xmod Xmod on partition $p&#34;
                        return 0
                    }
                }
                if {[info exists DUT1_CONNECTB]!=1} {
                    return $res
                }
            }
            set j $i
            if { [regexp -nocase &#34;$stacking&#34; [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>]] } {
                set parameterList &#34;&#34;
                lappend parameterList &#34;{Factory MAC address} 2&#34;
                set nodeMac [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking detail&#34; $parameterList]
                set maxSlot [llength $nodeMac]
                if {$maxSlot &gt; 2} {
                    for {set j $i } {$j &lt;= $maxSlot} {incr j } {
                        set msmtype &#34;slot $j&#34;
                        set output [<a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show version image $partition $msmtype &#34;]
                        foreach xmod $xmodList {
                            set xmod [<a name="::::VerifyXmodFileExt(7)"><a href="./xmodLib.tcl.html#::::VerifyXmodFileExt_97">::::VerifyXmodFileExt</a></a> -dut $dut -xmod $xmod]
                            set match 0
                    set match [regexp -nocase \
                    ((Slot.*$p|Switch.*$p|MM.*$p|MSM.*$p).* (\[0-9a-zA-Z\-\.]+-${xmod}\.xmod)) $output line part img]
                    puts &#34;line $line part $part img $img&#34;

                            if {$match &amp;&amp; [regexp -nocase &#34;${xmod}.*xmod&#34; $img]} {
                                set result [<a name="::CheckCmdLegal(1)"><a href="./checkCmdLegality.tcl.html#::CheckCmdLegal_58">::CheckCmdLegal</a></a>  &#34;uninstall image $img $p $msmtype&#34;]
                                <a name="::exSleep(9)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 10
                                if {$result==&#34;illegal&#34;} {
                                    return 0
                                }
                            } else {
                                <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;No match for $xmod Xmod on partition $p&#34;
                                return 0
                            }
                        }
                    }
                    incr j -1
                    if {$j == $maxSlot} {
                        retun $res
                    }
                }
            } else {
                return $res
            }
        }
    }
    <span class="comment-line"># adding delay back - failed on 11.3.1.3 BD-10K</span>
    <a name="::exSleep(10)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
