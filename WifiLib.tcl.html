<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>WifiLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#WifiLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>WifiLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="WifiLib.tcl-annot.html">annotations</a> | <a href="WifiLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">


;<span class="comment-line"># This list should match the order as shown in Odyssey Client Manager Window</span>
set _odysseyClientOffsetList {
    <a name="::any(1)"><a href="./misc.tcl.html#::any_5127">::any</a></a>
    e3_1_3
    e3_1_4
    e3_1_5
    e3_2_11
    e3_2_12
    e3_2_13
    e3_2_14
    e3_2_3
    e3_2_4
    open-dot1x-wep128-eaptls
    open-dot1x-wep128-peap
    open-dot1x-wep64-eaptls
    open-dot1x-wep64-peap
    open-macradius-none
    open-macradius-wep128
    open-macradius-wep64
    open-none-none
    open-none-wep128
    open-none-wep64
    open-wpadyn-aes-eaptls
    open-wpadyn-aes-peap
    open-wpadyn-tkip-eaptls
    open-wpadyn-tkip-peap
    open-wpadyn-wep128-eaptls
    open-wpadyn-wep128-peap
    open-wpadyn-wep64-eaptls
    open-wpadyn-wep64-peap
    open-wpapsk-aes
    open-wpapsk-tkip
    open-wpapsk-wep128
    open-wpapsk-wep64
    shared-macradius-wep128
    shared-macradius-wep64
    shared-none-wep128
    shared-none-wep64
}

<span class="comment-line"># 0    any</span>
<span class="comment-line"># 1    open-dot1x-wep128-eaptls</span>
<span class="comment-line"># 2    open-dot1x-wep128-peap</span>
<span class="comment-line"># 3    open-dot1x-wep128-peap_3_1_4</span>
<span class="comment-line"># 4    open-dot1x-wep128-peap_3_1_5</span>
<span class="comment-line"># 5    open-dot1x-wep128-peap_3_2_11</span>
<span class="comment-line"># 6    open-dot1x-wep128-peap_3_2_12</span>
<span class="comment-line"># 7    open-dot1x-wep128-peap_3_2_13</span>
<span class="comment-line"># 8    open-dot1x-wep128-peap_3_2_14</span>
<span class="comment-line"># 9    open-dot1x-wep128-peap_3_2_3</span>
<span class="comment-line"># 10   open-dot1x-wep128-peap_3_2_4</span>
<span class="comment-line"># 11   open-dot1x-wep64-eaptls-3_1_3</span>
<span class="comment-line"># 12    open-dot1x-wep64-eaptls</span>
<span class="comment-line"># 13    open-dot1x-wep64-peap</span>
<span class="comment-line"># 14   open-macradius-none</span>
<span class="comment-line"># 15   open-macradius-wep128</span>
<span class="comment-line"># 16   open-macradius-wep64</span>
<span class="comment-line"># 17   open-none-none</span>
<span class="comment-line"># 18   open-none-wep128</span>
<span class="comment-line"># 19   open-none-wep64</span>
<span class="comment-line"># 20   open-wpadyn-aes-eaptls</span>
<span class="comment-line"># 21   open-wpadyn-aes-peap</span>
<span class="comment-line"># 22   open-wpadyn-tkip-eaptls</span>
<span class="comment-line"># 23   open-wpadyn-tkip-peap</span>
<span class="comment-line"># 24   open-wpadyn-wep128-eaptls</span>
<span class="comment-line"># 25   open-wpadyn-wep128-peap</span>
<span class="comment-line"># 26   open-wpadyn-wep64-eaptls</span>
<span class="comment-line"># 27   open-wpadyn-wep64-peap</span>
<span class="comment-line"># 28   open-wpapsk-aes</span>
<span class="comment-line"># 29   open-wpapsk-tkip</span>
<span class="comment-line"># 30   open-wpapsk-wep128</span>
<span class="comment-line"># 31   open-wpapsk-wep64</span>
<span class="comment-line"># 32   shared-macradius-wep128</span>
<span class="comment-line"># 33   shared-macradius-wep64</span>
<span class="comment-line"># 34   shared-none-wep128</span>
<span class="comment-line"># 35   shared-none-wep64</span>

<span class="comment-line">########################################</span>
<span class="comment-line"># WifiUnconfigSwitchAll</span>
<span class="comment-line">#</span>
<span class="comment-line"># This one simply performs an &#34;unconfig switch all&#34; command. It</span>
<span class="comment-line"># assumes that you are logged in on the serial console. This is</span>
<span class="comment-line"># necessary because we want to return you to the same switch prompt.</span>
<span class="comment-line"># The telnet session to the terminal server should never go away</span>
<span class="comment-line"># here because we're using the console.</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#     rtnTst - return for success/fail of the proc (0 or 1)</span>
<span class="comment-line">#     sessionId - spawn-id for the console session</span>
<span class="comment-line">#     loginName - Login Name</span>
<span class="comment-line">#     loginPassword - Login Password (optional - default &#34;NULL&#34;)</span>
<span class="comment-line">#     prodType - Product type. Determines expected prompt for CLI.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables:</span>
<span class="comment-line">#     none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#    If success, nothing. If fail, return err string.</span>
<span class="comment-line">########################################</span>
<span class="comment-line">#</span>
<strong><a name="::::WifiUnconfigSwitchAll_103">proc <a href="WifiLib.tcl-annot.html#::::WifiUnconfigSwitchAll">::::WifiUnconfigSwitchAll</a></a></strong><a name="::::WifiUnconfigSwitchAll"></a> {rtnTst sessionId prodType loginName {loginPassword &#34;NULL&#34;} } {

   upvar $rtnTst booVal


   switch -exact -- $prodType {
      1 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      2 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      3 { set cliPrompt &#34;Summit300-24(.*)# $&#34; }
      4 { set cliPrompt &#34;Alpine3802(.*)# $&#34; }
      5 { set cliPrompt &#34;Summit24e3(.*)# $&#34; }
      6 { set cliPrompt &#34;Summit400-24(.*)# $&#34; }
      default { set cliPrompt &#34;(.*)# $&#34; }
   }

<span class="comment-line"># Get back to a prompt in case there was weird lying around</span>
<span class="comment-line"># at the console. ESC for full-screen displays and a &lt;cr&gt;.</span>

   send -i $sessionId &#34;\x1b\r\r&#34;
   after 1000

   send -i $sessionId &#34;\r&#34;
   expect {
      -i $sessionId
      -re $cliPrompt {}
      timeout {
         set rtnError &#34;Error::\(WifiUnconfigSwitchAll\) Can't find CLI prompt.&#34;
         set booVal 0
         return $rtnError
      }
   }

   set cmd &#34;unconfig switch all&#34;
   send -i $sessionId &#34;$cmd\r&#34;
   expect {
      -i $sessionId
      $cmd {}
      timeout { 
         set rtnError &#34;Error::\(WifiUnconfigSwitchAll\) Can't find echo'd CLI command.&#34;
         set booVal 0
         return $rtnError
      }
   }

   expect {
      -i $sessionId
      &#34;\(yes\/no\) $&#34; {}
      timeout {
         set rtnError &#34;Error::\(WifiUnconfigSwitchAll\) Timed out waiting for reboot prompt.&#34;
         set booVal 0
         return $rtnError
      }
   }

   send -i $sessionId &#34;y\r&#34;

<span class="comment-line"># this is what gets tricky sometimes...waiting for the login</span>
<span class="comment-line"># prompt to show up again. I use a for-next loop. If it</span>
<span class="comment-line"># takes longer than I have coded, just change the loop counter</span>
<span class="comment-line"># in the &#34;for&#34; line and before the &#34;break&#34; statement below.</span>
<span class="comment-line"># Using default Expect timeout value of 10 seconds between iterations.</span>

   set backAtLogin 0

   for {set i 1} {$i &lt; 10} {incr i} {
      expect {
         -i $sessionId
         &#34;login: $&#34; {
            set backAtLogin 1
            set i 6
            break
         }
         timeout {}
      }
   }

   if {!$backAtLogin} {
      set rtnError &#34;Error::\(WifiUnconfigSwitchAll\) Never returned to login after reboot.&#34;
      set booVal 0
      return $rtnError
   }

   send -i $sessionId &#34;\r&#34;
   after 5000
   send -i $sessionId &#34;\r&#34;
   after 2000

   send -i $sessionId &#34;$loginName\r&#34;

   expect {
      -i $sessionId
      &#34;password: $&#34; {}
      timeout {
         set rtnError &#34;Error::\(WifiUnconfigSwitchAll\) Timed out waiting for password prompt.&#34;
         set booVal 0
         return $rtnError
      }
   }

   if {$loginPassword == &#34;NULL&#34;} {
      send -i $sessionId &#34;\r&#34;
   } else {
      send -i $sessionId &#34;$loginPassword\r&#34;
   }

   expect {
      -i $sessionId
      -re $cliPrompt {}
      timeout {
         set rtnError &#34;Error::\(WifiUnconfigSwitchAll\) Timed out waiting for password prompt.&#34;
         set booVal 0
         return $rtnError
      }
   }

   set booVal 1
}

<span class="comment-line">######################################## </span>
<span class="comment-line"># GenProcIndex</span>
<span class="comment-line">#</span>
<span class="comment-line"># This proc simply runs the Expect &#34;auto_mkindex&#34; command against the</span>
<span class="comment-line"># absolute path provided in the argument. Make sure that we have a</span>
<span class="comment-line"># current tclIndex reference for the lib path that we want to lappend</span>
<span class="comment-line"># to the Expect &#34;$auto_path&#34; variable.</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#     rtnTst - return for success/fail of the proc (0 or 1)</span>
<span class="comment-line">#     pathName - Absolute pathname of directory where tclIndex</span>
<span class="comment-line">#                will be.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables:</span>
<span class="comment-line">#     none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#    If success, nothing. If fail, return err string.</span>
<span class="comment-line">########################################</span>
<span class="comment-line">#</span>
<strong><a name="::::GenProcIndex_241">proc <a href="WifiLib.tcl-annot.html#::::GenProcIndex">::::GenProcIndex</a></a></strong><a name="::::GenProcIndex"></a> {rtnTst pathName} {

   upvar $rtnTst booVal

   set startDir [pwd]

   cd $pathName

   if {[catch {auto_mkindex . *.tcl} errRtn]} {
      set booVal 0
      cd $startDir
      return $errRtn
   } else {
      set booVal 1
   }
   cd $startDir
}
<span class="comment-line">########################################</span>
<span class="comment-line"># WifiLoadImage</span>
<span class="comment-line">#</span>
<span class="comment-line"># This one simply performs a download image..... command to the</span>
<span class="comment-line"># primary area. It assumes that you are logged in on the serial</span>
<span class="comment-line"># console.</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#     rtnTst - return for success/fail of the proc (0 or 1)</span>
<span class="comment-line">#     sessionId - spawn-id for the telnet/console session</span>
<span class="comment-line">#     prodType - Product type. Determines expected prompt for CLI.</span>
<span class="comment-line">#     tftpServer - the TFTP server address. this is usually</span>
<span class="comment-line">#                  obtained from a config file.</span>
<span class="comment-line">#     imageName - the name of the image at the top level of the</span>
<span class="comment-line">#                 tftpboot directory.</span>
<span class="comment-line">#     priSec - literal &#34;primary&#34; or &#34;secondary&#34;..cli cmd word</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables:</span>
<span class="comment-line">#     none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#    If success, nothing. If fail, return err string.</span>
<span class="comment-line">########################################</span>
<span class="comment-line">#</span>
<strong><a name="::::WifiLoadImage_282">proc <a href="WifiLib.tcl-annot.html#::::WifiLoadImage">::::WifiLoadImage</a></a></strong><a name="::::WifiLoadImage"></a> {rtnTst sessionId prodType tftpSvr imageName priSec} {

   upvar $rtnTst booVal

   switch -exact -- $prodType {
      1 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      2 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      3 { set cliPrompt &#34;Summit300-24(.*)# $&#34; }
      4 { set cliPrompt &#34;Alpine3802(.*)# $&#34; }
      5 { set cliPrompt &#34;Summit24e3(.*)# $&#34; }
      6 { set cliPrompt &#34;Summit400-24(.*)# $&#34; }
      default { set cliPrompt &#34;(.*)# $&#34; }
   }

   send -i $sessionId &#34;download image $tftpSvr $imageName $priSec\r&#34;
   expect {
      -i $sessionId
      -re &#34;(Y/N)\? $&#34; {
         send -i $sessionId &#34;y\r&#34;
      }
      timeout {
         set rtnError &#34;Expect timeout waiting for primary-secondary image load prompt!&#34;
         set booVal 0
         return $rtnError
      }
   }

<span class="comment-line">########################################</span>
<span class="comment-line"># Temporarily set expect timeout to 300 seconds. That's 5 minutes.</span>
<span class="comment-line"># It should never take the switch 5 minutes to download an image.</span>
<span class="comment-line"># If it does, there's something very wrong. There may be more errors</span>
<span class="comment-line"># than we have below. Add them as we find them.</span>
<span class="comment-line">########################################</span>
   set timeout 300

   set flag &#34;ok&#34;
   expect {
      -i $sessionId
      -ex &#34;Error: Access violation&#34; {
         set rtnError &#34;Error: Access violation!&#34;
         set booVal 0
         return $rtnError
      }
      -ex &#34;Could not connect&#34; {
         set rtnError &#34;ERROR: Could not connect with TFTP server!&#34;
         set booVal 0
         return $rtnError
      }
      -ex &#34;Error: File not found&#34; {
         set rtnError &#34;ERROR: Could not find file $imageName on TFTP server!&#34;
         set booVal 0
         return $rtnError
      }
      -re $cliPrompt {
         set booVal 1
      }
      timeout {
         set rtnError &#34;TCL timeout during image download&#34;
         set booVal 0
         return $rtnError
      }
   }
<span class="comment-line">########################################</span>
<span class="comment-line"># If we haven't returned with an error by now, the download probably</span>
<span class="comment-line"># succeeded. There is no easy way to check without parsing through a</span>
<span class="comment-line"># show switch display and that's still no guarantee because we don't</span>
<span class="comment-line"># have an easy way to determine the version and build number just from</span>
<span class="comment-line"># the image file name.</span>
<span class="comment-line">########################################</span>
}

<span class="comment-line">######################################## </span>
<span class="comment-line"># Proc Name: WifiRunSetupCmds</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Desc: Runs initial DUT_SETUP commands on the given DUT</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args   : rtnTst - Return value convention. See README in</span>
<span class="comment-line">#                         this directory</span>
<span class="comment-line">#              : sessionId - spawn-id for the telnet/console session</span>
<span class="comment-line">#              : prodType - product type</span>
<span class="comment-line">#              : setupCmds - setup cmds from the qad-wifi.cfg file.</span>
<span class="comment-line"># Output args  : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    RunSetupCmds rtnTst $sessionId $prodType $DUT_SETUP</span>
<span class="comment-line">#</span>
<span class="comment-line"># NOTE: Most of this was gutted when I moved the procs into the</span>
<span class="comment-line">#       Wireless area. The unconfig sw all option in the code</span>
<span class="comment-line">#       was no longer necessary, since it's in an entirely</span>
<span class="comment-line">#       different proc all it's own.</span>
<span class="comment-line">########################################</span>
<strong><a name="::::WifiRunSetupCmds_373">proc <a href="WifiLib.tcl-annot.html#::::WifiRunSetupCmds">::::WifiRunSetupCmds</a></a></strong><a name="::::WifiRunSetupCmds"></a> {rtnTst sessionId prodType setupCmds} {

   upvar $rtnTst booVal

   puts &#34;\nJUST ENTERED THE WIFIRUNSETUPCMDS PROC\n&#34;

   switch -exact -- $prodType {
      1 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      2 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      3 { set cliPrompt &#34;Summit300-24(.*)# $&#34; }
      4 { set cliPrompt &#34;Alpine3802(.*)# $&#34; }
      5 { set cliPrompt &#34;Summit24e3(.*)# $&#34; }
      6 { set cliPrompt &#34;Summit400-24(.*)# $&#34; }
      default { set cliPrompt &#34;(.*)# $&#34; }
   }

   set timeout 120

   foreach command $setupCmds {

      set rtnVal [<a name="::::WifiSendACmd(1)"><a href="./WifiLib.tcl.html#::::WifiSendACmd_1564">::::WifiSendACmd</a></a> rtnTst $sessionId \
                                      $prodType \
                                      $command]
      if {!$rtnTst} {
         set rtnErr &#34;Error:: \(WifiRunSetupCmds\) CLI returned error.\n$rtnVal&#34;
         set booVal 0
         set timeout 10
         return $rtnErr
      }
   }
   set booVal 1
   set timeout 10
   return
}

<span class="comment-line">######################################## </span>
<span class="comment-line"># Procedure Name: WifiGetDutInfo</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Desc: creates a DUTs_info array after discovering all DUTs</span>
<span class="comment-line">#        information in the testbed. Fills in all elements of</span>
<span class="comment-line">#        DUTs_info array with relevant information.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args   : rtnTst - return success/fail. See README in this directory</span>
<span class="comment-line">#              : sessionId - spawn-id for console/telnet session</span>
<span class="comment-line">#              : prodType - product type</span>
<span class="comment-line">#              : infoFilename - as it says</span>
<span class="comment-line">#              : tmpdir - temp place for info file</span>
<span class="comment-line"># Output args  : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    WifiGetDutInfo rtnTst $sessionId $prodType</span>
<span class="comment-line">#</span>
<span class="comment-line"># NOTE: Usually we will use the defaults for infoFilename and tmpdir.</span>
<span class="comment-line"># NOTE: Wifi QAD only tests 1 DUT at a time.</span>
<span class="comment-line"># NOTE: We're only going to get DUT info once, so we backed out a</span>
<span class="comment-line">#       bunch of code here in anticipation of changing the</span>
<span class="comment-line">#       overall architecture a bit later on.</span>
<span class="comment-line"># NOTE: Also get rid of the &#34;fast&#34; vs. &#34;normal&#34; stuff.</span>
<span class="comment-line">#</span>
<span class="comment-line">########################################</span>
<strong><a name="::::WifiGetDutInfo_433">proc <a href="WifiLib.tcl-annot.html#::::WifiGetDutInfo">::::WifiGetDutInfo</a></a></strong><a name="::::WifiGetDutInfo"></a> {rtnTst sessionId prodType submitter {infoFilename &#34;info&#34;} {tmpdir &#34;Tmp&#34;}} { 
   global numDUT
<span class="comment-line">#   global fast</span>
   global DUT

<span class="comment-line">########################################</span>
<span class="comment-line"># Variable to store all the DUTs information</span>
<span class="comment-line">########################################</span>

   global DUTs_info
   global DUTs_Slot_info
   global branch

<span class="comment-line">########################################</span>
<span class="comment-line"># Note to self: ignore the fd_res stuff for now. Use the following</span>
<span class="comment-line"># 3 lines after replacing the old send command with ours. Do this</span>
<span class="comment-line"># against the returned STRING form from our send command. and then</span>
<span class="comment-line"># &#34;write&#34; the morphed string to the $fd_in file.</span>
<span class="comment-line">########################################</span>

   set fd_res [<a name="::open_result_file(1)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;$infoFilename&#34;]

   set slotDump 0

<span class="comment-line">########################################</span>
<span class="comment-line"># Get the system name</span>
<span class="comment-line">########################################</span>

   set rawShowSwitch [ <a name="::::WifiSendACmd(2)"><a href="./WifiLib.tcl.html#::::WifiSendACmd_1564">::::WifiSendACmd</a></a> rtnTst $sessionId \
                                           $prodType \
                                           &#34;show switch&#34; \
                                           &#34;L&#34; ]

   if {!$rtnTst} {
      set rtnErr &#34;Error::\(WifiGetDutInfo\) CLI command error.\n$rawShowSwitch&#34;
      set booVal 0
      return $rtnErr
   } else {
      set found 0
      foreach showSwitchLine $rawShowSwitch {
         if {[regexp -nocase &#34;^SysName:(.*)&#34; $showSwitchLine]} {
            set sysNameLine $showSwitchLine
            set found 1
         }
      }

      if {$found} {
         set endOfKeyWord [string first &#34;:&#34; $sysNameLine]
         set restOfLine [string range $sysNameLine [expr $endOfKeyWord + 1] end]
         set sysN [string trimleft &#34; \t&#34;]
         set sysN [string trimright &#34;\n\r&#34;]
      } else {
         set $rtnErr &#34;Error:: \(WifiGetDutInfo\) Cannot extract SysName.&#34;
         set booVal 0
         return $rtnErr
      }
   }

   set platFType [string tolower $sysN]

<span class="comment-line">########################################</span>
<span class="comment-line"># Get Slot info dump if Platform Type is BD or BT or Godzilla etc</span>
<span class="comment-line"># Only interested in Alpine right now.</span>
<span class="comment-line">########################################</span>

   set fd_in [open &#34;$tmpdir/tmp_info_DUT-[pid]&#34; &#34;w&#34;]

   set rawShowSwitch [ <a name="::::WifiSendACmd(3)"><a href="./WifiLib.tcl.html#::::WifiSendACmd_1564">::::WifiSendACmd</a></a> rtnTst $sessionId \
                                           $prodType \
                                           &#34;show switch&#34; \
                                           &#34;S&#34; ]

   puts -nonewline $fd_in $rawShowSwitch
   <a name="::result_pre(1)"><a href="./loadConsoles.tcl.html#::result_pre_15">::result_pre</a></a> $rawShowSwitch

   set rawShowVer [ <a name="::::WifiSendACmd(4)"><a href="./WifiLib.tcl.html#::::WifiSendACmd_1564">::::WifiSendACmd</a></a> rtnTst $sessionId \
                                        $prodType \
                                        &#34;show version&#34; \
                                        &#34;S&#34; ]

   puts -nonewline $fd_in $rawShowVer
   <a name="::result_pre(2)"><a href="./loadConsoles.tcl.html#::result_pre_15">::result_pre</a></a> $rawShowVer

   set rawShowVlanDef [ <a name="::::WifiSendACmd(5)"><a href="./WifiLib.tcl.html#::::WifiSendACmd_1564">::::WifiSendACmd</a></a> rtnTst $sessionId \
                                            $prodType \
                                            &#34;show vlan default&#34; \
                                            &#34;S&#34; ]

   puts -nonewline $fd_in $rawShowVlanDef
   <a name="::result_pre(3)"><a href="./loadConsoles.tcl.html#::result_pre_15">::result_pre</a></a> $rawShowVlanDef

   if {[regexp -nocase &#34;Alpine*&#34; $platFType]} {
      set rawShowSlot [ <a name="::::WifiSendACmd(6)"><a href="./WifiLib.tcl.html#::::WifiSendACmd_1564">::::WifiSendACmd</a></a> rtnTst $sessionId \
                                            $prodType \
                                            &#34;show slot&#34; \
                                            &#34;S&#34; ]

      puts -nonewline $fd_in $rawShowSlot
      <a name="::result_pre(4)"><a href="./loadConsoles.tcl.html#::result_pre_15">::result_pre</a></a> $rawShowSlot

      set slotDump 1
   }

   close $fd_in

<span class="comment-line">########################################</span>
<span class="comment-line"># Initialize variables to be gathered. We don't initialize</span>
<span class="comment-line"># the prodType element of the DUTs_info array because we</span>
<span class="comment-line"># have it as an argument to this proc.</span>
<span class="comment-line">########################################</span>

   set imageSel &#34;NONE&#34;
   set priImage &#34;INVALID&#34;
   set secImage &#34;INVALID&#34;
   set version &#34;INVALID&#34;
   set platform &#34;INVALID&#34;
   set techRel   &#34;INVALID&#34;
   set sysMAC &#34;INVALID&#34;
   set bootROM &#34;INVALID&#34;
   set relMaster &#34;INVALID&#34;
   set numPorts 0
   set merge     &#34;INVALID&#34;
   set numSlots  &#34;0&#34;
   set version2  &#34;INVALID&#34;
   set verTime   &#34;INVALID&#34;
   set dlReqD    &#34;0&#34;
   set priVer    &#34;&#34;
   set secVer    &#34;&#34;
   set showVerVersion &#34;&#34;

   set DUTs_info(DUT,imageSel) $imageSel
   set DUTs_info(DUT,priImage) $priImage
   set DUTs_info(DUT,secImage) $secImage
   set DUTs_info(DUT,version) $version
   set DUTs_info(DUT,verTime)   $verTime
   set DUTs_info(DUT,platform) $platform
   set DUTs_info(DUT,sysMAC) $sysMAC
   set DUTs_info(DUT,bootROM) $bootROM
   set DUTs_info(DUT,numSlots)  $numSlots
   set DUTs_info(DUT,relMaster) $relMaster
   set DUTs_info(DUT,numPorts) $numPorts
   set DUTs_info(DUT,techRel)   $techRel
   set DUTs_info(DUT,merge)    $merge
   set DUTs_info(DUT,dlReqD)   $dlReqD
   set DUTs_info(DUT,sysName) $sysN
   set DUTs_info(DUT,debugFlag) 1
   set DUTs_info(DUT,sVVersion) $showVerVersion
   set DUTs_info(DUT,prodType) $prodType
   set DUTs_info(DUT,submitter) $submitter

   set masterOfsset &#34;17&#34;
   set masterEnd &#34;28&#34;
   set isMSM &#34;FALSE&#34;
   set bList &#34;NULL&#34;
   set location &#34;NULL&#34;
   set msmLocation &#34;NULL&#34;
   set msmMaster   &#34;MSM-B&#34;

   set fd_in [open &#34;$tmpdir/tmp_info_DUT-[pid]&#34; &#34;r&#34;]

   while {[gets $fd_in line] != -1} {

      set cookedLine [WifiCookString $line]

      set aList [split $cookedLine]

      if {$bList != &#34;NULL&#34;} {

<span class="comment-line">########################################</span>
<span class="comment-line"># Determine location in file search &#34;show switch, slot or version&#34;</span>
<span class="comment-line">########################################</span>

         if { ([lindex $bList 0] == &#34;sysName:&#34;) || ([lindex $bList 0] == &#34;SysName:&#34;) } {
            set location &#34;switch&#34;
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># Determine if you are in an msm image section</span>
<span class="comment-line">########################################</span>

         if { ([lindex $bList 0] == &#34;MSM-A&#34;) } {
            set msmLocation &#34;MSM-A&#34;
         } elseif {[lindex $bList 0] == &#34;MSM-B&#34;} {
            set msmLocation &#34;MSM-B&#34;
         }

         if { ([lindex $bList 0] == &#34;Chassis:&#34;)  || \
              ([lindex $bList 0] == &#34;Chassis&#34;)   || \
              ([lindex $bList 0] == &#34;CPU&#34;)   || \
              ([lindex $bList 0] == &#34;Daughtercard:&#34;) || \
              ([lindex $bList 0] == &#34;Baseboard:&#34;)  } {
             set location &#34;version&#34;
         }

         if { ([lindex $bList 0] == &#34;Slot&#34;) &amp;&amp;    \
              ([lindex $bList 1] == &#34;1&#34;) &amp;&amp;       \
              ([lindex $bList 2] == &#34;information:&#34;) } {
            set location &#34;slot&#34;
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># 6.2.1b10</span>
<span class="comment-line">########################################</span>

         if { ([lindex $aList 0] == &#34;Current&#34;) &amp;&amp;     \
              ([lindex $aList 1] == &#34;State:&#34;) } {

            set masterOffset &#34;29&#34;
            set masterEnd &#34;40&#34;
            set isMSM &#34;TRUE&#34;
            set msmMaster MSM-B
            if {[string tolower [lindex $aList 2]] == &#34;master&#34; } {
               set masterOfsset &#34;17&#34;
               set masterEnd &#34;28&#34;
               set msmMaster MSM-A
            }
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find both image versions Fix for 700b37 new Show switch</span>
<span class="comment-line">########################################</span>

         if { ([string tolower [lindex $aList 0]] == &#34;primary&#34;) &amp;&amp; \
              ([string tolower [lindex $aList 1]] == &#34;ew&#34;) &amp;&amp; \
              ([string tolower [lindex $aList 2]] == &#34;ver:&#34;) } {
            set priVer [string tolower [lindex $aList 3]]
         }

         if { ([string tolower [lindex $aList 0]] == &#34;secondary&#34;) &amp;&amp;     \
              ([string tolower [lindex $aList 1]] == &#34;ew&#34;) &amp;&amp;        \
              ([string tolower [lindex $aList 2]] == &#34;ver:&#34;) } {
            set secVer [string tolower [lindex $aList 3]]
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find image version selected to boot. Find image version selected</span>
<span class="comment-line"># on switch</span>
<span class="comment-line">########################################</span>

         if { ([lindex $bList 0] == &#34;Software&#34;) &amp;&amp;     \
              ([lindex $bList 1] == &#34;image&#34;) &amp;&amp;        \
              ([lindex $bList 2] == &#34;booted:&#34;) &amp;&amp;      \
              ( $location == &#34;switch&#34;        )  } {

            set imageSel [lindex $bList 3]
            set imageSel [string tolower $imageSel]
            puts &#34;** This is probably an earlier 6.2 s300 **&#34;
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># Fix for ABU new Show Switch 700b44.</span>
<span class="comment-line"># This should work for the Alpine command</span>
<span class="comment-line">########################################</span>

         if { ([lindex $bList 0] == &#34;Module&#34;) &amp;&amp;     \
              ([lindex $bList 1] == &#34;Image&#34;) &amp;&amp;        \
              ([lindex $bList 4] == &#34;Booted&#34;) &amp;&amp;      \
              ( $location == &#34;switch&#34;        )  } {

            set imageSel [lindex $aList 2]
            set imageSel [string tolower $imageSel]

            if {$imageSel == &#34;primary&#34;} {
               set version $priVer
            } elseif {$imageSel == &#34;secondary&#34;} {
               set version $secVer
            }
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># Fix for ABU new Show Switch 700b45 and above</span>
<span class="comment-line">########################################</span>

         if { ([lindex $bList 0] == &#34;------&#34;) &amp;&amp;     \
              ( $location == &#34;switch&#34;        )  } {
            set imageSel [lindex $aList 2]
            set imageSel [string tolower $imageSel]

            if {$imageSel == &#34;primary&#34;} {
                set version $priVer
            } elseif {$imageSel == &#34;secondary&#34;} {
                set version $secVer
            }
         }

         if { ([lindex $bList 0] == &#34;Image&#34;) &amp;&amp;     \
              ([lindex $bList 1] == &#34;Selected:&#34;) &amp;&amp;      \
              ( $location == &#34;switch&#34;        )  } {
            set imageSel [lindex $aList 2]
            set imageSel [string tolower $imageSel]

            if {$imageSel == &#34;primary&#34;} {
               set version $priVer
            } elseif {$imageSel == &#34;secondary&#34;} {
               set version $secVer
            }

            puts &#34;** 700 changes for Alpine **&#34;
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># for 6.2.1</span>
<span class="comment-line">########################################</span>

         if { ([lindex $aList 0] == &#34;Image&#34;) &amp;&amp;     \
              ([lindex $aList 1] == &#34;Booted:&#34;) } {
            set imageSel [lindex [string range $line $masterOfsset $masterEnd] 0]
            set imageSel [string tolower $imageSel]
            puts &#34;** $imageSel from 621 code **&#34;
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find name of image version booted. Find image version booted</span>
<span class="comment-line"># name on MSM</span>
<span class="comment-line">########################################</span>

         set tmp [lindex $bList 0]
         set tmp [string tolower $tmp]

         if { ($tmp == $imageSel) &amp;&amp; ($location == &#34;switch&#34;) &amp;&amp;    \
              ([string tolower [lindex $bList 1]] == &#34;software&#34;) &amp;&amp;        \
              ([string tolower [lindex $bList 2]] == &#34;version:&#34;) } {
            set version [lindex $bList 3]
            set slot [lindex $bList 5]

            if { $slot == &#34;MSM-A&#34; } {

               if {$version == &#34;empty&#34;} {
                  set version [string tolower &#34;[lindex $bList 6]&#34;]
               } else {
                  set version [string tolower &#34;[lindex $bList 3]&#34;]
               }
            }
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># 6.2.1b10</span>
<span class="comment-line">########################################</span>
         set tmp [lindex $aList 0]
         set tmp [string tolower $tmp]

         if { ($tmp == $imageSel) &amp;&amp;     \
              ([string tolower [lindex $aList 1]] == &#34;ew&#34;) &amp;&amp;        \
              ([string tolower [lindex $aList 2]] == &#34;ver:&#34;) &amp;&amp;  \
              ($msmLocation == &#34;NULL&#34;)     } {
            set version [string tolower [lindex $aList 3]]

            if { $isMSM == &#34;TRUE&#34; } {
               if {$masterOfsset == &#34;17&#34;} {
                  set version [string tolower &#34;[lindex [string range $line $masterOfsset $masterEnd] 0]&#34;]
               } else {
                  set version [string tolower &#34;[lindex [string range $line $masterOfsset $masterEnd] 0]&#34;]
               }
            }
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># 7.0.0b39 RTPFixes5</span>
<span class="comment-line">########################################</span>
         set tmp [lindex $bList 0]
         set tmp [string tolower $tmp]

         if { ($tmp == $imageSel) &amp;&amp;     \
              ([string tolower [lindex $bList 1]] == &#34;ew&#34;) &amp;&amp;        \
              ([string tolower [lindex $bList 2]] == &#34;ver:&#34;) &amp;&amp;      \
              ($msmMaster == $msmLocation)    } {
            set version [string tolower [lindex $bList 3]]
         }

         set version1 $version

<span class="comment-line">########################################</span>
<span class="comment-line"># Find the names of the images load in the 2 MSM spaces..</span>
<span class="comment-line">########################################</span>

<span class="comment-line">########################################</span>
<span class="comment-line"># Find primary image</span>
<span class="comment-line">########################################</span>

         if { ( $location == &#34;switch&#34; ) &amp;&amp;     \
              ([string tolower [lindex $bList 0]] == &#34;primary&#34;) &amp;&amp;     \
              ([string tolower [lindex $bList 1]] == &#34;software&#34;) &amp;&amp;    \
              ([string tolower [lindex $bList 2]] == &#34;version:&#34;) } {
            set priImage [lindex $bList 3]
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># For 6.2.1</span>
<span class="comment-line">########################################</span>

         if { ([string tolower [lindex $aList 0]] == &#34;primary&#34;) &amp;&amp;     \
              ([string tolower [lindex $aList 1]] == &#34;ew&#34;) &amp;&amp;    \
              ([string tolower [lindex $aList 2]] == &#34;ver:&#34;) &amp;&amp; \
              ($msmLocation == &#34;NULL&#34;)    } {
            set priImage [lindex [string range $line $masterOfsset $masterEnd] 0]
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># for 700b39 rtpfixes on</span>
<span class="comment-line">########################################</span>

         if { ([string tolower [lindex $bList 0]] == &#34;primary&#34;) &amp;&amp;     \
              ([string tolower [lindex $bList 1]] == &#34;ew&#34;) &amp;&amp;    \
              ([string tolower [lindex $bList 2]] == &#34;ver:&#34;) &amp;&amp; \
              ($msmMaster == $msmLocation)    } {

<span class="comment-line">########################################</span>
           <span class="comment-line">#fix for 701b4</span>
<span class="comment-line">########################################</span>

            if {[regexp -nocase &#34;ssh&#34; [lindex $bList 4]]} {
               set priImage &#34;[lindex $bList 3]&#34;
            } else {
               set priImage &#34;[lindex $bList 3] [lindex $bList 4]&#34;
            }
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># find second image</span>
<span class="comment-line">########################################</span>

         if { ( $location == &#34;switch&#34; ) &amp;&amp;     \
              ([string tolower [lindex $bList 0]] == &#34;secondary&#34;) &amp;&amp;   \
              ([string tolower [lindex $bList 1]] == &#34;software&#34;) &amp;&amp;    \
              ([string tolower [lindex $bList 2]] == &#34;version:&#34;) } {
            set secImage [lindex $bList 3]
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># for 6.2.1</span>
<span class="comment-line">########################################</span>

         if { ([string tolower [lindex $aList 0]] == &#34;secondary&#34;) &amp;&amp;   \
              ([string tolower [lindex $aList 1]] == &#34;ew&#34;) &amp;&amp;    \
              ([string tolower [lindex $aList 2]] == &#34;ver:&#34;) &amp;&amp;  \
              ($msmLocation == &#34;NULL&#34;)    } {
            set secImage [lindex [string range $line $masterOfsset $masterEnd] 0]
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># for 700b39 rtpfixes5 and on</span>
<span class="comment-line">########################################</span>

         if { ([string tolower [lindex $bList 0]] == &#34;secondary&#34;) &amp;&amp;   \
              ([string tolower [lindex $bList 1]] == &#34;ew&#34;) &amp;&amp;    \
              ([string tolower [lindex $bList 2]] == &#34;ver:&#34;) &amp;&amp;  \
              ($msmMaster == $msmLocation)    } {

<span class="comment-line">########################################</span>
<span class="comment-line"># fix for 701b4</span>
<span class="comment-line">########################################</span>
            if {[regexp -nocase &#34;ssh&#34; [lindex $bList 4]]} {
                set secImage &#34;[lindex $bList 3]&#34;
            } else {
                set secImage &#34;[lindex $bList 3] [lindex $bList 4]&#34;
            }
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># find System Name</span>
<span class="comment-line">########################################</span>

         if { ([string tolower [lindex $bList 0]] == &#34;sysname:&#34;) } {
            set platform $sysN
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># find system MAC</span>
<span class="comment-line">########################################</span>

         if { ([lindex $bList 0] == &#34;System&#34;) &amp;&amp;     \
              ([lindex $bList 1] == &#34;MAC:&#34;) } {
            set sysMAC [lindex $bList 2]
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># find release master, time of the build, and the release master</span>
<span class="comment-line">########################################</span>

         if { ( $location == &#34;version&#34; ) &amp;&amp;     \
              ([lindex $bList 0] == &#34;Image&#34;) &amp;&amp;     \
              ([lindex $bList 2] == &#34;Extremeware&#34;) &amp;&amp;  \
              ([lindex $bList 3] == &#34;Version&#34;)} {

            set sVVersionBNum  [lindex $bList 6]
            set sVVersionBNum [string trimright $sVVersionBNum &#34;\)&#34;]
            set showVerVersion &#34;[lindex $bList 4]b$sVVersionBNum&#34;

<span class="comment-line">########################################</span>
<span class="comment-line"># Santa Clara base, Tech Release Code, or branch build??????</span>
<span class="comment-line"># First Case is for IPSERV code. Adjust build # and BuildMaster</span>
<span class="comment-line">########################################</span>

            if {[lindex $bList 8] == &#34;IP_SERV_TECH_REL&#34;} {
               set version2 [lindex $bList 9]
               set relMaster [lindex $bList 11]

<span class="comment-line">########################################</span>
<span class="comment-line"># Set the build time for this Version of Code (for download comparison</span>
<span class="comment-line">########################################</span>

               set verTime &#34;[lindex $bList 12] [lindex $bList 13] [lindex $bList 14]&#34;
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Second Case is for Santa Clara built  </span>
<span class="comment-line">########################################</span>

            if {[lindex $bList 8] != &#34;IP_SERV_TECH_REL&#34;} {
               set relMaster [lindex $bList 8]
               set verTime &#34;[lindex $bList 9] [lindex $bList 10] [lindex $bList 11]&#34;
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># fix for 6.2.1 build 17 (sandbox)</span>
<span class="comment-line">########################################</span>

            if {([lindex $bList 4] == &#34;6.2.1&#34;) &amp;&amp; ([lindex $bList 10] == &#34;on&#34;)} {
               set verTime &#34;[lindex $bList 11] [lindex $bList 12]&#34;
               set relMaster [lindex $bList 9]
               set merge [lindex $bList 7]
               regsub -all {\.} $merge &#34;_&#34; merge
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># fix for 6.2.1 build 10 (new linux buildmaster)</span>
<span class="comment-line">########################################</span>

            if {([lindex $bList 4] == &#34;6.2.1&#34;) &amp;&amp; ([lindex $bList 10] != &#34;on&#34;)} {
               set verTime &#34;[lindex $bList 10] [lindex $bList 11]&#34;
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># fix for 7.0.0 on ncbuild1 FINAL BUILD MASTER?</span>
<span class="comment-line">########################################</span>

            if {([lindex $bList 4] &gt;= &#34;7.0.0&#34;) &amp;&amp; ([lindex $bList 11] == &#34;on&#34;)} {
                set verTime &#34;[lindex $bList 12] [lindex $bList 13]&#34;
                set relMaster [lindex $bList 10]
                set merge [lindex $bList 7]
                regsub -all {\.} $merge &#34;_&#34; merge
                set eight [string trimleft [lindex $bList 8] &#34;\[&#34;]
                set eight [string trimright $eight &#34;\]&#34;]
                set merge [format %s_%s $merge $eight]
            }

            if {([lindex $bList 4] &gt;= &#34;7.0.0&#34;) &amp;&amp; ([lindex $bList 10] == &#34;on&#34;)} {
               set verTime &#34;[lindex $bList 11] [lindex $bList 12]&#34;
               set relMaster [lindex $bList 9]
            }

            if {([lindex $bList 4] &gt;= &#34;7.0.0&#34;) &amp;&amp; ([lindex $bList 9] == &#34;on&#34;)} {
               set verTime &#34;[lindex $bList 10] [lindex $bList 11]&#34;
               set relMaster [lindex $bList 8]
            }
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># find BootROM</span>
<span class="comment-line">########################################</span>

         if { ([lindex $bList 0] == &#34;BootROM&#34;) } {
            set bootROM [lindex $bList 2]
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># find total ports</span>
<span class="comment-line">########################################</span>

         if { ([lindex $bList 0] == &#34;Ports:&#34;) } {
            set numPorts [lindex $bList 1]
         }
      }
      set bList $aList
   }  ;<span class="comment-line"># end while</span>

<span class="comment-line">########################################</span>
<span class="comment-line"># Add the Technology Release or Merge info to the version</span>
<span class="comment-line">########################################</span>

   if {$version2 == &#34;INVALID&#34;} {
      set version &#34;$version1&#34;
   } else {
      set version &#34;$version1 $version2&#34;
   }

<span class="comment-line">########################################</span>
<span class="comment-line"># get slot info to figure out hardware type</span>
<span class="comment-line">########################################</span>

   set hardwareType &#34;NEW_GEN&#34;
   set bladeType &#34;NONE&#34;

   if {[regexp -nocase &#34;bd|bt|godzilla|alpine*&#34; $platform]} {
      lappend parameterList &#34;{HW Module Type:} 1&#34;

      set HardwareList [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> rtnTst $sessionId \
                                           $prodType \
                                           &#34;show slot&#34; \
                                            $parameterList]
      unset parameterList

      foreach hardware $HardwareList {
         if {[lsearch -regexp $bladeType $hardware]==-1} {
            if {$bladeType==&#34;NONE&#34;} {
               set bladeType &#34;&#34;
            }
            if {![regexp -nocase &#34;none|Empty&#34; $hardware]} {
                  set bladeType &#34;$bladeType$hardware&#34;
            }
         }

         switch $hardware {
            F32T -
            F24T {
               set hardwareType &#34;OLD_GEN&#34;
               }
         }
      }
   } else {
      if { [regexp -nocase {[0-9|s]i} $platform] == 0 } {
         set hardwareType &#34;OLD_GEN&#34;
      }
   }

<span class="comment-line">###########################################</span>
<span class="comment-line"># Determine number of slots in the chassis</span>
<span class="comment-line">###########################################</span>

   switch $platFType {
      alpine3808 {set numSlots 8}
      alpine3804 {set numSlots 4}
      alpine3802 {set numSlots 2}
      default    {set numSlots 0}
   }

   puts &#34;** Version $version **&#34;

   set DUTs_info(DUT,imageSel) $imageSel
   set DUTs_info(DUT,priImage) $priImage
   set DUTs_info(DUT,secImage) $secImage
   set DUTs_info(DUT,version) $version
   set DUTs_info(DUT,verTime) $verTime
   set DUTs_info(DUT,platform) $platform
   set DUTs_info(DUT,sysMAC) [string toupper $sysMAC]
   set DUTs_info(DUT,relMaster) $relMaster
   set DUTs_info(DUT,bootROM) $bootROM
   set DUTs_info(DUT,numSlots) $numSlots
   set DUTs_info(DUT,numPorts) $numPorts
   set DUTs_info(DUT,HardwareType) $hardwareType
   set DUTs_info(DUT,bladeType) $bladeType
   set DUTs_info(DUT,techRel) $version2
   set DUTs_info(DUT,merge) [string tolower $merge]
   set DUTs_info(DUT,dlReqD) $dlReqD
   set DUTs_info(DUT,sVVersion) $showVerVersion

   if { $version2 != &#34;INVALID&#34; } {
      set buildList [split $version2 &#34;.&#34;]
      set bNum [lindex $buildList 0]
      set branch &#34;$version1 ipserv[string trimleft $bNum &#34;v&#34;]&#34;
   } else {
      set branch &#34;$version1&#34;
   }

   global _VERSION
   global VERSION
   set _VERSION $version
   set VERSION [string range $_VERSION 0 0]
   set DUTs_info(DUT,VERSION) $VERSION

   close $fd_in

   <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>

<span class="comment-line">########################################</span>
<span class="comment-line"># Now get the info from the individual slots if platform matches</span>
<span class="comment-line">########################################</span>

   if {$slotDump} {
       <a name="::::WifiGetDUTsSlotInfo(1)"><a href="./WifiLib.tcl.html#::::WifiGetDUTsSlotInfo_1205">::::WifiGetDUTsSlotInfo</a></a> $tmpdir
   }

   if {![info exists DUT(LoadImage)]} { ;<span class="comment-line"># Need to turn of when run LoadImage</span>
       <a name="::::getTECardSpeed(1)"><a href="./swConf.tcl.html#::::getTECardSpeed_1662">::::getTECardSpeed</a></a>
   }

<span class="comment-line">#   for {set i 1} {$i &lt;= $numDUT} {incr i 1} {</span>
   file delete &#34;$tmpdir/tmp_info_DUT-[pid]&#34;
<span class="comment-line">#   }</span>
}

<span class="comment-line">#######################################</span>
<span class="comment-line"># Proc Name: WifiAddTestbedInfoToDUTs_info</span>
<span class="comment-line"># Desc: Append test bed specific information to DUTs_info array</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args   : none</span>
<span class="comment-line"># Output args  : none</span>
<span class="comment-line"># Return value : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#    WifiAddTestbedInfoToDUTs_info</span>
<span class="comment-line">#</span>
<span class="comment-line"># NOTE: This proc was copied from file &#34;SystemSetup.tcl&#34; that was</span>
<span class="comment-line">#       originally located in the Lib area of the general automation</span>
<span class="comment-line">#       suite. mferreri 07-16-2004</span>
<span class="comment-line">########################################</span>
<strong><a name="::::WifiAddTestbedInfoToDUTs_info_1139">proc <a href="WifiLib.tcl-annot.html#::::WifiAddTestbedInfoToDUTs_info">::::WifiAddTestbedInfoToDUTs_info</a></a></strong><a name="::::WifiAddTestbedInfoToDUTs_info"></a> {} {

   global defaultRouter tftpServerList switchPort2DefaultRouter \
          POWERCYCLE_IP POWERCYCLE_PORTS tftpShareName connectionTimeout

   global numDUT DUTs_info

   if {[info exists tftpServerList]} {
      set DUTs_info(tftpserverlist) $tftpServerList
   }

   if {[info exists defaultRouter]} {
      set DUTs_info(defaultRouter) $defaultRouter
   }

   if {[info exists POWERCYCLE_IP]} {
      set DUTs_info(powercycle_ip) $POWERCYCLE_IP
   }

   if {[info exists POWERCYCLE_PORTS]} {
      set DUTs_info(powercycle_ports) $POWERCYCLE_PORTS
   }

   if {[info exists tftpShareName]} {
      set DUTs_info(tftpsharename) $tftpShareName
   }

   if {[info exists switchPort2DefaultRouter]} {
      set DUTs_info(switchport2defaultrouter) $switchPort2DefaultRouter
   }

   if {[info exists connectionTimeout]} {
      set DUTs_info(connectiontimeout) $connectionTimeout
   }


   global DUT_CONNECT
   global DUT_IP
   global DUT_SETUP
   global DUT_TERMSVRIP
   global DUT_TERMSVRPORT

   set DUTs_info(DUT,connect) [set DUT_CONNECT]
   set DUTs_info(DUT,ip) [set DUT_IP]
   set DUTs_info(DUT,setup) [set DUT_SETUP]
   set DUTs_info(DUT,termsvrip) [set DUT_TERMSVRIP]
   set DUTs_info(DUT,termsvrport) [set DUT_TERMSVRPORT]

}


<span class="comment-line">######################################## </span>
<span class="comment-line"># Proc Name: WifiGetDUTsSlotInfo</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Desc: This creates and fills in the array  DUTs_Slot_info with the</span>
<span class="comment-line">#       help of DUTs_info. All slot specific necessary information</span>
<span class="comment-line">#       may be obtained from this array. This array may be referred</span>
<span class="comment-line">#       with known information of DUT and slot number</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args   : tmpdir</span>
<span class="comment-line"># Output args  : none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    WifiGetDUTsSlotInfo $tmpdir</span>
<span class="comment-line">#</span>
<span class="comment-line">########################################</span>
<strong><a name="::::WifiGetDUTsSlotInfo_1205">proc <a href="WifiLib.tcl-annot.html#::::WifiGetDUTsSlotInfo">::::WifiGetDUTsSlotInfo</a></a></strong><a name="::::WifiGetDUTsSlotInfo"></a> {{tmpdir &#34;Tmp&#34;}} {

   global spawn_id
   global numDUT
   global fast

   set numSlots 8

<span class="comment-line">########################################</span>
<span class="comment-line"># Variable to store all the DUTs interested information</span>
<span class="comment-line">########################################</span>

   global DUTs_info

   global DUTs_Slot_info

   set fd_res [<a name="::open_result_file(2)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;slotinfo&#34;]

<span class="comment-line">########################################</span>
<span class="comment-line"># We're only doing 1  DUT at a time. Removed or commented out</span>
<span class="comment-line"># all references to multiple DUTs for now until we get around</span>
<span class="comment-line"># to re-architecting this portion of the suite.</span>
<span class="comment-line"># mferreri 07-21-2004</span>
<span class="comment-line">########################################</span>

   global DUT_CONNECT

   set numSlots $DUTs_info(DUT$i,numSlots)
   set hwModType &#34;NULL&#34;
   set confType  &#34;NULL&#34;
   set state     &#34;NULL&#34;
   set npRev     &#34;NULL&#34;
   set npProc1   &#34;NULL&#34;
   set npProc2   &#34;NULL&#34;
   set imageSel  &#34;NULL&#34;
   set priImage  &#34;NULL&#34;
   set secImage  &#34;NULL&#34;
   set version   &#34;NULL&#34;
   set verTime   &#34;NULL&#34;
   set dlReqD    &#34;0&#34;
   set category  &#34;NULL&#34;

   for {set j 1} {$j &lt;= $numSlots} {incr j} {
      <span class="comment-line"># Hardware module type</span>
      set DUTs_Slot_info(DUT,slot$j,hwModType) $hwModType
      <span class="comment-line"># Module type set in the configuration</span>
      set DUTs_Slot_info(DUT,slot$j,confType)  $confType
      <span class="comment-line"># State of the card (Operational or not)</span>
      set DUTs_Slot_info(DUT,slot$j,state)     $state
      <span class="comment-line"># Revision of the C5 Network Processor</span>
      set DUTs_Slot_info(DUT,slot$j,npRev)     $npRev
      <span class="comment-line"># Status of each NP on the slot</span>
      set DUTs_Slot_info(DUT,slot$j,npProc1)   $npProc1
      <span class="comment-line"># Status of each NP on the slot</span>
      set DUTs_Slot_info(DUT,slot$j,npProc2)   $npProc2
      <span class="comment-line"># Image selected to boot from</span>
      set DUTs_Slot_info(DUT,slot$j,imageSel)  $imageSel
      <span class="comment-line"># Image in the primary slot</span>
      set DUTs_Slot_info(DUT,slot$j,priImage)  $priImage
      <span class="comment-line"># Image in the secondary slot</span>
      set DUTs_Slot_info(DUT,slot$j,secImage)  $secImage
      <span class="comment-line"># Image in the slot that is chosen to boot from ASSUMED RUNNING IMAGE</span>
      set DUTs_Slot_info(DUT,slot$j,version)   $version
      <span class="comment-line"># Date and Time that the running image was made</span>
      set DUTs_Slot_info(DUT,slot$j,verTime)   $verTime
      <span class="comment-line"># For use to determine downloads</span>
      set DUTs_Slot_info(DUT,slot$j,dlReqD)    $dlReqD
      <span class="comment-line"># Set category OldGen NewGen NP</span>
      set DUTs_Slot_info(DUT,slot$j,category)  $category

   }

<span class="comment-line">########################################</span>
<span class="comment-line"># For the NP Cards we need more than 1 line captured</span>
<span class="comment-line">########################################</span>

   set bList &#34;NULL&#34;
   set location &#34;NULL&#34;

   set fd_in [open &#34;$tmpdir/tmp_info_DUT-[pid]&#34; &#34;r&#34;]

   while {[gets $fd_in line] != -1} {
      set cookedLine [WifiCookString $line]

      set aList [split $cookedLine]

      if {$bList != &#34;NULL&#34;} {

<span class="comment-line">########################################</span>
<span class="comment-line"># Determine location in file search &#34;show switch, slot or version&#34;</span>
<span class="comment-line">########################################</span>

         if { ([lindex $bList 0] == &#34;sysName:&#34;)} {
            set location &#34;switch&#34;
         }

         if { ([lindex $bList 0] == &#34;Chassis:&#34;)} {
            set location &#34;version&#34;
         }

<span class="comment-line">########################################</span>
<span class="comment-line"># Loop through slots </span>
<span class="comment-line">########################################</span>
         for {set j 1} {$j &lt;= $numSlots} {incr j} {

            if { ([lindex $bList 0] == &#34;Slot&#34;) &amp;&amp; \
                 ([lindex $bList 1] == &#34;$j&#34;) &amp;&amp;   \
                 ([lindex $bList 2] == &#34;information:&#34;) } {
               set location &#34;slot$j&#34;
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find image version selected to boot</span>
<span class="comment-line"># Find image version selected on an NP Card</span>
<span class="comment-line">########################################</span>


            if {([lindex $bList 0] == &#34;Software&#34;) &amp;&amp;  \
                ([lindex $bList 1] == &#34;image&#34;) &amp;&amp;     \
                ([lindex $bList 2] == &#34;booted:&#34;) &amp;&amp;   \
                ( $location == &#34;slot$j&#34; ) } {
               set DUTs_Slot_info(DUT,slot$j,imageSel) [lindex $bList 3]
               set npImageSel $DUTs_Slot_info(DUT,slot$j,imageSel)
               set DUTs_Slot_info(DUT,slot$j,imageSel) \
                  [string tolower $DUTs_Slot_info(DUT,slot$j,imageSel)]
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find name of image version booted</span>
<span class="comment-line"># Find image version booted name on an NP Card</span>
<span class="comment-line">########################################</span>

            set tmp [lindex $bList 0]
            set tmp [string tolower $tmp]

            if {($tmp == $DUTs_Slot_info(DUT,slot$j,imageSel)) &amp;&amp;   \
                ([string tolower [lindex $bList 1]] == &#34;software&#34;) &amp;&amp; \
                ([string tolower [lindex $bList 2]] == &#34;version:&#34;) &amp;&amp; \
                ($location == &#34;slot$j&#34;) } {
               set DUTs_Slot_info(DUT,slot$j,version) \
                  &#34;[lindex $aList 1] \
                   [string trimleft [lindex $aList 2] &#34;(&#34;] \
                   [string trimright [lindex $aList 3] &#34;)&#34;] \
                   [lindex $aList 6]&#34;

               if {[lindex $aList 4] == &#34;Prj&#34;} {
                  set DUTs_Slot_info(DUT,slot$j,verTime) \
                     &#34;[lindex $aList 12] [lindex $aList 13] \
                      [lindex $aList 14] [lindex $aList 15] \
                      [lindex $aList 16]&#34;
               }

               if {[lindex $aList 4] == &#34;(Type:&#34;} {
                  set DUTs_Slot_info(DUT,slot$j,verTime) \
                     &#34;[lindex $aList 9] [lindex $aList 10] \
                      [lindex $aList 11] [lindex $aList 12] \
                      [lindex $aList 13]&#34;
               }

               if {([lindex $aList 0] == &#34;6.2.1&#34;)  &amp;&amp; \
                   ([lindex $aList 4] == &#34;by&#34;) } {
                  set DUTs_Slot_info(DUT,slot$j,verTime) \
                     &#34;[lindex $aList 7] [lindex $aList 8] \
                      [lindex $aList 9]&#34;
                  set DUTs_Slot_info(DUT,slot$j,version) \
                     &#34;[lindex $aList 0] [string trimleft \
                      [lindex $aList 1] &#34;(&#34;] \
                      [string trimright [lindex $aList 2] &#34;)&#34;]&#34;
               }

               if {([lindex $aList 0] &gt;= &#34;7.0.0&#34;)  &amp;&amp; \
                   ([lindex $aList 5] == &#34;by&#34;) } {
                  set DUTs_Slot_info(DUT,slot$j,verTime) \
                     &#34;[lindex $aList 8] [lindex $aList 9] \
                      [lindex $aList 10]&#34;
                  set DUTs_Slot_info(DUT,slot$j,version) \
                     &#34;[lindex $aList 0] [lindex $aList 3]&#34;
               }

               if {([lindex $aList 0] &gt;= &#34;7.0.0&#34;)  &amp;&amp; \
                   ([lindex $aList 4] == &#34;by&#34;) } {
                  set DUTs_Slot_info(DUT,slot$j,verTime) \
                     &#34;[lindex $aList 7] [lindex $aList 8] \
                      [lindex $aList 9]&#34;
                  set DUTs_Slot_info(DUT,slot$j,version) \
                     &#34;[lindex $aList 0] b[string trimright \
                      [lindex $aList 2] &#34;)&#34;]&#34;
               }
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find the names of the images load in the 2 spaces.. NP cards###</span>
<span class="comment-line"># Find primary image</span>
<span class="comment-line">########################################</span>

            if {( $location == &#34;slot$j&#34; ) &amp;&amp; \
                ([string tolower [lindex $bList 0]] == &#34;primary&#34;) &amp;&amp; \
                ([string tolower [lindex $bList 1]] == &#34;software&#34;) &amp;&amp; \
                ([string tolower [lindex $bList 2]] == &#34;version:&#34;) } {
               set DUTs_Slot_info(DUT,slot$j,priImage) \
                  &#34;[lindex $aList 1] [string trimleft \
                   [lindex $aList 2] &#34;(&#34;] \
                   [string trimright [lindex $aList 3] &#34;)&#34;] \
                   [lindex $aList 6]&#34;

               if {[lindex $aList 0] == &#34;6.2.1&#34;} {
                  set DUTs_Slot_info(DUT,slot$j,priImage) \
                     &#34;[lindex $aList 0] [string trimleft \
                      [lindex $aList 1] &#34;(&#34;] [string trimright [lindex $aList 2] &#34;)&#34;]&#34;
               }
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find second image</span>
<span class="comment-line">########################################</span>

            if {($location == &#34;slot$j&#34; ) &amp;&amp; \
                ([string tolower [lindex $bList 0]] == &#34;secondary&#34;) &amp;&amp; \
                ([string tolower [lindex $bList 1]] == &#34;software&#34;) &amp;&amp;  \
                ([string tolower [lindex $bList 2]] == &#34;version:&#34;) } {
               set DUTs_Slot_info(DUT,slot$j,secImage) \
                  &#34;[lindex $aList 1] [string trimleft \
                   [lindex $aList 2] &#34;(&#34;] [string trimright [lindex $aList 3] &#34;)&#34;] \
                   [lindex $aList 6]&#34;

               if {[lindex $aList 0] == &#34;6.2.1&#34;} {
                  set DUTs_Slot_info(DUT,slot$j,secImage) \
                     &#34;[lindex $aList 0] [string trimleft \
                      [lindex $aList 1] &#34;(&#34;] [string trimright [lindex $aList 2] &#34;)&#34;]&#34;
               }
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find Hardware module type</span>
<span class="comment-line">########################################</span>

            if {([lindex $bList 0] == &#34;HW&#34;) &amp;&amp; \
                ([lindex $bList 2] == &#34;Type:&#34;) &amp;&amp; \
                ($location == &#34;slot$j&#34;) } {
               set DUTs_Slot_info(DUT,slot$j,hwModType) \
                  [string toupper [lindex $bList 3]]
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find Slot s/w Configured setting</span>
<span class="comment-line">########################################</span>

            if {([lindex $bList 0] == &#34;Configured&#34;) &amp;&amp; \
                ([lindex $bList 1] == &#34;Type:&#34;) &amp;&amp; \
                ($location == &#34;slot$j&#34;) } {
               set DUTs_Slot_info(DUT,slot$j,confType) \
                  [string toupper [lindex $bList 2]]
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find find operational state</span>
<span class="comment-line">########################################</span>

            if {([lindex $bList 0] == &#34;State:&#34;) &amp;&amp; \
                ($location == &#34;slot$j&#34;) } {
               set DUTs_Slot_info(DUT,slot$j,state) [lindex $bList 1]
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find NP Revision</span>
<span class="comment-line">########################################</span>

            if {([lindex $bList 0] == &#34;NP&#34;) &amp;&amp;  \
                ([lindex $bList 1] == &#34;1:&#34;) &amp;&amp; \
                ([lindex $bList 2] == &#34;Rev&#34;) &amp;&amp; \
                ($location == &#34;slot$j&#34;) } {
               set DUTs_Slot_info(DUT,slot$j,npRev) [lindex $bList 3]
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find NP 1 Proc State</span>
<span class="comment-line">########################################</span>

            if {([lindex $bList 0] == &#34;Network&#34;) &amp;&amp; \
                 ([lindex $bList 1] == &#34;Processor&#34;) &amp;&amp; \
                 ([lindex $bList 2] == &#34;1&#34;) &amp;&amp; \
                 ($location == &#34;slot$j&#34;) } {
               set DUTs_Slot_info(DUT,slot$j,npProc1) [lindex $bList 4]
            }

<span class="comment-line">########################################</span>
<span class="comment-line"># Find NP 2 Proc State</span>
<span class="comment-line">########################################</span>

            if {([lindex $bList 0] == &#34;Network&#34;) &amp;&amp;  \
                ([lindex $bList 1] == &#34;Processor&#34;) &amp;&amp; \
                ([lindex $bList 2] == &#34;2&#34;) &amp;&amp; \
                ($location == &#34;slot$j&#34;) } {
               set DUTs_Slot_info(DUT,slot$j,npProc2) [lindex $bList 4]
            }
         }
      }
      set bList $aList
   }

   for {set j 1} {$j &lt;= $numSlots} {incr j} {

      switch $DUTs_Slot_info(DUT,slot$j,hwModType) {
         &#34;A3ci&#34;    {set DUTs_Slot_info(DUT,slot$j,category) NP}
         &#34;P3ci&#34;    {set DUTs_Slot_info(DUT,slot$j,category) NP}
         &#34;P12ci&#34;   {set DUTs_Slot_info(DUT,slot$j,category) NP}
         &#34;ARM&#34;     {set DUTs_Slot_info(DUT,slot$j,category) NP}
         &#34;ASMGM2X&#34; {set DUTs_Slot_info(DUT,slot$j,category) NP}
         &#34;MPLS&#34;    {set DUTs_Slot_info(DUT,slot$j,category) NP}
         &#34;SMA&#34;     {set DUTs_Slot_info(DUT,slot$j,category) NP}
         &#34;G8Xi&#34;    {set DUTs_Slot_info(DUT,slot$j,category) NEW_GEN}
         &#34;F48Ti&#34;   {set DUTs_Slot_info(DUT,slot$j,category) NEW_GEN}
         &#34;G12Xi&#34;   {set DUTs_Slot_info(DUT,slot$j,category) NEW_GEN}
         &#34;F32T&#34;    {set DUTs_Slot_info(DUT,slot$j,category) OLD_GEN}
         &#34;F24T&#34;    {set DUTs_Slot_info(DUT,slot$j,category) OLD_GEN}
      }

   }

   close $fd_in
   <a name="::close_result_file(2)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
}

<span class="comment-line">########################################</span>
<span class="comment-line"># WifiSendACmd</span>
<span class="comment-line">#</span>
<span class="comment-line"># This one is for sending commands to a &#34;session&#34; and retrieving the</span>
<span class="comment-line"># output. Only line oriented displays will work with this. Full</span>
<span class="comment-line"># screen refreshed displays will NOT work. They are a pain in the</span>
<span class="comment-line"># a&amp;&amp; and require special parsing and processing.</span>
<span class="comment-line"># </span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#     rtnTst    - return for success (1) or fail (0) of the proc.</span>
<span class="comment-line">#     sessionId - Session Id (spawn-id from TCL)</span>
<span class="comment-line">#     prodType  - Prod Type. Determines expected prompt for CLI</span>
<span class="comment-line">#                 in this proc.</span>
<span class="comment-line">#     cmd       - Command that we need to execute.</span>
<span class="comment-line">#     &#34;S or &#34;L&#34; - return the display as single String or List. Each</span>
<span class="comment-line">#                 display line will be an element of the list</span>
<span class="comment-line">#                 returned. Default is &#34;S&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables: </span>
<span class="comment-line">#     none </span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#     If rtnTst 1; Cmd succeeded - no syntax problem. Returns</span>
<span class="comment-line">#                  display as single string or list of lines</span>
<span class="comment-line">#                  is returned.</span>
<span class="comment-line">#     If rtnTst 0; Command failed with syntax error. Return is</span>
<span class="comment-line">#                  the syntax error message from the CLI.</span>
<span class="comment-line">#</span>
<span class="comment-line"># NOTE: If no command string provided we will do a &lt;cr&gt;.</span>
<span class="comment-line"># NOTE: Syntax error displays are always returned as single string</span>
<span class="comment-line">#       (minus &lt;cr&gt;'s.</span>
<span class="comment-line"># NOTE: We use &#34;send_slow&#34; in this routine because we have observed</span>
<span class="comment-line">#       at various times that command strings get split up, especially</span>
<span class="comment-line">#       if they are being given to a serial console session.</span>
<span class="comment-line">#       Using 2 characters every .01 seconds.</span>
<span class="comment-line">########################################</span>
<strong><a name="::::WifiSendACmd_1564">proc <a href="WifiLib.tcl-annot.html#::::WifiSendACmd">::::WifiSendACmd</a></a></strong><a name="::::WifiSendACmd"></a> {rtnTst sessionId prodType {cmd &#34;&#34;} {dFormat &#34;S&#34;} } {

   upvar $rtnTst booVal

   switch -exact -- $prodType {
      1 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      2 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      3 { set cliPrompt &#34;Summit300-24(.*)# $&#34; }
      4 { set cliPrompt &#34;Alpine3802(.*)# $&#34; }
      5 { set cliPrompt &#34;Summit24e3(.*)# $&#34; }
      default { set cliPrompt &#34;(.*)# $&#34; }
   }

   set send_slow {2 .01}

<span class="comment-line"># send a &#34;seed&#34; &lt;cr&gt; and make sure we're at a prompt.</span>

   send -s -i $sessionId &#34;\r&#34;

   after 500

   expect {
      -i $sessionId
      -re $cliPrompt {}
      timeout {
         set rtnError &#34;Error::\(WifiSendACmd\) Timeout looking for return to CLI prompt.&#34;
         set booVal 0
         return $rtnError
      }
   }

<span class="comment-line">########################################</span>
<span class="comment-line"># This is the &#34;meat of the routine.</span>
<span class="comment-line"># 1. Send the command provided</span>
<span class="comment-line"># 2. Get the output display.</span>
<span class="comment-line"># 3. Remove all the &lt;cr&gt;'s</span>
<span class="comment-line"># 4. Check for syntax error. If found, return immediately with error.</span>
<span class="comment-line"># 5. If no syntax error, format the return display into a list if the</span>
<span class="comment-line">#    $dFormat variable is set to &#34;L&#34;, else leave as single string.</span>
<span class="comment-line"># 6. set the booVal for success, re-enable CLI paging and return the</span>
<span class="comment-line">#    display output.</span>
<span class="comment-line">########################################</span>

   send -s -i $sessionId &#34;$cmd\r&#34;
   expect {
      -i $sessionId
      -ex $cmd {}
      timeout {
         set rtnError &#34;Error::\(WifiSendACmd\) Could not find echo'd command string.&#34;
         set booVal 0
         return $rtnError
      }
   }

   expect {
      -i $sessionId
      -re $cliPrompt {
         set exp_out $expect_out(buffer)
         regsub -all &#34;\r&#34; $exp_out &#34;&#34; exp_out
         regsub -all &#34;\t&#34; $exp_out &#34; &#34; exp_out

         if {[regexp &#34;(.*)Syntax error at(.*)&#34; $exp_out]} {
            set rtnError $exp_out
            set booVal 0
            return $rtnError
         }

         if {[regexp &#34;(.*)Error: (.*)&#34; $exp_out]} {
            set rtnError $exp_out
            set booVal 0
            return $rtnError
         }

         set booVal 1
         if {$dFormat == &#34;L&#34;} {
            regsub -all &#34;\r&#34; $exp_out &#34;&#34; displayList
            set displayList [string trim $displayList &#34;\n&#34;]
            set displayList [split $displayList &#34;\n&#34;]
         }
      }

      &#34;\\?&#34; {
         send -i $sessionId &#34;y\r&#34;
         expect {
            -i $sessionId
            -re $cliPrompt {
               set exp_out $expect_out(buffer)
               regsub -all &#34;\r&#34; $exp_out &#34;&#34; exp_out
               regsub -all &#34;\t&#34; $exp_out &#34; &#34; exp_out

               set booVal 1
               if {$dFormat == &#34;L&#34;} {
                  regsub -all &#34;\r&#34; $exp_out &#34;&#34; displayList
                  set displayList [string trim $displayList &#34;\n&#34;]
                  set displayList [split $displayList &#34;\n&#34;]
               }
            }
         }
      }

      &#34;n)\\?  &#34; {
         send -i $sessionId &#34;y\r&#34;
         expect {
            -i $sessionId
            -re $cliPrompt {
               set exp_out $expect_out(buffer)
               regsub -all &#34;\r&#34; $exp_out &#34;&#34; exp_out
               regsub -all &#34;\t&#34; $exp_out &#34; &#34; exp_out

               set booVal 1
               if {$dFormat == &#34;L&#34;} {
                  regsub -all &#34;\r&#34; $exp_out &#34;&#34; displayList
                  set displayList [string trim $displayList &#34;\n&#34;]
                  set displayList [split $displayList &#34;\n&#34;]
               }
            }
         }
      }

      timeout {
         set rtnError &#34;Error::\(WifiSendACmd\) Timeout looking for return to CLI prompt.&#34;
         set booVal 0
         return $rtnError
      }
   }

<span class="comment-line">########################################</span>
<span class="comment-line"># if we get this far without having already returned an error, we</span>
<span class="comment-line"># can send back the display output.</span>
<span class="comment-line">########################################</span>

   if {$dFormat == &#34;L&#34;} {
      return $displayList
   } else {
      return $exp_out
   }
}

<span class="comment-line">######################################## </span>
<span class="comment-line"># Proc Name: WifiGetDUTName</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Desc: Get DUTx based on DUTx_CONNECT </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args   : IP address </span>
<span class="comment-line"># Output args  : DUTx</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#    [WifiGetDUTName $ip]</span>
<span class="comment-line">#</span>
<span class="comment-line">######################################## </span>

<strong><a name="::::WifiGetDUTName_1715">proc <a href="WifiLib.tcl-annot.html#::::WifiGetDUTName">::::WifiGetDUTName</a></a></strong><a name="::::WifiGetDUTName"></a> {<a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a>} {

   global DUT_CONNECT

   while { [info exists DUT_CONNECT] } {
      set connect [set DUT_CONNECT]
      if {$connect == $ip} { return &#34;DUT&#34;}

      global DUT_CONNECT
   }
   return &#34;UnknownDUT&#34;
}

<span class="comment-line">######################################## </span>
<span class="comment-line"># Proc Name: WifiGetVersion</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Desc: Get EW version on the DUT </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args   : DUTName </span>
<span class="comment-line">#              : level </span>
<span class="comment-line"># Output args  : return version</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#    WifiGetVersion &#34;DUT1&#34; 2</span>
<span class="comment-line">#</span>
<span class="comment-line">######################################## </span>

<strong><a name="::::WifiGetVersion_1742">proc <a href="WifiLib.tcl-annot.html#::::WifiGetVersion">::::WifiGetVersion</a></a></strong><a name="::::WifiGetVersion"></a> {{DUTName &#34;DUT&#34;} {level &#34;1&#34;} } {

   global DUTs_info

   if {$level == &#34;1&#34; } {
<span class="comment-line">######################################## </span>
<span class="comment-line"># return release and build number x.x.xbx</span>
<span class="comment-line">######################################## </span>
      return $DUTs_info($DUTName,VERSION)
   } elseif {$level == &#34;2&#34;} {
<span class="comment-line">######################################## </span>
<span class="comment-line"># return partly release number x.x</span>
<span class="comment-line">######################################## </span>
      set x $DUTs_info($DUTName,version)
      set ver 0;
      set match 0;
      set flg [regexp -nocase {^([0-9]+.[0-9a-z]+).[0-9].*} $x match ver]

      if {$flg} {
         return $ver
      } else {
         return $match
      }
   } elseif {$level == &#34;3&#34;} {

<span class="comment-line">######################################## </span>
<span class="comment-line"># return build number  </span>
<span class="comment-line">######################################## </span>
      set x $DUTs_info($DUTName,version)
      set match 0;
      set build 0;
      set flg [regexp -nocase {^[0-9]+.[0-9a-z]+.[0-9]+[a-z]+([0-9]*)} $x match build]

      if {$flg} {
         return $build
      } else {
         return $match
      }
   } elseif {$level == &#34;4&#34;} {
<span class="comment-line">######################################## </span>
<span class="comment-line"># return release number x.x.x</span>
<span class="comment-line">######################################## </span>
      set x $DUTs_info($DUTName,version)
      set ver 0;
      set match 0;
      set flg [regexp -nocase {^([0-9]+.[0-9a-z]+.[0-9]+)[a-z]+} $x match ver]

      if {$flg} {
         return $ver
      } else {
         return $match
      }
   }
   return $DUTs_info($DUTName,version)
}

<span class="comment-line">########################################</span>
<span class="comment-line"># WifiConsole</span>
<span class="comment-line">#</span>
<span class="comment-line"># This one simply logs in to a serial console port and</span>
<span class="comment-line"># returns a spawn-id</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#    rtnTst        - Success (1) or failure (0) of the proc.</span>
<span class="comment-line">#    prodType      - Hardware product type.</span>
<span class="comment-line">#    termSvrIp     - Terminal server IP Address.</span>
<span class="comment-line">#    termSvrPort   - Terminal server port connected to the console</span>
<span class="comment-line">#                    serial port.</span>
<span class="comment-line">#    loginName     - Login name</span>
<span class="comment-line">#    loginPassword - Login Password (defaults to &#34;null&#34;)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables:</span>
<span class="comment-line">#    none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#    If rtnTst = 1; succesful login..return session ID.</span>
<span class="comment-line">#    If rtnTst = 0; unsuccesful login...return error string. </span>
<span class="comment-line">#</span>
<span class="comment-line"># NOTE: This proc uses the &#34;rtnTst&#34; and &#34;prodType&#34;conventions.</span>
<span class="comment-line">#       Please see the README in this sub-directory for a full</span>
<span class="comment-line">#       explanation of how/why they are used. Default for</span>
<span class="comment-line">#       loginPassword if none provided is NULL.</span>
<span class="comment-line">########################################</span>
<span class="comment-line">#</span>
<strong><a name="::::WifiConsole_1826">proc <a href="WifiLib.tcl-annot.html#::::WifiConsole">::::WifiConsole</a></a></strong><a name="::::WifiConsole"></a> {rtnTst termSvrIp termSvrPort prodType loginName {loginPassword &#34;NULL&#34;}} {

   upvar $rtnTst booVal

   switch -exact -- $prodType {
      1 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      2 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      3 { set cliPrompt &#34;Summit300-24(.*)# $&#34; }
      4 { set cliPrompt &#34;Alpine3802(.*)# $&#34; }
      5 { set cliPrompt &#34;Summit24e3(.*)# $&#34; }
      default { set cliPrompt &#34;(.*)# $&#34; }
   }

   set alreadyLoggedIn 0

   spawn telnet
   after 1000

   send &#34;\r&#34;
   after 1000

   expect {
      &#34;telnet&gt; &#34; {}
      timeout {
         set booVal 0
         set rtnError &#34;Error\(WifiConsole\):: No telnet prompt.&#34;
         return $rtnError
      }
   }

   send &#34;open $termSvrIp $termSvrPort\r&#34;
   after 1000

   send &#34;\r&#34;
   after 1000
   send &#34;\r&#34;
   expect {
      -ex &#34;login: &#34; {}
      -re &#34;(.*)Connection refused(.*)&#34; {
         set rtnError &#34;Telnet connection was refused!!!\n&#34;
         append rtnError &#34;Terminal Server Port number invalid - or -\n&#34;
         append rtnError &#34;Another Session is using this port number.&#34;
         set booVal 0
         return $rtnError
      }
      -re &#34;(.*)Connection closed(.*)&#34; {
         set rtnError &#34;Telnet connection was refused!!!\n&#34;
         append rtnError &#34;Terminal Server Port number invalid - or -\n&#34;
         append rtnError &#34;Another Session is using this port number.&#34;
         set booVal 0
         return $rtnError
      }
      -re $cliPrompt {
         set alreadyLoggedIn 1
         puts &#34;WARNING: Previous console CLI session was not exited. Continuing..&#34;
      }
      timeout {
         set booVal 0
         set rtnError &#34;Error\(WifiConsole\):: Connection Timeout - No Login Prompt&#34;
         return $rtnError
      }
   }


   if {$alreadyLoggedIn == 0} {
      send &#34;$loginName\r&#34;
      after 1000

      expect {
         -ex &#34;password: &#34; {}
         timeout {
            set booVal 0
            set rtnError &#34;Error\(WifiConsole\):: Timed out looking for Password Prompt&#34;
            return $rtnError
         }
      }

      if {$loginPassword == &#34;NULL&#34;} {
         send &#34;\r&#34;
      } else {
         send &#34;$loginPassword\r&#34;
      }

      after 1000

      expect {
         -re $cliPrompt {}
         timeout {
            set booVal 0
            set rtnError &#34;Error\(WifiConsole\):: Timed out trying to get to initial CLI prompt.&#34;
            return $rtnError
         }
      }

      set cmd &#34;disable clipaging&#34;
      send &#34;$cmd\r&#34;
      expect $cmd
      expect {
         -re $cliPrompt {}
         timeout {
            set booVal 0
            set rtnError &#34;Error\(WifiConsole\):: Timed out trying disable paging.&#34;
            return $rtnError
         }
      }
   }

   set booVal 1
   return $spawn_id
}

<span class="comment-line">########################################</span>
<span class="comment-line"># WifiConsoleLogout</span>
<span class="comment-line">#</span>
<span class="comment-line"># This one simply logs out of a serial console port session.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#    rtnTst - Success (1) or failure (0) of the proc.</span>
<span class="comment-line">#    sessionId - spawn-id from the session we want to close.</span>
<span class="comment-line">#    prodType - Hardware product type.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables:</span>
<span class="comment-line">#    none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#    If rtnTst = 1; succesful logout.</span>
<span class="comment-line">#    If rtnTst = 0; unsuccesful logout. </span>
<span class="comment-line">#</span>
<span class="comment-line"># NOTE: This proc uses the &#34;rtnTst&#34; and &#34;prodType&#34;conventions.</span>
<span class="comment-line">#       Please see the README in this sub-directory for a full</span>
<span class="comment-line">#       explanation of how/why they are used.</span>
<span class="comment-line">########################################</span>
<span class="comment-line">#</span>
<strong><a name="::::WifiConsoleLogout_1959">proc <a href="WifiLib.tcl-annot.html#::::WifiConsoleLogout">::::WifiConsoleLogout</a></a></strong><a name="::::WifiConsoleLogout"></a> {rtnTst sessionId prodType} {

   upvar $rtnTst booVal

   set errPrefix &#34;Error \(WifiConsoleLogout\)::&#34;
   set err1 &#34;No Cli or Login prompt.&#34;
   set err2 &#34;Telnet process associated with console session may not have terminated.&#34;
   set err3 &#34;Console session to network device may still be active.&#34;

   switch -exact -- $prodType {
      1 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      2 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      3 { set cliPrompt &#34;Summit300-24(.*)# $&#34; }
      4 { set cliPrompt &#34;Alpine3802(.*)# $&#34; }
      5 { set cliPrompt &#34;Summit24e3(.*)# $&#34; }
      6 { set cliPrompt &#34;Summit400-24(.*)# $&#34; }
      default { set cliPrompt &#34;(.*)# $&#34; }
   }

   send -i $sessionId &#34;\r\r&#34;
   after 1000

   expect {
      -i $sessionId
      -re $cliPrompt {
         switch -exact -- $prodType {
            1 { send -i $sessionId &#34;exit\r&#34; }
            2 { send -i $sessionId &#34;exit\r&#34; }
            3 { send -i $sessionId &#34;exit\r&#34; }
            4 { send -i $sessionId &#34;exit\r&#34; }
            5 { send -i $sessionId &#34;exit\r&#34; }
            default { send -i $sessionId &#34;exit\r&#34; }
         }
      }
      timeout {
         set booVal 0
         set rtnError &#34;$errPrefix $err1&#34;
         close -i $sessionId
         return $rtnError
      }
   }

   expect {
      -i $sessionId
      -ex &#34;(y/n) &#34; {
         send -i $sessionId &#34;n\r&#34;
         expect {
            -i $sessionId
            -ex &#34;login: &#34; {
               send -i $sessionId &#34;\x1d&#34;
               expect {
                  -i $sessionId
                  -ex &#34;telnet&gt; &#34; {
                     send -i $sessionId &#34;quit\r&#34;
                     expect {
                        -i $sessionId
                        -re &#34;(\.*)nection close(\.*)&#34; {
                           set booVal 1
                           return
                        }
                        timeout {
                           close -i $sessionId
                           set booVal 0
                           set rtnError &#34;$errPrefix $err2&#34;
                           return $rtnError
                        }
                     }
                  }
                  timeout {
                     close -i $sessionId
                     set booVal 0
                     set rtnError &#34;$errPrefix $err2&#34;
                     return $rtnError
                  }
               }
            }
            timeout {
               close -i $sessionId
               set booVal 0
               set rtnError &#34;$errPrefix $err3&#34;
               return $rtnError
            }
         }
      }
      -ex &#34;login: &#34; {
         send -i $sessionId &#34;\x1d&#34;
         expect {
            -i $sessionId
            -ex &#34;telnet&gt; &#34; {
               send -i $sessionId &#34;quit\r&#34;
               expect {
                  -i $sessionId
                  -re &#34;(\.*)nection close(\.*)&#34; {
                     set booVal 1
                     return
                  }
                  timeout {
                     close -i $sessionId
                     set booVal 0
                     set rtnError &#34;$errPrefix $err2&#34;
                     return $rtnError
                  }
               }
            }
            timeout {
               close -i $sessionId
               set booVal 0
               set rtnError &#34;$errPrefix $err2&#34;
               return $rtnError
            }
         }
      }
      -ex &#34;telnet&gt; &#34; {
          send -i $sessionId &#34;quit\r&#34;
          expect {
             -i $sessionId
             -re &#34;(\.*)nection close(\.*)&#34; {
                set booVal 1
                return
             }
             timeout {
                close -i $sessionId
                set booVal 0
                set rtnError &#34;$errPrefix $err2&#34;
                return $rtnError
             }
          }
      }
      timeout {
         close -i $sessionId
         set booVal 0
         set rtnError &#34;$errPrefix $err2&#34;
         return $rtnError
      }
   }
   return
}

<span class="comment-line">########################################</span>
<span class="comment-line"># Proc Name: WifiTelnet</span>
<span class="comment-line">#</span>
<span class="comment-line"># This one simply logs in to an in-band telnet port and</span>
<span class="comment-line"># returns a spawn-id</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#    rtnTst - Success (1) or failure (0) of the proc.</span>
<span class="comment-line">#    switchIp - IP Address of the switch we're telnetting into.</span>
<span class="comment-line">#    prodType - Hardware product type.</span>
<span class="comment-line">#    loginName - Login name</span>
<span class="comment-line">#    loginPassword -  Login Password (defaults to &#34;null&#34;)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables:</span>
<span class="comment-line">#    none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#    If rtnTst = 1; succesful login..return session ID.</span>
<span class="comment-line">#    If rtnTst = 0; unsuccesful login...return error string.</span>
<span class="comment-line">#</span>
<span class="comment-line"># NOTE: This proc uses the &#34;rtnTst&#34; and &#34;prodType&#34;conventions.</span>
<span class="comment-line">#       Please see the README in this sub-directory for a full</span>
<span class="comment-line">#       explanation of how/why they are used.</span>
<span class="comment-line">#       Default for loginPassword if none provided is NULL.</span>
<span class="comment-line">########################################</span>
<span class="comment-line">#</span>
<strong><a name="::::WifiTelnet_2123">proc <a href="WifiLib.tcl-annot.html#::::WifiTelnet">::::WifiTelnet</a></a></strong><a name="::::WifiTelnet"></a> {rtnTst switchIp prodType loginName {loginPassword &#34;NULL&#34;}} {

   upvar $rtnTst booVal

   switch -exact -- $prodType {
      1 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      2 { set cliPrompt &#34;Summit300-48(.*)# $&#34; }
      3 { set cliPrompt &#34;Summit300-24(.*)# $&#34; }
      4 { set cliPrompt &#34;Alpine3802(.*)# $&#34; }
      5 { set cliPrompt &#34;Summit24e3(.*)# $&#34; }
      6 { set cliPrompt &#34;Summit400-24(.*)# $&#34; }
      default { set cliPrompt &#34;(.*)# $&#34; }
   }

   spawn telnet $switchIp
   after 1000

   send &#34;\r&#34;
   after 1000

   expect {
      -ex &#34;login: &#34; {}
      -ex &#34;Connection refused&#34; {
         set rtnError &#34;Error\(WifiTelnet\):: Telnet Connection Refused.&#34;
         set booVal 0
         return $rtnError
      }
      -ex &#34;no available pty&#34; {
         set rtnError &#34;Error\(WifiTelnet\):: Telnet Connection Refused.\n&#34;
         append rtnError &#34;Telnet pty's \(8\) max'd out on this switch!!!&#34;
         set booVal 0
         return $rtnError
      }
      timeout {
         set booVal 0
         set rtnError &#34;Error\(WifiTelnet\):: Connection Timeout - No Login Prompt&#34;
         return $rtnError
      }
   }

   send &#34;$loginName\r&#34;
   after 1000

   expect {
      -ex &#34;password: &#34; {}
      timeout {
         set booVal 0
         set rtnError &#34;Error\(WifiTelnet\):: Timed out looking for Password Prompt&#34;
         return $rtnError
      }
   }

   if {$loginPassword == &#34;NULL&#34;} {
      send &#34;\r&#34;
   } else {
      send &#34;$loginPassword\r&#34;
   }

   after 1000

   expect {
      -re $cliPrompt {}
      timeout {
         set booVal 0
         set rtnError &#34;Error\(WifiTelnet\):: Timed out trying to get to CLI prompt.&#34;
         return $rtnError
      }
   }

   set cmd &#34;disable clipaging&#34;
   send &#34;$cmd\r&#34;
   expect $cmd
   expect {
      -re $cliPrompt {}
      timeout {
         set booVal 0
         set rtnError &#34;Error\(WifiConsole\):: Timed out trying disable paging.&#34;
         return $rtnError
      }
   }

   set booVal 1
   return $spawn_id
}

<span class="comment-line">################################################################</span>
<span class="comment-line"># AnalyzeErrors</span>
<span class="comment-line"># </span>
<span class="comment-line"># Scan a log file for reported errors, parsing for the string:</span>
<span class="comment-line">#    &#34;Error::&#34; followed by any text.</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#    logFile - log file to search</span>
<span class="comment-line">#    resultsFile - file to write the Pass/Fail result to.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables:</span>
<span class="comment-line">#    none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#    none</span>
<span class="comment-line">################################################################</span>
<span class="comment-line">#</span>
<strong><a name="::::AnalyzeErrors_2225">proc <a href="WifiLib.tcl-annot.html#::::AnalyzeErrors">::::AnalyzeErrors</a></a></strong><a name="::::AnalyzeErrors"></a> {logFile resultsFile} {
   set errorFound 0
   set fileHandle [open $logFile r]
   set fileContents [split [read $fileHandle] \n]

   close $fileHandle

   foreach fileLine $fileContents {
       puts $fileLine

       if {[regexp &#34;(.*)Error::(.*)&#34; $fileLine]} {
          set errorFound 1
       }
   }

   if {$errorFound} {
      <a name="::::LogIt(1)"><a href="./WifiLib.tcl.html#::::LogIt_2264">::::LogIt</a></a> $resultsFile &#34;Fail&#34;
   } else {
      <a name="::::LogIt(2)"><a href="./WifiLib.tcl.html#::::LogIt_2264">::::LogIt</a></a> $resultsFile &#34;Pass&#34;
   }
}

<span class="comment-line">################################################################</span>
<span class="comment-line"># LogIt</span>
<span class="comment-line"># </span>
<span class="comment-line"># Write an entry into the log file with a timestamp at the</span>
<span class="comment-line"># beginning of the line.</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#     logFile - name of the log file to write to</span>
<span class="comment-line">#     output - string to write to the log</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables:</span>
<span class="comment-line">#     none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#     none</span>
<span class="comment-line">################################################################</span>
<span class="comment-line">#</span>
<strong><a name="::::LogIt_2264">proc <a href="WifiLib.tcl-annot.html#::::LogIt">::::LogIt</a></a></strong><a name="::::LogIt"></a> { logFile output } {
    set logDate [clock format [clock seconds] -format %m/%d/%y]
    set logTime [clock format [clock seconds] -format %H:%M:%S]
    set fileHandle [open $logFile a]
    puts $fileHandle &#34;$logDate $logTime $output&#34;
    close $fileHandle
}

<span class="comment-line">################################################################</span>
<span class="comment-line"># Dump</span>
<span class="comment-line"># </span>
<span class="comment-line"># Write an entry into the log file without a timestamp at the</span>
<span class="comment-line"># beginning of the line.</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Input Variables:</span>
<span class="comment-line">#     logFile - name of the log file to write to</span>
<span class="comment-line">#     output - string to write to the log</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output Variables:</span>
<span class="comment-line">#     none</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#     none</span>
<span class="comment-line">################################################################</span>
<span class="comment-line">#</span>
<strong><a name="::::Dump_2289">proc <a href="WifiLib.tcl-annot.html#::::Dump">::::Dump</a></a></strong><a name="::::Dump"></a> { logFile output } {
    set fileHandle [open $logFile a]
    puts $fileHandle $output
    close $fileHandle
}

<span class="comment-line">########################################</span>
<span class="comment-line"># Proc Name: DoLinuxPing</span>
<span class="comment-line"># </span>
<span class="comment-line"># Desc: Ping to a destination address from a Linux command line for</span>
<span class="comment-line"># a specific number of pings. Capture the percent loss and return</span>
<span class="comment-line"># it to calling script. The assumption with this proc is that we</span>
<span class="comment-line"># are running this proc and our tcl session from the system that</span>
<span class="comment-line"># we want to ping from. As a result, there is no spawn-id to</span>
<span class="comment-line"># worry about. The proc just does an &#34;exec&#34; from our tcl session.</span>
<span class="comment-line"># However, we did add the rtnTst and return value convention.</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Input Args   : ipAddress - IP Address of destination</span>
<span class="comment-line">#              : pingCount - Number of times to ping (default = 5)</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value:</span>
<span class="comment-line">#    Percent loss for entire ping count.</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Typical Usage:</span>
<span class="comment-line">#    set pingLoss [DoLinuxPing 10.10.10.10 100]</span>
<span class="comment-line">#</span>
<span class="comment-line">########################################</span>
<strong><a name="::::DoLinuxPing_2316">proc <a href="WifiLib.tcl-annot.html#::::DoLinuxPing">::::DoLinuxPing</a></a></strong><a name="::::DoLinuxPing"></a> {rtnTst ipAddress {pingCount &#34;5&#34;}} {

   upvar $rtnTst booVal

   puts &#34;\n================&#34;
   puts &#34;Ping $ipAddress $pingCount times from Linux host&#34;
   puts &#34;================&#34;

   catch {exec ping -c $pingCount $ipAddress} resultOut

   set pingOutList [split $resultOut &#34;\n&#34;]

   foreach pingLine $pingOutList {
      puts $pingLine

      if {[string match &#34;*errors,*&#34; $pingLine]} {
         set booVal 0
         set rtnErr &#34;Problem encountered doing the pings!\n$pingOutList&#34;
         return $rtnErr
      } else {
         if {[string match &#34;*received, *&#34; $pingLine]} {
            set pIndex1 [expr [string first &#34;received, &#34; $pingLine] + 10]
            set pIndex2 [expr [string first &#34;%&#34; $pingLine] -1]

            if {($pIndex1 != -1) &amp;&amp; ($pIndex2 != -1)} {
               set pingLoss [string range $pingLine $pIndex1 $pIndex2]
               set booVal 1
               puts &#34;From doPings proc, Ping Loss = $pingLoss&#34;
               return $pingLoss
            } else {
               set booVal 0
               set rtnErr &#34;Problem encountered doing the pings!&#34;
               return $rtnErr
            }
         }
      }
   }
<span class="comment-line">########################################</span>
<span class="comment-line"># If we don't return with a ping loss percent number, the percent</span>
<span class="comment-line"># fail/success never showed up....probably a catastrophic error of</span>
<span class="comment-line"># some sort. Return FAIL to the calling proc. We can't return a 0</span>
<span class="comment-line"># or 1 because that may be the actual ping loss percentage.</span>
<span class="comment-line">########################################</span>
   set booVal 0
   set rtnErr &#34;Problem encountered doing the pings!&#34;
   return $rtnErr
}

<span class="comment-line">########################################</span>
<span class="comment-line"># Proc Name: DoSwitchPing</span>
<span class="comment-line"># </span>
<span class="comment-line"># Desc: Ping to a destination address from a switch command line.</span>
<span class="comment-line"># Capture the percent loss and return it to calling script.</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Input Args    : rtnTst - return success/fail for the proc </span>
<span class="comment-line">#               : sessionId - spawn-id for this terminal session</span>
<span class="comment-line">#               : prodType - product type number for the switch</span>
<span class="comment-line">#               : ipAddress - IP Address of destination</span>
<span class="comment-line">#</span>
<span class="comment-line"># Return Value  : Percent loss for entire ping count.</span>
<span class="comment-line">#     </span>
<span class="comment-line"># Typical Usage:</span>
<span class="comment-line">#    set pingLoss [DoSwitchPing rtnTst $sessionId $prodType 10.10.10.10]</span>
<span class="comment-line">#</span>
<span class="comment-line">########################################</span>
<strong><a name="::::DoSwitchPing_2381">proc <a href="WifiLib.tcl-annot.html#::::DoSwitchPing">::::DoSwitchPing</a></a></strong><a name="::::DoSwitchPing"></a> {rtnTst sessionId prodType ipAddress} {

   upvar $rtnTst booVal

   puts &#34;\n======================&#34;
   puts &#34;Ping AP from the switch.&#34;
   puts &#34;======================&#34;

   set pingOutList [<a name="::::WifiSendACmd(7)"><a href="./WifiLib.tcl.html#::::WifiSendACmd_1564">::::WifiSendACmd</a></a> rtnTst $sessionId $prodType &#34;ping $ipAddress&#34; &#34;L&#34;]

   foreach pingLine $pingOutList {
      puts &#34;Ping Line = $pingLine&#34;

      if {[string match &#34;*received, *&#34; $pingLine]} {
         puts &#34;Found ping loss percentage line.&#34;
         set pIndex1 [expr [string last &#34;, &#34; $pingLine] + 2]
         puts &#34;pIndex1 value = $pIndex1&#34;
         set pIndex2 [expr [string first &#34;%&#34; $pingLine] -1]
         puts &#34;pIndex2 value = $pIndex2&#34;

         if {($pIndex1 != -1) &amp;&amp; ($pIndex2 != -1)} {
            set pingLoss [string range $pingLine $pIndex1 $pIndex2]
            puts &#34;Ping Loss value = $pingLoss&#34;
            set booVal 1
            return $pingLoss
         } else {
            set rtnErr &#34;Error:: \(DoSwitchPing\) Abnormal ping failure!\n$pingOutList&#34;
            set booVal 0
            return $rtnErr
         }
      }
   }

<span class="comment-line">########################################</span>
<span class="comment-line"># See comment at this position for proc &#34;DoLinuxPing&#34;</span>
<span class="comment-line">########################################</span>
   set rtnErr &#34;Error:: \(DoSwitchPing\) Abnormal ping failure!\n$pingOutList&#34;
   set booVal 0
   return $rtnErr
}

<strong><a name="::::Wifi_PingTheClient_2422">proc <a href="WifiLib.tcl-annot.html#::::Wifi_PingTheClient">::::Wifi_PingTheClient</a></a></strong><a name="::::Wifi_PingTheClient"></a> {clientIp {testComment &#34;&#34;} {retry 4} {retryTime 20}\
	{lossThreshold 50} {numPingPackets 10} } {
    
    set status &#34;error&#34;

    <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Check ping to client $clientIp: $testComment&#34;

    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; - Pinging Client $clientIp from Linux Host $numPingPackets times&#34;
 
    set i 0
    while {$i &lt; $retry} {

	set pingLoss [<a name="::::DoLinuxPing(1)"><a href="./WifiLib.tcl.html#::::DoLinuxPing_2316">::::DoLinuxPing</a></a> rtnTst $clientIp $numPingPackets]
	if { ($rtnTst) &amp;&amp; ($pingLoss &lt;= $lossThreshold) } {
	    <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34; - Ping Loss from Linux Test Host to Client = $pingLoss percent.&#34;
	    set status &#34;ok&#34;
	    break;
	} else {
	    <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;Client Ping check $i of $retry failed.&#34; 
	    incr i 1
	    <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $retryTime
	    continue
	}
    }
  

    if {$status == &#34;error&#34; } {
	if {!$rtnTst} {
	    <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error:  $pingLoss&#34;
	} elseif {$pingLoss &gt; $lossThreshold} {
	    <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error: Connectivity issue to Client. Ping Loss = $pingLoss percent.&#34;
	} else {
	    <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Error: Unknown error&#34;
	}
    }

    <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
    
    return $status
}


;<span class="comment-line"># Description: Telnet to Odyssey Client and position cursor</span>
<strong><a name="::::Wifi_PositionOdysseyClient_2465">proc <a href="WifiLib.tcl-annot.html#::::Wifi_PositionOdysseyClient">::::Wifi_PositionOdysseyClient</a></a></strong><a name="::::Wifi_PositionOdysseyClient"></a> { ipaddr port up_down numPosition {retry 0}} {

    <span class="comment-line">########################################</span>
    <span class="comment-line"># 1. Position the Odyssey client network assignment to the top of</span>
    <span class="comment-line">#    the list of networks.</span>
    <span class="comment-line"># 2. Telnet to the socket opened by the perl script on the wired</span>
    <span class="comment-line">#    side of the client and assign the spawn_id to &#34;sessionId3&#34;</span>
    <span class="comment-line">########################################</span>

    if {$numPosition == 0} {
	<a name="::result_warning(2)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;Wifi_PositionOdysseyClient $ipaddr $port $up_down $numPosition **********&#34;
	<a name="::result_warning(3)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;numPosition == 0&#34;
    }

    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Position the Odyssey Client to the Top of the Network List.&#34;

    spawn telnet
    after 2000
    
    send &#34;\r&#34;
    expect { 
	&#34;telnet&gt; &#34; {
	    <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; - Found telnet prompt.&#34;
	}
	timeout {
	    <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error:: Trying to set connection to wired side&#34;
	    <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;        of client. No telnet prompt.&#34;
	    <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- End Time&#34;
	    return 0
	}
    }

    set telnetCmd &#34;open $ipaddr $port&#34;
    send &#34;$telnetCmd\r&#34;
    expect {
	-ex $telnetCmd {}
	timeout {
	    <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Can't find echo of the telnet open command.&#34;
	    return 0
	}
    }

    expect {
	-re &#34;Escape(.*)&#34; {
	    set sessionId3 $spawn_id
	    <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; - Got session Id for the wired side of the wireless client.&#34;
	}
	timeout {
	    <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Can't telnet into the wired side of the client.&#34; 
	    if {$retry == 1} {
		<a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Exiting script.&#34;
		return 0
	    }
	}
    }
    after 2000
    
    send -i $sessionId3 &#34;\r&#34;
    expect &#34;*&#34; {}

    after 1000

    <span class="comment-line">########################################</span>
    <span class="comment-line"># loop to make sure we get all the way back to the beginning of the</span>
    <span class="comment-line"># list of networks that are in the Odyssey client.</span>
    <span class="comment-line">########################################</span>
    global _odysseyClientOffsetList
    
    ;<span class="comment-line"># Pad by 5 to make sure we're at the top</span>
    set listSize [expr [llength $_odysseyClientOffsetList] + 5]

<span class="comment-line">#    send -i $sessionId3 &#34;top $listSize\r&#34;</span>
<span class="comment-line">#    expect &#34;*&#34; {}</span>
<span class="comment-line">#    result_debug &#34;Move up - $listSize Positions&#34;</span>
<span class="comment-line">#    result_debug &#34;Should be at top of network list&#34;</span>

    ;<span class="comment-line"># This sleep is absolutely necessary.  We need to make sure the TOP command</span>
    ;<span class="comment-line"># completes before executing the next command.  We sleep at least 3 seconds</span>
    ;<span class="comment-line"># then add 1 second for every 5 positions</span>
<span class="comment-line">#    set sleepTime [expr ($numPosition / 5) + 3] </span>
<span class="comment-line">##    result_debug &#34;Sleep $sleepTime seconds before moving $up_down $numPosition positions&#34;</span>
<span class="comment-line">#    exSleep $sleepTime</span>

<span class="comment-line">#    for {set i 0} {$i &lt; 32} {incr i} {</span>
<span class="comment-line">#	send -i $sessionId3 &#34;up\r&#34;</span>
<span class="comment-line">#	expect &#34;*&#34; {}</span>
<span class="comment-line">#	result_debug &#34;Move net id up - loop counter id = $i&#34;</span>
<span class="comment-line">#	after 1000</span>
<span class="comment-line">#    }</span>
    
    <span class="comment-line">########################################</span>
    <span class="comment-line"># The general flow from here is as follows:</span>
    <span class="comment-line"># 1. Move the client network name to the next value we want to</span>
    <span class="comment-line">#    verify</span>
    <span class="comment-line"># 2. Disable interface not being used for the specific pass</span>
    <span class="comment-line"># 3. Configure the interface being used and enable it.</span>
    <span class="comment-line">#    Enable the wireless port (we only need to do this on the</span>
    <span class="comment-line">#    the first profile verification.)</span>
    <span class="comment-line"># 4. Verify port and interface are up.</span>
    <span class="comment-line"># 5. Verify connectivity from this linux host to client ip.</span>
    <span class="comment-line"># 6. Disable interface.</span>
    <span class="comment-line"># 8. Repeat</span>
    <span class="comment-line">########################################</span>
    <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; - Moving Down $numPosition Positions to Desired Network on Client.&#34;
    
    if {$up_down == &#34;up&#34;} {
       send -i $sessionId3 &#34;top $numPosition\r&#34;
    } else {
       send -i $sessionId3 &#34;bottom $numPosition $listSize\r&#34;
    }
    expect &#34;*&#34; {}

    set sleepTime [expr ($numPosition / 5) + 3] 
    <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleep $sleepTime seconds before moving $up_down $numPosition positions&#34;
    <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $sleepTime

<span class="comment-line">#    for {set i 1} {$i &lt; [expr $numPosition + 1]} {incr i} {</span>
<span class="comment-line">#	send -i $sessionId3 &#34;$up_down\r&#34;</span>
<span class="comment-line">#	expect &#34;*&#34; {}</span>
<span class="comment-line">#	result_debug &#34;Move net id down - loop counter id = $i&#34;</span>
<span class="comment-line">#	after 1000</span>
<span class="comment-line">#    }</span>

    send -i $sessionId3 &#34;quit\r&#34;
    close; wait
    after 2000

    return 1
}

<span class="comment-line"># DESCRIPTION: Wait for a particular wireless port state</span>
<strong><a name="::::Wifi_WaitPortState_2596">proc <a href="WifiLib.tcl-annot.html#::::Wifi_WaitPortState">::::Wifi_WaitPortState</a></a></strong><a name="::::Wifi_WaitPortState"></a> { wiPort {state &#34;ON&#34;} {msg &#34;Waiting for port&#34;} \
	{start 20} {interval 10} {duration 110} {timeout 300} } {

    set rc &#34;ok&#34;

    <span class="comment-line">## Sample Output</span>
    <span class="comment-line">#</span>
    <span class="comment-line"># * Summit300-48:44 # sh wireless ports 1:24</span>
    <span class="comment-line"># Port  HW Version MAC Addr          Serial #   State Last Change              </span>
    <span class="comment-line"># --------------------------------------------------------------------------------</span>
    <span class="comment-line">#  1:24 01000001   00:30:F1:92:44:39 A324049232 ON    Thu Nov 11 01:26:43 2004</span>
    <span class="comment-line"># </span>
    <span class="comment-line"># </span>
    <span class="comment-line"># State: DIS - Disabled, EN - Enabled, RST - Reset, ADDR - Addressing,</span>
    <span class="comment-line">#        REG - Register, SYNC - Syncing, ON - Online, ERR - Error</span>

    set timeParam &#34;s: $start i: $interval d: $duration f: $timeout&#34;
    set parameterList &#34;&#34;
    lappend parameterList &#34;{$wiPort .* $state} exist&#34;
    set rc [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;sh wirel po $wiPort&#34; $parameterList \
	    -time $timeParam \
	    -comment &#34;$msg&#34;]

    if {$rc != &#34;ok&#34; } {
	<a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;AP Failed to Come Up. Dumping log info...&#34;
	<a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log&#34;
	<a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log&#34;
    }

    return $rc
}

<strong><a name="::::Wifi_PingAPfromSwitch_2628">proc <a href="WifiLib.tcl-annot.html#::::Wifi_PingAPfromSwitch">::::Wifi_PingAPfromSwitch</a></a></strong><a name="::::Wifi_PingAPfromSwitch"></a> {wiPortIp prodType sessionId} {

    set rc &#34;ok&#34;

    set val [<a name="::CheckCLIPing(1)"><a href="./ping.tcl.html#::CheckCLIPing_178">::CheckCLIPing</a></a> &#34;ping $wiPortIp&#34; &#34;pingable&#34; &#34;Ping AP @ $wiPortIp from DUT&#34;]

    if {$val == 0} {
	set rc &#34;error&#34;
    }
    return $rc
}

<strong><a name="::::Wifi_GetOdysseyClientOffset_2640">proc <a href="WifiLib.tcl-annot.html#::::Wifi_GetOdysseyClientOffset">::::Wifi_GetOdysseyClientOffset</a></a></strong><a name="::::Wifi_GetOdysseyClientOffset"></a> { essName } {

    global _odysseyClientOffsetList

    set val [lsearch $_odysseyClientOffsetList $essName]

    puts &#34;Got $val for $essName&#34;
    if {$val == -1} {
	<a name="::result_warning(4)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;$essName not found in  odysseyClientOffsetList&#34;
	<a name="::result_warning(5)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;$_odysseyClientOffsetList&#34;
	set val 0
    }

    return $val
}

<strong><a name="::::Wifi_GetPortChannel_2656">proc <a href="WifiLib.tcl-annot.html#::::Wifi_GetPortChannel">::::Wifi_GetPortChannel</a></a></strong><a name="::::Wifi_GetPortChannel"></a> { <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> {interface 1}} {

    set channel 0

    <span class="comment-line"># * Summit300-48:39 # show wireless port 1:24 interface 1 status</span>
    <span class="comment-line"># Intf    St. Tx Rate Tx Power         Ch  ESS                Max Cl. Last State Change        </span>
    <span class="comment-line"># ------------------------------------------------------------------------------------------</span>
    <span class="comment-line"># 1:24:1 EN  54      FULL     (17 dBm) 48  DEFAULT_ESS        100     Sat Jan 8 02:46:40 2005</span>
    
    set apIfStatusDisplay [<a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show wireless port $port interface $interface status&#34;] 

    regexp &#34;.*dBm\\)\ *(\[0-9]+)\ *&#34; $apIfStatusDisplay ignore channel		    

    if {! [string is integer $channel] } {
	<a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;WARNING: Parsed invalid scan channel $channel&#34;
	set channel 0
    }

    return $channel
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
