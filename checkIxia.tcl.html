<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>checkIxia.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#checkIxia.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>checkIxia.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="checkIxia.tcl-annot.html">annotations</a> | <a href="checkIxia.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::CheckIxia_2">proc <a href="checkIxia.tcl-annot.html#::::CheckIxia">::::CheckIxia</a></a></strong> {} {

<span class="comment-line"># ----- Environment variables setup</span>
global DUTPortMappingArray
global portMappingList
global GetDUTPortMapping
global ixiaPortMappingArray
global initFile

source $initFile

   set TxRxPortList {}
   set stat 0
   set retFlag1 0
   <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;portMappingList is $portMappingList&#34;
   
   foreach port $portMappingList {
   set ixiaPort  [lindex $port 1]
   if {[regexp -nocase &#34;A|KEY&#34; $ixiaPort]} {
   incr stat
     }
   }
     if {$stat == 0} {
     foreach port $portMappingList {
     <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;port is $port&#34;
     set IxiaPortId [lindex $port 0]
     set DutPortId [lindex $port 1]
     set DUT [lindex $port 2] 
	<a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;IxiaPortId-$IxiaPortId, DutPortId-$DutPortId, DUT-$DUT&#34;
	set DUTName DUT$DUT
	set retD [<a name="::DisableLink_DutIxia(1)"><a href="./checkIxia.tcl.html#::DisableLink_DutIxia_104">::DisableLink_DutIxia</a></a> [<a name="::MapDUTPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $IxiaPortId $DUT] DUT$DUT]
        
	set maxWait 7
	<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $IxiaPortId chasis card port
	set maxWaitCounter $maxWait
        while { $maxWaitCounter } {
            <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chasis $card $port
	    set ab [<a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -linkState]
            if {[<a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -linkState] == 0} {
		<a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;FOUND LINK DOWN for IxiaPortId:$IxiaPortId! after $maxWaitCounter secs&#34;
                incr retFlag1
                break
            } else {
                <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Waitng for IxiaPortId:$IxiaPortId linkUp after $maxWaitCounter secs&#34;
                incr maxWaitCounter -1
		sleep 1
            }
        }

	set retE [<a name="::EnableLink_DutIxia(1)"><a href="./checkIxia.tcl.html#::EnableLink_DutIxia_81">::EnableLink_DutIxia</a></a> [<a name="::MapDUTPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapDUTPortId_120">::MapDUTPortId</a></a> $IxiaPortId $DUT] DUT$DUT]

	set maxWaitCounter $maxWait
        while { $maxWaitCounter } {
            <a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chasis $card $port
           if {[<a name="::port(5)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -linkState] == 1} {
                <a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;FOUND LINK UP for IxiaPortId:$IxiaPortId! after $maxWaitCounter secs&#34;
                incr retFlag1
                break
            } else {
                <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Waiting for IxiaPortId:$IxiaPortId linkUp after $maxWaitCounter secs&#34;
                incr maxWaitCounter -1
		sleep 1

            }
        }

    }   
}
set numPort [llength $portMappingList]
<a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numPort is $numPort and retFlag1 is $retFlag1&#34;
 	if {$retFlag1 == [expr $numPort*2]} {
        <a name="::IxiaPortsInit(1)"><a href="./ePTTx.tcl.html#::IxiaPortsInit_331">::IxiaPortsInit</a></a>
	return &#34;connectionOkay&#34;
        } else {
	return &#34;connectionBad&#34;
	}

}

<strong><a name="::::EnableLink_DutIxia_81">proc <a href="checkIxia.tcl-annot.html#::::EnableLink_DutIxia">::::EnableLink_DutIxia</a></a></strong> {portIdList DUTName} {
   global ${DUTName}_CONNECT;
   global DUTs_info;

   global spawn_id
   set pid _[pid]
   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];
   set result 1
   foreach portId $portIdList {
       set fd_in [open &#34;Tmp/tmp_EnableLink$pid&#34; &#34;w&#34;]
       <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable port $portId&#34; NULL $fd_in
       close $fd_in
       set fd_in [open &#34;Tmp/tmp_EnableLink$pid&#34; &#34;r&#34;]
       set rtValue [<a name="::check_illegality(1)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
       close $fd_in
       if { $rtValue == &#34;illegal&#34; } {
          set result 0
       }
       sleep 1
   }
   return $result
}

<strong><a name="::::DisableLink_DutIxia_104">proc <a href="checkIxia.tcl-annot.html#::::DisableLink_DutIxia">::::DisableLink_DutIxia</a></a></strong> {portIdList DUTName} {
   global ${DUTName}_CONNECT;
   global DUTs_info;

   global spawn_id
   set pid _[pid]
   <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];
   set result 1
   foreach portId $portIdList {
       set fd_in [open &#34;Tmp/tmp_DisableLink$pid&#34; &#34;w&#34;]
       <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable port $portId&#34; NULL $fd_in
       close $fd_in
       set fd_in [open &#34;Tmp/tmp_DisableLink$pid&#34; &#34;r&#34;]
       set rtValue [<a name="::check_illegality(2)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
       close $fd_in
       if { $rtValue == &#34;illegal&#34; } {
          set result 0
       }
       sleep 1
   }
   return $result
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
