<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>vt_multi.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#vt_multi.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>vt_multi.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="vt_multi.tcl-annot.html">annotations</a> | <a href="vt_multi.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>
<span class="comment-line">############################### MAIN #################################</span>
source /auto/automation/Util/runReg.cfg
source /auto/automation/Lib/mysqlLib.tcl
global curAutoRoot
global DUTs_info

source ../Lib/mainLib.tcl
package require Tclx

load [lindex [glob &#34;/usr/lib/libexpect*so*&#34;] 0]

set curLocation [pwd]
set curDirList [split [string trim [string trim $curLocation &#34;..&#34;] &#34;/&#34;] &#34;/&#34;]
set v 0;
set pathList &#34;&#34;
set curAutoRoot &#34;&#34;
set skipCC 0
foreach cd $curDirList {
    if {$cd == &#34;main&#34; || $cd == &#34;Lib&#34; || $cd == &#34;Util&#34;} {
        for {set x 0} {$x&lt;$v} {incr x} {
            lappend pathList [lindex $curDirList $x]
        }
        set curAutoRoot &#34;/[join $pathList &#34;/&#34;]&#34;
    } else {
        incr v;
    }
}
puts &#34;CURRENT PATH: $curAutoRoot&#34;
set cDir [file tail [pwd]]
set LIB_PATH &#34;./../Lib&#34;
lappend auto_path $LIB_PATH
puts &#34;DEBUG: Appending $LIB_PATH to autopath:$auto_path&#34;

<a name="::::gen_index(1)"><a href="./summarize.tcl.html#::::gen_index_76">::::gen_index</a></a> &#34;./../Lib&#34;
source ./regtoolsLib.tcl

<strong><a name="::::print_usage_38">proc <a href="vt_multi.tcl-annot.html#::::print_usage">::::print_usage</a></a></strong><a name="::::print_usage"></a> {} {
    puts &#34;\r&#34;
    puts {Usage: vt_multi.tcl}
    puts &#34;\r&#34;
}

<span class="comment-line"># checking command parameters</span>
set incfgs &#34;&#34;
if {$argc==1} {
    puts &#34;We got $argv&#34;
    set incfgs $argv
}

fconfigure stdin -blocking 1
while {1} {
    puts &#34;\n\n&#34;;
    set choice &#34;21.1.0.31&#34;
    puts -nonewline &#34;What build do you want to verify against\[$choice\]: &#34;;
    flush stdout;
    gets stdin userChoice;
    if {$userChoice==&#34;&#34;} {
       set userChoice $choice
    }
    if {[regexp -nocase -all &#34;\[0-9]{2,2}\.\[0-9]{1,1}\.\[0-9]{1,1}\.\[0-9]+&#34; $userChoice]} {
       set build $userChoice
       break;
    } else {
       puts &#34;Error: Build is in the wrong format.  Should be ##.#.#.##&#34;;
       continue;
    }
}
while {1} {
    puts &#34;&#34;;
    set choice &#34;secondary&#34;
    puts -nonewline &#34;What bank should be booted with the image? \[$choice\]: &#34;;
    flush stdout;
    gets stdin userChoice;
    if {$userChoice==&#34;&#34;} {
       set userChoice $choice
    }
    if {[regexp -nocase -all &#34;pri&#34; $userChoice] || [regexp -nocase -all &#34;sec&#34; $userChoice] } {
       set target $userChoice
       break;
    } else {
       puts &#34;Error: Should be primary or secondary&#34;;
       continue;
    }
}
while {1} {
    set choice n
    puts -nonewline &#34;Will you need a reboot to get to the version to check (y/n)\[$choice\]: &#34;;
    flush stdout;
    gets stdin userChoice;
    if {$userChoice==&#34;&#34;} {
       set userChoice $choice
    }
    if {[regexp -nocase &#34;y&#34; $userChoice] || [regexp -nocase &#34;n&#34; $userChoice]} {
        if {[regexp -nocase &#34;y&#34; $userChoice]} {
            set bank $target
        } else {
            set bank null
        }
       puts &#34;&#34;
       break;
    } else {
       puts &#34;Error: Config selection must be either y or n&#34;
       continue
    }
}
set chInts &#34;1 2&#34;
if {[regexp -nocase &#34;rdureg|salemreg&#34; $HOST]} {
    set mList {&#34;RDUREG/SALEMREG&#34; &#34;RDU Automation&#34;}
} elseif {[regexp -nocase &#34;autoregrdu&#34; $HOST]} {
    set mList {&#34;RDU Automation&#34; &#34;RDUREG/SALEMREG&#34;}
} else {
    set mList {&#34;RDU Automation&#34; &#34;RDUREG/SALEMREG&#34;}
}
set site [<a name="::NumberedMenu(1)"><a href="./menu.tcl.html#::NumberedMenu_2">::NumberedMenu</a></a> -head &#34;Server Run Type&#34; \
            -question1 &#34;Select the Server you are on&#34; \
            -choices $mList \
            -menuWidth        75 \
            -keyWidth         3 \
            -headerPadChar    &#34;=&#34; \
            -chAppendList     &#34;null&#34; \
            -chPrependList    &#34;null&#34; \
            -barChar          &#34;-&#34; \
            -clearXterm       &#34;yes&#34; \
            -simple   &#34;yes&#34; ]

if {$site == &#34;RDUREG/SALEMREG&#34;} {
    set server &#34;swdev&#34;
} else {
    set server &#34;production&#34;
}

if {$server == &#34;swdev&#34;} {
    set cfgList [<a name="::getlocked(1)"><a href="./regtoolsLib.tcl.html#::getlocked_469">::getlocked</a></a>]
    set cfgList [concat $cfgList [<a name="::getUserLocks(1)"><a href="./regtoolsLib.tcl.html#::getUserLocks_484">::getUserLocks</a></a>]]
    <span class="comment-line">#puts &#34;Locked List $lockedList&#34;</span>
    set cfgList [<a name="::swsharedbeds(1)"><a href="./regtoolsLib.tcl.html#::swsharedbeds_300">::swsharedbeds</a></a> $cfgList]
    <span class="comment-line">#puts &#34;$server Locked List $cfgList&#34;</span>
    set cfgList [<a name="::NumberedMenu(2)"><a href="./menu.tcl.html#::NumberedMenu_2">::NumberedMenu</a></a> -head &#34;Available Test Beds&#34; \
                -question1 &#34;Select test beds to run verify test beds on&#34; \
                -choices $cfgList \
                -menuWidth        75 \
                -keyWidth         3 \
                -headerPadChar    &#34;=&#34; \
                -chAppendList     &#34;null&#34; \
                -chPrependList    &#34;null&#34; \
                -barChar          &#34;-&#34; \
                -clearXterm       &#34;yes&#34; \
                -clearXtermInfo   &#34;&#34; ]
} else {
    while {0} {
        puts &#34;&#34;;
        set choice &#34;21.1&#34;
        puts -nonewline &#34;Enter a release \[$choice\]: &#34;;
        flush stdout;
        gets stdin userChoice;
        if {$userChoice == &#34;&#34;} {
            set userChoice $choice
        }
        if {[regexp -nocase &#34;^\[0-9]{2,2}\.\[0-9]{1,1}$&#34; $userChoice]} {
            set rel 
            set rel $userChoice
            set cfgList [<a name="::get_test_beds(1)"><a href="./regtoolsLib.tcl.html#::get_test_beds_499">::get_test_beds</a></a> $userChoice];
            <span class="comment-line">#puts &#34;\nMAIN cfglist $cfgList&#34;;</span>
            break;
        } else {
            puts &#34;Error: Your choice must be in the format 21.1&#34;;
            continue;
        }
    }
    <span class="comment-line">#set rel $build</span>
    set cfgList [<a name="::get_test_beds(2)"><a href="./regtoolsLib.tcl.html#::get_test_beds_499">::get_test_beds</a></a> $build];
    while {1} {
        puts &#34;&#34;;
        set choice &#34;No&#34;
        puts &#34;&#34;
        puts &#34;HIT ENTER TO SKIP&#34;
        puts -nonewline &#34;Regex filter on cfg and owner.  Enter the string '440_G|450_G|620|mix'\[$choice\]: &#34;;
        flush stdout;
        gets stdin userChoice;
        if {$userChoice==&#34;&#34;} {
            set autoUserBeds &#34;&#34;
            set userChoice $choice
        }
        if {[regexp -nocase &#34;^n|^no&#34; $userChoice]} {
            <span class="comment-line">#puts &#34;return nothing&#34;</span>
            break;
        } else {
            set newCList [<a name="::get_filtered_test_beds(1)"><a href="./regtoolsLib.tcl.html#::get_filtered_test_beds_563">::get_filtered_test_beds</a></a> $cfgList $userChoice]
            if {[llength $newCList] &lt;= 0} {
                puts &#34;No match.  Using the entire release based cfg file list&#34;
                break;
            } else {
                set cfgList $newCList;
                break;
            }
        }
    }

    set mainL [<a name="::maintestbeds(1)"><a href="./regtoolsLib.tcl.html#::maintestbeds_278">::maintestbeds</a></a>];
    set ccL [<a name="::cctestbeds(1)"><a href="./regtoolsLib.tcl.html#::cctestbeds_380">::cctestbeds</a></a>];
    set qlL [<a name="::qltestbeds(1)"><a href="./regtoolsLib.tcl.html#::qltestbeds_402">::qltestbeds</a></a>];
    set vtL [<a name="::vttestbeds(1)"><a href="./regtoolsLib.tcl.html#::vttestbeds_424">::vttestbeds</a></a>];
    set lcL [<a name="::lctestbeds(1)"><a href="./regtoolsLib.tcl.html#::lctestbeds_446">::lctestbeds</a></a>];
    set cfgLen [llength $cfgList];
    set newCfgList &#34;&#34;
    for {set x 0} {$x&lt;$cfgLen} {incr x} {
        if {[lsearch $mainL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is running main.tcl&#34;;
            continue;
        }
        if {[lsearch $ccL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is running checkConnections.tcl&#34;;
            continue;
        }
        if {[lsearch $qlL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is running QLoadImage.tcl&#34;;
            continue;
        }
        if {[lsearch $vtL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is running verifyTestBed.tcl&#34;;
            continue;
        }
        if {[lsearch $lcL [lindex $cfgList $x]] &gt;=0} {
            puts &#34;Cfg [lindex $cfgList $x] is sitting a loadConsoles&#34;;
            continue;
        }
        if {[llength $incfgs] &gt; 0} {
            if {[lsearch $incfgs [lindex $cfgList $x]] &lt; 0} {
                puts &#34;Using Args Cfg [lindex $cfgList $x] is not passed in&#34;;
                continue;
            }
        }
        lappend newCfgList [lindex $cfgList $x]
    }
    set cfgList $newCfgList

    set cfgList [<a name="::NumberedMenu(3)"><a href="./menu.tcl.html#::NumberedMenu_2">::NumberedMenu</a></a> -head &#34;Available Test Beds&#34; \
                -question1 &#34;Select test beds&#34; \
                -choices $cfgList \
                -menuWidth        75 \
                -keyWidth         5 \
                -headerPadChar    &#34;=&#34; \
                -chAppendList     &#34;null&#34; \
                -chPrependList    &#34;null&#34; \
                -barChar          &#34;-&#34; \
                -clearXterm       &#34;yes&#34; \
                -clearXtermInfo   &#34;&#34; ]

}


while {1} {
    set choice y
    puts -nonewline &#34;Run Verify TestBed on these test beds(y/n)\[$choice\]: &#34;;
    flush stdout;
    gets stdin userChoice;
    if {$userChoice==&#34;&#34;} {
       set userChoice $choice
    }
    if {[regexp -nocase &#34;y&#34; $userChoice] || [regexp -nocase &#34;n&#34; $userChoice]} {
        if {[regexp -nocase &#34;y&#34; $userChoice]} {
            set go 1
        } else {
            set go 0
        }
       puts &#34;&#34;
       break;
    } else {
       puts &#34;Error: Config selection must be either y or n&#34;
       continue
    }
}
cd ../main
foreach cfg $cfgList {
    after 1500
    if {$cfg != &#34;null&#34;} {
        if {![regexp -nocase &#34;^cfg&#34; $cfg] } {
            puts &#34;matched start with cfg&#34;
            set cfgFile [format %s/%s cfg $cfg]
            set cfgFile [string trim $cfgFile];
        } else {
            puts &#34;matched catch all&#34;
            set cfgFile $cfg
        }
    }
    puts &#34;Using config file: ($cfgFile)&#34;

    if {[file exists $cfgFile] == 0} {
        puts &#34;Cannot find config file: $cfgFile\n&#34;
        puts stderr &#34;Cannot find config file: $cfgFile&#34;
        return
    }

    puts &#34;************** ABOUT TO source $cfgFile *****************&#34;
    catch {source $cfgFile } reason

    set mydir [pwd]
    puts &#34;launching Verify TestBed for cfg $cfgFile in xterm&#34;
    puts &#34;/Util/bash_vt $cfgFile $cfgFile&#34;

    if {1} {
        if {[catch {exec /usr/bin/xterm -e \
                 &#34;../Util/bash_vt $cfgFile $bank $build $target $cfgFile $quick&#34; &amp;} reason]} {
             puts &#34;OOOPPPSSSSS&#34;
        }
    }
        after 2000
        puts &#34;\n\n&#34;
        cd $mydir
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
