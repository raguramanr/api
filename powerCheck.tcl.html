<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>powerCheck.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#powerCheck.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>powerCheck.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="powerCheck.tcl-annot.html">annotations</a> | <a href="powerCheck.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>

package require Tclx

<strong><a name="::::print_usage_5">proc <a href="powerCheck.tcl-annot.html#::::print_usage">::::print_usage</a></a></strong> {} {
    puts &#34;\r&#34;
    puts {Usage: powerCheck.tcl -cfg &lt;cfg.cfg&gt; -mode &lt;null|on|off&gt;}
    puts {      [&lt;cfg&gt;]: f48_std.cfg}
    puts {      [&lt;mode&gt;]: reboot|off|on|null default null verify PDU}
    puts &#34;\r&#34;
}

<span class="comment-line"># checking command parameters</span>
if {$argc&lt;2} {
    puts &#34;Not enough parameters&#34;
    <a name="::::print_usage(1)"><a href="./summarize.tcl.html#::::print_usage_2">::::print_usage</a></a>
    exit
}

set LIB_PATH &#34;../Lib&#34;
lappend auto_path $LIB_PATH

source ../Lib/parse_args.tcl
source ../Lib/mainLib.tcl
source ../Lib/downLoadCode.tcl
source ../Lib/poweroutlet.tcl
<span class="comment-line">##################################################################################</span>
<span class="comment-line">#  Parse Args</span>
<span class="comment-line">##################################################################################</span>
<a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> LoadCode $argv {
    cfg     &#34;null&#34;
    mode    &#34;null&#34;
}
set module &#34;CheckPower&#34;
<a name="::::gen_index(1)"><a href="./summarize.tcl.html#::::gen_index_76">::::gen_index</a></a> &#34;../Lib&#34;
<span class="comment-line">##################################################################################</span>
<span class="comment-line">#  Source the config files</span>
<span class="comment-line">##################################################################################</span>
set sourceFile &#34;&#34;
if [catch {source &#34;../main/cfg/common.cfg&#34;} rea] {
    puts &#34;*** WARNING: Unable to source common.cfg:$rea............... ***&#34;
    puts &#34;*** WARNING: Application level variables may not be defined. ***&#34;
    exit -1
}

if {[regexp -nocase &#34;on|off|re&#34; $mode]} {
   puts &#34;Turn Test Bed $mode&#34;
} else {
   puts &#34;Illegal mode.  Must be on or off&#34;
   exit;
}

puts &#34;CFG is $cfg&#34;
if {$cfg != &#34;null&#34;} {
    set sourceFile $cfg
    if {([regexp -nocase &#34;^short&#34; $sourceFile]&amp;&amp;[regexp -nocase {/} $sourceFile]) || \
    [regexp -nocase &#34;^pt&#34; $sourceFile]} {
        set sourceFile [format %s/%s/%s $regType $module $sourceFile]
        set sourceFile [string trim $sourceFile];
        puts &#34;Using config file: ($sourceFile)&#34;
    } elseif {![regexp -nocase &#34;^cfg&#34; $sourceFile] &amp;&amp; ![regexp -nocase {/} $sourceFile]} {
        if {[file exists $sourceFile]==0} {
            set sourceFile [format %s/%s cfg $sourceFile]
            set sourceFile [string trim $sourceFile];
            puts &#34;Using config file: ($sourceFile)&#34;
        } else {
            puts &#34;$sourceFile does not exist [file exists $sourceFile]&#34;
        }
    } else {
        if {[file exists $sourceFile]} {
            set sourceFile [string trim $sourceFile];
            puts &#34;Using config file: ($sourceFile) pwd [pwd]&#34;
            source $sourceFile
        } else {
            puts &#34;$sourceFile does not exist [file exists $sourceFile]&#34;
        }
        puts &#34;Hit last case $sourceFile&#34;
    }
}
if {[file exists $sourceFile] == 0} {
    puts &#34;Cannot find config file: $sourceFile\n&#34;
    exit
}
catch {source $sourceFile} reason
<span class="comment-line"># ----- load {expect52.dll}</span>
if {$tcl_platform(platform) == &#34;windows&#34;} {
    load &#34;expect52.dll&#34;
} else {
    load [lindex [glob &#34;/usr/lib/libexpect*so*&#34;] 0]
}

log_user 0

if {$tcl_platform(platform) == &#34;windows&#34;} {
    lappend auto_path &#34;C:/Program Files/Ixia/TclScripts/Lib/ixTcl1.0&#34;
} else {
    lappend auto_path [file join $env(HOME) &#34;ixia/lib/mpexpr-1.0&#34;]
    lappend auto_path [file join $env(HOME) &#34;ixia/lib/ixTcl1.0&#34;]
    lappend auto_path [file join $env(HOME) &#34;ixia/lib/dp4.0&#34;]
}

set auto_path [linsert $auto_path 0 . ]

if {![file isdirectory Report]} {
    file mkdir Report
}
if {![file isdirectory Result]} {
    file mkdir Result
}
if {![file isdirectory Tmp]} {
    file mkdir Tmp
}
if {![file isdirectory Log]} {
    file mkdir Log
}

<a name="::::gen_index(2)"><a href="./summarize.tcl.html#::::gen_index_76">::::gen_index</a></a> .
<span class="comment-line">############################################################</span>
set tStartTime [clock seconds]
set tStartDate [clock format [clock seconds] -format &#34;%Y-%m-%d %I.%M.%S%p&#34;]
set passCount       0
set failCount       0
set skipCount       0
set testDuration    0
set testHour        0
set testMin         0
set testSec         0
set resultDir       &#34;NULL&#34;
set skipCopy        1
set DUT(bug)        1
set DUT(LoadImage)  1
set DUT(xmod)       0
set numDUT  1
set ReportLoginError &#34;no&#34;

<span class="comment-line"># ------------------------------------------------------------------------</span>
<span class="comment-line"># ------------------------------------------------------------------------</span>
puts &#34;\n==========================================================================\n\
       Verify power controller connections to test bed DUTs\n\
      ==========================================================================&#34;
<span class="comment-line"># ------------------------------------------------------------------------</span>
<span class="comment-line"># ------------------------------------------------------------------------</span>

<span class="comment-line">##############################################################################</span>
<span class="comment-line">##  Power off all DUTs</span>
<span class="comment-line">##############################################################################</span>
set fd_res [<a name="::open_result_file(1)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;PowerDatDUT&#34;]

set numDUT 1
if {[regexp -nocase &#34;off|re&#34; $mode] } {
    while { [info exists DUT${numDUT}_CONNECT] } {
        set connect [set DUT${numDUT}_CONNECT]
        lappend connectList $connect
        puts &#34;***** DUT${numDUT}_CONNECT=$connect ***** &#34;
        puts &#34;***** numDUT=$numDUT ***** &#34;
        <a name="::PowerOffDUT(1)"><a href="./poweroutlet.tcl.html#::PowerOffDUT_983">::PowerOffDUT</a></a> $numDUT &#34;off&#34;
        incr numDUT 1
    } 
}
set numDUT 1
if {[regexp -nocase &#34;on|re&#34; $mode]} {
    while { [info exists DUT${numDUT}_CONNECT] } {
        set connect [set DUT${numDUT}_CONNECT]
        lappend connectList $connect
        puts &#34;***** DUT${numDUT}_CONNECT=$connect ***** &#34;
        puts &#34;***** numDUT=$numDUT ***** &#34;
        <a name="::PowerOffDUT(2)"><a href="./poweroutlet.tcl.html#::PowerOffDUT_983">::PowerOffDUT</a></a> $numDUT &#34;on&#34;
        incr numDUT 1
    }
}


set tEndTime [clock seconds]
set testDuration [expr $tEndTime-$tStartTime]
set testSec  [expr $testDuration % 60]
set testMin  [expr $testDuration / 60]
set testHour [expr $testMin / 60]
set testMin  [expr $testMin % 60]

<a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
