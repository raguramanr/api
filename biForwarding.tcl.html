<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>biForwarding.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#biForwarding.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>biForwarding.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="biForwarding.tcl-annot.html">annotations</a> | <a href="biForwarding.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
                                                                                       <span class="comment-line"># Changes related to protocol (arp, ip, arpip) dependency.</span>
<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc can be used to send bi-directional ARP request. </span>
<span class="comment-line">#     It runs only &#34;2Way&#34; arp for protocol=arp,</span>
<span class="comment-line">#     It runs only &#34;2Way&#34; ip for protocol=&#34;ip&#34;</span>
<span class="comment-line">#     It runs both &#34;2Way&#34; arp-&gt;ip for protocol=&#34;arpip&#34;</span>
<span class="comment-line">#     STRICTLY DOES NOT CHECK PROPER IP-OPTIONS TO DESTIN, TTL etc</span>
<span class="comment-line"># Input args: txPortId, rxPortId, protocol, dIpAddr, sIpAddr, replySendHwAddr,</span>
<span class="comment-line">#              filePt, numFrames, tag, inSaMac, inDaMac</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># CheckBiForwarding -txPortId $txPort -checkPortList $checkPortList \</span>
<span class="comment-line">#                     -protocol &#34;ip&#34; -sGIpAddr &#34;50.1.2.3&#34; -dGIpAddr &#34;60.1.2.3&#34; \</span>
<span class="comment-line">#                     -dIpAddr &#34;60.${pp}.${pp}.1&#34; -sIpAddr &#34;50.${pp}.${pp}.1&#34; \</span>
<span class="comment-line">#                     -rxPortId $rxPort -filePt $fd_res -numFrames $nIpFrames</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################    </span>
<strong><a name="::::CheckBiForwarding_19">proc <a href="biForwarding.tcl-annot.html#::::CheckBiForwarding">::::CheckBiForwarding</a></a></strong> {args} {
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckBiForwarding $args {
     txPortId &#34;1&#34;
     rxPortId &#34;2&#34;
     <a name="::protocol(1)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;ip&#34;
     sTag      &#34;none&#34;
     dTag      &#34;none&#34;     
     inSaMac &#34;00:a1:f1:00:00:01&#34;
     inDaMac &#34;FF:FF:FF:FF:FF:FF&#34;
     sIpAddr &#34;127.0.0.1&#34;
     dIpAddr &#34;127.0.0.1&#34;
     sGIpAddr &#34;0.0.0.0&#34;
     dGIpAddr &#34;0.0.0.0&#34;
     frameSize &#34;64&#34;
     percentage &#34;100&#34;
     sPort &#34;0&#34;
     dPort &#34;0&#34;
     numFrames &#34;1&#34;
     tcpSynFlag &#34;false&#34;
     tcpFinFlag &#34;false&#34;
     tcpRstFlag &#34;false&#34;
     tcpAckFlag &#34;false&#34;
     tcpPushFlag &#34;false&#34;
     tcpUrgFlag &#34;false&#34;
     icmpType &#34;0&#34;
     icmpCode &#34;0&#34;
     ttlDecr &#34;1&#34;
     checkPortList {&#34;20 forwarded&#34;}
     filePt &#34;NULL&#34;
     applyFilter &#34;0&#34;
     udfEnable &#34;false&#34;
     udfInitval &#34;00&#34;
     udfOffset &#34;0&#34;
     udfCountertype &#34;c8&#34;
     udfContinuousCount &#34;false&#34;
     ipOptions &#34;&#34;
	 
	 
   }

   global TrafficGen
   switch -exact -- $TrafficGen {
		ixia -
                ixvm {
		   
   <span class="comment-line">#get the maximum card being used in the test, ignore the passed parameter</span>
   set maxPorts [lindex [lindex $checkPortList [expr [llength $checkPortList] -1]] 0]
   set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $maxPorts]
   global TrafficGen
   global numDUT

   if { $sGIpAddr == &#34;0.0.0.0&#34; } { set sGIpAddr $dIpAddr }
   if { $dGIpAddr == &#34;0.0.0.0&#34; } { set dGIpAddr $sIpAddr }
   global startCardNum
   set pPattern &#34;abcd&#34;   
     
   <span class="comment-line">#map portId to Ixia port</span>
   if {$rxPortId == $txPortId} {
      <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invalid port specification: txPortId=rxPortId&#34;
      return
   }

   <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId txChas txCard txPort
   if {$rxPortId == 0} {
      <span class="comment-line">#then just choose some random port different the txPort</span>
      <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId rxChas rxCard rxPort
      if {$txPort == 1} {set rxPort 2} else {set rxPort 1}
   } else {
      <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $rxPortId rxChas rxCard rxPort
   }
   
   <span class="comment-line">#setup tag</span>
   if { $sTag == &#34;none&#34; } {
      set wTag &#34;false&#34;
      set tagValue $sTag
   } else {
      set wTag &#34;true&#34;
      set tagValue $sTag
   }	
   if { $dTag != &#34;none&#34; } {
      lappend wTag &#34;true&#34;
      lappend tagValue $dTag
   } else {
      lappend wTag &#34;false&#34;
      lappend tagValue $dTag
   }

   if { $protocol == &#34;arp&#34; } { <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Message $protocol L2 forwarding check on Txport $txPortId&#34;
   } elseif {(($protocol== &#34;arpip&#34;) || \
              ($protocol==&#34;ip&#34;))} {<a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Message $protocol L3 forwarding check on Txport $txPortId&#34;
   } else {
      <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Message $protocol L3 forwarding check on Txport $txPortId&#34;
   }
   
   <span class="comment-line">#set to user input, will be overwritten when using learn_arp function</span>
   set testResult &#34;good&#34; 
   <span class="comment-line">#generate ARP protocol server, if rxPort is set, protocol=arp</span>
   if { ($rxPortId &gt; 0) &amp;&amp; (($protocol == &#34;arp&#34;)||($protocol == &#34;arpip&#34;)) } {
     global one2oneArray
     <span class="comment-line"># Create mapping</span>
     if {$TrafficGen != &#34;ept&#34;} {
     <a name="::map(1)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> new -type					one2one
     <a name="::map(2)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> config -type 				one2one
     }
     <a name="::map(3)"><a href="./ePTClient.tcl.html#::map_366">::map</a></a> add $txChas $txCard $txPort $rxChas $rxCard $rxPort 
     <a name="::stream(1)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> setDefault
     <span class="comment-line">#needs this to generate arp</span>
     <a name="::protocol(2)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> setDefault
     <a name="::protocol(3)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -ethernetType  				ethernetII
     <a name="::protocol(4)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> config -name					ip

   
     if {$TrafficGen != &#34;ept&#34;} {
     <a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> setDefault
     <a name="::ip(2)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> config -sourceIpAddr					$sIpAddr
     <a name="::ip(3)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> config -destDutIpAddr					$sGIpAddr
     <a name="::ip(4)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> set							$txChas $txCard $txPort

     <span class="comment-line">#Other port be configured for arp response too</span>
     <a name="::ip(5)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> setDefault
     <a name="::ip(6)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> config -sourceIpAddr					$dIpAddr
     <a name="::ip(7)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> config -destDutIpAddr				        $dGIpAddr
     <a name="::ip(8)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> set							$rxChas $rxCard $rxPort
     } else {  
     <a name="::ip(9)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> config -sourceIpAddr					$sIpAddr
     <a name="::ip(10)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> config -destDutIpAddr					$sGIpAddr
     <a name="::ip(11)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> config -sourceIpAddr					$dIpAddr
     <a name="::ip(12)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> config -destDutIpAddr				        $dGIpAddr
     }     
     set destMacAddrTx [<a name="::SendArpRequest(1)"><a href="./ePTSendPacket.tcl.html#::SendArpRequest_1127">::SendArpRequest</a></a> $txPortId $sIpAddr $sGIpAddr $sTag]

     if {$destMacAddrTx == &#34;NO_ARP_REPLY&#34;} {
        <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Expect an arp reply, but got none on port $txPortId&#34;
        set testResult &#34;bad&#34;
     } else {
        lappend destMacAddrList $destMacAddrTx
        <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Got an arp reply on Tx port $txPortId. MAC: |$destMacAddrTx|&#34;
     }
     set destMacAddrRx [<a name="::SendArpRequest(2)"><a href="./ePTSendPacket.tcl.html#::SendArpRequest_1127">::SendArpRequest</a></a> $rxPortId $dIpAddr $dGIpAddr $dTag]
     if {$destMacAddrRx == &#34;NO_ARP_REPLY&#34;} {
        <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Expect an arp reply, but got none on port $rxPortId&#34;
        set testResult &#34;bad&#34;
     } else {
        lappend destMacAddrList $destMacAddrRx
        <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Got an arp reply on Rx port $rxPortId. MAC: |$destMacAddrRx|&#34;
     }

     if {$protocol==&#34;arp&#34;} {<a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>; return}
     if {( ($protocol==&#34;arpip&#34;) &amp;&amp; ($testResult == &#34;bad&#34;)  )} {<a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>; return}

   }
   
     if {[regexp -nocase &#34;ip|tcp|udp|icmp&#34; $protocol] &amp;&amp; ![regexp -nocase &#34;arpip&#34; $protocol] } {
     if {$numDUT&lt;= 2 } {
      <span class="comment-line"># Portid 1-8, 12-24 are on DUT1 and 9-12 are on DUT2</span>
     if {($txPortId&gt;=9) &amp;&amp; ($txPortId&lt;=12)} {
        set destMacAddrList [<a name="::GetDUTMac(1)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT2&#34;]
     } else {
        set destMacAddrList [<a name="::GetDUTMac(2)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT1&#34;]
     }
      } else {
       set quo [expr $txPortId%2]
       set DUTNUM [expr [expr $txPortId/2]+$quo]
         set destMacAddrList [<a name="::GetDUTMac(3)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT$DUTNUM&#34;]
         }
       if {$numDUT&lt;= 2 } {
     if {($rxPortId&gt;=9) &amp;&amp; ($rxPortId&lt;=12)} {
        lappend destMacAddrList [<a name="::GetDUTMac(4)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT2&#34;]
     } else {
        lappend destMacAddrList [<a name="::GetDUTMac(5)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT1&#34;]
     }
      } else {

     set quo [expr $rxPortId%2]
       set DUTNUM [expr [expr $rxPortId/2]+$quo]
        puts &#34;DUTNUM ==&gt; $DUTNUM&#34;
         lappend destMacAddrList [<a name="::GetDUTMac(6)"><a href="./misc.tcl.html#::GetDUTMac_380">::GetDUTMac</a></a> &#34;DUT$DUTNUM&#34;]
     } 
    }   

  <span class="comment-line"># Send an ip packet for ipf learning across both switches in order for fast path fwding in actual ip send</span>
  if {(($txPortId&gt;=9)&amp;&amp;($txPortId&lt;=12))||(($rxPortId&gt;=9)&amp;&amp;($rxPortId&lt;=12))} {
    set frameSent [<a name="::ixiaConf_2Ports_ip(1)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -numIxiaCd $numIxiaCd -startCardNum $startCardNum \
                 -txChas $txChas -txCard $txCard -txPort $txPort -frameSize $frameSize \
                 -rxChas $txChas -rxCard $rxCard -rxPort $rxPort \
                 -pDstPort $dPort -pSrcPort $sPort -direction &#34;2Way&#34; \
                 -type $icmpType -code $icmpCode -applyFilter $applyFilter \
                 -tcpSynFlag $tcpSynFlag -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag -tcpAckFlag $tcpAckFlag \
                 -tcpPushFlag $tcpPushFlag -tcpUrgFlag $tcpUrgFlag \
                 -dataPattern $pPattern -wTag $wTag -tagNo $tagValue -ipProtocol $protocol \
                 -dMacAddr $destMacAddrList  -sIpAddr $sIpAddr -ipOptions $ipOptions \
                 -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount \
                 -dIpAddr $dIpAddr -numFrames 1]
  }
  <span class="comment-line"># Send an ip packet</span>
 set frameSent [<a name="::ixiaConf_2Ports_ip(2)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_ip_867">::ixiaConf_2Ports_ip</a></a> -numIxiaCd $numIxiaCd -startCardNum $startCardNum \
               -txChas $txChas -txCard $txCard -txPort $txPort -frameSize $frameSize \
               -rxChas $txChas -rxCard $rxCard -rxPort $rxPort -percentage $percentage \
               -pDstPort $dPort -pSrcPort $sPort -direction &#34;2Way&#34; \
               -type $icmpType -code $icmpCode -applyFilter $applyFilter \
               -tcpSynFlag $tcpSynFlag -tcpFinFlag $tcpFinFlag -tcpRstFlag $tcpRstFlag -tcpAckFlag $tcpAckFlag \
               -tcpPushFlag $tcpPushFlag -tcpUrgFlag $tcpUrgFlag \
               -dataPattern $pPattern -wTag $wTag -tagNo $tagValue -ipProtocol $protocol \
               -dMacAddr $destMacAddrList  -sIpAddr $sIpAddr -ipOptions $ipOptions \
               -udfEnable $udfEnable -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCountertype -udfContinuousCount $udfContinuousCount \
               -dIpAddr $dIpAddr -numFrames $numFrames]

   if {$numFrames &gt;= 10} {
     <a name="::ixiaCheckTxDone(1)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $txChas $txCard $txPort $numFrames $txPortId
     <a name="::ixiaCheckTxDone(2)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $rxChas $rxCard $rxPort $numFrames $txPortId
   }

   <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FrameSentIP: $frameSent&#34;
   <span class="comment-line">#retrieve data from ixia</span>
   <span class="comment-line">#find how many expected packets was received</span>
   foreach checkPort $checkPortList {
      set portId [lindex $checkPort 0]
      <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
      set doesItForward($portId) 0
      if {$applyFilter} {
         set framesReceived [lindex [<a name="::ixiaUserDefinedStat1(1)"><a href="./ePTRx.tcl.html#::ixiaUserDefinedStat1_558">::ixiaUserDefinedStat1</a></a> $portId $filePt] 1]
      } else {
         <a name="::stat(1)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasisId $card $port
         set framesReceived [<a name="::stat(2)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]
      }
      <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;actual Frames Received on port $portId is $framesReceived and sent frames=$numFrames&#34;
      if {$framesReceived &gt;= $numFrames} {
         set doesItForward($portId) 1
      }
   }

   <span class="comment-line">#now check received data against checkList to see if matched</span>
   foreach checkPort $checkPortList {
      set portId [lindex $checkPort 0]
      set portFlag [lindex $checkPort 1]
      switch -- $portFlag \
         &#34;forwarded&#34; {
            set shouldForward 1
          } &#34;notForwarded&#34; {
            set shouldForward 0
          } default {
            set shouldForward $portFlag
          }
 
      if { ($doesItForward($portId) == $shouldForward) } {
         <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Forwarding on port $portId checked Okay. Was $portFlag&#34;
      } else {
         <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Forwarding criteria failed on port $portId.&#34;
        <span class="comment-line">#result_debug &#34;numPacketReceived= $numPacketReceived($portId) BUT expectedPackets= $expectedPacket&#34;</span>
         set testResult &#34;bad&#34;
      }
   }
   if {$testResult == &#34;good&#34;} {
     <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check data forwarding passed&#34;
   }  else {
     <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check data forwarding failed&#34;
  }  

  <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a> 
}
	}
}

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc can be used to send bi-directional MAC frame. </span>
<span class="comment-line"># Input args: txPortId, rxPortId, protocol, sourceMac, DesrMac, </span>
<span class="comment-line">#              filePt, numFrames, tag, tagPriority</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># CheckMACBiForwarding -txPortId $txPort -checkPortList $checkPortList \</span>
<span class="comment-line">#                  -tag &#34;10 10&#34; -rxPortId $rxPort -filePt $fd_res \</span>
<span class="comment-line">#                  -numFrames 10000 -tagPriority 4;</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################    </span>
<strong><a name="::::CheckMACBiForwarding_294">proc <a href="biForwarding.tcl-annot.html#::::CheckMACBiForwarding">::::CheckMACBiForwarding</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> SendFrame $args {
      txPortId &#34;1&#34;
      rxPortId &#34;0&#34;
      <a name="::protocol(5)"><a href="./ePTClient.tcl.html#::protocol_728">::protocol</a></a> &#34;mac&#34;
      sourceMac &#34;default&#34;
      destMac &#34;default&#34;
      numFrames &#34;1&#34;
      frameSize &#34;68&#34;
      frameSizeType &#34;sizeFixed&#34;
      dataPattern &#34;1234&#34;
      streamType &#34;stopStream&#34;
      fcsError &#34;good&#34;
      saMode &#34;idle&#34;
      daMode &#34;idle&#34;
      percentage &#34;100&#34;
      checkPortList {&#34;20 forwarded&#34;}
      tag &#34;none&#34;     
      tagPriority &#34;0&#34;	   
      filePt &#34;NULL&#34;
      applyFilter &#34;0&#34;
   }
   global TrafficGen
   <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Message MAC forwarding check on Txport $txPortId&#34;
     
   <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId txChasisId txCard txPort
   if {$rxPortId == 0} {
      set sendLearn &#34;false&#34;
      set rxPort [<a name="::MapIxiaPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId rxChasisId rxCard rxPo]
   } else {
      set sendLearn &#34;true&#34;
      <a name="::MapIxiaPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $rxPortId rxChasisId rxCard rxPort
   }
   set numIxiaCd [<a name="::::GetNumIxiaCd(2)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $txPortId]
   
   if {$tag != &#34;none&#34; } { 
      set wTag &#34;true&#34;
   } else {
      set wTag &#34;false&#34;
   }
   
   set testResult &#34;good&#34;

   <a name="::SendFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $txPortId
   <a name="::SendFrame(2)"><a href="./ePTSendPacket.tcl.html#::SendFrame_402">::SendFrame</a></a> -txPortId $rxPortId 
   
   set portList &#34;&#34;
   foreach checkPort $checkPortList {
      set portIdThis [lindex $checkPort 0]
      lappend portList $portIdThis
   }
   <a name="::ClearPortsStats(1)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $portList
   <a name="::StartPortsCapture(1)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $portList

    global TrafficGen
    switch -exact -- $TrafficGen {
        stc -
        ixia -
        ixvm {
	<a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;LEARNING?? $sendLearn&#34; 
   set frameSent [<a name="::ixiaConf_2Ports(1)"><a href="./ePTTx.tcl.html#::ixiaConf_2Ports_690">::ixiaConf_2Ports</a></a> -numIxiaCd $numIxiaCd \
                  -txChas $txChasisId -txCard $txCard -txPort $txPort -direction &#34;2Way&#34; \
                  -rxChas $rxChasisId -rxCard $rxCard -rxPort $rxPort -sendLearn $sendLearn \
                  -protocol $protocol -numFrames $numFrames -frameSize $frameSize -frameSizeType $frameSizeType \
                  -dataPattern $dataPattern -streamType $streamType -fcsError $fcsError \
                  -inSaMac $sourceMac -saMode $saMode -inDaMac $destMac -daMode $daMode \
                  -percentage $percentage -wTag $wTag -tagNo $tag -tagPriority $tagPriority]
                  
  if {$streamType != &#34;contPacket&#34; &amp;&amp; $numFrames &gt; 100} {
     <a name="::ixiaCheckTxDone(3)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $txChasisId $txCard $txPort $numFrames $txPortId
     <a name="::ixiaCheckTxDone(4)"><a href="./ePTMisc.tcl.html#::ixiaCheckTxDone_334">::ixiaCheckTxDone</a></a> $rxChasisId $rxCard $rxPort $numFrames $txPortId
   }
        }
    }

   <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FrameSent: $frameSent&#34;
   <span class="comment-line">#retrieve data from ixia</span>
   <span class="comment-line">#find how many expected packets was received</span>
   foreach checkPort $checkPortList {
      set framesConfirmed 0
      set portId [lindex $checkPort 0]
      <a name="::MapIxiaPortId(8)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chasisId card port
      set doesItForward($portId) 0
      switch -exact -- $TrafficGen {
          stc -
          ixia -
          ixvm {
      if {$applyFilter} {
         set framesReceived [lindex [<a name="::ixiaUserDefinedStat1(2)"><a href="./ePTRx.tcl.html#::ixiaUserDefinedStat1_558">::ixiaUserDefinedStat1</a></a> $portId $filePt] 1]
      } else {
         <a name="::stat(3)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> get statAllStats $chasisId $card $port
         set framesReceived [<a name="::stat(4)"><a href="./ePTClient.tcl.html#::stat_1769">::stat</a></a> cget -framesReceived]
      }
          }
      }
      <span class="comment-line"># check if these frames include the data pattern</span>
      set rawPortDataList [<a name="::GetCapturedFrames(1)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $portId]
      foreach frame $rawPortDataList {
        set frame [string map { &#34; &#34; &#34;&#34; } $frame]
        set lndatPat [string length $dataPattern]
        set firstChar 24
        set lastChar [expr $firstChar + $lndatPat]
        set lastChar [expr $lastChar -1]
        set dataPt1 [string range $frame $firstChar $lastChar]
        set cmpRes [string compare $dataPt1 $dataPattern]
        if {$cmpRes == &#34;0&#34;} {
          incr framesConfirmed
        }
      }

      <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;actual Frames Received on port $portId is $framesReceived and sent frames=$numFrames confirmed=$framesConfirmed&#34;
      if {($framesConfirmed &gt;= $numFrames) &amp;&amp; ($framesReceived &gt;= $numFrames)} {
         set doesItForward($portId) 1
      }
   }
   <a name="::StopPortsCapture(1)"><a href="./ePTRx.tcl.html#::StopPortsCapture_862">::StopPortsCapture</a></a> $portList

   <span class="comment-line">#now check received data against checkList to see if matched</span>
   foreach checkPort $checkPortList {
      set portId [lindex $checkPort 0]
      set portFlag [lindex $checkPort 1]
      switch -- $portFlag \
         &#34;forwarded&#34; {
            set shouldForward 1
          } &#34;notForwarded&#34; {
            set shouldForward 0
          } default {
            set shouldForward $portFlag
          }
 
      if { ($doesItForward($portId) == $shouldForward) } {
         <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Forwarding on port $portId checked Okay. Was $portFlag&#34;
      } else {
         <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Forwarding criteria failed on port $portId.&#34;
        <span class="comment-line">#result_debug &#34;numPacketReceived= $numPacketReceived($portId) BUT expectedPackets= $expectedPacket&#34;</span>
         set testResult &#34;bad&#34;
      }
   }
   if {$testResult == &#34;good&#34;} {
     <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Check data forwarding passed&#34;
   }  else {
     <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Check data forwarding failed&#34;
  }  

  
  <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>  
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
