<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>sleep.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#sleep.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>sleep.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="sleep.tcl-annot.html">annotations</a> | <a href="sleep.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line"># ---------------------------------------------------------------------------------------</span>
<span class="comment-line"># proc _platformSleep</span>
<span class="comment-line">#</span>
<span class="comment-line"># Args: In: platformStringVar from common.cfg list</span>
<span class="comment-line">#           time List</span>
<span class="comment-line">#           dut</span>
<span class="comment-line"># ---------------------------------------------------------------------------------------</span>
<strong><a name="::::_platformSleep_8">proc <a href="sleep.tcl-annot.html#::::_platformSleep">::::_platformSleep</a></a></strong> {args} {
    global DUTs_info MAIN

    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _platformSleep $args {
        labelList   &#34;null&#34;
        sysTypes    &#34;null&#34;
        delayList   &#34;null&#34;
        dut         &#34;1&#34;
    }

    set i 0;
    foreach sysT $sysTypes {
        if {[regexp -nocase &#34;$sysT&#34; $DUTs_info(DUT$dut,sysType)] ||    
            [regexp -nocase &#34;$sysT&#34; $DUTs_info(DUT$dut,platform)]} {
puts &#34;Why no print: $MAIN(SHOWRESULT_FMT)&#34;
            <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Platform [lindex $labelList $i] waiting [lindex $delayList $i] seconds&#34;
            <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> [lindex $delayList $i]
        }
        incr i
    }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: PlatformDelay</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Single location proc to add platform delays</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line">#</span>
<span class="comment-line">#        delayReason - general or a common cli which can be added as necessary</span>
<span class="comment-line">#        sleepTime - if set to none defaults are taken</span>
<span class="comment-line">#        printM - a message to be printed leaving none will take defaults</span>
<span class="comment-line">#        delayPlatform - pioneer|broadcom|genesis to make it platform specific</span>
<span class="comment-line">#</span>
<span class="comment-line">#        No args has a default delay of pioneer=30 broadcom=5 genesis=1</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#             </span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#   PlatformDelay -delayReason &#34;sync fdb&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::PlatformDelay_51">proc <a href="sleep.tcl-annot.html#::::PlatformDelay">::::PlatformDelay</a></a></strong> {args } {
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> PlatformDelay $args {
        delayReason &#34;general&#34;
        sleepTime &#34;none&#34;
        printM &#34;none&#34;
        delayPlatform &#34;none&#34;
    }
    global whichDutNow
    global DUTs_info

    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    <span class="comment-line">##   Pioneer delay cases</span>
    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    global pioneerPlatform
    if {[regexp -nocase $pioneerPlatform $DUTs_info(DUT$whichDutNow,platform)]} {
        if {$delayPlatform != &#34;none&#34; &amp;&amp; ![regexp -nocase &#34;pioneer&#34; $delayPlatform]} {
            return;
        }
        switch $delayReason {
            &#34;clear fdb&#34; { ;<span class="comment-line"># clear fdb needs a delay</span>
                set theDelay 15
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Pioneer clear fdb ... &#34;
            }
            &#34;show fdb&#34; { ;<span class="comment-line"># show fdb needs a delay</span>
                set theDelay 20
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Pioneer show fdb ... &#34;
            }
            &#34;sync fdb&#34; { ;<span class="comment-line"># Delay needed for fdb sync</span>
                set theDelay 15
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Pioneer sync fdb ... &#34;
            }
            &#34;tag change&#34; { ;<span class="comment-line"># Needs to done after tag change on pioneer</span>
                set theDelay 15
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Pioneer sync fdb ... &#34;
            }
            &#34;port change&#34; { ;<span class="comment-line"># Needs to done after a port move change on pioneer</span>
                set theDelay 15
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Pioneer add/remove a port ... &#34;
            }
            &#34;esrp_eaps change&#34; { ;<span class="comment-line"># Needs to done after a esrp or eaps change on pioneer</span>
                set theDelay 20
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Pioneer eaps/esrp ... &#34;
            }
            &#34;general&#34; { ;<span class="comment-line"># default delay</span>
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;} else {set theDelay 30;}
                if {$printM == &#34;none&#34;} {
                    set outMessage &#34;Pioneer Delay $theDelay seconds!&#34;
                } else {
                    set outMessage &#34;$printM&#34;
                }
            }
            default {
                return;
            }
        }
        <a name="::result_print(1)"><a href="./loadConsoles.tcl.html#::result_print_12">::result_print</a></a> &#34;\n$outMessage&#34;;
        <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $theDelay
    }
    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    <span class="comment-line">##   Everest delay cases</span>
    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    if {[regexp -nocase &#34;BD-X8&#34; $DUTs_info(DUT$whichDutNow,platform)]} {
        if {$delayPlatform != &#34;none&#34; &amp;&amp; ![regexp -nocase &#34;everest&#34; $delayPlatform]} {
            return;
        }
        switch $delayReason {
            &#34;tag change&#34; { ;<span class="comment-line"># Needs to done after tag change on everest</span>
                set theDelay 15
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Everest vlan tag change ... &#34;
            }
            &#34;port change&#34; { ;<span class="comment-line"># Needs to done after a port move change on everest</span>
                set theDelay 15
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Everest add/remove a port ... &#34;
            }
            &#34;general&#34; { ;<span class="comment-line"># default delay</span>
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;} else {set theDelay 5;}
                if {$printM == &#34;none&#34;} {
                    set outMessage &#34;Broadcom Delay $theDelay seconds!&#34;
                } else {
                    set outMessage &#34;$printM&#34;
                }
            }
            default {
                return;
            }
        }
        <a name="::result_print(2)"><a href="./loadConsoles.tcl.html#::result_print_12">::result_print</a></a> &#34;\n$outMessage&#34;;
        <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $theDelay
    }
    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    <span class="comment-line">##   VPEX delay cases</span>
    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    if {[regexp -nocase &#34;vpex&#34; $DUTs_info(DUT$whichDutNow,platform)]} {
        if {$delayPlatform != &#34;none&#34; &amp;&amp; ![regexp -nocase &#34;vpex&#34; $delayPlatform]} {
            return;
        }
        switch $delayReason {
            &#34;tag change&#34; { ;<span class="comment-line"># Needs to done after tag change on VPEX</span>
                set theDelay 15
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Everest vlan tag change ... &#34;
            }
            default {
                return;
            }
        }
        <a name="::result_print(3)"><a href="./loadConsoles.tcl.html#::result_print_12">::result_print</a></a> &#34;\n$outMessage&#34;;
        <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $theDelay
    }
    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    <span class="comment-line">##   Broadcom delay cases</span>
    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    global bcmPlatform
    if {[regexp -nocase $bcmPlatform $DUTs_info(DUT$whichDutNow,platform)]} {
        if {$delayPlatform != &#34;none&#34; &amp;&amp; ![regexp -nocase &#34;broadcom&#34; $delayPlatform]} {
            return;
        }
        switch $delayReason {
            &#34;show fdb&#34; { ;<span class="comment-line"># show fdb needs a delay</span>
                set theDelay 15
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Broadcom show fdb ... &#34;
            }
            &#34;esrp_eaps change&#34; { ;<span class="comment-line"># Needs to done after a esrp or eaps change</span>
                set theDelay 5
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Broadcom eaps/esrp ... &#34;
            }
            &#34;general&#34; { ;<span class="comment-line"># default delay</span>
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;} else {set theDelay 5;}
                if {$printM == &#34;none&#34;} {
                    set outMessage &#34;Broadcom Delay $theDelay seconds!&#34;
                } else {
                    set outMessage &#34;$printM&#34;
                }
            }
            default {
                return;
            }
        }
        <a name="::result_print(4)"><a href="./loadConsoles.tcl.html#::result_print_12">::result_print</a></a> &#34;\n$outMessage&#34;;
        <a name="::exSleep(5)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $theDelay
    }
    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    <span class="comment-line">##   Genesis delay cases</span>
    <span class="comment-line">## -------------------------------------------------------------------------------</span>
    global gnssPlatform
    if {[regexp -nocase $gnssPlatform $DUTs_info(DUT$whichDutNow,platform)]} {
        if {$delayPlatform != &#34;none&#34; &amp;&amp; ![regexp -nocase &#34;genesis&#34; $delayPlatform]} {
            return;
        }
        switch $delayReason {
            &#34;esrp_eaps change&#34; { ;<span class="comment-line"># Needs to done after a esrp or eaps change</span>
                set theDelay 5
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;}
                set outMessage &#34;Sleeping $theDelay seconds awaiting Genesis eaps/esrp ... &#34;
            }
            &#34;general&#34; { ;<span class="comment-line"># default delay</span>
                if {$sleepTime!=&#34;none&#34;} {set theDelay $sleepTime;} else {set theDelay 1;}
                if {$printM == &#34;none&#34;} {
                    set outMessage &#34;Genesis Delay $theDelay seconds!&#34;
                } else {
                    set outMessage &#34;$printM&#34;
                }
            }
            default {
                return;
            }
        }
        <a name="::result_print(5)"><a href="./loadConsoles.tcl.html#::result_print_12">::result_print</a></a> &#34;\n$outMessage&#34;;
        <a name="::exSleep(6)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $theDelay
    }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: exSleep</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: Sleep function that prints time left each second</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#              sec - Number of seconds to sleep</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args:</span>
<span class="comment-line">#              output to stdout</span>
<span class="comment-line">#</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#      exSleep 10</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::exSleep_248">proc <a href="sleep.tcl-annot.html#::::exSleep">::::exSleep</a></a></strong> { sec } {

    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleeping for $sec sec&#34;
    set sleepTime $sec
    puts &#34;\n&#34;
    while {$sec} {
        puts -nonewline &#34;Sleeping $sec of $sleepTime seconds      \r&#34;
        flush stdout
        incr sec -1
        after 1000
    }
}
<span class="comment-line"># ---------------------------------------------------------------------</span>
<span class="comment-line"># proc _getHourMinSec</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># ---------------------------------------------------------------------</span>
<strong><a name="::::_getHourMinSec_270">proc <a href="sleep.tcl-annot.html#::::_getHourMinSec">::::_getHourMinSec</a></a></strong> {} {

    return [clock format [clock seconds] -format &#34;%I:%M:%S&#34;]


}
<span class="comment-line"># ---------------------------------------------------------------------</span>
<span class="comment-line"># proc _getEpoc</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># ---------------------------------------------------------------------</span>
<strong><a name="::::_getEpoc_287">proc <a href="sleep.tcl-annot.html#::::_getEpoc">::::_getEpoc</a></a></strong> {} {

    return [clock seconds]

}
<span class="comment-line">#######################################################################</span>
<span class="comment-line"># Procedure: _UncSwitchDelay</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#######################################################################</span>
<strong><a name="::::_UncSwitchDelay_303">proc <a href="sleep.tcl-annot.html#::::_UncSwitchDelay">::::_UncSwitchDelay</a></a></strong> {args} {
    global DUTs_info


    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _UncSwitchDelay $args {
        dut   &#34;1&#34;
    }

    if {[info exists DUTs_info(DUT$dut,UncSwAdditionalTime)]} {
        <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n\nAdditional $DUTs_info(DUT$dut,UncSwAdditionalTime) Delay for Unconfig Switch. default.xsf Reboot&#34;
        <a name="::exSleep(7)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $DUTs_info(DUT$dut,UncSwAdditionalTime)
    } else {
        <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\n\nNo Additional Unconfig Sleep Required&#34;
    }

}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
