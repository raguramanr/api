<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>igmp.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#igmp.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>igmp.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="igmp.tcl-annot.html">annotations</a> | <a href="igmp.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: startIgmp</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  start the IGMP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: txPortIdList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      startDvmrp {1}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::startIgmp_17">proc <a href="igmp.tcl-annot.html#::::startIgmp">::::startIgmp</a></a></strong> {txPortIdList {groupId 101064} } {

    set pList &#34;&#34;
   global TrafficGen
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
    foreach txPortId $txPortIdList {
	<a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
	<a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startIgmp - Chas: $cha Card: $car Port: $por&#34;
	lappend pList &#34;$cha $car $por&#34;
    }
    
    if {[<a name="::ixTransmitIgmpJoin(1)"><a href="./spirent.tcl.html#::ixTransmitIgmpJoin_798">::ixTransmitIgmpJoin</a></a> pList $groupId]} {
	error &#34;startIgmp: ixTransmitIgmpJoin failed.&#34;
    }
}
      stc {
         set globalDeviceList &#34;&#34;
         foreach txPortId $txPortIdList {
            set txPortId [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            set deviceList [<a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
            <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startIgmp/MLD: Device List - $deviceList&#34;
            set globalDeviceList [concat $globalDeviceList $deviceList]				
         }
         if {[llength $globalDeviceList] &gt; 0} {
            <a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStartCommand -DeviceList $globalDeviceList
            foreach dev $globalDeviceList {
               set igmpHost [<a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $dev -children-igmpHostConfig]
               set netblocks {}
               set membership [<a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $igmpHost -children-igmpgroupmembership]
            <span class="comment-line">#   foreach membership [logcmd stc::get $igmpHost -children-igmpgroupmembership] {</span>
            <span class="comment-line">#      lappend netblocks [logcmd stc::get $membership -children-ipv4networkblock]</span>
            <span class="comment-line">#   }</span>
               <a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform IgmpMldJoinGroupsCommand -blocklist $membership
            }
         }
      }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: stopIgmp</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  start the IGMP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: txPortIdList</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      stopDvmrp {1}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::stopIgmp_73">proc <a href="igmp.tcl-annot.html#::::stopIgmp">::::stopIgmp</a></a></strong> {txPortIdList {groupId 101064} } {

    set pList &#34;&#34;;
   global TrafficGen
   switch -exact -- $TrafficGen {
      ixia -
      ixvm {	
    foreach txPortId $txPortIdList {	
	<a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por;
	<a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;StopIgmp - Chas: $cha Card: $car Port: $por&#34;;
	lappend pList &#34;$cha $car $por&#34;;
    }

    if {[ixTransmitIgmpLeave pList $groupId]} {
	error &#34;stopIgmp: ixTransmitIgmpLeave failed.&#34;
    }
}
      stc {
         
         set globalDeviceList &#34;&#34;
         foreach txPortId $txPortIdList {
            set txPortId [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            set deviceList [<a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
            <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopIgmp/MLD: Device List - $deviceList&#34;
            set globalDeviceList [concat $globalDeviceList $deviceList]				
         }
         if {[llength $globalDeviceList] &gt; 0} {
            foreach dev $globalDeviceList {
               set igmpHost [<a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $dev -children-igmpHostConfig]
               set netblocks {}
               foreach membership [<a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $igmpHost -children-igmpgroupmembership] {
                  lappend netblocks [<a name="::logcmd(9)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $membership -children-ipv4networkblock]
               }
               <a name="::logcmd(10)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform IgmpMldLeaveGroupsCommand -blocklist $netblocks
            }
            <a name="::logcmd(11)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStopCommand -DeviceList $globalDeviceList
         } 
      }
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cleanupIgmp</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description:  cleanup the IGMP protocol server on the ixia</span>
<span class="comment-line">#              </span>
<span class="comment-line"># Input args: txPortIdList, routerIp</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage: </span>
<span class="comment-line">#      cleanupDvmrp {4}</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cleanupIgmp_129">proc <a href="igmp.tcl-annot.html#::::cleanupIgmp">::::cleanupIgmp</a></a></strong> {txPortIdList} {

   global TrafficGen
   
   switch -exact -- $TrafficGen {
      
      stc {
         if { [catch {
            foreach txPortId $txPortIdList {
               set txPortId [<a name="::hMapPortIdToSpirentPort(3)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
               foreach emulatedDevice [<a name="::logcmd(12)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources] {
                  set ipv4If [<a name="::logcmd(13)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-Ipv4If]
                  if {$ipv4If != &#34;&#34;} {
                     <a name="::logcmd(14)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $emulatedDevice
                     
                  }
               }	
            }
            
         } msg ] } {
            <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;cleanupRip : Failed to delete IGMP configuration $msg&#34;
            return 0
         }			
         
      }
      
      ixia -
      ixvm {
         
  foreach txPortId $txPortIdList {    
    <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chas card port;
    set pl [list [list $chas $card $port]] 
    <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cleanupIgmp - Chas: $chas Card: $card Port: $port&#34;;

    protocolServer 		setDefault      
    ipAddressTable		clear
    ipAddressTable		setDefault
    ipAddressTableItem		setDefault      
      
    igmpServer			setDefault
    igmpAddressTable		clear
    igmpAddressTable	 	setDefault
    igmpAddressTableItem 	setDefault      
      
    ipAddressTable set $chas $card $port
    igmpAddressTable set $chas $card $port
    protocolServer set $chas $card $port
    igmpServer set $chas $card $port
    protocolServer write $chas $card $port

    <span class="comment-line"># Send to the hardware </span>
    <a name="::ixWritePortsToHardware(1)"><a href="./mapping.tcl.html#::ixWritePortsToHardware_145">::ixWritePortsToHardware</a></a> pl 
  }      
}
   }
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: setupIgmpServer</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:  setup the IGMP protocol server on the ixia</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:</span>
<span class="comment-line">#               -reportMode: igmpReportToOneWhenQueried(0), igmpReportToAllWhenQueried(1),</span>
<span class="comment-line">#               igmpReportToAllUnsolicited(2)</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Return value: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#    setupIgmpPeer -txPortId 1 \</span>
<span class="comment-line">#               -gatewayIp &#34;61.61.1.1&#34; -ipAddress &#34;61.1.1.10&#34; \</span>
<span class="comment-line">#               -numIpAddresses &#34;10&#34; -groupIpAddress &#34;224.0.1.100&#34; \</span>
<span class="comment-line">#               -numGroupIpAddress &#34;20&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::setupIgmpServer_208">proc <a href="igmp.tcl-annot.html#::::setupIgmpServer">::::setupIgmpServer</a></a></strong> {args} {
    global TrafficGen
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupIgmpServer $args {
        gatewayIp &#34;1.1.1.1&#34;
        ipAddress &#34;1.1.1.2&#34;
        numIpAddr &#34;1&#34;
        groupIp &#34;224.0.1.14&#34;
        numGroupIp &#34;1&#34;
        txPortId &#34;1&#34;
        repeatCount &#34;3&#34;
        reportFrequency &#34;120&#34;
        reportMode &#34;1&#34;
        <a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> &#34;2&#34;
        tag &#34;0&#34;
    }
    
    
    switch -exact -- $TrafficGen {
        stc {
            
            set error_flag 0
            set txPortId [<a name="::hMapPortIdToSpirentPort(4)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
            if {($tag == &#34;none&#34;) || !$tag} {
                array set cmdResults [<a name="::logcmd(15)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(16)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv4If EthIIIf&#34; -IfCount &#34;1 1&#34;]
                set deviceHndl $cmdResults(-ReturnList)
            
            } else {
                array set cmdResults [<a name="::logcmd(17)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceCreateCommand -ParentList [<a name="::logcmd(18)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project] -port $txPortId -IfStack &#34;Ipv4If VlanIf EthIIIf&#34; -IfCount &#34;1 1 1&#34;]
                set deviceHndl $cmdResults(-ReturnList)
                <a name="::logcmd(19)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(20)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-VlanIf] -VlanId $tag 
            }
            <a name="::logcmd(21)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(22)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If] -Address $ipAddress -Gateway $gatewayIp
            
            set igmpAttrs &#34;-under $deviceHndl&#34;
            if {$version == &#34;1&#34;} {
                append igmpAttrs &#34; -Version IGMP_V1&#34;
            } elseif {$version == &#34;2&#34;} {
                append igmpAttrs &#34; -Version IGMP_V2&#34;
            } elseif {$version == &#34;3&#34;} {
                append igmpAttrs &#34; -Version IGMP_V3&#34;
            } else {
                <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;setupIgmpServer: IGMP version $version not supported for STC&#34;
            }
            
            set igmpHostConfig [eval &#34;logcmd stc::create IgmpHostConfig [subst $igmpAttrs]&#34;]
            <a name="::logcmd(23)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $igmpHostConfig -usesif-Targets [<a name="::logcmd(24)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $deviceHndl -children-Ipv4If]
            foreach ip $groupIp {
                set ipv4Group [<a name="::logcmd(25)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv4Group -under [<a name="::logcmd(26)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get system1 -children-project]]
                <a name="::logcmd(27)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config [<a name="::logcmd(28)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ipv4Group -children-Ipv4NetworkBlock] -NetworkCount $numGroupIp -StartIpList $ip
                set igmpGroupMemberShip [<a name="::logcmd(29)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create IgmpGroupMembership -under $igmpHostConfig -FilterMode &#34;EXCLUDE&#34; -subscribedgroups-Targets $ipv4Group]
                <span class="comment-line">#             if {$reportMode == &#34;1&#34;} {</span>
                <span class="comment-line">#                set igmpGroupMemberShip [logcmd stc::create IgmpGroupMembership -under $igmpHostConfig -FilterMode &#34;INCLUDE&#34; -subscribedgroups-Targets $ipv4Group]</span>
                <span class="comment-line">#             } else {</span>
                <span class="comment-line">#                set igmpGroupMemberShip [logcmd stc::create IgmpGroupMembership -under $igmpHostConfig -FilterMode &#34;EXCLUDE&#34; -subscribedgroups-Targets $ipv4Group]</span>
                <span class="comment-line">#             }</span>
            }
            <a name="::logcmd(30)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
        }
        ixia -
        ixvm {
            
    set error_flag 0

    <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chas card port
    <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupIgmpServer: setting up IGMP server on port $txPortId&#34;

    protocolServer setDefault

    ipAddressTable clear
    ipAddressTable setDefault
    ipAddressTableItem setDefault
    ipAddressTableItem config -fromIpAddress $ipAddress
    ipAddressTableItem config -numAddresses $numIpAddr
    if {$tag != 0} {
           ipAddressTableItem config -enableVlan true
           ipAddressTableItem config -vlanId $tag
      }
    if {[ipAddressTableItem set]} {
        set error_flag 1
        <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IP Addr Table Item&#34;
    }

    if {[ipAddressTable addItem]} {
        set error_flag 1
        <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Add IP Address Table Item&#34;
    }
    ipAddressTable config -defaultGateway $gatewayIp
    if {[ipAddressTable set $chas $card $port]} {
        set error_flag 1
        <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IP Address Table&#34;
    }

    igmpServer setDefault
    igmpAddressTable clear
    igmpAddressTableItem setDefault
    foreach groupAddr $groupIp {
        igmpAddressTableItem config -fromClientAddress  $ipAddress
        igmpAddressTableItem config -fromGroupAddress   $groupAddr
        igmpAddressTableItem config -numClientAddresses $numIpAddr
        igmpAddressTableItem config -numGroupAddresses  $numGroupIp
        if {[igmpAddressTableItem set]} {
            set error_flag 1
            <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IGMP Addr Table Item&#34;
        }
        if {[igmpAddressTable addItem]} {
            set error_flag 1
            <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Add IGMP Address Table Item&#34;
        }
    }
    if {[igmpAddressTable set $chas $card $port]} {
        set error_flag 1
        <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IGMP Address Table&#34;
    }

    protocolServer config -enableIgmpQueryResponse    true
    protocolServer config -enableArpResponse true
    if [protocolServer set $chas $card $port] {
        set error_flag 1
        <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set Protocol Server&#34;
    }

    igmpServer config -enableQueryResponse      true
<span class="comment-line">#   igmpServer config -rate                     $rate</span>
    igmpServer config -repeatCount              $repeatCount
    igmpServer config -reportFrequency          $reportFrequency
    igmpServer config -reportMode               $reportMode
    igmpServer config -sendRouterAlert          false
    igmpServer config -version                  $version
    if {[igmpServer set $chas $card $port]} {
        set error_flag 1
        <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Can't Set IGMP Server&#34;
    }

    if {[protocolServer write $chas $card $port]} {
        <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ERROR: Unable to write protocolServer to h/w&#34;
        set error_flag 1
    }
        }
    }
   return $error_flag
}



<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: GetIGMPMessage</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to get the IGMP Messages from a frame received</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: rawFrame</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: IGMP Messages in ixia raw frame format</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     set igmpMsg [GetIGMPMessage $frame]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: CaptureTraffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::GetIGMPMessage_368">proc <a href="igmp.tcl-annot.html#::::GetIGMPMessage">::::GetIGMPMessage</a></a></strong> {rawFrame} {

   <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;rawFrame = $rawFrame&#34;
   set rtnMsg &#34;&#34;
   set type [string range $rawFrame 36 40]

   <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
   if {$type == &#34;81 00&#34;} {
     set leftRawFrame [string range $rawFrame 0 35]
     set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]]
     set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
   }

   set type [string range $rawFrame 36 40]
   <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the type $type&#34;
   if { $type == &#34;08 00&#34; } {
      set IpType [string range $rawFrame 69 70]
      if { $IpType == &#34;02&#34; } {
<span class="comment-line">#         result_debug &#34;rawFrame = $rawFrame&#34;</span>
         set macHdrLen 14
	 set ipHdrLen [expr ([string range $rawFrame 43 43] * 4)]
	 set igmpOffset [expr ($macHdrLen + $ipHdrLen) * 3]
	 set rtnMsg [string range $rawFrame $igmpOffset [string length $rawFrame]]
      }
   }
<span class="comment-line">#   result_debug &#34;igmpMsg: $rtnMsg&#34;</span>
   return $rtnMsg
}


<strong><a name="::::GetIGMPType_398">proc <a href="igmp.tcl-annot.html#::::GetIGMPType">::::GetIGMPType</a></a></strong> { igmpMsg } {
   if {[string length $igmpMsg] == 0} { 
      return &#34;NOT_IP_IGMP&#34;;
   }
   set type [string range $igmpMsg 0 1]
<span class="comment-line">#   set ip_version [string range $igmpMsg 0 0]</span>
   switch -glob -- $type \
      &#34;11&#34; {
         return &#34;IP_IGMPv2_QUERRY&#34;;
   }  &#34;12&#34; {
         return &#34;IP_IGMPv1_REPORT&#34;;
   }  &#34;16&#34; {
         return &#34;IP_IGMPv2_REPORT&#34;
   }  &#34;17&#34; {
         return &#34;IP_IGMPv2_LEAVE&#34;
   }  &#34;22&#34; {
         return &#34;IP_IGMPv3_REPORT&#34;
   }  default  {
         <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Unknown Type: IP_IGMP_$type&#34;
         return &#34;IP_IGMP_$type&#34;
   }
}

<strong><a name="::::GetIGMPQueryGroup_421">proc <a href="igmp.tcl-annot.html#::::GetIGMPQueryGroup">::::GetIGMPQueryGroup</a></a></strong> { igmpMsg } {
   return [<a name="::GetIPAddressOffset(1)"><a href="./MessageDecoding.tcl.html#::GetIPAddressOffset_885">::GetIPAddressOffset</a></a> $igmpMsg 12];
}

<strong><a name="::::CheckIGMPV3Query_425">proc <a href="igmp.tcl-annot.html#::::CheckIGMPV3Query">::::CheckIGMPV3Query</a></a></strong> { igmpMsg } {
       set maxResp [string range $igmpMsg 3 4]
       set qrv [string range $igmpMsg 25 25]
       set qqic [string range $igmpMsg 27 28]
       <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The values of maxResp: $maxResp,qrv: $qrv,qqic: $qqic&#34;
       if { ($maxResp == &#34;64&#34;) &amp;&amp; ($qrv == &#34;2&#34;) &amp;&amp; ($qqic == &#34;7D&#34;)} {
           <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Valid IGMPV3 packet received&#34;          
           <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;IGMPv3 general Querry with valid QRV: $qrv, QQIC: $qqic \
                      and max response time: $maxResp received&#34;
           <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
           return &#34;VALID_IGMPV3_QUERY&#34;

       }
   return &#34;INVALID_IGMPV3_QUERY&#34;
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: sendIgmpv3BadReport</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to send Bad IGMPv3 Reports</span>
<span class="comment-line">#</span>
<span class="comment-line">#     Note!! This used to be the original proc for sending v3 reports</span>
<span class="comment-line">#            but the ip header link was wrong and this started causing</span>
<span class="comment-line">#            problems.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: Send IGMPv3 Messages</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     sendIgmpv3BadReport -txPortId $host7 -hostIp $host7ip \</span>
<span class="comment-line">#                 -srcIpAddr &#34;$srcIp4&#34; -groupAddr $grpAddr1 \</span>
<span class="comment-line">#                 -reportType &#34;15&#34; -igmpMsgType &#34;33&#34;</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: Traffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::sendIgmpv3BadReport_462">proc <a href="igmp.tcl-annot.html#::::sendIgmpv3BadReport">::::sendIgmpv3BadReport</a></a></strong> {args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> sendIgmpv3BadReport $args {
   igmpMsgType &#34;34&#34;
   reportType &#34;1&#34;
   hostIp &#34;137.1.1.1&#34;
   srcIpAddr &#34;137.1.1.1&#34;
   groupAddr &#34;232.1.1.1&#34;
   txPortId  &#34;1&#34;
   numSource &#34;1&#34;
   numGroup &#34;1&#34;
   streamType &#34;stopStream&#34;
  } 

set type 0
set val3 &#34;{00 00 00 00}&#34;
set val4 &#34;{00 00 00 00}&#34;
set val5 &#34;{00 00 00 00}&#34;

set type $reportType
set multicastIP 224.0.0.22
set destMacMulticast [<a name="::GetMulticastMac(1)"><a href="./misc.tcl.html#::GetMulticastMac_605">::GetMulticastMac</a></a> $multicastIP]
<a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Host Address: $hostIp source address: $val5 Group Address: $val4&#34;

set dataPattern &#34;0$type 00 00 0$numSource&#34;
<a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;dataPattern $dataPattern&#34;
set udf &#34;true&#34;
set val1 &#34;{22 00}&#34;
set val2 &#34;{00 00 00 01}&#34;
set val3 &#34;{[<a name="::snmpConvertIpAddrFormat(1)"><a href="./snmpESRPLib.tcl.html#::snmpConvertIpAddrFormat_57">::snmpConvertIpAddrFormat</a></a> $groupAddr]}&#34;

if {$numSource ==0 } {
   set udfOffset  &#34;34 38 46&#34;
   set udfInitval &#34;$val1 $val2 $val3&#34;
   set udfCounterType &#34;c16 c32 c32&#34;
   set udfContinuousCount &#34;false false false&#34;
} else {
   set srcIpAddr1 [lindex $srcIpAddr 0]
   set srcIpAddr2 [lindex $srcIpAddr 1] 
   if {$srcIpAddr2 == &#34;&#34;} { set srcIpAddr2 &#34;0.0.0.0&#34; }
   
   <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;source1 $srcIpAddr1&#34;
   <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;source2 $srcIpAddr2&#34;

   set val4 &#34;{[<a name="::snmpConvertIpAddrFormat(2)"><a href="./snmpESRPLib.tcl.html#::snmpConvertIpAddrFormat_57">::snmpConvertIpAddrFormat</a></a> $srcIpAddr1]}&#34;
   set val5 &#34;{[<a name="::snmpConvertIpAddrFormat(3)"><a href="./snmpESRPLib.tcl.html#::snmpConvertIpAddrFormat_57">::snmpConvertIpAddrFormat</a></a> $srcIpAddr2]}&#34;
   set udfOffset  &#34;34 38 46 50 54&#34;
   set udfInitval &#34;$val1 $val2 $val3 $val4 $val5&#34;
   set udfCounterType &#34;c16 c32 c32 c32 c32&#34;
   set udfContinuousCount &#34;false false false false false&#34;
}

<a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Send an IGMPv3 report of type $type for source $srcIpAddr and \
              group $groupAddr&#34;

set frameSent [<a name="::SendIpFrame(1)"><a href="./ePTSendPacket.tcl.html#::SendIpFrame_587">::SendIpFrame</a></a> -txPortId $txPortId -protocol &#34;igmp&#34; -destIp $multicastIP -destMac $destMacMulticast -groupAddr $groupAddr -sourceIp $hostIp -streamType &#34;$streamType&#34; -frameRate 1 -udfEnable $udf -udfInitval $udfInitval -udfOffset $udfOffset -udfCountertype $udfCounterType -udfContinuousCount $udfContinuousCount -dataPattern $dataPattern]


<a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;IGMPSent: $frameSent&#34;
return $frameSent
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: sendIgmpv3Report</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc is used to send IGMPv3 Reports</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: Send IGMPv3 Reports</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#     sendIgmpv3BadReport -txPortId $host8 -hostIp $host8ip \</span>
<span class="comment-line">#                  -srcIpAddr &#34;$srcIp2&#34; -groupAddr $grpAddr1</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#     VerifySwitchOutput,VerifyTraffic)</span>
<span class="comment-line"># Category: Traffic</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::sendIgmpv3Report_539">proc <a href="igmp.tcl-annot.html#::::sendIgmpv3Report">::::sendIgmpv3Report</a></a></strong> {args} {
   <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> sendIgmpv3Report $args {
     txPortId &#34;1&#34;
     sourceMac &#34;00 A1 F1 00 00 01&#34;
     destMac &#34;01 00 5E 00 00 16&#34;
     hostIp &#34;127.0.0.1&#34;
     destIp &#34;224.0.0.22&#34;
     streamType &#34;stopStream&#34;
     numFrames &#34;1&#34;
     tag &#34;none&#34;
     tagMode &#34;vIdle&#34;
     tagRepeat &#34;1&#34;
     percentage &#34;1&#34;
     saMode &#34;idle&#34;
     daMode &#34;idle&#34;
     ipSaMode &#34;ipIdle&#34;
     ipDaMode &#34;ipIdle&#34;
     reportType &#34;1&#34;
     groupAddr &#34;224.0.0.22&#34;
     srcIpAddr &#34;{}&#34;
     igmpType  &#34;report&#34;
     maxResponseTime &#34;100&#34;
     qqic &#34;127&#34;
     qrv  &#34;0&#34;
     numSource &#34;1&#34;
     numGroup &#34;1&#34;
     fpsRate 0
   }
   global TrafficGen
   switch -exact -- $TrafficGen {
      
      stc {
puts &#34;IN STC CASES FOR IGMPv3&#34;
         array set aSettings $args
         set outin [parray aSettings]
         <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$outin&#34;           
         
         <span class="comment-line">#Stop generator before making changes.</span>
         <a name="::StopPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StopPortsTransmit_893">::StopPortsTransmit</a></a> $txPortId
         
         <span class="comment-line"># Delete all existing streamblocks.</span>
         set lsthStreamblocks [<a name="::logcmd(31)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get project1 -children-StreamBlock]
         foreach hStreamblock $lsthStreamblocks {
            <a name="::logcmd(32)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $hStreamblock
         }
         set lsthPorts [<a name="::logcmd(33)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get project1 -children-port]
         foreach hPort $lsthPorts {
            set lsthStreamblocks [<a name="::logcmd(34)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hPort -children-StreamBlock]
            foreach hStreamblock $lsthStreamblocks {
               <a name="::logcmd(35)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $hStreamblock
            }
         }
         <a name="::logcmd(36)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
         
         <span class="comment-line"># Retrieve the Spirent port handle.</span>
         set hPort [<a name="::hMapPortIdToSpirentPort(5)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
         
         <span class="comment-line"># Create the streamblock.</span>
         puts &#34;Configuring stream block ...&#34;
         if {![info exists frameSize]} {
            set frameSize 128
         }
         
         set hStreamBlock [<a name="::logcmd(37)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create streamBlock -under $hPort -insertSig false \
				  -frameConfig &#34;&#34; -frameLengthMode AUTO]
         
         <span class="comment-line"># Add an EthernetII Protocol Data Unit (PDU).</span>
         puts &#34;Adding Ethernet header&#34;
         if {![info exists sourceMac]} {
            <span class="comment-line">#set sourceMac 00:00:20:00:00:00</span>
            set sourceMac [<a name="::GetDefaultPortIdMAC(1)"><a href="./spirent.tcl.html#::GetDefaultPortIdMAC_417">::GetDefaultPortIdMAC</a></a> -portId $txPortId]
         }
         
         set destIpList [split $destIp .]
         <span class="comment-line">#set macAddr &#34;01:00:5e:[format %02x [expr [lindex $destIpList 1] &gt;&gt; 1]]:[lindex $destIpList 2]:[lindex $destIpList 3]&#34;</span>
         set macAddr &#34;01:00:5e:[format %02x [expr [lindex $destIpList 1] &gt;&gt; 1]]:[lindex $destIpList 2]:16&#34;
         set destMac $macAddr
         
         set hEthernet [<a name="::logcmd(38)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ethernet:EthernetII -under $hStreamBlock -name sb1_eth \
                           -srcMac $sourceMac \
                           -dstMac $destMac]
         
         <span class="comment-line"># Add an IP Protocol Data Unit (PDU).</span>
         puts &#34;Adding IP header&#34;
         if {![info exists sourceIp]} {
            set sourceIp 192.85.1.2
         }
         if {![info exists destIp]} {
            set destIp 225.0.0.1
         }
         
         
       <span class="comment-line">#  set hIpv4 [logcmd stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \</span>
       <span class="comment-line">#                -sourceAddr $sourceIp -destAddr $destIp]</span>


         set hIpv4 [<a name="::logcmd(39)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create ipv4:IPv4 -under $hStreamBlock -name sb1_ip \
                       -sourceAddr $hostIp -destAddr $destIp -ttl 1 -protocol 2]
         
       
       <span class="comment-line">#  set options [logcmd stc::create options -under $hIpv4]</span>
       <span class="comment-line">#  set ipv4HeaderOption1 [logcmd stc::create IPv4HeaderOption -under $options]</span>
       <span class="comment-line">#  logcmd stc::create rtrAlert -under $ipv4HeaderOption1</span>
       <span class="comment-line">#  set ipv4HeaderOption2 [logcmd stc::create IPv4HeaderOption -under $options]</span>
       <span class="comment-line">#  logcmd stc::create endOfOptlist -under $ipv4HeaderOption2</span>
         
         switch -exact -- $igmpType {
            
            &#34;query&#34; {
               <span class="comment-line"># IGMPv2 Query</span>
               puts &#34;STC In type query&#34;
               set hIgmp [<a name="::logcmd(40)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create igmp:Igmpv3Query -under $hStreamBlock -groupAddress $groupAddr -maxRespTime $maxResponseTime -qqic $qqic -qrv $qrv]
               if {[llength $srcIpAddr] &gt; 0} {
                  set addrList [<a name="::logcmd(41)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create addrList -under $Igmp]
                  for {set i 0} {$i &lt; [llength $srcIpAddr]} {incr i} {
                     <a name="::logcmd(42)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv4Addr -under $addrList -value [lindex $srcIpAddr $i]
                  }
               }
            }
            
            &#34;report&#34; {
               <span class="comment-line"># IGMPv3 Report</span>
               puts &#34;STC In type report&#34;
               set hIgmp [<a name="::logcmd(43)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create igmp:Igmpv3Report -under $hStreamBlock -numGrpRecords 1 -type 22]
               
               set grpRecordsObj [<a name="::logcmd(44)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create grpRecords -under $hIgmp]
               for {set i 0} {$i &lt; $numGroup} {incr i} {
                  set grpRecord [<a name="::logcmd(45)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create GroupRecord -under $grpRecordsObj -mcastAddr $groupAddr -recordType 1 -numSource [llength $srcIpAddr]]
                  if {[llength $srcIpAddr] &gt; 0} {
                     set addrList [<a name="::logcmd(46)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create addrList -under $grpRecord]
                     for {set k 0} {$k &lt; [llength $srcIpAddr]} {incr k} {
                        <a name="::logcmd(47)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Ipv4Addr -under $addrList -value [lindex $srcIpAddr $k]
                     }
                  }
                  
               }
               
            }
            default {
                puts &#34;STC missed all types&#34;
            }            
         }			
         
         if {[info exists $ipDaMode]} {
            set aSpirentMode(ipIncrHost) INCR
            
            <span class="comment-line"># Use modifier to generate multiple streams.</span>
            puts &#34;\nCreating Modifier on Stream Block&#34;
            set hRangeModifer1 [<a name="::logcmd(48)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create RangeModifier \
                                   -under $hStreamBlock \
                                   -ModifierMode $aSpirentMode($ipDaMode) \
                                   -Mask 255.255.255.255 \
                                   -StepValue 0.0.0.1 \
                                   -Data $destIp \
                                   -RecycleCount $ipDaCount \
                                   -RepeatCount 0 \
                                   -DataType NATIVE \
                                   -EnableStream false \
                                   -OffsetReference &#34;sb1_ip.destAddr&#34;]
         }
         
         if {![info exists numFrames]} {
            set numFrames 100
         }
         
         if {![info exists tag] || ($tag == &#34;none&#34;)} {
            set tag 0
         }
         
         if {($tag)} {
            <span class="comment-line"># Add a Vlan container object.</span>
            set hVlanContainer [<a name="::logcmd(49)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create vlans -under $hEthernet]
            
            <span class="comment-line"># Add a Vlan header to the container object.  </span>
            <span class="comment-line"># This is required since there can be multiple VLANs </span>
            <span class="comment-line"># as in Q-in-Q.  </span>
            <a name="::logcmd(50)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::create Vlan -under $hVlanContainer -pri 000 -cfi 0 -id $tag
         }
         
         <span class="comment-line"># Configure generator</span>
         puts &#34;Configuring Generator&#34;
         
         
         
         if {(![info exists streamType])} {
            set szDurationMode BURSTS
            set streamType &#34;stopStream&#34;
         } elseif {($streamType == &#34;stopStream&#34;)} {
            set szDurationMode BURSTS
         } else {
            set aDurationMode(contPacket) CONTINUOUS
            set szDurationMode $aDurationMode($streamType)
         }
         
         
         if {$fpsRate} {				
            set szLoadUnit FRAMES_PER_SECOND
            set szLoad $fpsRate
         } else {
            set szLoadUnit PERCENT_LINE_RATE
            set szLoad $percentage
         }
         
         set hGeneratorConfig [<a name="::logcmd(51)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::config $hPort.Generator.GeneratorConfig \
                                  -DurationMode $szDurationMode -BurstSize 1 \
                                  -Duration $numFrames -LoadMode FIXED \
                                  -FixedLoad $szLoad -LoadUnit $szLoadUnit]
         
         <span class="comment-line"># Apply changes.</span>
         <a name="::logcmd(52)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::apply
         
         <a name="::StartPortsTransmit(1)"><a href="./ePTRx.tcl.html#::StartPortsTransmit_922">::StartPortsTransmit</a></a> $txPortId
         
         
         
         <span class="comment-line">#set szFrameContents [GetFrameContentsFromStreamblock $hStreamBlock]</span>
         <a name="::logcmd(53)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform GetPreviewData -StreamBlock $hStreamBlock
         set szFrameContents [<a name="::logcmd(54)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get [<a name="::logcmd(55)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $hStreamBlock -children-PreviewData] -HexData]
         puts &#34;test packet view: [<a name="::getFrameContents(1)"><a href="./spirent.tcl.html#::getFrameContents_3204">::getFrameContents</a></a> $hStreamBlock igmp]&#34;
         <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;igmpv3: $szFrameContents&#34;
         return $szFrameContents
      }
      ixia -
      ixvm {
         
   if {$tag == &#34;none&#34;} {
       set tagged &#34;false&#34;
   } else {
       set tagged &#34;true&#34;
   }
   <a name="::createStreams(1)"><a href="./ePTStreams.tcl.html#::createStreams_80">::createStreams</a></a> -portn $txPortId -startId 1 -endId 1 -name S1 -type &#34;ipv4_igmp&#34; -writeToHw 0
   set optionsList &#34;&#34;
   lappend optionsList &#34;enable802dot1qTag $tagged&#34;
   <a name="::setStreamOptions(1)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;protocol&#34; \
         -optionVal $optionsList -writeToHw 0

   if {$tagged == &#34;true&#34;} {
       set optionsList &#34;&#34;
       lappend optionsList &#34;vlanID $tag&#34;
       lappend optionsList &#34;mode $tagMode&#34;
       lappend optionsList &#34;repeat $tagRepeat&#34;
       lappend optionsList &#34;step 1&#34;
       <a name="::setStreamOptions(2)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;vlan&#34; \
             -optionVal $optionsList -writeToHw 0
   }
   set optionsList &#34;&#34;
   lappend optionsList &#34;sa \&#34;$sourceMac\&#34;&#34;
   lappend optionsList &#34;frameType \&#34;81 00\&#34;&#34;
   lappend optionsList &#34;enable true&#34;
   if $fpsRate {
   lappend optionsList &#34;fpsRate $fpsRate&#34;
   lappend optionsList &#34;rateMode streamRateModeFps&#34;
   } else {
   lappend optionsList &#34;rateMode usePercentRate&#34;
   lappend optionsList &#34;percentPacketRate $percentage&#34;
   }
   lappend optionsList &#34;da \&#34;$destMac\&#34;&#34;
   lappend optionsList &#34;dma $streamType&#34;
   lappend optionsList &#34;dataPattern 1&#34;
   lappend optionsList &#34;numFrames $numFrames&#34;
   <a name="::setStreamOptions(3)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;stream&#34; \
         -optionVal $optionsList -writeToHw 0

   set optionsList &#34;&#34;
   lappend optionsList &#34;sourceIpAddr \&#34;$hostIp\&#34;&#34;
   lappend optionsList &#34;sourceIpAddrMode $ipSaMode&#34;
   lappend optionsList &#34;sourceIpAddrRepeatCount $numFrames&#34;
   lappend optionsList &#34;destIpAddr \&#34;$destIp\&#34;&#34;
   lappend optionsList &#34;destIpAddrMode $ipDaMode&#34;
   lappend optionsList &#34;destIpAddrRepeatCount $numFrames&#34;
   lappend optionsList &#34;ttl 1&#34;
<span class="comment-line">#   lappend optionsList &#34;options 94040000&#34;</span>
   lappend optionsList &#34;qosMode 1&#34;
   lappend optionsList &#34;dscpMode 0&#34;
<span class="comment-line">#   lappend optionsList &#34;dscpValue C0&#34;</span>
<span class="comment-line">#   lappend optionsList &#34;fragment 1&#34;</span>
   <a name="::setStreamOptions(4)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;ip&#34; \
         -optionVal $optionsList -writeToHw 0

   if {$igmpType == &#34;query&#34;} {
       set sFlag &#34;true&#34;
       set igmpType &#34;membershipQuery&#34;
   } else {
       set sFlag &#34;false&#34;
       set igmpType &#34;membershipReport3&#34;
   }
   
   set optionsList &#34;&#34;
   lappend optionsList &#34;type $igmpType&#34;
   lappend optionsList &#34;version igmpVersion3&#34;
   lappend optionsList &#34;qqic $qqic&#34;
   lappend optionsList &#34;qrv  $qrv&#34;
   lappend optionsList &#34;maxResponseTime $maxResponseTime&#34;
   lappend optionsList &#34;igmpGroupRecordtype $reportType&#34;
   lappend optionsList &#34;igmpGroupmulticastAddress $groupAddr&#34;
   lappend optionsList &#34;igmpGroupsourceIpAddressList {\&#34;$srcIpAddr\&#34;}&#34;
   <a name="::setStreamOptions(5)"><a href="./ePTStreams.tcl.html#::setStreamOptions_188">::setStreamOptions</a></a> -portn $txPortId -startId 1 -endId 1 -type &#34;igmp&#34; \
         -optionVal $optionsList -writeToHw 0
   
   <a name="::WriteStreamsToHw(1)"><a href="./ePTStreams.tcl.html#::WriteStreamsToHw_161">::WriteStreamsToHw</a></a> $txPortId
   <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2

   <a name="::displayIGMPv3PacketFormat(1)"><a href="./frameFormat.tcl.html#::displayIGMPv3PacketFormat_564">::displayIGMPv3PacketFormat</a></a>  -txPortId &#34;$txPortId&#34; \
     -sourceMac &#34;$sourceMac&#34; \
     -destMac &#34;$destMac&#34; \
     -hostIp &#34;$hostIp&#34; \
     -destIp &#34;$destIp&#34; \
     -streamType &#34;$streamType&#34; \
     -numFrames &#34;$numFrames&#34; \
     -tag &#34;$tag&#34; \
     -tagMode &#34;$tagMode&#34; \
     -tagRepeat &#34;$tagRepeat&#34; \
     -percentage &#34;$percentage&#34; \
     -saMode &#34;$saMode&#34; \
     -daMode &#34;$daMode&#34; \
     -ipSaMode &#34;$ipSaMode&#34; \
     -ipDaMode &#34;$ipDaMode&#34; \
     -reportType &#34;$reportType&#34; \
     -groupAddr &#34;$groupAddr&#34; \
     -srcIpAddr &#34;{$srcIpAddr}&#34; \
     -igmpType  &#34;$igmpType&#34; \
     -maxResponseTime &#34;$maxResponseTime&#34; \
     -qqic &#34;$qqic&#34; \
     -qrv  &#34;$qrv&#34;

   <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId ixChassis ixCard ixPort
   set streamSent [<a name="::stream(1)"><a href="./ePTClient.tcl.html#::stream_565">::stream</a></a> cget -packetView]
   <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$streamSent&#34;

   <a name="::StartPortsTransmit(2)"><a href="./ePTRx.tcl.html#::StartPortsTransmit_922">::StartPortsTransmit</a></a> $txPortId
      }
   }  
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
