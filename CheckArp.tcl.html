<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>CheckArp.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#CheckArp.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>CheckArp.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="CheckArp.tcl-annot.html">annotations</a> | <a href="CheckArp.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc can be used to verify an ARP reply. Given a replySendHwAddr,</span>
<span class="comment-line">#     it analyses the ArpReply and reports success/failure.</span>
<span class="comment-line">#     it receives the reply on Tx port(from where ARP request is sent).</span>
<span class="comment-line">#     It also start capture on test equipment, so caller does not have to </span>
<span class="comment-line">#     start capture. If replySendHwAddr is &#34;none&#34;, it assumes that txPortId</span>
<span class="comment-line">#     does not receive any ARP reply.</span>
<span class="comment-line"># Input args: txPortId, rxPortId, dIpAddr, sIpAddr, replySendHwAddr,</span>
<span class="comment-line">#              filePt, numArpFrames, tag, sMacAddr, dMacAddr</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># CheckArpReply -txPortId 3 -dIpAddr 10.10.1.55 -sIpAddr 10.10.2.200 \</span>
<span class="comment-line">#                -replySendHwAddr &#34;$cookedDutMac&#34; \</span>
<span class="comment-line">#                -rxPortId 1 -filePt $fd_res -numArpFrames $nArpFrames</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: VerifyTraffic</span>
<span class="comment-line">##################################################################    </span>
<strong><a name="::::CheckArpReply_22">proc <a href="CheckArp.tcl-annot.html#::::CheckArpReply">::::CheckArpReply</a></a></strong> {args} {
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckArpReply $args {
        txPortId &#34;1&#34;
        rxPortId &#34;0&#34;  ;<span class="comment-line">#default not sending learn arp, otherwise use this port as the 2nd arp port</span>
        sMacAddr &#34;default&#34;
        dMacAddr &#34;FF:FF:FF:FF:FF:FF&#34;
        sIpAddr &#34;127.0.0.1&#34;
        dIpAddr &#34;127.0.0.1&#34;
        srcHwAddr &#34;default&#34;
        replySendHwAddr &#34;none&#34;
        percentage &#34;100&#34;
        numArpFrames &#34;1&#34;
        filePt &#34;NULL&#34;
        tag &#34;none&#34;
        comment &#34;&#34;
    }
    global TrafficGen
    set rc 0
  
   switch -exact -- $TrafficGen {
        stc -
        ixvm -
        ixia {
            <span class="comment-line"># Setup the tag field first</span>
            if {$tag == &#34;none&#34;} {
                set wTag false
                set tagNo &#34;002&#34;
            } else {
                set wTag true
                set tagNo $tag
            }

            <span class="comment-line"># Get the maximum port number in use</span>
            if {$txPortId &gt; $rxPortId} {
                set maxPorts $txPortId
            } else {
                set maxPorts $rxPortId
            }

            set numIxiaCd [<a name="::::GetNumIxiaCd(1)"><a href="./SystemSetup.tcl.html#::::GetNumIxiaCd_546">::::GetNumIxiaCd</a></a> $maxPorts]
            global startCardNum
            set pPattern &#34;abcd&#34;   

            <span class="comment-line">#map portId to Ixia port</span>
            if {$rxPortId == $txPortId} {
                <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Invalid port specification: txPortId=rxPortId&#34;
                return
            }
            <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId txChas txCard txPort
            if {$rxPortId == 0} {
                <span class="comment-line">#then just choose some random port different the txPort</span>
                if {$txPortId == 1} {
                    <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> 2 rxChas rxCard rxPort
                } else {
                    <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> 1 rxChas rxCard rxPort
                }
            } else {
                <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $rxPortId rxChas rxCard rxPort
            }

            <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;ARP REPLY check on Txport $txPortId $comment&#34;
            <span class="comment-line"># Disable protocol server on txPort by default unless rx != 0</span>
            if {$rxPortId &gt; 0} {
                if {$TrafficGen != &#34;ept&#34;} {
                    <a name="::SaveAndSetProtocolServer(1)"><a href="./ixiaProtSrv.tcl.html#::SaveAndSetProtocolServer_1235">::SaveAndSetProtocolServer</a></a> $rxPortId $dIpAddr $dIpAddr ixInfo \
                        -arpService true
                }
            }

            <span class="comment-line">#Configure interface for collection</span>
            <span class="comment-line">#</span>
            <span class="comment-line"># EY-02-28-2013: Replace per-card operations with per-port operations.</span>
            <span class="comment-line">#ixiaConf_clearStat $txCard</span>
            <span class="comment-line">#ixiaStartCaptureCards $numIxiaCd $startCardNum  </span>
            <a name="::ClearPortsStats(1)"><a href="./ePTRx.tcl.html#::ClearPortsStats_951">::ClearPortsStats</a></a> $txPortId;
            <a name="::StartPortsCapture(1)"><a href="./ePTRx.tcl.html#::StartPortsCapture_820">::StartPortsCapture</a></a> $txPortId;

            <span class="comment-line">#send a packet</span>
            set frameSent [<a name="::ixiaConf_2Ports_arp(1)"><a href="./ePTL3Tx.tcl.html#::ixiaConf_2Ports_arp_582">::ixiaConf_2Ports_arp</a></a> -numIxiaCd $numIxiaCd \
                -startCardNum $startCardNum -txChas $txChas -txCard $txCard -txPort $txPort \
                -rxChas $txChas -rxCard $rxCard -rxPort $rxPort  \
                -sMacAddr $sMacAddr -dMacAddr $dMacAddr -srcHwAddr $srcHwAddr \
                -wTag $wTag -tagNo $tagNo -percentage &#34;$percentage&#34; \
                -sIpAddr $sIpAddr -dIpAddr $dIpAddr -numFrames $numArpFrames]
            <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;FrameSentARP: $frameSent&#34;

            <span class="comment-line">#</span>
            <span class="comment-line"># EY-02-28-2013: Stop capturing.</span>
            <a name="::StopPortsCapture(1)"><a href="./ePTRx.tcl.html#::StopPortsCapture_862">::StopPortsCapture</a></a> $txPortId;
        }
        default {
        }
   }

   
    <span class="comment-line">#retrieve data from ixia</span>
    <span class="comment-line">#find how many expected packets was received</span>
    set numPacketReceived -255

    <span class="comment-line">#</span>
    <span class="comment-line"># EY-02-28-2013: Replace call to ixiaCaptureOnePort with call to</span>
    <span class="comment-line"># GetCapturedFrames.</span>
    <span class="comment-line">#set rawPortData [ixiaCaptureOnePort $txChas $txCard $txPort $filePt]	 ;# check forwarding</span>
    set rawPortData [<a name="::GetCapturedFrames(1)"><a href="./ePTRx.tcl.html#::GetCapturedFrames_982">::GetCapturedFrames</a></a> $txPortId];
    foreach frame $rawPortData {
        <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Frames received on portId $txPortId:&#34;
        <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frame&#34;

        <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;senderMacAddress:[<a name="::GetSenderMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSenderMacAddress_62">::GetSenderMacAddress</a></a> $frame]&#34;
        <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;sIPRecv: [<a name="::GetSourceIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frame] sIPSent: [<a name="::GetSourceIPAddress(2)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frameSent]&#34;
        <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;dIPRecv: [<a name="::GetDestIPAddress(1)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frame] dIPSent: [<a name="::GetDestIPAddress(2)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frameSent] and message type [<a name="::GetMessageType(1)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $frame]&#34;
        if {[<a name="::GetMessageType(2)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $frame] == &#34;ARP_REPLY&#34;} {
            if {$numPacketReceived==-255} {
                set numPacketReceived 0
            }
            if {([<a name="::GetSourceIPAddress(3)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frame] == $dIpAddr) &amp;&amp; \
              ([<a name="::GetDestIPAddress(3)"><a href="./MessageDecoding.tcl.html#::GetDestIPAddress_447">::GetDestIPAddress</a></a> $frame] == [<a name="::GetSourceIPAddress(4)"><a href="./MessageDecoding.tcl.html#::GetSourceIPAddress_411">::GetSourceIPAddress</a></a> $frameSent]) &amp;&amp; \
              ([<a name="::GetSenderMacAddress(2)"><a href="./MessageDecoding.tcl.html#::GetSenderMacAddress_62">::GetSenderMacAddress</a></a> $frame] == $replySendHwAddr) &amp;&amp; \
              ([<a name="::GetTargetMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetTargetMacAddress_159">::GetTargetMacAddress</a></a> $frame] == [<a name="::GetSourceMacAddress(1)"><a href="./MessageDecoding.tcl.html#::GetSourceMacAddress_40">::GetSourceMacAddress</a></a> $frameSent] || \
              [<a name="::GetTargetMacAddress(2)"><a href="./MessageDecoding.tcl.html#::GetTargetMacAddress_159">::GetTargetMacAddress</a></a> $frame] == [<a name="::cookMacForIxia(1)"><a href="./misc.tcl.html#::cookMacForIxia_61">::cookMacForIxia</a></a> $srcHwAddr])} {
                incr numPacketReceived 1
            }
        }
        <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numPacketReceived= $numPacketReceived&#34;
    }

    if {$rxPortId &gt; 0} {
        if {$TrafficGen != &#34;ept&#34;} { 
            <a name="::RestoreSavedProtocolServer(1)"><a href="./ixiaProtSrv.tcl.html#::RestoreSavedProtocolServer_1346">::RestoreSavedProtocolServer</a></a> ixInfo
        }
    }

    <span class="comment-line">#now check received data against checkList to see if matched</span>
    set testResult &#34;good&#34;

    if {($numPacketReceived == $numArpFrames) &amp;&amp; \
      ($replySendHwAddr != &#34;none&#34;)} {
        <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ARP_REPLY on txport $txPort checked Okay.&#34;
    } elseif {($numPacketReceived!=$numArpFrames) &amp;&amp; ($numPacketReceived==-255) &amp;&amp; \
      ($replySendHwAddr == &#34;none&#34;)} {
        <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ARP_REPLY on txport $txPort check okay. Got $numPacketReceived replies.&#34;
    } elseif {$numPacketReceived &gt;= 1} {
        <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ARP_REPLY on txport $txPort check okay. Got at least $numPacketReceived replies.&#34;
    } else {
        <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ARP_REPLY failed on port $txPort.&#34;
        <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;numPacketReceived= $numPacketReceived BUT expectedPackets= $numArpFrames&#34;
        set testResult &#34;bad&#34;
    }
    if {$testResult == &#34;good&#34;} {
        <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;ARP_REPLY Check passed&#34;
        set rc 1  
    } else {
        <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ARP_REPLY Check failed&#34;
        set rc 0
    }
    <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a> 

    return $rc
}


<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc can be used to enable arp protocol server on</span>
<span class="comment-line">#     a number of given ixia ports. This proc accepts a portIdList and</span>
<span class="comment-line">#     ipAddressList. Make sure number of elements are same in 2 lists.</span>
<span class="comment-line">#     It does not perform any other tasks.</span>
<span class="comment-line">#     Caller should separately call DisableProtocolServer after done.</span>
<span class="comment-line"># Input args: portIdList, ipAddressList</span>
<span class="comment-line"># Optional Input args: taglist, pingEnable, gwIpList, nwrangelist, numAddr, netMask, clearinter</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># returns : 1 (success), 0 (failure)</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># if [EnableProtocolServer portIdList ipAddressList] {</span>
<span class="comment-line">#    puts &#34;Success&#34;</span>
<span class="comment-line"># } else {</span>
<span class="comment-line">#    puts &#34;failure&#34;</span>
<span class="comment-line"># }</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line"># Note : If the &#34;clearinter&#34; argument is provided with  &#34;noclear&#34; input, then Multiple </span>
<span class="comment-line">#        Ipv4 Interface can be configured in that port</span>
<span class="comment-line">##################################################################    </span>
<strong><a name="::::EnableProtocolServer_207">proc <a href="CheckArp.tcl-annot.html#::::EnableProtocolServer">::::EnableProtocolServer</a></a></strong> {portIdList ipAddressList {taglist &#34;none&#34;} {pingEnable &#34;false&#34;} \
                          {gwIpList &#34;0.0.0.0&#34;} {nwrangelist &#34;none&#34;} {numAddr 1} {netMask 24} {clearinter &#34;clear&#34;} } {

    <span class="comment-line">##############</span>
    set ResetInter 1
    if {$clearinter == &#34;noclear&#34;} {
        set ResetInter 0
    } else {
        set ResetInter 1
    }
    <span class="comment-line">#############</span>

    global TrafficGen
    if {$nwrangelist == &#34;none&#34; } {
        if {[llength $portIdList] != [llength $ipAddressList]} {
            <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Number of list elements do not match.&#34;
            return 0
        }    
        set listlen  [llength $portIdList]
    } else {
        set listlen  [llength $ipAddressList]
    } 

    switch -exact -- $TrafficGen {
        stc {
           <a name="::result_warning(1)"><a href="./ql_multi.tcl.html#::result_warning_407">::result_warning</a></a> &#34;THIS CODE SHOULD NOT RUN&#34;
           return 0
        }
        ept {
        }
        default {
        }
    }

    for {set i 0} {$i &lt; $listlen } {incr i} {
        if {$nwrangelist == &#34;none&#34; } {
            set portId [lindex $portIdList $i]
            set tag $taglist 
        } else {
            set portId $portIdList 
            set tag  [lindex $taglist $i]
        }
        set ipAddress [lindex $ipAddressList $i]
        set gwIp [lindex $gwIpList $i]
        if {$gwIp == &#34;&#34;} {set gwIp &#34;0.0.0.0&#34;} 

        <a name="::MapIxiaPortId(5)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port
        if [<a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port] {
            error &#34;port $chas,$card,$port not configured yet!&#34;
        }

        set cookedMac [<a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]

        <span class="comment-line"># Add the IP address to the IP address table for the port.</span>
        if {[ipAddressTable get $chas $card $port]} {
            error &#34;EnableProtocolServer: ipAddressTable get $chas $card $port failed.&#34;
        }

        ipAddressTableItem setDefault

        <span class="comment-line"># Only add the IP address if it isn't already there.</span>
        if {[ipAddressTable getItem $ipAddress]} {
            ipAddressTableItem config -fromIpAddress $ipAddress
            ipAddressTableItem config -overrideDefaultGateway true
            ipAddressTableItem config -gatewayIpAddress $gwIp                   
            if {[<a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port]} {
                error &#34;EnableProtocolServer: port get $chas $card $port failed.&#34;
            }
            ipAddressTableItem config -fromMacAddress $cookedMac
            ipAddressTableItem           config            -numAddresses   $numAddr
            ipAddressTableItem config -enableUseNetwork true
            ipAddressTableItem config -netMask $netMask
            if {$tag != &#34;none&#34;} {
                <span class="comment-line"># Tag is only available in 3.65</span>
                if {![regexp -nocase &#34;3.50&#34; [<a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a> cget -installVersion]]} {
                    ipAddressTableItem config -enableVlan true
                    ipAddressTableItem config -vlanId $tag
                }
            }
            ipAddressTableItem set

            if {$nwrangelist == &#34;none&#34; } {
                if {[ipAddressTable addItem]} {
                    error &#34;EnableProtocolServer: ipAddressTable addItem failed.&#34;
                }
            } else {
                ipAddressTable addItem
            }
            if {[ipAddressTable set $chas $card $port]} {
                error &#34;EnableProtocolServer: ipAddressTable set $chas $card $port failed.&#34;
            }
        }

        if {$nwrangelist != &#34;none&#34; } {
            arpServer                    setDefault        
            arpServer  config   -mode      2
            arpServer                    set               $chas $card $port
        }
        interfaceTable               select            $chas $card $port
        if {$ResetInter == 1} {
            interfaceTable               clearAllInterfaces
        }
        interfaceIpV4          setDefault
        interfaceIpV4          config        -gatewayIpAddress $gwIp
        interfaceIpV4          config        -maskWidth 24
        interfaceIpV4          config        -ipAddress  $ipAddress
        interfaceEntry         addItem        addressTypeIpV4                     
        interfaceEntry         setDefault        
        interfaceEntry         config        -enable                     true
        interfaceEntry         config        -description                &#34;$ipAddress/24 - $card:$port&#34;
        interfaceEntry         config        -macAddress                 &#34;[<a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]&#34;
        interfaceEntry         config        -vlanPriority               0

        if {$tag != &#34;none&#34;} {
            interfaceEntry     config        -enableVlan                 true
            interfaceEntry     config        -vlanId                     $tag
        } else {
            interfaceEntry     config        -enableVlan                 false
            interfaceEntry     config        -vlanId                     0
        }
        interfaceTable         addInterface      
        interfaceEntry         clearAllItems     addressTypeIpV6
        interfaceEntry         clearAllItems     addressTypeIpV4


        <span class="comment-line"># Modify protocol server flags.</span>
        if {[protocolServer get $chas $card $port]} {
            error &#34;EnableProtocolServer: protocolServer get $chas $card $port failed.&#34;
        }
        protocolServer config -enableArpResponse true
        if {$pingEnable != &#34;false&#34;} {
            protocolServer config -enablePingResponse true 
        }
        if {[protocolServer set $chas $card $port]} {
            error &#34;EnableProtocolServer: protocolServer set $chas $card $port failed.&#34;
        }
        if {[protocolServer write $chas $card $port]} {
            error &#34;EnableProtocolServer: protocolServer write $chas $card $port failed.&#34;
        }
   } ;<span class="comment-line"># for</span>
   
   return 1
} ;<span class="comment-line"># EnableProtocolServer</span>


<span class="comment-line">##################################################################    </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#     This proc can be used to disable arp protocol server on</span>
<span class="comment-line">#     a number of given ixia ports. This proc accepts a portIdList.</span>
<span class="comment-line">#     Make sure number of elements are same in 2 lists.</span>
<span class="comment-line"># Input args: portIdList</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># returns : 1 (success), 0 (failure)</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line"># if [DisableProtocolServer $portIdList] {</span>
<span class="comment-line">#    puts &#34;Success&#34;</span>
<span class="comment-line"># } else {</span>
<span class="comment-line">#    puts &#34;failure&#34;</span>
<span class="comment-line"># }</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (SetupSwitch,GetSwitchInfo,SendTraffic,CaptureTraffic,</span>
<span class="comment-line">#                 SetupTestTool,VerifySwitchOutput,Utility,VerifyTraffic)</span>
<span class="comment-line"># Category: SetupTestTool</span>
<span class="comment-line">##################################################################    </span>
<strong><a name="::::DisableProtocolServer_371">proc <a href="CheckArp.tcl-annot.html#::::DisableProtocolServer">::::DisableProtocolServer</a></a></strong> {portIdList ipAddressList} {
    global TrafficGen

    if {[llength $ipAddressList] &gt; 0 &amp;&amp;
      [llength $ipAddressList] != [llength $portIdList]} {
        <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Number of list elements do not match.&#34;
        return 0
    }

    switch -exact -- $TrafficGen {
        stc {
            return 1
        }
        ept {
        }
        default {
        }
    }

    for {set i 0} {$i &lt; [llength $portIdList]} {incr i} {
        set portId [lindex $portIdList $i]

        <a name="::MapIxiaPortId(6)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port

        <span class="comment-line"># Clean up the IP address table.</span>
        if {[llength $ipAddressList] &gt; 0} {
            set ipAddress [lindex $ipAddressList $i]

            ipAddressTable setDefault
            ipAddressTableItem setDefault

            if {[ipAddressTable get $chas $card $port]} {
                error &#34;DisableProtocolServer: ipAddressTable get $chas $card $port failed.&#34;
            }
            if {![ipAddressTable getItem $ipAddress]} {
                if {[ipAddressTable delItem]} {
                    error &#34;DisableProtocolServer: ipAddressTable delItem failed.&#34;
                }
                if {[ipAddressTable set $chas $card $port]} {
                    error &#34;DisableProtocolServer: ipAddressTable set $chas $card $port failed.&#34;
                }
            }
        }
        <span class="comment-line">#----added loop to verify the ipaddress on the intf is v4 or v6</span>
        if {![<a name="::IsValidIpAddress(1)"><a href="./misc.tcl.html#::IsValidIpAddress_2124">::IsValidIpAddress</a></a> $ipAddress]} {
            set mask &#34;64&#34;
        } else {
            set mask &#34;24&#34;
        }
        <span class="comment-line">#-----This will delete the interface table</span>
        interfaceTable select $chas $card $port
        interfaceTable getInterface &#34;$ipAddress/$mask - $card:$port&#34;
        interfaceTable delInterface &#34;$ipAddress/$mask - $card:$port&#34;
        interfaceTable write


        <span class="comment-line">#this will keep the previous configuration, but just disable arp and ping</span>
        if {[protocolServer get $chas $card $port]} {
            error &#34;DisableProtocolServer: protocolServer get $chas $card $port failed.&#34;
        }
        protocolServer config -enableArpResponse false
        protocolServer config -enablePingResponse false 
        if {[protocolServer set $chas $card $port]} {
            error &#34;DisableProtocolServer: protocolServer set $chas $card $port failed.&#34;
        }
        if {[protocolServer write $chas $card $port]} {
            error &#34;DisableProtocolServer: protocolServer write $chas $card $port failed.&#34;
        }
    } ;<span class="comment-line"># for</span>

    return 1
} ;<span class="comment-line"># DisableProtocolServer</span>


;<span class="comment-line">#################################################################</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># RestoreProtocolServer</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># This function will restore the state of the ARP, and optionally,</span>
;<span class="comment-line"># the PING protocol servers to the states specified.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Input variables: Variables in []'s are optional.</span>
;<span class="comment-line">#     portIdList: The logical port numbers to operate on.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     ipAddressList: The IP addresses, one per port, assigned to</span>
;<span class="comment-line">#                    the protocol servers.  These addresses will</span>
;<span class="comment-line">#                    be removed from the IP address tables on the</span>
;<span class="comment-line">#                    IXIA.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#                    Note: The number of IP addresses in this</span>
;<span class="comment-line">#                    list must match the number of port numbers</span>
;<span class="comment-line">#                    specified in portIdList.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     arpEnable: Specifies whether the ARP protocol server is to</span>
;<span class="comment-line">#                be enabled or disabled.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     [pingEnable=&#34;&#34;]: Specifies whether the PING protocol is to</span>
;<span class="comment-line">#                      be enabled or disabled.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     Note: Below is a list of acceptable values and their meanings</span>
;<span class="comment-line">#     for both arpEnable and pingEnable,  Other values will cause</span>
;<span class="comment-line">#     unspecified behavior.</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#         0, false: Disable the protocol server.</span>
;<span class="comment-line">#         1, true: Enable the protocol server.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Output variables: None.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Return value: None.</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Typical usage:</span>
;<span class="comment-line">#     set txPort 3</span>
;<span class="comment-line">#     set txIpAddress 1.1.3.3</span>
;<span class="comment-line">#     GetProtocolServerInfo $txPort -arpService arpOnOrOff</span>
;<span class="comment-line">#     if {$arpOnOrOff} {</span>
;<span class="comment-line">#         result_debug &#34;ARP server is enabled.&#34;</span>
;<span class="comment-line">#     } else {</span>
;<span class="comment-line">#         result_debug &#34;ARP server is disabled.&#34;</span>
;<span class="comment-line">#     }</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#     # Enable the ARP protocol server.</span>
;<span class="comment-line">#     EnableProtocolServer $txPort $txIpAddress</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     # Do other stuff here.</span>
;<span class="comment-line">#     ...</span>
;<span class="comment-line">#     # Restore the ARP protocol server to its former state.</span>
;<span class="comment-line">#     RestoreProtocolServer $txPort $txIpAddress $arpOnOrOff</span>
;<span class="comment-line">#</span>
;<span class="comment-line"># Category: SetupTestTool</span>
;<span class="comment-line">#</span>
;<span class="comment-line">#################################################################</span>
<strong><a name="::::RestoreProtocolServer_502">proc <a href="CheckArp.tcl-annot.html#::::RestoreProtocolServer">::::RestoreProtocolServer</a></a></strong> {portIdList ipAddressList arpEnable {pingEnable &#34;&#34;}} {
    if {[llength $portIdList] != [llength $ipAddressList]} {
       <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Number of list elements do not match.&#34;
       return
    }

    global TrafficGen
    switch -exact -- $TrafficGen {
        agilent {
            return 0
        }
        stc {
        }
        ept {
        }
        default {
        }
    }

    for {set i 0} {$i &lt; [llength $portIdList]} {incr i} {
        set portId [lindex $portIdList $i]
        set ipAddress [lindex $ipAddressList $i]

        <a name="::MapIxiaPortId(7)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $portId chas card port

        ipAddressTable setDefault
        ipAddressTableItem setDefault

        if {[ipAddressTable get $chas $card $port]} {
            error &#34;RestoreProtocolServer: ipAddressTable get $chas $card $port failed.&#34;
        }
        if {![ipAddressTable getItem $ipAddress]} {
            if {[ipAddressTable delItem]} {
                error &#34;RestoreProtocolServer: ipAddressTable delItem failed.&#34;
            }
            if {[ipAddressTable set $chas $card $port]} {
                error &#34;RestoreProtocolServer: ipAddressTable set $chas $card $port failed.&#34;
            }
        }

        <a name="::SetProtocolServerInfo(1)"><a href="./ixiaProtSrv.tcl.html#::SetProtocolServerInfo_209">::SetProtocolServerInfo</a></a> $portId -arpService $arpEnable -pingService $pingEnable
    } ;<span class="comment-line"># for</span>
} ;<span class="comment-line"># RestoreProtocolServer</span>

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
