<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>logout.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#logout.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>logout.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="logout.tcl-annot.html">annotations</a> | <a href="logout.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">#load {expect52.dll}</span>
set auto_path [linsert $auto_path 0 . ]

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: logout</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that logout os the current DUT without saving the config.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: fd -   file discriptor</span>
<span class="comment-line">#             save - save answer  y or n,  n is the default</span>
<span class="comment-line">#             closeSession - close the telnet session to the console   true/false true def.</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             logout</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::logout_21">proc <a href="logout.tcl-annot.html#::::logout">::::logout</a></a></strong> {{fd &#34;NULL&#34;} args} {
    global spawn_id
    global spawn_ids
    global hostname
    global logoutTimeout

    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> logout $args {
        save          &#34;n&#34;
        closeSession  &#34;true&#34;
    }

    send &#34;logout\r&#34;
    if {[info exist logoutTimeout]} {
        set timeout $logoutTimeout
    } else {
        set timeout 60
    }

    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Try to Logout&#34;
    <span class="comment-line">#exp_internal 1</span>
    expect {
        timeout {
            <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;!!!logout:Can't logout!!!&#34;
        }
        -nocase &#34;\? (y/n)&#34; {
            <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$expect_out(buffer)&#34;
            <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Send N to skip Save&#34;
            exp_send &#34;$save\r&#34;
            expect {
                timeout {
                    <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;!!!logout:Can't logout!!!&#34;
                }
                eof {
                    set idcleared 0
                    <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Connection Closed!!!&#34;
                    <span class="comment-line">#look for hostname and set spawn id invalid</span>
                    foreach name $hostname {
                        if { $spawn_ids($name) == $spawn_id } {
                            <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Invalidate $spawn_ids($name) host: $name&#34;
                            if [catch {close -i $spawn_id} reason] {
                                puts &#34;Failed to close spawn_id $spawn_id Reason: $reason&#34;
                            }
                            if [catch {wait} x] {
                                puts &#34;Failed on wait : reason $x&#34;
                            }
                            <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
                            set spawn_ids($name) &#34;INVALID&#34;
                            set idcleared 1
                        }
                    }
                    <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
                    if {!$idcleared} {
                        <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No Spawn_ID cleared.  This may be an issue with Login registering its spawn_id&#34;
                    }
                    return
                }
                &#34;ogin:&#34; {
                    <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Received a Login Prompt:\n$expect_out(buffer)&#34;
                    if {$closeSession != &#34;true&#34;} {
                        return;
                    }
                    <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Hostname list: $hostname - My spawn_id $spawn_id&#34;
                    set idcleared 0
                    foreach name $hostname {
                        <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;host spawn_ids($name) $spawn_ids($name) == $spawn_id&#34;
                        if { $spawn_ids($name) == $spawn_id } {
                            <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Invalidate $spawn_ids($name) host: $name&#34;
                            if [catch {close -i $spawn_id} reason] {
                                puts &#34;Failed to close spawn_id $spawn_id Reason: $reason&#34;
                            }
                            if [catch {wait} x] {
                                puts &#34;Failed on wait : reason $x&#34;
                            }
                            <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
                            set spawn_ids($name) &#34;INVALID&#34;
                            set idcleared 1
                        }
                    }
                    <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
                    if {!$idcleared} {
                        <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No Spawn_ID cleared.  This may be an issue with Login registering its spawn_id&#34;
                    }
                    foreach name $hostname {
                        if { $spawn_ids($name) == $spawn_id } {
                            <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Invalidate $spawn_ids($name) host: $name&#34;
                            close -i $spawn_id
                            wait
                            set spawn_ids($name) &#34;INVALID&#34;
                            set idcleared 1
                        }
                    }
                    if {!$idcleared} {
                        <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No Spawn_ID cleared.  This may be an issue with Login registering its spawn_id&#34;
                    }
                    return
                }
            }
        }
        eof {
            <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Connection Closed!!!&#34;
            foreach name $hostname {
                if { $spawn_ids($name) == $spawn_id } {
                    <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Invalidate $spawn_ids($name) host: $name&#34;
                    if [catch {close -i $spawn_id} reason] {
                        <span class="comment-line">#puts &#34;Failed to close spawn_id $spawn_id Reason: $reason&#34;</span>
                    }
                    if [catch {wait} x] {
                        <span class="comment-line">#puts &#34;Failed on wait : reason $x&#34;</span>
                    }
                    <a name="::exSleep(5)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
                    set spawn_ids($name) &#34;INVALID&#34;
                }
            }
            <a name="::exSleep(6)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 1
            return
        }
        &#34;ogin:&#34; {
            <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$expect_out(buffer)&#34;
            if {$closeSession != &#34;true&#34;} {
                return;
            }
            <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;login 2&#34;
            foreach name $hostname {
                if { $spawn_ids($name) == $spawn_id } {
                    <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Invalidate $spawn_ids($name) host: $name&#34;
                    if [catch {close -i $spawn_id} reason] {
                        <span class="comment-line">#puts &#34;Failed to close spawn_id $spawn_id Reason: $reason&#34;</span>
                    }
                    if [catch {wait} x] {
                        <span class="comment-line">#puts &#34;Failed on wait : reason $x&#34;</span>
                    }
                    <a name="::exSleep(7)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
                    set spawn_ids($name) &#34;INVALID&#34;
                }
            }
            return
        }
    }
}
<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: logout_save</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that logout from the current DUT after saving the current config.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: fd</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             logout_save</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::logout_save_174">proc <a href="logout.tcl-annot.html#::::logout_save">::::logout_save</a></a></strong> {{fd &#34;NULL&#34;}} {
   global spawn_id
   set timeout 40
   send &#34;save\r&#34;
   expect &#34;save?&#34;
   send &#34;y\r&#34;
   expect &#34;#&#34;
   <a name="::logout(1)"><a href="./logout.tcl.html#::logout_21">::logout</a></a> $fd
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: logout_noSave</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that Logout a switch without saving the configuration</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: fd</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             logout_noSave</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::logout_noSave_198">proc <a href="logout.tcl-annot.html#::::logout_noSave">::::logout_noSave</a></a></strong> {{fd &#34;NULL&#34;}} {
   <a name="::logout(2)"><a href="./logout.tcl.html#::logout_21">::logout</a></a> $fd
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: _ClearExpectSession</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: proc to kill a telnet session</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             _ClearExpectSession</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::_ClearExpectSession_215">proc <a href="logout.tcl-annot.html#::::_ClearExpectSession">::::_ClearExpectSession</a></a></strong> {args} {
    global spawn_id
    global spawn_ids
    global hostname

    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> _ClearExpectSession $args {
        tmp &#34;1&#34;
    }

    set idcleared 0
    foreach name $hostname {
       if { $spawn_ids($name) == $spawn_id } {
           <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Invalidate $spawn_ids($name) host: $name&#34;
           close -i $spawn_id
           wait
           set spawn_ids($name) &#34;INVALID&#34;
           set idcleared 1
       }
    }
    <a name="::exSleep(8)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
    if {!$idcleared} {
        <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;No Spawn_ID cleared.  This may be an issue with Login registering its spawn_id&#34;
    }
    return
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: ClearTestbedSessions</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: proc to clear the telnet expect sessions for a test bed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             ClearTestbedSessions</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ClearTestbedSessions_254">proc <a href="logout.tcl-annot.html#::::ClearTestbedSessions">::::ClearTestbedSessions</a></a></strong> {} {
    for {set i 1} {$i&lt;20} {incr i} {
        global DUT${i}_CONNECT
        global DUT${i}_CONNECTB
        if {[info exists DUT${i}_CONNECT]} {
            <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> &#34;[set DUT${i}_CONNECT]&#34; -CheckOperational 0 -masterCheck 0
            <a name="::_ClearExpectSession(1)"><a href="./logout.tcl.html#::_ClearExpectSession_215">::_ClearExpectSession</a></a>
        }
        if {[info exists DUT${i}_CONNECTB]} {
            <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> &#34;[set DUT${i}_CONNECTB]&#34; -CheckOperational 0 -masterCheck 0
            <a name="::_ClearExpectSession(2)"><a href="./logout.tcl.html#::_ClearExpectSession_215">::_ClearExpectSession</a></a>
        }
    }
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: ClearTestbedTelnetPIDs</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: proc to clear the telnet expect pids for a test bed</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: </span>
<span class="comment-line"># Output args: </span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             ClearTestbedTelnetPIDs</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::ClearTestbedTelnetPIDs_282">proc <a href="logout.tcl-annot.html#::::ClearTestbedTelnetPIDs">::::ClearTestbedTelnetPIDs</a></a></strong> {} {
    for {set i 1} {$i&lt;20} {incr i} {
        global DUT${i}_CONNECT
        if {[info exists DUT${i}_CONNECT]} {
            <a name="::_clearDutConnectionVars(1)"><a href="./login.tcl.html#::_clearDutConnectionVars_1969">::_clearDutConnectionVars</a></a> $i
        }
    }
}
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
