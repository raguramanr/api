<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>mysqlRunall_monitor.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#mysqlRunall_monitor.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>mysqlRunall_monitor.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="mysqlRunall_monitor.tcl-annot.html">annotations</a> | <a href="mysqlRunall_monitor.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">
<span class="comment-line">#!/usr/bin/tclsh</span>

puts &#34;Entered the script&#34;
package require http 1.0;
package require Tclx
source ../Lib/mainLib.tcl

set  startTime [exec date]
set  executeBatFile 0
<span class="comment-line">#set  modSummaryCfgPath &#34;./cfg/modulesToBeSummarized.cfg&#34;</span>
<span class="comment-line"># SK: Changed duplicated files to be referred under Autoweb/cgi-bin/cgiScripts</span>
set  modSummaryCfgPath &#34;./../Autoweb/cgi-bin/cgiScripts/modulesToBeSummarized.cfg&#34;

<span class="comment-line"># List of errors returned by main.tcl deemed FATAL</span>
set fatalErrorList [list \
	&#34;Unable to connect to switch after reboot&#34; \
	&#34;Cannot find config file&#34; \
	&#34;No response from the switch&#34; \
	&#34;Can't create dir&#34; \
        &#34;CONSOLE IS HUNG&#34; \
	&#34;spawn id .* not open&#34; \
	&#34;invalid command name&#34; \
	&#34;Loop Condition&#34; \
	&#34;Config Booted is Factory Default after save reboot&#34; \
	&#34;CF is corrupted on DUT&#34; \
	]

<span class="comment-line"># Default user to send mail notification to.</span>
set defaultRecipient &#34;sqaauto@extremenetworks.com&#34;

<span class="comment-line"># List of modules that returned errors during run of main.tcl</span>
set erroredModules [list]
<span class="comment-line"># counter to check how many times the regression is continously failing</span>
global regression_fail_counter
set  regression_fail_counter 0 

load [lindex [glob &#34;/usr/lib/libexpect*so*&#34;] 0]
set LIB_PATH &#34;../Lib&#34;
lappend auto_path $LIB_PATH


<a name="::::gen_index(1)"><a href="./summarize.tcl.html#::::gen_index_76">::::gen_index</a></a> ../Lib
<a name="::::gen_index(2)"><a href="./summarize.tcl.html#::::gen_index_76">::::gen_index</a></a> .

source ../Lib/parse_args.tcl


<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line"># These 4 calls are REQUIRED for all sublevel libraries that use </span>
<span class="comment-line"># result_xxxx functions to work.</span>
<span class="comment-line">#set resultDir &#34;RunAllMonitor_logs&#34;</span>
set resultDir &#34;Log&#34;
if { ! [file isdirectory $resultDir] } {
    ;<span class="comment-line"># Create it!</span>
    file mkdir $resultDir
}
set tStartTime [clock seconds]
set tStartDate [clock format [clock seconds] -format &#34;%Y-%m-%d %I.%M.%S%p&#34;]
set tStartDateString [clock format [clock seconds] -format &#34;%Y-%m-%d_%I.%M.%S%p&#34;]
set fd_res [<a name="::open_result_file(1)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;runall-[clock format [clock seconds] -format &#34;%I.%M%p&#34;]-[pid]&#34;]
<span class="comment-line"># ------------------------------------------------------------------------------</span>

set connectionTimeout 60


<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line"># Dump out usage information</span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::print_usage_69">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::print_usage">::::print_usage</a></a></strong> {} {
puts &#34;Calling proc print usage&#34;
    puts &#34;\r&#34;
    puts &#34;USAGE: runall_monitor.tcl \
	    -cfg &lt;config file&gt; \
	    -regType &lt;regType&gt;&#34;
    puts &#34;           -regSubType &lt;SubType&gt; \
	    \[-platformIndx &lt;platformName,index&gt;] \
	    \[-platform &lt;platform&gt;] \
	    \[-lst &lt;lst&gt;] \
	    \[-blade &lt;blade&gt;] &#34;
    puts &#34;           \[-exclude &lt;module&gt;] \
	    \[-include &lt;module&gt;] \
	    \[-forstats &lt;yes|no&gt;] \
	    \[-download &lt;yes|no&gt;
	    \[-mailTo &lt;e-mail address&gt;]&#34;
    puts &#34;  \[-noPost &lt;Y&gt;] &#34;
    puts &#34;  \[-i386ImagePath &lt;image path to i386 image&gt;]&#34;
    puts &#34;  \[-marinerImagePath &lt;image path to mariner image&gt;]&#34;
    puts &#34;  \[-aspenImagePath &lt;image path to aspen image&gt;]&#34;
    puts &#34;  \[-cougarImagePath &lt;image path to cougar image&gt;]&#34;
    puts &#34;  \[-x480ImagePath &lt;image path to x480 image&gt;]&#34;
    puts &#34;  \[-x870ImagePath &lt;image path to x870 image&gt;]&#34;
    puts &#34;  \[-NWIImagePath &lt;image path to NWI image&gt;]&#34;
    puts &#34;  \[-viperImagePath &lt;image path to viper image&gt;]&#34;
    puts &#34;  \[-jaguarImagePath &lt;image path to jaguar image&gt;]&#34;
    puts &#34;  \[-olympicImagePath &lt;image path to olympic image&gt;]&#34;
    puts &#34;  \[-voyagerImagePath &lt;image path to voyager image&gt;]&#34;
    puts &#34;  \[-bootrom &lt;bootrom&gt;]&#34;
    puts &#34;  \[-bootrom &lt;bootrom&gt;]&#34;
    puts &#34;  \[-obuild &lt;software build&gt;]&#34;
    puts &#34;\r&#34;
    puts &#34;      &lt;cfg&gt;: Path of the config file name (e.g. \
	    short/ptgm4x6.2.2b4.cfg)&#34;
    puts &#34;      &lt;regType&gt;: Type of Regression to be run \
	    (functional|snmp|cli|performance|scalability|fit)&#34;
    puts &#34;      &lt;regSubType&gt;: Test Subtype (standard|ipRoute1|ipRoute2|ipRoute3|\
	    uploadanddownload)&#34;
    puts &#34;      \[&lt;platform&gt;]: Name of the platform&#34;
    puts &#34;           BD/Alpine/Summit7i/Summit48i/Summit48si/Summit5i/summit2/\
	    Summit4/Summit24e3/BT/Godzilla&#34;
    puts &#34;      \[&lt;blade&gt;]: &#34;
    puts &#34;          FM24T/FM32T/FM4X/G12SXi/F48Ti/F32T/G8Xi/F96Ti/F32Fi/\
	    G8Ti/Summit7i/Summit5i/Summit48si&#34;
    puts &#34;      \[&lt;lst&gt;]: quick/pass/all/dev/debug.&#34;
    puts &#34;      \[&lt;exclude&gt;]: modules to be excluded from testing.&#34;
    puts &#34;      \[&lt;include&gt;]: modules to be tested. The regression will only run \
	    those modules you specified&#34;
    puts &#34;      \[&lt;forstats&gt;]: If this regression is valid for collecting statistics&#34;
    puts &#34;	\[-download] &lt;yes|no&gt; Download image before starting. Default: \
	    yes&#34;
    puts &#34;      \[&lt;mailTo&gt;]: The email address to which you want to send the \
	    regression status &#34;
    puts &#34;      \[&lt;-noPost&gt;]: No posting to autoweb will happen if (-noPost Y) \
	    is given Note: no rerun will happen also.&#34;
    puts &#34;      \[&lt;i386ImagePath&gt;]: ./exosi386.tgz&#34;
    puts &#34;      \[&lt;marinerImagePath&gt;]: ./exosmariner.tgz&#34;
    puts &#34;      \[&lt;aspenImagePath&gt;]: ./exosaspen.tgz&#34;
    puts &#34;      \[&lt;cougarImagePath&gt;]: ./exoscougar.tgz&#34;
    puts &#34;      \[&lt;x480ImagePath&gt;]: ./exosx480.tgz&#34;
    puts &#34;      \[&lt;x870ImagePath]: ./exosx870.tgz&#34;
    puts &#34;      \[&lt;NWIImagePath&gt;]: ./exosNWI.tgz&#34;
    puts &#34;      \[&lt;viperImagePath&gt;]: ./exosviper.tgz&#34;
    puts &#34;      \[&lt;jaguarImagePath&gt;]: ./exosjaguar.tgz&#34;
    puts &#34;      \[&lt;olympicImagePath&gt;]: ./exosolympic.tgz&#34;
    puts &#34;      \[&lt;voyagerImagePath&gt;]: ./exosvoyager.tgz&#34;
    puts &#34;      \[&lt;bootrom&gt;]: bootver (assume in root of your location share)&#34;
    puts &#34;      \[&lt;obuild&gt;]: old sofware version (ie. 10.1.2.16)&#34;
    puts &#34;      \[&lt;rerun&gt;] : rerun of failed cases&#34;
    puts &#34;      \[&lt;baseLine&gt;]: base line build with which the results have to be compared&#34;
    puts &#34;      \[&lt;stopWithPhase&gt;]: stop with a particular phase in regression&#34;
}

puts &#34;Starting to run mysqlrunmonitor&#34;
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line"># Function to do validation of input arguments</span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::validatemysqlRunall_monitorArgs_146">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::validatemysqlRunall_monitorArgs">::::validatemysqlRunall_monitorArgs</a></a></strong> { p_blade p_platformIndx p_platform p_cfg p_regType p_regSubType \
	p_exclude p_include p_forstats p_download p_noPost \
	p_mailTo p_i386ImagePath p_marinerImagePath p_aspenImagePath p_x870ImagePath \
        p_cougarImagePath p_x480ImagePath p_NWIImagePath p_viperImagePath p_jaguarImagePath p_olympicImagePath \
	p_voyagerImagePath p_image p_rerun p_baseLine p_stopWithPhase} {
 puts &#34;Proc  validatemysqlRunall_monitorArgs  is called &#34;
    global defaultRecipient

    ;<span class="comment-line"># From modulesToBeSummarized.cfg</span>
    global clis
    global platformLists
    global bds summits aspens
    global RerunEnabled 

    upvar $p_blade  blade
    upvar $p_platformIndx platformIndx
    upvar $p_platform platform
    upvar $p_cfg cfg
    upvar $p_regType regType 
    upvar $p_regSubType regSubType
    upvar $p_exclude exclude
    upvar $p_include include
    upvar $p_forstats forstats
    upvar $p_download download
    upvar $p_noPost noPost
    upvar $p_mailTo mailTo 
    upvar $p_i386ImagePath i386ImagePath 
    upvar $p_marinerImagePath marinerImagePath 
    upvar $p_aspenImagePath aspenImagePath 
    upvar $p_cougarImagePath cougarImagePath 
    upvar $p_x480ImagePath x480ImagePath
    upvar $p_x870ImagePath x870ImagePath
    upvar $p_NWIImagePath NWIImagePath
    upvar $p_viperImagePath viperImagePath
    upvar $p_jaguarImagePath jaguarImagePath 
    upvar $p_olympicImagePath olympicImagePath 
    upvar $p_voyagerImagePath voyagerImagePath 
    upvar $p_image image 
    upvar $p_rerun rerun
    upvar $p_baseLine baseLine
    upvar $p_stopWithPhase stopWithPhase
    if {$mailTo == &#34;&#34;} {
	set mailTo $defaultRecipient
    }
    
    if {$regType == &#34;null&#34;} {
	<a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ERROR: regType: Regression Type to be run is required.&#34;
	return 0
    }
    
    if {$regSubType == &#34;null&#34;} {
	<a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ERROR: regSubType: Regression Test Sub type required.&#34;
	return 0
    }

    if [regexp -nocase &#34;summit&#34; $platform] {
	set blade &#34;&#34;
    }

    if {$cfg == &#34;null&#34;} {
	<a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ERROR: cfg name required.&#34;
	return 0
    }
    
    if {$rerun == &#34;yes&#34;} {
        set RerunEnabled 1
 
    }
    
    if {($stopWithPhase &lt; 1 || $stopWithPhase &gt; 4) &amp;&amp; ($stopWithPhase != &#34;NULL&#34;)} {
         <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;!!! wrong input to stopWithPhase It has to be from 1 to 4!!&#34;

    }

    
    ;<span class="comment-line"># Check that platform/blade is supported by autoweb.  The file written to </span>
    ;<span class="comment-line"># autoweb data files must match what autoweb expects.  If platform/blade </span>
    ;<span class="comment-line"># combo is incorrect, the data will be written, but won't show up when </span>
    ;<span class="comment-line"># display.  For example, an AlpineFM32 directory might be created, but </span>
    ;<span class="comment-line"># autoweb expects AlpineFM32T.</span>
    if [regexp -nocase &#34;cli&#34; $regType] {
	;<span class="comment-line"># Look at  $clis in modulesToBeSummarized.cfg...which is </span>
	;<span class="comment-line"># generated from $cliTableConfig</span>
	set ok 0
	set temp [format &#34;cli%s%s&#34; $platform $blade]
	foreach listMember $clis {
	    if [regexp -nocase $listMember $temp] {
		set ok 1
		break
	    }
	}
	if { $ok == 0 } {
	    regsub -all &#34;cli&#34; $clis &#34;&#34; supportedList 
	    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;WARNING: Unsupported CLI blade/platform combination \
		    $platform:$blade may not post to autoweb correctly.&#34;
	    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;WARNING: Autoweb supported combinations are $supportedList&#34;
	}
    } elseif { [regexp -nocase &#34;func|snmp&#34; $regType] &amp;&amp; \
	    [regexp -nocase &#34;stand&#34; $regSubType] } {
	;<span class="comment-line"># Validate standard regressions</span>
	;<span class="comment-line"># These are generated from xxxTableConfig</span>
	set ok 0
	set temp [format &#34;%s%s&#34; $platform $blade]	
	foreach platList $platformLists {
	    set curList [set $platList]
	    foreach listMember $curList {
		if [regexp -nocase $temp $listMember] {
		    set ok 1
		    break
		}
	    }
	    if {$ok == 1} {
		break
	    }
	}
	if { $ok == 0 } {
	    <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;WARNING: Unsupported Standard blade/platform \
		    combination $platform:$blade may not post to autoweb correctly&#34;
	}
    }

    if {($platform == &#34;null&#34;) &amp;&amp; (![regexp -nocase {ipRoute[1-3]} \
	    $regSubType])}  {
	<a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ERROR: platform name required.&#34;
	return 0
    }
    
    if {($platform != &#34;null&#34;) &amp;&amp; ([regexp -nocase {ipRoute[1-3]} \
	    $regSubType])} {
	<span class="comment-line"># Do not exit, just ignore the extra parameter.</span>
	<a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;WARNING: regSubType=$regSubType, platform parameter is \
		being ignored.&#34;
    }
    
    if {($blade == &#34;null&#34;) &amp;&amp; (![regexp -nocase {ipRoute[1-3]} \
	    $regSubType])} {
	<span class="comment-line"># Do not exit, just ignore the extra parameter.</span>
	<a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;WARNING: blade name required.&#34;
    }

    if {($blade != &#34;null&#34;) &amp;&amp; ([regexp -nocase {ipRoute[1-3]} \
	    $regSubType])} {
	<span class="comment-line"># Do not exit, just ignore the extra parameter.</span>
	<a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;WARNING: regSubType=$regSubType, blade parameter is \
		being ignored.&#34;
    }

    if {($i386ImagePath == &#34;NULL&#34;) &amp;&amp; ($marinerImagePath == &#34;NULL&#34;) &amp;&amp; \
        ($aspenImagePath == &#34;NULL&#34;) &amp;&amp; ($cougarImagePath == &#34;NULL&#34;) &amp;&amp; ($x480ImagePath == &#34;NULL&#34;) &amp;&amp; ($x870ImagePath == &#34;NULL&#34;) &amp;&amp; \
	($viperImagePath == &#34;NULL&#34;) &amp;&amp; ($jaguarImagePath == &#34;NULL&#34;) &amp;&amp; ($olympicImagePath == &#34;NULL&#34;) &amp;&amp; \
        ($voyagerImagePath == &#34;NULL&#34;) &amp;&amp; ($NWIImagePath == &#34;NULL&#34;) &amp;&amp; $download != &#34;no&#34;} {
        <span class="comment-line"># error, at least one of them needs to be set</span>
	<a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ERROR: marinerImagePath ,i386ImagePath,aspenImagePath, \
                      cougarImagePath, x480ImagePath, x870ImagePath, NWIImagePath, viperImagePath, jaguarImagePath, \
		      olympicImagePath or voyagerImagePath must be set&#34;
	return 0
    } else {

        set marinerList [split $marinerImagePath /]
        set marinerFile [lindex $marinerList end]
        <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;marinerFile: $marinerFile&#34;
        set i386List [split $i386ImagePath /]
        set i386File [lindex $i386List end]
        <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;i386File: $i386File&#34;

        set aspenList [split $aspenImagePath /]
        set aspenFile [lindex $aspenList end]
        <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;aspenFile: $aspenFile&#34;

        set cougarList [split $cougarImagePath /]
        set cougarFile [lindex $cougarList end]
        <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cougarFile: $cougarFile&#34;

        set x480List [split $x480ImagePath /]
        set x480File [lindex $x480List end]
        <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;x480File: $x480File&#34;

        set x870List [split $x870ImagePath /]
        set x870File [lindex $x870List end]
        <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;x870File: $x870File&#34;

        set NWIList [split $NWIImagePath /]
        set NWIFile [lindex $NWIList end]
        <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;NWIFile: $NWIFile&#34;

        set viperList [split $viperImagePath /]
        set viperFile [lindex $viperList end]
        <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;viperFile: $viperFile&#34;

        set jaguarList [split $jaguarImagePath /]
        set jaguarFile [lindex $jaguarList end]
        <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;jaguarFile: $jaguarFile&#34;

        set olympicList [split $olympicImagePath /]
        set olympicFile [lindex $olympicList end]
        <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;olympicFile: $olympicFile&#34;

        set voyagerList [split $voyagerImagePath /]
        set voyagerFile [lindex $voyagerList end]
        <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;voyagerFile: $voyagerFile&#34;
        
        <span class="comment-line"># parse out the build number</span>
        if {$marinerImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use marinerImagePath</span>
            regsub &#34;\.xos&#34; $marinerFile &#34;&#34; marinerFile
            set marinerFileList [split $marinerFile -]
            regsub &#34;[lindex $marinerFileList 0]-&#34; $marinerFile &#34;&#34; image

        } elseif { $aspenImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use aspenImagePath</span>
            regsub &#34;\.xos&#34; $aspenFile &#34;&#34; aspenFile
            set aspenFileList [split $aspenFile -]
            regsub &#34;[lindex $aspenFileList 0]-&#34; $aspenFile &#34;&#34; image
        }  elseif { $cougarImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use cougarImagePath</span>
            regsub &#34;\.xos&#34; $cougarFile &#34;&#34; cougarFile
            set cougarFileList [split $cougarFile -]
            regsub &#34;[lindex $cougarFileList 0]-&#34; $cougarFile &#34;&#34; image
        }  elseif { $x480ImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use x480ImagePath</span>
            regsub &#34;\.xos&#34; $x480File &#34;&#34; x480File
            set x480FileList [split $x480File -]
            regsub &#34;[lindex $x480FileList 0]-&#34; $x480File &#34;&#34; image
        }  elseif { $x870ImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use x870ImagePath</span>
            regsub &#34;\.xos&#34; $x870File &#34;&#34; x870File
            set x870FileList [split $x870File -]
            regsub &#34;[lindex $x870FileList 0]-&#34; $x870File &#34;&#34; image
        }  elseif { $NWIImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use NWIImagePath</span>
            regsub &#34;\.xos&#34; $NWIFile &#34;&#34; NWIFile
            set NWIFileList [split $NWIFile -]
            regsub &#34;[lindex $NWIFileList 0]-&#34; $NWIFile &#34;&#34; image
        }  elseif { $viperImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use viperImagePath</span>
            regsub &#34;\.xos&#34; $viperFile &#34;&#34; viperFile
            set viperFileList [split $viperFile -]
            regsub &#34;[lindex $viperFileList 0]-&#34; $viperFile &#34;&#34; image
        }  elseif { $jaguarImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use jaguarImagePath</span>
            regsub &#34;\.xos&#34; $jaguarFile &#34;&#34; jaguarFile
            set jaguarFileList [split $jaguarFile -]
            regsub &#34;[lindex $jaguarFileList 0]-&#34; $jaguarFile &#34;&#34; image
        }  elseif { $olympicImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use olympicImagePath</span>
            regsub &#34;\.xos&#34; $olympicFile &#34;&#34; olympicFile
            set olympicFileList [split $olympicFile -]
            regsub &#34;[lindex $olympicFileList 0]-&#34; $olympicFile &#34;&#34; image
        }  elseif { $voyagerImagePath != &#34;NULL&#34;} {
            <span class="comment-line"># use voyagerImagePath</span>
            regsub &#34;\.xos&#34; $voyagerFile &#34;&#34; voyagerFile
            set voyagerFileList [split $voyagerFile -]
            regsub &#34;[lindex $voyagerFileList 0]-&#34; $voyagerFile &#34;&#34; image
        } else { 
            <span class="comment-line"># parse out using i386ImagePath</span>
            regsub &#34;\.xos&#34; $i386File &#34;&#34; i386File
            set i386FileList [split $i386File -]
            set image [lindex $i386FileList end]
       } 
    }
        
    return 1
}

<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line"># Procedure to handle copying the image to the tftp servers, then</span>
<span class="comment-line">#    downloading the image to the DUTs. </span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::handleImageDownload_414">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::handleImageDownload">::::handleImageDownload</a></a></strong> { cfg i386ImagePath marinerImagePath aspenImagePath \
                           cougarImagePath x480ImagePath x870ImagePath NWIImagePath viperImagePath \
			   jaguarImagePath olympicImagePath voyagerImagePath bootrom } {
    
    <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*****************************************************&#34;
    <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;          Starting Download Image Process&#34;
    <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;*****************************************************&#34;
    

    puts &#34;cfg: $cfg marinerImagePath: $marinerImagePath \n
      aspenImagePath: $aspenImagePath x480ImagePath: $x480ImagePath x870ImagePath: $x870ImagePath NWIImagePath: $NWIImagePath \
      jaguarImagePath: $jaguarImagePath olympicImagePath: $olympicImagePath voyagerImagePath: $voyagerImagePath \
       bootrom: $bootrom&#34;

    set dlPlatformList &#34;&#34;
    set dlImageList &#34;&#34;

    if {$i386ImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList i386
        lappend dlImageList $i386ImagePath
    }

    if {$marinerImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList Mariner
        lappend dlImageList $marinerImagePath    
    }

    if {$aspenImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList Aspen
        lappend dlImageList $aspenImagePath    
    }

    if {$cougarImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList Jaguar
        lappend dlImageList $cougarImagePath    
    } elseif {$jaguarImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList Jaguar
        lappend dlImageList $jaguarImagePath    
    } 
    if {$x480ImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList x480
        lappend dlImageList $x480ImagePath
    }
    if {$x870ImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList x870
        lappend dlImageList $x870ImagePath
    }
    if {$NWIImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList NWI
        lappend dlImageList $NWIImagePath
    }
    if {$viperImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList viper 
        lappend dlImageList $viperImagePath
    }

    if {$olympicImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList Olympic
        lappend dlImageList $olympicImagePath    
    }

    if {$voyagerImagePath != &#34;NULL&#34;} {
        lappend dlPlatformList Voyager
        lappend dlImageList $voyagerImagePath    
    }
    <span class="comment-line">#set dlStat [catch {exec tclsh LoadImage.tcl -cfg $cfg \</span>
    <span class="comment-line">#        -marinerImagePath $marinerImagePath \</span>
    <span class="comment-line">#        -i386ImagePath $i386ImagePath \</span>
    <span class="comment-line">#        -aspenImagePath $aspenImagePath \</span>
    <span class="comment-line">#        -cougarImagePath $cougarImagePath \</span>
    <span class="comment-line">#        -x480ImagePath $x480ImagePath \</span>
    <span class="comment-line">#        -x870ImagePath $x870ImagePath \</span>
    <span class="comment-line">#        -NWIImagePath $NWIImagePath \</span>
    <span class="comment-line">#        -viperImagePath $viperImagePath \</span>
    <span class="comment-line">#        -jaguarImagePath $jaguarImagePath \</span>
    <span class="comment-line">#        -olympicImagePath $olympicImagePath \</span>
    <span class="comment-line">#        -voyagerImagePath $voyagerImagePath \</span>
    <span class="comment-line">#        -bootrom $bootrom &gt;&amp;@stdout} result]</span>
    set dlStat [catch {exec tclsh QLoadImage.tcl -cfg $cfg \
            -platformList $dlPlatformList \
            -platformImageList $dlImageList \
            -bootrom $bootrom &gt;&amp;@stdout} result]


	if {$dlStat != 0} {
	    <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;\nERROR: Image download failed to DUTs!\nIf you do NOT\
		    want to download image, please use '-download no' option.\n&#34;
	    <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$result&#34;
	    return 0
	}
    return 1
}
<span class="comment-line"># ------------------------------------------------------------------------------</span>

<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::logTail_509">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::logTail">::::logTail</a></a></strong> {logFile n} { 
     
     set tailLogFile &#34;tail_&#34;
     set tailLogFile [append tailLogFile $logFile]
     set tailLogFileFull &#34;Log/Regressions/$tailLogFile&#34;
     set logFileFull &#34;Log/Regressions/$logFile&#34;
     if { [ catch {exec tail -n $n $logFileFull &gt; $tailLogFileFull} result ] } {
        puts &#34;$result&#34;
        return $result
     }
     set in [open $tailLogFileFull] 
     set tailStr  [read $in]
     close $in 
     exec rm -f $tailLogFileFull
     return $tailStr 
}

<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line">#  returns the IP address of the Linux where this is running</span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::myIP_529">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::myIP">::::myIP</a></a></strong> {} {
  set host 10.210.1.58
  set anyport 5555 ;<span class="comment-line"># Any random port number</span>
  set sock [socket -async $host $anyport]
  set sock_name [fconfigure $sock -sockname]
  set ip_list [split $sock_name &#34; &#34;]
  set ip [lindex $ip_list 0]
  close $sock
  return $ip
}

<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line">#</span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::copyResultsToReportDirectory_543">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::copyResultsToReportDirectory">::::copyResultsToReportDirectory</a></a></strong> { testModule regType platform blade image } {

    global randomIndex

    set build $image
    set imageVer [ getBuildNumber $build ]
    <span class="comment-line">#set reportDir [ GetReportDir $testModule $regType $platform $blade $imageVer &#34;..&#34;]</span>
    <span class="comment-line">#result_debug &#34;Report dir for the module : $reportDir&#34;</span>

    <span class="comment-line">#if { [ catch {exec mkdir $reportDir} result ] } {</span>
        <span class="comment-line">#result_error &#34;$result&#34;</span>
    <span class="comment-line">#}</span>

    <span class="comment-line"># get the result directory</span>
    set latestResultDir [<a name="::GetMainResultDir(1)"><a href="./result.tcl.html#::GetMainResultDir_841">::GetMainResultDir</a></a> $testModule $regType $randomIndex &#34;..&#34;]
    <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Latest result dir for the module : $latestResultDir&#34;

    set reportDir [<a name="::get_report_dir(1)"><a href="./report.tcl.html#::get_report_dir_711">::get_report_dir</a></a> $latestResultDir $testModule $regType &#34;..&#34;]
    <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Report dir for the module : $reportDir&#34;

    <span class="comment-line"># create the report directory if it does not exist</span>
    if {[file exists $reportDir]!=1} {
      if { [ catch {exec mkdir $reportDir} result ] } {
          <a name="::result_error(9)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$result&#34;
      }
    }

    puts &#34;Directory contents are:\n[glob -directory $latestResultDir *]&#34;
    set fileList [glob -directory $latestResultDir *]

    <span class="comment-line">#Remove the report.exr from original result dir</span>
    set exrFile &#34;$latestResultDir/report.exr&#34;
    if {[file exists $exrFile]==1} {
      file delete $exrFile
    }
    <span class="comment-line">#Remove the reportdir.txt file</span>
    set reportdirFile &#34;$latestResultDir/reportdir.txt&#34;
    if {[file exists $reportdirFile]==1} {
      file delete $reportdirFile
    }

    <span class="comment-line"># copy everything from the result directory to report directory</span>
    foreach fileThis [glob -directory $latestResultDir *] {
      if { [file rename $fileThis $reportDir] != &#34;&#34; } {
        puts &#34;Failed to move results file $fileThis to report directory.&#34;
        puts &#34;Make sure all opened files are closed.&#34;
      }
    }
    if [file isdirectory $latestResultDir] {
      file delete $latestResultDir
    }
}

<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line">#</span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::handleAbortedModule_599">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::handleAbortedModule">::::handleAbortedModule</a></a></strong> { testModule regType platform blade image result } {

    global abortingReason, randomIndex
    set abortingReason $result
    set build $image
    set imageVer [ getBuildNumber $build ]  

    <span class="comment-line"># get the result directory</span>
    set latestResultDir [<a name="::GetMainResultDir(2)"><a href="./result.tcl.html#::GetMainResultDir_841">::GetMainResultDir</a></a> $testModule $regType $randomIndex &#34;..&#34;]
    <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Latest result dir dir for the module : $latestResultDir&#34;

    if { [ catch { set reportDir [<a name="::get_report_dir(2)"><a href="./report.tcl.html#::get_report_dir_711">::get_report_dir</a></a> $latestResultDir $testModule $regType &#34;..&#34;] } ] } {
        <a name="::result_error(10)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;there is no info about report directory - leaving handleAbortedModule&#34;
        return
    }
    <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Report dir for the module : $reportDir&#34;

    if { [ catch { open &#34;$latestResultDir/report.txt&#34; a } fd ] } {
	<a name="::result_error(11)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Can't open file : $latestResultDir/report.txt - leaving handleAbortedModule&#34;
        return
    }
    <span class="comment-line">#let's find the name of the aborted file</span>

    set lt 0
    set ctimeList &#34;&#34;
    set dirList [glob -nocomplain -- &#34;$latestResultDir/*&#34;]
    foreach di $dirList {
       file lstat $di damn
       lappend ctimeList [set damn(ino)] 
    }
    set latestcTime [lindex [lsort -integer $ctimeList] [expr [llength $ctimeList]-1]]
    set finalIndex [lsearch -exact $ctimeList $latestcTime]
    set finalFile [file tail [lindex $dirList $finalIndex]]
    regsub -nocase &#34;.txt&#34; $finalFile &#34;&#34; lt
    <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the aborted feature  was $lt&#34;
 
 
    if { ($result != &#34;connectionBad&#34;) } {
      puts $fd &#34;\n\n$lt  ABORTED                                                       \[FAILED\]\n&#34;
    }
    puts $fd &#34;\nTHIS MODULE WAS ABORTED DUE TO THE ABOVE FAILURE                     \[FAILED\]\n\n&#34;
    close $fd
 
    if { ($result != &#34;connectionBad&#34;) } {
      <span class="comment-line"># add error comment to the failing log</span>
      if { [ catch { open &#34;$latestResultDir/$lt.txt&#34; a } fd ] } {
          <a name="::result_error(12)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Can't open file : $latestResultDir/$lt.txt&#34;
          return
      }
      puts $fd &#34;\n!!!!! THIS TEST WAS ABORTED !!!!!\n&#34;
      puts $fd &#34;\n!!!!! main returned: $result !!!!!\n&#34;
      close $fd
    }

    <a name="::copyResultsToReportDirectory(1)"><a href="./mysqlRunall_monitor.tcl.html#::copyResultsToReportDirectory_543">::copyResultsToReportDirectory</a></a> $testModule $regType $platform $blade $image
}

<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line">#  Check the result value returned by main.tcl for FATAL errors that we</span>
<span class="comment-line">#   want to ABORT the rest of the run.</span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::checkFatalError_660">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::checkFatalError">::::checkFatalError</a></a></strong> { result  } {
    
    global fatalErrorList
    global regression_fail_counter
    if { $regression_fail_counter &gt;= 5 } {
    	<a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;ABORTING REGRESSION AS REGRESSION CONTINOUSLY FAILED FOR $regression_fail_counter MODULES&#34;
    	return 1 
    }
    foreach errorString $fatalErrorList {
	
	<a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$errorString  $result&#34;
	if [regexp -nocase $errorString $result] {
	    return 1
	}
    }
    if { [regexp -nocase &#34;Unable to connect|connectionBad|Unable to login&#34; $result] } {
    ;<span class="comment-line"># increment the continously regression failed count</span>
    incr regression_fail_counter
    <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sleep for 2 minutes to recover for recoverable failure&#34;
    <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a>  120 
    }
    return 0
}

<span class="comment-line"># -----------------------------------------------------------------</span>
<span class="comment-line"># Take care of running regression (main.tcl) and posting to the</span>
<span class="comment-line">#    web (automate.tcl).</span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::runModuleRegression_688">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::runModuleRegression">::::runModuleRegression</a></a></strong> {args} { 
puts &#34;Calling Pric runModuleRegression &#34;
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> runModuleRegression $args {
        testModule &#34;&#34; 
        modeToUse &#34;&#34; 
        regPath &#34;&#34; 
        cfg &#34;&#34; 
        noPost &#34;&#34; 
    	createConfig &#34;&#34; 
        regType &#34;&#34; 
        regSubType &#34;&#34; 
        platformIndx &#34;&#34; 
        platform &#34;&#34; 
        blade &#34;&#34;
        image &#34;&#34; 
        obuild &#34;&#34; 
        regression_id &#34;&#34; 
        host &#34;&#34; 
        db &#34;&#34; 
        build_name &#34;&#34; 
        subversion &#34;&#34;
        run_number &#34;&#34; 
        lst &#34;&#34;
        efence &#34;&#34; 
        saveConfigPerTest &#34;&#34; 
        debugLevel &#34;0&#34;
    }

    global exclude
    global heuristicTCList
    global forstats
    global executeBatFile 
    global erroredModules
    global fd_res
    global mysql_handler
    global randomIndex
    global regression_fail_counter
    global mailTo
    global DebugOn
    global DebugOnHi
    global FCOUNT
    global MAIN

    set harness &#34;tcl&#34;

    if {![info exists DebugOn]} {
        set DebugOn 0
    }
    if {![info exists DebugOnHi]} {
        set DebugOnHi 0
    }

    set errorCode 1
    set match &#34;&#34;
    set str &#34;&#34; 
    set skipModule &#34;&#34;
    
    ;<span class="comment-line"># Check if this module is on the exclude list</span>
    <span class="comment-line">#foreach excludeM $exclude {</span>
        if {[lsearch -exact $exclude  $testModule ] != -1} {
            set skipModule $testModule
            <span class="comment-line">#break</span>
        } 
    <span class="comment-line">#}</span>
   
    if {$skipModule == &#34;&#34;} {
        
        <span class="comment-line"># re-connect db if needed</span>
        <a name="::conn_to_db(1)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db
        
        <span class="comment-line"># create entry in the current_run_table</span>
        set current_run_id [<a name="::CreateCurrentRunTableEntry(1)"><a href="./mysqlLib.tcl.html#::CreateCurrentRunTableEntry_2685">::CreateCurrentRunTableEntry</a></a> -regression_id $regression_id \
                                                       -feature_directory $testModule]
        puts &#34;current_run_id $current_run_id&#34;
        
        set moduleStartTime [exec date]
        
        <span class="comment-line"># IF SECOND RUN FIND THE FAILING MODULES</span>
        puts &#34;runModuleRegression run_number: $run_number testModule: $testModule&#34;
        set failingTests &#34;all&#34;
        if {$run_number == 2} {
            set failingTests [<a name="::GetFailingTestsForModule_autoreg(1)"><a href="./mysqlLib.tcl.html#::GetFailingTestsForModule_autoreg_1384">::GetFailingTestsForModule_autoreg</a></a> -regression_id $regression_id \
                                                     -feature_directory $testModule ]
            <span class="comment-line"># IF THE LIST IS EMPTY WE ARE DONE HERE</span>
            if {$failingTests == &#34;all&#34;} {
                puts &#34;runModuleRegression run_number: $run_number failingTests: $failingTests&#34;
                return $errorCode
            }
        } elseif {$heuristicTCList != &#34;null&#34;} {
            set failingTests $heuristicTCList
        }
        
        <span class="comment-line">#this is needed to create result directory by main.tcl known to mysqlRunall_monitor</span>
        set range 1000000
        set randomIndex [expr {int(rand()*$range)}]
        
        <span class="comment-line"># find the efence processes for this feature</span>
        <span class="comment-line"># do not activate efence for stackables</span>
        set efenceProcessList &#34;no&#34;
        if {[llength $efence] &gt; 0} {
            if {[lindex $efence 0] == &#34;yes&#34;} {
                set efenceProcessList [<a name="::getEfenceProcessList(1)"><a href="./mysqlLib.tcl.html#::getEfenceProcessList_2251">::getEfenceProcessList</a></a> -module $testModule -cfg $cfg -regType $regType]
            }
        }
        
        <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Starting regression for $testModule START: $moduleStartTime....&#34;
        <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;main.tcl -mode $modeToUse -module $testModule -comment \&#34;xtermtitle regId:$regression_id \&#34; \
            -regPath $regPath -cfg $cfg -tcList \&#34;$failingTests\&#34; -debugLevel $debugLevel \
            -randomIndex $randomIndex -lst $lst -efence $efenceProcessList \
            -saveConfigPerTest $saveConfigPerTest&#34;
       <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;flie reaches her here&#34;
        <span class="comment-line"># -------------------------------------------------------------------</span>
        <span class="comment-line"># Write logs to file before starting</span>
        <span class="comment-line"># -------------------------------------------------------------------</span>
        flush $fd_res


        <span class="comment-line">#Check if Regressions dir exists and create if the dir didn't exist</span>


        if {![file isdirectory Log/Regressions]} {
              exec  mkdir Log/Regressions
        }
        <span class="comment-line">###################################################################</span>
        set logFileName1 &#34;regLog_&#34;
        set logFileName1 [append logFileName1 &#34;$image&#34;] 
        set logFileName1 [append logFileName1 &#34;_&#34;]
        set logFileName1 [append logFileName1 &#34;$regression_id&#34;] 
        set logFileName1 [append logFileName1 &#34;_&#34;]
        set logFileName1 [append logFileName1 &#34;$run_number&#34;]
        set logFileName1 [append logFileName1 &#34;.txt&#34;]
        set logFileName &#34;Log/Regressions/$logFileName1&#34;
        puts &#34;\n===============================================================&#34;
        puts &#34;===============================================================&#34;
        puts &#34;  S T A R T I N G    M A I N . T C L   O N :: $testModule&#34;
        puts   &#34;============       Log File Name             ================\n&#34;
        puts &#34;logFileName $logFileName\n&#34;
        puts &#34;===============================================================&#34;
        puts &#34;===============================================================&#34;

        catch { exec {tclsh} main.tcl -mode $modeToUse -module $testModule \
                -comment &#34;xtermtitle regId:$regression_id &#34; \
                -regPath $regPath -cfg $cfg -build $image -subversion $subversion \
                -obuild $obuild -tcList &#34;$failingTests&#34; \
                -debugLevel $debugLevel -randomIndex $randomIndex \
                -lst $lst -efence $efenceProcessList \
                -saveConfigPerTest $saveConfigPerTest  \
                &gt;@stdout | busybox tee -a $logFileName } result

        if { [regexp -nocase &#34;connectionBad&#34; $result] } {
            catch { exec {tclsh} main.tcl -mode $modeToUse -module $testModule \
                    -comment &#34;xtermtitle regId:$regression_id &#34; \
                    -regPath $regPath -cfg $cfg -build $image -subversion $subversion \
                    -obuild $obuild -tcList &#34;$failingTests&#34; \
                    -debugLevel $debugLevel -randomIndex $randomIndex \
                    -lst $lst -efence $efenceProcessList \
                    -saveConfigPerTest $saveConfigPerTest \
                    &gt;@stdout | busybox tee -a $logFileName } result
        }
        
        <a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$testModule   main.tcl returned result: $result&#34;
        
        <span class="comment-line"># re-connect db if needed</span>
        <a name="::conn_to_db(2)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db
        
        
        <span class="comment-line">#copyResultsToReportDirectory $testModule $regType $platform $blade $image</span>
        
        ;<span class="comment-line"># If we get no result back, we assume abnormal termination</span>
        ;<span class="comment-line"># If we get something other than testCompleted or testSkipped, we assume problem</span>
        ;<span class="comment-line">#    with the test execution.</span>
        set resultForAbortTest $result
        <span class="comment-line"># login_telnet error catch</span>
        if {[regexp -nocase login_telnet $result]} {
            set resultForAbortTest error
        }
        if {(! [regexp -nocase {testCompleted|testSkipped} $resultForAbortTest]) || ($result == &#34;&#34;)} {
            global mailTo
            incr FCOUNT
            <span class="comment-line"># Send email notification</span>
            set  notificationData  &#34;\nHOST PC:  [exec hostname] \
            \nSTARTED:  $moduleStartTime \
            \nENDED:    [exec date] \
            \nIMAGE:    $image \
            \nCFG:      $cfg \
            \nPLATFORM: $platform \
            \nBLADE:    $blade \
            \nMODULE:   $testModule&#34;
            set subject &#34;$cfg : Regression Aborted in $testModule with ERROR&#34;
            
            set tailDataFile [<a name="::logTail(1)"><a href="./mysqlRunall_monitor.tcl.html#::logTail_509">::logTail</a></a> $logFileName1 100] 
            set tailData &#34;\n\nLast 100 lines from ./main/$logFileName\n\n\n&#34;
            set tailData [append tailData &#34;$tailDataFile&#34;]
            
            <span class="comment-line"># -------- If the results is greater than 2000 char, trim --------</span>
            if {[string length $result] &gt; 2000} {
                set result [string range $result 0 1999]
            } 
            sendMailNotification $mailTo $subject \
            &#34;MAIN.TCL: $testModule\nERROR:$result\n$notificationData\n$tailData&#34;
            
            <a name="::result_error(13)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;MAIN.TCL: $testModule\n$result\n$notificationData\n$tailData&#34;
            lappend erroredModules $testModule
            set errorCode 1
            
            <a name="::handleAbortedModule(1)"><a href="./mysqlRunall_monitor.tcl.html#::handleAbortedModule_599">::handleAbortedModule</a></a> $testModule $regType $platform $blade $image $result
            
            ;<span class="comment-line"># Check if the string returned from main.tcl constitutes a fatal</span>
            ;<span class="comment-line"># error where we ABORT the rest of the regression.</span>
            if {[<a name="::checkFatalError(1)"><a href="./mysqlRunall_monitor.tcl.html#::checkFatalError_660">::checkFatalError</a></a> $result] == 1} {
                return &#34;FATAL_ERROR&#34;
            }
        } else {
            ;<span class="comment-line"># Reset the continues regression fail count if any modules passes</span>
            set regression_fail_counter 0
        }
        
        after 2000
        
        if {[regexp -nocase -indices &#34;(^Y)&#34; $noPost matchedRange] == 1} {
            <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\tSkip call to automate.tcl.&#34; 
            return $errorCode
        }
        
        if {$regSubType == &#34;upgradedowngrade&#34;} {
            set delimit &#34;:&#34;
        } else {
            set delimit &#34;&#34;
            <span class="comment-line"># make sure to clear obuild since it's not needed</span>
            set obuild &#34;&#34;
        }
        <span class="comment-line"># ----------------------------------------------------------------</span>
        <span class="comment-line"># Post results to autoweb</span>
        <span class="comment-line"># ----------------------------------------------------------------</span>
        puts &#34;CALLING mysqlAutomate WITH:&#34;
        puts &#34;regId $regression_id host $host \
                                         module $testModule \
                                         obuild $obuild&#34;
        
        if {[catch { exec {tclsh} mysqlAutomate.tcl -regId $regression_id \
                                     -module $testModule \
                                     -forstats $forstats \
                     -obuild $obuild } \
                                     result]} {
        <a name="::result_error(14)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;mysqlAutomate.tcl returned an error&#34;
        }
        
        puts &#34;RESULTS OF mysqlAutomate: $result&#34;
        <span class="comment-line"># ----------------------------------------------------------------</span>
        <span class="comment-line"># --------------- testing mysqlAutomate.tcl end ------------------</span>
        
        <span class="comment-line"># re-connect db if needed</span>
        <a name="::conn_to_db(3)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db

        <span class="comment-line"># ----------------------------------------------------------------</span>
        <span class="comment-line">#   Check the current_run_table to see if a user has set the  </span>
        <span class="comment-line">#     reserved status to reserved.</span>
        <span class="comment-line">#</span>
        <span class="comment-line"># ----------------------------------------------------------------</span>
        <a name="::CheckAndPauseRegression(1)"><a href="./mysqlLib.tcl.html#::CheckAndPauseRegression_2773">::CheckAndPauseRegression</a></a> -regression_id $regression_id -feature_directory $testModule \
                            -admin_email $mailTo -regCfg $cfg
        <span class="comment-line"># ----------------------------------------------------------------</span>
        <span class="comment-line">#   The current_run_table should always be emtpy except for</span>
        <span class="comment-line">#      regressions that are actually running.  If there is an</span>
        <span class="comment-line">#      entry for this feature/test bed in the current_run_table</span>
        <span class="comment-line">#      delete it</span>
        <span class="comment-line"># ----------------------------------------------------------------</span>
        if {[info exists current_run_id]} {
            if {$current_run_id != &#34;error&#34;} {
                <span class="comment-line"># re-connect db if needed</span>
                <a name="::conn_to_db(4)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db
                <a name="::DeleteCurrentRunTableEntry(1)"><a href="./mysqlLib.tcl.html#::DeleteCurrentRunTableEntry_2299">::DeleteCurrentRunTableEntry</a></a> -current_run_id $current_run_id
            }
        }

    }

    return $errorCode

}
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line">#</span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<strong><a name="::::GetNumberNodes_971">proc <a href="mysqlRunall_monitor.tcl-annot.html#::::GetNumberNodes">::::GetNumberNodes</a></a></strong> { regType regSubType } {
puts &#34;Proc vGetNumberNodes is called &#34;
    <span class="comment-line">#if we do not have a platform_id</span>
    set number_nodes 2
    puts &#34;regType: $regType&#34;
    puts &#34;regSubType: $regSubType&#34;
    if { $regType == &#34;functional&#34; } {
    	if { [regexp -nocase &#34;route&#34; $regSubType]  } {
    	    set number_nodes 5
    	} else {
    	    set number_nodes 2
    	}
    }
    if { $regType == &#34;cli&#34; } {
    	set number_nodes 1
    }
    if { $regType == &#34;ixscriptmate&#34; } {
    	if { [regexp -nocase &#34;route&#34; $regSubType]  } {
    	    set number_nodes 5
    	} else {
    	    set number_nodes 2
    	}
    }
    if { $regType == &#34;scalability&#34; } {
    	if { [regexp -nocase &#34;route&#34; $regSubType]  } {
    	    set number_nodes 5
    	} else {
    	    set number_nodes 2
    	}
    }
    if { $regType == &#34;snmp&#34; } {
    	if { [regexp -nocase &#34;route&#34; $regSubType]  } {
    	    set number_nodes 5
    	} else {
    	    set number_nodes 2
    	}
    }
    puts &#34;number_nodes: $number_nodes&#34;

    return $number_nodes
}
puts &#34;Entering main function&#34;
<span class="comment-line"># ------------------------------------------------------------------------------</span>
<span class="comment-line">################################################################################</span>
<span class="comment-line">#                                M A I N</span>
<span class="comment-line">################################################################################</span>
<span class="comment-line"># ------------------------------------------------------------------------------</span>

<a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;###################################################################&#34;
<a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;                    RUNALL_MONITOR.TCL STARTED!&#34;
<a name="::result_debug(35)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;###################################################################&#34;
<a name="::result_debug(36)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;[exec date]&#34;

source ../Lib/parse_args.tcl

<a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> mysqlRunall_monitor $argv {
    blade &#34;null&#34;
    platformIndx &#34;null&#34;
    platform &#34;null&#34;
    cfg &#34;null&#34;
    regType &#34;null&#34;
    regSubType &#34;null&#34;
    exclude &#34;&#34;
    include &#34;&#34;
    forstats &#34;no&#34;
    download &#34;yes&#34;
    noPost &#34;N&#34;
    mailTo &#34;&#34;
    i386ImagePath   &#34;NULL&#34;
    marinerImagePath   &#34;NULL&#34;
    aspenImagePath   &#34;NULL&#34;
    cougarImagePath   &#34;NULL&#34;
    x480ImagePath   &#34;NULL&#34;
    x870ImagePath   &#34;NULL&#34;
    NWIImagePath   &#34;NULL&#34;
    viperImagePath   &#34;NULL&#34;
    jaguarImagePath   &#34;NULL&#34;
    olympicImagePath   &#34;NULL&#34;
    voyagerImagePath   &#34;NULL&#34;
    bootrom &#34;NULL&#34;
    obuild &#34;&#34;
    regression_id &#34;NULL&#34;
    system_id &#34;NULL&#34;
    system_name &#34;exos&#34;
    build_id &#34;NULL&#34;
    build_name &#34;NULL&#34;
    subversion &#34;NULL&#34;
    pass_number &#34;NULL&#34;
    platform_id &#34;NULL&#34;
    heuristic &#34;no&#34;
    efence &#34;no&#34;
    saveConfigPerTest &#34;no&#34;
    debugLevel &#34;0&#34;
    lst &#34;NULL&#34;
    incrBuilds &#34;NULL&#34;
    rerun &#34;no&#34;
    baseLine &#34;NULL&#34;
    stopWithPhase &#34;NULL&#34;
}


<span class="comment-line"># ----------------------------------------  start the mysql stuff ---------------------</span>
puts &#34;system_id: $system_id&#34;
puts &#34;system_name: $system_name&#34;
puts &#34;build_id: $build_id&#34;
puts &#34;build_name: $build_name&#34;
puts &#34;subversion: $subversion&#34;
puts &#34;pass_number: $pass_number&#34;
puts &#34;regression_id: $regression_id&#34;
puts &#34;platform_id: $platform_id&#34;
puts &#34;heuristic: $heuristic&#34;
puts &#34;efence: $efence&#34;
puts &#34;saveConfigPerTest: $saveConfigPerTest&#34;
puts &#34;debugLevel: $debugLevel&#34;

puts &#34;OLD PARAMETERS&#34;
puts &#34;blade: $blade&#34;
puts &#34;platformIndx: $platformIndx&#34;
puts &#34;platform: $platform&#34;
puts &#34;cfg: $cfg&#34;
puts &#34;regType: $regType&#34;
puts &#34;regSubType: $regSubType&#34;
puts &#34;exclude: $exclude&#34;
puts &#34;include: $include&#34;
puts &#34;forstats: $forstats&#34;
puts &#34;download: $download&#34;
puts &#34;noPost: $noPost&#34;
puts &#34;mailTo: $mailTo&#34;
puts &#34;i386ImagePath: $i386ImagePath&#34;
puts &#34;aspenImagePath: $aspenImagePath&#34;
puts &#34;cougarImagePath: $cougarImagePath&#34;
puts &#34;x480ImagePath: $x480ImagePath&#34;
puts &#34;x870ImagePath: $x870ImagePath&#34;
puts &#34;NWIImagePath: $NWIImagePath&#34;
puts &#34;viperImagePath: $viperImagePath&#34;
puts &#34;jaguarImagePath: $jaguarImagePath&#34;
puts &#34;olympicImagePath: $olympicImagePath&#34;
puts &#34;voyagerImagePath: $voyagerImagePath&#34;
puts &#34;bootrom: $bootrom&#34;
puts &#34;obuild: $obuild&#34;
puts &#34;lst: $lst&#34;
puts &#34;incrBuilds: $incrBuilds&#34;
puts &#34;rerun: $rerun&#34;
puts &#34;baseLine: $baseLine&#34;
puts &#34;stopWithPhase: $stopWithPhase&#34;
source ../Lib/mysqlLib.tcl
source ../main/cfg/common.cfg

<span class="comment-line"># Default config file</span>
set cfgFile ./runReg.cfg

<span class="comment-line"># Source config file that has Regression PC information</span>
if [file exists $cfgFile] {
    <a name="::result_debug(37)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sourcing $cfgFile now&#34;
    catch {source $cfgFile} reason
} else {
    <a name="::result_error(15)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;!!! Configuration file $cfgFile not found !!!&#34;
    return 0
}



global abortingReason
set abortingReason &#34;&#34;

global mysqlIP my_db
set host $mysqlIP
set db $my_db
global host mysql_handler

<a name="::conn_to_db(5)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db
set run_number &#34;&#34;
<span class="comment-line"># -------------------------------------------------------------------------</span>
<span class="comment-line"># Initialize database module selection variables</span>
<span class="comment-line"># -------------------------------------------------------------------------</span>
set useDbModuleSelection 1

if {$stopWithPhase == &#34;NULL&#34;} {
       set useDbPhase 0
} else {

      set useDbPhase 1
}

puts &#34;Made it this far&#34;
<span class="comment-line"># Modify exclude list from db</span>
    <span class="comment-line"># GRANT</span>
    <span class="comment-line">#my_platform_id &#34;&#34;</span>
    <span class="comment-line">#regType &#34;&#34;</span>
    <span class="comment-line">#regSubType &#34;&#34;  GRANT</span>
    set sel_clause &#34;SELECT excludes_std FROM runreg_table \
                  WHERE regplatform_regtype = '[string tolower $regType]' AND \
                  regplatform_subtype = '[string tolower $regSubType]' AND \
                  regplatform_cfg = '$cfg'&#34;
    set rslt_lst [mysqlsel $mysql_handler $sel_clause -flatlist]

    set tmpExclude &#34;&#34;
    if {[llength $rslt_lst] == 0} {
        puts &#34;$sel_clause&#34;
        puts &#34;!!!\n!!!Failed to get platform exclude information\n!!!\n!!!&#34;
    } else {
        regsub -all &#34;\n&#34; $rslt_lst &#34; &#34; rslt_lst
        set eList [split $rslt_lst &#34; &#34;]
        foreach e $eList {
           set ne [string trim $e]
           if {$ne != &#34;&#34;} {
               lappend tmpExclude $ne
           }
        }
        set exclude [concat $exclude $tmpExclude]
        puts &#34;\n\n!!! NEW EXCLUDE: $exclude&#34;
    }
<span class="comment-line"># get system_id from the database</span>
if {$system_id == &#34;NULL&#34;} {
    puts &#34;The system_id is set to NULL.  Get system_id from the database&#34;
    set system_id [mysqlsel $mysql_handler &#34;SELECT system_id FROM system_table WHERE system_name = '$system_name'&#34; -flatlist]
    puts &#34;The system_id received from the DB: $system_id&#34;
}

set number_nodes [<a name="::GetNumberNodes(1)"><a href="./mysqlRunall_monitor.tcl.html#::GetNumberNodes_971">::GetNumberNodes</a></a> $regType $regSubType]

if {($platform_id == &#34;NULL&#34;)} {
    puts &#34;We do not have platform get one&#34;
    
    if {$blade == $platform } {
        set platform_id [mysqlsel $mysql_handler &#34;SELECT platform_id FROM platform_table WHERE platform_cfg_file_name = '$cfg'&#34; -flatlist]
    } else {
        set platform_id [mysqlsel $mysql_handler &#34;SELECT platform_id FROM platform_table WHERE platform_cfg_file_name = '$cfg'&#34; -flatlist]
    }
    puts &#34;we found patform_id: $platform_id for platform_name= '$platform' AND platform_blade= '$blade' AND number_nodes='$number_nodes'&#34;
}

<span class="comment-line">###############################</span>
<span class="comment-line">#  set  target phase</span>
<span class="comment-line">#####################################</span>
if {$stopWithPhase == &#34;1&#34;} {
     set target_phase &#34;one&#34;
} elseif {$stopWithPhase == &#34;2&#34;} {
     set target_phase &#34;two&#34;
} elseif {$stopWithPhase == &#34;3&#34;} {
     set target_phase &#34;three&#34;
} else {
     set target_phase &#34;four&#34;
} 

<span class="comment-line"># -------------------------------------------------------------------------</span>
<span class="comment-line"># if we do not have a build_id</span>
<span class="comment-line"># -------------------------------------------------------------------------</span>
if {($build_id == &#34;NULL&#34;)} {
    puts &#34;We do not have build_id.  Get A Build ID&#34;
    
    if ![regexp {([0-9]+)\.([0-9]+)\.([0-9]+)[\.b]([0-9]+.*)} \
        $build_name  match \
        major minor patch build] {
            error \
            &#34;$build_name not in good format.&#34;
            return &#34;error&#34;
    }
    puts &#34;===================================================&#34;
    puts &#34;major: $major&#34;
    puts &#34;minor: $minor&#34;
    puts &#34;patch: $patch&#34;
    puts &#34;build: $build&#34;
    set build_major_release &#34;$major.$minor&#34;
    puts &#34;build_major_release: $build_major_release&#34;
    set build_minor_release &#34;$major.$minor.$patch&#34;
    puts &#34;build_minor_release: $build_minor_release&#34;
    set build_number &#34;$build&#34;
    puts &#34;build_number: $build_number&#34;
    set sel_clause &#34;SELECT build_id FROM build_table WHERE \
    build_major_release = '$build_major_release' AND \
    build_minor_release = '$build_minor_release' AND \
    build_number = '$build_number'&#34;
    set build_id [mysqlsel $mysql_handler $sel_clause -flatlist]
    puts &#34;llength of build_id_list: [llength $build_id]&#34;
    if {([llength $build_id] != 0)} {
        puts &#34;we found build_id: $build_id&#34;
    } else {
        puts &#34;we did not found build_id - enter it into the build table&#34;
        <a name="::InsertIntoBuildTable(1)"><a href="./mysqlLib.tcl.html#::InsertIntoBuildTable_162">::InsertIntoBuildTable</a></a> -system_id $system_id -build_major_release $build_major_release \
        -build_minor_release $build_minor_release -build_number $build_number -db_name $db -target_phase $target_phase
        <span class="comment-line"># get the new build_id</span>
        set build_id [mysqlsel $mysql_handler $sel_clause -flatlist]
    }
    puts &#34;===================================================&#34;
}

set feature_type $regType
if {$regSubType == &#34;ipRoute1&#34;} {
    set feature_sub_type &#34;routing&#34;
} else {
    set feature_sub_type $regSubType
}

<span class="comment-line"># if we have a regression_id</span>
if {($regression_id != &#34;NULL&#34;)} {
    puts &#34;We have regression_id&#34;
} else {
    set regression_id [<a name="::GetRegressionId(1)"><a href="./mysqlLib.tcl.html#::GetRegressionId_1604">::GetRegressionId</a></a> \
	    -build_id $build_id -platform_id $platform_id \
        -feature_type $feature_type \
        -feature_sub_type $feature_sub_type]
}

<span class="comment-line"># -------------------------------------------------------------------------------</span>
<span class="comment-line"># Check if the regression is already running</span>
<span class="comment-line">#    - safety mechanism to keep regressions from running</span>
<span class="comment-line">#      over the top of each other.</span>
<span class="comment-line"># -------------------------------------------------------------------------------</span>
set sel_clause &#34;SELECT status FROM regression_table WHERE \
        regression_id = '$regression_id'&#34;
set run_status [mysqlsel $mysql_handler $sel_clause -flatlist]
puts &#34;\n-----------\nrun_status: $run_status\n-----------&#34;

<span class="comment-line"># -------------------------------------------------------------------------------</span>
<span class="comment-line"># Check the daemon/wrapper entry for this test bed</span>
<span class="comment-line"># -------------------------------------------------------------------------------</span>
set MAIN(TrackInit) [<a name="::OpenTrackingPort(1)"><a href="./resource_track.tcl.html#::OpenTrackingPort_7">::OpenTrackingPort</a></a> -cfg &#34;[file tail $cfg]&#34; -script_name &#34;mysqlRunall_monitor&#34; -type &#34;wrapper&#34; ]

<span class="comment-line"># update the regression table with the pid</span>
set pid [pid]
mysqlexec $mysql_handler &#34;UPDATE regression_table SET regression_pid='$pid' WHERE regression_id = '$regression_id'&#34;
<span class="comment-line"># update the regression table with ip address of this linux</span>
set my_ip [<a name="::myIP(1)"><a href="./mysqlRunall_monitor.tcl.html#::myIP_529">::myIP</a></a>]
mysqlexec $mysql_handler &#34;UPDATE regression_table SET regression_ip='$my_ip' WHERE regression_id = '$regression_id'&#34;
<span class="comment-line"># get latest run number</span>
puts &#34;\n===========================================&#34;
puts &#34;Get latest run number&#34;
set sel_clause &#34;SELECT total_number_of_runs FROM regression_table WHERE \
                regression_id = '$regression_id'&#34;
set run_number [mysqlsel $mysql_handler $sel_clause -flatlist]
puts &#34;run_number: $run_number&#34;
puts &#34;regSubType: $regSubType&#34;
puts &#34;===========================================&#34;
<span class="comment-line"># -----------  end the mysql stuff ----------------</span>

<span class="comment-line"># -------------------------------------------------------------------------------</span>
<span class="comment-line"># check to see if testModuleList.cfg exists</span>
<span class="comment-line"># -------------------------------------------------------------------------------</span>
if {![file exists $modSummaryCfgPath]} {
    <a name="::result_error(16)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;\nERROR: $modSummaryCfgPath could not be found.  Please correct \
	    this error before re-running.\n&#34;
    return 0
}

source $modSummaryCfgPath

set env(EXOS_PLATFORM_TYPE) 2
set image &#34;&#34;

<span class="comment-line"># -------------------------------------------------------------------------------</span>
<span class="comment-line"># NOTE: Pass by reference</span>
<span class="comment-line"># -------------------------------------------------------------------------------</span>
if { ! [ <a name="::validatemysqlRunall_monitorArgs(1)"><a href="./mysqlRunall_monitor.tcl.html#::validatemysqlRunall_monitorArgs_146">::validatemysqlRunall_monitorArgs</a></a> blade platformIndx platform cfg regType \
         regSubType exclude forstats include download noPost mailTo i386ImagePath \
        marinerImagePath aspenImagePath cougarImagePath x480ImagePath x870ImagePath \
        NWIImagePath viperImagePath jaguarImagePath olympicImagePath voyagerImagePath \
        image rerun baseLine stopWithPhase] } {
    <a name="::::print_usage(1)"><a href="./summarize.tcl.html#::::print_usage_2">::::print_usage</a></a>
    return 0
}

if {$heuristic == &#34;yes&#34;} {
  <span class="comment-line"># ------</span>
  <span class="comment-line">#  TO DO : Dev new heuristic for cases that have never failed</span>
  <span class="comment-line"># ------</span>
    
  <span class="comment-line">#  # let PHP find the modules which have to run - find using heuristic approach</span>
  <span class="comment-line">#  set regression_id_url [http_formatQuery regression_id $regression_id]</span>
  <span class="comment-line">#  # puts &#34;regression_id_url: $regression_id_url&#34;</span>
  <span class="comment-line">#  </span>
  <span class="comment-line">#  #set filterModulesURL &#34;http://10.210.1.59/filterModules.php&#34;</span>
  <span class="comment-line">#  if {$my_db == &#34;autoweb_db_4&#34; || $my_db == &#34;autoweb_db_5&#34;} {</span>
  <span class="comment-line">#    set filterModulesURL &#34;http://$mysqlIP/phpdb4/filterModules.php&#34;</span>
  <span class="comment-line">#  } ellse {</span>
  <span class="comment-line">#    set filterModulesURL &#34;http://$mysqlIP/filterModules.php&#34;</span>
  <span class="comment-line">#  }</span>
  <span class="comment-line">#  set filterModulesURL [append filterModulesURL &#34;?$regression_id_url&#34;]</span>
  <span class="comment-line">#  puts &#34;filterModulesURL: $filterModulesURL&#34;</span>
  <span class="comment-line">#  set token [http_get $filterModulesURL -timeout 1000000 ]</span>
  <span class="comment-line">#  upvar #0 $token httpState</span>
  <span class="comment-line">#  while { [string match eof $httpState(state)] != 1 } {</span>
  <span class="comment-line">#  puts stderr &#34;$httpState(state) [string match eof $httpState(state)]&#34;</span>
  <span class="comment-line">#  flush stderr</span>
  <span class="comment-line">#  after 100</span>
  <span class="comment-line"># }</span>
  <span class="comment-line">#  set allTypeModules [http_data httpState]</span>
}

<span class="comment-line"># -----------------------------------------------------------</span>
<span class="comment-line"># Get all possible modules to run in order of the exec times</span>
<span class="comment-line"># -----------------------------------------------------------</span>
global FeatureInfo
global FeatureIdInfo
global PlatformInfo
global RegressionInfo
global DebugOn
global DebugOnHi
global ForceTimeUpdate
global exclude
<span class="comment-line"># -----------------------------------------------------------</span>
<span class="comment-line"># Set the regression subtype either function or routing</span>
<span class="comment-line"># -----------------------------------------------------------</span>
set regSubTypeThis $regSubType
if {$regSubTypeThis == &#34;ipRoute1&#34;} {
    set regSubTypeThis &#34;routing&#34;
}
switch $regType {
    &#34;functional&#34; { set myRegPath &#34;Functionaltest&#34; }
    &#34;ixscriptmate&#34; { set myRegPath &#34;ixScriptMate&#34; }
    &#34;cli&#34; {
    	if { $regSubType == &#34;uploadanddownload&#34; } {
    	    set myRegPath &#34;../CLItest/uploadanddownload&#34;
    	} else {
    	    set myRegPath &#34;../CLItest/upgradedowngrade&#34;
    	}
    }
    &#34;scalability&#34; { set myRegPath &#34;Scalabilitytest&#34; }
    &#34;snmp&#34; { set myRegPath &#34;SnmpFunctionaltest&#34; }
    &#34;xml&#34; { set myRegPath &#34;XML_API&#34; }
    &#34;fit&#34; { set myRegPath &#34;FeatureInteraction&#34; }
    default { set myRegPath &#34;Functionaltest&#34; }
}

puts &#34;===========================================&#34;
puts &#34;regtype=$regType&#34;
puts &#34;regsubtype=$regSubTypeThis&#34;
puts &#34;--------------------------------------------&#34;
puts &#34;Regression Path: $myRegPath&#34;
puts &#34;===========================================&#34;

<span class="comment-line">##################################################</span>
<span class="comment-line">#  Create java files for XML_APIs if needed </span>
<span class="comment-line">###################################################</span>
if {$regType == &#34;xml&#34;} {
    set my_ip_list [split $my_ip &#34;.&#34;]
    set my_ip_last [lindex $my_ip_list end]
    
    set xml_sync_table_this xml_sync_table_
    set xml_sync_table_this [append xml_sync_table_this $my_ip_last]
    
    <span class="comment-line"># lock the protected region - max wait 240 seconds</span>
    set lock_rslt [<a name="::getLock(1)"><a href="./mysqlLib.tcl.html#::getLock_2282">::getLock</a></a> $my_ip_last 240]
    puts &#34;lock_rslt $lock_rslt&#34;
    if {$lock_rslt != 1} {
        <span class="comment-line"># set status to none in order not to leave the database in a wrong state</span>
        set rslt [mysqlexec $mysql_handler &#34;UPDATE $xml_sync_table_this SET status='none' WHERE build = '$image'&#34;]
        <a name="::result_error(17)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;\nERROR: Couldn't get XML Java creation lock.\n&#34;
    }
    
    set xml_status [mysqlsel $mysql_handler &#34;SELECT status FROM \
          $xml_sync_table_this WHERE build = '$image'&#34; -flatlist]
    puts &#34;xml_status $xml_status&#34;
    if {$xml_status == &#34;&#34;} {
        set insert_clause [append insert_clause &#34;insert into \
                                       $xml_sync_table_this &#34;]
        set insert_clause [append insert_clause &#34;(build) &#34;]
        set insert_clause [append insert_clause &#34;values (\&#34;$image\&#34;) &#34;]
        
        set rslt [mysqlexec  $mysql_handler $insert_clause]
        
        if {($xml_status == &#34;&#34;) || ($xml_status == &#34;none&#34;)} {
            <span class="comment-line"># lets create the java code</span>
            <span class="comment-line"># clear all the entries</span>
            set rslt [mysqlexec $mysql_handler &#34;UPDATE $xml_sync_table_this \
                                                          SET status='none'&#34;]
            <span class="comment-line"># set status to creating java code</span>
            set rslt [mysqlexec $mysql_handler &#34;UPDATE $xml_sync_table_this \
                               SET status='creating' WHERE build = '$image'&#34;]
            if {[regexp -nocase &#34;OLY&#34; $platformIndx]} {
                set myImagePath $olympicImagePath
            } elseif {[regexp -nocase &#34;MAR&#34; $platformIndx]} {
                set myImagePath $marinerImagePath
            } elseif {[regexp -nocase &#34;JAG&#34; $platformIndx]} {
                set myImagePath $jaguarImagePath
            } elseif {[regexp -nocase &#34;TOR&#34; $platformIndx]} {
                set myImagePath $olympicImagePath
            } elseif {[regexp -nocase &#34;COU&#34; $platformIndx]} {
                set myImagePath $cougarImagePath
            } elseif {[regexp -nocase &#34;VIP&#34; $platformIndx]} {
                set myImagePath $viperImagePath
            } elseif {[regexp -nocase &#34;SYL|x480&#34; $platformIndx]} {
                set myImagePath $x480ImagePath
            } elseif {[regexp -nocase &#34;SLF|x870&#34; $platformIndx]} {
                set myImagePath $x870ImagePath
            } elseif {[regexp -nocase &#34;ASP&#34; $platformIndx]} {
                set myImagePath $aspenImagePath
            } elseif {[regexp -nocase &#34;STA&#34; $platformIndx]} {
                set myImagePath $jaguarImagePath
            } elseif {[regexp -nocase &#34;VOY|PAT&#34; $platformIndx]} {
                set myImagePath $voyagerImagePath
            } else {
                set myImagePath $cougarImagePath
            }
            
            <span class="comment-line"># strip the build file name from the path</span>
            set myImagePath [file dirname $myImagePath]
            set mainPwd [pwd]
            cd &#34;../XML_API/API_Java&#34;
            puts &#34;pwd [pwd]&#34;
            global env
            set env(JAVA_HOME) /mnt/stools/jdk/jdk1.5.0_08/
            set javaStat [catch {exec /mnt/stools/ant/apache-ant-1.7.0Beta1/bin/ant \
                 -f build.xml \
                 -D&#34;axis.home=/mnt/software_tools/apache/axis/axis-1_4&#34; \
                 -D&#34;scratch.home=../../main/Tmp&#34; \
                 -D&#34;release.home=$myImagePath&#34; \
                 -D&#34;libsshcli.home=../Lib&#34; \
                 complete_compile &gt;&amp;@stdout} result]
            puts &#34;javaStat $javaStat&#34;
            cd $mainPwd
            if {$javaStat != 0} {
                <a name="::result_error(18)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;\nERROR: XML java code creation failed.\n&#34;
                <a name="::result_error(19)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;$result&#34;
                return 0
            }
            <span class="comment-line"># update database</span>
            set rslt [mysqlexec $mysql_handler &#34;UPDATE $xml_sync_table_this \
                                  SET status='ready' WHERE build = '$image'&#34;]
            
        } elseif {$xml_status == &#34;ready&#34;} {
            puts &#34;XML JAVA code READY for build $image&#34;
        }
        
        <span class="comment-line"># inlock the protected region</span>
        set unlock_rslt [<a name="::releaseLock(1)"><a href="./mysqlLib.tcl.html#::releaseLock_2291">::releaseLock</a></a> $my_ip_last]
        puts &#34;unlock_rslt $unlock_rslt&#34;
    }
}

<span class="comment-line">##################################################</span>
<span class="comment-line">#  Download image if needed </span>
<span class="comment-line">###################################################</span>
if {($image != &#34;&#34;) &amp;&amp; [regexp -nocase &#34;yes&#34; $download] } {

    if {! [<a name="::handleImageDownload(1)"><a href="./mysqlRunall_monitor.tcl.html#::handleImageDownload_414">::handleImageDownload</a></a> $cfg $i386ImagePath $marinerImagePath \
            $aspenImagePath $cougarImagePath $x480ImagePath $NWIImagePath $viperImagePath $jaguarImagePath $olympicImagePath $voyagerImagePath $bootrom ]} {
	
	set  notificationData  &#34;\nHOST  PC:  [exec hostname] \
		\nSTARTED:  $startTime \
		\nENDED:    [exec date] \
		\nIMAGE:    $i386ImagePath \
		\nIMAGE:    $marinerImagePath \
		\nIMAGE:    $aspenImagePath \
		\nIMAGE:    $cougarImagePath \
        \nIMAGE:    $x480ImagePath \
        \nIMAGE:    $x870ImagePath \
        \nIMAGE:    $NWIImagePath \
        \nIMAGE:    $viperImagePath \
		\nIMAGE:    $jaguarImagePath \
		\nIMAGE:    $olympicImagePath \
		\nIMAGE:    $voyagerImagePath \
		\nCFG:      $cfg \
		\nINCLUDE:  $include \
		\nEXCLUDE:  $exclude \
		\nREGPATH:  $myRegPath \               
                \nRERUN :   $rerun \
                \nBASELINE: $baseLine\
                \nSTOPWITHPHASE: $stopWithPhase\n&#34;
	;<span class="comment-line"># Unable to download image.</span>
	sendMailNotification $mailTo \
		&#34;$cfg Image download FAILED&#34; \
		&#34;Image download for $cfg FAILED. Please debug and restart. \
		$notificationData&#34;
	
	<a name="::result_error(20)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;IMAGE DOWNLOAD Failed!&#34;
	return 0
    }
}
sleep 5

;<span class="comment-line"># Get the regPath $myRegPath</span>
set regPath $myRegPath
<a name="::result_debug(38)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;regPath: $regPath&#34;

<span class="comment-line"># -------------------------------------------------------------------------</span>
<span class="comment-line">#  05-19-09 - Load Balancing of modules to run.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  The logic for deciding which module to run is broken down into 4 phases.</span>
<span class="comment-line">#  Prior to the db logic that follows, the include or exclude list was used</span>
<span class="comment-line">#  to decide what to run next.  This db method of module selection allows </span>
<span class="comment-line">#  for dynamic, perfectly balanced.</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Phase - 1 : Functional run :  single module single testbed </span>
<span class="comment-line">#  Phase - 2 : chipset level functional run :  Broadcom + GNSS/Voyager</span>
<span class="comment-line">#  Phase - 3 : Platform level functional run :</span>
<span class="comment-line">#  Phase - 4 : Blade level functional run :</span>
<span class="comment-line"># -------------------------------------------------------------------------</span>

<span class="comment-line"># -------------------------------------------------------------------------</span>
<span class="comment-line">#  The include and exclude lists will still be used.</span>
<span class="comment-line">#    Include will override the db selection of the next module</span>
<span class="comment-line">#    Exclude will cause the selected module to skip execution</span>
<span class="comment-line"># -------------------------------------------------------------------------</span>
if {!$useDbPhase &amp;&amp; $include == &#34;&#34;} {
    set useDbModuleSelection 0
    set allTypeModules [mysqlsel $mysql_handler &#34;SELECT feature_directory \
    FROM feature_table WHERE status = 'Active' AND feature_type = '$regType' AND \
    feature_sub_type = '$regSubTypeThis' AND (end_release_id = '' OR end_release_id &gt;= '$build_minor_release') AND (start_release_id = '' OR start_release_id &lt;= '$build_minor_release') ORDER BY feature_directory ASC&#34; -flatlist]


    <span class="comment-line"># -------------------------------------------------------------------------</span>
    <span class="comment-line"># Last module to be determined by db call procedure</span>
    <span class="comment-line"># -------------------------------------------------------------------------</span>
    set lastModule [lindex $allTypeModules [expr [llength $allTypeModules] - 1]]
} elseif {$include != &#34;&#34; &amp;&amp; !$useDbPhase} {
    ;<span class="comment-line"># Rebuild $allTypeModules list with only included modules</span>
    set useDbModuleSelection 0
    set allTypeModules &#34;&#34;
    set allTypeModules $include
    <span class="comment-line"># -------------------------------------------------------------------------</span>
    <span class="comment-line"># Last module to be determined by db call procedure</span>
    <span class="comment-line"># -------------------------------------------------------------------------</span>
    set lastModule [lindex $allTypeModules [expr [llength $allTypeModules] - 1]]
    <a name="::result_debug(39)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;=============================================================&#34;
    <a name="::result_debug(40)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;INCLUDE LIST SELECTED REGRESSION RUN&#34;
    <a name="::result_debug(41)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$allTypeModules&#34;
    <a name="::result_debug(42)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;=============================================================&#34;
} else {
    set useDbModuleSelection 1
    ;<span class="comment-line"># Remove regPath param from $allTypeModules</span>
    ;<span class="comment-line"># set allTypeModules [lrange $allTypeModules 1 \</span>
    ;<span class="comment-line">#	    [expr [llength $allTypeModules] - 1] ]</span>

    <span class="comment-line"># -------------------------------------------------------------------------</span>
    <span class="comment-line"># Last module to be determined by db call procedure</span>
    <span class="comment-line"># -------------------------------------------------------------------------</span>
    ;<span class="comment-line">#set lastModule [lindex $allTypeModules [expr \</span>
    ;<span class="comment-line">#	[llength $allTypeModules] - 1]]</span>
    set lastModule &#34;&#34;
    <a name="::result_debug(43)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;=============================================================&#34;
    <a name="::result_debug(44)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34; DATABASE SELECTED REGRESSION RUN&#34;
    <a name="::result_debug(45)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;=============================================================&#34;
}
;<span class="comment-line"># Write logs to file</span>
flush $fd_res

<span class="comment-line"># -------------------------------------------------------------------------</span>
<span class="comment-line"># Set the globals</span>
<span class="comment-line"># -------------------------------------------------------------------------</span>
global FCOUNT
set createConfig 0
<span class="comment-line"># Default mode to use for main.tcl (auto | dev | autodev )</span>
set modeToUse &#34;auto&#34;
set modeFast   1  ;<span class="comment-line"># Use auto for first module, then autodev for next</span>
set heuristicTCList &#34;null&#34; ;<span class="comment-line"># Heuristic only exec previously failed cases</span>
set DebugOn 0 
set DebugOnHi 1 
set ForceTimeUpdate 0

if {![file isdirectory Tmp]} {
        file mkdir Tmp
}

<span class="comment-line"># -------------------------------------------------------------------------</span>
<span class="comment-line"># set regression status to running</span>
<span class="comment-line"># -------------------------------------------------------------------------</span>
mysqlexec $mysql_handler &#34;UPDATE regression_table SET status='running' WHERE regression_id = '$regression_id'&#34; 

<span class="comment-line"># WE RUN THIS TWICE IF RerunEnabled is set or pass_number is 2</span>
<span class="comment-line"># calculate i</span>
if {$pass_number == &#34;&#34; || $pass_number == &#34;NULL&#34;} {
  set pass_number 1
}
if {[info exists RerunEnabled] &amp;&amp; ($RerunEnabled)} {
  set max_runs 2
} else {
  set max_runs 1
}

if {$pass_number == 2} {
  set max_runs 2
}

    <span class="comment-line"># -------------------------------------------------------------------------</span>
    <span class="comment-line"># Include list case.  Just loop on the include list</span>
    <span class="comment-line"># -------------------------------------------------------------------------</span>
    if {!$useDbModuleSelection} {
        <a name="::result_debug(46)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Not using DB module selection&#34;
        set FCOUNT 0
        <span class="comment-line"># ---------------------------------------------------------------------</span>
        <span class="comment-line"># If include is passed in we automatically skip DB logic</span>
        <span class="comment-line"># ---------------------------------------------------------------------</span>
        set initList $lst
        foreach testModule $allTypeModules {
            
             set status &#34;OK&#34;
            
             <span class="comment-line">#puts &#34;STARTING RUN NUMBER: $i&#34;</span>
             puts &#34;LAST: $lastModule  TEST:$testModule&#34;
            
             if {([string equal -nocase $lastModule $testModule] == 1) &amp;&amp; \
                (! [regexp -nocase &#34;perf&#34; $regType])} {
                    set createConfig 1
                    <a name="::result_debug(47)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;****** SETTING CREATE CONFIG to 1 ******&#34;
             } 
            
             <span class="comment-line"># For initial release, keep everything in AUTO mode</span>
             set modeToUse &#34;auto&#34;
             <span class="comment-line">#If user didn't pass the lst to run get it from db</span>
             set lst $initList
             if {$lst == &#34;NULL&#34;} {
                 set lst [string trim [mysqlsel $mysql_handler \
                       &#34;SELECT list_to_run FROM feature_table WHERE \
                       feature_type = \&#34;$regType\&#34; AND feature_directory = \&#34;$testModule\&#34; \
                       AND feature_sub_type = \&#34;$feature_sub_type\&#34;&#34; -flatlist] &#34;{}&#34;] 
             }
             puts &#34;*************** RUNNING in $modeToUse *****************&#34; 
             for {set i $pass_number} {$i &lt;= $max_runs} {incr i} {
                
                 mysqlexec $mysql_handler &#34;UPDATE regression_table SET total_number_of_runs='$i' \
                           WHERE regression_id = '$regression_id'&#34;
                 <a name="::UpdateTrackDBTxt(1)"><a href="./resource_track.tcl.html#::UpdateTrackDBTxt_133">::UpdateTrackDBTxt</a></a> &#34;runModuleRegression: $testModule&#34;;
                 set status [<a name="::runModuleRegression(1)"><a href="./mysqlRunall_monitor.tcl.html#::runModuleRegression_688">::runModuleRegression</a></a> -testModule $testModule -modeToUse $modeToUse \
                        -regPath $regPath -cfg $cfg -noPost $noPost \
    	                -createConfig $createConfig -regType $regType -regSubType $regSubType \
                        -platformIndx $platformIndx -platform $platform -blade $blade \
                        -image $image -obuild $obuild -regression_id $regression_id \
                        -host $host -db $db -build_name $build_name -subversion $subversion \
                        -run_number $i -lst $lst -efence $efence \
                        -saveConfigPerTest $saveConfigPerTest -debugLevel $debugLevel]
             }
             <span class="comment-line">####Module is done compare the results with baseLine#######################################</span>
             if {$baseLine != &#34;NULL&#34;} {
                 <a name="::mailNewFailures(1)"><a href="./mysqlLib.tcl.html#::mailNewFailures_4237">::mailNewFailures</a></a> -cfg $cfg -module $testModule -build $build_name -baseLine $baseLine
             }
            
             set conn [<a name="::conn_to_db(6)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db]
             if [regexp -nocase &#34;FATAL_ERROR&#34; $status] {
                 <a name="::UpdateTrackDBTxt(2)"><a href="./resource_track.tcl.html#::UpdateTrackDBTxt_133">::UpdateTrackDBTxt</a></a> &#34;FATAL ERROR: $testModule&#34;;
                 <a name="::result_debug(48)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
                 <a name="::result_debug(49)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;  ** ABORTED ** RUNALL_MONITOR.TCL -- $testModule ** ABORTED **&#34;
                 <a name="::result_debug(50)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
                
                 <span class="comment-line"># DISABLING THIS - ONLY THE WATCHDOG WILL SET THE STATUS TO CRASHED</span>
                 <span class="comment-line"># set regression status to crashed</span>
                 <span class="comment-line"># mysqlexec $mysql_handler &#34;UPDATE regression_table SET status='crashed' \</span>
                 <span class="comment-line">#                                  WHERE regression_id = '$regression_id'&#34; </span>
                 return 0  ;<span class="comment-line"># QUIT</span>
             }

            
             <span class="comment-line"># ------------------------</span>
             if {$FCOUNT &gt; 2} {
                 <span class="comment-line"># ----------------------------------------------------------------</span>
                 <span class="comment-line">#   Too many errors set current_run_table to locked by admin</span>
                 <span class="comment-line">#</span>
                 <span class="comment-line"># ----------------------------------------------------------------</span>
                 <a name="::CheckAndPauseRegression(2)"><a href="./mysqlLib.tcl.html#::CheckAndPauseRegression_2773">::CheckAndPauseRegression</a></a> -regression_id $regression_id -feature_directory $testModule \
                                    -admin_email $mailTo -pauseType &#34;error&#34; -regCfg $cfg
                 set FCOUNT 0;
             }
        }      
    } else {
        <span class="comment-line"># -------------------------------------------------------------------------</span>
        <span class="comment-line"># Phase logic database section.</span>
        <span class="comment-line"># -------------------------------------------------------------------------</span>
        <a name="::result_debug(51)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;In Phased Logic Section&#34;
        <span class="comment-line"># Counter for fatal errors</span>
        set FCOUNT 0;
        set FeatureInfo &#34;&#34;
        set FeatureIdInfo &#34;&#34;
        set PlatformInfo &#34;&#34;
        set RegressionInfo &#34;&#34;
        set LastFeature &#34;&#34;
        set initList $lst
        while {1} {
            
            unset FeatureInfo
            unset FeatureIdInfo
            unset PlatformInfo
            unset RegressionInfo
            set status &#34;OK&#34;

            <span class="comment-line"># ------------------------</span>
            if {$FCOUNT &gt; 2} {
                <span class="comment-line"># ----------------------------------------------------------------</span>
                <span class="comment-line">#   Too many errors set current_run_table to locked by admin  </span>
                <span class="comment-line">#</span>
                <span class="comment-line"># ----------------------------------------------------------------</span>
                <a name="::CheckAndPauseRegression(3)"><a href="./mysqlLib.tcl.html#::CheckAndPauseRegression_2773">::CheckAndPauseRegression</a></a> -regression_id $regression_id -feature_directory $testModule \
                                    -admin_email $mailTo -pauseType &#34;error&#34; -regCfg $cfg
                set FCOUNT 0;
            }
            <span class="comment-line">#puts &#34;STARTING RUN NUMBER: $i&#34;</span>
            <span class="comment-line"># ---------------------------------------------------------------------</span>
            <span class="comment-line"># ---------------------------------------------------------------------</span>
            <span class="comment-line">#  Pick a module to run.  The phase logic is all contained within this</span>
            <span class="comment-line">#     proc</span>
            <span class="comment-line"># ---------------------------------------------------------------------</span>
            <span class="comment-line"># ---------------------------------------------------------------------</span>
            set testModule [<a name="::GetModulePhased(1)"><a href="./mysqlLib.tcl.html#::GetModulePhased_2918">::GetModulePhased</a></a> -build_id $build_id -regression_id $regression_id \
                     -my_platform_id $platform_id -regType $regType -regSubType $regSubTypeThis \
                     -incrBuilds $incrBuilds -build_minor_release $build_minor_release]
            set lst $initList
            if {$lst == &#34;NULL&#34;} {
                  set lst [string trim [mysqlsel $mysql_handler \
                     &#34;SELECT list_to_run FROM feature_table WHERE feature_type = \&#34;$regType\&#34; \
                     AND feature_directory = \&#34;$testModule\&#34; AND \
                     feature_sub_type = \&#34;$feature_sub_type\&#34;&#34; -flatlist] &#34;{}&#34;]
            }
            puts &#34;New Test Module $testModule&#34;
            set tExclude [join $exclude &#34; &#34;]
            if {$testModule == &#34;&#34; || $testModule == 0} {
                incr FCOUNT;
                continue;
            } elseif {$testModule == &#34;Finished&#34;} {
                <a name="::result_debug(52)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
                <a name="::result_debug(53)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;            ** Finished with Database Automation Run **&#34;
                <a name="::result_debug(54)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
                break
            } elseif {[string match &#34;$testModule&#34; &#34;$tExclude&#34;]} {
                <a name="::result_debug(55)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
                <a name="::result_debug(56)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;            ** Module $testModule is in the String Match Exclude **&#34;
                <a name="::result_debug(57)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
                continue;
            } else {
puts &#34;$testModule === $exclude\n$tExclude&#34;
                <a name="::result_debug(58)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
                <a name="::result_debug(59)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;            ** Database Automation Run NOT Complete  **&#34;
                <a name="::result_debug(60)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
            }
            <span class="comment-line">#puts &#34;LAST: $lastModule  TEST:$testModule&#34;</span>
            <span class="comment-line">#</span>
            <span class="comment-line">#if {([string equal -nocase $lastModule $testModule] == 1) &amp;&amp; \</span>
            <span class="comment-line">#(! [regexp -nocase &#34;perf&#34; $regType])} {</span>
            <span class="comment-line">#set createConfig 1</span>
            <span class="comment-line">#result_debug &#34;****** SETTING CREATE CONFIG to 1 ******&#34;</span>
            <span class="comment-line">#} </span>
            
            <span class="comment-line"># For initial release, keep everything in AUTO mode</span>
            set modeToUse &#34;auto&#34;
            <span class="comment-line"># ------------------------------------------------------------</span>
            <span class="comment-line"># Init the Feature getting ready to run.  We need to have a safety</span>
            <span class="comment-line">#   so as to not re-run the same module over and over should mysqlAutomate</span>
            <span class="comment-line">#   fail to post results correctly.</span>
            <span class="comment-line"># ------------------------------------------------------------</span>
            if {$LastFeature == $testModule} {
                <a name="::result_debug(61)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
                <a name="::result_debug(62)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;    !!!!! M Y S Q L A U T O M A T E  is not  P O S T I N G   !!!!!    &#34;
                <a name="::result_debug(63)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
                lappend exclude $testModule
                continue
            }
            puts &#34;*************** RUNNING in $modeToUse *****************&#34; 
           for {set i $pass_number} {$i &lt;= $max_runs} {incr i} {
                <a name="::UpdateTrackDBTxt(3)"><a href="./resource_track.tcl.html#::UpdateTrackDBTxt_133">::UpdateTrackDBTxt</a></a> &#34;runModuleRegression $testModule&#34;;<span class="comment-line"># tracking db location</span>
                mysqlexec $mysql_handler &#34;UPDATE regression_table SET \
                     total_number_of_runs='$i' WHERE regression_id = '$regression_id'&#34;
                set status [<a name="::runModuleRegression(2)"><a href="./mysqlRunall_monitor.tcl.html#::runModuleRegression_688">::runModuleRegression</a></a> -testModule $testModule -modeToUse $modeToUse \
                        -regPath $regPath -cfg $cfg -noPost $noPost \
    	                -createConfig $createConfig -regType $regType -regSubType $regSubType \
                        -platformIndx $platformIndx -platform $platform -blade $blade \
                        -image $image -obuild $obuild -regression_id $regression_id \
                        -host $host -db $db -build_name $build_name -subversion $subversion \
                        -run_number $i -lst $lst -efence $efence \
                        -saveConfigPerTest $saveConfigPerTest -debugLevel $debugLevel]
          }
          <span class="comment-line">#### Module is done Compare the results with base line and mail teh results ####</span>
          if {$baseLine != &#34;NULL&#34;} {
               <a name="::mailNewFailures(2)"><a href="./mysqlLib.tcl.html#::mailNewFailures_4237">::mailNewFailures</a></a> -cfg $cfg -module $testModule -build $build_name -baseLine $baseLine
          }
           
          set conn [<a name="::conn_to_db(7)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db]

          if [regexp -nocase &#34;FATAL_ERROR&#34; $status] {
              <a name="::UpdateTrackDBTxt(4)"><a href="./resource_track.tcl.html#::UpdateTrackDBTxt_133">::UpdateTrackDBTxt</a></a> &#34;FATALERROR: $testModule&#34;;<span class="comment-line"># tracking db location</span>
              <a name="::result_debug(64)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
              <a name="::result_debug(65)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;            ** ABORTED ** RUNALL_MONITOR.TCL ** ABORTED **&#34;
              <a name="::result_debug(66)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
              incr FCOUNT
          } else {
                set FCOUNT 0;
          }
          if {$FCOUNT &gt; 2} {
              <a name="::UpdateTrackDBTxt(5)"><a href="./resource_track.tcl.html#::UpdateTrackDBTxt_133">::UpdateTrackDBTxt</a></a> &#34;FCOUNT PAUSE: $testModule&#34;;
              <span class="comment-line"># ----------------------------------------------------------------</span>
              <span class="comment-line">#   Too many errors set current_run_table to locked by admin  </span>
              <span class="comment-line">#</span>
              <span class="comment-line"># ----------------------------------------------------------------</span>
              <a name="::CheckAndPauseRegression(4)"><a href="./mysqlLib.tcl.html#::CheckAndPauseRegression_2773">::CheckAndPauseRegression</a></a> -regression_id $regression_id -feature_directory $testModule \
                                    -admin_email $mailTo -pauseType &#34;error&#34; -regCfg $cfg
              set FCOUNT 0;
          }
          set LastFeature $testModule;
          <span class="comment-line">##  BOTTOM of PHASED LOGIC LOOP</span>
       }
    }

    set  notificationData  &#34;\nHOST PC:  [exec hostname] \
	\nSTARTED:  $startTime \
	\nENDED:    [exec date] \
	\nIMAGE:    $i386ImagePath \
	\nIMAGE:    $marinerImagePath \
	\nIMAGE:    $aspenImagePath \
	\nIMAGE:    $cougarImagePath \
        \nIMAGE:    $x480ImagePath \
        \nIMAGE:    $x870ImagePath \
        \nIMAGE:    $NWIImagePath \
        \nIMAGE:    $viperImagePath \
	\nIMAGE:    $jaguarImagePath \
	\nIMAGE:    $olympicImagePath \
	\nIMAGE:    $voyagerImagePath \
	\nDOWNLOAD: $download \
	\nCFG:      $cfg \
	\nINCLUDE:  $include \
	\nEXCLUDE:  $exclude \
        \nRERUN  :  $rerun \
        \nBASELINE: $baseLine \
        \nSTOPWITHPHASE: $stopWithPhase \\n&#34;


if {$abortingReason == &#34;connectionBad&#34;} {
    set notificationData &#34;$notificationData\n\
	    REGRESSION ABORTED DUE TO: $abortingReason&#34;
    <span class="comment-line"># DISABLING THIS - ONLY THE WATCHDOG WILL SET THE STATUS TO CRASHED</span>
    <span class="comment-line"># set regression status to crashed</span>
    <span class="comment-line"># mysqlexec $mysql_handler &#34;UPDATE regression_table SET status='crashed' WHERE regression_id = '$regression_id'&#34; </span>
} elseif [llength $erroredModules] {
    set notificationData &#34;$notificationData\n\
	    MODULES ABNORMALLY TERMINATED DURING RUN: $erroredModules&#34;
    <span class="comment-line"># DISABLING THIS - ONLY THE WATCHDOG WILL SET THE STATUS TO CRASHED</span>
    <span class="comment-line"># set regression status to crashed</span>
    <span class="comment-line"># mysqlexec $mysql_handler &#34;UPDATE regression_table SET status='crashed' WHERE regression_id = '$regression_id'&#34; </span>
}

sendMailNotification $mailTo \
	&#34;$cfg RUNALL_MONITOR finished&#34; \
	&#34;Congratulations! runall_monitor.tcl for $cfg has completed $regType tests.\n \
	$notificationData&#34;

<span class="comment-line"># set regression status to finished</span>
puts &#34;set regression status to finished&#34;
puts &#34;we probably lost the mysql connection here, let's reopen it&#34;
if {[catch {mysqlclose $mysql_handler} reason]} {
    puts &#34;couldn't close mysql connection - reason:\n$reason\n&#34;
}
<a name="::conn_to_db(8)"><a href="./mysqlLib.tcl.html#::conn_to_db_8">::conn_to_db</a></a> $host $db
mysqlexec $mysql_handler &#34;UPDATE regression_table SET status='finished' WHERE regression_id = '$regression_id'&#34; 

<span class="comment-line">#NEW GRANT</span>
<a name="::TrackingCleanup(1)"><a href="./resource_track.tcl.html#::TrackingCleanup_70">::TrackingCleanup</a></a>;

<a name="::result_debug(67)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
<a name="::result_debug(68)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;                      RUNALL_MONITOR.TCL FINISHED!&#34;
<a name="::result_debug(69)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;######################################################################&#34;
<a name="::result_debug(70)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$notificationData&#34;
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
