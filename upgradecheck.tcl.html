<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>upgradecheck.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#upgradecheck.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>upgradecheck.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="upgradecheck.tcl-annot.html">annotations</a> | <a href="upgradecheck.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::UpgradeCheck_2">proc <a href="upgradecheck.tcl-annot.html#::::UpgradeCheck">::::UpgradeCheck</a></a></strong><a name="::::UpgradeCheck"></a> {fileList index nbuild obuild} {

   <span class="comment-line">################################################################</span>
   set testNo &#34;UpgradeCheck&#34;;
   set title &#34;CLI Upgrade and Downgrade Check&#34;;
   <span class="comment-line">################################################################</span>

   <span class="comment-line"># ----- Test variables setup</span>
   set fd_res [<a name="::open_result_file(1)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;$testNo&#34;];
   set time1 [clock seconds];

   result_h1 &#34;$title&#34;;
   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$title&#34;;

   global DUT1_CONNECT;
   global DUT1_SETUP;
   global DUTs_info;
   global moduleRegression;
   global optionalFlag;
   global tftpServerList;
   global switchPort2DefaultRouter

   set platform [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]

   <a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT;
   set time2 [clock seconds];
   result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;;
   <a name="::close_result_file(1)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>;
   <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

   set path &#34;../../cli-ew/$moduleRegression&#34;;
   puts &#34;DEBUG: fileList: $fileList&#34;
   set fileList [split $fileList &#34;\n&#34;];
   puts &#34;DEBUG: fileList: $fileList&#34;;
   set tmpPath &#34;Tmp&#34;;
   set firstFile	true

   foreach line $fileList {
<span class="comment-line">#      set filename1 [string trimleft $filename &#34; &#34;];</span>
<span class="comment-line">#      set filename [string trimleft $filename1 &#34;\t&#34;];</span>
      regsub -all &#34;\t&#34; $line &#34; &#34; line
      regsub -all &#34;;&#34; $line &#34; &#34; line
      regsub -all &#34; +&#34; $line &#34; &#34; line
      set line [string trimleft $line &#34; &#34;];
      set filename [lindex [split $line &#34; &#34;] 0];
      puts &#34;DEBUG: filename: $filename&#34;;
      if {$filename == &#34;&#34; || [string index $filename 0] == &#34;#&#34;} {
          continue;
      }
if { 1 } {
      set fn &#34;$path/$filename.cli&#34;;
   
      <span class="comment-line">#puts &#34;filename: &lt;$fn&gt;&#34;;</span>
      <span class="comment-line">#puts &#34;index $index&#34;;</span>
      puts &#34;***************** PWD: [pwd]  fn: $fn *****************&#34;
      set CLIList [<a name="::LoadCLIFile(1)"><a href="./CLIFileParser.tcl.html#::LoadCLIFile_11">::LoadCLIFile</a></a> $fn];
      set listLength [llength $CLIList];
      if {$listLength == 0} { continue; }
      set firstLine [lindex $CLIList 0];
      if {[<a name="::CheckSkipVersion(1)"><a href="./CLIFileParser.tcl.html#::CheckSkipVersion_312">::CheckSkipVersion</a></a> $firstLine $nbuild] || [<a name="::CheckSkipVersion(2)"><a href="./CLIFileParser.tcl.html#::CheckSkipVersion_312">::CheckSkipVersion</a></a> $firstLine $obuild]} {
          puts &#34;DEBUG: $filename.cli skipped - $nbuild and $obuild in $firstLine&#34;;
          continue;
      }

      set fd_res1 [<a name="::open_result_file(2)"><a href="./result.tcl.html#::open_result_file_276">::open_result_file</a></a> &#34;$filename&#34;];      
      set time1 [clock seconds];

      regexp -nocase {([0-9.]+)(.*)} $nbuild dummy nbuildVer patch;
      regexp -nocase {([0-9]+).([0-9]+).([0-9]+).([0-9]+)} $nbuildVer dummy p1 p2 p3 p4;
      set nVersion &#34;v${p1}${p2}${p3}b${p4}${patch}&#34;;

      regexp -nocase {([0-9.]+)(.*)} $obuild dummy obuildVer patch;
      regexp -nocase {([0-9]+).([0-9]+).([0-9]+).([0-9]+)} $obuildVer dummy p1 p2 p3 p4;
      set oVersion &#34;v${p1}${p2}${p3}b${p4}${patch}&#34;;

      set testcaseNo &#34;$filename&#34;;
      <span class="comment-line">################################################</span>
      set subTest &#34;$moduleRegression $filename&#34;;
      <span class="comment-line">################################################</span>
      result_h2 &#34;$subTest&#34;;
      <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
      
<span class="comment-line">#      RunSetupScript $DUT0_CONNECT $DUT1_SETUP;</span>
<span class="comment-line">#      if { $firstFile == &#34;false&#34; } { </span>
<span class="comment-line">#         SendACmd &#34;use image primary&#34;</span>
<span class="comment-line">#         UnconfigSwAll</span>
<span class="comment-line">#      }</span>
      set getKeyList &#34;{{Image Booted:} 1}&#34;
      set buildBooted [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show switch&#34; $getKeyList]
      if {$buildBooted != &#34;primary&#34;} {
         <a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;use image primary&#34;
         <a name="::UnconfigSwAll(1)"><a href="./SendSwCmd.tcl.html#::UnconfigSwAll_1628">::UnconfigSwAll</a></a>
      }

      for {set i 1} {$i &lt;= 5} {incr i} {
         <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config default delete port all&#34;
         <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipaging&#34;
         if { [<a name="::::isMgmtPortUp(1)"><a href="./upgradecheck.tcl.html#::::isMgmtPortUp_743">::::isMgmtPortUp</a></a>] == &#34;ok&#34; } { 
            <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The Mgmt Port is Up&#34;
	    break
	 }
         <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;use image primary&#34;
         <a name="::UnconfigSwAll(2)"><a href="./SendSwCmd.tcl.html#::UnconfigSwAll_1628">::UnconfigSwAll</a></a>
      }
 
      <span class="comment-line"># --- image might have changed</span>
      <a name="::::setupDUTs_info(1)"><a href="./upgradecheck.tcl.html#::::setupDUTs_info_913">::::setupDUTs_info</a></a>;

      set firstFile     false

      <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;pwd: [pwd]&#34;

      <span class="comment-line"># ----- decide the image file names</span>
      if { $nbuild == &#34;&#34;  || $obuild == &#34;&#34;} {
         <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Upgrade/DownGrade Test must have two builds: &lt;$nbuild&gt; &lt;$obuild&gt;&#34;
         set time2 [clock seconds]
         result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
         <a name="::close_result_file(2)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
         <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         return
      }
      set nbuildFile &#34;&#34;
      set obuildFile &#34;&#34;
      set config2File &#34;cli-[set obuild]&#34;
      if {[regexp -nocase &#34;BD-10808&#34; $platform]} {
         set nbuildFile &#34;bd10K-[set nbuild].xos&#34;
         set obuildFile &#34;bd10K-[set obuild].xos&#34;
      } elseif {[regexp -nocase &#34;Olympic|bd12k&#34; $platform]} {
	 set nbuildFile &#34;bd12K-[set nbuild].xos&#34;
         set obuildFile &#34;bd12K-[set obuild].xos&#34;
      } elseif {[regexp -nocase &#34;Aspen|bd-88|Everest|bd-x8&#34; $platform]} {
	 if {[regexp -nocase &#34;bd-88&#34; $platform]} {
	 set nbuildFile &#34;bd8800-[set nbuild].xos&#34;
         set obuildFile &#34;bd8800-[set obuild].xos&#34;
	 } else {
         set nbuildFile &#34;bdX-[set nbuild].xos&#34;
         set obuildFile &#34;bdX-[set obuild].xos&#34;  	    
	 }
      } elseif {[regexp -nocase &#34;pc&#34; $platform]} {
         set nbuildFile &#34;bd10Ki386-[set nbuild].xos&#34;
         set obuildFile &#34;bd10Ki386-[set obuild].xos&#34;
      } else {
	  <span class="comment-line"># Both Cougar and Jaguar</span>
         set nbuildFile &#34;summitX450-[set nbuild].xos&#34;
         set obuildFile &#34;summitX450-[set obuild].xos&#34;
      }
      <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;nbuild file: $nbuildFile, obuild file: $obuildFile&#34;
      regsub -all {\.} $config2File {_} config2File
      <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;config2 file: $config2File&#34;

      <span class="comment-line"># get the start_session here   </span>
      <span class="comment-line"># parse CLIList</span>
      set s 0;
      set lngth 0;
if { 1 } {
      while {1} {
         set retparameters [<a name="::::Start_Session_Parser(1)"><a href="./upgradecheck.tcl.html#::::Start_Session_Parser_594">::::Start_Session_Parser</a></a> $CLIList $lngth];          
         <span class="comment-line">#result_debug &#34;---&gt; [lindex $retparameters 0]&#34;;</span>
         <span class="comment-line">#result_debug &#34;---&gt; [lindex $retparameters 1]&#34;;      </span>
         set lngth [lindex $retparameters 1];
         set CLISession [lindex $retparameters 0];         
         if {$lngth == &#34;NO_DATA&#34;} {
             break;
         }

<span class="comment-line">#######################</span>
<span class="comment-line"># Set Up Baseline</span>
<span class="comment-line">#######################          </span>

         <span class="comment-line"># ----- check the currect configuration and determine</span>
         <span class="comment-line"># ----- the download sequence for setting up the baseline</span>
	 set getKeyList &#34;{{Primary Ver:} 1}&#34;
	 set priVer [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show switch&#34; $getKeyList]
	 set getKeyList &#34;{{Secondary Ver:} 1}&#34;
	 set secVer [<a name="::GetKeyValue(3)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show switch&#34; $getKeyList]
	 set getKeyList &#34;{{Image Booted:} 1}&#34;
<span class="comment-line">#	 set buildBooted [GetKeyValue &#34;show switch&#34; $getKeyList]</span>
         set downloadPri &#34;no&#34;
         <span class="comment-line"># --- accept whatever in secondary partition</span>
         set version [<a name="::::cliGetVersion0(1)"><a href="./upgradecheck.tcl.html#::::cliGetVersion0_854">::::cliGetVersion0</a></a> &#34;DUT1&#34;]
         if {$version != $oVersion} {
            <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;version: $version, obuild: $obuild&#34;
            set downloadPri &#34;yes&#34;
	 }
	 <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;downloadPri: $downloadPri&#34;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo primary has $version, secondary has $secVer&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(3)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::report_end_test(3)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

         if { $downloadPri == &#34;yes&#34;} {
            <span class="comment-line"># ----- this is on the active partition</span>
            set active &#34;yes&#34;

            incr s;
            set upgradeNo &#34;$testcaseNo.$s&#34;;
            <span class="comment-line">################################################</span>
            set subTest &#34;$upgradeNo Download $obuild to Primary Partition&#34;;
            <span class="comment-line">################################################</span>
            result_h2 &#34;$subTest&#34;;
            <a name="::report_start_test(4)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
                  
            set status [<a name="::::cliCheckDownloadImage(1)"><a href="./upgradecheck.tcl.html#::::cliCheckDownloadImage_711">::::cliCheckDownloadImage</a></a> $tftpServerList $obuildFile $active &#34;primary&#34;]
            if { $status != &#34;ok&#34; } {
               <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;!!!!! Failed download &lt;$obuildFile&gt; to primary partition; test aborted !!!!!&#34;
               <a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show switch&#34;
               set time2 [clock seconds]
               result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
               <a name="::close_result_file(3)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
               <a name="::report_end_test(4)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
               return
            }
            <a name="::report_end_test(5)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
         }

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Unconfig Switch All and Check Switch&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(5)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;use image primary&#34;
         for {set i 1} {$i &lt;= 5} {incr i} {
	    <a name="::UnconfigSwAll(3)"><a href="./SendSwCmd.tcl.html#::UnconfigSwAll_1628">::UnconfigSwAll</a></a>
            <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config default delete port all&#34;
            <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable clipaging&#34;
            if { [<a name="::::isMgmtPortUp(2)"><a href="./upgradecheck.tcl.html#::::isMgmtPortUp_743">::::isMgmtPortUp</a></a>] == &#34;ok&#34; } { 
	       <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;The Mgmt Port is Up&#34;
	       break 
	    }
         }
         if { $i &gt; 3 } {
            <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;!!!!! Failed to bring up Mgmt port; test aborted!!!!!&#34;
            <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show switch&#34;
            set time2 [clock seconds]
            result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
            <a name="::close_result_file(4)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
            <a name="::report_end_test(6)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
            return
         } 
         <span class="comment-line"># --- image might have changed</span>
         <a name="::::setupDUTs_info(2)"><a href="./upgradecheck.tcl.html#::::setupDUTs_info_913">::::setupDUTs_info</a></a>;

         <a name="::::cliCheckSwitch(1)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;&#34; primary primary NONE &#34;factory Default&#34;
         <a name="::::cliCheckVersion(1)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$oVersion&#34;
         <a name="::report_end_test(7)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Run CLI First Pass to Generate Old Version of Configuration&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(6)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
                  
         <a name="::RunCommandAndCheck(1)"><a href="./CLIParser.tcl.html#::RunCommandAndCheck_406">::RunCommandAndCheck</a></a> $CLISession $upgradeNo &#34;first&#34;;
         <a name="::report_end_test(8)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Save Configuration and Check Switch&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(7)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;save configuration&#34; 		;<span class="comment-line"># to default primary.cfg    </span>
         <a name="::::cliCheckSwitch(2)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;&#34; primary primary &#34;primary.cfg&#34; &#34;factory Default&#34;
         <a name="::::cliCheckVersion(2)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$oVersion&#34;
         <a name="::report_end_test(9)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Save Configuration to cli-[set obuild] and Check Switch&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(8)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;save configuration $config2File&#34;
         <a name="::::cliCheckSwitch(3)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;&#34; primary primary &#34;$config2File.cfg&#34; &#34;factory Default&#34;
         <a name="::::cliCheckVersion(3)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$oVersion&#34;
         <a name="::report_end_test(10)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Use Image Secondary and Check Switch&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(9)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;use configuration primary&#34;
         <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;use image secondary&#34;
         <a name="::::cliCheckSwitch(4)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;&#34; secondary primary &#34;primary.cfg&#34; &#34;factory Default&#34;
         <a name="::::cliCheckVersion(4)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$oVersion&#34;
         <a name="::report_end_test(11)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

<span class="comment-line">####################################</span>
<span class="comment-line"># Upgrading to Non-Active Partition</span>
<span class="comment-line">####################################</span>

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Upgrade to Non-Active Secondary Partition&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(10)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
                  
         set status [<a name="::::cliCheckDownloadImage(2)"><a href="./upgradecheck.tcl.html#::::cliCheckDownloadImage_711">::::cliCheckDownloadImage</a></a> $tftpServerList $nbuildFile &#34;secondary&#34;]
         if { $status != &#34;ok&#34; } {
            <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;!!!!! Failed to download &lt;$nbuildFile&gt; to secondary partition; test aborted !!!!!&#34;
            <a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show switch&#34;
            set time2 [clock seconds]
            result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
            <a name="::close_result_file(5)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
            <a name="::report_end_test(12)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
            return
         }  
         <a name="::report_end_test(13)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Check log&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(11)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
	 <span class="comment-line"># ----- not sure what to look for in show log</span>
if { 0 } {
 	 <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log match error&#34;
	 sleep  10
}
         <a name="::report_end_test(14)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Check Switch for Secondary Version&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(12)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::::cliCheckSwitch(5)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;$nbuildVer&#34; secondary primary &#34;primary.cfg&#34; &#34;factory Default&#34;
         <a name="::::cliCheckVersion(5)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$oVersion&#34;
         <a name="::report_end_test(15)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Reboot with NO Save to bring up the new image&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(13)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log static&#34;
         for {set i 1} {$i &lt;= 5} {incr i} {
            <a name="::CheckReboot(1)"><a href="./SendSwCmd.tcl.html#::CheckReboot_1202">::CheckReboot</a></a> 1 -save no
<span class="comment-line">#            CheckReboot 1 </span>
	    sleep 20
            if { [<a name="::::isMgmtPortUp(3)"><a href="./upgradecheck.tcl.html#::::isMgmtPortUp_743">::::isMgmtPortUp</a></a>] == &#34;ok&#34; } { break }
         }
         if { $i &gt; 3 } {
            <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;!!!!! Failed to bring up Mgmt port; test aborted!!!!!&#34;
            <a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show switch&#34;
            set time2 [clock seconds]
            result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
            <a name="::close_result_file(6)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
            <a name="::report_end_test(16)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
            return
         }
         <a name="::report_end_test(17)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         <span class="comment-line"># --- image might have changed</span>
         <a name="::::setupDUTs_info(3)"><a href="./upgradecheck.tcl.html#::::setupDUTs_info_913">::::setupDUTs_info</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Check Switch for Image and Config Booted&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(14)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::::cliCheckSwitch(6)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;$nbuildVer&#34; secondary secondary &#34;primary.cfg&#34; &#34;primary.cfg&#34;
         <a name="::::cliCheckVersion(6)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$nVersion&#34;
         <a name="::report_end_test(18)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Check log&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(15)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
	 <span class="comment-line"># ----- not sure what to look for in show log</span>
if { 0 } {
 	 <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log match error&#34;
	 sleep 5
}
         <a name="::report_end_test(19)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Run CLI 2nd Pass after Upgrade&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(16)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::RunCommandAndCheck(2)"><a href="./CLIParser.tcl.html#::RunCommandAndCheck_406">::RunCommandAndCheck</a></a> $CLISession $upgradeNo &#34;second&#34;;
         <a name="::report_end_test(20)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Save Configuration and Check Switch&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(17)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;save configuration&#34; 		;<span class="comment-line"># to default primary.cfg again</span>
         <a name="::::cliCheckSwitch(7)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;$nbuildVer&#34; secondary secondary &#34;primary.cfg&#34; &#34;primary.cfg&#34;
         <a name="::::cliCheckVersion(7)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$nVersion&#34;
         <a name="::report_end_test(21)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Reboot with NO Save to reload the new config&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(18)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log static&#34;
         for {set i 1} {$i &lt;= 5} {incr i} {
            <a name="::CheckReboot(2)"><a href="./SendSwCmd.tcl.html#::CheckReboot_1202">::CheckReboot</a></a> 1 -save no
<span class="comment-line">#            CheckReboot 1 </span>
	    sleep 20
            if { [<a name="::::isMgmtPortUp(4)"><a href="./upgradecheck.tcl.html#::::isMgmtPortUp_743">::::isMgmtPortUp</a></a>] == &#34;ok&#34; } { break }
         }
         if { $i &gt; 3 } {
            <a name="::result_error(6)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;!!!!! Failed to bring up Mgmt port; test aborted!!!!!&#34;
            <a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show switch&#34;
            set time2 [clock seconds]
            result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
            <a name="::close_result_file(7)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
            <a name="::report_end_test(22)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
            return
         }
         <a name="::report_end_test(23)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Check Switch for All Intact&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(19)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::::cliCheckSwitch(8)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;$nbuildVer&#34; secondary secondary &#34;primary.cfg&#34; &#34;primary.cfg&#34;
         <a name="::::cliCheckVersion(8)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$nVersion&#34;
         <a name="::report_end_test(24)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Check log&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(20)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
	 <span class="comment-line"># ----- not sure what to look for in show log</span>
if { 0 } {
 	 <a name="::SendACmd(22)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log match error&#34;
	 sleep 5
}
         <a name="::report_end_test(25)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Run CLI 2nd Pass after reload primary.cfg&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(21)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::RunCommandAndCheck(3)"><a href="./CLIParser.tcl.html#::RunCommandAndCheck_406">::RunCommandAndCheck</a></a> $CLISession $upgradeNo &#34;second&#34;;
         <a name="::report_end_test(26)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

<span class="comment-line">####################################</span>
<span class="comment-line"># Downgrading to Non-Active Partition</span>
<span class="comment-line">####################################</span>

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Use image primary and Check Switch&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(22)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(23)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;use image primary&#34;
         <a name="::::cliCheckSwitch(9)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;$nbuildVer&#34; primary secondary &#34;primary.cfg&#34; &#34;primary.cfg&#34;
         <a name="::::cliCheckVersion(9)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$nVersion&#34;
         <a name="::report_end_test(27)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Use cli-[set obuild] and Check Switch&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(23)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(24)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;use configuration $config2File&#34;
         <a name="::::cliCheckSwitch(10)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;$nbuildVer&#34; primary secondary &#34;$config2File.cfg&#34; &#34;primary.cfg&#34;
         <a name="::::cliCheckVersion(10)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$nVersion&#34;
         <a name="::report_end_test(28)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Reboot with NO Save - to reload the old config&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(24)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::SendACmd(25)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;clear log static&#34;
         for {set i 1} {$i &lt;= 5} {incr i} {
            <a name="::CheckReboot(3)"><a href="./SendSwCmd.tcl.html#::CheckReboot_1202">::CheckReboot</a></a> 1 -save no
<span class="comment-line">#            CheckReboot 1 </span>
	    sleep 20
            if { [<a name="::::isMgmtPortUp(5)"><a href="./upgradecheck.tcl.html#::::isMgmtPortUp_743">::::isMgmtPortUp</a></a>] == &#34;ok&#34; } { break }
         }
         if { $i &gt; 3 } {
            <a name="::result_error(7)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;!!!!! Failed to bring up Mgmt port; test aborted!!!!!&#34;
            <a name="::SendACmd(26)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show switch&#34;
            set time2 [clock seconds]
            result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
            <a name="::close_result_file(8)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>
            <a name="::report_end_test(29)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
            return
         }
         <a name="::report_end_test(30)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         <span class="comment-line"># --- image might have changed</span>
         <a name="::::setupDUTs_info(4)"><a href="./upgradecheck.tcl.html#::::setupDUTs_info_913">::::setupDUTs_info</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Downgraded and Check Switch&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(25)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
         <a name="::::cliCheckSwitch(11)"><a href="./upgradecheck.tcl.html#::::cliCheckSwitch_805">::::cliCheckSwitch</a></a> &#34;$obuildVer&#34; &#34;$nbuildVer&#34; primary primary &#34;$config2File.cfg&#34; &#34;$config2File.cfg&#34;
         <a name="::::cliCheckVersion(11)"><a href="./upgradecheck.tcl.html#::::cliCheckVersion_847">::::cliCheckVersion</a></a> &#34;$oVersion&#34;
         <a name="::report_end_test(31)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Check log&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(26)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;
	 <span class="comment-line"># ----- not sure what to look for in show log</span>
if { 0 } {
 	 <a name="::SendACmd(27)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show log match error&#34;
	 sleep 5
}
         <a name="::report_end_test(32)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         incr s;
         set upgradeNo &#34;$testcaseNo.$s&#34;;
         <span class="comment-line">################################################</span>
         set subTest &#34;$upgradeNo Run CLI Last Pass&#34;;
         <span class="comment-line">################################################</span>
         result_h2 &#34;$subTest&#34;;
         <a name="::report_start_test(27)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;$subTest&#34;;

         <a name="::RunCommandAndCheck(4)"><a href="./CLIParser.tcl.html#::RunCommandAndCheck_406">::RunCommandAndCheck</a></a> $CLISession $upgradeNo &#34;second&#34;;
         <a name="::report_end_test(33)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;

         if {$lngth == 0} {   
            break;
         } else {
            incr lngth;
         }   
      } 
}
      <a name="::report_end_test(34)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>;
      set time2 [clock seconds]
      result_p &#34;*** Time for $testNo = [expr $time2-$time1] secs\n\n&#34;
      <a name="::close_result_file(9)"><a href="./result.tcl.html#::close_result_file_363">::close_result_file</a></a>;         
   }
   }
}

<strong><a name="::::Start_Session_Parser_594">proc <a href="upgradecheck.tcl-annot.html#::::Start_Session_Parser">::::Start_Session_Parser</a></a></strong><a name="::::Start_Session_Parser"></a> {CLISessionList lngth} {

    set flag 0;
    if {[info exist buffer]} {unset buffer }
    set listLength [llength $CLISessionList];  
    <span class="comment-line">#puts &#34;listLength = $listLength&#34;;  </span>
    <span class="comment-line">#puts &#34;lngth = $lngth&#34;; </span>
    for {set i $lngth}  {$i &lt;= $listLength} {incr i} {
        set line [string tolower [lindex $CLISessionList $i]];
        set line [string trim $line];          
        if {[regexp -nocase &#34;end_session&#34; $line] } {
            set flag $i;
            break;  
        } elseif {[regexp -nocase &#34;start_session&#34; $line] } {
            if {[info exist buffer]} {unset buffer }        
        } else {
            if {[string length $line]} {
                lappend buffer $line;
            }    
        }
    }    
    if {$lngth != 0} {
        if {[info exist buffer]} {
           lappend retval $buffer;
           lappend retval $flag;        
           return $retval;
        } else {
           lappend retval &#34;NO_DATA&#34;;
           lappend retval &#34;NO_DATA&#34;;        
           return $retval;       
        }
    } else {
        lappend retval $buffer;
        lappend retval $flag;        
        return $retval;
    }    
}


<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cliDownloadImage</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Internal proc that downloads the image provided in filename to the current DUT from tftp server </span>
<span class="comment-line">#              provided in TFTPServerIP.</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: TFTPServerIP, filename, active or not, primary or secondary</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             set status [DownloadImage $TFTPServerIP $filename ]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cliDownloadImage_648">proc <a href="upgradecheck.tcl-annot.html#::::cliDownloadImage">::::cliDownloadImage</a></a></strong><a name="::::cliDownloadImage"></a> {TFTPServerIP filename {active no} {partition &#34;&#34;}} {
   <a name="::::cliConfigGatewayNetwork(1)"><a href="./upgradecheck.tcl.html#::::cliConfigGatewayNetwork_1000">::::cliConfigGatewayNetwork</a></a>
   global DUTs_info
   global whichDutNow
   <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;--- cliDownloadImage: Send download image $TFTPServerIP $filename to $partition&#34;
   set rtValue &#34;legal&#34;
   set buf &#34;&#34;
   if { [<a name="::::isExosPlatform(1)"><a href="./SystemSetup.tcl.html#::::isExosPlatform_970">::::isExosPlatform</a></a> DUT1 ] == 1 } {
      global switchPort2DefaultRouter
      global connectionTimeout

      set virtualRouter [<a name="::GetVrString(1)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $whichDutNow]

      set origConnectionTimeout $connectionTimeout
      set connectionTimeout 5000
      set pid [pid]
      set fd_in [open &#34;Tmp/temp_$pid&#34; &#34;w&#34;]
      after 5000
      if {[regexp -nocase &#34;mgmt&#34; $switchPort2DefaultRouter]} {
         <a name="::SendACmd(28)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show vlan mgmt&#34;
         <a name="::SendACmd(29)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;show iproute vr $virtualRouter&#34;
         set buf [<a name="::SendACmd(30)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;download image $TFTPServerIP $filename $partition&#34; NULL $fd_in]
      } else {
         set virtualRouter [<a name="::GetVrString(2)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $whichDutNow]
         set buf [<a name="::SendACmd(31)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;download image $TFTPServerIP $filename vr $virtualRouter $partition&#34; NULL $fd_in]
      }
      set connectionTimeout $origConnectionTimeout
      close $fd_in
      set fd_in [open &#34;Tmp/temp_$pid&#34; &#34;r&#34;]
      set rtValue [<a name="::check_illegality(1)"><a href="./checkCmdLegality.tcl.html#::check_illegality_139">::check_illegality</a></a> $fd_in]
      close $fd_in
      file delete &#34;Tmp/temp_$pid&#34;
      <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;the rtValue $rtValue&#34;
      if {$rtValue==&#34;legal&#34;} {
         set buf &#34;ok&#34;
      } else {
         set buf &#34;error&#34;
         set buf &#34;ok&#34;				;<span class="comment-line"># exos tmp</span>
      }
   }
   if {$active == &#34;yes&#34; &amp;&amp; $buf == &#34;ok&#34;} {
      set maxWait 20
      set status [<a name="::::MyWaitForReboot(1)"><a href="./upgradecheck.tcl.html#::::MyWaitForReboot_774">::::MyWaitForReboot</a></a> $maxWait &#34;after download image to active partition&#34;]
   }
   <a name="::::cliUnconfigGatewayNetwork(1)"><a href="./upgradecheck.tcl.html#::::cliUnconfigGatewayNetwork_1054">::::cliUnconfigGatewayNetwork</a></a>
   return $buf
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: cliCheckDownloadImage</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that checks the downloaded image success from the lift of tftp servers provided in</span>
<span class="comment-line">#              tftpServerList</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: tftpServerList, filename, active or no, primary or secondary</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             set status [DownloadImage $TFTPServerIP $filename ]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cliCheckDownloadImage_711">proc <a href="upgradecheck.tcl-annot.html#::::cliCheckDownloadImage">::::cliCheckDownloadImage</a></a></strong><a name="::::cliCheckDownloadImage"></a> {tftpServerList filename {active no} {partition &#34;&#34;}} {

   foreach TFTPServerIP $tftpServerList {    
     <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Start downloading image $filename from $TFTPServerIP to $partition&#34;
     set status [<a name="::::cliDownloadImage(1)"><a href="./upgradecheck.tcl.html#::::cliDownloadImage_648">::::cliDownloadImage</a></a> $TFTPServerIP $filename $active $partition]
     if {$status == &#34;ok&#34;} {break }
     flush stdout
   }
   <a name="::report_start_test(28)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Downloading image $filename from $tftpServerList to $partition&#34; 
   if {$status == &#34;error&#34;} {           
        <a name="::result_error(8)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Failed to download image from $tftpServerList&#34;
   } else {
        <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;Image successfully downloaded from $tftpServerList&#34;
   }
   <a name="::report_end_test(35)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return $status   
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: isMgmtPortUp</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: proc that checks whether the management port is up</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: dut#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             set status [isMgmtPortUp 2]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::isMgmtPortUp_743">proc <a href="upgradecheck.tcl-annot.html#::::isMgmtPortUp">::::isMgmtPortUp</a></a></strong><a name="::::isMgmtPortUp"></a> { {dut 1} } {

global switchPort2DefaultRouter

   if {[regexp -nocase &#34;mgmt&#34; $switchPort2DefaultRouter]} {
      set parameterList &#34;&#34;
      lappend parameterList &#34;{Number of active ports=1} exist&#34;
      set status [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show vlan mgmt&#34; $parameterList -reportResults 0]
      unset parameterList
      return $status   
   } else {
      return &#34;ok&#34;			;<span class="comment-line"># dont care</span>
   }
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: MyWaitForReboot</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Internal function that performs a login to the current DUT </span>
<span class="comment-line">#    after waiting for wait time prints the expect_buffer to log file, </span>
<span class="comment-line">#    comment to report file</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: wait, comment</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#   set status [WaitForReboot $maxWait &#34;after sending reboot command to $DUTName&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::MyWaitForReboot_774">proc <a href="upgradecheck.tcl-annot.html#::::MyWaitForReboot">::::MyWaitForReboot</a></a></strong><a name="::::MyWaitForReboot"></a> {wait comment {masterCheck 1}} {
set expect_out(buffer) &#34;No Output:WaitForReboot&#34;
set timeout 300
set flag &#34;true&#34;
while {$flag == &#34;true&#34;} {
   expect {
      timeout {
         expect &#34;*&#34;
         <a name="::SaveOutputBuffer(1)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)
         return &#34;error&#34;
      }
      full_buffer {
         set flag &#34;true&#34;
         <a name="::SaveOutputBuffer(2)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)
      }
      &#34;login:&#34; {
         set flag &#34;false&#34;
         if {$wait != 0} { 
            puts &#34;Wait for $wait seconds after logging in for ports to come up\n&#34;
            <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $wait
         }
         <a name="::SaveOutputBuffer(3)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)
         if {[<a name="::try_login_on_switch(1)"><a href="./login.tcl.html#::try_login_on_switch_981">::try_login_on_switch</a></a> $comment &#34;admin&#34; &#34;&#34; $masterCheck]!=-1} {
               return &#34;ok&#34;
         }
      }
   }
}
return &#34;ok&#34;
}

<strong><a name="::::cliCheckSwitch_805">proc <a href="upgradecheck.tcl-annot.html#::::cliCheckSwitch">::::cliCheckSwitch</a></a></strong><a name="::::cliCheckSwitch"></a> { priVer secVer imaSel imaBoot cfgSel cfgBoot } {

   set platform [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT1]

   set parameterList &#34;&#34;
   if {[regexp -nocase &#34;BD-10808|Aspen|bd-88|bd-x8&#34; $platform] == 1} {
      lappend getKeyList &#34;{State: } 1&#34;;
      set slotbState [<a name="::GetKeyValue(4)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show slot b&#34; $getKeyList];
      unset getKeyList;
      if {$slotbState != &#34;Empty&#34;} {
         lappend parameterList &#34;{Primary ver: *$priVer *$priVer} exist&#34;
         if {$secVer != &#34;&#34; } {
            lappend parameterList &#34;{Secondary ver: *$secVer *$secVer} exist&#34;
         }
         lappend parameterList &#34;{Image Selected: *$imaSel *$imaSel} exist&#34;
         lappend parameterList &#34;{Image Booted: *$imaBoot *$imaBoot} exist&#34;
         lappend parameterList &#34;{Config Selected: *$cfgSel *$cfgSel} exist&#34;
         lappend parameterList &#34;{Config Booted: *$cfgBoot *$cfgBoot} exist&#34;
      } else {
         lappend parameterList &#34;{Primary ver: *$priVer} exist&#34;
         if {$secVer != &#34;&#34; } {
            lappend parameterList &#34;{Secondary ver: *$secVer} exist&#34;
         }
         lappend parameterList &#34;{Image Selected: *$imaSel} exist&#34;
         lappend parameterList &#34;{Image Booted: *$imaBoot} exist&#34;
         lappend parameterList &#34;{Config Selected: *$cfgSel} exist&#34;
         lappend parameterList &#34;{Config Booted: *$cfgBoot} exist&#34;
      }
   } else {
      lappend parameterList &#34;{Primary ver: *$priVer} exist&#34;
      if {$secVer != &#34;&#34; } {
         lappend parameterList &#34;{Secondary ver: *$secVer} exist&#34;
      }
      lappend parameterList &#34;{Image Selected: *$imaSel} exist&#34;
      lappend parameterList &#34;{Image Booted: *$imaBoot} exist&#34;
      lappend parameterList &#34;{Config Selected: *$cfgSel} exist&#34;
      lappend parameterList &#34;{Config Booted: *$cfgBoot} exist&#34;
   }
   <a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $parameterList
   unset parameterList
}

<strong><a name="::::cliCheckVersion_847">proc <a href="upgradecheck.tcl-annot.html#::::cliCheckVersion">::::cliCheckVersion</a></a></strong><a name="::::cliCheckVersion"></a> { cliVersion } {

   lappend parameterList &#34;{Image.*$cliVersion} exist&#34;
   <a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show version&#34; $parameterList
   unset parameterList
}

<strong><a name="::::cliGetVersion0_854">proc <a href="upgradecheck.tcl-annot.html#::::cliGetVersion0">::::cliGetVersion0</a></a></strong><a name="::::cliGetVersion0"></a> {{DUTName &#34;DUT1&#34;} {option 1}} {
   global DUT1_CONNECT
   global DUT2_CONNECT
   global DUT3_CONNECT
   global DUT4_CONNECT
   global DUT5_CONNECT
   <a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT]
   lappend parameterList {{<a name="::version(1)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a>} 2}
   set verstr [lindex [<a name="::GetKeyValue(5)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show version&#34; $parameterList] 0];
}

<strong><a name="::::cliGetVersion_865">proc <a href="upgradecheck.tcl-annot.html#::::cliGetVersion">::::cliGetVersion</a></a></strong><a name="::::cliGetVersion"></a> {{DUTName &#34;DUT1&#34;} {option 1}} {
   global DUT1_CONNECT
   global DUT2_CONNECT
   global DUT3_CONNECT
   global DUT4_CONNECT
   global DUT5_CONNECT
   <a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT]
   lappend parameterList {{XOS version} 1}
   set verstr [lindex [<a name="::GetKeyValue(6)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show version&#34; $parameterList] 0];
   if ![regexp {([0-9]+)\.([0-9]+)\.([0-9]+)[\.b]([0-9]+)} $verstr match \
      major minor patch build] {
      error &#34;cliGetVersion: $verstr not in good format.&#34;
      return &#34;error&#34;
   }
   switch $option {
      whole -
      1 {
         return $verstr
      }
      majmin -
      2 {
         return &#34;$major.$minor&#34;
      }
      build -
      3 {
        return $build
      }
      release -
      4 {
        return &#34;$major.$minor.$patch&#34;
      }
      major {
        return $major
      }
      minor {
        return $minor
      }
      patch {
        return $patch
      }
      default {
         return $verstr
      }
   }
}

<span class="comment-line"># --- manipulate DUTs_info(DUT1,version), </span>
<span class="comment-line"># --- so that upgradecheck can call Lib procs</span>
<strong><a name="::::setupDUTs_info_913">proc <a href="upgradecheck.tcl-annot.html#::::setupDUTs_info">::::setupDUTs_info</a></a></strong><a name="::::setupDUTs_info"></a> { {DUTName &#34;DUT1&#34;} } {
   global DUTs_info;
   global DUT1_CONNECT

   <a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT];
   lappend parameterList {{<a name="::version(2)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a>} 1};
   set version [lindex [<a name="::GetKeyValue(7)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show version&#34; $parameterList] 0];
   unset parameterList;
   lappend parameterList {{<a name="::version(3)"><a href="./ePTClient.tcl.html#::version_470">::version</a></a>} 2};
   set showVerVersion [lindex [<a name="::GetKeyValue(8)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show version&#34; $parameterList] 0];
   unset parameterList;
   <span class="comment-line"># Compute the version for patch builds in EXOS</span>
      if {[regexp -nocase &#34;\\-&#34; $showVerVersion]} {
         set patchList [split $showVerVersion &#34;-&#34;];
         foreach str [lrange $patchList 1 end] {
            set version [format %s-%s $version $str];
         }
      }
   set DUTs_info($DUTName,version) $version;
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: cliSendAFile </span>
<span class="comment-line"># Description: upload the file to tftp server, then download it to</span>
<span class="comment-line">#	the DUT</span>
<span class="comment-line"># Input args:   </span>
<span class="comment-line">#	tftpServer: the tftp server</span>
<span class="comment-line">#	localFile: the file to be sent</span>
<span class="comment-line">#	remoteFile: the file to be on the remote</span>
<span class="comment-line">#	dut: the DUT# to send the file to </span>
<span class="comment-line"># Output args:  none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#       SendAFile</span>
<span class="comment-line"># Category: Utility</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cliSendAFile_947">proc <a href="upgradecheck.tcl-annot.html#::::cliSendAFile">::::cliSendAFile</a></a></strong><a name="::::cliSendAFile"></a> {tftpServer localFile remoteFile {dut 1} } {

global DUT${dut}_CONNECT

set filePrefix &#34;[set DUT${dut}_CONNECT]&#34;
<span class="comment-line">#set filePrefix &#34;[set DUT${dut}_CONNECT] 123&#34;   ;# for testing</span>
regsub -all { } $filePrefix {.} filePrefix
set tftpFile $filePrefix.$remoteFile
set platform [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${dut}]
<a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$tftpFile, $platform&#34;

<span class="comment-line"># upload the file to tftpserver</span>
global spawn_id

set current_spawn_id $spawn_id
<a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;spawn_id = $spawn_id&#34;
spawn tftp $tftpServer
<a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;spawn_id = $spawn_id&#34;
<a name="::SendACmd(32)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;put $localFile $tftpFile&#34;
send &#34;quit\r&#34;
set spawn_id $current_spawn_id

<a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${dut}_CONNECT]

<span class="comment-line"># download from tftpServer to DUT</span>
global switchPort2DefaultRouter
global whichDutNow;
<a name="::::cliConfigGatewayNetwork(2)"><a href="./upgradecheck.tcl.html#::::cliConfigGatewayNetwork_1000">::::cliConfigGatewayNetwork</a></a>
after 3000
set virtualRouter [<a name="::GetVrString(3)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $whichDutNow]
<a name="::SendACmd(33)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;tftp $tftpServer -v $virtualRouter -g -r $tftpFile -l $remoteFile&#34;
<a name="::::cliUnconfigGatewayNetwork(2)"><a href="./upgradecheck.tcl.html#::::cliUnconfigGatewayNetwork_1054">::::cliUnconfigGatewayNetwork</a></a>

return $tftpFile
}

<span class="comment-line">##</span>
<span class="comment-line">## --- need to use own Config/UnconfigGatewayNetwork</span>
<span class="comment-line">## --- because the image version must be checked dynamically</span>
<span class="comment-line">##</span>

<span class="comment-line">################################################################################</span>
<span class="comment-line"># Procedure Name: cliConfigGatewayNetwork   </span>
<span class="comment-line"># Description: proc to config the gateway vlan: commvlan or mgmt and add default route</span>
<span class="comment-line">#	       based on the values of global vars: DUTx_IP and defaultRouter etc.  The</span>
<span class="comment-line">#	       purpose is to dynamically set up the gateway network for tftp service instead</span>
<span class="comment-line">#	       to have static setup from config files throughout the regression.</span>
<span class="comment-line"># Input args: n/a</span>
<span class="comment-line"># Output args: n/a</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             ConfigGatewayNetwork;</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cliConfigGatewayNetwork_1000">proc <a href="upgradecheck.tcl-annot.html#::::cliConfigGatewayNetwork">::::cliConfigGatewayNetwork</a></a></strong><a name="::::cliConfigGatewayNetwork"></a> {} {
    global switchPort2DefaultRouter;  
    global defaultRouter;
    global whichDutNow;
    global DUT${whichDutNow}_IP;
    global DUT${whichDutNow}_MASK;

    set ipAddr [set DUT${whichDutNow}_IP]

    if [info exist DUT${whichDutNow}_MASK] {
        set ipMask [set DUT${whichDutNow}_MASK]
    } else {
        set ipMask 24
    }

    <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nConfigGatewayNetwork{}: set up gateway vlan $ipAddr/$ipMask on DUT$whichDutNow&#34;
    if {[regexp -nocase $switchPort2DefaultRouter &#34;mgmt&#34;]} {
        global supportedPlatform
        if {[regexp -nocase &#34;$supportedPlatform&#34; [<a name="::GetPlatform(4)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]]} {
           <a name="::SendACmd(34)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config mgmt ipa $ipAddr/$ipMask&#34;
           set xos_version [<a name="::::cliGetVersion(1)"><a href="./upgradecheck.tcl.html#::::cliGetVersion_865">::::cliGetVersion</a></a> DUT$whichDutNow 4]
           if { $xos_version &gt;= &#34;10.2.0&#34; } {
              set virtualRouter VR-mgmt
           } else {
              set virtualRouter VR-0
           }
           <a name="::SendACmd(35)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;config ipr add default $defaultRouter vr $virtualRouter&#34;;
       } else {
           <a name="::SendACmd(36)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config mgmt ipa $ipAddr/$ipMask&#34;
       }
    } else {
        set gwPort [<a name="::GetDUTPort(1)"><a href="./ePTPortMapping.tcl.html#::GetDUTPort_78">::GetDUTPort</a></a> $switchPort2DefaultRouter $whichDutNow]
        <a name="::SendACmd(37)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;enable port $gwPort&#34;;
        sleep 3
        <a name="::SendACmd(38)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;create vlan commvlan&#34;;
        <a name="::SendACmd(39)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;config commvlan add port $gwPort&#34;;
        <a name="::SendACmd(40)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;config commvlan ipa $ipAddr/$ipMask&#34;;
        set virtualRouter [<a name="::GetVrString(4)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $whichDutNow];
        <a name="::SendACmd(41)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;config ipr add default $defaultRouter vr $virtualRouter&#34;;
    }
}

<span class="comment-line">################################################################################</span>
<span class="comment-line"># Procedure Name: cliUnconfigGatewayNetwork   </span>
<span class="comment-line"># Description: proc to unconfig the gateway vlan: commvlan or mgmt and delete default route</span>
<span class="comment-line">#	       based on the values of global vars: DUTx_IP and defaultRouter etc.  The</span>
<span class="comment-line">#	       purpose is to dynamically remove the commvlan as tftp service is finished</span>
<span class="comment-line">#	       instead to have static setup from config files throughout the regression.</span>
<span class="comment-line"># Input args: n/a</span>
<span class="comment-line"># Output args: n/a</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             UnconfigGatewayNetwork;</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::cliUnconfigGatewayNetwork_1054">proc <a href="upgradecheck.tcl-annot.html#::::cliUnconfigGatewayNetwork">::::cliUnconfigGatewayNetwork</a></a></strong><a name="::::cliUnconfigGatewayNetwork"></a> {} {
    global switchPort2DefaultRouter; 
    global defaultRouter;
    global whichDutNow;
 
    <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;\nUnconfigGatewayNetwork{}: delete gateway vlan on DUT$whichDutNow&#34;
    if {[regexp -nocase $switchPort2DefaultRouter &#34;mgmt&#34;]} {
<span class="comment-line">#         SendACmd    &#34;disable port mgmt&#34;;</span>
          <a name="::SendACmd(42)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;unconf mgmt ipaddress&#34;;
        global supportedPlatform
        if {[regexp -nocase &#34;$supportedPlatform&#34; [<a name="::GetPlatform(5)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]]} {
           set xos_version [<a name="::::cliGetVersion(2)"><a href="./upgradecheck.tcl.html#::::cliGetVersion_865">::::cliGetVersion</a></a> DUT$whichDutNow 4]
           if { $xos_version &gt;= &#34;10.2.0&#34; } {
              set virtualRouter VR-mgmt
           } else {
              set virtualRouter VR-0
           }
            <a name="::SendACmd(43)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;config ipr del default $defaultRouter vr $virtualRouter&#34;;
        }
    } else {   
         <a name="::SendACmd(44)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;delete commvlan&#34;;
         set gwPort [<a name="::GetDUTPort(2)"><a href="./ePTPortMapping.tcl.html#::GetDUTPort_78">::GetDUTPort</a></a> $switchPort2DefaultRouter $whichDutNow]
         <a name="::SendACmd(45)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;disable port $gwPort&#34;;       
         set virtualRouter [<a name="::GetVrString(5)"><a href="./misc.tcl.html#::GetVrString_3157">::GetVrString</a></a> $whichDutNow];
         <a name="::SendACmd(46)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a>    &#34;config ipr delete default $defaultRouter vr $virtualRouter&#34;;  
    }
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
