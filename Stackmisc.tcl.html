<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>Stackmisc.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#Stackmisc.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>Stackmisc.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="Stackmisc.tcl-annot.html">annotations</a> | <a href="Stackmisc.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getSlotId</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the Operational slots</span>
<span class="comment-line">#      and the number of slots used  in stack</span>
<span class="comment-line">#       </span>
<span class="comment-line"># Input args:  None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           </span>
<span class="comment-line"># Category: </span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getSlotId_15">proc <a href="Stackmisc.tcl-annot.html#::::getSlotId">::::getSlotId</a></a></strong> {args} {
global DUTs_info
global whichDutNow
global maxSlot
global getSlotId

<a name="::CheckOperationalStack(1)"><a href="./Stackmisc.tcl.html#::CheckOperationalStack_179">::CheckOperationalStack</a></a>
<a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the number of slots used in stack&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Operational} -3&#34;
set getSlot [<a name="::GetKeyValue(1)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show slot&#34; $parameterList]
if {[string match &#34;Slot*&#34; [lindex $getSlot 0]]} {

set maxSlot [llength $getSlot]
<a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;GETSLOT $getSlot,$maxSlot&#34;
unset parameterList
regsub -all Slot- $getSlot &#34;&#34; getSlotId
<a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Slot Ids used for stack -$getSlotId&#34;


return $getSlotId
return $maxSlot
} else {

<a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the number of slots used in stack&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Operational} -2&#34;
set getSlot [<a name="::GetKeyValue(2)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show slot&#34; $parameterList]

set maxSlot [llength $getSlot]
<a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;GETSLOT $getSlot,$maxSlot&#34;
unset parameterList
regsub -all Slot- $getSlot &#34;&#34; getSlotId
<a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Slot Ids used for stack -$getSlotId&#34;


return $getSlotId
return $maxSlot

}
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getStandbyMac</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the list of the Standby mac</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getStandbyMac_68">proc <a href="Stackmisc.tcl-annot.html#::::getStandbyMac">::::getStandbyMac</a></a></strong> {args} {
global getStandbyMac 
global DUT1_CONNECT
global DUT1_CONNECTB

<a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the StandbyMac list for the stack&#34;
<a name="::Login(1)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0
set parameterList &#34;&#34;
lappend parameterList &#34;{Factory MAC address} 2&#34;
set nodeMac [<a name="::GetKeyValue(3)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking detail&#34; $parameterList]
set maxSlot [llength $nodeMac]
<a name="::result_ok(3)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;nodeMac $nodeMac&#34;
<a name="::result_ok(4)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;No of Slots is $maxSlot&#34;

<a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Master Node-Mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set MasterNodeMac [<a name="::GetKeyValue(4)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $MasterNodeMac &#34;&#34; MasterNodeMac
<a name="::result_ok(5)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;MasterNodeMac -$MasterNodeMac&#34;

<a name="::Login(2)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECTB -masterCheck 0 -CheckOperational 0
<a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Backup node mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Role} 0 2&#34;
set BackupNodeMac [<a name="::GetKeyValue(5)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $BackupNodeMac &#34;&#34; BackupNodeMac
<a name="::result_ok(6)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;BackupNodeMac $BackupNodeMac&#34;

<a name="::Login(3)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0

set getStandbyMac &#34;&#34;
for {set i 0 } {$i &lt; $maxSlot} {incr i } {
set mac [lindex $nodeMac $i]
if {($mac == $MasterNodeMac) || ($mac == $BackupNodeMac)} {
<span class="comment-line"># skipping for master and backup mac</span>
} else {
lappend getStandbyMac $mac
}
}
<a name="::result_ok(7)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;getStandbyMac -$getStandbyMac&#34;
return $getStandbyMac
}

<span class="comment-line">##################################################################</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getStandbySlotId</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the list of Standby lot Id</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getSlotMac</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the Slot Mac</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  slotId - slot for which mac is required</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:getSlotMac 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>


<strong><a name="::::getSlotMac_141">proc <a href="Stackmisc.tcl-annot.html#::::getSlotMac">::::getSlotMac</a></a></strong> { { slotId &#34;1&#34; }}  {
set parameterList &#34;&#34;
<a name="::result_ok(8)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;slot - $slotId&#34;
<span class="comment-line">#lappend parameterList &#34;{Configured:} 4 4&#34;</span>
lappend parameterList &#34;{Factory MAC address} 2&#34;
set  nodeMac [<a name="::GetKeyValue(6)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking slot $slotId detail&#34; $parameterList]
<a name="::result_ok(9)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;NODEMAC $nodeMac&#34;
return $nodeMac

}
<span class="comment-line">######################################################</span>
<span class="comment-line"># Procedure Name: getStackMac</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the Slot Mac</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  slotId - slot for which mac is required</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:getSlotMac 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>


<strong><a name="::::getStackMac_165">proc <a href="Stackmisc.tcl-annot.html#::::getStackMac">::::getStackMac</a></a></strong> { { slotId &#34;1&#34; }}  {
set parameterList &#34;&#34;
<a name="::result_ok(10)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;slot - $slotId&#34;
lappend parameterList &#34;{Configured:} 4 4&#34;
<span class="comment-line">#lappend parameterList &#34;{Stack MAC address} 2&#34;</span>
set  nodeMac [<a name="::GetKeyValue(7)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking slot $slotId detail&#34; $parameterList]
<a name="::result_ok(11)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;NODEMAC $nodeMac&#34;
return $nodeMac

}

<span class="comment-line">######################################################################</span>
<span class="comment-line">######################################################################</span>

<strong><a name="::::CheckOperationalStack_179">proc <a href="Stackmisc.tcl-annot.html#::::CheckOperationalStack">::::CheckOperationalStack</a></a></strong> {} {

global DUT1_CONNECT
global MasterNodeMac
global BackupNodeMac
set result &#34;ok&#34;

<a name="::Login(4)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUT1_CONNECT -masterCheck 0
set MasterNodeMac [<a name="::getMasterNodeMac(1)"><a href="./Stackmisc.tcl.html#::getMasterNodeMac_760">::getMasterNodeMac</a></a>]
set BackupNodeMac [<a name="::getBackupNodeMac(1)"><a href="./Stackmisc.tcl.html#::getBackupNodeMac_735">::getBackupNodeMac</a></a>]

<a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Verify configurations after reboot&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Active.*Master} exist&#34;
lappend parameterList &#34;{Active.*Backup} exist&#34;
lappend parameterList &#34;{Active.*Standby} exist&#34;
set result [<a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show stacking&#34; $parameterList -time \
   {s: 1 i: 5 d: 400 f: 400 r}  -comment &#34;Verify stacking configurations after reboot&#34;]
if {$result != &#34;ok&#34;} { return &#34;error&#34; }

<a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Verify show switch after reboot&#34;
set  parameterList &#34;&#34;
lappend parameterList &#34;{MASTER} {BACKUP.*In.*Sync} inLine exists&#34;
set result [<a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show switch&#34; $parameterList -time \
	{s: 1 i: 5 d: 180 f: 180 r} -comment &#34;Verify show switch after reboot&#34;]
<a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Result after execution is =============&gt; $result&#34;
<span class="comment-line">#---- FIXME ADDED ESLE STATEMENT TO RETURN VALUE</span>
if {$result != &#34;ok&#34;} { return 0 } else { return 1}

for {set i 1} {$i&lt;=$maxSlot} {incr i} {
   set parameterList &#34;&#34;
   lappend parameterList &#34;Slot-$i Operational inLine exist&#34;
}
set result [<a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot&#34; $parameterList  -time \
        {s: 1 i: 5 d: 180 f: 180 r} -comment &#34;check show slot output&#34;]
if {$result != &#34;ok&#34;} { return &#34;error&#34; }
return &#34;ok&#34;
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name :RebootNode</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Reboots the current DUT, saves the current config</span>
<span class="comment-line">#              Reboots multiple DUTs simultaneously provided via duts</span>
<span class="comment-line">#   ### NOTE: Unfortunately, can not perform waitForReboot on all the DUTs, only the last rebooted is checked.</span>
<span class="comment-line">#   ###       Login eats up all expect buffer leaving nothing for waitForReboot.</span>
<span class="comment-line">#     </span>
<span class="comment-line">#     </span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: duts, save</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#             CheckReboot 1,2,3 -save no -slots 6</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::RebootNode_237">proc <a href="Stackmisc.tcl-annot.html#::::RebootNode">::::RebootNode</a></a></strong> {{duts &#34;&#34;} {cmd &#34;reboot&#34;} {node-address &#34;&#34;} args} {
   global DUT
   global DUTs_info
   <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> RebootNode $args {
      save &#34;yes&#34;
      maxWait 30
      masterCheck 1
   }
   <a name="::DBug(1)"><a href="./misc.tcl.html#::DBug_951">::DBug</a></a> 1 &#34;the CheckReboot args vals: duts $duts, save $save, maxWait $maxWait&#34;

   global whichDutNow
   global hostname
   if {$duts==&#34;&#34;} {
      set duts $whichDutNow
   }
   set dutList [split $duts ,]

   set connect _CONNECT
   set rebootSuccessful 0
   set eofEncountered 0
   set dutMac 00:04:96:20:ad:ba
   set nodeMac 00:04:96:20:ad:ba
    if [info exists node-address] {
    set cmd &#34;reboot node-address $node-address&#34;
    }
   set dutMac $DUTs_info(DUT1,sysMAC)
set dutMac [string tolower $dutMac]
   foreach dut $dutList {
      set DUTName [format %s%d DUT $dut]
      global ${DUTName}_CONNECT ${DUTName}_CONNECTB;
      global ${DUTName}_IP
      set telnetIp [set ${DUTName}_IP]
      <span class="comment-line">#make sure Login will not reuse the lost telnet spawn id after reboot</span>
      if {[info exists hostname]} {set hostname [<a name="::ldelete(1)"><a href="./misc.tcl.html#::ldelete_3310">::ldelete</a></a> &#34;$hostname&#34; &#34;telnetIp&#34;]}
      <a name="::Login(5)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT] -masterCheck $masterCheck
      global spawn_id
      global spawn_ids
      foreach name $hostname {
         if { $spawn_id == $spawn_ids($name) } {
            set ipAddr $name
         }
      }
      <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Rebooting with save $save option...&#34;
      <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;reboot\r&#34;  ;<span class="comment-line"># need to log for debug purposes</span>
      <a name="::slow_send(1)"><a href="./SendSwCmd.tcl.html#::slow_send_1567">::slow_send</a></a> &#34;$cmd\r&#34;
      expect {
         &#34;\\? &#34; { send &#34;y\n&#34; }
         &#34;y - save&#34; {
            if {[regexp -nocase &#34;^n&#34; $save]} {
               <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sent n&#34;
               send &#34;n\n&#34;
            } else {
               <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sent y&#34;
               send &#34;y\n&#34;
            }
         }
      }
      expect {
         &#34; #&#34; {
            set rebootSuccessful 1
         }
         &#34; &gt;&#34; {
            set rebootSuccessful 1
         }
         eof {
            <span class="comment-line">#the connection is closed because it is not a console connection</span>
            <span class="comment-line">#make sure Login will not reuse the lost telnet spawn id</span>
            <span class="comment-line">#after reboot</span>
            set rebootSuccessful 1
            set eofEncountered $DUTName$connect
            <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;connection closed by switch.&#34;
	    set hostname [<a name="::ldelete(2)"><a href="./misc.tcl.html#::ldelete_3310">::ldelete</a></a> &#34;$hostname&#34; &#34;$ipAddr&#34;];
         }
      }
      set connectIp $DUTName$connect
   }
   if {$eofEncountered!=0} {   ;<span class="comment-line"># one of the connect was a telnet</span>
      <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 275
      <span class="comment-line">#if it's a console connection, login</span>
      <span class="comment-line">#if it's not a console connection need to spawn the connection and login</span>
      <span class="comment-line">#in either case calling Login will take care of it</span>
      if {[<a name="::Login(6)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set $eofEncountered]] == 0} {
         <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Unable to login to switch after reboot&#34;
         return 0
      } else {
         return &#34;ok&#34;
      }
   }
if [info exists node-address] {

if {$dutMac == $node-address} {
   set status [<a name="::WaitForReboot(1)"><a href="./SendSwCmd.tcl.html#::WaitForReboot_1446">::WaitForReboot</a></a> $maxWait &#34;after sending reboot command to $DUTName&#34; $masterCheck]
    if {$status == &#34;error&#34;} {
      <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Failed to connect to switch after reboot&#34;
      <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Failed to connect to switch after reboot&#34;
      <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return 0
   }
} else {
<span class="comment-line"># exSleep 60</span>
 set showSwitchOutput &#34;&#34;
   lappend showSwitchOutput &#34;{Slot.*Initializing} exist&#34;
   <a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show slot&#34; $showSwitchOutput -time {s: 1 i: 5 d: 180 f: 180 r} -comment &#34;check show slot output&#34;
}
}
   if {[<a name="::CheckOperational(1)"><a href="./login.tcl.html#::CheckOperational_653">::CheckOperational</a></a>] != 1} {
      <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Some slot is not operational&#34;
      error &#34;Some slot is not operational&#34;
   }
   <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Successfully login&#34;
   set status &#34;ok&#34;
   if {[regexp -nocase &#34;^n&#34; $save]} {
      sleep 2
      set buf [<a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config default delete port all&#34;] ;<span class="comment-line"># should not do it for saved config</span>
      set backupStr &#34;Error: This command can only be executed on Master MSM&#34;
      if {[regexp -nocase $backupStr $buf]} {
         set xos_version [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT$whichDutNow 4]
         if {$xos_version &lt; &#34;11.2.0&#34;} {
            if { $xos_version &gt;= &#34;10.2.0&#34; } {
               set virtualRouter VR-Control
            } else {
               set virtualRouter VR-1
            }
            <a name="::EnableDebugMode(1)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>  ;<span class="comment-line"># needed as 11.1.1.3 requires debug-mode</span>
            global bcmChassis
            if {[regexp -nocase $bcmChassis $buf]} {
               <a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;telnet vr $virtualRouter 10.0.12.2&#34;
            } else {
               <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;telnet vr $virtualRouter 10.0.10.2&#34;
            }
         } else {
           <span class="comment-line"># SendACmd &#34;telnet msm b&#34;</span>
           if {[info exists DUT${whichDutNow}_CONNECTB]} {
              <a name="::Login(7)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECTB] -CheckOperational 0
           } else {
              <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;telnet msm b&#34;
           }
         }
        <span class="comment-line">#---- FIXME</span>
        <span class="comment-line">#SendACmd &#34;run msm-failover&#34;</span>
<span class="comment-line">#         logout   ;# do not send logout as vr-control gets kicked out</span>
         <a name="::Login(8)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$whichDutNow,connect)
      }
   }
   return $status
}

<span class="comment-line">################################################################## </span>
<span class="comment-line"># Procedure Name: WaitForReboot</span>
<span class="comment-line">#   </span>
<span class="comment-line"># Description: Internal function that performs a login to the current DUT after waiting for wait time</span>
<span class="comment-line">#              prints the expect_buffer to log file, comment to report file</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args: comment</span>
<span class="comment-line"># Output args: none</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#                set status [WaitForReboot &#34;after sending reboot command to $DUTName&#34;]</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: Setup</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::WaitForRebootStack_399">proc <a href="Stackmisc.tcl-annot.html#::::WaitForRebootStack">::::WaitForRebootStack</a></a></strong> {wait comment {masterCheck 1}} {

global Stacking
global stacking

global DUTs_info
<a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;In WaitForReboot&#34;
set expect_out(buffer) &#34;No Output:WaitForReboot&#34;
set timeout 300
set flag &#34;true&#34;
while {$flag == &#34;true&#34;} {
   expect {
      timeout {
         expect &#34;*&#34;
         <a name="::SaveOutputBuffer(1)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)
         return &#34;error&#34;
      }
      full_buffer {
         set flag &#34;true&#34;
         <a name="::SaveOutputBuffer(2)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)
      }
      &#34;login:&#34; {
         set flag &#34;false&#34;
         if {$wait != 0} {
            <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Wait for $wait seconds after logging in for ports to come up\n&#34;
            <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> $wait
         }
         <a name="::SaveOutputBuffer(3)"><a href="./SendSwCmd.tcl.html#::SaveOutputBuffer_1024">::SaveOutputBuffer</a></a> $expect_out(buffer)
         global stacking
         <span class="comment-line">#if {[regexp -nocase $stacking [GetPlatform]]} {</span>
            <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 40 
         <span class="comment-line">#}</span>
         if {[<a name="::try_login_on_switch(1)"><a href="./login.tcl.html#::try_login_on_switch_981">::try_login_on_switch</a></a> $comment &#34;admin&#34; &#34;&#34; $masterCheck]!=-1} {
               return &#34;ok&#34;
         }
      }
      &#34;System RAM Passed&#34; {
         send &#34;\033&#34;
         send &#34;\033&#34;
      }
      &#34;boot: &#34; {
         send &#34;\r&#34;
      }
      &#34;Removable&#34; {
         send &#34;\033&#34;
         send &#34;\033&#34;
      }
     }
}
return &#34;ok&#34;
}

<strong><a name="::::CheckRebootStack_451">proc <a href="Stackmisc.tcl-annot.html#::::CheckRebootStack">::::CheckRebootStack</a></a></strong> {{duts &#34;&#34;} args} {
   global DUT
   global DUTs_info

   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckReboot $args {
      save &#34;yes&#34;
      maxWait 40 
      masterCheck 1
   }
   <a name="::DBug(2)"><a href="./misc.tcl.html#::DBug_951">::DBug</a></a> 1 &#34;the CheckReboot args vals: duts $duts, save $save, maxWait $maxWait&#34;

   global whichDutNow
   global hostname
   if {$duts==&#34;&#34;} {
      set duts $whichDutNow
   }
   set dutList [split $duts ,]

   set connect _CONNECT
   set rebootSuccessful 0
   set eofEncountered 0
   foreach dut $dutList {
      set DUTName [format %s%d DUT $dut]
      global ${DUTName}_CONNECT ${DUTName}_CONNECTB;
      global ${DUTName}_IP
      set telnetIp [set ${DUTName}_IP]
      <span class="comment-line">#make sure Login will not reuse the lost telnet spawn id after reboot</span>
      if {[info exists hostname]} {set hostname [<a name="::ldelete(3)"><a href="./misc.tcl.html#::ldelete_3310">::ldelete</a></a> &#34;$hostname&#34; &#34;telnetIp&#34;]}
      <a name="::Login(9)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set ${DUTName}_CONNECT] -masterCheck $masterCheck
      global spawn_id
      global spawn_ids
      foreach name $hostname {
         if { $spawn_id == $spawn_ids($name) } {
            set ipAddr $name
         }
      }
 <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Rebooting with save $save option...&#34;
      <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;reboot\r&#34;  ;<span class="comment-line"># need to log for debug purposes</span>
      <a name="::slow_send(2)"><a href="./SendSwCmd.tcl.html#::slow_send_1567">::slow_send</a></a> &#34;reboot stack-topology\r&#34;
      expect {
         &#34;stack\\? &#34; { send &#34;y\n&#34; }
         <span class="comment-line">#---- Changed from switch\\?</span>
         &#34;y - save&#34; {
            if {[regexp -nocase &#34;^n&#34; $save]} {
               <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sent n&#34;
               send &#34;n\n&#34;
            } else {
               <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Sent y&#34;
               send &#34;y\n&#34;
            }
         }
      }
      expect {
         &#34; #&#34; {
            set rebootSuccessful 1
         }
         &#34; &gt;&#34; {
            set rebootSuccessful 1
         }
         eof {
            <span class="comment-line">#the connection is closed because it is not a console connection</span>
            <span class="comment-line">#make sure Login will not reuse the lost telnet spawn id</span>
            <span class="comment-line">#after reboot</span>
            set rebootSuccessful 1
            set eofEncountered $DUTName$connect
            <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;connection closed by switch.&#34;
            set hostname [<a name="::ldelete(4)"><a href="./misc.tcl.html#::ldelete_3310">::ldelete</a></a> &#34;$hostname&#34; &#34;$ipAddr&#34;];
         }
      }
      set connectIp $DUTName$connect
   }
 if {$eofEncountered!=0} {   ;<span class="comment-line"># one of the connect was a telnet</span>
      <a name="::exSleep(4)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 240
      <span class="comment-line">#if it's a console connection, login</span>
      <span class="comment-line">#if it's not a console connection need to spawn the connection and login</span>
      <span class="comment-line">#in either case calling Login will take care of it</span>
      if {[<a name="::Login(10)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set $eofEncountered]] == 0} {
         <a name="::result_error(4)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Unable to login to switch after reboot&#34;
         return 0
      } else {
         return &#34;ok&#34;
      }
   }
   set status [<a name="::WaitForReboot(2)"><a href="./SendSwCmd.tcl.html#::WaitForReboot_1446">::WaitForReboot</a></a> $maxWait &#34;after sending reboot command to $DUTName&#34; $masterCheck]
   if {$status == &#34;error&#34;} {
      <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Failed to connect to switch after reboot&#34;
      <a name="::result_error(5)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Failed to connect to switch after reboot&#34;
      <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
      return 0
   }

   <span class="comment-line">#if {[CheckOperationalStack] != 1} { </span>
   <span class="comment-line">#---- FIXME </span>
   <span class="comment-line">#   result_error &#34;Some slot is not operational&#34;</span>
   <span class="comment-line">#   error &#34;Some slot is not operational&#34;</span>
   <span class="comment-line">#}</span>
   <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Successfully login&#34;
   set status &#34;ok&#34;
   if {[regexp -nocase &#34;^n&#34; $save]} {
      sleep 2
      set buf [<a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;config default delete port all&#34;] ;<span class="comment-line"># should not do it for saved config</span>
      set backupStr &#34;Error: This command can only be executed on Master MSM&#34;
      if {[regexp -nocase $backupStr $buf]} {
         set xos_version [<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT$whichDutNow 4]
         if {$xos_version &lt; &#34;11.2.0&#34;} {
            if { $xos_version &gt;= &#34;10.2.0&#34; } {
               set virtualRouter VR-Control
            } else {
               set virtualRouter VR-1
            }
            <a name="::EnableDebugMode(2)"><a href="./misc.tcl.html#::EnableDebugMode_2430">::EnableDebugMode</a></a>  ;<span class="comment-line"># needed as 11.1.1.3 requires debug-mode</span>
 global bcmChassis
            if {[regexp -nocase $bcmChassis $buf]} {
               <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;telnet vr $virtualRouter 10.0.12.2&#34;
            } else {
               <a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;telnet vr $virtualRouter 10.0.10.2&#34;
            }
         } else {
           <span class="comment-line"># SendACmd &#34;telnet msm b&#34;</span>
           if {[info exists DUT${whichDutNow}_CONNECTB]} {
              <a name="::Login(11)"><a href="./login.tcl.html#::Login_24">::Login</a></a> [set DUT${whichDutNow}_CONNECTB] -CheckOperational 0
           } else {
              <a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;telnet msm b&#34;
           }
         }
         <span class="comment-line">#---- FIXME</span>
         <span class="comment-line">#SendACmd &#34;run msm-failover&#34;</span>
<span class="comment-line">#         logout   ;# do not send logout as vr-control gets kicked out</span>
         <a name="::Login(12)"><a href="./login.tcl.html#::Login_24">::Login</a></a> $DUTs_info(DUT$whichDutNow,connect)
      }
   }
   return $status
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: telnetSlot</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to telnet slot from the DUT</span>
<span class="comment-line">#       It assume that the current session is at the DUT prompt</span>
<span class="comment-line"># Input args:  slotId  - slot to telnet to</span>
<span class="comment-line">#              logout - logout: logout of the telnet session at the end</span>
<span class="comment-line">#                       nologout: don't logout. the DUT will be in the telnet</span>
<span class="comment-line">#                                 session after running this proc</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           telnetSlot 2  &#34;&#34;</span>
<span class="comment-line"># Category: Telnet</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::telnetSlot_600">proc <a href="Stackmisc.tcl-annot.html#::::telnetSlot">::::telnetSlot</a></a></strong> { slotId {<a name="::logout(1)"><a href="./logout.tcl.html#::logout_21">::logout</a></a> logout} } {
   set timeout 20
   set loginSuccess 0
   set user admin
   set password &#34;&#34;
   exp_send &#34;telnet slot $slotId\r&#34;
   sleep 2
   for {set try 0} {$try &lt; 3 } {incr try} {
      expect {
          -re &#34;Error: Cannot establish connection to self&#34; {
         <a name="::::result_debug_expect(1)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 5
        }
         -re &#34;Error: No node present configured&#34; {
         <a name="::::result_debug_expect(2)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 4
        }
        -re &#34;No route to host&#34; {
	<a name="::::result_debug_expect(3)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
	set loginSuccess 0
	return 3
	}
	    -re &#34;.*login:&#34; {
            exp_send &#34;$user\r&#34;
         }
         -re &#34;.*assword:&#34; {
            set passwordSent 1
            exp_send &#34;$password\r&#34;
         }
	


           -re &#34;save your config.*\[#&gt;]&#34; {
            <span class="comment-line">#see the banner and then system prompt. we are in.</span>
 
           <a name="::::result_debug_expect(4)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
            set loginSuccess 1
            <span class="comment-line">#break</span>
         }
        timeout {
         expect *
         <a name="::::result_debug_expect(5)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return error
      }

      }
<a name="::::result_debug_expect(6)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>   
}
if { $loginSuccess != 1 } {
      return &#34;error&#34;
   }
   <span class="comment-line">#if caller specify nologout, don't logout</span>
   if { $logout != &#34;logout&#34; } {
      return 1
   }
   exp_send &#34;exit\r&#34;
   expect {
      -nocase &#34;y/n&#34; {
          <a name="::::result_debug_expect(7)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
          send &#34;n\r&#34;
      }
   }
   expect {
      &#34;Connection closed by foreign host&#34; {
         <a name="::::result_debug_expect(8)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 1
      }
      timeout {
         expect *
         <a name="::::result_debug_expect(9)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return error
      }
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getBackupSlotId</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the Backup Slot Id from the Stack</span>
<span class="comment-line">#       </span>
<span class="comment-line"># Input args:  None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::getBackupSlotId_688">proc <a href="Stackmisc.tcl-annot.html#::::getBackupSlotId">::::getBackupSlotId</a></a></strong> {args} {
global BackupSlotId

<a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Backup Slot ID&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Backup} -2&#34;
set BackupSlotId [<a name="::GetKeyValue(8)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
 <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BackupSlotId -$BackupSlotId&#34;

return $BackupSlotId
}
<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getMasterSlotId </span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the Master Slot Id from the Stack</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::getMasterSlotId_712">proc <a href="Stackmisc.tcl-annot.html#::::getMasterSlotId">::::getMasterSlotId</a></a></strong> {args} {
global MasterSlotId

<a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Master Slot ID&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Active.*Master} -1&#34;
set MasterSlotId [<a name="::GetKeyValue(9)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
 <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;MasterSlotId -$MasterSlotId&#34;
return $MasterSlotId
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getBackupNodeMac</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the Backup's Node mac</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getBackupNodeMac_735">proc <a href="Stackmisc.tcl-annot.html#::::getBackupNodeMac">::::getBackupNodeMac</a></a></strong> {args} {
global BackupNodeMac
global DUTs_info
global whichDutNow

<a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Backup node mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Backup} -3&#34;
set BackupNodeMac [<a name="::GetKeyValue(10)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
 <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;BackupNodeMac -$BackupNodeMac&#34;
return $BackupNodeMac
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getMasterNodeMac</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the Master's Node mac</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>
<strong><a name="::::getMasterNodeMac_760">proc <a href="Stackmisc.tcl-annot.html#::::getMasterNodeMac">::::getMasterNodeMac</a></a></strong> {args} {
global MasterNodeMac
global DUTs_info
global whichDutNow


<a name="::result_debug(31)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Master Node-Mac&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Active.*Master} -2&#34;
set MasterNodeMac [<a name="::GetKeyValue(11)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
regsub -all \\* $MasterNodeMac &#34;&#34; MasterNodeMac
 <a name="::result_debug(32)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;MasterNodeMac -$MasterNodeMac&#34;


return $MasterNodeMac
}


<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: telnetAlternateIp</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to telnet ip from the DUT</span>
<span class="comment-line">#       It assume that the current session is at the DUT prompt</span>
<span class="comment-line"># Input args:  ip  - ip to telnet to</span>
<span class="comment-line">#              logout - logout: logout of the telnet session at the end</span>
<span class="comment-line">#                       nologout: don't logout. the DUT will be in the telnet</span>
<span class="comment-line">#                                 session after running this proc</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#           telnetAlternateIp 192.1.1.2  &#34;&#34;</span>
<span class="comment-line"># Category: Telnet</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::telnetAlternateIp_793">proc <a href="Stackmisc.tcl-annot.html#::::telnetAlternateIp">::::telnetAlternateIp</a></a></strong> { <a name="::ip(1)"><a href="./ePTClient.tcl.html#::ip_974">::ip</a></a> {<a name="::logout(2)"><a href="./logout.tcl.html#::logout_21">::logout</a></a> logout} } {
   set timeout 120
   set loginSuccess 0
   set user admin
   set password &#34;&#34;
   exp_send &#34;telnet $ip\r&#34;
   for {set try 0} {$try &lt; 3 } {incr try} {
   sleep 2
      expect {
          -re &#34;Error: Cannot establish connection to self&#34; {
         <a name="::::result_debug_expect(10)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 5
        }
         -re &#34;Error: No node present configured&#34; {
         <a name="::::result_debug_expect(11)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 4
        }
	  -re &#34;.*login:&#34; {
            exp_send &#34;$user\r&#34;
         }
         -re &#34;.*assword:&#34; {
            set passwordSent 1
            exp_send &#34;$password\r&#34;
         }
         -re &#34;#|&gt;&#34; {
            <a name="::::result_debug_expect(12)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
            set loginSuccess 1
            <span class="comment-line">#break</span>
         }
        timeout {
         expect *
         <a name="::::result_debug_expect(13)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return error
      }

      }
<a name="::::result_debug_expect(14)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
}
if { $loginSuccess != 1 } {
      return &#34;error&#34;
   }
   <span class="comment-line">#if caller specify nologout, don't logout</span>
   if { $logout != &#34;logout&#34; } {
      return 1
   }
   exp_send &#34;exit\r&#34;
   expect {
      -nocase &#34;y/n&#34; {
          <a name="::::result_debug_expect(15)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
          send &#34;n\r&#34;
      }
   }
   expect {
      &#34;Connection closed by foreign host&#34; {
         <a name="::::result_debug_expect(16)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return 1
      }
      timeout {
         expect *
         <a name="::::result_debug_expect(17)"><a href="./telnet.tcl.html#::::result_debug_expect_12">::::result_debug_expect</a></a>
         return error
      }
   }
}

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: getStandbySlotId</span>
<span class="comment-line"># Description:</span>
<span class="comment-line">#       This proc is used to get the list of Standby lot Id</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  None</span>
<span class="comment-line">#</span>
<span class="comment-line"># Output args: None</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category:</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::getStandbySlotId_871">proc <a href="Stackmisc.tcl-annot.html#::::getStandbySlotId">::::getStandbySlotId</a></a></strong> {args} {
global StandbySlotId

<a name="::result_debug(33)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Get the Standby Slot ID&#34;
set parameterList &#34;&#34;
lappend parameterList &#34;{Standby} -2&#34;
set StandbySlotId [<a name="::GetKeyValue(12)"><a href="./OptionCheck.tcl.html#::GetKeyValue_438">::GetKeyValue</a></a> &#34;show stacking&#34; $parameterList]
 <a name="::result_debug(34)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;StandbySlotId -$StandbySlotId&#34;

return $StandbySlotId
}

<span class="comment-line">######################################################################</span>



</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
