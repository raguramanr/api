<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>mirroring.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#mirroring.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>mirroring.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="mirroring.tcl-annot.html">annotations</a> | <a href="mirroring.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<span class="comment-line">################################################################</span>
<span class="comment-line">#  [exIAConfMirroring]</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Proc to enable and configure mirror on EXOS based platforms.</span>
<span class="comment-line">#   </span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#      - &lt;monitorPort&gt; - required param</span>
<span class="comment-line">#      - &lt;args&gt; - optional params</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - returns OK on success</span>
<span class="comment-line">#      - returns error as returned by cli on failure</span>
<span class="comment-line">#      </span>
<span class="comment-line">#  [Examples]</span>
<span class="comment-line">#  if {[exIAConfMirroring [MapDUTPortId 8] -port [MapDUTPortId 5] -tagged no -direction ingress]==&#34;OK&#34;</span>
<span class="comment-line">#  } {</span>
<span class="comment-line">#  ....</span>
<span class="comment-line">#  } else {</span>
<span class="comment-line">#  ....</span>
<span class="comment-line">#  }</span>
<span class="comment-line">################################################################</span>
<strong><a name="::::exIAConfMirroring_25">proc <a href="mirroring.tcl-annot.html#::::exIAConfMirroring">::::exIAConfMirroring</a></a></strong> {monitorPort args} {

    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exIAConfMirroring $args {
        <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;NULL&#34;
        <a name="::vlan(1)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> &#34;NULL&#34;
        tagged &#34;no&#34;
        direction &#34;ingress-and-egress&#34;
    }

    set retVal &#34;&#34;
    global whichDutNow

    set platform [<a name="::GetPlatform(1)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]
    set ver [<a name="::GetVersion(1)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}]
    global i386Platform
    if {[regexp -nocase $i386Platform $platform]} {
        return &#34;Platform not supported&#34;
    }

    <span class="comment-line"># -----------------------------------------------------------</span>
    <span class="comment-line"># Platform based skip test case - This should not hit. If it does</span>
    <span class="comment-line">#    copy this skip to the actual test case that needs to skip. Always use dummy in lib dir</span>
    <span class="comment-line"># -----------------------------------------------------------</span>
    <a name="::::CheckVpexTestCaseSkip(1)"><a href="./vpex.tcl.html#::::CheckVpexTestCaseSkip_625">::::CheckVpexTestCaseSkip</a></a> -dut &#34;$whichDutNow&#34; -ctlrPortsStr &#34;$monitorPort&#34; -testNo &#34;dummy&#34; -time1 &#34;dummy&#34;

    if {($vlan == &#34;NULL&#34;) &amp;&amp; ($port == &#34;NULL&#34;)} {
        set retVal &#34;Invalid Parameter: Can not have both vlan and port not set.&#34;
    } else {
        <span class="comment-line"># check if vlan is set</span>
        if {$vlan != &#34;NULL&#34;} {
            set vlanParam &#34;vlan $vlan&#34;
            set direction &#34;&#34;
        } else {
            set vlanParam &#34;&#34;
        }

        <span class="comment-line"># check if port list is set</span>
        if {$port != &#34;NULL&#34;} {
            set portParam &#34;port $port&#34;
        } else {
            set portParam &#34;&#34;
        }
    }

    <span class="comment-line"># check if tagged or untagged</span>
    <span class="comment-line"># tag/untag only supported from 10.2.0.6</span>
    if {[<a name="::CompareRelease(1)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 10.2.0.6] &gt;=0} {
        global bcmPlatform 
        if {[regexp -nocase $bcmPlatform $platform]} {
            <span class="comment-line"># aspen and cougar does not support this parameter</span>
            set tagParam &#34;&#34;
        } else {
            if {$tagged == &#34;no&#34;} {
                set tagParam &#34;untagged&#34;
            } elseif {$tagged == &#34;yes&#34;} {
                set tagParam &#34;tagged&#34;
            } else {
                <span class="comment-line"># error reached</span>
                <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: tagged parameter needs to be either yes or no&#34;
                set retVal &#34;Invalid Parameter&#34;
            }
        }
        global gnssPlatform
        if {[regexp -nocase $gnssPlatform $platform]} {
            <span class="comment-line"># mariner and olympic does not support this parameter</span>
            set direction &#34;&#34;
        }

    }

    <span class="comment-line"># now issue commands</span>
    if {![regexp -nocase &#34;Invalid Parameter&#34; $retVal]} {
        set retString [<a name="::SendACmd(1)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mirror to port $monitorPort $tagParam&#34;]
        if {($vlan == &#34;NULL&#34;) &amp;&amp; ($port == &#34;NULL&#34;)} {
            set retVal $retString
            <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in exIAConfMirroring $retString&#34;;
            <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Command: enable mirror to port $monitorPort $tagParam&#34;;
        } else {
            if {[regexp -nocase &#34;invalid&#34; $retString] ||
            [regexp -nocase &#34;Error&#34; $retString]} {
                set retVal $retString
                <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in exIAConfMirroring $retString&#34;;
                <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Command: enable mirror to port $monitorPort $tagParam&#34;;
            } else {
                set retString [<a name="::SendACmd(2)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mirror add $portParam $vlanParam $direction&#34;]
                if {[regexp -nocase &#34;invalid&#34; $retString] ||
                   [regexp -nocase &#34;Error&#34; $retString]} {
                    set retVal $retString
                    <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in exIAConfMirroring $retString&#34;;
                    <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Command: enable mirror to port $monitorPort $tagParam&#34;;
                    <span class="comment-line"># clean up because command failed</span>
                    <a name="::SendACmd(3)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable mirror&#34;
                    <a name="::SendACmd(4)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete mirror all&#34;
                } else {
                    set retVal &#34;OK&#34;
                }
            }
        }
    }
    <a name="::exSleep(1)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 2
    return $retVal
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  [exOAMirroring]</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Proc to show mirror</span>
<span class="comment-line">#  a list of vlans or ports may be supplied for multiple mirroring configs</span>
<span class="comment-line">#   </span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#      - &lt;monitorPort&gt; - required param</span>
<span class="comment-line">#      - &lt;args&gt; - optional params</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - returns OK</span>
<span class="comment-line">#      </span>
<span class="comment-line">#  [Examples]</span>
<span class="comment-line">#  exOAMirroring [MapDUTPortId 8] -port [MapDUTPortId 5] -tagged no</span>
<span class="comment-line">################################################################</span>
<strong><a name="::::exOAMirroring_146">proc <a href="mirroring.tcl-annot.html#::::exOAMirroring">::::exOAMirroring</a></a></strong> {monitorPort args} {
   <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exOAMirroring $args {
      <a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;NULL&#34;
      <a name="::vlan(2)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> &#34;NULL&#34;
      tagged &#34;no&#34;
      status &#34;up&#34;
   }

   set retVal &#34;&#34;

   global whichDutNow
   set platform [<a name="::GetPlatform(2)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>  DUT${whichDutNow}]
   set ver [<a name="::GetVersion(2)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}]
   global bcmPlatform
   if {![regexp -nocase $bcmPlatform $platform]} {
     if {$tagged==&#34;yes&#34;} {
        if { [<a name="::CompareRelease(2)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 10.2.0.6] &gt;=0 } {
           lappend checkMirrorPort &#34;{Mirror to port.*: $monitorPort} exist&#34;;
        } else {
           lappend checkMirrorPort &#34;{Mirror to port.*: $monitorPort.*} exist&#34;;
        }
     } else {
        lappend checkMirrorPort &#34;{Mirror to port.*: $monitorPort.*} exist&#34;;
     }
   } else {
      	lappend checkMirrorPort &#34;{Mirror to port.*: $monitorPort} exist&#34;;
   }

   set i 0
   if {$port!=&#34;NULL&#34;} {
   foreach po $port {
      set vl [lindex $vlan $i]
      if {$vl==&#34;&#34;} {set vl &#34;NULL&#34;}
      if {$po!=&#34;NULL&#34; &amp;&amp; $vl==&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{Port.*$po.*all vlans} exist&#34;;
      }

      if {$vl!=&#34;NULL&#34; &amp;&amp; $po==&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{All ports.*vlan $vl} exist&#34;;
      } elseif {$vl!=&#34;NULL&#34; &amp;&amp; $po!=&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{Port.*$po.*vlan $vl} exist&#34;;
      }
      incr i
   }
   } elseif {$vlan!=&#34;NULL&#34;} {
   foreach vl $vlan {
      set po [lindex $port $i]
      if {$po==&#34;&#34;} {set po &#34;NULL&#34;}
      if {$po!=&#34;NULL&#34; &amp;&amp; $vl==&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{Port.*$po.*all vlans} exist&#34;;
      }

      if {$vl!=&#34;NULL&#34; &amp;&amp; $po==&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{All ports.*vlan $vl} exist&#34;;
      } elseif {$vl!=&#34;NULL&#34; &amp;&amp; $po!=&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{Port.*$po.*vlan $vl} exist&#34;;
      }
      incr i
   }
   }

   <span class="comment-line">#added because of the change in the cli show mirror from 15.3</span>
   if {$ver &gt;= 15.3}  {
       <a name="::CheckKeyValue(1)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mirror&#34; $checkMirrorPort;
	
   } else {
       <a name="::CheckKeyValue(2)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mirror&#34; $checkMirrorPort;
   }
   return &#34;OK&#34;
}

<span class="comment-line">################################################################</span>
<span class="comment-line">#  [exIACheckEnableMirroring]</span>
<span class="comment-line"># </span>
<span class="comment-line">#  Proc to perform CheckCmdLegal on enable mirror cli.</span>
<span class="comment-line">#  abstracted as it differs on EXOS based platforms.</span>
<span class="comment-line">#   </span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#      - &lt;monitorPort&gt; - required param</span>
<span class="comment-line">#      - &lt;args&gt; - optional params</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - returns OK on success</span>
<span class="comment-line">#      - returns error as returned by cli on failure</span>
<span class="comment-line">#      </span>
<span class="comment-line">#  [Examples]</span>
<span class="comment-line">#  if {[exIACheckEnableMirroring [MapDUTPortId 8] -tagged no]==&#34;OK&#34;} {</span>
<span class="comment-line">#  ....</span>
<span class="comment-line">#  } else {</span>
<span class="comment-line">#  ....</span>
<span class="comment-line">#  }</span>
<span class="comment-line">################################################################</span>
<strong><a name="::::exIACheckEnableMirroring_240">proc <a href="mirroring.tcl-annot.html#::::exIACheckEnableMirroring">::::exIACheckEnableMirroring</a></a></strong> {monitorPort args} {

  <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exIACheckEnableMirroring $args {
     tagged &#34;no&#34;
  }

  set retVal &#34;OK&#34;
  global whichDutNow

  set platform [<a name="::GetPlatform(3)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>  DUT${whichDutNow}]
  set ver [<a name="::GetVersion(3)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}]
   
global bcmPlatform
  if {![regexp -nocase $bcmPlatform $platform]} {
     if {$tagged == &#34;no&#34;} {
        set tagParam &#34;untagged&#34;
     } elseif {$tagged == &#34;yes&#34;} {
        set tagParam &#34;tagged&#34;
     } else {
        <span class="comment-line"># error reached</span>
        <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: tagged parameter needs to be either yes or no&#34;
        set retVal &#34;Invalid Parameter&#34;
     }
     if { [<a name="::CompareRelease(3)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 10.2.0.6] &gt;=0 } {
        <a name="::CheckCmdLegal(1)"><a href="./checkCmdLegality.tcl.html#::CheckCmdLegal_58">::CheckCmdLegal</a></a> &#34;enable mirror to port $monitorPort $tagParam&#34;
     } else {
        <a name="::CheckCmdLegal(2)"><a href="./checkCmdLegality.tcl.html#::CheckCmdLegal_58">::CheckCmdLegal</a></a> &#34;enable mirror to port $monitorPort&#34;
     }
  } else {
     <a name="::CheckCmdLegal(3)"><a href="./checkCmdLegality.tcl.html#::CheckCmdLegal_58">::CheckCmdLegal</a></a> &#34;enable mirror to port $monitorPort&#34;
  }
  return $retVal
}

<strong><a name="::::mirrorGetHigherPortId_274">proc <a href="mirroring.tcl-annot.html#::::mirrorGetHigherPortId">::::mirrorGetHigherPortId</a></a></strong> {port1 port2} {

   set card1 &#34;&#34;
   set card2 &#34;&#34;
   set portNum1 &#34;&#34;
   set portNum2 &#34;&#34;

   if {[regexp &#34;(.*:)(.*)&#34; $port1 res1 res2 res3] == 1 } {
           set card1 [string trim $res2 :]
           set portNum1 [string trim $res3]
   }

   if {[regexp &#34;(.*:)(.*)&#34; $port2 res1 res2 res3] == 1 } {
           set card2 [string trim $res2 :]
           set portNum2 [string trim $res3]
   }

   if {$card1 &gt; $card2} {
      set retVal 1
   } elseif {$card1 &lt; $card2} {
      set retVal 2
   } elseif {$portNum1 &gt; $portNum2} {
      set retVal 1
   } elseif {$portNum1 &lt; $portNum2} {
      set retVal 2
   } else {
<span class="comment-line"># --- Eqal</span>
      set retVal 0
   }
   return $retVal
}

<strong><a name="::::mirrorGetOddEvenFromMac_306">proc <a href="mirroring.tcl-annot.html#::::mirrorGetOddEvenFromMac">::::mirrorGetOddEvenFromMac</a></a></strong> {macAddr byteNumber} {
   set bitOffset [expr 3*($byteNumber-1)]
   set res1 [string index $macAddr $bitOffset]
   set bitOffset [expr $bitOffset+1]
   set res2 [string index $macAddr $bitOffset]
   set res3 [concat $res1$res2]

   set rem [expr 0x$res3 % 2]
   <span class="comment-line">#result_debug &#34;res3 is $res3 rem is $rem mac addr is $macAddr&#34;</span>
   if {$rem == 1} {
     set retVal &#34;odd&#34;
   } else {
     set retVal &#34;even&#34;
   }
   return $retVal
}


<span class="comment-line">################################################################</span>
<span class="comment-line">#  [enableRemoteMirroring]</span>
<span class="comment-line">#               </span>
<span class="comment-line">#  Proc to enable remote mirroring in all platforms </span>
<span class="comment-line">#       </span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#      - monitorPorts - List of monitor ports</span>
<span class="comment-line">#      - remoteTag    - remoteTag for enabling Remote Mirroring</span>
<span class="comment-line">#      - &lt;args&gt; - optional params</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#     </span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - Ports range</span>
<span class="comment-line">#</span>
<span class="comment-line">#  [Examples]</span>
<span class="comment-line">#  enableRemoteMirroring [MapDUTPortId 1],[MapDUTPortId 3] 100 -loopbackport [MapDUTPortId 5] -tagged no -vlan v1 </span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::enableRemoteMirroring_343">proc <a href="mirroring.tcl-annot.html#::::enableRemoteMirroring">::::enableRemoteMirroring</a></a></strong> {monitorPorts remoteTag args} {

   <a name="::parse_args(4)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> enableRemoteMirroring  $args {
      loopbackport &#34;NULL&#34;
      tagged &#34;no&#34;
      <a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;NULL&#34;
      <a name="::vlan(3)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> &#34;NULL&#34;
      direction &#34;ingress-and-egress&#34;
      }

    set retVal &#34;&#34;
    set monitorParam &#34;&#34;
    set loopbackParam &#34;&#34;
    set tagParam &#34;&#34;
    global whichDutNow
    set platform [<a name="::GetPlatform(4)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]
    set ver [<a name="::GetVersion(4)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}]
    global i386Platform
    global gnssPlatform
    global bcmPlatform

    if {[regexp -nocase $i386Platform $platform]} {
       return &#34;Platform not supported&#34;
    }
      if {($vlan == &#34;NULL&#34;) &amp;&amp; ($port == &#34;NULL&#34;)} {
         set retVal &#34;Invalid Parameter: Can not have both vlan and port not set.&#34;
        } else {
                 <span class="comment-line"># check if vlan is set</span>
            if {$vlan != &#34;NULL&#34;} {
                set vlanParam &#34;vlan $vlan&#34;
                set direction &#34;&#34;
            } else {
                set vlanParam &#34;&#34;
            }
            <span class="comment-line"># check if port list is set</span>
            if {$port != &#34;NULL&#34;} {
                set portParam &#34;port $port&#34;
            } else {
                set portParam &#34;&#34;
            }
        }

   if {[regexp -nocase $gnssPlatform $platform]} {
      if {$loopbackport != &#34;NULL&#34;} {
                set loopbackParam &#34;loopback-port $loopbackport&#34;
        } else {
                <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: Loopback port parameter missing&#34;
                set retVal &#34;Invalid Parameter&#34;
        }

        if {$tagged == &#34;no&#34;} {
                set tagParam &#34;untagged&#34;
        } elseif {$tagged == &#34;yes&#34;} {
                set tagParam &#34;tagged&#34;
        } else {
                <span class="comment-line"># error reached</span>
                <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: tagged parameter needs to be either yes or no&#34;
                set retVal &#34;Invalid Parameter&#34;
        }
      set direction &#34;&#34;
      set monitorParam &#34;port-list $monitorPorts&#34;
    }

    set doSleep 0
    if {[regexp -nocase $bcmPlatform $platform]} {
      set doSleep 1
      if {$loopbackport != &#34;NULL&#34;} {
            set loopbackParam &#34;loopback-port $loopbackport&#34;
            set monitorParam &#34;port-list $monitorPorts&#34;
      } else {
            set loopbackParam &#34;&#34;
            if {[regexp &#34;,&#34; $monitorPorts]} {
               <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: No loopback port, but multiple ports in port-list&#34; 
               set retVal &#34;Invalid Parameter&#34;
            } else {
                set monitorParam &#34;port $monitorPorts&#34;
            }
      }
     set tagParam &#34;&#34;
<span class="comment-line">#    #Enable enhanced mode in case of broadcom platforms before enabling remote mirroring</span>
<span class="comment-line">#    set retString [SendACmd &#34;configure mirror mode enhanced&#34;]</span>
<span class="comment-line">#    if {[regexp -nocase &#34;invalid&#34; $retString] || [regexp -nocase &#34;Error&#34; $retString]} {</span>
<span class="comment-line">#       set retVal $retString</span>
<span class="comment-line">#       result_debug &#34;Error in enabling enhanced mode $retString&#34;</span>
<span class="comment-line">#       result_debug &#34;configure mirror mode enhanced&#34;</span>
<span class="comment-line">#       return $retVal</span>
<span class="comment-line">#    }</span>
}

     if {![regexp -nocase &#34;Invalid Parameter&#34; $retVal]} {
                set retString [<a name="::SendACmd(5)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mirror to $monitorParam $loopbackParam $tagParam remote $remoteTag&#34;]
                if {[regexp -nocase &#34;invalid&#34; $retString] || [regexp -nocase &#34;Error&#34; $retString]} {
                    set retVal $retString
                    <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in enableRemoteMirroring  $retString&#34;;
                    <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;enable mirror to $monitorParam $loopbackParam $tagParam remote $remoteTag&#34;;
                    <span class="comment-line"># clean up because command failed</span>
                    <a name="::SendACmd(6)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable mirror&#34;
<a name="::SendACmd(7)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete mirror all&#34;
        } else {
                        if { $doSleep == 1} {
                                set doSleep 0
                                <a name="::exSleep(2)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
                        }
                         set retString [<a name="::SendACmd(8)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mirror add $portParam $vlanParam $direction&#34;]
                         if {[regexp -nocase &#34;invalid&#34; $retString] || [regexp -nocase &#34;Error&#34; $retString]} {
                        set retVal $retString
                         <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in enableRemoteMirroring  $retString&#34;;
                         <a name="::result_debug(15)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;configure mirror add $portParam $vlanParam $direction&#34;;
                         <span class="comment-line"># clean up because command failed</span>
                         <a name="::SendACmd(9)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable mirror&#34;
<a name="::SendACmd(10)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete mirror all&#34;
                        } else {
                        set retVal &#34;OK&#34;
                      }

        }
    }
return $retVal
} 

<span class="comment-line">################################################################</span>
<span class="comment-line">#  [makePortList]</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Proc to make the range of ports from list of ports given </span>
<span class="comment-line">#  For example: used to verify the mirror ports range in show mirror </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#      - &lt;args&gt; - optional params</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none </span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - Ports range </span>
<span class="comment-line">#</span>
<span class="comment-line">#  [Examples]</span>
<span class="comment-line">#  makePortList &#34;[MapDUTPortId 3] [MapDUTPortId 2] [MapDUTPortId 4] [MapDUTPortId 5]&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::makePortList_481">proc <a href="mirroring.tcl-annot.html#::::makePortList">::::makePortList</a></a></strong> {portlist} {
set portlist [lrmdups $portlist]
set portlist [lsort -integer $portlist]

set listlen [llength $portlist]
set finallist &#34;&#34;
set version [<a name="::GetVersion(5)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1 majmin]
if { $listlen == 1} {
return $portlist
}

for {set i 0} { $i &lt; $listlen } {} {
        set num1 [lindex $portlist $i]
        for { set j [expr $i + 1] } { $j &lt; $listlen} { incr j} {
        set num2 [lindex $portlist $j]
        if { $num2 != [expr $num1 + 1] } {
                if { $j == [expr $i + 1] } {
                   append finallist &#34;$num1,.*&#34;
                  set i $j
                } else {
                        set num1 [lindex $portlist $i]
                        set i $j
                        incr j -1
                        set num2 [lindex $portlist $j]
                        append finallist &#34;$num1-$num2, &#34;
                }
                        set j $listlen
                   if { $i == [expr $listlen - 1] } {
                                set num1 [lindex $portlist $i]
                                append finallist $num1
                                set i $listlen
                   } 

        } else {
                if { $j != [expr $listlen - 1] } {
                set num1 [lindex $portlist $j]
                } else {
                        set num1 [lindex $portlist $i]
                        set num2 [lindex $portlist $j]
                        append finallist &#34;$num1-$num2&#34;
                        set j $listlen
                        set i $listlen
                }
        }
        }
}
return $finallist
}


<span class="comment-line">################################################################</span>
<span class="comment-line">#  [makeChassisPortList]</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Proc to make the range of ports from list of ports given for Chassis</span>
<span class="comment-line">#  For example: used to verify the mirror ports range in show mirror</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#      - &lt;args&gt; - optional params</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - Ports range</span>
<span class="comment-line">#</span>
<span class="comment-line">#  [Examples]</span>
<span class="comment-line">#  makeChassisPortList &#34;[MapDUTPortId 3] [MapDUTPortId 2] [MapDUTPortId 4] [MapDUTPortId 5]&#34;</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::makeChassisPortList_549">proc <a href="mirroring.tcl-annot.html#::::makeChassisPortList">::::makeChassisPortList</a></a></strong> {portlist} {
set listlen [llength $portlist]
set finallist &#34;&#34;
set portnum &#34;&#34;
set cardlist &#34;&#34;
set version [<a name="::GetVersion(6)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT1 majmin]
<span class="comment-line">#set version 16.5</span>
if { $listlen == 1 } {
        return $portlist
}

foreach port1 $portlist {
if {[regexp &#34;(.*:)(.*)&#34; $port1 res1 res2 res3] == 1 } {
           lappend cardlist [string trim $res2 :]
}
}

set cardlist [lrmdups $cardlist]
set cardlist [ lsort -integer $cardlist]
set cardlen [llength $cardlist]

for {set i 0} {$i &lt; $cardlen } {incr i} {
        set cardportlist &#34;&#34;
        set cardnum [lindex $cardlist $i]
        foreach port1 $portlist {
                if {[regexp &#34;(.*:)(.*)&#34; $port1 res1 res2 res3] == 1 } {
                        set card1 [string trim $res2 :]
                        if {[string compare $cardnum $card1]== 0} {
                                lappend cardportlist [string trim $res3]
                        }
                }
        }
set cardportlist1 [<a name="::makePortList(1)"><a href="./mirroring.tcl.html#::makePortList_481">::makePortList</a></a> $cardportlist]
regsub -all &#34;, &#34; $cardportlist1 &#34;,.*$cardnum:&#34; cardportlist2
append finallist1 &#34;$cardnum:&#34;
append finallist1 $cardportlist2
if { $i &lt; [expr $cardlen -1]} {
   append finallist1 &#34;,.*&#34;
}
}
return $finallist1
}


<span class="comment-line">################################################################</span>
<span class="comment-line">#  [exOARemoteMirroring]</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Proc to verify the remote mirroring configuration</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#      - &lt;args&gt; - optional params</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - returns &#34;OK&#34; on success </span>
<span class="comment-line">#</span>
<span class="comment-line">#  [Examples]</span>
<span class="comment-line"># exOARemoteMirroring [GetATrunkPort 1 2 1] -vlan v1 -remoteTag 101 \</span>
<span class="comment-line">#    -loopbackport [GetATrunkPort 1 2 3]</span>
<span class="comment-line">################################################################</span>

<strong><a name="::::exOARemoteMirroring_611">proc <a href="mirroring.tcl-annot.html#::::exOARemoteMirroring">::::exOARemoteMirroring</a></a></strong> {monitorPort args} {
   <a name="::parse_args(5)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> exOAMirroring $args {
      <a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;NULL&#34;
      <a name="::vlan(4)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> &#34;NULL&#34;
      tagged &#34;no&#34;
      status &#34;up&#34;
      remoteTag &#34;NULL&#34;
      loopbackport &#34;&#34;
   }
   
   set retVal &#34;&#34;
   global whichDutNow
   global gnssPlatform bcmChassis
   
   set platform [<a name="::GetPlatform(5)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a>  DUT${whichDutNow}]
   set ver [<a name="::GetVersion(7)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}]

   if { $loopbackport == &#34;NULL&#34;} {
   global bcmPlatform
   if {![regexp -nocase $bcmPlatform $platform]} {
     if {$tagged==&#34;yes&#34;} {
        if { [<a name="::CompareRelease(4)"><a href="./misc.tcl.html#::CompareRelease_891">::CompareRelease</a></a> $ver 10.2.0.6] &gt;=0 } {
           lappend checkMirrorPort &#34;{Mirror port: $monitorPort.* is $status tagged} exist&#34;;
        } else {
           lappend checkMirrorPort &#34;{Mirror port: $monitorPort.* is $status} exist&#34;;
        }
     } else {
        lappend checkMirrorPort &#34;{Mirror port: $monitorPort.* is $status untagged} exist&#34;;
     }
   } else {
      lappend checkMirrorPort &#34;{Mirror port: $monitorPort.* is $status} exist&#34;;
   }
   } else { <span class="comment-line"># Involves one to many mirroring</span>
   if { [regexp -nocase $gnssPlatform $platform] ==1 | [regexp -nocase $bcmChassis $platform] ==1 } {
        set chkportlist [<a name="::makeChassisPortList(1)"><a href="./mirroring.tcl.html#::makeChassisPortList_549">::makeChassisPortList</a></a> $monitorPort]
   } else {
        set chkportlist [<a name="::makePortList(2)"><a href="./mirroring.tcl.html#::makePortList_481">::makePortList</a></a> $monitorPort]
   }
        lappend checkMirrorPort &#34;{Mirror to ports: $chkportlist.* loopback port: $loopbackport} exist&#34;
   }
   
   if { $remoteTag != &#34;NULL&#34; } {
        lappend checkMirrorPort &#34;{Remote tag.*: $remoteTag} exist&#34;
   }

   set i 0
   if {$port!=&#34;NULL&#34;} {
   foreach po $port {
      set vl [lindex $vlan $i]
      if {$vl==&#34;&#34;} {set vl &#34;NULL&#34;}
      if {$po!=&#34;NULL&#34; &amp;&amp; $vl==&#34;NULL&#34;} { 
         lappend checkMirrorPort &#34;{Port $po,.*all vlans,} exist&#34;;
      }
      
      if {$vl!=&#34;NULL&#34; &amp;&amp; $po==&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{All ports,.*vlan $vl} exist&#34;;
      } elseif {$vl!=&#34;NULL&#34; &amp;&amp; $po!=&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{Port $po,.*vlan $vl} exist&#34;;
      }
      incr i
   }
   } elseif {$vlan!=&#34;NULL&#34;} {
   foreach vl $vlan {
      set po [lindex $port $i]
      if {$po==&#34;&#34;} {set po &#34;NULL&#34;}
      if {$po!=&#34;NULL&#34; &amp;&amp; $vl==&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{Port $po,.*all vlans,} exist&#34;;
      }

      if {$vl!=&#34;NULL&#34; &amp;&amp; $po==&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{All ports,.*vlan $vl} exist&#34;;
      } elseif {$vl!=&#34;NULL&#34; &amp;&amp; $po!=&#34;NULL&#34;} {
         lappend checkMirrorPort &#34;{Port $po,.*vlan $vl} exist&#34;;
      }
      incr i
   }
   }

   <span class="comment-line">#added because of the change in the cli show mirror from 15.3</span>
   if {$ver &gt;= 15.3}  {
    	<a name="::CheckKeyValue(3)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mirror&#34; $checkMirrorPort;

   } else {
   	<a name="::CheckKeyValue(4)"><a href="./OptionCheck.tcl.html#::CheckKeyValue_47">::CheckKeyValue</a></a> &#34;show mirror&#34; $checkMirrorPort;
   }
   return &#34;OK&#34;
}


<span class="comment-line">################################################################</span>
<span class="comment-line">#  [RemoteMirroringInter]</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Proc configure vlan with remote tag on intermediate switch</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#     -&lt;remoteTag&gt;- required param</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - returns OK on success</span>
<span class="comment-line">#      - returns error as returned by cli on failure</span>
<span class="comment-line">#</span>
<span class="comment-line"># ################################################################</span>
<strong><a name="::::RemoteMirroringInter_714">proc <a href="mirroring.tcl-annot.html#::::RemoteMirroringInter">::::RemoteMirroringInter</a></a></strong> {remoteTag}  {
    set retVal &#34;&#34;
    set tagParam &#34;&#34;
    global whichDutNow
    set platform [<a name="::GetPlatform(6)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]
    global gnssPlatform
    global bcmPlatform
    global pioneerPlatform
    if {[regexp -nocase $gnssPlatform $platform] || \
      [regexp -nocase $pioneerPlatform $platform]} {

    if {($remoteTag ==&#34;NULL&#34;) } { 
    <a name="::result_debug(16)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: remote Tag parameter missing&#34;
set retVal &#34;Invalid Parameter&#34; 
} else {
set tagParam &#34;$remoteTag remote&#34;
}
}
if {[regexp -nocase $bcmPlatform $platform]} {
<span class="comment-line">#broadcom</span>
  if {($remoteTag ==&#34;NULL&#34;) } {
    <a name="::result_debug(17)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: remote Tag parameter missing&#34;
set retVal &#34;Invalid Parameter&#34;
} else {
set tagParam &#34;$remoteTag remote&#34;
}
}
 if {![regexp -nocase &#34;Invalid Parameter&#34; $retVal]} {
<a name="::SendACmd(11)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;create vlan v1&#34;
  set retString [<a name="::SendACmd(12)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure v1 tag $tagParam&#34;]
  if {[regexp -nocase &#34;invalid&#34; $retString] || [regexp -nocase &#34;Error&#34; $retString]} {
                        set retVal $retString
                         <a name="::result_debug(18)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in RemoteMirroringInter  $retString&#34;;
                         <a name="::result_debug(19)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;configure v1 tag with $remoteTag&#34;;
                         <span class="comment-line"># clean up because command failed</span>
                          <a name="::SendACmd(13)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete vlan v1&#34;
                        } else {
                        set retVal &#34;OK&#34;
                      }
}
return $retVal
}


<span class="comment-line">################################################################</span>
<span class="comment-line">#  [CheckBcmPlatformSupport]</span>
<span class="comment-line">#  </span>
<span class="comment-line">#  Proc to check if the list of ports belong to New Gen broadcom platforms</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#     - list of ports</span>
<span class="comment-line">#  Output Variables:</span>
<span class="comment-line">#     - none      </span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - returns &#34;oldgen&#34; or &#34;newgen&#34; based on platform type/slot type  </span>
<span class="comment-line">#</span>
<span class="comment-line"># ################################################################</span>

<strong><a name="::::CheckBcmPlatformSupport_771">proc <a href="mirroring.tcl-annot.html#::::CheckBcmPlatformSupport">::::CheckBcmPlatformSupport</a></a></strong> {args} {
   <a name="::parse_args(6)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> CheckBcmPlatformSupport $args {
    dutNo 1
    portList &#34;&#34;
   }
global bcmChassis
global bcmPlatform
global DUTs_info
<a name="::CheckNextGenSlotType(1)"><a href="./broadcom.tcl.html#::CheckNextGenSlotType_326">::CheckNextGenSlotType</a></a> $dutNo 
set plat &#34;newgen&#34;

if [regexp -nocase $bcmChassis $DUTs_info(DUT$dutNo,platform)] {
   foreach port $portList {
      set portSlot1 [lindex [split $port :] 0];
      set portDigit1 [lindex [split $port :] 1];
      if {[regexp -nocase &#34;oldgen&#34; $DUTs_info(DUT$dutNo,BcomGen_slot${portSlot1})]} {
         set plat &#34;oldgen&#34;
      }
   }
} else {
   set plat $DUTs_info(DUT$dutNo,BcomGen)
}


if [regexp -nocase &#34;old&#34; $plat] {
   <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Unsupported platform - Testcase not run&#34;
   <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34; Feature not supported in this platform&#34;
   <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return 1 
} else {
   <a name="::report_start_test(2)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Platform support for the feature&#34;
   <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;DUT$dutNo supports the feature. Proceeding with the testcase&#34;
   <a name="::report_end_test(2)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
   return 0
}

}





<span class="comment-line">################################################################</span>
<span class="comment-line">#  [enableOnetoManyMirroring]</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Proc to enable One-to-many mirroring in all platforms</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Input Variables:</span>
<span class="comment-line">#      - monitorPorts - List of monitor ports</span>
<span class="comment-line">#      - loopbackport - loopback port</span>
<span class="comment-line">#      - &lt;args&gt; - optional params</span>
<span class="comment-line">#</span>
<span class="comment-line">#   Output Variables:</span>
<span class="comment-line">#      - none</span>
<span class="comment-line">#</span>
<span class="comment-line">#  Return Value:</span>
<span class="comment-line">#      - Ports range</span>
<span class="comment-line">#</span>
<span class="comment-line">#  [Examples]</span>
<span class="comment-line">#  enableOnetoManyMirroring [MapDUTPortId 1],[MapDUTPortId 3] -loopbackport [MapDUTPortId 5] -tagged no -vlan v1</span>
<span class="comment-line">###############################################################</span>

<strong><a name="::::enableOnetoManyMirroring_833">proc <a href="mirroring.tcl-annot.html#::::enableOnetoManyMirroring">::::enableOnetoManyMirroring</a></a></strong> {monitorPorts args} {

   <a name="::parse_args(7)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> enableOnetoManyMirroring  $args {
      loopbackport &#34;NULL&#34;
      tagged &#34;no&#34;
      <a name="::port(5)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> &#34;NULL&#34;
      <a name="::vlan(5)"><a href="./ePTClient.tcl.html#::vlan_772">::vlan</a></a> &#34;NULL&#34;
      direction &#34;ingress-and-egress&#34;
      }

    set retVal &#34;&#34;
    set monitorParam &#34;&#34;
    set loopbackParam &#34;&#34;
    set tagParam &#34;&#34;
    global whichDutNow
    set platform [<a name="::GetPlatform(7)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]
    set ver [<a name="::GetVersion(8)"><a href="./misc.tcl.html#::GetVersion_303">::GetVersion</a></a> DUT${whichDutNow}]
    global i386Platform
    global gnssPlatform pioneerPlatform 
    global bcmPlatform

    if {[regexp -nocase $i386Platform $platform]} {
       return &#34;Platform not supported&#34;
    }
       if {($vlan == &#34;NULL&#34;) &amp;&amp; ($port == &#34;NULL&#34;)} {
          set retVal &#34;Invalid Parameter: Can not have both vlan and port not set.&#34;
          <a name="::result_debug(20)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Invalid Parameter: Can not have both vlan and port not set.&#34;
    } else {
             <span class="comment-line"># check if vlan is set</span>
         if {$vlan != &#34;NULL&#34;} {
         set vlanParam &#34;vlan $vlan&#34;
         set direction &#34;&#34;
    } else {
          set vlanParam &#34;&#34;
    }
            <span class="comment-line"># check if port list is set</span>
    if {$port != &#34;NULL&#34;} {
         set portParam &#34;port $port&#34;
    } else {
         set portParam &#34;&#34;
         }
   }

    if {[regexp -nocase &#34;$gnssPlatform|$pioneerPlatform&#34; $platform]} {
       if {[regexp -nocase &#34;$gnssPlatform&#34; $platform]} {
          if {$loopbackport != &#34;NULL&#34;} {
                 set loopbackParam &#34;loopback-port $loopbackport&#34;
          } else {
                 <a name="::result_debug(21)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: Loopback port parameter missing&#34;
                 set retVal &#34;Invalid Parameter&#34;
          }
         }
          if {$tagged == &#34;no&#34;} {
                  set tagParam &#34;untagged&#34;
          } elseif {$tagged == &#34;yes&#34;} {
                  set tagParam &#34;tagged&#34;
          } else {
                 <span class="comment-line"># error reached</span>
                 <a name="::result_debug(22)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: tagged parameter needs to be either yes or no&#34;
                 set retVal &#34;Invalid Parameter&#34;
          }
          set direction &#34;&#34;
          set monitorParam &#34;port-list $monitorPorts&#34;
         }

          set doSleep 0
          if {[regexp -nocase $bcmPlatform $platform]} {
             set doSleep 1
             if {$loopbackport != &#34;NULL&#34;} {
                   set loopbackParam &#34;loopback-port $loopbackport&#34;
                   set monitorParam &#34;port-list $monitorPorts&#34;
                } else {
                       set loopbackParam &#34;&#34;
                       if {[regexp &#34;,&#34; $monitorPorts]} {
                          <a name="::result_debug(23)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error: No loopback port, but multiple ports in port-list&#34;
                          set retVal &#34;Invalid Parameter&#34;
                       } else {
                          set monitorParam &#34;port $monitorPorts&#34;
                       }
          }
          set tagParam &#34;&#34;
     }

     if {![regexp -nocase &#34;Invalid Parameter&#34; $retVal]} {
             set retString [<a name="::SendACmd(14)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;enable mirror to $monitorParam $loopbackParam $tagParam&#34;]
               if {[regexp -nocase &#34;invalid&#34; $retString] || [regexp -nocase &#34;Error&#34; $retString]} {
                 set retVal $retString
                    <a name="::result_debug(24)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in enableOnetoManyMirroring  $retString&#34;;
                    <a name="::result_debug(25)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;enable mirror to $monitorParam $loopbackParam $tagParam&#34;;
                    <span class="comment-line"># clean up because command failed</span>
                    <a name="::SendACmd(15)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable mirror&#34;
<a name="::SendACmd(16)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete mirror all&#34;

        } else {
                    if { $doSleep == 1} {
                         set doSleep 0
                         <a name="::exSleep(3)"><a href="./sleep.tcl.html#::exSleep_248">::exSleep</a></a> 3
                       }

                        set retString [<a name="::SendACmd(17)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mirror add $portParam $vlanParam $direction&#34;]
                        if {[regexp -nocase &#34;invalid&#34; $retString] || [regexp -nocase &#34;Error&#34; $retString]} {
                        set retVal $retString
                        <a name="::result_debug(26)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error in enableOnetoManyMirroring  $retString&#34;;
                        <a name="::result_debug(27)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;configure mirror add $portParam $vlanParam $direction&#34;;
                        <span class="comment-line"># clean up because command failed</span>
                        <a name="::SendACmd(18)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;disable mirror&#34;
<a name="::SendACmd(19)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;delete mirror all&#34;
                       } else {
                        set retVal &#34;OK&#34;
                     }

       }
    }
return $retVal
}



<strong><a name="::::CfgMirrModStdOldGen_951">proc <a href="mirroring.tcl-annot.html#::::CfgMirrModStdOldGen">::::CfgMirrModStdOldGen</a></a></strong> {} {
        global whichDutNow
        global DUTs_info
        global numDUT
        global bcmChassis

        if {!$DUTs_info(DUT${whichDutNow},BcomNewGen)} {
        <a name="::SendACmd(20)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mirror mode standard&#34;
        <a name="::CheckSaveConfig(1)"><a href="./SendSwCmd.tcl.html#::CheckSaveConfig_1151">::CheckSaveConfig</a></a>
        } else {
set notSuppSlotList1 &#34;G48P G48T G24X 10G4X G8X X450-24x X450-24t SummitX450-24x SummitX450-24 SummitX450-24t&#34;
        set platform1 [<a name="::GetPlatform(8)"><a href="./misc.tcl.html#::GetPlatform_478">::GetPlatform</a></a> DUT${whichDutNow}]
        <a name="::result_debug(28)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;platform : $platform1&#34;
 if {[regexp -nocase $bcmChassis $platform1]} {
   set allslotsinfo $DUTs_info(DUT${whichDutNow},hwList)
   <a name="::result_debug(29)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Following are the slots in dut : $allslotsinfo&#34;
        foreach slot $allslotsinfo {
       if {$slot != &#34;Empty&#34;} {
           if {([lsearch -exact $notSuppSlotList1 $slot] != -1) } {
          <a name="::result_debug(30)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;OldGen Slot present in the chassis : $slot&#34;
          <a name="::SendACmd(21)"><a href="./SendSwCmd.tcl.html#::SendACmd_157">::SendACmd</a></a> &#34;configure mirror mode standard&#34;
          <a name="::CheckSaveConfig(2)"><a href="./SendSwCmd.tcl.html#::CheckSaveConfig_1151">::CheckSaveConfig</a></a>
          break
        }
      }
     }
  }
  }
 }

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
