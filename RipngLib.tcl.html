<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>RipngLib.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#RipngLib.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>RipngLib.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="RipngLib.tcl-annot.html">annotations</a> | <a href="RipngLib.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::setupRipngPeer_2">proc <a href="RipngLib.tcl-annot.html#::::setupRipngPeer">::::setupRipngPeer</a></a></strong> {args} {
   global TrafficGen
    <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupRipngPeer $args {
        routerIp &#34;3333::24&#34;
        mask &#34;64&#34;
        sourceMac &#34;none&#34;
        vlanId &#34;0&#34;
        txPortId 1
        updateInterval 30
        updateIntervalOffset 5
        enableInterfaceMetric &#34;false&#34;
        response &#34;0&#34;
        rangeIpList &#34;&#34;
        metricList &#34;&#34;
        prefixList &#34;&#34;
        nexthopList &#34;&#34;
        tagList &#34;&#34;
        numRouteList &#34;&#34;
    }

   switch -exact -- $TrafficGen {
      ixia -
      ixvm {
         
    <span class="comment-line">#An array of multiple route ranges, organized as a table </span>
    <span class="comment-line"># Num </span>
    <span class="comment-line"># RangeIp Prefix Routes Metric Next-Hop Tag </span>
    <span class="comment-line">#set routeRanges {{10.0.0.0 13 10 4 198.18.1.2 9} \</span>
    <span class="comment-line">#                {20.0.0.0 17 10 4 198.18.1.2 10}}</span>
    set routerId 1
    set rangeId 1 
    set vlanState &#34;false&#34;
    
    <span class="comment-line"># get the port information   </span>
    <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chas card port
    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupRipngPeer - Chas: $chas Card: $card Port: $port&#34;
    
			
    set pl [list [list $chas $card $port]] 
    <a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $chas $card $port
    if {$sourceMac == &#34;none&#34;} {
       set myMac [<a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]
    } else {
       set myMac $sourceMac
    }
        
    ipAddressTable               setDefault        
    ipAddressTable               config            -defaultGateway                     &#34;0.0.0.0&#34;
    ipAddressTable               set               $chas $card $port
    arpServer setDefault 
    arpServer config -mode 0
    arpServer config -retries 3
    arpServer config -rate 260417
    arpServer config -requestRepeatCount 3
    arpServer set $chas $card $port

    interfaceTable               select  $chas $card $port
    interfaceTable               clearAllInterfaces

    interfaceIpV6                setDefault
    interfaceIpV6                config            -maskWidth $mask
    interfaceIpV6                config            -ipAddress $routerIp

    interfaceEntry               addItem           addressTypeIpV6
    interfaceEntry               setDefault
    interfaceEntry               config            -enable true
    interfaceEntry               config            -description &#34;$routerIp/$mask - Port $port&#34;
    interfaceEntry               config            -macAddress  $myMac
    if { $vlanId != &#34;0&#34; } {
       set vlanState &#34;true&#34;
    }
    interfaceEntry               config            -enableVlan  $vlanState
    interfaceEntry               config            -vlanId     $vlanId 
    interfaceEntry               config            -vlanPriority 0
    interfaceTable               addInterface
    interfaceEntry               clearAllItems     addressTypeIpV6
    interfaceEntry               clearAllItems     addressTypeIpV4

    <span class="comment-line"># Select the port and clear all defined routers </span>
    ripngServer select $chas $card $port 
    ripngServer clearAllRouters

    ripngInterface               setDefault
    ripngInterface               config            -enable   true 
    ripngInterface               config            -responseMode  0
    ripngInterface               config            -interfaceMetric 0 
    ripngInterface               config            -protocolInterfaceDescription       &#34;$routerIp/$mask - Port $port&#34;
    ripngRouter                  addInterface      interface1

    ripngRouteRange setDefault 

    <span class="comment-line"># For all the defined routers</span>
    set idx 0 
    while {[llength $rangeIpList] &gt; $idx} {    
        <span class="comment-line"># Extract the information from the table and set the route ranges </span>
        set myIp [lindex $rangeIpList $idx]
        set prefix [lindex $prefixList $idx]
        set metric [lindex $metricList $idx]
        set nextHop [lindex $nexthopList $idx]
        set numRt [lindex $numRouteList $idx]
        set routeTag [lindex $tagList $idx]
        incr idx
        ripngRouteRange config -enable                   true 
        ripngRouteRange config -routeTag                 $routeTag 
        ripngRouteRange config -networkIpAddress         $myIp 
        ripngRouteRange config -maskWidth                $prefix 
        ripngRouteRange config -nextHop                  $nextHop
        ripngRouteRange config -step                     1 
        ripngRouteRange config -numRoutes                $numRt
        ripngRouteRange config -metric                   $metric
        ripngRouteRange config -enableIncludeLoopback    true
        ripngRouteRange config -enableIncludeMulticast   true
 
        <span class="comment-line"># Create a name for each individual route range </span>
        ripngRouter addRouteRange [format &#34;routeRange%02d&#34; $rangeId]
        ripngRouteRange setDefault 
        incr rangeId 
    }

    ripngRouter                  setDefault
    ripngRouter                  config            -enable true
    ripngRouter                  config            -routerId $routerId
    ripngRouter                  config            -receiveType   0
    ripngRouter                  config            -updateInterval   30
    ripngRouter                  config            -updateIntervalOffset  5
    ripngRouter                  config            -enableInterfaceMetric true
    ripngServer                  addRouter         router1

    ripngServer                  setDefault
    ripngServer                  config            -numRoutes     0
    ripngServer                  config            -timePeriod    0
    ripngServer                  set
 
    protocolServer  setDefault
    protocolServer get $chas $card $port 
    protocolServer config -enableArpResponse true 
    protocolServer config -enableRipngService true 
    protocolServer config -enablePingResponse false 
    protocolServer set $chas $card $port
    
    <span class="comment-line"># Send to the hardware </span>
    <a name="::ixWritePortsToHardware(1)"><a href="./mapping.tcl.html#::ixWritePortsToHardware_145">::ixWritePortsToHardware</a></a> pl 
    <a name="::ixCheckLinkState(1)"><a href="./mapping.tcl.html#::ixCheckLinkState_160">::ixCheckLinkState</a></a>       pl          
		}
	}

}

<strong><a name="::::startRipng_150">proc <a href="RipngLib.tcl-annot.html#::::startRipng">::::startRipng</a></a></strong> {txPortIdList} {

    set pList &#34;&#34;;
	global TrafficGen
	  switch -exact -- $TrafficGen {
		  ixia -
                  ixvm {
    foreach txPortId $txPortIdList {
        <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por;
        <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startRipng - Chas: $cha Card: $car Port: $por&#34;;
        lappend pList &#34;$cha $car $por&#34;;
    }

    if {[ixStartRipng pList]} {
        error &#34;startRip: ixStartRipng failed.&#34;;
    }
}
		  stc {
				set globalDeviceList &#34;&#34;
				foreach txPortId $txPortIdList {
					set txPortId [<a name="::hMapPortIdToSpirentPort(1)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
					set deviceList [<a name="::logcmd(1)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
					<a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;startRipng: Device List - $deviceList&#34;
					set globalDeviceList [concat $globalDeviceList $deviceList]				
				}

				<a name="::logcmd(2)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStartCommand -DeviceList $globalDeviceList
			}
		}
    
}

<strong><a name="::::stopRipng_182">proc <a href="RipngLib.tcl-annot.html#::::stopRipng">::::stopRipng</a></a></strong> {txPortIdList} {

    set pList &#34;&#34;;
	global TrafficGen
	switch -exact -- $TrafficGen {
		ixia -
                ixvm {	
    foreach txPortId $txPortIdList {
        <a name="::MapIxiaPortId(3)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por;
        <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopRipng - Chas: $cha Card: $car Port: $por&#34;;
        lappend pList &#34;$cha $car $por&#34;;
    }

    if {[ixStopRipng pList]} {
        error &#34;stopRipng: ixStopRipng failed.&#34;;
    }
}
		stc {
			
			set globalDeviceList &#34;&#34;
			foreach txPortId $txPortIdList {
				set txPortId [<a name="::hMapPortIdToSpirentPort(2)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
				set deviceList [<a name="::logcmd(3)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources]
				<a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;stopRipng: Device List - $deviceList&#34;
				set globalDeviceList [concat $globalDeviceList $deviceList]				
			}

			if {[catch {<a name="::logcmd(4)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::perform DeviceStopCommand -DeviceList $globalDeviceList} retCode]} {
				error &#34;stopRipng: Spirent device start failed.&#34;
			} 
		}
	}
    
}

<strong><a name="::::cleanupRipng_217">proc <a href="RipngLib.tcl-annot.html#::::cleanupRipng">::::cleanupRipng</a></a></strong> {txPortIdList routerIp} {


  global TrafficGen
  
	switch -exact -- $TrafficGen {
		
		stc {
			foreach txPortId $txPortIdList {
				set txPortId [<a name="::hMapPortIdToSpirentPort(3)"><a href="./spirent.tcl.html#::hMapPortIdToSpirentPort_216">::hMapPortIdToSpirentPort</a></a> $txPortId]
				foreach emulatedDevice [<a name="::logcmd(5)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $txPortId -affiliationport-Sources] {
					set ipv6IfList [<a name="::logcmd(6)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $emulatedDevice -children-Ipv6If]
					foreach ipv6If $ipv6IfList {
						if {$ipv6If != &#34;&#34;} {
							if {[<a name="::logcmd(7)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::get $ipv6If -Address] ==  $routerIp | $routerIp == &#34;*&#34;} {
								<a name="::logcmd(8)"><a href="./spirent.tcl.html#::logcmd_26">::logcmd</a></a> stc::delete $emulatedDevice
                                                                break
							}
						}
					}
				}									
				
			}			
			
		}
		
		ixia -
                ixvm {

  set routerId 1
  set rangeId 1
  foreach txPortId $txPortIdList {
    <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(4)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId chas card port;
    set pl [list [list $chas $card $port]]
    <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;cleanupRipng - Chas: $chas Card: $card Port: $port&#34;;

    <span class="comment-line"># select the port</span>
    if {[ripngServer select $chas $card $port]} {
        <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error Connecting to ripngServer&#34;;
    }
    ripngServer clearAllRouters
    ripngRouter clearAllRouteRanges
    if [ripngServer write] {
        error &#34;Error writing ripngServer&#34;
    }

    arpServer setDefault
    interfaceTable select $chas $card $port
    interfaceTable clearAllInterfaces
    protocolServer config -enableArpResponse false
    protocolServer config -enableRipngService false
    protocolServer set 1 $card $port

    if {[protocolServer write $chas $card $port]} {
        error &#34;protocolServer write $chas $card $port failed.&#34;
    }
    <span class="comment-line"># Send to the hardware</span>
    <a name="::ixWritePortsToHardware(2)"><a href="./mapping.tcl.html#::ixWritePortsToHardware_145">::ixWritePortsToHardware</a></a> pl
  }
}
	}
}

<strong><a name="::::CheckRIPngRoutes_281">proc <a href="RipngLib.tcl-annot.html#::::CheckRIPngRoutes">::::CheckRIPngRoutes</a></a></strong> {ripFrameList routeList {oneOrAll &#34;all&#34;} {comment &#34;&#34;}} {

 <a name="::report_start_test(1)"><a href="./report.tcl.html#::report_start_test_79">::report_start_test</a></a> &#34;Checking routes in RIPng packets $comment&#34;
 set numFrame [llength $ripFrameList]

 if { $numFrame &gt; 0 } {
   set numPass $numFrame
   for {set i 1} {$i &lt;= $numFrame} {incr i 1} {
      set frame [lindex $ripFrameList [expr $i - 1]]
      set msgType [<a name="::GetMessageType(1)"><a href="./MessageDecoding.tcl.html#::GetMessageType_992">::GetMessageType</a></a> $frame]
      <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$msgType frame($i):&#34;
      <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;$frame&#34;
      set routeCheck 1
      foreach routeItem $routeList {
        set route [lindex $routeItem 0]
        set flag [lindex $routeItem 1]
        set existence [string first $route [string range $frame 198 end] ]
        switch $flag {
          &#34;notExist&#34;    {
             if { $existence != -1 } {
                set routeCheck 0
                <a name="::result_debug(10)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;!!!! frame($i) advertises the unexpected route: ($route) !!!!&#34;
             } else {   
                <a name="::result_debug(11)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;frame($i) doesn't advertise the unexpected route: ($route)&#34;
             }
          }
          
          &#34;exist&#34; -
          default       {
             if { $existence != -1 } {
                <a name="::result_debug(12)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;frame($i) advertises the expected route: ($route)&#34;
             } else {
                set routeCheck 0
                <a name="::result_debug(13)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;!!!! frame($i) doesn't advertise the expected route: ($route) !!!!&#34;
             }
          }
        }
      }       
      if { !$routeCheck } { set numPass [expr $numPass - 1] }
   }
   
   switch $oneOrAll {
      &#34;all&#34;     { if { $numPass == $numFrame } {
                    <a name="::result_ok(1)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;ALL RIPng frames advertising routes check passed&#34;
                 } else {
                    <a name="::result_error(1)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;ALL RIPng frames advertising routes check failed&#34; 
                 }
                }
      default   { if { $numPass &gt;= 1 } {
                    <a name="::result_ok(2)"><a href="./lconsoles.tcl.html#::result_ok_9">::result_ok</a></a> &#34;At least one RIPng frame advertising routes check passed&#34;
                 } else {
                    <a name="::result_error(2)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;At least one RIPng frame advertising routes check failed&#34; 
                 }
                }               
   }
 } else {
   <a name="::result_debug(14)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;!!!! No frame in provided RIPng frame list while invoking CheckRIPngRoutes!!!!&#34;
   <a name="::result_error(3)"><a href="./lconsoles.tcl.html#::result_error_6">::result_error</a></a> &#34;Routes in RIPng packets check failed due to empty RIP frame list&#34;
 }

  <a name="::report_end_test(1)"><a href="./report.tcl.html#::report_end_test_122">::report_end_test</a></a>
}


<strong><a name="::::decodeRipngPacket_345">proc <a href="RipngLib.tcl-annot.html#::::decodeRipngPacket">::::decodeRipngPacket</a></a></strong> { rawFrame } {
  set type [string range $rawFrame 36 40]

   <span class="comment-line"># if tagged, get rid of type and tag field from 36 to 47</span>
   if {$type == &#34;81 00&#34;} {
     set leftRawFrame [string range $rawFrame 0 35] 
     set rightRawFrame [string range $rawFrame 48 [string length $rawFrame]] 
     set rawFrame [format &#34;%s%s&#34; $leftRawFrame $rightRawFrame]
   }

   lappend ripngPacket [string range $rawFrame 66 112]
   lappend ripngPacket [string range $rawFrame 114 160]
   lappend ripngPacket [string range $rawFrame 162 166]
   lappend ripngPacket [string range $rawFrame 168 172]
   set rtPkt [string range $rawFrame 198 end]
   set length [string length $rtPkt]
   set length [expr $length  - 13]
   set routeList &#34;&#34;
   set x 198
   set y 244
   set offSet {{0 0} {48 7} {54 9}}
   while { $length &gt; 0 } {
      foreach index $offSet {
         lappend routeList &#34;[string range $rawFrame [expr $x + [lindex $index 0]] [expr $y + [lindex $index 1]]]&#34;
      }
      set x [expr $x + 60]
      set y [expr $x + 46]
      set length [expr $length - 59]
   }
   lappend ripngPacket $routeList
   return $ripngPacket
}

</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
