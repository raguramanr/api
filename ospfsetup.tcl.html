<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                       "http://www.w3.org/TR/html4/transitional.dtd">
<!-- Generated by TclDoc @@VERSION@@ -->
<html>
<head>
  <title>ospfsetup.tcl</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="default.css">
</head>
<body class="src-html">
<div class="index-selector">
<!-- index for tcl source files -->
	Index by: 
	<a href="index_main.html#ospfsetup.tcl">file name</a> | 
	<a href="index_main.html#byprocname">procedure name</a> | 
	<a href="index_main.html#bycall">procedure call</a> | 
	<a href="index_annot_full.html">annotation</a>

</div>
<hr>

<p><strong>ospfsetup.tcl</strong>&nbsp;&nbsp;<span class="filetype-link">(<a href="ospfsetup.tcl-annot.html">annotations</a> | <a href="ospfsetup.tcl.txt">original source</a>)</span>
</p>
<pre class="src-code">

<strong><a name="::::intraMakeOspfRouter_2">proc <a href="ospfsetup.tcl-annot.html#::::intraMakeOspfRouter">::::intraMakeOspfRouter</a></a></strong> {args} {
 <a name="::parse_args(1)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> intraMakeOspfRouter $args {
        interfaceIp &#34;&#34;
	ipMask &#34;&#34;
	areaId 0
        helloInterval 10
        deadInterval 40
        networkType &#34;ospfBroadcast&#34;
        metric 10
        routeMetric 10
        linkType &#34;ospfLinkTransit&#34;
	mtuSize &#34;1500&#34;
        numNetworks 0
        prefix &#34;&#34;
        routeOrigin &#34;ospfRouteOriginArea&#34;
        networkIp &#34;&#34;
        routerId &#34;&#34;
        txPortId  &#34;1&#34;
	nRow &#34;20&#34;
	nCol &#34;20&#34;    
}

    	ospfRouter setDefault
    	ospfRouter clearAllInterfaces
    	ospfRouter clearAllRouteRanges
    	ospfRouter config -enable true
    	ospfRouter config -routerId $routerId
	
 	ospfInterface setDefault
	ospfInterface config -enable true
	ospfInterface config -connectToDut true
	ospfInterface config -ipAddress $interfaceIp
	ospfInterface config -ipMask $ipMask
	ospfInterface config -areaId $areaId
	ospfInterface config -priority 0
    	ospfInterface config -options 2
    	ospfInterface config -helloInterval $helloInterval
    	ospfInterface config -deadInterval $deadInterval
    	ospfInterface config -networkType $networkType
    	ospfInterface config -metric $metric
    	ospfInterface config -protocolInterfaceDescription &#34;&#34;
    	ospfInterface config -numberOfLearnedLsas 0
    	ospfInterface config -enableTrafficEngineering false
    	ospfInterface config -maxBandwidth 0.0
    	ospfInterface config -maxReservableBandwidth 0.0
    	ospfInterface config -linkMetric 0
    	ospfInterface config -unreservedBandwidthPriority0 0.0
    	ospfInterface config -unreservedBandwidthPriority1 0.0
    	ospfInterface config -unreservedBandwidthPriority2 0.0
    	ospfInterface config -unreservedBandwidthPriority3 0.0
    	ospfInterface config -unreservedBandwidthPriority4 0.0
    	ospfInterface config -unreservedBandwidthPriority5 0.0
    	ospfInterface config -unreservedBandwidthPriority6 0.0
    	ospfInterface config -unreservedBandwidthPriority7 0.0
    	ospfInterface config -linkType $linkType
    	ospfInterface config -neighborRouterId 0.0.0.0
    	ospfInterface config -mtuSize $mtuSize
    	ospfInterface config -enableValidateMtu true
    	ospfInterface config -enableAdvertiseNetworkRange false
        set var [ospfRouter addInterface interface1]
        puts &#34;value of var is $var&#34;
    if {$var} {
        puts &#34;issue is here &#34;;
        error &#34;intraMakeOspfRouter: ospfRouter addInterface interface1 failed.&#34;
    }

<span class="comment-line"># Adding 2nd interface not connected to DUT</span>

        ospfNetworkRange setDefault
        ospfNetworkRange config -entryPointRow 1
        ospfNetworkRange config -entryPointColumn 1
        ospfNetworkRange config -numRows 45
        ospfNetworkRange config -numColumns 57
        ospfNetworkRange config -firstRouterId &#34;0.0.0.0&#34;
        ospfNetworkRange config -firstSubnetIpAddress &#34;0.0.0.0&#34;
        ospfNetworkRange config -routerIdIncrementBy &#34;0.0.0.1&#34;
        ospfNetworkRange config -subnetIpIncrementBy &#34;0.0.0.1&#34;
        ospfNetworkRange config -enableIncrementIpFromMask true
        ospfNetworkRange config -maskWidth 24
        ospfNetworkRange config -linkType ospfNetworkRangeLinkBroadcast
        ospfNetworkRange config -enableBBit false
        ospfNetworkRange config -enableEBit false
        ospfNetworkRange config -enableAdvertiseRouterLsaLoopback false
        ospfNetworkRange config -enableTe false
        ospfNetworkRange config -maxBandwidth 0.0
        ospfNetworkRange config -maxReservableBandwidth 0.0
        ospfNetworkRange config -linkMetric 0
        ospfNetworkRange config -unreservedBandwidthPriority0 0.0
        ospfNetworkRange config -unreservedBandwidthPriority1 0.0
        ospfNetworkRange config -unreservedBandwidthPriority2 0.0
        ospfNetworkRange config -unreservedBandwidthPriority3 0.0
        ospfNetworkRange config -unreservedBandwidthPriority4 0.0
        ospfNetworkRange config -unreservedBandwidthPriority5 0.0
        ospfNetworkRange config -unreservedBandwidthPriority6 0.0
        ospfNetworkRange config -unreservedBandwidthPriority7 0.0

	ospfInterface setDefault
        ospfInterface config -enable true
        ospfInterface config -connectToDut false
        ospfInterface config -ipAddress 11.11.11.20 
        ospfInterface config -ipMask 255.255.255.0
        ospfInterface config -areaId 0
        ospfInterface config -priority 0
        ospfInterface config -options 2
        ospfInterface config -helloInterval $helloInterval
        ospfInterface config -deadInterval $deadInterval
        ospfInterface config -networkType $networkType
        ospfInterface config -metric $metric
        ospfInterface config -numberOfLearnedLsas 0
        ospfInterface config -enableTrafficEngineering false
        ospfInterface config -maxBandwidth 0.0
        ospfInterface config -maxReservableBandwidth 0.0
        ospfInterface config -protocolInterfaceDescription &#34;&#34;
        ospfInterface config -linkMetric 0
        ospfInterface config -unreservedBandwidthPriority0 0.0
        ospfInterface config -unreservedBandwidthPriority1 0.0
        ospfInterface config -unreservedBandwidthPriority2 0.0
        ospfInterface config -unreservedBandwidthPriority3 0.0
        ospfInterface config -unreservedBandwidthPriority4 0.0
        ospfInterface config -unreservedBandwidthPriority5 0.0
        ospfInterface config -unreservedBandwidthPriority6 0.0
        ospfInterface config -unreservedBandwidthPriority7 0.0
        ospfInterface config -linkType ospfLinkTransit
        ospfInterface config -neighborRouterId 0.0.0.0
        ospfInterface config -mtuSize $mtuSize
        ospfInterface config -enableValidateMtu true
        ospfInterface config -enableAdvertiseNetworkRange true

        if {[ospfRouter addInterface interface2]} {
        error &#34;intraMakeOspfRouter: ospfRouter addInterface interface2 failed.&#34;
    }


    <a name="::result_debug(1)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;step 4&#34;
    ospfRouteRange setDefault
    ospfRouteRange config -enable true
    ospfRouteRange config -routeOrigin $routeOrigin
    puts &#34; routeOrigin : $routeOrigin&#34;;
    ospfRouteRange config -metric $routeMetric
    puts &#34;routeMetric : $routeMetric&#34;;
    ospfRouteRange config -numberOfNetworks $numNetworks
    puts &#34;numberOfNetworks : $numNetworks&#34;;
    ospfRouteRange config -prefix $prefix
    puts &#34;prefix : $prefix&#34;;
    ospfRouteRange config -networkIpAddress $networkIp
    puts &#34;networkIp : $networkIp&#34;;
    if {[ospfRouter addRouteRange routeRange1]} {
        error &#34;intraMakeOspfRouter: ospfRouter addRouteRange routeRange1 failed.&#34;
    }
    if {[ospfServer addRouter router1]} {
        error &#34;intraMakeOspfRouter: ospfServer addRouter router1 failed.&#34;
    }

    return 0
} ;<span class="comment-line"># intraMakeOspfRouter</span>

<span class="comment-line">##################################################################</span>
<span class="comment-line"># Procedure Name: setupOSPFIntraRouter</span>
<span class="comment-line">#</span>
<span class="comment-line"># Description: This proc is used to setup ixia port as a ospf router. It can create multiple interfaces</span>
<span class="comment-line">#              supplied via interfaceIpList</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line">#</span>
<span class="comment-line"># Input args:  args</span>
<span class="comment-line"># Output args: None.</span>
<span class="comment-line"># Return value: -1 on error only</span>
<span class="comment-line"># Typical usage:</span>
<span class="comment-line">#setupOSPFRouter -dutIp &#34;62.1.0.109&#34; -interfaceIpList &#34;62.1.0.23&#34; -maskList &#34;255.255.255.0&#34; -areaIdList &#34;0&#34; -helloIntervalList &#34;10&#34; \</span>
<span class="comment-line">#                -deadIntervalList &#34;40&#34; -networkTypeList &#34;ospfBroadcast&#34; -metricList &#34;10&#34; -mtuSizeList 1500 \</span>
<span class="comment-line">#                -linkTypeList &#34;ospfLinkTransit&#34; -numNetworksList 10000 -prefixList &#34;30&#34; -routeOriginList &#34;ospfRouteOriginArea&#34; \</span>
<span class="comment-line">#                -networkIpList &#34;37.0.0.0&#34; -routerIdList &#34;62.1.0.23&#34; -txPortId 2</span>
<span class="comment-line">#</span>
<span class="comment-line"># Category Types (Setup,GetSwitchInfo,SendTraffic,CaptureTraffic,VerifySwitchOutput</span>
<span class="comment-line">#                          VerifyTraffic)</span>
<span class="comment-line"># Category: SendTraffic</span>
<span class="comment-line">##################################################################</span>

<strong><a name="::::setupOSPFIntraRouter_180">proc <a href="ospfsetup.tcl-annot.html#::::setupOSPFIntraRouter">::::setupOSPFIntraRouter</a></a></strong> {args} {
    <a name="::parse_args(2)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupOSPFIntraRouter $args {
        dutIp &#34;&#34;
        interfaceMacList &#34;&#34;
        interfaceIpList &#34;&#34;
        maskList &#34;255.255.255.0&#34;
        areaIdList &#34;0&#34;
        helloIntervalList &#34;10&#34;
        deadIntervalList &#34;40&#34;
        networkTypeList &#34;ospfBroadcast&#34;
        metricList &#34;10&#34;
        mtuSizeList &#34;1500&#34;
        linkTypeList &#34;ospfLinkTransit&#34;
	numNetworksList &#34;0&#34;
        prefixList &#34;&#34;
        routeOriginList &#34;ospfRouteOriginArea&#34;
        networkIpList &#34;&#34;
        routeMetricList &#34;10&#34;
        routerIdList &#34;&#34;
        txPortId  &#34;1&#34;
        nRow &#34;20&#34;
	nCol &#34;20&#34;
	}

    <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(1)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
    <a name="::result_debug(2)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupOSPFRouter: Chas: $cha Card: $car Port: $por&#34;

    <span class="comment-line"># select the port</span>
    ipAddressTable clear
    ipAddressTable setDefault
    ipAddressTable config -defaultGateway $dutIp
    ipAddressTableItem setDefault
    ipAddressTableItem config -fromIpAddress [lindex $interfaceIpList 0]
    if {[llength $interfaceMacList] &gt; 0} {
        set macAddr [lindex $interfaceMacList 0]
        if {$macAddr == &#34;default&#34;} {
            if {[<a name="::port(1)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $cha $car $por]} {
                error &#34;setupOSPFRouter: port get $chas $card $port failed.&#34;
            }
            set macAddr [<a name="::port(2)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]
        }
    } else {
        set macAddr [<a name="::uniqMac(1)"><a href="./bgp.tcl.html#::uniqMac_1832">::uniqMac</a></a> $cha $car $por]
    }
    ipAddressTableItem config -fromMacAddress $macAddr
    ipAddressTableItem config -numAddresses 1
    ipAddressTableItem config -mappingOption oneIpToOneMac
    ipAddressTableItem config -enableUseNetwork true
    ipAddressTableItem config -netMask 24
    ipAddressTableItem set
    ipAddressTable addItem
    ipAddressTable set $cha $car $por

    if {[ospfServer select $cha $car $por]} {
        error &#34;setupOSPFIntraRouter: ospfServer select $cha $car $por failed.&#34;
    }
    if {[ospfServer clearAllRouters]} {
        error &#34;setupOSPFIntraRouter: ospfServer clearAllRouters failed.&#34;
    }

    for {set i 0} {$i&lt;[llength $interfaceIpList]} {incr i} {
        puts &#34;i : $i&#34;;
        
        set interfaceIp [lindex $interfaceIpList $i]
        puts &#34;interfaceIp : $interfaceIp&#34;
	set mask [lindex $maskList $i]
        puts &#34;mask : $mask&#34;;
        set areaId [lindex $areaIdList $i]
        puts &#34;areaId : $areaId&#34;;
        set helloInterval [lindex $helloIntervalList $i]
        puts &#34;helloInterval : $helloInterval&#34;;
        set deadInterval [lindex $deadIntervalList $i]
        puts &#34;deadInterval : $deadInterval&#34;;
        set networkType [lindex $networkTypeList $i]
        puts &#34;networkType : $networkType&#34;;
        set metric [lindex $metricList $i]
        puts &#34;metric : $metric&#34;;
        set mtuSize [lindex $mtuSizeList $i]
        puts &#34;mtuSize : $mtuSize&#34;;
        set linkType [lindex $linkTypeList $i]
        puts &#34;linkType : $linkType&#34;;
        set numNetworks [lindex $numNetworksList $i]
        puts &#34;numNetworks : $numNetworks&#34;;
        set prefix [lindex $prefixList $i]
        puts &#34;prefix : $prefix&#34;;
        set routeOrigin [lindex $routeOriginList $i]
        puts &#34;routeOrigin : $routeOrigin&#34;;
        set networkIp [lindex $networkIpList $i]
        puts &#34;networkIp : $networkIp&#34;;
        set routeMetric [lindex $routeMetricList $i]
        puts &#34;routeMetric : $routeMetric&#34;;
        set routerId [lindex $routerIdList $i]
        puts &#34;routerId : $routerId&#34;;
        puts &#34;txPortId : $txPortId&#34;;
	set returnCode [<a name="::intraMakeOspfRouter(1)"><a href="./ospfsetup.tcl.html#::intraMakeOspfRouter_2">::intraMakeOspfRouter</a></a> -interfaceIp $interfaceIp -ipMask $mask \
                                           -areaId $areaId -helloInterval $helloInterval \
                                           -deadInterval $deadInterval \
                                           -networkType $networkType -metric $metric \
                                           -linkType $linkType -mtuSize $mtuSize \
                                           -numNetworks $numNetworks -prefix $prefix \
                                           -routeOrigin $routeOrigin \
                                           -networkIp $networkIp \
                                           -routeMetric $routeMetric -routerId $routerId \
                                           -txPortId $txPortId]
        if {$returnCode==-1} {
            return -1
        }
    }

    protocolServer setDefault
    protocolServer config -enableArpResponse true
    protocolServer config -enablePingResponse true
    protocolServer config -enableOspfService true
    if {[protocolServer set $cha $car $por]} {
        error &#34;setupOSPFRouter: protocolServer set $cha $car $por failed.&#34;
    }

 set portList [list [list $cha $car $por]]
    <a name="::result_debug(3)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Writing Configuration to Hardware...&#34;
   <a name="::result_debug(4)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Intra Routes are been populated&#34;
    if {[<a name="::ixWriteConfigToHardware(1)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList]} {
        <a name="::result_debug(5)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error writing config to hardware&#34;
    }
} ;<span class="comment-line"># setupOSPFRouter</span>


<strong><a name="::::setupOSPFIntraRouterVlan_307">proc <a href="ospfsetup.tcl-annot.html#::::setupOSPFIntraRouterVlan">::::setupOSPFIntraRouterVlan</a></a></strong> {args} {
    <a name="::parse_args(3)"><a href="./parse_args.tcl.html#::parse_args_29">::parse_args</a></a> setupOSPFIntraRouterVlan $args {
        dutIp &#34;&#34;
        interfaceMacList &#34;&#34;
        interfaceIpList &#34;&#34;
        maskList &#34;255.255.255.0&#34;
        areaIdList &#34;0&#34;
        helloIntervalList &#34;10&#34;
        deadIntervalList &#34;40&#34;
        networkTypeList &#34;ospfBroadcast&#34;
        metricList &#34;10&#34;
        mtuSizeList &#34;1500&#34;
        linkTypeList &#34;ospfLinkTransit&#34;
	numNetworksList &#34;0&#34;
        prefixList &#34;&#34;
        routeOriginList &#34;ospfRouteOriginArea&#34;
        networkIpList &#34;&#34;
        routeMetricList &#34;10&#34;
        routerIdList &#34;&#34;
        txPortId  &#34;1&#34;
        nRow &#34;20&#34;
	nCol &#34;20&#34;
	}

    <span class="comment-line"># get the port information</span>
    <a name="::MapIxiaPortId(2)"><a href="./ePTPortMapping.tcl.html#::MapIxiaPortId_14">::MapIxiaPortId</a></a> $txPortId cha car por
    <a name="::result_debug(6)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;setupOSPFRouter: Chas: $cha Card: $car Port: $por&#34;

    <span class="comment-line"># select the port</span>
    ipAddressTable clear
    ipAddressTable setDefault
    ipAddressTable config -defaultGateway $dutIp
    ipAddressTableItem setDefault
    ipAddressTableItem config -fromIpAddress [lindex $interfaceIpList 0]
    if {[llength $interfaceMacList] &gt; 0} {
        set macAddr [lindex $interfaceMacList 0]
        if {$macAddr == &#34;default&#34;} {
            if {[<a name="::port(3)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> get $cha $car $por]} {
                error &#34;setupOSPFRouter: port get $chas $card $port failed.&#34;
            }
            set macAddr [<a name="::port(4)"><a href="./ePTClient.tcl.html#::port_510">::port</a></a> cget -MacAddress]
        }
    } else {
        set macAddr [<a name="::uniqMac(2)"><a href="./bgp.tcl.html#::uniqMac_1832">::uniqMac</a></a> $cha $car $por]
    }
    ipAddressTableItem config -fromMacAddress $macAddr
    ipAddressTableItem config -numAddresses 1
    ipAddressTableItem config -mappingOption oneIpToOneMac
    ipAddressTableItem config -enableUseNetwork true
    ipAddressTableItem config -netMask 24
    ipAddressTableItem set
    ipAddressTable addItem
    ipAddressTable set $cha $car $por

    if {[ospfServer select $cha $car $por]} {
        error &#34;setupOSPFIntraRouter: ospfServer select $cha $car $por failed.&#34;
    }
    if {[ospfServer clearAllRouters]} {
        error &#34;setupOSPFIntraRouter: ospfServer clearAllRouters failed.&#34;
    }

    for {set i 0} {$i&lt;[llength $interfaceIpList]} {incr i} {
        set interfaceIp [lindex $interfaceIpList $i]
	set mask [lindex $maskList $i]
        set areaId [lindex $areaIdList $i]
        set helloInterval [lindex $helloIntervalList $i]
        set deadInterval [lindex $deadIntervalList $i]
        set networkType [lindex $networkTypeList $i]
        set metric [lindex $metricList $i]
        set mtuSize [lindex $mtuSizeList $i]
        set linkType [lindex $linkTypeList $i]
        set numNetworks [lindex $numNetworksList $i]
        set prefix [lindex $prefixList $i]
        set routeOrigin [lindex $routeOriginList $i]
        set networkIp [lindex $networkIpList $i]
        set routeMetric [lindex $routeMetricList $i]
        set routerId [lindex $routerIdList $i]
	set returnCode [<a name="::intraMakeOspfRouter(2)"><a href="./ospfsetup.tcl.html#::intraMakeOspfRouter_2">::intraMakeOspfRouter</a></a> -interfaceIp $interfaceIp -ipMask $mask \
                                           -areaId $areaId -helloInterval $helloInterval \
                                           -deadInterval $deadInterval \
                                           -networkType $networkType -metric $metric \
                                           -linkType $linkType -mtuSize $mtuSize \
                                           -numNetworks $numNetworks -prefix $prefix \
                                           -routeOrigin $routeOrigin \
                                           -networkIp $networkIp \
                                           -routeMetric $routeMetric -routerId $routerId \
                                           -txPortId $txPortId]
        if {$returnCode==-1} {
            return -1
        }
    }

    protocolServer setDefault
    protocolServer config -enableArpResponse true
    protocolServer config -enablePingResponse true
    protocolServer config -enableOspfService true
    if {[protocolServer set $cha $car $por]} {
        error &#34;setupOSPFRouter: protocolServer set $cha $car $por failed.&#34;
    }

 set portList [list [list $cha $car $por]]
    <a name="::result_debug(7)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Writing Configuration to Hardware...&#34;
   <a name="::result_debug(8)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Intra Routes are been populated&#34;
    if {[<a name="::ixWriteConfigToHardware(2)"><a href="./mapping.tcl.html#::ixWriteConfigToHardware_151">::ixWriteConfigToHardware</a></a> portList]} {
        <a name="::result_debug(9)"><a href="./lconsoles.tcl.html#::result_debug_3">::result_debug</a></a> &#34;Error writing config to hardware&#34;
    }
} ;<span class="comment-line"># setupOSPFRouter</span>
</pre>
<hr>
<div class="index-selector">
	<a href="index_main.html#byfilename">file name</a> 
 | 
	<a href="index_main.html#byprocname">procedure name</a> 
 | 
	<a href="index_main.html#bycall">procedure call</a> 
 | 
	<a href="index_annot_full.html">annotation</a> 

<br>
<cite>File generated 2018-06-14 at 17:09.</cite>
</div>

</body>
</html>
